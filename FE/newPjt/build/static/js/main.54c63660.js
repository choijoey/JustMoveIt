/*! For license information please see main.54c63660.js.LICENSE.txt */
!function(){var e={6741:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=6741,e.exports=t},1457:function(e,t,n){var r;self,e.exports=(r=n(2791),function(){var e={315:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(879),a=n.n(r)()((function(e){return e[1]}));a.push([e.id,"@keyframes heartbeat{0%{transform:scale(0)}25%{transform:scale(1.2)}50%{transform:scale(1)}75%{transform:scale(1.2)}100%{transform:scale(1)}}.react-3d-carousel{position:relative}.react-3d-carousel .slider-container{position:absolute;left:50%;top:0%;width:90%;margin:-0px auto 0px -45%}.react-3d-carousel .slider-container .slider-content{position:relative;left:50%;top:0%;width:70%;height:80%;transform:translateX(-50%)}.react-3d-carousel .slider-container .slider-content .slider-single{position:absolute;z-index:0;left:0;top:0;width:100%;transition:z-index 0ms 250ms}.react-3d-carousel .slider-container .slider-content .slider-single .slider-single-content{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:relative;left:0;top:0;width:100%;box-shadow:0px 10px 40px rgba(0,0,0,0.2);transition:500ms cubic-bezier(0.17, 0.67, 0.55, 1.43);transform:scale(0);opacity:0}.react-3d-carousel .slider-container .slider-content .slider-single .slider-single-content img{max-width:100%;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-drag:none;user-drag:none;-webkit-touch-callout:none}.react-3d-carousel .slider-container .slider-content .slider-single.preactivede .slider-single-content{transform:translateX(-50%) scale(0)}.react-3d-carousel .slider-container .slider-content .slider-single.preactive{z-index:1}.react-3d-carousel .slider-container .slider-content .slider-single.preactive .slider-single-content{opacity:0.3;transform:translateX(-25%) scale(0.8)}.react-3d-carousel .slider-container .slider-content .slider-single.proactive{z-index:1}.react-3d-carousel .slider-container .slider-content .slider-single.proactive .slider-single-content{opacity:0.3;transform:translateX(25%) scale(0.8)}.react-3d-carousel .slider-container .slider-content .slider-single.proactivede .slider-single-content{transform:translateX(50%) scale(0)}.react-3d-carousel .slider-container .slider-content .slider-single.active{z-index:2}.react-3d-carousel .slider-container .slider-content .slider-single.active .slider-left,.react-3d-carousel .slider-container .slider-content .slider-single.active .slider-right{display:block}.react-3d-carousel .slider-container .slider-content .slider-single.active .slider-single-content{opacity:1;transform:translateX(0%) scale(1)}.react-3d-carousel .slider-container .slider-left{position:absolute;display:none;z-index:3;right:101%;margin-right:5px;padding:20px 15px;height:100%;cursor:pointer}.react-3d-carousel .slider-container .slider-left div{position:absolute;top:50%;left:0%;margin-top:-20px;color:#ffffff;transform:translateY(-50%);padding:10px 10px;border-top:2px solid #fdc84b;border-right:2px solid #fdc84b;border-bottom:2px solid #fdc84b;border-left:2px solid #fdc84b}.react-3d-carousel .slider-container .slider-right{display:none;position:absolute;z-index:3;left:101%;padding:20px 15px;height:101%;cursor:pointer;margin-left:-2px}.react-3d-carousel .slider-container .slider-right div{position:absolute;top:50%;left:0%;margin-top:-20px;color:#ffffff;transform:translateY(-50%);padding:10px 10px;border-top:2px solid #fdc84b;border-right:2px solid #fdc84b;border-bottom:2px solid #fdc84b;border-left:2px solid #fdc84b}.react-3d-carousel .slider-container .slider-left-noborders{position:absolute;display:none;z-index:3;right:101%;margin-right:5px;padding:20px 15px;height:100%;cursor:pointer}.react-3d-carousel .slider-container .slider-left-noborders div{position:absolute;top:50%;left:0%;margin-top:-20px;color:#ffffff;transform:translateY(-50%);padding:10px 10px}.react-3d-carousel .slider-container .slider-right-noborders{display:none;position:absolute;z-index:3;left:101%;padding:20px 15px;height:101%;cursor:pointer;margin-left:-2px}.react-3d-carousel .slider-container .slider-right-noborders div{position:absolute;top:50%;left:0%;margin-top:-20px;color:#ffffff;transform:translateY(-50%);padding:10px 10px}.react-3d-carousel .slider-container .slider-disabled div{display:none}\n",""]);var i=a},879:function(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(r)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(a[o]=!0)}for(var s=0;s<e.length;s++){var u=[].concat(e[s]);r&&a[u[0]]||(n&&(u[2]?u[2]="".concat(n," and ").concat(u[2]):u[2]=n),t.push(u))}},t}},703:function(e,t,n){"use strict";var r=n(414);function a(){}function i(){}i.resetWarningCache=a,e.exports=function(){function e(e,t,n,a,i,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:a};return n.PropTypes=n,n}},697:function(e,t,n){e.exports=n(703)()},414:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},37:function(e,t,n){!function(e,t){function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var r="Left",a="Right",i="Down",o={delta:10,preventDefaultTouchmoveEvent:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0},s={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},u="mousemove",c="mouseup";function l(e,t){if(0===t)return e;var n=Math.PI/180*t;return[e[0]*Math.cos(n)+e[1]*Math.sin(n),e[1]*Math.cos(n)-e[0]*Math.sin(n)]}function p(e,t){var o=function(t){t&&"touches"in t&&t.touches.length>1||e((function(e,r){r.trackMouse&&(document.addEventListener(u,p),document.addEventListener(c,f));var a="touches"in t?t.touches[0]:t,i=l([a.clientX,a.clientY],r.rotationAngle);return n({},e,s,{initial:[].concat(i),xy:i,start:t.timeStamp||0})}))},p=function(t){e((function(e,o){if("touches"in t&&t.touches.length>1)return e;var s="touches"in t?t.touches[0]:t,u=l([s.clientX,s.clientY],o.rotationAngle),c=u[0],p=u[1],d=c-e.xy[0],f=p-e.xy[1],h=Math.abs(d),m=Math.abs(f),v=(t.timeStamp||0)-e.start,g=Math.sqrt(h*h+m*m)/(v||1),y=[d/(v||1),f/(v||1)];if(h<o.delta&&m<o.delta&&!e.swiping)return e;var b=function(e,t,n,o){return e>t?n>0?a:r:o>0?i:"Up"}(h,m,d,f),x={absX:h,absY:m,deltaX:d,deltaY:f,dir:b,event:t,first:e.first,initial:e.initial,velocity:g,vxvy:y};x.first&&o.onSwipeStart&&o.onSwipeStart(x),o.onSwiping&&o.onSwiping(x);var k=!1;return(o.onSwiping||o.onSwiped||"onSwiped"+b in o)&&(k=!0),k&&o.preventDefaultTouchmoveEvent&&o.trackTouch&&t.cancelable&&t.preventDefault(),n({},e,{first:!1,eventData:x,swiping:!0})}))},d=function(t){e((function(e,r){var a;if(e.swiping&&e.eventData){a=n({},e.eventData,{event:t}),r.onSwiped&&r.onSwiped(a);var i="onSwiped"+a.dir;i in r&&r[i](a)}else r.onTap&&r.onTap({event:t});return n({},e,s,{eventData:a})}))},f=function e(t){document.removeEventListener(u,p),document.removeEventListener(c,e),d(t)},h=function(e,t){var n=function(){};if(e&&e.addEventListener){var r=[["touchstart",o],["touchmove",p],["touchend",d]];r.forEach((function(n){var r=n[0],a=n[1];return e.addEventListener(r,a,{passive:t})})),n=function(){return r.forEach((function(t){var n=t[0],r=t[1];return e.removeEventListener(n,r)}))}}return n},m={ref:function(t){null!==t&&e((function(e,r){if(e.el===t)return e;var a={};return e.el&&e.el!==t&&e.cleanUpTouch&&(e.cleanUpTouch(),a.cleanUpTouch=void 0),r.trackTouch&&t&&(a.cleanUpTouch=h(t,!r.preventDefaultTouchmoveEvent)),n({},e,{el:t},a)}))}};return t.trackMouse&&(m.onMouseDown=o),[m,h]}e.DOWN=i,e.LEFT=r,e.RIGHT=a,e.UP="Up",e.useSwipeable=function(e){var r=e.trackMouse,a=t.useRef(n({},s)),i=t.useRef(n({},o));i.current=n({},o,e);var u=t.useMemo((function(){return p((function(e){return a.current=e(a.current,i.current)}),{trackMouse:r})}),[r]),c=u[0],l=u[1];return a.current=function(e,t,r){var a={};return!t.trackTouch&&e.cleanUpTouch?(e.cleanUpTouch(),a.cleanUpTouch=void 0):t.trackTouch&&!e.cleanUpTouch&&e.el&&(a.cleanUpTouch=r(e.el,!t.preventDefaultTouchmoveEvent)),n({},e,a)}(a.current,i.current,l),c}}(t,n(798))},695:function(e){"use strict";var t={};e.exports=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}},379:function(e){"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var i={},o=[],s=0;s<e.length;s++){var u=e[s],c=r.base?u[0]+r.base:u[0],l=i[c]||0,p="".concat(c," ").concat(l);i[c]=l+1;var d=n(p),f={css:u[1],media:u[2],sourceMap:u[3]};-1!==d?(t[d].references++,t[d].updater(f)):t.push({identifier:p,updater:a(f,r),references:1}),o.push(p)}return o}function a(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var i=r(e=e||[],a=a||{});return function(e){e=e||[];for(var o=0;o<i.length;o++){var s=n(i[o]);t[s].references--}for(var u=r(e,a),c=0;c<i.length;c++){var l=n(i[c]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}i=u}}},216:function(e){"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},795:function(e){"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r=n.css,a=n.media,i=n.sourceMap;a?e.setAttribute("media",a):e.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(r,e)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},876:function(e,t,n){"use strict";n(591);var r=n(798),a=60103;if("function"==typeof Symbol&&Symbol.for){var i=Symbol.for;a=i("react.element"),i("react.fragment")}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:l,props:i,_owner:o.current}}t.jsx=c,t.jsxs=c},588:function(e,t,n){"use strict";e.exports=n(876)},591:function(e){"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function a(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,i){for(var o,s,u=a(e),c=1;c<arguments.length;c++){for(var l in o=Object(arguments[c]))n.call(o,l)&&(u[l]=o[l]);if(t){s=t(o);for(var p=0;p<s.length;p++)r.call(o,s[p])&&(u[s[p]]=o[s[p]])}}return u}},798:function(e){"use strict";e.exports=r}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var a={};return function(){"use strict";n.r(a),n.d(a,{Carousel:function(){return k}});var e=n(798),t=n(37),r=n(697),i=n.n(r),o=n(379),s=n.n(o),u=n(795),c=n.n(u),l=n(695),p=n.n(l),d=n(216),f=n.n(d),h=n(315),m={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=n.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=p()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};m.domAPI=c(),m.insertStyleElement=f(),s()(h.Z,m),h.Z&&h.Z.locals&&h.Z.locals;var v=n(588);function g(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||b(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(n){var r=y((0,e.useState)(0),2),a=r[0],i=r[1],o=y((0,e.useState)(-1),2),s=o[0],u=o[1],c=y((0,e.useState)([]),2),l=c[0],p=c[1],d=y((0,e.useState)("0px"),2),f=d[0],h=d[1],m=(0,e.useRef)(null),b=(0,e.useRef)(),x=(0,t.useSwipeable)({onSwipedLeft:function(){return k()},onSwipedRight:function(){return w()},preventDefaultTouchmoveEvent:!0,trackMouse:!0});(0,e.useEffect)((function(){var e=[];n.slides.forEach((function(t){var n={class:"slider-single proactivede",element:t};e.push(n)})),2===n.slides.length&&n.slides.forEach((function(t){var n={class:"slider-single proactivede",element:t};e.push(n)})),p(e),i(e.length-1),u(-1),-1===s&&(console.log("2"),setTimeout((function(){b.current.click(),n.autoplay&&(m.current=setTimeout((function(){b.current.click()}),n.interval))}),500))}),[n.slides]),(0,e.useEffect)((function(){-1===s&&(console.log("1"),setTimeout((function(){}),500))}),[l,s]);var k=function(){var e,t,r=s,i="slider-single active",o=g(l);if(a>1){r<a?r++:r=0,e=r>0?o[r-1]:o[a];var c=o[r];t=r<a?o[r+1]:o[0],o.forEach((function(e,t){e.class.includes("preactivede")&&(e.class="slider-single proactivede"),e.class.includes("preactive")&&(e.class="slider-single preactivede")})),e.class="slider-single preactive",c.class=i,t.class="slider-single proactive",p(o),u(r),document.getElementsByClassName("slider-single active").length>0&&setTimeout((function(){if(document.getElementsByClassName("slider-single active").length>0){var e=document.getElementsByClassName("slider-single active")[0].clientHeight;h("".concat(e,"px"))}}),500),n.onSlideChange(r),n.autoplay&&(clearTimeout(m.current),m.current=setTimeout((function(){b.current.click()}),n.interval))}else o[0]&&o[0].class!==i&&(o[0].class=i,p(o),u(0))},w=function(){if(a>1){var e,t,r=s,i=g(l);r>0?r--:r=a,t=r<a?i[r+1]:i[0];var o=i[r];e=r>0?i[r-1]:i[a],i.forEach((function(e,t){e.class.includes("proactivede")&&(e.class="slider-single preactivede"),e.class.includes("proactive")&&(e.class="slider-single proactivede")})),e.class="slider-single preactive",o.class="slider-single active",t.class="slider-single proactive",p(i),u(r),n.onSlideChange(r),document.getElementsByClassName("slider-single active").length>0&&setTimeout((function(){if(document.getElementsByClassName("slider-single active").length>0){var e=document.getElementsByClassName("slider-single active")[0].clientHeight;h("".concat(e,"px"))}}),500)}},S=function(e){var t="slider-".concat(e);return n.arrows?n.arrows&&!n.arrowBorders&&(t="slider-".concat(e,"-noborders")):t="slider-disabled",t};return(0,v.jsx)("div",Object.assign({className:"react-3d-carousel",style:{height:f}},x,{children:l&&l.length>0&&(0,v.jsx)("div",{className:"slider-container",children:(0,v.jsx)("div",{className:"slider-content",children:l.map((function(e,t){return(0,v.jsxs)("div",{className:e.class,children:[(0,v.jsx)("div",{className:S("left"),onClick:w,children:(0,v.jsx)("div",{children:(0,v.jsx)("i",{className:"fa fa-arrow-left"})})}),(0,v.jsx)("div",{className:S("right"),onClick:k,ref:b,children:(0,v.jsx)("div",{children:(0,v.jsx)("i",{className:"fa fa-arrow-right"})})}),(0,v.jsx)("div",{className:"slider-single-content",children:e.element})]},t)}))})})}))}k.propTypes={slides:i().arrayOf(i().element),autoplay:i().bool,interval:i().number,arrows:i().bool,arrowBorders:i().bool,onSlideChange:i().func},k.defaultProps={autoplay:!1,interval:3e3,arrows:!0,arrowBorders:!0,onSlideChange:function(){}}}(),a}())},3007:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(8158),o=n(7749),s=n(7202),u=n(9465),c=n(7749),l=function(e){return e.packageVersion=e.packageVersion||u.version,e.packageName="@teachablemachine/pose",e.timeStamp=e.timeStamp||(new Date).toISOString(),e.userMetadata=e.userMetadata||{},e.modelName=e.modelName||"untitled",e.labels=e.labels||[],e.modelSettings=d(e.modelSettings),e},p=function(e){return r(void 0,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return"string"!==typeof e?[3,3]:[4,fetch(e)];case 1:return[4,n.sent().json()];case 2:return t=n.sent(),[3,4];case 3:if(!(r=e)||!Array.isArray(r.labels))throw new Error("Invalid Metadata provided");t=e,n.label=4;case 4:return[2,l(t)]}var r}))}))},d=function(e){return void 0===e&&(e={}),e.posenet||(e.posenet={}),e.posenet.architecture=e.posenet.architecture||"MobileNetV1",e.posenet.outputStride=e.posenet.outputStride||16,e.posenet.inputResolution=e.posenet.inputResolution||257,e.posenet.multiplier=e.posenet.multiplier||.75,e};function f(e,t,n){return void 0===n&&(n=3),r(this,void 0,void 0,(function(){var r;return a(this,(function(a){switch(a.label){case 0:return[4,t.data()];case 1:return r=a.sent(),[2,i.tidy((function(){n=Math.min(n,r.length);for(var t=[],a=0;a<r.length;a++)t.push({value:r[a],index:a});t.sort((function(e,t){return t.value-e.value}));var i=new Float32Array(n),o=new Int32Array(n);for(a=0;a<n;a++)i[a]=t[a].value,o[a]=t[a].index;var s=[];for(a=0;a<o.length;a++)s.push({className:e[o[a]],probability:i[a]});return s}))]}}))}))}t.getTopKClasses=f;var h=function(){function e(e,t,n){this.model=e,this.posenetModel=t,this._metadata=l(n)}return e.prototype.getMetadata=function(){return this._metadata},e.prototype.getClassLabels=function(){return this._metadata.labels},e.prototype.getTotalClasses=function(){return this.model.output.shape[1]},e.prototype.estimatePose=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r,i,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:return[4,this.estimatePoseOutputs(e)];case 1:return n=a.sent(),r=n.heatmapScores,i=n.offsets,o=n.displacementFwd,s=n.displacementBwd,u=n.padding,c=this.poseOutputsToAray(r,i,o,s),[4,this.poseOutputsToKeypoints(e,r,i,o,s,u,t)];case 2:return[2,{pose:a.sent(),posenetOutput:c}]}}))}))},e.prototype.estimatePoseOutputs=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i,o,u,c,l,p;return a(this,(function(a){switch(a.label){case 0:return t=this.posenetModel.inputResolution,n=s.padAndResizeTo(e,t),r=n.resized,i=n.padding,[4,this.posenetModel.baseModel.predict(r)];case 1:return o=a.sent(),u=o.heatmapScores,c=o.offsets,l=o.displacementFwd,p=o.displacementBwd,r.dispose(),[2,{heatmapScores:u,offsets:c,displacementFwd:l,displacementBwd:p,padding:i}]}}))}))},e.prototype.poseOutputsToAray=function(e,t,n,r){var a=i.concat([e,t],2),o=a.dataSync();return a.dispose(),o},e.prototype.poseOutputsToKeypoints=function(e,t,n,i,o,u,l){return void 0===l&&(l=!1),r(this,void 0,void 0,(function(){var r,p,d,f,h,m,v,g,y,b,x,k,w;return a(this,(function(a){switch(a.label){case 0:return r={maxDetections:3,scoreThreshold:.5,nmsRadius:20},p=s.getInputTensorDimensions(e),d=p[0],f=p[1],h=this.posenetModel.baseModel.outputStride,m=this.posenetModel.inputResolution,[4,s.toTensorBuffers3D([t,n,i,o])];case 1:return v=a.sent(),g=v[0],y=v[1],b=v[2],x=v[3],[4,c.decodeMultiplePoses(g,y,b,x,h,r.maxDetections,r.scoreThreshold,r.nmsRadius)];case 2:return k=a.sent(),w=s.scaleAndFlipPoses(k,[d,f],m,u,l),t.dispose(),n.dispose(),i.dispose(),o.dispose(),[2,w[0]]}}))}))},e.prototype.predict=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,s;return a(this,(function(a){switch(a.label){case 0:return t=i.tensor([e]),[4,(n=this.model.predict(t)).data()];case 1:for(r=a.sent(),o=[],s=0;s<r.length;s++)o.push({className:this._metadata.labels[s],probability:r[s]});return t.dispose(),n.dispose(),[2,o]}}))}))},e.prototype.predictTopK=function(e,t){return void 0===t&&(t=3),r(this,void 0,void 0,(function(){var n,r,o;return a(this,(function(a){switch(a.label){case 0:return n=i.tensor([e]),r=this.model.predict(n),[4,f(this._metadata.labels,r,t)];case 1:return o=a.sent(),n.dispose(),r.dispose(),[2,o]}}))}))},e.prototype.dispose=function(){this.posenetModel.dispose()},e}();function m(e){return void 0===e&&(e={}),r(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return e=d(e),[4,o.load({architecture:e.posenet.architecture,outputStride:e.posenet.outputStride,inputResolution:e.posenet.inputResolution,multiplier:e.posenet.multiplier})];case 1:return[2,t.sent()]}}))}))}t.CustomPoseNet=h,t.loadPoseNet=m,t.load=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,s;return a(this,(function(a){switch(a.label){case 0:return[4,i.loadLayersModel(e)];case 1:return n=a.sent(),t?[4,p(t)]:[3,3];case 2:return o=a.sent(),[3,4];case 3:o=null,a.label=4;case 4:return[4,m((r=o).modelSettings)];case 5:return s=a.sent(),[2,new h(n,s,r)]}}))}))},t.loadFromFiles=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:return[4,i.loadLayersModel(i.io.browserFiles([e,t]))];case 1:return r=a.sent(),[4,new Response(n).json()];case 2:return o=a.sent(),n?[4,p(o)]:[3,4];case 3:return u=a.sent(),[3,5];case 4:u=null,a.label=5;case 5:return[4,m((s=u).modelSettings)];case 6:return c=a.sent(),[2,new h(r,c,s)]}}))}))}},6342:function(e,t,n){"use strict";var r=n(3007);r.CustomPoseNet,t.zD=r.load,r.loadFromFiles;var a=n(7716);a.TeachablePoseNet,a.createTeachable;var i=n(4540);t.bb=i.Webcam,n(1461).createCanvas;var o=n(1246);t.kp=o.drawKeypoints,t.iZ=o.drawSkeleton,o.drawPoint,o.drawSegment,n(9465).version},7716:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(8158),s=n(8158),u=n(3007),c=n(6699);function l(e,t){for(var n,r=e.length,a=e.slice(),i=r-1;i>0;i-=1){var o=void 0;n=[a[o=t?Math.floor(t()*(i+1)):Math.floor(Math.random()*(i+1))],a[i]],a[i]=n[0],a[o]=n[1]}return a}var p=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.model=t,a.posenetModel=n,a.examples=[],a}return r(t,e),Object.defineProperty(t.prototype,"isTrained",{get:function(){return!!this.model&&this.model.layers&&this.model.layers.length>2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPrepared",{get:function(){return!!this.trainDataset},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numClasses",{get:function(){return this._metadata.labels.length},enumerable:!0,configurable:!0}),t.prototype.addExample=function(e,t){return a(this,void 0,void 0,(function(){return i(this,(function(n){return this.examples[e].push(t),[2]}))}))},t.prototype.predict=function(t){return a(this,void 0,void 0,(function(){return i(this,(function(n){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,e.prototype.predict.call(this,t)]}))}))},t.prototype.predictTopK=function(t,n){return void 0===n&&(n=3),a(this,void 0,void 0,(function(){return i(this,(function(r){if(!this.model)throw new Error("Model has not been trained yet, called train() first");return[2,e.prototype.predictTopK.call(this,t,n)]}))}))},t.prototype.prepare=function(){for(var e in this.examples)if(0===e.length)throw new Error("Add some examples before training");var t=this.convertToTfDataset();this.trainDataset=t.trainDataset,this.validationDataset=t.validationDataset},t.prototype.convertToTfDataset=function(){for(var e=0;e<this.examples.length;e++)this.examples[e]=l(this.examples[e],this.seed);var t=[],n=[],r=function(e){var r=function(e,t){var n=new Array(t).fill(0);return n[e]=1,n}(e,a.numClasses),i=a.examples[e].length,o=i-Math.ceil(.15*i),s=a.examples[e].slice(0,o).map((function(e){return{data:e,label:r}})),u=a.examples[e].slice(o).map((function(e){return{data:e,label:r}}));t=t.concat(s),n=n.concat(u)},a=this;for(e=0;e<this.examples.length;e++)r(e);t=l(t,this.seed),n=l(n,this.seed);var i=o.data.array(t.map((function(e){return e.data}))),s=o.data.array(n.map((function(e){return e.data}))),u=o.data.array(t.map((function(e){return e.label}))),c=o.data.array(n.map((function(e){return e.label})));return{trainDataset:o.data.zip({xs:i,ys:u}),validationDataset:o.data.zip({xs:s,ys:c})}},t.prototype.save=function(e,t){return a(this,void 0,void 0,(function(){return i(this,(function(n){return[2,this.model.save(e,t)]}))}))},t.prototype.train=function(e,t){return void 0===t&&(t={}),a(this,void 0,void 0,(function(){var n,r,a,u,c,l,p,d=this;return i(this,(function(i){switch(i.label){case 0:if(n=t.onTrainEnd||function(){},t.onTrainEnd=function(e){d.__stopTrainingResolve&&(d.__stopTrainingResolve(),d.__stopTrainingResolve=null),n(e)},this.isPrepared||this.prepare(),r=this.getLabels().length,s.util.assert(r===this.numClasses,(function(){return"Can not train, has "+r+" labels and "+d.numClasses+" classes"})),a=this.examples[0][1].length,u=this.seed?o.initializers.varianceScaling({seed:3.14}):o.initializers.varianceScaling({}),this.model=o.sequential({layers:[o.layers.dense({inputShape:[a],units:e.denseUnits,activation:"relu",kernelInitializer:u,useBias:!0}),o.layers.dropout({rate:.5}),o.layers.dense({units:this.numClasses,kernelInitializer:u,useBias:!1,activation:"softmax"})]}),c=o.train.rmsprop(e.learningRate),this.model.compile({optimizer:c,loss:"categoricalCrossentropy",metrics:["accuracy"]}),!(e.batchSize>0))throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction");return l=this.trainDataset.batch(e.batchSize),p=this.validationDataset.batch(e.batchSize),[4,this.model.fitDataset(l,{epochs:e.epochs,validationData:p,callbacks:t})];case 1:return i.sent(),c.dispose(),[2,this.model]}}))}))},t.prototype.prepareDataset=function(){for(var e=0;e<this.numClasses;e++)this.examples[e]=[]},t.prototype.stopTraining=function(){var e=this;return new Promise((function(t,n){e.model.stopTraining=!0,e.__stopTrainingResolve=t}))},t.prototype.dispose=function(){this.model.dispose(),e.prototype.dispose.call(this)},t.prototype.setLabel=function(e,t){this._metadata.labels[e]=t},t.prototype.setLabels=function(e){this._metadata.labels=e,this.prepareDataset()},t.prototype.getLabel=function(e){return this._metadata.labels[e]},t.prototype.getLabels=function(){return this._metadata.labels},t.prototype.setName=function(e){this._metadata.modelName=e},t.prototype.getName=function(){return this._metadata.modelName},t.prototype.calculateAccuracyPerClass=function(){return a(this,void 0,void 0,(function(){var e,t,n,r,s,u,c,l,p,d,f,h,m,v,g,y,b,x,k=this;return i(this,(function(w){switch(w.label){case 0:return e=this.validationDataset.mapAsync((function(e){return a(k,void 0,void 0,(function(){return i(this,(function(t){return[2,e.xs]}))}))})),t=this.validationDataset.mapAsync((function(e){return a(k,void 0,void 0,(function(){return i(this,(function(t){return[2,e.ys]}))}))})),n=Math.min(t.size,32),r=Math.ceil(t.size/n),s=e.batch(n),u=t.batch(n),[4,s.iterator()];case 1:return c=w.sent(),[4,u.iterator()];case 2:l=w.sent(),p=[],d=[],x=0,w.label=3;case 3:return x<r?[4,c.next()]:[3,7];case 4:return f=w.sent(),h=this.model.predict(f.value),m=h.argMax(1),p.push(m),[4,l.next()];case 5:v=w.sent(),g=v.value.argMax(1),d.push(g),f.value.dispose(),h.dispose(),v.value.dispose(),w.label=6;case 6:return x++,[3,3];case 7:if(y=o.concat(d),b=o.concat(p),1!==r)for(x=0;x<p.length;x++)p[x].dispose(),d[x].dispose();return[2,{reference:y,predictions:b}]}}))}))},t.prototype.setSeed=function(e){this.seed=c(e)},t}(u.CustomPoseNet);t.TeachablePoseNet=p,t.createTeachable=function(e){return a(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,u.loadPoseNet(e.modelSettings)];case 1:return t=n.sent(),[2,new p(o.sequential(),t,e)]}}))}))}},1461:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.createCanvas=function(e,t,n){void 0===e&&(e=200),void 0===t&&(t=200),void 0===n&&(n=!1);var r=document.createElement("canvas");if(r.width=e,r.height=t,n){var a=r.getContext("2d");a.translate(e,0),a.scale(-1,1)}return r},t.cropTo=function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=document.createElement("canvas"));var a=e.width,i=e.height;e instanceof HTMLVideoElement&&(a=e.videoWidth,i=e.videoHeight);var o=t/Math.min(a,i),s=Math.ceil(a*o),u=Math.ceil(i*o),c=s-t,l=u-t;r.width=r.height=t;var p=r.getContext("2d");return p.drawImage(e,-1*~~(c/2),-1*~~(l/2),s,u),n&&(p.scale(-1,1),p.drawImage(r,-1*t,0)),r}},1246:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7202),a="aqua";function i(e,t,n,r,a,i){e.fillStyle=a,e.strokeStyle=i,e.beginPath(),e.arc(n,t,r,0,2*Math.PI),e.fill(),e.stroke()}function o(e){return[e.y,e.x]}function s(e,t,n,r,a,i){var o=e[0],s=e[1],u=t[0],c=t[1];n.beginPath(),n.moveTo(s*i,o*i),n.lineTo(c*i,u*i),n.lineWidth=r,n.strokeStyle=a,n.stroke()}t.drawKeypoints=function(e,t,n,r,o,s,u){void 0===r&&(r=4),void 0===o&&(o="aqua"),void 0===s&&(s=a),void 0===u&&(u=1);for(var c=0;c<e.length;c++){var l=e[c];if(!(l.score<t)){var p=l.position;i(n,p.y*u,p.x*u,r,o,s)}}},t.drawPoint=i,t.toTuple=o,t.drawSkeleton=function(e,t,n,i,u,c){void 0===i&&(i=2),void 0===u&&(u=a),void 0===c&&(c=1),r.getAdjacentKeyPoints(e,t).forEach((function(e){s(o(e[0].position),o(e[1].position),n,i,u,c)}))},t.drawSegment=s},4540:function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var a,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(221),s=n(1461),u={facingMode:"user",frameRate:24},c=function(){function e(e,t,n){void 0===e&&(e=400),void 0===t&&(t=400),void 0===n&&(n=!1),this.width=e,this.height=t,this.flip=n}return e.prototype.getWebcam=function(e){if(void 0===e&&(e={}),!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia)return Promise.reject("Your browser does not support WebRTC. Please try another one.");e.width=640;var t=function(e){return e.facingMode=e.facingMode||u.facingMode,e.frameRate=e.frameRate||u.frameRate,e.aspectRatio=e.aspectRatio||u.aspectRatio,e}(e),n=document.createElement("video");return window.navigator.mediaDevices.getUserMedia({video:t}).then((function(e){return n.srcObject=e,n.addEventListener("loadedmetadata",(function(e){var t=n.videoWidth,r=n.videoHeight;n.width=t,n.height=r})),n}),(function(){return Promise.reject("Could not open your camera. You may have denied access.")}))},e.prototype.setup=function(e){return void 0===e&&(e={}),a(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.webcam?[3,2]:(t=this,[4,this.getWebcam(e)]);case 1:t.webcam=n.sent(),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height),n.label=2;case 2:return[2]}}))}))},e.prototype.play=function(){return this.webcam.play()},e.prototype.pause=function(){this.webcam.pause()},e.prototype.stop=function(){this.stopStreamedVideo(this.webcam)},e.prototype.update=function(){this.renderCameraToCanvas()},e.prototype.stopStreamedVideo=function(e){e.srcObject.getTracks().forEach((function(e){e.stop()})),e.srcObject=null},e.prototype.renderCameraToCanvas=function(){if(this.canvas&&this.webcam){var e=this.canvas.getContext("2d");if(0!==this.webcam.videoWidth){var t=s.cropTo(this.webcam,this.width,this.flip);e.drawImage(t,0,0)}}},r([o.default],e.prototype,"getWebcam",null),r([o.default],e.prototype,"setup",null),r([o.default],e.prototype,"play",null),r([o.default],e.prototype,"pause",null),r([o.default],e.prototype,"stop",null),r([o.default],e.prototype,"update",null),r([o.default],e.prototype,"stopStreamedVideo",null),r([o.default],e.prototype,"renderCameraToCanvas",null),e}();t.Webcam=c},9465:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.version="0.8.6"},4718:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.partNames=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],t.NUM_KEYPOINTS=t.partNames.length,t.partIds=t.partNames.reduce((function(e,t,n){return e[t]=n,e}),{});t.poseChain=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]],t.connectedPartIndices=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((function(e){var n=e[0],r=e[1];return[t.partIds[n],t.partIds[r]]})),t.partChannels=["left_face","right_face","right_upper_leg_front","right_lower_leg_back","right_upper_leg_back","left_lower_leg_front","left_upper_leg_front","left_upper_leg_back","left_lower_leg_back","right_feet","right_lower_leg_front","left_feet","torso_front","torso_back","right_upper_arm_front","right_upper_arm_back","right_lower_arm_back","left_lower_arm_front","left_upper_arm_front","left_upper_arm_back","left_lower_arm_back","right_hand","right_lower_arm_front","left_hand"]},7749:function(e,t,n){"use strict";n.r(t),n.d(t,{MobileNet:function(){return p},PoseNet:function(){return le},decodeMultiplePoses:function(){return D},decodeSinglePose:function(){return z},getAdjacentKeyPoints:function(){return V},getBoundingBox:function(){return j},getBoundingBoxPoints:function(){return H},load:function(){return fe},partChannels:function(){return x},partIds:function(){return g},partNames:function(){return m},poseChain:function(){return y},scaleAndFlipPoses:function(){return ne},scalePose:function(){return K},version:function(){return he}});var r=n(3772),a=n(2652),i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function o(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function u(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var l=function(){function e(e,t){this.model=e,this.outputStride=t;var n=this.model.inputs[0].shape;r.util.assert(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}))}return e.prototype.predict=function(e){var t=this;return(0,r.tidy)((function(){var n=t.preprocessInput((0,r.cast)(e,"float32")),a=(0,r.expandDims)(n,0),i=t.model.predict(a).map((function(e){return(0,r.squeeze)(e,[0])})),o=t.nameOutputResults(i);return{heatmapScores:(0,r.sigmoid)(o.heatmap),offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd}}))},e.prototype.dispose=function(){this.model.dispose()},e}(),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.preprocessInput=function(e){return(0,r.tidy)((function(){return(0,r.sub)((0,r.div)(e,127.5),1)}))},t.prototype.nameOutputResults=function(e){return{offsets:e[0],heatmap:e[1],displacementFwd:e[2],displacementBwd:e[3]}},t}(l);function d(e){return Math.floor(e/2)}var f=function(){function e(e,t){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=t}return e.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},e.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},e.prototype.empty=function(){return-1===this.numberOfElements},e.prototype.size=function(){return this.numberOfElements+1},e.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},e.prototype.max=function(){return this.priorityQueue[0]},e.prototype.swim=function(e){for(;e>0&&this.less(d(e),e);)this.exchange(e,d(e)),e=d(e)},e.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var t=2*e;if(t<this.numberOfElements&&this.less(t,t+1)&&t++,!this.less(e,t))break;this.exchange(e,t),e=t}},e.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},e.prototype.less=function(e,t){return this.getValueAt(e)<this.getValueAt(t)},e.prototype.exchange=function(e,t){var n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[t],this.priorityQueue[t]=n},e}();function h(e,t,n,r,a,i){for(var o=i.shape,s=o[0],u=o[1],c=!0,l=Math.max(n-a,0),p=Math.min(n+a+1,s),d=l;d<p;++d){for(var f=Math.max(r-a,0),h=Math.min(r+a+1,u),m=f;m<h;++m)if(i.get(d,m,e)>t){c=!1;break}if(!c)break}return c}var m=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],v=m.length,g=m.reduce((function(e,t,n){return e[t]=n,e}),{}),y=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]],b=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((function(e){var t=e[0],n=e[1];return[g[t],g[n]]})),x=["left_face","right_face","right_upper_leg_front","right_lower_leg_back","right_upper_leg_back","left_lower_leg_front","left_upper_leg_front","left_upper_leg_back","left_lower_leg_back","right_feet","right_lower_leg_front","left_feet","torso_front","torso_back","right_upper_arm_front","right_upper_arm_back","right_lower_arm_back","left_lower_arm_front","left_upper_arm_front","left_upper_arm_back","left_lower_arm_back","right_hand","right_lower_arm_front","left_hand"];function k(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+v)}}function w(e,t,n){var r=k(e.heatmapY,e.heatmapX,e.id,n),a=r.y,i=r.x;return{x:e.heatmapX*t+i,y:e.heatmapY*t+a}}function S(e,t,n){return e<t?t:e>n?n:e}function I(e,t){return{x:e.x+t.x,y:e.y+t.y}}var N=y.map((function(e){var t=e[0],n=e[1];return[g[t],g[n]]})),T=N.map((function(e){return e[1]})),C=N.map((function(e){return e[0]}));function E(e,t,n,r){return{y:S(Math.round(e.y/t),0,n-1),x:S(Math.round(e.x/t),0,r-1)}}function _(e,t,n,r,a,i,o,s){void 0===s&&(s=2);for(var u=r.shape,c=u[0],l=u[1],p=function(e,t,n){var r=n.shape[2]/2;return{y:n.get(t.y,t.x,e),x:n.get(t.y,t.x,r+e)}}(e,E(t.position,i,c,l),o),d=I(t.position,p),f=0;f<s;f++){var h=E(d,i,c,l),v=k(h.y,h.x,n,a);d=I({x:h.x*i,y:h.y*i},{x:v.x,y:v.y})}var g=E(d,i,c,l),y=r.get(g.y,g.x,n);return{position:d,part:m[n],score:y}}function A(e,t,n,r,a,i){var o=t.shape[2],s=T.length,u=new Array(o),c=e.part,l=e.score,p=w(c,r,n);u[c.id]={score:l,part:m[c.id],position:p};for(var d=s-1;d>=0;--d){var f=T[d],h=C[d];u[f]&&!u[h]&&(u[h]=_(d,u[f],h,t,n,r,i))}for(d=0;d<s;++d)f=C[d],h=T[d],u[f]&&!u[h]&&(u[h]=_(d,u[f],h,t,n,r,a));return u}function R(e,t,n,r){var a=n.x,i=n.y;return e.some((function(e){var n=e.keypoints[r].position;return function(e,t,n,r){var a=n-e,i=r-t;return a*a+i*i}(i,a,n.y,n.x)<=t}))}function F(e,t,n){return n.reduce((function(n,r,a){var i=r.position,o=r.score;return R(e,t,i,a)||(n+=o),n}),0)/n.length}function D(e,t,n,r,a,i,o,s){void 0===o&&(o=.5),void 0===s&&(s=20);for(var u=[],c=function(e,t,n){for(var r=n.shape,a=r[0],i=r[1],o=r[2],s=new f(a*i*o,(function(e){return e.score})),u=0;u<a;++u)for(var c=0;c<i;++c)for(var l=0;l<o;++l){var p=n.get(u,c,l);p<e||h(l,p,u,c,t,n)&&s.enqueue({score:p,part:{heatmapY:u,heatmapX:c,id:l}})}return s}(o,1,e),l=s*s;u.length<i&&!c.empty();){var p=c.dequeue();if(!R(u,l,w(p.part,a,t),p.part.id)){var d=A(p,e,t,a,n,r),m=F(u,l,d);u.push({keypoints:d,score:m})}}return u}function Z(e){var t=e.shape,n=t[0],a=t[1],i=t[2];return(0,r.tidy)((function(){var t=(0,r.reshape)(e,[n*a,i]),o=(0,r.argMax)(t,0),s=(0,r.expandDims)((0,r.div)(o,(0,r.scalar)(a,"int32")),1),u=(0,r.expandDims)(function(e,t){return(0,r.tidy)((function(){var n=(0,r.div)(e,(0,r.scalar)(t,"int32"));return(0,r.sub)(e,(0,r.mul)(n,(0,r.scalar)(t,"int32")))}))}(o,a),1);return(0,r.concat)([s,u],1)}))}function O(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+v)}}function M(e,t,n){return(0,r.tidy)((function(){var a=function(e,t){for(var n=[],a=0;a<v;a++){var i=O(e.get(a,0).valueOf(),e.get(a,1).valueOf(),a,t),o=i.x,s=i.y;n.push(s),n.push(o)}return(0,r.tensor2d)(n,[v,2])}(e,n);return(0,r.add)((0,r.cast)((0,r.mul)(e.toTensor(),(0,r.scalar)(t,"int32")),"float32"),a)}))}function z(e,t,n){return u(this,void 0,void 0,(function(){var r,a,i,o,s,u,l,p,d,f;return c(this,(function(c){switch(c.label){case 0:return r=0,a=Z(e),[4,Promise.all([e.buffer(),t.buffer(),a.buffer()])];case 1:return i=c.sent(),o=i[0],s=i[1],u=i[2],[4,(l=M(u,n,s)).buffer()];case 2:return p=c.sent(),d=Array.from(function(e,t){for(var n=t.shape[0],r=new Float32Array(n),a=0;a<n;a++){var i=t.get(a,0),o=t.get(a,1);r[a]=e.get(i,o,a)}return r}(o,u)),f=d.map((function(e,t){return r+=e,{position:{y:p.get(t,0),x:p.get(t,1)},part:m[t],score:e}})),a.dispose(),l.dispose(),[2,{keypoints:f,score:r/f.length}]}}))}))}var L="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",P="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";var B=[-123.15,-115.9,-103.06],W=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.preprocessInput=function(e){return(0,r.add)(e,B)},t.prototype.nameOutputResults=function(e){var t=e[0],n=e[1];return{offsets:e[2],heatmap:e[3],displacementFwd:t,displacementBwd:n}},t}(l);function V(e,t){return b.reduce((function(n,r){var a=r[0],i=r[1];return function(e,t,n){return e<n||t<n}(e[a].score,e[i].score,t)||n.push([e[a],e[i]]),n}),[])}var U=Number.NEGATIVE_INFINITY,G=Number.POSITIVE_INFINITY;function j(e){return e.reduce((function(e,t){var n=e.maxX,r=e.maxY,a=e.minX,i=e.minY,o=t.position,s=o.x,u=o.y;return{maxX:Math.max(n,s),maxY:Math.max(r,u),minX:Math.min(a,s),minY:Math.min(i,u)}}),{maxX:U,maxY:U,minX:G,minY:G})}function H(e){var t=j(e),n=t.minX,r=t.minY,a=t.maxX,i=t.maxY;return[{x:n,y:r},{x:a,y:r},{x:a,y:i},{x:n,y:i}]}function q(e){return u(this,void 0,void 0,(function(){return c(this,(function(t){return[2,Promise.all(e.map((function(e){return e.buffer()})))]}))}))}function K(e,t,n,r,a){return void 0===r&&(r=0),void 0===a&&(a=0),{score:e.score,keypoints:e.keypoints.map((function(e){var i=e.score,o=e.part,s=e.position;return{score:i,part:o,position:{x:s.x*n+a,y:s.y*t+r}}}))}}function X(e,t){return $(e,t)?e:Math.floor(e/t)*t+1}function Y(e){r.util.assert("number"==typeof e||"object"==typeof e,(function(){return"Invalid inputResolution "+e+". Should be a number or an object with width and height"})),"object"==typeof e&&(r.util.assert("number"==typeof e.width,(function(){return"inputResolution.width has a value of "+e.width+" which is invalid; it must be a number"})),r.util.assert("number"==typeof e.height,(function(){return"inputResolution.height has a value of "+e.height+" which is invalid; it must be a number"})))}function Q(e,t){return Y(e),"object"==typeof e?[X(e.height,t),X(e.width,t)]:[X(e,t),X(e,t)]}var J=[8,16,32];function $(e,t){return(e-1)%t==0}function ee(e){return e instanceof r.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}function te(e,t){var n=t[0],a=t[1],i=ee(e),o=i[0],s=i[1],u=a/n,c=[0,0,0,0],l=c[0],p=c[1],d=c[2],f=c[3];return s/o<u?(l=0,p=0,d=Math.round(.5*(u*o-s)),f=Math.round(.5*(u*o-s))):(l=Math.round(.5*(1/u*s-o)),p=Math.round(.5*(1/u*s-o)),d=0,f=0),{resized:(0,r.tidy)((function(){var t=function(e){return e instanceof r.Tensor?e:r.browser.fromPixels(e)}(e);return t=(0,r.pad3d)(t,[[l,p],[d,f],[0,0]]),r.image.resizeBilinear(t,[n,a])})),padding:{top:l,left:d,right:f,bottom:p}}}function ne(e,t,n,r,a){var i=t[0],o=t[1],s=n[0],u=n[1],c=function(e,t,n,r,a){return void 0===r&&(r=0),void 0===a&&(a=0),1===n&&1===t&&0===r&&0===a?e:e.map((function(e){return K(e,t,n,r,a)}))}(e,(i+r.top+r.bottom)/s,(o+r.left+r.right)/u,-r.top,-r.left);return a?function(e,t){return t<=0?e:e.map((function(e){return function(e,t){return{score:e.score,keypoints:e.keypoints.map((function(e){var n=e.score,r=e.part,a=e.position;return{score:n,part:r,position:{x:t-1-a.x,y:a.y}}}))}}(e,t)}))}(c,o):c}var re={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:257},ae=["MobileNetV1","ResNet50"],ie={MobileNetV1:[8,16,32],ResNet50:[32,16]},oe={MobileNetV1:[.5,.75,1],ResNet50:[1]},se=[1,2,4];var ue={flipHorizontal:!1},ce={flipHorizontal:!1,maxDetections:5,scoreThreshold:.5,nmsRadius:20};var le=function(){function e(e,t){(function(e){r.util.assert("number"==typeof e,(function(){return"outputStride is not a number"})),r.util.assert(J.indexOf(e)>=0,(function(){return"outputStride of "+e+" is invalid. It must be either 8, 16, or 32"}))})(e.outputStride),function(e,t){r.util.assert("number"==typeof e[0]&&"number"==typeof e[1],(function(){return"both resolution values must be a number but had values "+e})),r.util.assert($(e[0],t),(function(){return"height of "+e[0]+" is invalid for output stride "+t+"."})),r.util.assert($(e[1],t),(function(){return"width of "+e[1]+" is invalid for output stride "+t+"."}))}(t,e.outputStride),this.baseModel=e,this.inputResolution=t}return e.prototype.estimateMultiplePoses=function(e,t){return void 0===t&&(t=ce),u(this,void 0,void 0,(function(){var n,r,a,i,o,u,l,p,d,f,h,m,v,g,y,b,x,k,w,S,I;return c(this,(function(c){switch(c.label){case 0:return n=s({},ce,t),function(e){var t=e.maxDetections,n=e.scoreThreshold,r=e.nmsRadius;if(t<=0)throw new Error("Invalid maxDetections "+t+". Should be > 0");if(n<0||n>1)throw new Error("Invalid scoreThreshold "+n+". Should be in range [0.0, 1.0]");if(r<=0)throw new Error("Invalid nmsRadius "+r+".")}(t),r=this.baseModel.outputStride,a=this.inputResolution,i=ee(e),o=i[0],u=i[1],l=te(e,a),p=l.resized,d=l.padding,f=this.baseModel.predict(p),h=f.heatmapScores,m=f.offsets,v=f.displacementFwd,g=f.displacementBwd,[4,q([h,m,v,g])];case 1:return y=c.sent(),b=y[0],x=y[1],k=y[2],w=y[3],[4,D(b,x,k,w,r,n.maxDetections,n.scoreThreshold,n.nmsRadius)];case 2:return S=c.sent(),I=ne(S,[o,u],a,d,n.flipHorizontal),h.dispose(),m.dispose(),v.dispose(),g.dispose(),p.dispose(),[2,I]}}))}))},e.prototype.estimateSinglePose=function(e,t){return void 0===t&&(t=ue),u(this,void 0,void 0,(function(){var n,r,a,i,o,u,l,p,d,f,h,m,v,g,y,b;return c(this,(function(c){switch(c.label){case 0:return n=s({},ue,t),r=this.baseModel.outputStride,a=this.inputResolution,i=ee(e),o=i[0],u=i[1],l=te(e,a),p=l.resized,d=l.padding,f=this.baseModel.predict(p),h=f.heatmapScores,m=f.offsets,v=f.displacementFwd,g=f.displacementBwd,[4,z(h,m,r)];case 1:return y=c.sent(),b=ne([y],[o,u],a,d,n.flipHorizontal),h.dispose(),m.dispose(),v.dispose(),g.dispose(),p.dispose(),[2,b[0]]}}))}))},e.prototype.estimatePoses=function(e,t){return u(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return"single-person"!==t.decodingMethod?[3,2]:[4,this.estimateSinglePose(e,t)];case 1:return[2,[n.sent()]];case 2:return[2,this.estimateMultiplePoses(e,t)]}}))}))},e.prototype.dispose=function(){this.baseModel.dispose()},e}();function pe(e){return u(this,void 0,void 0,(function(){var t,n,i,o,s,u,l;return c(this,(function(c){switch(c.label){case 0:if(t=e.outputStride,n=e.quantBytes,i=e.multiplier,null==r)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return o=function(e,t,n){var r={1:"100",.75:"075",.5:"050"},a="model-stride"+e+".json";return 4===n?L+"float/"+r[t]+"/"+a:L+"quant"+n+"/"+r[t]+"/"+a}(t,i,n),[4,(0,a.YL)(e.modelUrl||o)];case 1:return s=c.sent(),u=new p(s,t),l=Q(e.inputResolution,u.outputStride),[2,new le(u,l)]}}))}))}function de(e){return u(this,void 0,void 0,(function(){var t,n,i,o,s,u;return c(this,(function(c){switch(c.label){case 0:if(t=e.outputStride,n=e.quantBytes,null==r)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this\n        model.");return i=function(e,t){var n="model-stride"+e+".json";return 4===t?P+"float/"+n:P+"quant"+t+"/"+n}(t,n),[4,(0,a.YL)(e.modelUrl||i)];case 1:return o=c.sent(),s=new W(o,t),u=Q(e.inputResolution,s.outputStride),[2,new le(s,u)]}}))}))}function fe(e){return void 0===e&&(e=re),u(this,void 0,void 0,(function(){return c(this,(function(t){return"ResNet50"===(e=function(e){if(null==(e=e||re).architecture&&(e.architecture="MobileNetV1"),ae.indexOf(e.architecture)<0)throw new Error("Invalid architecture "+e.architecture+". Should be one of "+ae);if(null==e.inputResolution&&(e.inputResolution=257),Y(e.inputResolution),null==e.outputStride&&(e.outputStride=16),ie[e.architecture].indexOf(e.outputStride)<0)throw new Error("Invalid outputStride "+e.outputStride+". Should be one of "+ie[e.architecture]+" for architecture "+e.architecture+".");if(null==e.multiplier&&(e.multiplier=1),oe[e.architecture].indexOf(e.multiplier)<0)throw new Error("Invalid multiplier "+e.multiplier+". Should be one of "+oe[e.architecture]+" for architecture "+e.architecture+".");if(null==e.quantBytes&&(e.quantBytes=4),se.indexOf(e.quantBytes)<0)throw new Error("Invalid quantBytes "+e.quantBytes+". Should be one of "+se+" for architecture "+e.architecture+".");if("MobileNetV1"===e.architecture&&32===e.outputStride&&1!==e.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return e}(e)).architecture?[2,de(e)]:"MobileNetV1"===e.architecture?[2,pe(e)]:[2,null]}))}))}var he="2.2.2"},7202:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){e.done?a(e.value):new n((function(t){t(e.value)})).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3772),o=n(4718);t.getAdjacentKeyPoints=function(e,t){return o.connectedPartIndices.reduce((function(n,r){var a=r[0],i=r[1];return function(e,t,n){return e<n||t<n}(e[a].score,e[i].score,t)||n.push([e[a],e[i]]),n}),[])};var s=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY;function c(e){return e.reduce((function(e,t){var n=e.maxX,r=e.maxY,a=e.minX,i=e.minY,o=t.position,s=o.x,u=o.y;return{maxX:Math.max(n,s),maxY:Math.max(r,u),minX:Math.min(a,s),minY:Math.min(i,u)}}),{maxX:s,maxY:s,minX:u,minY:u})}function l(e,t,n,r,a){return void 0===r&&(r=0),void 0===a&&(a=0),{score:e.score,keypoints:e.keypoints.map((function(e){var i=e.score,o=e.part,s=e.position;return{score:i,part:o,position:{x:s.x*n+a,y:s.y*t+r}}}))}}function p(e,t,n,r,a){return void 0===r&&(r=0),void 0===a&&(a=0),1===n&&1===t&&0===r&&0===a?e:e.map((function(e){return l(e,t,n,r,a)}))}function d(e,t){return{score:e.score,keypoints:e.keypoints.map((function(e){var n=e.score,r=e.part,a=e.position;return{score:n,part:r,position:{x:t-1-a.x,y:a.y}}}))}}function f(e,t){return t<=0?e:e.map((function(e){return d(e,t)}))}function h(e,t){return g(e,t)?e:Math.floor(e/t)*t+1}function m(e){i.util.assert("number"===typeof e||"object"===typeof e,(function(){return"Invalid inputResolution "+e+". Should be a number or an object with width and height"})),"object"===typeof e&&(i.util.assert("number"===typeof e.width,(function(){return"inputResolution.width has a value of "+e.width+" which is invalid; it must be a number"})),i.util.assert("number"===typeof e.height,(function(){return"inputResolution.height has a value of "+e.height+" which is invalid; it must be a number"})))}t.getBoundingBox=c,t.getBoundingBoxPoints=function(e){var t=c(e),n=t.minX,r=t.minY,a=t.maxX,i=t.maxY;return[{x:n,y:r},{x:a,y:r},{x:a,y:i},{x:n,y:i}]},t.toTensorBuffers3D=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){return[2,Promise.all(e.map((function(e){return e.buffer()})))]}))}))},t.scalePose=l,t.scalePoses=p,t.flipPoseHorizontal=d,t.flipPosesHorizontal=f,t.toValidInputResolution=h,t.validateInputResolution=m,t.getValidInputResolutionDimensions=function(e,t){return m(e),"object"===typeof e?[h(e.height,t),h(e.width,t)]:[h(e,t),h(e,t)]};var v=[8,16,32];function g(e,t){return(e-1)%t===0}function y(e){return e instanceof i.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}function b(e){return e instanceof i.Tensor?e:i.browser.fromPixels(e)}t.assertValidOutputStride=function(e){i.util.assert("number"===typeof e,(function(){return"outputStride is not a number"})),i.util.assert(v.indexOf(e)>=0,(function(){return"outputStride of "+e+" is invalid. It must be either 8, 16, or 32"}))},t.assertValidResolution=function(e,t){i.util.assert("number"===typeof e[0]&&"number"===typeof e[1],(function(){return"both resolution values must be a number but had values "+e})),i.util.assert(g(e[0],t),(function(){return"height of "+e[0]+" is invalid for output stride "+t+"."})),i.util.assert(g(e[1],t),(function(){return"width of "+e[1]+" is invalid for output stride "+t+"."}))},t.getInputTensorDimensions=y,t.toInputTensor=b,t.toResizedInputTensor=function(e,t,n,r){return i.tidy((function(){var a=b(e);return r?i.image.resizeBilinear(i.reverse(a,1),[t,n]):i.image.resizeBilinear(a,[t,n])}))},t.padAndResizeTo=function(e,t){var n=t[0],r=t[1],a=y(e),o=a[0],s=a[1],u=r/n,c=[0,0,0,0],l=c[0],p=c[1],d=c[2],f=c[3];return s/o<u?(l=0,p=0,d=Math.round(.5*(u*o-s)),f=Math.round(.5*(u*o-s))):(l=Math.round(.5*(1/u*s-o)),p=Math.round(.5*(1/u*s-o)),d=0,f=0),{resized:i.tidy((function(){var t=b(e);return t=i.pad3d(t,[[l,p],[d,f],[0,0]]),i.image.resizeBilinear(t,[n,r])})),padding:{top:l,left:d,right:f,bottom:p}}},t.scaleAndFlipPoses=function(e,t,n,r,a){var i=t[0],o=t[1],s=n[0],u=n[1],c=p(e,(i+r.top+r.bottom)/s,(o+r.left+r.right)/u,-r.top,-r.left);return a?f(c,o):c}},2652:function(e,t,n){"use strict";n.d(t,{g_:function(){return mt},Ue:function(){return O},YL:function(){return vt},fM:function(){return yt},iw:function(){return D},gJ:function(){return xt}});var r={};n.r(r),n.d(r,{json:function(){return U}});var a={};n.r(a),n.d(a,{json:function(){return G}});var i={};n.r(i),n.d(i,{json:function(){return j}});var o={};n.r(o),n.d(o,{json:function(){return H}});var s={};n.r(s),n.d(s,{json:function(){return q}});var u={};n.r(u),n.d(u,{json:function(){return K}});var c={};n.r(c),n.d(c,{json:function(){return X}});var l={};n.r(l),n.d(l,{json:function(){return Y}});var p={};n.r(p),n.d(p,{json:function(){return Q}});var d={};n.r(d),n.d(d,{json:function(){return J}});var f={};n.r(f),n.d(f,{json:function(){return $}});var h={};n.r(h),n.d(h,{json:function(){return ee}});var m={};n.r(m),n.d(m,{json:function(){return te}});var v={};n.r(v),n.d(v,{json:function(){return ne}});var g={};n.r(g),n.d(g,{json:function(){return re}});var y={};n.r(y),n.d(y,{json:function(){return ae}});var b={};n.r(b),n.d(b,{json:function(){return ie}});var x={};n.r(x),n.d(x,{json:function(){return oe}});var k={};n.r(k),n.d(k,{json:function(){return se}});var w={};n.r(w),n.d(w,{OP_SCOPE_SUFFIX:function(){return Ie.zvA},abs:function(){return Ie.WnP},acos:function(){return Ie.Khb},acosh:function(){return Ie.__u},add:function(){return Ie.IHx},addN:function(){return Ie.QBD},all:function(){return Ie.$6P},any:function(){return Ie.YjB},argMax:function(){return Ie.NqF},argMin:function(){return Ie.vHJ},asin:function(){return Ie.ZRM},asinh:function(){return Ie.VfV},atan:function(){return Ie.z4N},atan2:function(){return Ie.fvJ},atanh:function(){return Ie.C80},avgPool:function(){return Ie.wS1},avgPool3d:function(){return Ie.uR5},basicLSTMCell:function(){return Ie.zEQ},batchNorm:function(){return Ie.tgs},batchNorm2d:function(){return Ie.Dxk},batchNorm3d:function(){return Ie.JY5},batchNorm4d:function(){return Ie.p3b},batchToSpaceND:function(){return Ie.E4h},bincount:function(){return Ie.yE8},booleanMaskAsync:function(){return Ie.anm},broadcastArgs:function(){return Ie.XsQ},broadcastTo:function(){return Ie.UFq},buffer:function(){return Ie.f3b},cast:function(){return Ie.pju},ceil:function(){return Ie.mDi},clipByValue:function(){return Ie.iUl},clone:function(){return Ie.d9v},complex:function(){return Ie.PYB},concat:function(){return Ie.zoF},concat1d:function(){return Ie.gME},concat2d:function(){return Ie.Izb},concat3d:function(){return Ie.MNy},concat4d:function(){return Ie.ZaL},conv1d:function(){return Ie.PAt},conv2d:function(){return Ie.Tek},conv2dTranspose:function(){return Ie.bc},conv3d:function(){return Ie.pdZ},conv3dTranspose:function(){return Ie.$QV},cos:function(){return Ie.mCk},cosh:function(){return Ie.f9Y},cosineWindow:function(){return Ie.mew},cumprod:function(){return Ie.$Gn},cumsum:function(){return Ie.zbp},denseBincount:function(){return Ie.ppE},depthToSpace:function(){return Ie.nTT},depthwiseConv2d:function(){return Ie.B10},diag:function(){return Ie.Ka3},dilation2d:function(){return Ie.WmZ},div:function(){return Ie.hiC},divNoNan:function(){return Ie.NTj},dot:function(){return Ie.AKD},dropout:function(){return Ie.rvX},einsum:function(){return Ie.WYO},elu:function(){return Ie.pyx},enclosingPowerOfTwo:function(){return Ie.GRh},equal:function(){return Ie.DgJ},erf:function(){return Ie.qNN},euclideanNorm:function(){return Ie.d2q},exp:function(){return Ie.Qqt},expandDims:function(){return Ie.dt4},expm1:function(){return Ie.t$B},eye:function(){return Ie.iyy},fft:function(){return Ie.kp_},fill:function(){return Ie.hlL},floor:function(){return Ie.GWj},floorDiv:function(){return Ie.qPi},fused:function(){return Ie.imm},gather:function(){return Ie.Iqj},gatherND:function(){return Ie.dbB},greater:function(){return Ie.pjt},greaterEqual:function(){return Ie.brS},ifft:function(){return Ie.Sxn},imag:function(){return Ie.asL},image:function(){return Ie.BHj},inTopKAsync:function(){return Ie.V3u},irfft:function(){return Ie.wx0},isFinite:function(){return Ie.xVT},isInf:function(){return Ie.UWc},isNaN:function(){return Ie.i2d},leakyRelu:function(){return Ie.hi7},less:function(){return Ie.d9m},lessEqual:function(){return Ie.zN1},linalg:function(){return Ie.$r2},linspace:function(){return Ie.SX3},localResponseNormalization:function(){return Ie.G9k},log:function(){return Ie.cM7},log1p:function(){return Ie.Krr},logSigmoid:function(){return Ie.e_t},logSoftmax:function(){return Ie.CmS},logSumExp:function(){return Ie.l_t},logicalAnd:function(){return Ie.HvI},logicalNot:function(){return Ie.hJK},logicalOr:function(){return Ie.K5V},logicalXor:function(){return Ie.egP},losses:function(){return Ie.MB5},lowerBound:function(){return Ie.eab},matMul:function(){return Ie.OI3},max:function(){return Ie.Fp7},maxPool:function(){return Ie._sB},maxPool3d:function(){return Ie.YQQ},maxPoolWithArgmax:function(){return Ie.Ip$},maximum:function(){return Ie.gWQ},mean:function(){return Ie.J69},meshgrid:function(){return Ie.ry_},min:function(){return Ie.VV$},minimum:function(){return Ie.LTh},mirrorPad:function(){return Ie.VdP},mod:function(){return Ie.wQq},moments:function(){return Ie.Gi7},movingAverage:function(){return Ie.p_},mul:function(){return Ie.dC7},multiRNNCell:function(){return Ie.rq4},multinomial:function(){return Ie.SJ_},neg:function(){return Ie.W76},norm:function(){return Ie.KOy},notEqual:function(){return Ie.Quu},oneHot:function(){return Ie.lfX},ones:function(){return Ie.iUs},onesLike:function(){return Ie.JpU},op:function(){return Ie.op},outerProduct:function(){return Ie.N2O},pad:function(){return Ie.vku},pad1d:function(){return Ie.pNR},pad2d:function(){return Ie.koy},pad3d:function(){return Ie.t1L},pad4d:function(){return Ie.lGY},pool:function(){return Ie.d_R},pow:function(){return Ie.sQ3},prelu:function(){return Ie.AL3},print:function(){return Ie.S0v},prod:function(){return Ie.WVs},rand:function(){return Ie.TN_},randomGamma:function(){return Ie.wzB},randomNormal:function(){return Ie.nGf},randomStandardNormal:function(){return Ie.ruB},randomUniform:function(){return Ie.LGj},range:function(){return Ie.w6H},real:function(){return Ie.kwC},reciprocal:function(){return Ie.M25},relu:function(){return Ie.UYe},relu6:function(){return Ie.btT},reshape:function(){return Ie.XLQ},reverse:function(){return Ie.GYS},reverse1d:function(){return Ie.SDf},reverse2d:function(){return Ie.diP},reverse3d:function(){return Ie.sx7},reverse4d:function(){return Ie.mG2},rfft:function(){return Ie.QEs},round:function(){return Ie.NMM},rsqrt:function(){return Ie.bp0},scalar:function(){return Ie.iD$},scatterND:function(){return Ie.snQ},searchSorted:function(){return Ie.zcT},selu:function(){return Ie.U8D},separableConv2d:function(){return Ie.U_I},setdiff1dAsync:function(){return Ie.ODp},sigmoid:function(){return Ie.XD2},sign:function(){return Ie.Xxe},signal:function(){return Ie.tdS},sin:function(){return Ie.O$l},sinh:function(){return Ie.R_K},slice:function(){return Ie.tPi},slice1d:function(){return Ie.jZU},slice2d:function(){return Ie.SmN},slice3d:function(){return Ie.CnO},slice4d:function(){return Ie.p0P},softmax:function(){return Ie.XAC},softplus:function(){return Ie.Wvh},spaceToBatchND:function(){return Ie.fBT},sparse:function(){return Ie.rVs},sparseToDense:function(){return Ie.ers},spectral:function(){return Ie.uN7},split:function(){return Ie.Vl2},sqrt:function(){return Ie._b3},square:function(){return Ie.h62},squaredDifference:function(){return Ie.$i},squeeze:function(){return Ie.L9e},stack:function(){return Ie.knu},step:function(){return Ie.Nbs},stridedSlice:function(){return Ie.NXj},string:function(){return Ie.Z_8},sub:function(){return Ie.luU},sum:function(){return Ie.Smz},tan:function(){return Ie.ORZ},tanh:function(){return Ie.AEp},tensor:function(){return Ie.XeE},tensor1d:function(){return Ie.RRF},tensor2d:function(){return Ie.odF},tensor3d:function(){return Ie.wOQ},tensor4d:function(){return Ie.yXz},tensor5d:function(){return Ie.Bfx},tensor6d:function(){return Ie.xZs},tile:function(){return Ie.Gg6},topk:function(){return Ie.hg7},transpose:function(){return Ie.p4s},truncatedNormal:function(){return Ie.Xu6},unique:function(){return Ie.Two},unsortedSegmentSum:function(){return Ie.pUJ},unstack:function(){return Ie.HHK},upperBound:function(){return Ie.GaM},variable:function(){return Ie.VD$},where:function(){return Ie.arb},whereAsync:function(){return Ie.itS},zeros:function(){return Ie.lls},zerosLike:function(){return Ie.P84}});var S=n(3772);(0,S.env)().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")}));var I,N,T=n(4165),C=n(5861),E=n(5671),_=n(3144),A=n(9439),R=n(3433);!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(I||(I={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(N||(N={}));var F={};function D(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};F[e]=n}function Z(e){return F[e]}function O(e){delete F[e]}function M(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd;if("tensor"===i.type)return z(t.inputNames[i.inputIndexStart],n,r,a);if("tensors"===i.type)return t.inputNames.slice(o,s).map((function(e){return z(e,n,r,a)}));var u=z(t.inputNames.slice(o)[0],n,r,a),c=u.dataSync();return"number"===i.type?c[0]:S.util.toNestedArray(u.shape,c)}var l=t.attrParams[e];return l&&l.value}function z(e,t,n,r){var a=B(e),i=(0,A.Z)(a,2),o=i[0],s=i[1];if(null!=r){var u=r.getHashTableHandleByName(o);if(null!=u)return u}var c=n.currentContextIds.find((function(e){return!!t[P(o,e)]}));return void 0!==c?t[P(o,c)][s]:void 0}function L(e,t){var n=B(e),r=(0,A.Z)(n,3),a=r[0],i=r[1],o=r[2];return[P(a,t&&t.currentContextId),i,o]}function P(e,t){return t?"".concat(e,"-").concat(t):e}function B(e){var t=e.split(":");if(1===t.length)return[e,0,void 0];var n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function W(e,t,n){var r=M("pad",e,t,n);if("explicit"===r){r=M("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function V(e){return e.kept?e:(0,S.clone)(e)}var U=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],G=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],j=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],H=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],q=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],K=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],X=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Y=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Q=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],J=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],$=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],ee=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],te=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],ne=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],re=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],ae=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],ie=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],oe=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],se=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],ue=function(){function e(){var t;(0,E.Z)(this,e);var n=[r,a,i,o,s,u,c,l,p,d,f,h,m,v,g,y,b,x,k],w=(t=[]).concat.apply(t,(0,R.Z)(n.map((function(e){return e.json}))));this.opMappers=w.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return(0,_.Z)(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],i=[],o=[],s=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):null!=n.input&&0!==n.input.length||o.push(e[n.name]),e}),{}),u=[],c=[],l={},p={};null!=n&&(l=this.mapSignatureEntries(n.inputs),p=this.mapSignatureEntries(n.outputs));var d=Object.keys(s);d.forEach((function(e){var t=s[e];t.inputNames.forEach((function(e,n){var r=L(e),a=(0,A.Z)(r,3),i=a[0],o=a[2],u=s[i];if(null!=u.outputs){var c=u.outputs.indexOf(o);if(-1!==c){var l="".concat(i,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))})),0===Object.keys(p).length?d.forEach((function(e){var t=s[e];0===t.children.length&&c.push(t)})):Object.keys(p).forEach((function(e){var t=L(e),n=(0,A.Z)(t,1)[0],r=s[n];null!=r&&(r.signatureKey=p[e],c.push(r))})),Object.keys(l).length>0?Object.keys(l).forEach((function(e){var t=L(e),n=(0,A.Z)(t,1)[0],r=s[n];r&&(r.signatureKey=l[e],u.push(r))})):u=a;var f={};null!=e.library&&null!=e.library.function&&(f=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var h={nodes:s,inputs:u,outputs:c,weights:i,placeholders:a,signature:n,functions:f};return o.length>0&&(h.initNodes=o),h}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=Z(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,a=void 0;switch(n.type){case"string":void 0===(a=le(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=le(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(a=xe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=xe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(a=de(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(a=de(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(a=be(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=be(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(a=pe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=pe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(a=we(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=we(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(a=ye(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ye(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(a=ke(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ke(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(a=me(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=me(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(a=ve(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ve(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(a=he(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=he(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:a,type:r},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=L(e.name),n=(0,A.Z)(t,1)[0],r={name:n,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:fe(e.type),type:"dtype"}},children:[]};r.signatureKey=e.name,i.push(r),a[n]=r})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=L(e),i=(0,A.Z)(r,3),o=i[0],s=i[2],u=a[o];if(null!=u.outputs){var c=u.outputs.indexOf(s);if(-1!==c){var l="".concat(o,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=L(s[e.name]),n=(0,A.Z)(t,2),r=n[0],i=n[1],u=a[r];null!=u&&(u.defaultOutput=i,o.push(u))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function ce(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=(0,S.env)().global;if("undefined"!==typeof t.atob)return t.atob(e);if("undefined"!==typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function le(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?ce(a.s,r):n}function pe(e,t,n){var r=e[t];return r?r.b:n}function de(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"===typeof a?a:parseInt(a,10)}function fe(e){switch("string"===typeof e&&(e=I[e]),e){case I.DT_FLOAT:case I.DT_HALF:return"float32";case I.DT_INT32:case I.DT_INT64:case I.DT_INT8:case I.DT_UINT8:return"int32";case I.DT_BOOL:return"bool";case I.DT_DOUBLE:return"float32";case I.DT_STRING:return"string";default:return null}}function he(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function me(e,t,n){var r=e[t];return r&&r.type?fe(r.type):n}function ve(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return fe(e)})):n}function ge(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"===typeof e.size?e.size:parseInt(e.size,10)})):[]}function ye(e,t,n){var r=e[t];return r&&r.shape?ge(r.shape):n}function be(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"===typeof e?e:parseInt(e,10)})):n}function xe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return ce(e,r)})):n}function ke(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return ge(e)})):n}function we(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var Se=function(){function e(t,n,r){var a=this;(0,E.Z)(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return(0,_.Z)(e,[{key:"getInput",value:function(e){return z(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return z(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return de(this.node.rawAttrs,e,t);if(null!=n.s)return le(this.node.rawAttrs,e,t);if(null!=n.b)return pe(this.node.rawAttrs,e,t);if(null!=n.shape)return ye(this.node.rawAttrs,e,t);if(null!=n.type)return me(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return be(this.node.rawAttrs,e,t);if(null!=n.list.s)return xe(this.node.rawAttrs,e,t);if(null!=n.list.shape)return ke(this.node.rawAttrs,e,t);if(null!=n.list.b)return we(this.node.rawAttrs,e,t);if(null!=n.list.type)return ve(this.node.rawAttrs,e,t)}return t}}]),e}(),Ie=n(4348),Ne=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(M("a",e,t,n),M("b",e,t,n))];case"AddN":return[r.addN(M("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(M("a",e,t,n),M("b",e,t,n))];case"Mul":return[r.mul(M("a",e,t,n),M("b",e,t,n))];case"RealDiv":case"Div":return[r.div(M("a",e,t,n),M("b",e,t,n))];case"DivNoNan":return[r.divNoNan(M("a",e,t,n),M("b",e,t,n))];case"FloorDiv":return[r.floorDiv(M("a",e,t,n),M("b",e,t,n))];case"Sub":return[r.sub(M("a",e,t,n),M("b",e,t,n))];case"Minimum":return[r.minimum(M("a",e,t,n),M("b",e,t,n))];case"Maximum":return[r.maximum(M("a",e,t,n),M("b",e,t,n))];case"Pow":return[r.pow(M("a",e,t,n),M("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(M("a",e,t,n),M("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Te=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(M("x",e,t,n))];case"Acos":return[r.acos(M("x",e,t,n))];case"Acosh":return[r.acosh(M("x",e,t,n))];case"Asin":return[r.asin(M("x",e,t,n))];case"Asinh":return[r.asinh(M("x",e,t,n))];case"Atan":return[r.atan(M("x",e,t,n))];case"Atan2":return[r.atan2(M("x",e,t,n),M("y",e,t,n))];case"Atanh":return[r.atanh(M("x",e,t,n))];case"Ceil":return[r.ceil(M("x",e,t,n))];case"Complex":return[r.complex(M("real",e,t,n),M("imag",e,t,n))];case"Cos":return[r.cos(M("x",e,t,n))];case"Cosh":return[r.cosh(M("x",e,t,n))];case"Elu":return[r.elu(M("x",e,t,n))];case"Erf":return[r.erf(M("x",e,t,n))];case"Exp":return[r.exp(M("x",e,t,n))];case"Expm1":return[r.expm1(M("x",e,t,n))];case"Floor":return[r.floor(M("x",e,t,n))];case"Log":return[r.log(M("x",e,t,n))];case"Log1p":return[r.log1p(M("x",e,t,n))];case"Imag":return[r.imag(M("x",e,t,n))];case"Neg":return[r.neg(M("x",e,t,n))];case"Reciprocal":return[r.reciprocal(M("x",e,t,n))];case"Real":return[r.real(M("x",e,t,n))];case"Relu":return[r.relu(M("x",e,t,n))];case"Round":return[r.round(M("x",e,t,n))];case"Selu":return[r.selu(M("x",e,t,n))];case"Sigmoid":return[r.sigmoid(M("x",e,t,n))];case"Sin":return[r.sin(M("x",e,t,n))];case"Sign":return[r.sign(M("x",e,t,n))];case"Sinh":return[r.sinh(M("x",e,t,n))];case"Softplus":return[r.softplus(M("x",e,t,n))];case"Sqrt":return[r.sqrt(M("x",e,t,n))];case"Square":return[r.square(M("x",e,t,n))];case"Tanh":return[r.tanh(M("x",e,t,n))];case"Tan":return[r.tan(M("x",e,t,n))];case"ClipByValue":return[r.clipByValue(M("x",e,t,n),M("clipValueMin",e,t,n),M("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(M("x",e,t,n))];case"Rsqrt":return[r.rsqrt(z(e.inputNames[0],t,n))];case"Prod":return[r.prod(M("x",e,t,n),M("axes",e,t,n))];case"LeakyRelu":return[r.leakyRelu(M("x",e,t,n),M("alpha",e,t,n))];case"Prelu":return[r.prelu(M("x",e,t,n),M("alpha",e,t,n))];case"IsNan":return[r.isNaN(z(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function Ce(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!==typeof e&&"number"!==typeof t){S.util.assert(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],i=t[r];S.util.assert(a<0||i<0||a===i,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function Ee(e){return"number"!==typeof e&&!e.some((function(e){return e<0}))}function _e(e,t,n){var r=Ae(e,n),a=!Ee(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=Ae(e.shape,r)})),!Ee(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function Ae(e,t){if("number"===typeof e)return t;if("number"===typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var Re=function(){function e(t,n,r,a,i,o,s){(0,E.Z)(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=(0,S.scalar)(0),(0,S.keep)(this.idTensor)}return(0,_.Z)(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),Ce(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,(0,S.keep)(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return(0,S.tensor)([],[0].concat(this.elementShape));var r=this.readMany(e);return Ce(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),(0,S.stack)(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return(0,S.tensor)([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return Ce(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),(0,S.concat)(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,(0,R.Z)(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,(0,S.unstack)(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var i=0===r?0:t.size/r,o=[];(0,S.tidy)((function(){t=(0,S.reshape)(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=(0,S.reshape)((0,S.slice)(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),Fe=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;(0,E.Z)(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));Ce(n,e.shape,"TensorList shape mismatch: "),(0,S.keep)(e)})),this.idTensor=(0,S.scalar)(0),this.maxNumElements=a,(0,S.keep)(this.idTensor)}return(0,_.Z)(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e((0,R.Z)(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));Ce(e,this.elementShape,"TensorList shape mismatch: ");var a=_e(this.elementShape,this.tensors,e);return(0,S.tidy)((function(){var e=n.tensors.map((function(e){return(0,S.reshape)(e,a)}));return(0,S.stack)(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=_e(this.elementShape,this.tensors,e),r=this.tensors.pop();return Ce(r.shape,e,"TensorList shape mismatch: "),(0,S.reshape)(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(Ce(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");(0,S.keep)(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));Ce(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=_e(this.elementShape,this.tensors,t);return(0,S.reshape)(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));Ce(this.elementShape,t.shape,"TensorList shape mismatch: "),(0,S.keep)(t),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));Ce(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=_e(this.elementShape,this.tensors,n);return 0===e.length?(0,S.tensor)([],[0].concat(a)):(0,S.tidy)((function(){var t=e.map((function(e){return(0,S.reshape)(r.tensors[e],a)}));return(0,S.stack)(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));Ce(this.elementShape,t,"TensorList shape mismatch: ");var r=_e(this.elementShape,this.tensors,t);return 0===this.size()?(0,S.tensor)([],[0].concat(r)):(0,S.tidy)((function(){var e=n.tensors.map((function(e){return(0,S.reshape)(e,r)}));return(0,S.concat)(e,0)}))}}]),e}();function De(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));Ce(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=(0,S.unstack)(e);return new Fe(a,t,r)}function Ze(e,t,n,r){return new Fe([],e,t,r)}function Oe(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,(0,R.Z)(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new Fe([],n,e.dtype,r),o=(0,S.unstack)(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function Me(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=Ae(e.shape.slice(1),n),o=0===r?0:e.size/r,s=(0,S.tidy)((function(){var n=[];e=(0,S.reshape)(e,[1,r,o]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],o];n[s]=(0,S.reshape)((0,S.slice)(e,u,c),i)}return e.dispose(),n})),u=new Fe([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}var ze=function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,f,h,m,v,g,y,b,x,k,w,I,N,C,E,_,A,R,F,D,Z,O,L,P,B,W,U,G,j,H,q,K,X,Y,Q,J,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,pe,de,fe,he,me,ve,ge,ye,be,xe,ke,we,Se,Ie,Ne,Te,Ce,Ee,_e,Ae,Fe,ze,Le,Pe,Be,We,Ve,Ue,Ge,je,He,qe,Ke,Xe,Ye,Qe,Je,$e,et,tt,nt,rt,at,it,ot,st,ut;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?15:"LoopCond"===e.t0?19:"Switch"===e.t0?21:"Merge"===e.t0?32:"Enter"===e.t0?37:"Exit"===e.t0?41:"NextIteration"===e.t0?44:"TensorArrayV3"===e.t0?47:"TensorArrayWriteV3"===e.t0?57:"TensorArrayReadV3"===e.t0?63:"TensorArrayGatherV3"===e.t0?67:"TensorArrayScatterV3"===e.t0?72:"TensorArrayConcatV3"===e.t0?78:"TensorArraySplitV3"===e.t0?82:"TensorArraySizeV3"===e.t0?88:"TensorArrayCloseV3"===e.t0?91:"TensorListSetItem"===e.t0?95:"TensorListGetItem"===e.t0?101:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?107:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?114:"TensorListGather"===e.t0?122:"TensorListStack"===e.t0?128:"TensorListFromTensor"===e.t0?134:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?140:"TensorListPushBack"===e.t0?145:"TensorListPopBack"===e.t0?150:"TensorListSplit"===e.t0?155:"TensorListLength"===e.t0?161:"TensorListResize"===e.t0?164:170;break;case 3:return a=M("thenBranch",t,n,r),i=M("elseBranch",t,n,r),o=M("cond",t,n,r),s=M("args",t,n,r),e.next=9,o.data();case 9:if(!e.sent[0]){e.next=14;break}return e.abrupt("return",r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap));case 14:return e.abrupt("return",r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap));case 15:return e.delegateYield((0,T.Z)().mark((function e(){var a,i,o,s,u,c,l,p;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=M("body",t,n,r),i=M("cond",t,n,r),o=M("args",t,n,r),e.next=5,r.functionMap[i].executeFunctionAsync(o,r.tensorArrayMap,r.tensorListMap);case 5:return s=e.sent,u=o.map((function(e){return e.id})),e.next=9,s[0].data();case 9:c=e.sent,s.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||e.dispose()})),l=o,p=(0,T.Z)().mark((function e(){var t,n,o;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l,e.next=3,r.functionMap[a].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 3:return l=e.sent,n=l.map((function(e){return e.id})),t.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()})),e.next=8,r.functionMap[i].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 8:return o=e.sent,e.next=11,o[0].data();case 11:c=e.sent,o.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 13:if(!c[0]){e.next=17;break}return e.delegateYield(p(),"t0",15);case 15:e.next=13;break;case 17:return e.abrupt("return",{v:l});case 18:case"end":return e.stop()}}),e)}))(),"t1",16);case 16:if("object"!==typeof(u=e.t1)){e.next=19;break}return e.abrupt("return",u.v);case 19:return c=M("pred",t,n,r),e.abrupt("return",[V(c)]);case 21:return l=M("pred",t,n,r),(p=M("data",t,n,r)).kept||(p=V(p)),e.next=26,l.data();case 26:if(!e.sent[0]){e.next=30;break}e.t2=[void 0,p],e.next=31;break;case 30:e.t2=[p,void 0];case 31:return e.abrupt("return",e.t2);case 32:if(d=t.inputNames.find((function(e){return void 0!==z(e,n,r)})),!d){e.next=36;break}return f=z(d,n,r),e.abrupt("return",[V(f)]);case 36:return e.abrupt("return",void 0);case 37:return h=M("frameName",t,n,r),m=M("tensor",t,n,r),r.enterFrame(h),e.abrupt("return",[V(m)]);case 41:return v=M("tensor",t,n,r),r.exitFrame(),e.abrupt("return",[V(v)]);case 44:return g=M("tensor",t,n,r),r.nextIteration(),e.abrupt("return",[V(g)]);case 47:return y=M("size",t,n,r),b=M("dtype",t,n,r),x=M("elementShape",t,n,r),k=M("dynamicSize",t,n,r),w=M("clearAfterRead",t,n,r),I=M("identicalElementShapes",t,n,r),N=M("name",t,n,r),C=new Re(N,b,y,x,I,k,w),r.addTensorArray(C),e.abrupt("return",[C.idTensor,(0,S.scalar)(1)]);case 57:return E=M("tensorArrayId",t,n,r),_=M("index",t,n,r),A=M("tensor",t,n,r),(R=r.getTensorArray(E.id)).write(_,A),e.abrupt("return",[R.idTensor]);case 63:return F=M("tensorArrayId",t,n,r),D=M("index",t,n,r),Z=r.getTensorArray(F.id),e.abrupt("return",[Z.read(D)]);case 67:return O=M("tensorArrayId",t,n,r),L=M("indices",t,n,r),P=M("dtype",t,n,r),B=r.getTensorArray(O.id),e.abrupt("return",[B.gather(L,P)]);case 72:return W=M("tensorArrayId",t,n,r),U=M("indices",t,n,r),G=M("tensor",t,n,r),(j=r.getTensorArray(W.id)).scatter(U,G),e.abrupt("return",[j.idTensor]);case 78:return H=M("tensorArrayId",t,n,r),q=r.getTensorArray(H.id),K=M("dtype",t,n,r),e.abrupt("return",[q.concat(K)]);case 82:return X=M("tensorArrayId",t,n,r),Y=M("tensor",t,n,r),Q=M("lengths",t,n,r),(J=r.getTensorArray(X.id)).split(Q,Y),e.abrupt("return",[J.idTensor]);case 88:return $=M("tensorArrayId",t,n,r),ee=r.getTensorArray($.id),e.abrupt("return",[(0,S.scalar)(ee.size(),"int32")]);case 91:return te=M("tensorArrayId",t,n,r),(ne=r.getTensorArray(te.id)).clearAndClose(),e.abrupt("return",[ne.idTensor]);case 95:return re=M("tensorListId",t,n,r),ae=M("index",t,n,r),ie=M("tensor",t,n,r),(oe=r.getTensorList(re.id)).setItem(ae,ie),e.abrupt("return",[oe.idTensor]);case 101:return se=M("tensorListId",t,n,r),ue=M("index",t,n,r),ce=M("elementShape",t,n,r),le=M("elementDType",t,n,r),pe=r.getTensorList(se.id),e.abrupt("return",[pe.getItem(ue,ce,le)]);case 107:return de=M("indices",t,n,r),fe=M("tensor",t,n,r),he=M("elementShape",t,n,r),me=M("numElements",t,n,r),ve=Oe(fe,de,he,me),r.addTensorList(ve),e.abrupt("return",[ve.idTensor]);case 114:return ge=M("elementShape",t,n,r),ye=M("elementDType",t,n,r),be="TensorListReserve"===t.op?"numElements":"maxNumElements",xe=M(be,t,n,r),ke="TensorListReserve"===t.op?-1:xe,we=Ze(ge,ye,0,ke),r.addTensorList(we),e.abrupt("return",[we.idTensor]);case 122:return Se=M("tensorListId",t,n,r),Ie=M("indices",t,n,r),Ne=M("elementShape",t,n,r),Te=M("elementDType",t,n,r),Ce=r.getTensorList(Se.id),e.abrupt("return",[Ce.gather(Ie,Te,Ne)]);case 128:return Ee=M("tensorListId",t,n,r),_e=M("elementShape",t,n,r),Ae=M("elementDType",t,n,r),Fe=M("numElements",t,n,r),ze=r.getTensorList(Ee.id),e.abrupt("return",[ze.stack(_e,Ae,Fe)]);case 134:return Le=M("tensor",t,n,r),Pe=M("elementShape",t,n,r),Be=M("elementDType",t,n,r),We=De(Le,Pe,Be),r.addTensorList(We),e.abrupt("return",[We.idTensor]);case 140:return Ve=M("tensorListId",t,n,r),Ue=r.getTensorList(Ve.id),Ge=M("dtype",t,n,r),je=M("elementShape",t,n,r),e.abrupt("return",[Ue.concat(Ge,je)]);case 145:return He=M("tensorListId",t,n,r),qe=M("tensor",t,n,r),(Ke=r.getTensorList(He.id)).pushBack(qe),e.abrupt("return",[Ke.idTensor]);case 150:return Xe=M("tensorListId",t,n,r),Ye=M("elementShape",t,n,r),Qe=M("elementDType",t,n,r),Je=r.getTensorList(Xe.id),e.abrupt("return",[Je.popBack(Ye,Qe)]);case 155:return $e=M("tensor",t,n,r),et=M("elementShape",t,n,r),tt=M("lengths",t,n,r),nt=Me($e,tt,et),r.addTensorList(nt),e.abrupt("return",[nt.idTensor]);case 161:return rt=M("tensorListId",t,n,r),at=r.getTensorList(rt.id),e.abrupt("return",[(0,S.scalar)(at.size(),"int32")]);case 164:return it=M("tensorListId",t,n,r),ot=M("size",t,n,r),st=r.getTensorList(it.id),ut=st.resize(ot),r.addTensorList(ut),e.abrupt("return",[ut.idTensor]);case 170:throw TypeError("Node type ".concat(t.op," is not implemented"));case 171:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function Le(e,t,n){var r=M("fusedOps",e,t,n),a=(0,A.Z)(r,2),i=a[0],o=a[1],s="biasadd"===i,u=!s,c="prelu"===o,l="fusedbatchnorm"===i,p=M("numArgs",e,t,n);if(s){if(c&&2!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&s&&1!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var d=M("strides",e,t,n),f=W(e,t,n),h=M("dataFormat",e,t,n).toUpperCase(),m=M("dilations",e,t,n),v=M("args",e,t,n),g=(0,A.Z)(v,2),y=g[0],b=g[1];return u&&(b=y,y=void 0),{stride:d,pad:f,dataFormat:h,dilations:m,biasArg:y,preluArg:b,activationFunc:o,leakyreluAlpha:M("leakyreluAlpha",e,t,n)}}var Pe=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Conv1D":var a=M("stride",e,t,n),i=M("pad",e,t,n),o=M("dataFormat",e,t,n).toUpperCase(),s=M("dilation",e,t,n);return[r.conv1d(M("x",e,t,n),M("filter",e,t,n),a,i,o,s)];case"Conv2D":var u=M("strides",e,t,n),c=W(e,t,n),l=M("dataFormat",e,t,n).toUpperCase(),p=M("dilations",e,t,n);return[r.conv2d(M("x",e,t,n),M("filter",e,t,n),[u[1],u[2]],c,l,[p[1],p[2]])];case"_FusedConv2D":var d=Le(e,t,n),f=d.stride,h=d.pad,m=d.dataFormat,v=d.dilations,g=d.biasArg,y=d.preluArg,b=d.activationFunc,x=d.leakyreluAlpha;return[r.fused.conv2d({x:M("x",e,t,n),filter:M("filter",e,t,n),strides:[f[1],f[2]],pad:h,dataFormat:m,dilations:[v[1],v[2]],bias:g,activation:b,preluActivationWeights:y,leakyreluAlpha:x})];case"FusedDepthwiseConv2dNative":var k=Le(e,t,n),S=k.stride,I=k.pad,N=k.dataFormat,T=k.dilations,C=k.biasArg,E=k.preluArg,_=k.activationFunc,A=k.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:M("x",e,t,n),filter:M("filter",e,t,n),strides:[S[1],S[2]],pad:I,dataFormat:N,dilations:[T[1],T[2]],bias:C,activation:_,preluActivationWeights:E,leakyreluAlpha:A})];case"Conv2DBackpropInput":case"Conv2dTranspose":var R=M("outputShape",e,t,n),F=M("strides",e,t,n),D=W(e,t,n);return[r.conv2dTranspose(M("x",e,t,n),M("filter",e,t,n),R,[F[1],F[2]],D)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var Z=M("strides",e,t,n),O=W(e,t,n),z=M("dilations",e,t,n),L=M("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(M("input",e,t,n),M("filter",e,t,n),[Z[1],Z[2]],O,L,[z[1],z[2]])];case"Conv3D":var P=M("strides",e,t,n),B=M("pad",e,t,n),V=M("dataFormat",e,t,n).toUpperCase(),U=M("dilations",e,t,n);return[r.conv3d(M("x",e,t,n),M("filter",e,t,n),[P[1],P[2],P[3]],B,V,[U[1],U[2],U[3]])];case"AvgPool":var G=M("strides",e,t,n),j=M("pad",e,t,n),H=M("kernelSize",e,t,n);return[r.avgPool(M("x",e,t,n),[H[1],H[2]],[G[1],G[2]],j)];case"MaxPool":var q=M("strides",e,t,n),K=M("pad",e,t,n),X=M("kernelSize",e,t,n);return[r.maxPool(M("x",e,t,n),[X[1],X[2]],[q[1],q[2]],K)];case"MaxPoolWithArgmax":var Y=M("strides",e,t,n),Q=M("pad",e,t,n),J=M("kernelSize",e,t,n),$=M("includeBatchInIndex",e,t,n),ee=r.maxPoolWithArgmax(M("x",e,t,n),[J[1],J[2]],[Y[1],Y[2]],Q,$),te=ee.result,ne=ee.indexes;return[te,ne];case"AvgPool3D":var re=M("strides",e,t,n),ae=M("pad",e,t,n),ie=M("kernelSize",e,t,n);return[r.avgPool3d(M("x",e,t,n),[ie[1],ie[2],ie[3]],[re[1],re[2],re[3]],ae)];case"MaxPool3D":var oe=M("strides",e,t,n),se=M("pad",e,t,n),ue=M("kernelSize",e,t,n);return[r.maxPool3d(M("x",e,t,n),[ue[1],ue[2],ue[3]],[oe[1],oe[2],oe[3]],se)];case"Dilation2D":var ce=M("strides",e,t,n),le=M("pad",e,t,n),pe=M("dilations",e,t,n),de=ce[1],fe=ce[2],he=pe[1],me=pe[2];return[r.dilation2d(M("x",e,t,n),M("filter",e,t,n),[de,fe],le,[he,me],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Be=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Fill":var a=M("shape",e,t,n),i=M("dtype",e,t,n),o=M("value",e,t,n);return[r.fill(a,o,i)];case"LinSpace":var s=M("start",e,t,n),u=M("stop",e,t,n),c=M("num",e,t,n);return[r.linspace(s,u,c)];case"Multinomial":var l=M("logits",e,t,n),p=M("numSamples",e,t,n),d=M("seed",e,t,n);return[r.multinomial(l,p,d)];case"OneHot":var f=M("indices",e,t,n),h=M("depth",e,t,n),m=M("onValue",e,t,n),v=M("offValue",e,t,n);return[r.oneHot(f,h,m,v)];case"Ones":return[r.ones(M("shape",e,t,n),M("dtype",e,t,n))];case"OnesLike":return[r.onesLike(M("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(M("shape",e,t,n),M("dtype",e,t,n),M("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(M("shape",e,t,n),M("minval",e,t,n),M("maxval",e,t,n),M("dtype",e,t,n))];case"Range":var g=M("start",e,t,n),y=M("stop",e,t,n),b=M("step",e,t,n);return[r.range(g,y,b,M("dtype",e,t,n))];case"TruncatedNormal":var x=M("shape",e,t,n),k=M("mean",e,t,n),S=M("stdDev",e,t,n),I=M("seed",e,t,n);return[r.truncatedNormal(x,k,S,M("dtype",e,t,n),I)];case"Zeros":return[r.zeros(M("shape",e,t,n),M("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(M("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function We(e,t,n){return{boxes:M("boxes",e,t,n),scores:M("scores",e,t,n),maxOutputSize:M("maxOutputSize",e,t,n),iouThreshold:M("iouThreshold",e,t,n),scoreThreshold:M("scoreThreshold",e,t,n),softNmsSigma:M("softNmsSigma",e,t,n)}}var Ve=function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,d,f,h,m,v,g,y,b,x,k,S,I,N,C,E,_,A,R,F=arguments;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=F.length>4&&void 0!==F[4]?F[4]:w,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?9:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?15:"Where"===e.t0?20:"ListDiff"===e.t0?27:28;break;case 4:return o=We(t,n,r),s=o.boxes,u=o.scores,c=o.maxOutputSize,l=o.iouThreshold,p=o.scoreThreshold,d=o.softNmsSigma,e.next=7,i.image.nonMaxSuppressionWithScoreAsync(s,u,c,l,p,d);case 7:return f=e.sent,e.abrupt("return",[f.selectedIndices,f.selectedScores]);case 9:return h=We(t,n,r),m=h.boxes,v=h.scores,g=h.maxOutputSize,y=h.iouThreshold,b=h.scoreThreshold,x=M("padToMaxOutputSize",t,n,r),e.next=13,i.image.nonMaxSuppressionPaddedAsync(m,v,g,y,b,x);case 13:return k=e.sent,e.abrupt("return",[k.selectedIndices,k.validOutputs]);case 15:return S=We(t,n,r),I=S.boxes,N=S.scores,C=S.maxOutputSize,E=S.iouThreshold,_=S.scoreThreshold,e.next=18,i.image.nonMaxSuppressionAsync(I,N,C,E,_);case 18:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 20:return A=i.cast(M("condition",t,n,r),"bool"),e.next=23,i.whereAsync(A);case 23:return e.t2=e.sent,R=[e.t2],A.dispose(),e.abrupt("return",R);case 27:return e.abrupt("return",i.setdiff1dAsync(M("x",t,n,r),M("y",t,n,r)));case 28:throw TypeError("Node type ".concat(t.op," is not implemented"));case 29:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Ue=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"LowerBound":var a=M("sortedSequence",e,t,n),i=M("values",e,t,n);return[r.lowerBound(a,i)];case"TopKV2":var o=M("x",e,t,n),s=M("k",e,t,n),u=M("sorted",e,t,n),c=r.topk(o,s,u);return[c.values,c.indices];case"UpperBound":var l=M("sortedSequence",e,t,n),p=M("values",e,t,n);return[r.upperBound(l,p)];case"Unique":var d=M("x",e,t,n),f=r.unique(d);return[f.values,f.indices];case"UniqueV2":var h=M("x",e,t,n),m=M("axis",e,t,n),v=r.unique(h,m);return[v.values,v.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Ge=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var a=M("default",e,t,n);return[z(e.name,t,n)||a];case"Placeholder":return[z(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":var i=M("x",e,t,n);return[V(i)];case"IdentityN":return M("x",e,t,n).map((function(e){return V(e)}));case"Snapshot":var o=M("x",e,t,n);return[V(o)];case"Shape":return[r.tensor1d(M("x",e,t,n).shape,"int32")];case"ShapeN":return M("x",e,t,n).map((function(e){return r.tensor1d(e.shape)}));case"Size":return[r.scalar(M("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(M("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var s=M("x",e,t,n),u=M("data",e,t,n),c=M("message",e,t,n),l=M("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var p=0;p<u.length;p++)console.log(Array.prototype.slice.call(u[p].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},je=n(7067),He=function(){function e(t,n){(0,E.Z)(this,e),this.keyDType=t,this.valueDType=n,this.handle=(0,S.scalar)(0),this.tensorMap=new Map,(0,S.keep)(this.handle)}return(0,_.Z)(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return je.i(this.size(),"int32")}},{key:"import",value:function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n){var r,a=this;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),e.abrupt("return",(0,S.tidy)((function(){var e=(0,S.unstack)(n),t=r.length,i=e.length;S.util.assert(t===i,(function(){return"The number of elements doesn't match, keys has "+"".concat(t," elements, the values has ").concat(i," ")+"elements."}));for(var o=0;o<t;o++){var s=r[o],u=e[o];(0,S.keep)(u),a.tensorMap.set(s,u)}return a.handle})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n){var r,a=this;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",(0,S.tidy)((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return(0,S.stack)(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))}}]),e}(),qe=function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,d,f,h,m,v,g;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?8:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?16:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?24:27;break;case 3:return i=M("keyDType",t,n,r),o=M("valueDType",t,n,r),s=new He(i,o),a.addHashTable(t.name,s),e.abrupt("return",[s.handle]);case 8:return u=M("tableHandle",t,n,r,a),c=M("keys",t,n,r),l=M("values",t,n,r),p=a.getHashTableById(u.id),e.next=14,p.import(c,l);case 14:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 16:return d=M("tableHandle",t,n,r,a),f=M("keys",t,n,r),h=M("defaultValue",t,n,r),m=a.getHashTableById(d.id),e.next=22,m.find(f,h);case 22:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 24:return v=M("tableHandle",t,n,r,a),g=a.getHashTableById(v.id),e.abrupt("return",[g.tensorSize()]);case 27:throw TypeError("Node type ".concat(t.op," is not implemented"));case 28:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Ke=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"ResizeBilinear":var a=M("images",e,t,n),i=M("size",e,t,n),o=M("alignCorners",e,t,n),s=M("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)];case"ResizeNearestNeighbor":var u=M("images",e,t,n),c=M("size",e,t,n),l=M("alignCorners",e,t,n),p=M("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(u,[c[0],c[1]],l,p)];case"CropAndResize":var d=M("image",e,t,n),f=M("boxes",e,t,n),h=M("boxInd",e,t,n),m=M("cropSize",e,t,n),v=M("method",e,t,n),g=M("extrapolationValue",e,t,n);return[r.image.cropAndResize(d,f,h,m,v,g)];case"ImageProjectiveTransformV3":var y=M("images",e,t,n),b=M("transforms",e,t,n),x=M("outputShape",e,t,n),k=M("fillValue",e,t,n),S=M("interpolation",e,t,n),I=M("fillMode",e,t,n);return[r.image.transform(y,b,S.toLowerCase(),I.toLowerCase(),k,x)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Xe=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Equal":return[r.equal(M("a",e,t,n),M("b",e,t,n))];case"NotEqual":return[r.notEqual(M("a",e,t,n),M("b",e,t,n))];case"Greater":return[r.greater(M("a",e,t,n),M("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(M("a",e,t,n),M("b",e,t,n))];case"Less":return[r.less(M("a",e,t,n),M("b",e,t,n))];case"LessEqual":return[r.lessEqual(M("a",e,t,n),M("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(M("a",e,t,n),M("b",e,t,n))];case"LogicalNot":return[r.logicalNot(M("a",e,t,n))];case"LogicalOr":return[r.logicalOr(M("a",e,t,n),M("b",e,t,n))];case"Select":case"SelectV2":return[r.where(M("condition",e,t,n),M("a",e,t,n),M("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Ye=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(M("a",e,t,n),M("b",e,t,n),M("transposeA",e,t,n),M("transposeB",e,t,n))];case"Einsum":return[r.einsum.apply(r,[M("equation",e,t,n)].concat((0,R.Z)(M("tensors",e,t,n))))];case"Transpose":return[r.transpose(M("x",e,t,n),M("perm",e,t,n))];case"_FusedMatMul":var a=M("fusedOps",e,t,n),i=(0,A.Z)(a,2),o=i[0],s=i[1],u="biasadd"===o,c="prelu"===s,l=M("numArgs",e,t,n),p=M("leakyreluAlpha",e,t,n);if(u){if(c&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var d=M("args",e,t,n),f=(0,A.Z)(d,2),h=f[0],m=f[1];return[r.fused.matMul({a:M("a",e,t,n),b:M("b",e,t,n),transposeA:M("transposeA",e,t,n),transposeB:M("transposeB",e,t,n),bias:h,activation:s,preluActivationWeights:m,leakyreluAlpha:p})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Qe=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(M("x",e,t,n),M("axis",e,t,n),M("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(M("x",e,t,n),M("mean",e,t,n),M("variance",e,t,n),M("offset",e,t,n),M("scale",e,t,n),M("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(M("x",e,t,n),M("radius",e,t,n),M("bias",e,t,n),M("alpha",e,t,n),M("beta",e,t,n))];case"Softmax":return[r.softmax(M("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(M("x",e,t,n))];case"SparseToDense":return[r.sparseToDense(M("sparseIndices",e,t,n),M("outputShape",e,t,n),M("sparseValues",e,t,n),M("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Je=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Max":var a=M("axis",e,t,n),i=M("keepDims",e,t,n);return[r.max(M("x",e,t,n),a,i)];case"Mean":var o=M("axis",e,t,n),s=M("keepDims",e,t,n);return[r.mean(M("x",e,t,n),o,s)];case"Min":var u=M("axis",e,t,n),c=M("keepDims",e,t,n);return[r.min(M("x",e,t,n),u,c)];case"Sum":var l=M("axis",e,t,n),p=M("keepDims",e,t,n);return[r.sum(M("x",e,t,n),l,p)];case"All":var d=M("axis",e,t,n),f=M("keepDims",e,t,n);return[r.all(M("x",e,t,n),d,f)];case"Any":var h=M("axis",e,t,n),m=M("keepDims",e,t,n);return[r.any(M("x",e,t,n),h,m)];case"ArgMax":var v=M("axis",e,t,n);return[r.argMax(M("x",e,t,n),v)];case"ArgMin":var g=M("axis",e,t,n);return[r.argMin(M("x",e,t,n),g)];case"Prod":var y=M("axis",e,t,n),b=M("keepDims",e,t,n);return[r.prod(M("x",e,t,n),y,b)];case"Cumprod":var x=M("axis",e,t,n),k=M("exclusive",e,t,n),S=M("reverse",e,t,n);return[r.cumprod(M("x",e,t,n),x,k,S)];case"Cumsum":var I=M("axis",e,t,n),N=M("exclusive",e,t,n),T=M("reverse",e,t,n);return[r.cumsum(M("x",e,t,n),I,N,T)];case"Bincount":var C=M("x",e,t,n),E=M("weights",e,t,n),_=M("size",e,t,n);return[r.bincount(C,E,_)];case"DenseBincount":var A=M("x",e,t,n),R=M("weights",e,t,n),F=M("size",e,t,n),D=M("binaryOutput",e,t,n);return[r.denseBincount(A,R,F,D)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},$e=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"ConcatV2":case"Concat":var a=M("n",e,t,n),i=M("axis",e,t,n),o=M("tensors",e,t,n);return o=o.slice(0,a),[r.concat(o,i)];case"Gather":var s=M("x",e,t,n),u=M("indices",e,t,n);return[r.gather(s,r.cast(u,"int32"),0)];case"GatherV2":var c=M("axis",e,t,n),l=M("batchDims",e,t,n),p=M("x",e,t,n),d=M("indices",e,t,n);return[r.gather(p,r.cast(d,"int32"),c,l)];case"Reverse":for(var f=M("dims",e,t,n),h=[],m=0;m<f.length;m++)f[m]&&h.push(m);var v=M("x",e,t,n);return[r.reverse(v,h)];case"ReverseV2":var g=M("axis",e,t,n),y=M("x",e,t,n);return[r.reverse(y,g)];case"Slice":var b=M("begin",e,t,n),x=M("size",e,t,n);return[r.slice(M("x",e,t,n),b,x)];case"StridedSlice":var k=M("begin",e,t,n),I=M("end",e,t,n),N=M("strides",e,t,n),T=M("beginMask",e,t,n),C=M("endMask",e,t,n),E=M("ellipsisMask",e,t,n),_=M("newAxisMask",e,t,n),A=M("shrinkAxisMask",e,t,n),R=M("x",e,t,n);return[r.stridedSlice(R,k,I,N,T,C,E,_,A)];case"Pack":return(0,S.tidy)((function(){var a=M("axis",e,t,n),i=M("tensors",e,t,n),o=i[0].shape,s=r.squeeze(i[0]).shape,u=i.map((function(e){var t=S.util.arraysEqual(e.shape,o);if(!t&&!S.util.arraysEqual(r.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,o)}));return[r.stack(u,a)]}));case"Unpack":var F=M("axis",e,t,n),D=M("tensor",e,t,n);return r.unstack(D,F);case"Tile":var Z=M("reps",e,t,n);return[r.tile(M("x",e,t,n),Z)];case"Split":case"SplitV":var O=M("axis",e,t,n),z=M("numOrSizeSplits",e,t,n),L=M("x",e,t,n);return r.split(L,z,O);case"ScatterNd":var P=M("indices",e,t,n),B=M("values",e,t,n),W=M("shape",e,t,n);return[r.scatterND(P,B,W)];case"GatherNd":var V=M("x",e,t,n),U=M("indices",e,t,n);return[r.gatherND(V,U)];case"SparseToDense":var G=M("sparseIndices",e,t,n),j=M("outputShape",e,t,n),H=M("sparseValues",e,t,n),q=M("defaultValue",e,t,n);return[r.sparseToDense(G,H,j,H.dtype===q.dtype?q:r.cast(q,H.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},et=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"SparseFillEmptyRows":var a=r.sparse.sparseFillEmptyRows(M("indices",e,t,n),M("values",e,t,n),M("denseShape",e,t,n),M("defaultValue",e,t,n)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u];case"SparseReshape":var c=r.sparse.sparseReshape(M("inputIndices",e,t,n),M("inputShape",e,t,n),M("newShape",e,t,n)),l=c.outputIndices,p=c.outputShape;return[l,p];case"SparseSegmentMean":var d=r.sparse.sparseSegmentMean(M("data",e,t,n),M("indices",e,t,n),M("segmentIds",e,t,n));return[d];case"SparseSegmentSum":var f=r.sparse.sparseSegmentSum(M("data",e,t,n),M("indices",e,t,n),M("segmentIds",e,t,n));return[f];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},tt=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"FFT":return[r.fft(M("x",e,t,n))];case"IFFT":return[r.ifft(M("x",e,t,n))];case"RFFT":return[r.rfft(M("x",e,t,n))];case"IRFFT":return[r.irfft(M("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},nt=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"StringNGrams":var a=r.string.stringNGrams(M("data",e,t,n),M("dataSplits",e,t,n),M("separator",e,t,n),M("nGramWidths",e,t,n),M("leftPad",e,t,n),M("rightPad",e,t,n),M("padWidth",e,t,n),M("preserveShortSequences",e,t,n)),i=a.nGrams,o=a.nGramsSplits;return[i,o];case"StringSplit":var s=r.string.stringSplit(M("input",e,t,n),M("delimiter",e,t,n),M("skipEmpty",e,t,n)),u=s.indices,c=s.values,l=s.shape;return[u,c,l];case"StringToHashBucketFast":var p=r.string.stringToHashBucketFast(M("input",e,t,n),M("numBuckets",e,t,n));return[p];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},rt=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w;switch(e.op){case"Cast":return[r.cast(M("x",e,t,n),M("dtype",e,t,n))];case"ExpandDims":var a=M("axis",e,t,n);return[r.expandDims(M("x",e,t,n),a)];case"Squeeze":var i=M("axis",e,t,n);return[r.squeeze(M("x",e,t,n),i)];case"Reshape":return[r.reshape(M("x",e,t,n),M("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(M("x",e,t,n),M("padding",e,t,n),M("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(M("x",e,t,n),M("padding",e,t,n),M("constantValue",e,t,n))];case"SpaceToBatchND":var o=M("blockShape",e,t,n),s=M("paddings",e,t,n);return[r.spaceToBatchND(M("x",e,t,n),o,s)];case"BatchToSpaceND":var u=M("blockShape",e,t,n),c=M("crops",e,t,n);return[r.batchToSpaceND(M("x",e,t,n),u,c)];case"DepthToSpace":var l=M("blockSize",e,t,n),p=M("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(M("x",e,t,n),l,p)];case"BroadcastTo":return[r.broadcastTo(M("x",e,t,n),M("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(M("s0",e,t,n),M("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function at(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:S.tidy,i=function(e,t,n){switch(e.category){case"arithmetic":return a((function(){return Ne(e,t,n)}));case"basic_math":return a((function(){return Te(e,t,n)}));case"control":return ze(e,t,n);case"convolution":return a((function(){return Pe(e,t,n)}));case"creation":return a((function(){return Be(e,t,n)}));case"dynamic":return Ve(e,t,n);case"evaluation":return a((function(){return Ue(e,t,n)}));case"image":return a((function(){return Ke(e,t,n)}));case"graph":return a((function(){return Ge(e,t,n)}));case"logical":return a((function(){return Xe(e,t,n)}));case"matrices":return a((function(){return Ye(e,t,n)}));case"normalization":return a((function(){return Qe(e,t,n)}));case"reduction":return a((function(){return Je(e,t,n)}));case"slice_join":return a((function(){return $e(e,t,n)}));case"sparse":return a((function(){return et(e,t,n)}));case"spectral":return a((function(){return tt(e,t,n)}));case"string":return a((function(){return nt(e,t,n)}));case"transformation":return a((function(){return rt(e,t,n)}));case"hash_table":return qe(e,t,n,r);case"custom":var i=Z(e.op);if(i&&i.customExecutor)return i.customExecutor(new Se(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,n);return S.util.isPromise(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var it=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,E.Z)(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return(0,_.Z)(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function ot(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return B(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return B(e.name)[0]})));for(var p=(0,R.Z)(t);p.length>0;){var d=p.pop();(lt(d)||pt(d)||dt(d))&&null==o&&(s=(o=d).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(d.name),null==n[d.name]&&(-1===c.indexOf(d.name)&&-1===l.indexOf(d.name)&&(0!==d.inputs.length?d.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),p.push(e))})):i.push(d.name)))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var st=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],ut=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],ct=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function lt(e){return st.indexOf(e.op)>=0}function pt(e){return ut.indexOf(e.op)>=0}function dt(e){return ct.indexOf(e.op)>=0}var ft=function(){function e(t,n){var r=this;(0,E.Z)(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return(0,_.Z)(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,(0,R.Z)(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=ot(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has ")+"the dynamic op '".concat(a.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs ")+"[".concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return B(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[B(e)[0]]})),i=t.map((function(e){return B(e)[0]})),o=i.map((function(e){return n.graph.nodes[e]}));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);var s=this.getCompilationKey(a,o),u=this.compiledMap.get(s);null==u&&(u=this.compile(e,o),this.compiledMap.set(s,u));var c={},l={};return(0,S.tidy)((function(){var r=new it(n.weightMap,c,l,n.functionExecutorMap),a=Object.assign({},n.weightMap);Object.keys(e).forEach((function(t){var n=B(t),r=(0,A.Z)(n,2),i=r[0],o=[];o[r[1]]=e[t],a[i]=o}));for(var o=n.getFrozenTensorIds(a),s={},p=0;p<u.length;p++){var d=u[p];if(!a[d.name]){var f=at(d,a,r,n._resourceManager);if(S.util.isPromise(f))throw new Error("The execution of the op '".concat(d.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");a[d.name]=f,n.checkTensorForDisposal(d.name,d,a,r,o,i,s)}}return null==n.parent&&r.dispose(o),t.map((function(e){return z(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){var s=this;"control"!==t.category&&-1===i.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var i=function(e,t,n){return t[P(e,n.currentContextId)]}(e.name,n,r);null!=i&&i.forEach((function(e){if(e&&!e.kept&&!a.has(e.id)){var n=o[e.id];if(1===n){if(s.keepTensorForDebug){var i=L(t.name,r),u=(0,A.Z)(i,2),c=u[0],l=u[1];s.intermediateTensors[c]||(s.intermediateTensors[c]=[]),s.intermediateTensors[c][l]=e}else e.dispose();delete o[e.id]}else null!=n&&o[e.id]--}}))}})))}},{key:"executeAsync",value:function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n){return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){var e=this;this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((function(t){return e.intermediateTensors[t].forEach((function(e){return e.dispose()}))})),this.disposeTensorsMap())}},{key:"disposeTensorsMap",value:function(){var e=this;this.tensorsMap&&Object.keys(this.tensorsMap).forEach((function(t){e.tensorsMap[t].forEach((function(t){!t||t.kept||t.isDisposed||e.keepIds.has(t.id)||t.dispose()}))}))}},{key:"getIntermediateTensors",value:function(){return this.tensorsMap}},{key:"resetIntermediateTensors",value:function(){for(var e in this.intermediateTensors)this.intermediateTensors[e].forEach((function(e){return e.dispose()})),delete this.intermediateTensors[e]}},{key:"_executeAsync",value:function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l=this,p=arguments;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p.length>2&&void 0!==p[2]&&p[2],a=p.length>3&&void 0!==p[3]?p[3]:{},i=p.length>4&&void 0!==p[4]?p[4]:{},r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=(0,S.env)().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){console.warn(d.message)}return this.resetIntermediateTensors(),o=new it(this.weightMap,a,i,this.functionExecutorMap),e.next=9,this.executeWithControlFlow(t,o,n,r);case 9:return this.tensorsMap=e.sent,s=n.map((function(e){return z(e,l.tensorsMap,o)})),u=s.map((function(e){return e.id})),c=Object.keys(t).map((function(e){return t[e].id})),this.keepIds=new Set([].concat((0,R.Z)(u),(0,R.Z)(c),(0,R.Z)(this.weightIds))),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n,r){var a,i=this;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,d,f,h,m,v,g,y,b,x,k,w=this;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return w.graph.nodes[B(e)[0]]})),s=r.map((function(e){return B(e)[0]})),0===(u=s.map((function(e){return w.graph.nodes[e]}))).length&&(u=this._outputs),c=ot(t,u,this.weightMap,this._initNodes),l=c.usedNodes,p=c.missingInputs,d=c.dynamicNode,f=c.syncInputs,h=[].concat((0,R.Z)(o),(0,R.Z)(this.graph.weights),(0,R.Z)(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),m=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=B(e),r=(0,A.Z)(n,2),a=r[0],i=[];i[r[1]]=t[e],m[a]=i})),v={},g=this.getFrozenTensorIds(m),y={};case 12:if(!(h.length>0)){e.next=18;break}return b=this.processStack(o,h,n,m,y,g,s,v,l),e.next=16,Promise.all(b);case 16:e.next=12;break;case 18:if(null!=d||a||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((x=u.filter((function(e){return!lt(e)&&!z(e.name,m,n)})).map((function(e){return e.name}))).length>0)){e.next=24;break}throw k="",null!=d&&(k="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(f,"]")),new Error("Cannot compute the outputs [".concat(x,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(p,"]. ").concat(k));case 24:return e.abrupt("return",m);case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,i,o,s,u){for(var c=this,l=[],p=function(){var e=t.pop();n.currentContext=e.contexts;var p="";if("Enter"===e.node.op&&M("isConstant",e.node,r,n)){var d=L(e.node.name,n),f=(0,A.Z)(d,1);p=f[0]}if(null==r[e.node.name]){var h=at(e.node,r,n,c._resourceManager);if(!p){var m=L(e.node.name,n),v=(0,A.Z)(m,1);p=v[0]}var g=n.currentContext;S.util.isPromise(h)?l.push(h.then((function(l){return r[p]=l,n.currentContext=g,c.checkTensorForDisposal(p,e.node,r,n,i,o,s),c.processChildNodes(e.node,t,n,r,a,u),l}))):(r[p]=h,c.checkTensorForDisposal(p,e.node,r,n,i,o,s),c.processChildNodes(e.node,t,n,r,a,u))}else c.processChildNodes(e.node,t,n,r,a,u)};t.length>0;)p();return l}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=L(e.name,n),s=(0,A.Z)(o,1)[0];!a[s]&&i.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!z(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!z(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=B(n),i=(0,A.Z)(a,1)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value,u=s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e}));S.util.assert(u,(function(){return"The shape of dict['".concat(o.name,"'] provided in ")+"model.execute(dict) must be [".concat(s,"], but was ")+"[".concat(r.shape,"]")}))}o.attrParams.dtype&&o.attrParams.dtype.value&&S.util.assert(r.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(o.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(o.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t={};for(var n in e){if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n])t[this._signature.inputs[n].name]=e[n];else t[n]=e[n]}return t}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=B(e),r=(0,A.Z)(n,1)[0];return null==t.graph.nodes[r]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=B(e),r=(0,A.Z)(n,1)[0];if(!t.graph.nodes[r])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),ht=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,E.Z)(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return(0,_.Z)(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),mt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S.io;(0,E.Z)(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new ht}return(0,_.Z)(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}},{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return S.util.isPromise(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new ft(ue.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var i=ue.Instance.transformGraph(e.modelInitializer);this.initializer=new ft(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n){var r;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=6;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 6:if(!(r.length>1)){e.next=8;break}throw new Error("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(t,"'"));case 8:t=r[0];case 9:if(null!=t.save){e.next=11;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.abrupt("return",t.save(this.artifacts));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e,t){var n=this,r=this.execute(e,this.outputNodes);if(this.structuredOutputKeys){var a=r instanceof S.Tensor?[r]:r,i={};return a.forEach((function(e,t){return i[n.structuredOutputKeys[t]]=e})),i}return r}},{key:"normalizeInputs",value:function(e){if(!(e instanceof S.Tensor)&&!Array.isArray(e))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,"+"the graph model has ".concat(this.inputNodes.length," placeholders, ")+"while there are ".concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=(0,C.Z)((0,T.Z)().mark((function e(t,n){var r;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=4,this.executor.executeAsync(t,n);case 4:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}]),e}();function vt(e){return gt.apply(this,arguments)}function gt(){return gt=(0,C.Z)((0,T.Z)().mark((function e(t){var n,r,a,i=arguments;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:S.io,null!=t){e.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==n&&(n={}),n.fromTFHub&&"string"===typeof t&&(t=bt(t)),a=new mt(t,n,r),e.next=9,a.load();case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)}))),gt.apply(this,arguments)}function yt(e){if(null==e)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide a url or an IOHandler that loads the model");if(!e.load)throw new Error("modelUrl IO Handler ".concat(e," has no load function"));var t=new mt(e);return t.load(),t}function bt(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat("model.json").concat("?tfjs-format=file")}var xt="3.19.0"},4679:function(e,t,n){"use strict";n.d(t,{JL:function(){return i},Zu:function(){return o}});var r=n(5671),a=n(3144),i=function(){function e(t,n){(0,r.Z)(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return(0,a.Z)(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),o=function(){function e(){(0,r.Z)(this,e)}return(0,a.Z)(e,[{key:"refCount",value:function(e){return s("refCount")}},{key:"incRef",value:function(e){return s("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return s("time")}},{key:"read",value:function(e){return s("read")}},{key:"readSync",value:function(e){return s("readSync")}},{key:"readToGPU",value:function(e,t){return s("readToGPU")}},{key:"numDataIds",value:function(){return s("numDataIds")}},{key:"disposeData",value:function(e,t){return s("disposeData")}},{key:"write",value:function(e,t,n){return s("write")}},{key:"move",value:function(e,t,n,r,a){return s("move")}},{key:"memory",value:function(){return s("memory")}},{key:"floatPrecision",value:function(){return s("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return s("dispose")}}]),e}();function s(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}},745:function(e,t,n){"use strict";n.d(t,{GP:function(){return o},qP:function(){return s},pA:function(){return u}});var r=n(3433);function a(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||i)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function i(e,t){return e>t?1:e<t?-1:0}function o(e,t,n,r,a){return c(e,t,n,r,a,0)}function s(e,t,n,r,a,i){return c(e,t,n,r,a,0,!1,i,!0)}function u(e,t,n,r,a,i){return c(e,t,n,r,a,i,!0)}function c(e,t,n,i,o,s){for(var u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],f=arguments.length>8&&void 0!==arguments[8]&&arguments[8],h=[],m=0;m<t.length;m++)t[m]>o&&h.push({score:t[m],boxIndex:m,suppressBeginIndex:0});h.sort(d);for(var v=s>0?-.5/s:0,g=[],y=[];g.length<n&&h.length>0;){var b=h.pop(),x=b.score,k=b.boxIndex,w=b.suppressBeginIndex;if(x<o)break;for(var S=!1,I=g.length-1;I>=w;--I){var N=l(e,k,g[I]);if(N>=i){S=!0;break}if(b.score=b.score*p(i,v,N),b.score<=o)break}b.suppressBeginIndex=g.length,S||(b.score===x?(g.push(k),y.push(b.score)):b.score>o&&a(h,b,d))}var T=g.length,C=n-T;c&&C>0&&(g.push.apply(g,(0,r.Z)(new Array(C).fill(0))),y.push.apply(y,(0,r.Z)(new Array(C).fill(0))));var E={selectedIndices:g};return u&&(E.selectedScores=y),f&&(E.validOutputs=T),E}function l(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),f=(s-i)*(u-o),h=(p-c)*(d-l);if(f<=0||h<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,p),y=Math.min(u,d),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(f+h-b)}function p(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function d(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}},4189:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(7039);function a(e,t){for(var n=[],a=0;a<t.length;a++)t[a]&&n.push(a);for(var i=(0,r.f)(e,"int32"),o=(0,r.f)([n.length,e.length],"int32"),s=0;s<n.length;s++){var u=i.indexToLoc(n[s]),c=s*e.length;o.values.set(u,c)}return o.toTensor()}},318:function(e,t,n){"use strict";n.d(t,{BV:function(){return E},wv:function(){return C}});var r=n(7762),a=n(3433),i=n(4165),o=n(5861),s=n(5671),u=n(3144),c=n(4679),l=n(5050),p=n(6581),d=n(2145),f=n(8864),h=n(7269),m=n(115),v=n(6147),g=function(){function e(t,n){(0,s.Z)(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new y)}return(0,u.Z)(e,[{key:"profileKernel",value:function(e,t,n){var a,i,o=function(){a=n()},s=m.now();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();var u,c=(0,r.Z)(a);try{for(c.s();!(u=c.n()).done;){u.value.dataSync()}}catch(f){c.e(f)}finally{c.f()}i=Promise.resolve({kernelMs:m.now()-s})}if((0,l.OB)().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(t){var n=a[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},d=0;d<a.length;d++)p(d);return{kernelName:e,outputs:a,inputs:t,timeMs:i.then((function(e){return e.kernelMs})),extraInfo:i.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var y=function(){function e(){(0,s.Z)(this,e)}return(0,u.Z)(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?v.oj("".concat(r,"ms"),9):r.error,s=v.oj(e,25),u=t.rank,c=t.size,l=v.oj(t.shape.toString(),14),p="";for(var d in a){var f=a[d];if(null!=f){var h=f.shape||t.shape,m=h.length;p+="".concat(d,": ").concat(m,"D ").concat(m>0?h:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(p,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function b(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],p=!1,d=0;d<t.length;d++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),p=!0,a[s.id]=!0;break}if(p)break}}var f={};f[n.id]=!0;for(var h={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(f[v.outputs[y].id]){for(var b in g)f[g[b].id]=!0,h[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&h[w.id]){var S={};for(var I in w.inputs){var N=w.inputs[I];r[N.id]&&(S[I]=N)}var T=Object.assign({},w);T.inputs=S,T.outputs=w.outputs,x.push(T)}}return x}function x(e,t,n,r){for(var a=function(a){var i=t[a],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var a=n((function(){return s[t]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var o=i.inputs[t];if(!v.cO(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{var u=e[o.id];e[o.id]=r(u,a),u.dispose()}};for(var c in i.inputs)u(c)},i=t.length-1;i>=0;i--)a(i)}var k=n(4376),w=n(9064);function S(e){return null!=e.kernelName}var I=function(){function e(){(0,s.Z)(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return(0,u.Z)(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),N=function(){function e(t){(0,s.Z)(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new I}return(0,u.Z)(e,[{key:"ready",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var t,n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(h.Z("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new g(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;(0,f.tr)(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;(0,f.tr)(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof c.Zu||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,h.Z("Initialization of backend ".concat(e," failed")),h.Z(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return h.Z("Initialization of backend ".concat(e," failed")),h.Z(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=E.runKernel(d.iJ,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return E.runKernel(d.RF,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,!(null!=(0,f.pI)(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var c=S(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(S(e)){var l=e.kernelName,p=e.inputs,d=e.attrs;null==this.backendName&&this.backend;var h=(0,f.pI)(l,this.backendName);v.hu(null!=h,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=h.kernelFunc({inputs:p,attrs:d,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:a.makeTensorFromTensorInfo(e)}));if(o){var s=a.getTensorsForGradient(l,p,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var m=e.forwardFunc,g=function(e){o&&(i=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return m(a.backend,g)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var y,b=e.inputs,x=e.attrs,k=S(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(y=a.profiler.profileKernel(c,b,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(y),t=y.outputs):t=n()})),o&&this.addTapeNode(c,b,t,k,i,x),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(b).map((function(e){return null!=b[e]?b[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:y.timeMs,extraInfo:y.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this,n=e.map((function(e){return t.keep(t.clone(e))}));return n}},{key:"getTensorsForGradient",value:function(e,t,n){var r=(0,f.uk)(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(v.hu(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&v.HD(e[0])&&(a=e.map((function(e){return m.encodeString(e)})));var i=r.write(a,t,n),o=new k.es(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=(0,v.Ub)(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new k.es(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new k._w(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*v.bT(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof k._w||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*v.bT(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var n,o,s,u,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,o=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,(0,a.Z)(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-o,s=(0,r.Z)(this.state.activeProfile.kernels),e.prev=12,s.s();case 14:if((u=s.n()).done){e.next=24;break}return c=u.value,e.next=18,c.kernelTimeMs;case 18:return c.kernelTimeMs=e.sent,e.next=21,c.extraInfo;case 21:c.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),s.e(e.t0);case 29:return e.prev=29,s.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=(0,f.uk)(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=v.wT(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=(0,w.getTensorsInContainer)(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var a=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(v.hu(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun((function(){return a.startTape()}),(function(){return a.endTape()}),(function(){return a.tidy("forward",e)}));v.hu(o instanceof k.es,(function(){return"The result y returned by f() must be a tensor."}));var s=b(this.state.activeTape,t,o);if(!i&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[o.id]=null==n?T(o.shape):n,x(e,s,(function(e){return a.tidy(e)}),_);var i=t.map((function(t){return e[t.id]}));return 0===a.state.gradientDepth&&(a.state.activeTape.forEach((function(e){var t,n=(0,r.Z)(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(a){n.e(a)}finally{n.f()}})),a.state.activeTape=null),{value:o,grads:i}}))}},{key:"customGrad",value:function(e){var t=this;return v.hu(v.mf(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;v.hu(r.every((function(e){return e instanceof k.es})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};r.forEach((function(e,t){o[t]=e}));var s=function(t,n){return i=e.apply(void 0,[].concat(r,[n])),v.hu(i.value instanceof k.es,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),v.hu(v.mf(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},u=function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];v.hu(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),v.hu(a.every((function(e){return e instanceof k.es})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,m.now)(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=(0,m.now)()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new I,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function T(e){var t=(0,v.p8)((0,v.NA)(e),"float32");return E.makeTensor(t,e,"float32")}function C(){var e=(0,p.D)();if(null==e._tfengine){var t=new l.qA(e);e._tfengine=new N(t)}return(0,l.iG)(e._tfengine.ENV),(0,k.Vi)((function(){return e._tfengine})),e._tfengine}N.nextTensorId=0,N.nextVariableId=0;var E=C();function _(e,t){var n={a:e,b:t};return E.runKernel(d.mm,n)}},5050:function(e,t,n){"use strict";n.d(t,{OB:function(){return f},Vi:function(){return h},iG:function(){return m},qA:function(){return l}});var r=n(9439),a=n(4165),i=n(5861),o=n(5671),s=n(3144),u=n(6147),c="tfjsflags",l=function(){function e(t){(0,o.Z)(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=p,this.populateURLFlags()}return(0,s.Z)(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(f().getBool("IS_TEST")||f().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];f().getBool("IS_TEST")||f().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if((0,u.tI)(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);if(c in t)t.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),a=(0,r.Z)(n,2),i=a[0],o=a[1];e.urlFlags[i]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(i,o)}))}}}]),e}();function p(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return d(t,r[0],r[1]),r.join("=")})),t}function d(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function f(){return h}var h=null;function m(e){h=e}},6581:function(e,t,n){"use strict";var r;function a(){if(null==r){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}r=e}return r}function i(e,t){var n=function(){var e=a();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}n.d(t,{D:function(){return a},R:function(){return i}})},5875:function(e,t,n){"use strict";n.d(t,{B9:function(){return v},CQ:function(){return b},Cd:function(){return x},Cn:function(){return g},G4:function(){return s},MX:function(){return l},N5:function(){return h},N8:function(){return p},N_:function(){return k},R:function(){return u},SR:function(){return d},VY:function(){return C},XV:function(){return y},cF:function(){return c},cj:function(){return w},jq:function(){return N},lu:function(){return m},sq:function(){return f},x3:function(){return S},y3:function(){return T},ze:function(){return I}});var r=n(318),a=n(5050),i=n(4376),o=n(9064);function s(){(0,a.OB)().set("PROD",!0)}function u(){(0,a.OB)().set("DEBUG",!0)}function c(){(0,a.OB)().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function l(e){(0,a.OB)().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function p(){r.BV.disposeVariables()}function d(){return r.BV}function f(){return r.BV.memory()}function h(e){return r.BV.profile(e)}function m(e,t){return r.BV.tidy(e,t)}function v(e){(0,o.getTensorsInContainer)(e).forEach((function(e){return e.dispose()}))}function g(e){return r.BV.keep(e)}function y(e){return r.BV.time(e)}function b(e){return r.BV.setBackend(e)}function x(){return r.BV.ready()}function k(){return r.BV.backendName}function w(e){r.BV.removeBackend(e)}function S(e){return r.BV.findBackend(e)}function I(e){return r.BV.findBackendFactory(e)}function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return r.BV.registerBackend(e,t,n)}function T(){return r.BV.backend}function C(e,t){(0,a.OB)().setPlatform(e,t)}(0,i.FZ)(l)},6450:function(e,t,n){"use strict";n.d(t,{UQ:function(){return u},cb:function(){return f},fN:function(){return p},h7:function(){return l},pn:function(){return d},ti:function(){return c}});var r=n(3433),a=n(318),i=n(4376),o=n(8354),s=n(6147);function u(e){return s.hu(s.mf(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=(0,o._1)(t,"x","tf.grad","string_or_numeric"),i=null!=n?(0,o._1)(n,"dy","tf.grad"):null;return a.BV.tidy((function(){var t=a.BV.gradients((function(){return e(r)}),[r],i),n=t.value,o=t.grads;return null!=i&&s.k5(n.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),h(o),o[0]}))}}function c(e){return s.hu(s.mf(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){s.hu(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var i=(0,o.sI)(t,"args","tf.grads","string_or_numeric"),u=null!=n?(0,o._1)(n,"dy","tf.grads"):null;return a.BV.tidy((function(){var t=a.BV.gradients((function(){return e.apply(void 0,(0,r.Z)(i))}),i,u),n=t.value,o=t.grads;return null!=u&&s.k5(n.shape,u.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),h(o),o}))}}function l(e){return s.hu(s.mf(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){s.hu(t instanceof i.es,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),s.hu(null==n||n instanceof i.es,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=a.BV.gradients((function(){return e(t)}),[t],n),o=r.grads,u=r.value;return h(o),{grad:o[0],value:u}}}function p(e){return s.hu(s.mf(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){s.hu(Array.isArray(t)&&t.every((function(e){return e instanceof i.es})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),s.hu(null==n||n instanceof i.es,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var o=a.BV.gradients((function(){return e.apply(void 0,(0,r.Z)(t))}),t,n);return null!=n&&s.k5(o.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),h(o.grads),o}}function d(e,t){s.hu(s.mf(e),(function(){return"The f passed in variableGrads(f) must be a function"})),s.hu(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof i._w})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],a.BV.registeredVariables)t.push(a.BV.registeredVariables[r]);var o=n?t.filter((function(e){return!e.trainable})):null,u=t.length;t=t.filter((function(e){return e.trainable})),s.hu(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(u," variables is ")+"trainable."}));var c=a.BV.gradients(e,t,null,!0),l=c.value,p=c.grads;s.hu(p.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),s.hu(0===l.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(l.rank," tensor")}));var d={};return t.forEach((function(e,t){null!=p[t]&&(d[e.name]=p[t])})),null!=o&&o.forEach((function(e){return d[e.name]=null})),{value:l,grads:d}}function f(e){return a.BV.customGrad(e)}function h(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}},3772:function(e,t,n){"use strict";n.r(t),n.d(t,{Abs:function(){return yt.SY},Acos:function(){return yt.VG},Acosh:function(){return yt.Sp},AdadeltaOptimizer:function(){return sn},AdagradOptimizer:function(){return cn},AdamOptimizer:function(){return dn},AdamaxOptimizer:function(){return mn},Add:function(){return yt.mm},AddN:function(){return yt.Xz},All:function(){return yt.oT},Any:function(){return yt.IK},ArgMax:function(){return yt.sJ},ArgMin:function(){return yt.aJ},Asin:function(){return yt.M2},Asinh:function(){return yt.qw},Atan:function(){return yt.jM},Atan2:function(){return yt.QC},Atanh:function(){return yt.Oy},AvgPool:function(){return yt.Jh},AvgPool3D:function(){return yt._k},AvgPool3DGrad:function(){return yt.IM},AvgPoolGrad:function(){return yt.RO},BatchMatMul:function(){return yt.XL},BatchToSpaceND:function(){return yt.zw},Bincount:function(){return yt.zv},BroadcastArgs:function(){return yt.eE},BroadcastTo:function(){return yt.Ly},Cast:function(){return yt.RF},Ceil:function(){return yt.gJ},ClipByValue:function(){return yt.xn},Complex:function(){return yt.Zz},ComplexAbs:function(){return yt.yj},Concat:function(){return yt.Eh},Conv2D:function(){return yt.mh},Conv2DBackpropFilter:function(){return yt.wU},Conv2DBackpropInput:function(){return yt.wm},Conv3D:function(){return yt.x1},Conv3DBackpropFilterV2:function(){return yt.o2},Conv3DBackpropInputV2:function(){return yt.ik},Cos:function(){return yt.mc},Cosh:function(){return yt.TR},CropAndResize:function(){return yt.Vc},Cumprod:function(){return yt.By},Cumsum:function(){return yt.iH},DataStorage:function(){return _r.JL},DenseBincount:function(){return yt.QR},DepthToSpace:function(){return yt.T0},DepthwiseConv2dNative:function(){return yt.ci},DepthwiseConv2dNativeBackpropFilter:function(){return yt.sL},DepthwiseConv2dNativeBackpropInput:function(){return yt.y7},Diag:function(){return yt.$w},Dilation2D:function(){return yt.p4},Dilation2DBackpropFilter:function(){return yt.Vn},Dilation2DBackpropInput:function(){return yt.ek},ENV:function(){return y.Vi},Einsum:function(){return yt.$g},Elu:function(){return yt.SX},EluGrad:function(){return yt.HE},Environment:function(){return y.qA},Equal:function(){return yt.hd},Erf:function(){return yt.Om},Exp:function(){return yt.NE},ExpandDims:function(){return yt.YF},Expm1:function(){return yt.Y0},FFT:function(){return yt.vw},Fill:function(){return yt.de},FlipLeftRight:function(){return yt.Uy},Floor:function(){return yt.OR},FloorDiv:function(){return yt.je},FromPixels:function(){return yt.eB},FusedBatchNorm:function(){return yt.sH},FusedConv2D:function(){return yt._V},FusedDepthwiseConv2D:function(){return yt.lu},GatherNd:function(){return yt.q1},GatherV2:function(){return yt.qi},Greater:function(){return yt.iZ},GreaterEqual:function(){return yt.Ac},IFFT:function(){return yt.Qg},Identity:function(){return yt.iJ},Imag:function(){return yt.J_},IsFinite:function(){return yt.av},IsInf:function(){return yt.iW},IsNan:function(){return yt.r7},KernelBackend:function(){return _r.Zu},LRN:function(){return yt.eZ},LRNGrad:function(){return yt.Hh},LeakyRelu:function(){return yt.J$},Less:function(){return yt.vt},LessEqual:function(){return yt.CA},LinSpace:function(){return yt.e7},Log:function(){return yt.Zb},Log1p:function(){return yt.kU},LogSoftmax:function(){return yt.qC},LogicalAnd:function(){return yt.PY},LogicalNot:function(){return yt.Vf},LogicalOr:function(){return yt.MZ},LogicalXor:function(){return yt.w6},LowerBound:function(){return yt.qI},Max:function(){return yt.Yo},MaxPool:function(){return yt.mT},MaxPool3D:function(){return yt.OA},MaxPool3DGrad:function(){return yt.OU},MaxPoolGrad:function(){return yt.OV},MaxPoolWithArgmax:function(){return yt.vF},Maximum:function(){return yt.BM},Mean:function(){return yt.q2},Min:function(){return yt.c1},Minimum:function(){return yt.q8},MirrorPad:function(){return yt.jQ},Mod:function(){return yt.Vb},MomentumOptimizer:function(){return gn},Multinomial:function(){return yt.NZ},Multiply:function(){return yt.wY},Neg:function(){return yt.ku},NonMaxSuppressionV3:function(){return yt.uv},NonMaxSuppressionV4:function(){return yt.cy},NonMaxSuppressionV5:function(){return yt.W0},NotEqual:function(){return yt.yQ},OP_SCOPE_SUFFIX:function(){return kn.zvA},OneHot:function(){return yt.we},OnesLike:function(){return yt.qW},Optimizer:function(){return on},OptimizerConstructors:function(){return bn},Pack:function(){return yt.Qi},PadV2:function(){return yt.ly},Pool:function(){return yt.Kg},Pow:function(){return yt.pe},Prelu:function(){return yt.o0},Prod:function(){return yt.Dl},RMSPropOptimizer:function(){return yn},Range:function(){return yt.e6},Rank:function(){return xn.yw},Real:function(){return yt.xJ},RealDiv:function(){return yt.oH},Reciprocal:function(){return yt.$H},Reduction:function(){return wn.I},Relu:function(){return yt.qk},Relu6:function(){return yt.Sb},Reshape:function(){return yt.HZ},ResizeBilinear:function(){return yt._Y},ResizeBilinearGrad:function(){return yt.zb},ResizeNearestNeighbor:function(){return yt.dp},ResizeNearestNeighborGrad:function(){return yt.Hm},Reverse:function(){return yt.mK},RotateWithOffset:function(){return yt.b9},Round:function(){return yt.e0},Rsqrt:function(){return yt.bV},SGDOptimizer:function(){return vn},ScatterNd:function(){return yt.xQ},SearchSorted:function(){return yt.nr},Select:function(){return yt.Ph},Selu:function(){return yt.oF},Sigmoid:function(){return yt.a5},Sign:function(){return yt.i5},Sin:function(){return yt.RQ},Sinh:function(){return yt.w3},Slice:function(){return yt.p2},Softmax:function(){return yt.Gc},Softplus:function(){return yt.MR},SpaceToBatchND:function(){return yt.TQ},SparseFillEmptyRows:function(){return yt.O3},SparseReshape:function(){return yt.nh},SparseSegmentMean:function(){return yt.YW},SparseSegmentSum:function(){return yt.Zj},SparseToDense:function(){return yt.D2},SplitV:function(){return yt.L8},Sqrt:function(){return yt.FK},Square:function(){return yt.bK},SquaredDifference:function(){return yt._t},Step:function(){return yt.h8},StridedSlice:function(){return yt.m2},StringNGrams:function(){return yt._J},StringSplit:function(){return yt.s1},StringToHashBucketFast:function(){return yt.Xk},Sub:function(){return yt.Tr},Sum:function(){return yt.GB},Tan:function(){return yt.sE},Tanh:function(){return yt.MI},Tensor:function(){return Le.es},TensorBuffer:function(){return Le.YD},Tile:function(){return yt.n9},TopK:function(){return yt.cW},Transform:function(){return yt.wx},Transpose:function(){return yt.G3},Unique:function(){return yt.kp},Unpack:function(){return yt.To},UnsortedSegmentSum:function(){return yt.Qv},UpperBound:function(){return yt.XD},Variable:function(){return Le._w},ZerosLike:function(){return yt.Ru},_FusedMatMul:function(){return yt.us},abs:function(){return kn.WnP},acos:function(){return kn.Khb},acosh:function(){return kn.__u},add:function(){return kn.IHx},addN:function(){return kn.QBD},all:function(){return kn.$6P},any:function(){return kn.YjB},argMax:function(){return kn.NqF},argMin:function(){return kn.vHJ},asin:function(){return kn.ZRM},asinh:function(){return kn.VfV},atan:function(){return kn.z4N},atan2:function(){return kn.fvJ},atanh:function(){return kn.C80},avgPool:function(){return kn.wS1},avgPool3d:function(){return kn.uR5},backend:function(){return Yt.y3},backend_util:function(){return p},basicLSTMCell:function(){return kn.zEQ},batchNorm:function(){return kn.tgs},batchNorm2d:function(){return kn.Dxk},batchNorm3d:function(){return kn.JY5},batchNorm4d:function(){return kn.p3b},batchToSpaceND:function(){return kn.E4h},bincount:function(){return kn.yE8},booleanMaskAsync:function(){return kn.anm},broadcastArgs:function(){return kn.XsQ},broadcastTo:function(){return kn.UFq},broadcast_util:function(){return gt},browser:function(){return o},buffer:function(){return kn.f3b},cast:function(){return kn.pju},ceil:function(){return kn.mDi},clipByValue:function(){return kn.iUl},clone:function(){return kn.d9v},complex:function(){return kn.PYB},concat:function(){return kn.zoF},concat1d:function(){return kn.gME},concat2d:function(){return kn.Izb},concat3d:function(){return kn.MNy},concat4d:function(){return kn.ZaL},conv1d:function(){return kn.PAt},conv2d:function(){return kn.Tek},conv2dTranspose:function(){return kn.bc},conv3d:function(){return kn.pdZ},conv3dTranspose:function(){return kn.$QV},copyRegisteredKernels:function(){return bt.T3},cos:function(){return kn.mCk},cosh:function(){return kn.f9Y},cosineWindow:function(){return kn.mew},cumprod:function(){return kn.$Gn},cumsum:function(){return kn.zbp},customGrad:function(){return rn.cb},denseBincount:function(){return kn.ppE},deprecationWarn:function(){return Yt.MX},depthToSpace:function(){return kn.nTT},depthwiseConv2d:function(){return kn.B10},device_util:function(){return r},diag:function(){return kn.Ka3},dilation2d:function(){return kn.WmZ},disableDeprecationWarnings:function(){return Yt.cF},dispose:function(){return Yt.B9},disposeVariables:function(){return Yt.N8},div:function(){return kn.hiC},divNoNan:function(){return kn.NTj},dot:function(){return kn.AKD},dropout:function(){return kn.rvX},einsum:function(){return kn.WYO},elu:function(){return kn.pyx},enableDebugMode:function(){return Yt.R},enableProdMode:function(){return Yt.G4},enclosingPowerOfTwo:function(){return kn.GRh},engine:function(){return Yt.SR},env:function(){return y.OB},equal:function(){return kn.DgJ},erf:function(){return kn.qNN},euclideanNorm:function(){return kn.d2q},exp:function(){return kn.Qqt},expandDims:function(){return kn.dt4},expm1:function(){return kn.t$B},eye:function(){return kn.iyy},fft:function(){return kn.kp_},fill:function(){return kn.hlL},findBackend:function(){return Yt.x3},findBackendFactory:function(){return Yt.ze},floor:function(){return kn.GWj},floorDiv:function(){return kn.qPi},fused:function(){return kn.imm},gather:function(){return kn.Iqj},gatherND:function(){return kn.dbB},gather_util:function(){return s},getBackend:function(){return Yt.N_},getGradient:function(){return bt.uk},getKernel:function(){return bt.pI},getKernelsForBackend:function(){return bt.tr},grad:function(){return rn.UQ},grads:function(){return rn.ti},greater:function(){return kn.pjt},greaterEqual:function(){return kn.brS},ifft:function(){return kn.Sxn},imag:function(){return kn.asL},image:function(){return kn.BHj},inTopKAsync:function(){return kn.V3u},io:function(){return a},irfft:function(){return kn.wx0},isFinite:function(){return kn.xVT},isInf:function(){return kn.UWc},isNaN:function(){return kn.i2d},keep:function(){return Yt.Cn},kernel_impls:function(){return d},leakyRelu:function(){return kn.hi7},less:function(){return kn.d9m},lessEqual:function(){return kn.zN1},linalg:function(){return kn.$r2},linspace:function(){return kn.SX3},localResponseNormalization:function(){return kn.G9k},log:function(){return kn.cM7},log1p:function(){return kn.Krr},logSigmoid:function(){return kn.e_t},logSoftmax:function(){return kn.CmS},logSumExp:function(){return kn.l_t},logicalAnd:function(){return kn.HvI},logicalNot:function(){return kn.hJK},logicalOr:function(){return kn.K5V},logicalXor:function(){return kn.egP},losses:function(){return kn.MB5},lowerBound:function(){return kn.eab},matMul:function(){return kn.OI3},math:function(){return i},max:function(){return kn.Fp7},maxPool:function(){return kn._sB},maxPool3d:function(){return kn.YQQ},maxPoolWithArgmax:function(){return kn.Ip$},maximum:function(){return kn.gWQ},mean:function(){return kn.J69},memory:function(){return Yt.sq},meshgrid:function(){return kn.ry_},min:function(){return kn.VV$},minimum:function(){return kn.LTh},mirrorPad:function(){return kn.VdP},mod:function(){return kn.wQq},moments:function(){return kn.Gi7},movingAverage:function(){return kn.p_},mul:function(){return kn.dC7},multiRNNCell:function(){return kn.rq4},multinomial:function(){return kn.SJ_},neg:function(){return kn.W76},nextFrame:function(){return Nn},norm:function(){return kn.KOy},notEqual:function(){return kn.Quu},oneHot:function(){return kn.lfX},ones:function(){return kn.iUs},onesLike:function(){return kn.JpU},op:function(){return kn.op},outerProduct:function(){return kn.N2O},pad:function(){return kn.vku},pad1d:function(){return kn.pNR},pad2d:function(){return kn.koy},pad3d:function(){return kn.t1L},pad4d:function(){return kn.lGY},pool:function(){return kn.d_R},pow:function(){return kn.sQ3},prelu:function(){return kn.AL3},print:function(){return kn.S0v},prod:function(){return kn.WVs},profile:function(){return Yt.N5},rand:function(){return kn.TN_},randomGamma:function(){return kn.wzB},randomNormal:function(){return kn.nGf},randomStandardNormal:function(){return kn.ruB},randomUniform:function(){return kn.LGj},range:function(){return kn.w6H},ready:function(){return Yt.Cd},real:function(){return kn.kwC},reciprocal:function(){return kn.M25},registerBackend:function(){return Yt.jq},registerGradient:function(){return bt.Li},registerKernel:function(){return bt.wC},relu:function(){return kn.UYe},relu6:function(){return kn.btT},removeBackend:function(){return Yt.cj},reshape:function(){return kn.XLQ},reverse:function(){return kn.GYS},reverse1d:function(){return kn.SDf},reverse2d:function(){return kn.diP},reverse3d:function(){return kn.sx7},reverse4d:function(){return kn.mG2},rfft:function(){return kn.QEs},round:function(){return kn.NMM},rsqrt:function(){return kn.bp0},scalar:function(){return kn.iD$},scatterND:function(){return kn.snQ},scatter_util:function(){return _t},searchSorted:function(){return kn.zcT},selu:function(){return kn.U8D},separableConv2d:function(){return kn.U_I},serialization:function(){return u},setBackend:function(){return Yt.CQ},setPlatform:function(){return Yt.VY},setdiff1dAsync:function(){return kn.ODp},sigmoid:function(){return kn.XD2},sign:function(){return kn.Xxe},signal:function(){return kn.tdS},sin:function(){return kn.O$l},sinh:function(){return kn.R_K},slice:function(){return kn.tPi},slice1d:function(){return kn.jZU},slice2d:function(){return kn.SmN},slice3d:function(){return kn.CnO},slice4d:function(){return kn.p0P},slice_util:function(){return At},softmax:function(){return kn.XAC},softplus:function(){return kn.Wvh},spaceToBatchND:function(){return kn.fBT},sparse:function(){return kn.rVs},sparseToDense:function(){return kn.ers},spectral:function(){return kn.uN7},split:function(){return kn.Vl2},sqrt:function(){return kn._b3},square:function(){return kn.h62},squaredDifference:function(){return kn.$i},squeeze:function(){return kn.L9e},stack:function(){return kn.knu},step:function(){return kn.Nbs},stridedSlice:function(){return kn.NXj},string:function(){return kn.Z_8},sub:function(){return kn.luU},sum:function(){return kn.Smz},sumOutType:function(){return xn.z4},tan:function(){return kn.ORZ},tanh:function(){return kn.AEp},tensor:function(){return kn.XeE},tensor1d:function(){return kn.RRF},tensor2d:function(){return kn.odF},tensor3d:function(){return kn.wOQ},tensor4d:function(){return kn.yXz},tensor5d:function(){return kn.Bfx},tensor6d:function(){return kn.xZs},tensor_util:function(){return Zt},test_util:function(){return c},tidy:function(){return Yt.lu},tile:function(){return kn.Gg6},time:function(){return Yt.XV},topk:function(){return kn.hg7},train:function(){return Sn},transpose:function(){return kn.p4s},truncatedNormal:function(){return kn.Xu6},unique:function(){return kn.Two},unregisterGradient:function(){return bt.bt},unregisterKernel:function(){return bt.nE},unsortedSegmentSum:function(){return kn.pUJ},unstack:function(){return kn.HHK},upcastType:function(){return xn.x8},upperBound:function(){return kn.GaM},util:function(){return Ot},valueAndGrad:function(){return rn.h7},valueAndGrads:function(){return rn.fN},variable:function(){return kn.VD$},variableGrads:function(){return rn.pn},version_core:function(){return qt},where:function(){return kn.arb},whereAsync:function(){return kn.itS},zeros:function(){return kn.lls},zerosLike:function(){return kn.P84}});var r={};n.r(r),n.d(r,{isBrowser:function(){return g},isMobile:function(){return v},mockIsMobile:function(){return m}});var a={};n.r(a),n.d(a,{browserFiles:function(){return Ge},browserHTTPRequest:function(){return nt},concatenateArrayBuffers:function(){return L},copyModel:function(){return Te},decodeWeights:function(){return F},encodeWeights:function(){return A},fromMemory:function(){return ot},fromMemorySync:function(){return st},getLoadHandlers:function(){return X},getModelArtifactsForJSON:function(){return W},getModelArtifactsInfoForJSON:function(){return U},getSaveHandlers:function(){return K},http:function(){return tt},isHTTPScheme:function(){return $e},listModels:function(){return we},loadWeights:function(){return Ke},moveModel:function(){return Ee},registerLoadRouter:function(){return q},registerSaveRouter:function(){return H},removeModel:function(){return Ie},weightsLoaderFactory:function(){return Ye},withSaveHandler:function(){return ut},withSaveHandlerSync:function(){return ct}});var i={};n.r(i),n.d(i,{confusionMatrix:function(){return vt}});var o={};n.r(o),n.d(o,{fromPixels:function(){return Ct},fromPixelsAsync:function(){return St},toPixels:function(){return Nt}});var s={};n.r(s),n.d(s,{prepareAndValidate:function(){return Et}});var u={};n.r(u),n.d(u,{Serializable:function(){return Rt},SerializationMap:function(){return Ft},registerClass:function(){return Dt}});var c={};n.r(c),n.d(c,{TEST_EPSILON_FLOAT16:function(){return Mt},encodeStrings:function(){return Ht},expectArrayBuffersEqual:function(){return jt},expectArraysClose:function(){return zt},expectArraysEqual:function(){return Wt},expectNumbersClose:function(){return Vt},expectPromiseToFail:function(){return Bt},expectValuesInRange:function(){return Gt},testEpsilon:function(){return Lt}});var l={};n.r(l),n.d(l,{collectGatherOpShapeInfo:function(){return Ir},computeOutShape:function(){return Sr},segOpComputeOptimalWindowSize:function(){return wr}});var p={};n.r(p),n.d(p,{ERF_A1:function(){return Wn},ERF_A2:function(){return Vn},ERF_A3:function(){return Un},ERF_A4:function(){return Gn},ERF_A5:function(){return jn},ERF_P:function(){return Bn},PARALLELIZE_THRESHOLD:function(){return Rn},SELU_SCALE:function(){return Pn.$},SELU_SCALEALPHA:function(){return Pn.y},applyActivation:function(){return An.QH},assertAndGetBroadcastShape:function(){return gt.assertAndGetBroadcastShape},assertAxesAreInnerMostDims:function(){return Tn.lB},assertParamsConsistent:function(){return Cn},assignToTypedArray:function(){return Jn},axesAreInnerMostDims:function(){return Tn.YB},calculateShapes:function(){return _t.calculateShapes},checkEinsumDimSizes:function(){return ir},checkPadOnDimRoundingMode:function(){return _n.m},combineLocations:function(){return Tn.Vh},complexWithEvenIndex:function(){return Xn},complexWithOddIndex:function(){return Yn},computeConv2DInfo:function(){return _n.Ix},computeConv3DInfo:function(){return _n.jw},computeDefaultPad:function(){return _n.aO},computeDilation2DInfo:function(){return _n.Rf},computeOptimalWindowSize:function(){return Fn},computeOutAndReduceShapes:function(){return Tn.kz},computeOutShape:function(){return En},computePool2DInfo:function(){return _n.Xw},computePool3DInfo:function(){return _n.pl},convertConv2DDataFormat:function(){return _n.sl},decodeEinsumEquation:function(){return rr},eitherStridesOrDilationsAreOne:function(){return _n.jT},expandShapeToKeepDim:function(){return Tn.rv},exponent:function(){return er},exponents:function(){return $n},fromStringArrayToUint8:function(){return Tr},fromUint8ToStringArray:function(){return Nr},getAxesPermutation:function(){return Tn.Q3},getBroadcastDims:function(){return gt.getBroadcastDims},getComplexWithIndex:function(){return Qn},getEinsumComputePath:function(){return or},getEinsumPermutation:function(){return ar},getFusedBiasGradient:function(){return An.pf},getFusedDyActivation:function(){return An.Fr},getImageCenter:function(){return Dn},getInnerMostAxes:function(){return Tn.sY},getPermuted:function(){return On},getReductionAxes:function(){return gt.getReductionAxes},getReshaped:function(){return Zn},getReshapedPermuted:function(){return Mn},getSliceBeginCoords:function(){return zn},getSliceSize:function(){return Ln},getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(){return lr},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(){return pr},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(){return dr},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return mr},getSparseReshapeInputOutputMismatchErrorMessage:function(){return gr},getSparseReshapeInputOutputMultipleErrorMessage:function(){return vr},getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(){return fr},getSparseReshapeNegativeOutputDimErrorMessage:function(){return hr},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(){return kr},getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return yr},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return br},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(){return xr},getUndoAxesPermutation:function(){return Tn.LJ},isIdentityPermutation:function(){return sr},log:function(){return Hn.c},mergeRealAndImagArrays:function(){return qn},prepareAndValidate:function(){return Et},prepareSplitSize:function(){return cr},segment_util:function(){return l},shouldFuse:function(){return An.uy},slice_util:function(){return At},splitRealAndImagArrays:function(){return Kn},tupleValuesAreOne:function(){return _n.I0},upcastType:function(){return xn.x8},validateInput:function(){return _t.validateInput},validateUpdateShape:function(){return _t.validateUpdateShape},warn:function(){return Hn.Z}});var d={};n.r(d),n.d(d,{nonMaxSuppressionV3Impl:function(){return Cr.GP},nonMaxSuppressionV4Impl:function(){return Cr.qP},nonMaxSuppressionV5Impl:function(){return Cr.pA},whereImpl:function(){return Er.Z}});var f,h=n(318);function m(e){f=e}function v(e){if(void 0!==f)return f;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function g(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}var y=n(5050),b=(0,y.OB)();b.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),b.registerFlag("IS_BROWSER",(function(){return g()})),b.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),b.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),b.registerFlag("PROD",(function(){return!1})),b.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return b.getBool("DEBUG")})),b.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),b.registerFlag("IS_TEST",(function(){return!1})),b.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),b.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),b.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var x=n(5671),k=n(3144),w=n(7762),S=n(4165),I=n(5861),N=n(9439),T=n(9253),C=n(2442),E=n(6147),_={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function A(e,t){return R.apply(this,arguments)}function R(){return R=(0,I.Z)((0,S.Z)().mark((function e(t,n){var r,a,i,o,s,u;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var c=new Promise(function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r,a,i,o,u,c;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(c)}else a.push(s.data());null!=n&&(u.group=n),r.push(u)},s=0;s<i.length;++s)o(s);return e.next=7,Promise.all(a);case 7:return u=e.sent,e.abrupt("return",{data:D(u),specs:r});case 9:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}function F(e,t){var n,r,a={},i=0,o=(0,w.Z)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,p=(0,E.NA)(l),d=void 0;if("quantization"in s){var f=s.quantization;if("uint8"===f.dtype||"uint16"===f.dtype){if(!("min"in f)||!("scale"in f))throw new Error("Weight ".concat(s.name," with quantization ").concat(f.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==f.dtype)throw new Error("Weight ".concat(s.name," has unknown ")+"quantization dtype ".concat(f.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(f.dtype," ")+"which only supports weights of type float32 not ".concat(c,"."))}var h=_[f.dtype],m=e.slice(i,i+p*h),v="uint8"===f.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===f.dtype||"uint16"===f.dtype){d=new Float32Array(v.length);for(var g=0;g<v.length;g++){var y=v[g];d[g]=y*f.scale+f.min}}else{if("float16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," ")+"for weight type float32.");void 0===n&&(n=G()),d=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," ")+"for weight type int32.");d=new Int32Array(v.length);for(var b=0;b<v.length;b++){var x=v[b];d[b]=Math.round(x*f.scale+f.min)}}i+=p*h}else if("string"===c){var k=(0,E.NA)(s.shape);d=[];for(var S=0;S<k;S++){var I=new Uint32Array(e.slice(i,i+4))[0];i+=4;var N=new Uint8Array(e.slice(i,i+I));d.push(N),i+=I}}else{var A=_[c],R=e.slice(i,i+p*A);if("float32"===c)d=new Float32Array(R);else if("int32"===c)d=new Int32Array(R);else if("bool"===c)d=new Uint8Array(R);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));d=new Float32Array(R);for(var F=new Float32Array(d.length/2),D=new Float32Array(d.length/2),Z=0;Z<F.length;Z++)F[Z]=d[2*Z],D[Z]=d[2*Z+1];var O=(0,C.X)(F,l,"float32"),M=(0,C.X)(D,l,"float32");a[u]=(0,T.P)(O,M),O.dispose(),M.dispose()}i+=p*A}"complex64"!==c&&(a[u]=(0,C.X)(d,l,c))}}catch(z){o.e(z)}finally{o.f()}return a}function D(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var Z="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function O(e){return Z?Buffer.byteLength(e):new Blob([e]).size}function M(e){if(Z)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function z(e){if(Z){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function L(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function P(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function B(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function W(e,t){return V.apply(this,arguments)}function V(){return V=(0,I.Z)((0,S.Z)().mark((function e(t,n){var r,a,i,o,s;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},null!=t.trainingConfig&&(r.trainingConfig=t.trainingConfig),null==t.weightsManifest){e.next=11;break}return e.next=5,n(t.weightsManifest);case 5:a=e.sent,i=(0,N.Z)(a,2),o=i[0],s=i[1],r.weightSpecs=o,r.weightData=s;case 11:return null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),e.abrupt("return",r);case 15:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}function U(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:O(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:O(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function G(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var j=function(){function e(){(0,x.Z)(this,e),this.saveRouters=[],this.loadRouters=[]}return(0,k.Z)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),H=function(e){return j.registerSaveRouter(e)},q=function(e){return j.registerLoadRouter(e)},K=function(e){return j.getSaveHandlers(e)},X=function(e,t){return j.getLoadHandlers(e,t)},Y="tensorflowjs",Q="models_store",J="model_info_store";function $(){if(!(0,y.OB)().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function ee(e){var t=e.result;t.createObjectStore(Q,{keyPath:"modelPath"}),t.createObjectStore(J,{keyPath:"modelPath"})}var te=function(){function e(t){if((0,x.Z)(this,e),this.indexedDB=$(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return(0,k.Z)(e,[{key:"save",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(Y,1);a.onupgradeneeded=function(){return ee(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(Q,"readonly"),s=o.objectStore(Q).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=U(t),l=i.transaction(J,"readwrite"),p=l.objectStore(J),d=p.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var a=(u=i.transaction(Q,"readwrite")).objectStore(Q).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(p=l.objectStore(J)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},d.onerror=function(e){return i.close(),r(d.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();te.URL_SCHEME="indexeddb://";var ne=function(e){return(0,y.OB)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(te.URL_SCHEME)?(t=e.slice(te.URL_SCHEME.length),new te(t)):null;var t};j.registerSaveRouter(ne),j.registerLoadRouter(ne);var re=function(){function e(){(0,x.Z)(this,e),this.indexedDB=$()}return(0,k.Z)(e,[{key:"listModels",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){var t=this;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(Y,1);r.onupgradeneeded=function(){return ee(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(J,"readonly"),i=a.objectStore(J).getAll();i.onsuccess=function(){var t,n={},r=(0,w.Z)(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n=this;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(te.URL_SCHEME)?r.slice(te.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(Y,1);a.onupgradeneeded=function(){return ee(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(J,"readwrite"),s=o.objectStore(J),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction(Q,"readwrite")).objectStore(Q).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ae="/",ie="tensorflowjs_models",oe="info",se="model_topology",ue="weight_specs",ce="weight_data",le="model_metadata";function pe(e){return{info:[ie,e,oe].join(ae),topology:[ie,e,se].join(ae),weightSpecs:[ie,e,ue].join(ae),weightData:[ie,e,ce].join(ae),modelMetadata:[ie,e,le].join(ae)}}function de(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function fe(e){var t=e.split(ae);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(ae)}var he=function(){function e(t){if((0,x.Z)(this,e),!(0,y.OB)().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=pe(this.modelPath)}return(0,k.Z)(e,[{key:"save",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r,a,i;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=U(t),e.prev=7,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,M(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),e.abrupt("return",{modelArtifactsInfo:a});case 17:throw e.prev=17,e.t0=e.catch(7),de(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 21:case"end":return e.stop()}}),e,this,[[7,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=z(s),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();he.URL_SCHEME="localstorage://";var me=function(e){return(0,y.OB)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(he.URL_SCHEME)?(t=e.slice(he.URL_SCHEME.length),new he(t)):null;var t};j.registerSaveRouter(me),j.registerLoadRouter(me);var ve=function(){function e(){(0,x.Z)(this,e),(0,E.hu)((0,y.OB)().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),(0,E.hu)("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return(0,k.Z)(e,[{key:"listModels",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){var t,n,r,a,i,o;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=ie+ae,r=ae+oe,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=fe(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(he.URL_SCHEME)?a.slice(he.URL_SCHEME.length):a,n=pe(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),de(n),e.abrupt("return",r);case 7:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ge="://",ye=function(){function e(){(0,x.Z)(this,e),this.managers={}}return(0,k.Z)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){(0,E.hu)(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(ge)&&(t=t.slice(0,t.indexOf(ge))),(0,E.hu)(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();(0,E.hu)(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function be(e){if(-1===e.indexOf(ge))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(ye.getSchemes().join(",")));return{scheme:e.split(ge)[0],path:e.split(ge)[1]}}function xe(e,t){return ke.apply(this,arguments)}function ke(){return ke=(0,I.Z)((0,S.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,f=arguments;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>2&&void 0!==f[2]&&f[2],(0,E.hu)(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),a=j.getLoadHandlers(t),(0,E.hu)(a.length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),(0,E.hu)(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"load handlers for source URL ".concat(t,".")})),i=a[0],o=j.getSaveHandlers(n),(0,E.hu)(o.length>0,(function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(n,".")})),(0,E.hu)(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"save handlers for destination URL ".concat(n,".")})),s=o[0],u=be(t).scheme,c=be(t).path,l=u===be(t).scheme,e.next=15,i.load();case 15:if(p=e.sent,!r||!l){e.next=19;break}return e.next=19,ye.getManager(u).removeModel(c);case 19:return e.next=21,s.save(p);case 21:if(d=e.sent,!r||l){e.next=25;break}return e.next=25,ye.getManager(u).removeModel(c);case 25:return e.abrupt("return",d.modelArtifactsInfo);case 26:case"end":return e.stop()}}),e)}))),ke.apply(this,arguments)}function we(){return Se.apply(this,arguments)}function Se(){return(Se=(0,I.Z)((0,S.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ye.getSchemes(),n={},r=(0,w.Z)(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=13;break}return i=a.value,e.next=9,ye.getManager(i).listModels();case 9:for(s in o=e.sent)n[i+ge+s]=o[s];case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))).apply(this,arguments)}function Ie(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=be(t),r=ye.getManager(n.scheme),e.abrupt("return",r.removeModel(n.path));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e,t){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,I.Z)((0,S.Z)().mark((function e(t,n){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,e.abrupt("return",xe(t,n,false));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(e,t){return _e.apply(this,arguments)}function _e(){return(_e=(0,I.Z)((0,S.Z)().mark((function e(t,n){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0,e.abrupt("return",xe(t,n,true));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ae=function(){function e(){(0,x.Z)(this,e)}return(0,k.Z)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if((0,y.OB)().get("IS_BROWSER")){(0,y.OB)().setPlatform("browser",new Ae);try{ye.registerManager(he.URL_SCHEME,new ve)}catch(Ar){}try{ye.registerManager(te.URL_SCHEME,new re)}catch(Ar){}}var Re,Fe=function(){return n(5410)};var De=function(){function e(){(0,x.Z)(this,e),this.util=n(8628),this.textEncoder=new this.util.TextEncoder}return(0,k.Z)(e,[{key:"fetch",value:function(e,t){return null!=(0,y.OB)().global.fetch?(0,y.OB)().global.fetch(e,t):(null==Re&&(Re=Fe()),Re(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}();(0,y.OB)().get("IS_NODE")&&!(0,y.OB)().get("IS_BROWSER")&&(0,y.OB)().setPlatform("node",new De);var Ze=n(7039),Oe=n(9118),Me=n(672),ze=n(4600),Le=n(4376);(0,h.wv)();var Pe={buffer:Ze.f,cast:Oe.p,clone:Me.d,print:ze.S};(0,Le.Vp)(Pe);var Be=n(3433);function We(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Ve=function(){function e(t){if((0,x.Z)(this,e),!(0,y.OB)().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return(0,k.Z)(e,[{key:"save",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r,a,i,o,s;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=7;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 7:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=B(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=15,We((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 15:if(null==t.weightData){e.next=21;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=21,We((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 21:return e.abrupt("return",{modelArtifactsInfo:U(t)});case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();Ve.URL_SCHEME="downloads://";var Ue=function(){function e(t){if((0,x.Z)(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return(0,k.Z)(e,[{key:"load",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){var t=this;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=W(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON "+"from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=(0,w.Z)(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,(0,Be.Z)(o.weights)),a.push.apply(a,(0,Be.Z)(o.paths))}}catch(Ar){i.e(Ar)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,L(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return P(e.name)})),i={},o=(0,w.Z)(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=P(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(Ar){o.e(Ar)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(r.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return i}}]),e}();function Ge(e){return new Ue(e)}function je(e,t,n,r){!function(e){(0,E.hu)(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){(0,E.hu)(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),(0,E.hu)(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),(0,E.hu)(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function He(e,t){return qe.apply(this,arguments)}function qe(){return(qe=(0,I.Z)((0,S.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?(0,y.OB)().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,je(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,u=s.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(u);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,je(u,n.onProgress,c,l);case 26:e.t1=e.sent;case 27:return p=e.t1,e.abrupt("return",p);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ke(e){return Xe.apply(this,arguments)}function Xe(){return Xe=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r,a,i,o=arguments;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,i=Ye((function(e){return He(e,{requestInit:a})})),e.abrupt("return",i(t,n,r));case 6:case"end":return e.stop()}}),e)}))),Xe.apply(this,arguments)}function Ye(e){return function(){var t=(0,I.Z)((0,S.Z)().mark((function t(n){var r,a,i,o,s,u,c,l,p,d,f,h,m=arguments;return(0,S.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=_[r]*E.NA(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=10;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));case 10:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),p=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;p.push(t)}))})),t.next=15,e(p);case 15:return d=t.sent,f={},h=0,l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=d[h+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(d[h+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=F(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)f[n]=t[n]})),h+=t})),t.abrupt("return",f);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}j.registerSaveRouter((function(e){return(0,y.OB)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ve.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Ve(e)}(e.slice(Ve.URL_SCHEME.length)):null}));var Qe=function(){function e(t,n){if((0,x.Z)(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?((0,E.hu)("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=(0,y.OB)().platform.fetch,(0,E.hu)(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&(0,E.hu)(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return(0,k.Z)(e,[{key:"save",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r,a,i;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=B(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=10,this.fetch(this.path,n);case 10:if(!(i=e.sent).ok){e.next=15;break}return e.abrupt("return",{modelArtifactsInfo:U(t),responses:[i]});case 15:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){var t,n,r,a,i,o=this;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=20;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 20:return e.abrupt("return",W(n,(function(e){return o.loadWeights(e)})));case 21:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,d,f,h,m,v,g,y,b,x;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=Je(n),a=(0,N.Z)(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=(0,w.Z)(t);try{for(c.s();!(l=c.n()).done;)p=l.value,u.push.apply(u,(0,Be.Z)(p.weights))}catch(Ar){c.e(Ar)}finally{c.f()}d=[],f=[],h=(0,w.Z)(t);try{for(h.s();!(m=h.n()).done;){v=m.value,g=(0,w.Z)(v.paths);try{for(g.s();!(y=g.n()).done;)b=y.value,null!=this.weightUrlConverter?f.push(this.weightUrlConverter(b)):d.push(s+b+o)}catch(Ar){g.e(Ar)}finally{g.f()}}}catch(Ar){h.e(Ar)}finally{h.f()}if(!this.weightUrlConverter){e.next=19;break}return e.t0=d.push,e.t1=d,e.t2=Be.Z,e.next=16,Promise.all(f);case 16:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 19:return e.next=21,He(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 21:return x=e.sent,e.abrupt("return",[u,L(x)]);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Je(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function $e(e){return null!=e.match(Qe.URL_SCHEME_REGEX)}Qe.URL_SCHEME_REGEX=/^https?:\/\//;var et=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return $e(e)})):$e(e))?tt(e,t):null};function tt(e,t){return new Qe(e,t)}function nt(e,t){return tt(e,t)}j.registerSaveRouter(et),j.registerLoadRouter(et);var rt=function(){function e(t){(0,x.Z)(this,e),this.modelArtifacts=t}return(0,k.Z)(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),at=function(){function e(t){(0,x.Z)(this,e),this.saveHandler=t}return(0,k.Z)(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),it=(0,k.Z)((function e(t){(0,x.Z)(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function ot(e,t,n,r){var a=arguments;return new it(st.apply(void 0,(0,Be.Z)(a)))}function st(e,t,n,r){if(1===arguments.length){var a=null!=e.modelTopology||null!=e.weightSpecs;return a?new rt(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new rt({modelTopology:e}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new rt({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})}function ut(e){return new at(e)}function ct(e){return new at(e)}var lt=n(8354),pt=n(7221),dt=n(4326),ft=n(8640),ht=n(1240);var mt,vt=(0,ft.op)({confusionMatrix_:function(e,t,n){var r=(0,lt._1)(e,"labels","confusionMatrix"),a=(0,lt._1)(t,"predictions","confusionMatrix");E.hu(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(n)})),E.hu(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)})),E.hu(1===a.rank,(function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)})),E.hu(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: "+"".concat(r.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."})),E.hu(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+"".concat(n)}));var i=(0,dt.l)((0,Oe.p)(r,"int32"),n),o=(0,dt.l)((0,Oe.p)(a,"int32"),n),s=(0,ht.p)(i),u=(0,pt.O)(s,o);return(0,Oe.p)(u,"int32")}}),gt=n(5774),yt=n(2145),bt=n(8864),xt=n(3123);function kt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));s=!0}if(a){var u=2;if(a&&e.readyState<u)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}var c=(0,bt.pI)(yt.eB,h.BV.backendName);if(null!=c){var l={pixels:e},p={numChannels:t};return h.BV.runKernel(yt.eB,l,p)}var d,f,m=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],v=(0,N.Z)(m,2),g=v[0],y=v[1];if(o)d=e.getContext("2d").getImageData(0,0,g,y).data;else if(r||n)d=e.data;else if(i||a||s){if(null==mt)if("undefined"===typeof document){if("undefined"===typeof OffscreenCanvas||"undefined"===typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");mt=new OffscreenCanvas(1,1).getContext("2d")}else mt=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});mt.canvas.width=g,mt.canvas.height=y,mt.drawImage(e,0,0,g,y),d=mt.getImageData(0,0,g,y).data}if(4===t)f=new Int32Array(d);else{var b=g*y;f=new Int32Array(b*t);for(var x=0;x<b;x++)for(var k=0;k<t;++k)f[x*t+k]=d[4*x+k]}var w=[y,g,t];return(0,xt.w)(f,w,"int32")}function wt(e){return"undefined"!==typeof window&&"undefined"!==typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function St(e){return It.apply(this,arguments)}function It(){return It=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r,a,i=arguments;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:3,r=null,!(0,y.OB)().getBool("WRAP_TO_IMAGEBITMAP")||!wt(t)){e.next=15;break}return e.prev=3,e.next=6,createImageBitmap(t,{premultiplyAlpha:"none"});case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=null;case 12:r=null!=a&&a.width===t.width&&a.height===t.height?a:t,e.next=16;break;case 15:r=t;case 16:return e.abrupt("return",kt(r,n));case 17:case"end":return e.stop()}}),e,null,[[3,9]])}))),It.apply(this,arguments)}function Nt(e,t){return Tt.apply(this,arguments)}function Tt(){return(Tt=(0,I.Z)((0,S.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,f,h,m,v,g,y,b;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,lt._1)(t,"img","toPixels"),t instanceof Le.es||(a=r,r=(0,Oe.p)(a,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),o=(0,N.Z)(i,2),s=o[0],u=o[1],!((c=2===r.rank?1:r.shape[2])>4||2===c)){e.next=8;break}throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(c));case 8:if("float32"===r.dtype||"int32"===r.dtype){e.next=10;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,".")+" Please use float32 or int32 tensors.");case 10:return e.next=12,r.data();case 12:l=e.sent,p="float32"===r.dtype?255:1,d=new Uint8ClampedArray(u*s*4),f=0;case 16:if(!(f<s*u)){e.next=41;break}h=[0,0,0,255],m=0;case 19:if(!(m<c)){e.next=33;break}if(v=l[f*c+m],"float32"!==r.dtype){e.next=26;break}if(!(v<0||v>1)){e.next=24;break}throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(v,"."));case 24:e.next=29;break;case 26:if("int32"!==r.dtype){e.next=29;break}if(!(v<0||v>255)){e.next=29;break}throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(v,"."));case 29:1===c?(h[0]=v*p,h[1]=v*p,h[2]=v*p):h[m]=v*p;case 30:m++,e.next=19;break;case 33:d[(g=4*f)+0]=Math.round(h[0]),d[g+1]=Math.round(h[1]),d[g+2]=Math.round(h[2]),d[g+3]=Math.round(h[3]);case 38:++f,e.next=16;break;case 41:return null!=n&&(n.width=u,n.height=s,y=n.getContext("2d"),b=new ImageData(d,u,s),y.putImageData(b,0,0)),r!==t&&r.dispose(),e.abrupt("return",d);case 44:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ct=(0,ft.op)({fromPixels_:kt});function Et(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===(0,E.NA)(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,p=i;p<n;++p)l*=u[p],c.push(u[p]);var d=[].concat((0,Be.Z)((0,E.e3)(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,d]}var _t=n(8604),At=n(2875),Rt=function(){function e(){(0,x.Z)(this,e)}return(0,k.Z)(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),Ft=function(){function e(){(0,x.Z)(this,e),this.classNameMap={}}return(0,k.Z)(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function Dt(e){(0,E.hu)(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),(0,E.hu)("string"===typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),(0,E.hu)(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Ft.register(e)}var Zt=n(9064),Ot=n(115),Mt=.1;function zt(e,t,n){return null==n&&(n=Lt()),Pt(e,t,(function(e,t){return Ut(e,t,n)}))}function Lt(){return 32===h.BV.backend.floatPrecision()?.001:Mt}function Pt(e,t,n){var r=!0;if(((0,E.fU)(e)||(0,E.fU)(t))&&(r=!1),(0,E.fU)(e)&&(0,E.fU)(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". ")+"Expected: ".concat(i))}if(Array.isArray(e)&&Array.isArray(t)){var o=(0,lt.C)(e),s=(0,lt.C)(t);if(!(0,E.cO)(o,s))throw new Error("Arrays have different shapes. "+"Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=(0,E.fU)(e)?e:(0,E.xH)(e),c=(0,E.fU)(t)?t:(0,E.xH)(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs ")+"expected: ".concat(c.length,".\n")+"Actual:   ".concat(u,".\n")+"Expected: ".concat(c,"."));for(var l=0;l<c.length;++l){var p=u[l],d=c[l];if(!n(p,d))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(p,", expected[").concat(l,"] = ").concat(d,".\n")+"Actual:   ".concat(u,".\n")+"Expected: ".concat(c,"."))}}function Bt(e,t){e().then((function(){return t.fail()}),(function(){return t()}))}function Wt(e,t){var n="string"===typeof t||"number"===typeof t||"boolean"===typeof t?[t]:t;return(0,E.HD)(e)||(0,E.HD)(e[0])||(0,E.HD)(t)||(0,E.HD)(t[0])?Pt(e,n,(function(e,t){return e==t})):Pt(e,t,(function(e,t){return Ut(e,t,0)}))}function Vt(e,t,n){if(null==n&&(n=Lt()),!Ut(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t))}function Ut(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function Gt(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))}function jt(e,t){var n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error("Expected ArrayBuffer to be of length "+"".concat(r.length,", but it was ").concat(n.length));for(var a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ")+"".concat(r[a]," but got ").concat(n[a]," instead"))}function Ht(e){for(var t=0;t<e.length;t++){var n=e[t];Array.isArray(n)?Ht(n):e[t]=(0,Ot.encodeString)(n)}return e}var qt="3.19.0",Kt=n(136),Xt=n(9388),Yt=n(5875),Qt=n(3312),Jt=n(5750),$t=n(651),en=n(6902),tn=n(7391),nn=n(7293),rn=n(6450),an=n(7067),on=function(e){(0,Kt.Z)(n,e);var t=(0,Xt.Z)(n);function n(){return(0,x.Z)(this,n),t.apply(this,arguments)}return(0,k.Z)(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return(0,Yt.B9)(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return(0,rn.pn)(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&(0,Yt.B9)(this.iterations_)}},{key:"saveIterations",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this.iterations_&&(this.iterations_=0),e.abrupt("return",{name:"iter",tensor:(0,an.i)(this.iterations_,"int32")});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Rt);Object.defineProperty(on,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var sn=function(e){(0,Kt.Z)(n,e);var t=(0,Xt.Z)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,x.Z)(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=h.BV.backend.epsilon()),a}return(0,k.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=h.BV.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:(0,Yt.lu)((function(){return(0,nn.P)(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:(0,Yt.lu)((function(){return(0,nn.P)(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;(0,Yt.lu)((function(){var e=(0,Qt.I)((0,$t.d)(o,t.rho),(0,$t.d)((0,tn.h)(i),1-t.rho)),n=(0,$t.d)((0,Jt.h)((0,en._)((0,Qt.I)(s,t.epsilon)),(0,en._)((0,Qt.I)(o,t.epsilon))),i),r=(0,Qt.I)((0,$t.d)(s,t.rho),(0,$t.d)((0,tn.h)(n),1-t.rho));o.assign(e),s.assign(r);var u=(0,Qt.I)((0,$t.d)(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&((0,Yt.B9)(this.accumulatedGrads.map((function(e){return e.variable}))),(0,Yt.B9)(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){var t;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,Be.Z)(this.accumulatedGrads),(0,Be.Z)(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(on);sn.className="Adadelta",Dt(sn);var un=n(8582),cn=function(e){(0,Kt.Z)(n,e);var t=(0,Xt.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return(0,x.Z)(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return(0,k.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=h.BV.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:(0,Yt.lu)((function(){return(0,un.h)(a.shape,t.initialAccumulatorValue).variable(false)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;(0,Yt.lu)((function(){var e=(0,Qt.I)(o,(0,tn.h)(i));o.assign(e);var n=(0,Qt.I)((0,$t.d)((0,Jt.h)(i,(0,en._)((0,Qt.I)(e,h.BV.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&(0,Yt.B9)(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(on);cn.className="Adagrad",Dt(cn);var ln=n(4334),pn=n(4774),dn=function(e){(0,Kt.Z)(n,e);var t=(0,Xt.Z)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,x.Z)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],(0,Yt.lu)((function(){i.accBeta1=(0,an.i)(r).variable(),i.accBeta2=(0,an.i)(a).variable()})),null==o&&(i.epsilon=h.BV.backend.epsilon()),i}return(0,k.Z)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);(0,Yt.lu)((function(){var r=(0,pn.l)(1,t.accBeta1),a=(0,pn.l)(1,t.accBeta2);n.forEach((function(n,i){var o=h.BV.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:(0,Yt.lu)((function(){return(0,nn.P)(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:(0,Yt.lu)((function(){return(0,nn.P)(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=(0,Qt.I)((0,$t.d)(u,t.beta1),(0,$t.d)(s,1-t.beta1)),p=(0,Qt.I)((0,$t.d)(c,t.beta2),(0,$t.d)((0,tn.h)(s),1-t.beta2)),d=(0,Jt.h)(l,r),f=(0,Jt.h)(p,a);u.assign(l),c.assign(p);var m=(0,Qt.I)((0,$t.d)((0,Jt.h)(d,(0,Qt.I)((0,en._)(f),t.epsilon)),-t.learningRate),o);o.assign(m)}})),t.accBeta1.assign((0,$t.d)(t.accBeta1,t.beta1)),t.accBeta2.assign((0,$t.d)(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&(0,Yt.B9)(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&(0,Yt.B9)(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){var t;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,Be.Z)(this.accumulatedFirstMoment),(0,Be.Z)(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r=this;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,(0,Yt.lu)((function(){r.accBeta1.assign((0,ln.s)(r.beta1,r.iterations_+1)),r.accBeta2.assign((0,ln.s)(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(on);dn.className="Adam",Dt(dn);var fn=n(7613),hn=n(705),mn=function(e){(0,Kt.Z)(n,e);var t=(0,Xt.Z)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return(0,x.Z)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],(0,Yt.lu)((function(){i.iteration=(0,an.i)(0).variable(),i.accBeta1=(0,an.i)(r).variable()})),null==o&&(i.epsilon=h.BV.backend.epsilon()),i}return(0,k.Z)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);(0,Yt.lu)((function(){var r=(0,pn.l)(1,t.accBeta1),a=(0,Jt.h)(-t.learningRate,(0,Qt.I)((0,$t.d)(t.iteration,t.decay),1));n.forEach((function(n,i){var o=h.BV.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:(0,nn.P)(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:(0,nn.P)(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=(0,Qt.I)((0,$t.d)(u,t.beta1),(0,$t.d)(s,1-t.beta1)),p=(0,$t.d)(c,t.beta2),d=(0,fn.W)(s),f=(0,hn.g)(p,d);u.assign(l),c.assign(f);var m=(0,Qt.I)((0,$t.d)((0,Jt.h)(a,r),(0,Jt.h)(l,(0,Qt.I)(f,t.epsilon))),o);o.assign(m)}})),t.iteration.assign((0,Qt.I)(t.iteration,1)),t.accBeta1.assign((0,$t.d)(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&(0,Yt.B9)(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&(0,Yt.B9)(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(on);mn.className="Adamax",Dt(mn);var vn=function(e){(0,Kt.Z)(n,e);var t=(0,Xt.Z)(n);function n(e){var r;return(0,x.Z)(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return(0,k.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=h.BV.registeredVariables[n];(0,Yt.lu)((function(){var e=(0,Qt.I)((0,$t.d)(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=(0,Yt.Cn)((0,an.i)(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(on);vn.className="SGD",Dt(vn);var gn=function(e){(0,Kt.Z)(n,e);var t=(0,Xt.Z)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,x.Z)(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=(0,an.i)(a.momentum),a}return(0,k.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=h.BV.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:(0,Yt.lu)((function(){return(0,nn.P)(a).variable(false)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&(0,Yt.lu)((function(){var e,n=(0,Qt.I)((0,$t.d)(t.m,i),o);e=t.useNesterov?(0,Qt.I)((0,$t.d)(t.c,(0,Qt.I)(o,(0,$t.d)(n,t.m))),a):(0,Qt.I)((0,$t.d)(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&(0,Yt.B9)(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(vn);gn.className="Momentum",Dt(gn);var yn=function(e){(0,Kt.Z)(n,e);var t=(0,Xt.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,x.Z)(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=h.BV.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return r}return(0,k.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=h.BV.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:(0,Yt.lu)((function(){return(0,nn.P)(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:(0,Yt.lu)((function(){return(0,nn.P)(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:(0,Yt.lu)((function(){return(0,nn.P)(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;(0,Yt.lu)((function(){var e=(0,Qt.I)((0,$t.d)(s,t.decay),(0,$t.d)((0,tn.h)(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=(0,Qt.I)((0,$t.d)(n,t.decay),(0,$t.d)(o,1-t.decay)),c=(0,Jt.h)((0,$t.d)(o,t.learningRate),(0,en._)((0,pn.l)(e,(0,Qt.I)((0,tn.h)(i),t.epsilon)))),l=(0,Qt.I)((0,$t.d)(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var p=(0,pn.l)(a,l);a.assign(p)}else{var d=(0,Qt.I)((0,$t.d)(s,t.decay),(0,$t.d)((0,tn.h)(o),1-t.decay)),f=(0,Qt.I)((0,$t.d)(u,t.momentum),(0,Jt.h)((0,$t.d)(o,t.learningRate),(0,en._)((0,Qt.I)(d,t.epsilon))));s.assign(d),u.assign(f);var h=(0,pn.l)(a,f);a.assign(h)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&(0,Yt.B9)(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&(0,Yt.B9)(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&(0,Yt.B9)(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(){var t;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,Be.Z)(this.accumulatedMeanSquares),(0,Be.Z)(this.accumulatedMoments)),this.centered&&t.push.apply(t,(0,Be.Z)(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,I.Z)((0,S.Z)().mark((function e(t){var n,r;return(0,S.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(on);yn.className="RMSProp",Dt(yn);var bn=function(){function e(){(0,x.Z)(this,e)}return(0,k.Z)(e,null,[{key:"sgd",value:function(e){return new vn(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new gn(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new yn(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new dn(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new sn(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new mn(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new cn(e,t)}}]),e}(),xn=n(3525),kn=n(4348),wn=n(7627),Sn={sgd:bn.sgd,momentum:bn.momentum,adadelta:bn.adadelta,adagrad:bn.adagrad,rmsprop:bn.rmsprop,adamax:bn.adamax,adam:bn.adam},In="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:function(e){return e()};function Nn(){return new Promise((function(e){return In((function(){return e()}))}))}var Tn=n(8473);function Cn(e,t){var n=e[0].length;e.forEach((function(e,t){E.hu(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),E.hu(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)E.hu(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}function En(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}var _n=n(9151),An=n(5171),Rn=30;function Fn(e){return e<=Rn?e:(0,E.jP)(e,Math.floor(Math.sqrt(e)))}function Dn(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function Zn(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function On(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2===1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function Mn(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function zn(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Ln(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var Pn=n(349),Bn=.3275911,Wn=.254829592,Vn=-.284496736,Un=1.421413741,Gn=-1.453152027,jn=1.061405429,Hn=n(7269);function qn(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Kn(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function Xn(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function Yn(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function Qn(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Jn(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function $n(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function er(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var tr="->",nr=/->/g;function rr(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(nr,"").length)/tr.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(tr,'").'));var r=e.split(tr),a=(0,N.Z)(r,2),i=a[0],o=a[1];(0,E.hu)(-1===i.indexOf("..."),(function(){return'The ellipsis notation ("'.concat("...",'") is not supported yet.')}));var s=i.split(","),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],l=function(e){var t=o[e];if(!s.some((function(e){return-1!==e.indexOf(t)})))throw new Error("Output subscripts contain the label ".concat(t," ")+"not present in the input subscripts.");-1===c.indexOf(t)&&c.push(t)},p=0;p<o.length;++p)l(p);for(var d=0;d<i.length;++d){var f=i[d];-1===c.indexOf(f)&&","!==f&&c.push(f)}for(var h=new Array(s.length),m=0;m<u;++m){if(new Set(s[m].split("")).size!==s[m].length)throw new Error("Found duplicate axes in input component ".concat(s[m],". ")+"Support for duplicate axes in input is not implemented yet.");h[m]=[];for(var v=0;v<s[m].length;++v)h[m].push(c.indexOf(s[m][v]))}for(var g=c.length,y=[],b=o.length;b<g;++b)y.push(b);return{allDims:c,summedDims:y,idDims:h}}function ar(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return{permutationIndices:n=n.filter((function(e){return-1!==e})),expandDims:a}}function ir(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:(0,E.hu)(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(a),", ")+"but got dimension ".concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function or(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=ur(t,r[s]),l=(0,w.Z)(c);try{for(l.s();!(u=l.n()).done;){var p=u.value;-1===o.indexOf(p)&&(a[s].push(p),o.push(p))}}catch(Ar){l.e(Ar)}finally{l.f()}}return{path:r,steps:a}}function sr(e){return e.every((function(e,t){return e===t}))}function ur(e,t){for(var n=[],r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function cr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)(0,E.hu)(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);(0,E.hu)(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}(0,E.hu)(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function lr(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function pr(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function dr(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function fr(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function hr(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function mr(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function vr(e,t){var n=(0,E.NA)(e),r=(0,E.NA)(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function gr(e,t){var n=(0,E.NA)(e),r=(0,E.NA)(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function yr(){return"segment ids must be >= 0"}function br(){return"segment ids are not increasing"}function xr(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function kr(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function wr(e,t){var n,r=!1;for(e<=Rn?(n=e,r=!0):n=(0,E.jP)(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=(0,E.jP)(e,n+1);return n}function Sr(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function Ir(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,p=1,d=0;d<r;++d)u.push(e.shape[d]),c*=e.shape[d];for(var f=r;f<n;f++)u.push(e.shape[f]),l*=e.shape[f];for(var h=r;h<a;h++)u.push(t.shape[h]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),p*=e.shape[m];return{batchSize:c,sliceSize:p,outerSize:l,dimSize:s,outputShape:u}}function Nr(e){try{return e.map((function(e){return(0,Ot.decodeString)(e)}))}catch(Ar){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(Ar))}}function Tr(e){return e.map((function(e){return(0,Ot.encodeString)(e)}))}var Cr=n(745),Er=n(4189),_r=n(4679)},2145:function(e,t,n){"use strict";n.d(t,{$H:function(){return dt},$g:function(){return $},$w:function(){return K},Ac:function(){return ve},BM:function(){return Le},By:function(){return B},CA:function(){return Ne},D2:function(){return Vt},Dl:function(){return ct},Eh:function(){return R},FK:function(){return Dt},G3:function(){return tn},GB:function(){return Zt},Gc:function(){return zt},HE:function(){return te},HZ:function(){return ht},Hh:function(){return Me},Hm:function(){return vt},IK:function(){return c},IM:function(){return x},J$:function(){return Se},J_:function(){return be},Jh:function(){return g},Kg:function(){return ot},L8:function(){return Mt},Ly:function(){return I},M2:function(){return d},MI:function(){return Qt},MR:function(){return Ft},MZ:function(){return Re},NE:function(){return ae},NZ:function(){return Xe},O3:function(){return Lt},OA:function(){return We},OR:function(){return le},OU:function(){return Ve},OV:function(){return Be},Om:function(){return ne},Oy:function(){return m},PY:function(){return _e},Ph:function(){return Nt},QC:function(){return v},QR:function(){return U},Qg:function(){return ye},Qi:function(){return at},Qv:function(){return an},RF:function(){return T},RO:function(){return y},RQ:function(){return Et},Ru:function(){return sn},SX:function(){return ee},SY:function(){return r},Sb:function(){return bt},Sp:function(){return i},T0:function(){return G},TQ:function(){return Ot},TR:function(){return P},To:function(){return rn},Tr:function(){return Xt},Uy:function(){return ce},VG:function(){return a},Vb:function(){return Ke},Vc:function(){return V},Vf:function(){return Ae},Vn:function(){return Q},W0:function(){return tt},XD:function(){return on},XL:function(){return k},Xk:function(){return Kt},Xz:function(){return s},Y0:function(){return oe},YF:function(){return ie},YW:function(){return Bt},Yo:function(){return ze},Zb:function(){return Ce},Zj:function(){return Wt},Zz:function(){return _},_J:function(){return Ht},_V:function(){return dn},_Y:function(){return gt},_k:function(){return b},_t:function(){return Ut},a5:function(){return Rt},aJ:function(){return p},av:function(){return xe},b9:function(){return ln},bK:function(){return Gt},bV:function(){return wt},c1:function(){return je},cW:function(){return $t},ci:function(){return j},cy:function(){return et},de:function(){return ue},dp:function(){return mt},e0:function(){return kt},e6:function(){return lt},e7:function(){return Te},eB:function(){return cn},eE:function(){return N},eZ:function(){return Oe},ek:function(){return Y},gJ:function(){return C},h8:function(){return un},hd:function(){return re},i5:function(){return At},iH:function(){return W},iJ:function(){return ge},iW:function(){return ke},iZ:function(){return me},ik:function(){return z},jM:function(){return h},jQ:function(){return qe},je:function(){return pe},kU:function(){return Ee},kp:function(){return nn},ku:function(){return Qe},lu:function(){return fn},ly:function(){return it},m2:function(){return jt},mK:function(){return xt},mT:function(){return Pe},mc:function(){return L},mh:function(){return F},mm:function(){return o},n9:function(){return Jt},nh:function(){return Pt},nr:function(){return It},o0:function(){return ut},o2:function(){return M},oF:function(){return Tt},oH:function(){return J},oT:function(){return u},p2:function(){return Ct},p4:function(){return X},pe:function(){return st},q1:function(){return he},q2:function(){return Ge},q8:function(){return He},qC:function(){return De},qI:function(){return Ze},qW:function(){return nt},qi:function(){return fe},qk:function(){return ft},qw:function(){return f},r7:function(){return we},s1:function(){return qt},sE:function(){return Yt},sH:function(){return de},sJ:function(){return l},sL:function(){return H},us:function(){return pn},uv:function(){return $e},vF:function(){return Ue},vt:function(){return Ie},vw:function(){return se},w3:function(){return _t},w6:function(){return Fe},wU:function(){return D},wY:function(){return Ye},we:function(){return rt},wm:function(){return Z},wx:function(){return en},x1:function(){return O},xJ:function(){return pt},xQ:function(){return St},xn:function(){return E},y7:function(){return q},yQ:function(){return Je},yj:function(){return A},zb:function(){return yt},zv:function(){return S},zw:function(){return w}});var r="Abs",a="Acos",i="Acosh",o="Add",s="AddN",u="All",c="Any",l="ArgMax",p="ArgMin",d="Asin",f="Asinh",h="Atan",m="Atanh",v="Atan2",g="AvgPool",y="AvgPoolGrad",b="AvgPool3D",x="AvgPool3DGrad",k="BatchMatMul",w="BatchToSpaceND",S="Bincount",I="BroadcastTo",N="BroadcastArgs",T="Cast",C="Ceil",E="ClipByValue",_="Complex",A="ComplexAbs",R="Concat",F="Conv2D",D="Conv2DBackpropFilter",Z="Conv2DBackpropInput",O="Conv3D",M="Conv3DBackpropFilterV2",z="Conv3DBackpropInputV2",L="Cos",P="Cosh",B="Cumprod",W="Cumsum",V="CropAndResize",U="DenseBincount",G="DepthToSpace",j="DepthwiseConv2dNative",H="DepthwiseConv2dNativeBackpropFilter",q="DepthwiseConv2dNativeBackpropInput",K="Diag",X="Dilation2D",Y="Dilation2DBackpropInput",Q="Dilation2DBackpropFilter",J="RealDiv",$="Einsum",ee="Elu",te="EluGrad",ne="Erf",re="Equal",ae="Exp",ie="ExpandDims",oe="Expm1",se="FFT",ue="Fill",ce="FlipLeftRight",le="Floor",pe="FloorDiv",de="FusedBatchNorm",fe="GatherV2",he="GatherNd",me="Greater",ve="GreaterEqual",ge="Identity",ye="IFFT",be="Imag",xe="IsFinite",ke="IsInf",we="IsNan",Se="LeakyRelu",Ie="Less",Ne="LessEqual",Te="LinSpace",Ce="Log",Ee="Log1p",_e="LogicalAnd",Ae="LogicalNot",Re="LogicalOr",Fe="LogicalXor",De="LogSoftmax",Ze="LowerBound",Oe="LRN",Me="LRNGrad",ze="Max",Le="Maximum",Pe="MaxPool",Be="MaxPoolGrad",We="MaxPool3D",Ve="MaxPool3DGrad",Ue="MaxPoolWithArgmax",Ge="Mean",je="Min",He="Minimum",qe="MirrorPad",Ke="Mod",Xe="Multinomial",Ye="Multiply",Qe="Neg",Je="NotEqual",$e="NonMaxSuppressionV3",et="NonMaxSuppressionV4",tt="NonMaxSuppressionV5",nt="OnesLike",rt="OneHot",at="Pack",it="PadV2",ot="Pool",st="Pow",ut="Prelu",ct="Prod",lt="Range",pt="Real",dt="Reciprocal",ft="Relu",ht="Reshape",mt="ResizeNearestNeighbor",vt="ResizeNearestNeighborGrad",gt="ResizeBilinear",yt="ResizeBilinearGrad",bt="Relu6",xt="Reverse",kt="Round",wt="Rsqrt",St="ScatterNd",It="SearchSorted",Nt="Select",Tt="Selu",Ct="Slice",Et="Sin",_t="Sinh",At="Sign",Rt="Sigmoid",Ft="Softplus",Dt="Sqrt",Zt="Sum",Ot="SpaceToBatchND",Mt="SplitV",zt="Softmax",Lt="SparseFillEmptyRows",Pt="SparseReshape",Bt="SparseSegmentMean",Wt="SparseSegmentSum",Vt="SparseToDense",Ut="SquaredDifference",Gt="Square",jt="StridedSlice",Ht="StringNGrams",qt="StringSplit",Kt="StringToHashBucketFast",Xt="Sub",Yt="Tan",Qt="Tanh",Jt="Tile",$t="TopK",en="Transform",tn="Transpose",nn="Unique",rn="Unpack",an="UnsortedSegmentSum",on="UpperBound",sn="ZerosLike",un="Step",cn="FromPixels",ln="RotateWithOffset",pn="_FusedMatMul",dn="FusedConv2D",fn="FusedDepthwiseConv2D"},8864:function(e,t,n){"use strict";n.d(t,{Li:function(){return f},T3:function(){return v},bt:function(){return m},nE:function(){return h},pI:function(){return c},tr:function(){return p},uk:function(){return l},wC:function(){return d}});var r=n(9439),a=n(5050),i=n(6581),o=n(7269),s=(0,i.R)("kernelRegistry",(function(){return new Map})),u=(0,i.R)("gradRegistry",(function(){return new Map}));function c(e,t){var n=g(e,t);return s.get(n)}function l(e){return u.get(e)}function p(e){for(var t=s.entries(),n=[];;){var a=t.next(),i=a.done,o=a.value;if(i)break;var u=(0,r.Z)(o,2),c=u[0],l=u[1],p=c.split("_");(0,r.Z)(p,1)[0]===e&&n.push(l)}return n}function d(e){var t=e.kernelName,n=e.backendName,r=g(t,n);s.has(r)&&o.Z("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),s.set(r,e)}function f(e){var t=e.kernelName;u.has(t)&&(0,a.OB)().getBool("DEBUG")&&o.Z("Overriding the gradient for '".concat(t,"'")),u.set(t,e)}function h(e,t){var n=g(e,t);if(!s.has(n))throw new Error("The kernel '".concat(e,"' for backend ")+"'".concat(t,"' is not registered"));s.delete(n)}function m(e){if(!u.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));u.delete(e)}function v(e,t){p(e).forEach((function(e){d(Object.assign({},e,{backendName:t}))}))}function g(e,t){return"".concat(t,"_").concat(e)}},7269:function(e,t,n){"use strict";n.d(t,{Z:function(){return a},c:function(){return i}});var r=n(5050);function a(){var e;(0,r.OB)().getBool("IS_TEST")||(0,r.OB)().getBool("PROD")||(e=console).warn.apply(e,arguments)}function i(){var e;(0,r.OB)().getBool("IS_TEST")||(0,r.OB)().getBool("PROD")||(e=console).log.apply(e,arguments)}},7613:function(e,t,n){"use strict";n.d(t,{W:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({abs_:function(e){var t=(0,i._1)(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return r.BV.runKernel(a.yj,n)}var o={x:t};return r.BV.runKernel(a.SY,o)}})},1719:function(e,t,n){"use strict";n.d(t,{K:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({acos_:function(e){var t={x:(0,i._1)(e,"x","acos")};return r.BV.runKernel(a.VG,t)}})},4502:function(e,t,n){"use strict";n.d(t,{_:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({acosh_:function(e){var t={x:(0,i._1)(e,"x","acosh")};return r.BV.runKernel(a.Sp,t)}})},3312:function(e,t,n){"use strict";n.d(t,{I:function(){return u}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354);var u=(0,n(8640).op)({add_:function(e,t){var n=(0,s._1)(e,"a","add"),u=(0,s._1)(t,"b","add"),c=(0,o.makeTypesMatch)(n,u),l=(0,r.Z)(c,2),p={a:n=l[0],b:u=l[1]};return a.BV.runKernel(i.mm,p)}})},4108:function(e,t,n){"use strict";n.d(t,{$:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=(0,i._1)(e,"x","all","bool"),s={x:o},u={axis:t,keepDims:n};return r.BV.runKernel(a.oT,s,u)}})},8543:function(e,t,n){"use strict";n.d(t,{Y:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=(0,i._1)(e,"x","any","bool"),s={x:o},u={axis:t,keepDims:n};return r.BV.runKernel(a.IK,s,u)}})},9995:function(e,t,n){"use strict";n.d(t,{N:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,i._1)(e,"x","argMax"),o={x:n},s={axis:t};return r.BV.runKernel(a.sJ,o,s)}})},5157:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,i._1)(e,"x","argMin"),o={x:n},s={axis:t};return r.BV.runKernel(a.aJ,o,s)}})},3053:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({asin_:function(e){var t={x:(0,i._1)(e,"x","asin")};return r.BV.runKernel(a.M2,t)}})},54:function(e,t,n){"use strict";n.d(t,{V:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({asinh_:function(e){var t={x:(0,i._1)(e,"x","asinh")};return r.BV.runKernel(a.qw,t)}})},4778:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({atan_:function(e){var t={x:(0,i._1)(e,"x","atan")};return r.BV.runKernel(a.jM,t)}})},2227:function(e,t,n){"use strict";n.d(t,{f:function(){return u}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354);var u=(0,n(8640).op)({atan2_:function(e,t){var n=(0,s._1)(e,"a","atan2"),u=(0,s._1)(t,"b","atan2"),c=(0,o.makeTypesMatch)(n,u),l=(0,r.Z)(c,2),p={a:n=l[0],b:u=l[1]};return a.BV.runKernel(i.QC,p)}})},7897:function(e,t,n){"use strict";n.d(t,{C:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({atanh_:function(e){var t={x:(0,i._1)(e,"x","atanh")};return r.BV.runKernel(a.Oy,t)}})},9204:function(e,t,n){"use strict";n.d(t,{w:function(){return p}});var r=n(318),a=n(2145),i=n(8354),o=n(6147),s=n(9118),u=n(9151),c=n(8640),l=n(5561);var p=(0,c.op)({avgPool_:function(e,t,n,c,p){var d=(0,i._1)(e,"x","avgPool","float32");o.hu(u.jT(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var f=d,h=!1;3===d.rank&&(h=!0,f=(0,l.X)(d,[1,d.shape[0],d.shape[1],d.shape[2]])),o.hu(4===f.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(f.rank,".")})),u.m("avgPool",c,p);var m={x:f},v={filterSize:t,strides:n,pad:c,dimRoundingMode:p},g=r.BV.runKernel(a.Jh,m,v);return g=(0,s.p)(g,d.dtype),h?(0,l.X)(g,[g.shape[1],g.shape[2],g.shape[3]]):g}})},8473:function(e,t,n){"use strict";n.d(t,{LJ:function(){return l},Q3:function(){return c},Vh:function(){return i},YB:function(){return a},kz:function(){return o},lB:function(){return u},rv:function(){return s},sY:function(){return p}});var r=n(6147);function a(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function i(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function o(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function s(e,t){return i(e,t.map((function(e){return 1})),t)}function u(e,t,n){r.hu(a(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function c(e,t){if(a(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function l(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function p(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}},6994:function(e,t,n){"use strict";n.d(t,{E:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({batchToSpaceND_:function(e,t,n){var s=(0,i._1)(e,"x","batchToSpaceND"),u=t.reduce((function(e,t){return e*t}));o.hu(s.rank>=1+t.length,(function(){return"input rank is ".concat(s.rank," but should be > than blockShape.length ").concat(t.length)})),o.hu(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),o.hu(s.shape[0]%u===0,(function(){return"input tensor batch is ".concat(s.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(u)}));var c={x:s},l={blockShape:t,crops:n};return r.BV.runKernel(a.zw,c,l)}})},3700:function(e,t,n){"use strict";n.d(t,{t:function(){return u}});var r=n(318),a=n(2145),i=n(8354),o=n(6147),s=n(5561);var u=(0,n(8640).op)({batchNorm_:function(e,t,n,u,c,l){null==l&&(l=.001);var p,d,f=(0,i._1)(e,"x","batchNorm"),h=(0,i._1)(t,"mean","batchNorm"),m=(0,i._1)(n,"variance","batchNorm");null!=c&&(p=(0,i._1)(c,"scale","batchNorm")),null!=u&&(d=(0,i._1)(u,"offset","batchNorm")),o.hu(h.rank===m.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),o.hu(null==d||h.rank===d.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),o.hu(null==p||h.rank===p.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var v=function(e){return 0===e.rank||1===e.rank?(0,s.X)(e,[1,1,1,e.size]):2===e.rank?(0,s.X)(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?(0,s.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(f),g={x:v,scale:p,offset:d,mean:h,variance:m},y={varianceEpsilon:l},b=r.BV.runKernel(a.sH,g,y);return(0,s.X)(b,f.shape)}})},9742:function(e,t,n){"use strict";n.d(t,{U:function(){return c}});var r=n(318),a=n(2145),i=n(8354),o=n(672),s=n(8640),u=n(5561);var c=(0,s.op)({broadcastTo_:function(e,t){var n=(0,i._1)(e,"broadcastTo","x"),s=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var c=n.shape.slice();c.length<t.length;)c.unshift(1);n=(0,u.X)(n,c)}for(var l=n.shape,p=Array.from(t),d=t.length-1;d>=0;d--)if(l[d]===t[d])p[d]=1;else if(1!==n.shape[d])throw new Error("broadcastTo(): [".concat(s,"] cannot be broadcast to [").concat(t,"]."));var f=p.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===f.length)return(0,o.d)(n);var h={x:n},m={reps:p};return r.BV.runKernel(a.n9,h,m)}})},5774:function(e,t,n){"use strict";function r(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function a(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function i(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}n.r(t),n.d(t,{assertAndGetBroadcastShape:function(){return i},getBroadcastDims:function(){return r},getReductionAxes:function(){return a}})},7039:function(e,t,n){"use strict";n.d(t,{f:function(){return i}});var r=n(4376),a=n(6147);function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",a.Mu(e),new r.YD(e,t,n)}},9118:function(e,t,n){"use strict";n.d(t,{p:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({cast_:function(e,t){var n=(0,i._1)(e,"x","cast");if(!o.LP(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var s={x:n},u={dtype:t};return r.BV.runKernel(a.RF,s,u)}})},1396:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({ceil_:function(e){var t={x:(0,i._1)(e,"x","ceil","float32")};return r.BV.runKernel(a.gJ,t)}})},9836:function(e,t,n){"use strict";n.d(t,{i:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({clipByValue_:function(e,t,n){var s=(0,i._1)(e,"x","clipByValue");o.hu(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")}));var u={x:s},c={clipValueMin:t,clipValueMax:n};return r.BV.runKernel(a.xn,u,c)}})},672:function(e,t,n){"use strict";n.d(t,{d:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({clone_:function(e){var t={x:(0,i._1)(e,"x","clone","string_or_numeric")};return r.BV.runKernel(a.iJ,t)}})},9253:function(e,t,n){"use strict";n.d(t,{P:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({complex_:function(e,t){var n=(0,i._1)(e,"real","complex"),s=(0,i._1)(t,"imag","complex");o.k5(n.shape,s.shape,"real and imag shapes, ".concat(n.shape," and ").concat(s.shape,", ")+"must match in call to tf.complex().");var u={real:n,imag:s};return r.BV.runKernel(a.Zz,u)}})},4836:function(e,t,n){"use strict";n.d(t,{z:function(){return u}});var r=n(318),a=n(2145),i=n(8354),o=n(6147),s=n(672);var u=(0,n(8640).op)({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o.hu)(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=(0,i.sI)(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return(0,s.d)(n[0]);var u=n,c={axis:t};return r.BV.runKernel(a.Eh,u,c)}})},4918:function(e,t,n){"use strict";n.d(t,{P:function(){return c}});var r=n(8354),a=n(6147),i=n(3457),o=n(9151),s=n(8640),u=n(5561);var c=(0,s.op)({conv1d_:function(e,t,n,s){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,p=arguments.length>6?arguments[6]:void 0,d=(0,r._1)(e,"x","conv1d"),f=(0,r._1)(t,"filter","conv1d"),h=d,m=!1;2===d.rank&&(m=!0,h=(0,u.X)(d,[1,d.shape[0],d.shape[1]])),a.hu(3===h.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(h.rank,".")})),a.hu(3===f.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(f.rank,".")})),o.m("conv1d",s,p),a.hu(h.shape[2]===f.shape[1],(function(){return"Error in conv1d: depth of input (".concat(h.shape[2],") must match ")+"input depth for filter ".concat(f.shape[1],".")})),a.hu(o.jT(n,l),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(l,"'")})),a.hu("NWC"===c,(function(){return"Error in conv1d: got dataFormat of ".concat(c," but only NWC is currently supported.")}));var v=(0,u.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]]),g=(0,u.X)(h,[h.shape[0],1,h.shape[1],h.shape[2]]),y=[1,n],b=[1,l],x="NHWC",k=(0,i.T)(g,v,y,s,x,b,p);return m?(0,u.X)(k,[k.shape[2],k.shape[3]]):(0,u.X)(k,[k.shape[0],k.shape[2],k.shape[3]])}})},3457:function(e,t,n){"use strict";n.d(t,{T:function(){return l}});var r=n(318),a=n(2145),i=n(8354),o=n(6147),s=n(9151),u=n(8640),c=n(5561);var l=(0,u.op)({conv2d_:function(e,t,n,u){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],d=arguments.length>6?arguments[6]:void 0,f=(0,i._1)(e,"x","conv2d","float32"),h=(0,i._1)(t,"filter","conv2d","float32"),m=f,v=!1;3===f.rank&&(v=!0,m=(0,c.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]])),o.hu(4===m.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(m.rank,".")})),o.hu(4===h.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(h.rank,".")})),s.m("conv2d",u,d);var g="NHWC"===l?m.shape[3]:m.shape[1];o.hu(g===h.shape[2],(function(){return"Error in conv2d: depth of input (".concat(g,") must match ")+"input depth for filter ".concat(h.shape[2],".")})),o.hu(s.jT(n,p),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(p,"'")}));var y={x:m,filter:h},b={strides:n,pad:u,dataFormat:l,dilations:p,dimRoundingMode:d},x=r.BV.runKernel(a.mh,y,b);return v?(0,c.X)(x,[x.shape[1],x.shape[2],x.shape[3]]):x}})},8744:function(e,t,n){"use strict";n.d(t,{p:function(){return c}});var r=n(318),a=n(2145),i=n(6147),o=n(9151),s=n(8640),u=n(5561);var c=(0,s.op)({conv2DBackpropFilter_:function(e,t,n,s,c){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",p=arguments.length>6?arguments[6]:void 0,d=e;3===e.rank&&(d=(0,u.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var f=t;3===f.rank&&(f=(0,u.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]])),i.hu(4===d.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(d.shape,".")})),i.hu(4===f.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(f.shape,".")})),i.hu(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var h="NHWC"===l?d.shape[3]:d.shape[1],m="NHWC"===l?f.shape[3]:f.shape[1];i.hu(h===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(h,") must ")+"match input depth in filter (".concat(n[2],".")})),i.hu(m===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(m,") must ")+"match output depth for filter (".concat(n[3],").")})),o.m("conv2dDerFilter",c,p);var v={x:d,dy:f},g={strides:s,pad:c,dataFormat:l,dimRoundingMode:p,filterShape:n};return r.BV.runKernel(a.wU,v,g)}})},1045:function(e,t,n){"use strict";n.d(t,{_:function(){return c}});var r=n(318),a=n(2145),i=n(6147),o=n(9151),s=n(8640),u=n(5561);var c=(0,s.op)({conv2DBackpropInput_:function(e,t,n,s,c){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",p=arguments.length>6?arguments[6]:void 0;i.hu(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var d=e,f=t,h=!1;3===t.rank&&(h=!0,f=(0,u.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]]),d=[1,e[0],e[1],e[2]]),i.hu(4===d.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(d.length,".")})),i.hu(4===f.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(f.rank)})),i.hu(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var m="NHWC"===l?d[3]:d[1],v="NHWC"===l?f.shape[3]:f.shape[1];i.hu(m===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(m,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),i.hu(v===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(v,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),o.m("conv2dDerInput",c,p);var g={dy:f,filter:n},y={strides:s,pad:c,dataFormat:l,dimRoundingMode:p,inputShape:d},b=r.BV.runKernel(a.wm,g,y);return h?(0,u.X)(b,[b.shape[1],b.shape[2],b.shape[3]]):b}})},1732:function(e,t,n){"use strict";n.d(t,{b:function(){return i}});var r=n(8354),a=n(1045);var i=(0,n(8640).op)({conv2dTranspose_:function(e,t,n,i,o,s){var u=(0,r._1)(e,"x","conv2dTranspose"),c=(0,r._1)(t,"filter","conv2dTranspose");return(0,a._)(n,u,c,i,o,"NHWC",s)}})},1873:function(e,t,n){"use strict";n.d(t,{_:function(){return u}});var r=n(318),a=n(2145),i=n(6147),o=n(8640),s=n(5561);var u=(0,o.op)({conv3DBackpropInput_:function(e,t,n,o,u){i.hu(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var c=e,l=t,p=!1;4===t.rank&&(p=!0,l=(0,s.X)(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),c=[1,e[0],e[1],e[2],e[3]]);var d=c[4],f=l.shape[4];i.hu(5===c.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(c.length,".")})),i.hu(5===l.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(l.rank)})),i.hu(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),i.hu(d===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(d,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),i.hu(f===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var h={dy:l,filter:n},m={pad:u,strides:o,inputShape:c},v=r.BV.runKernel(a.ik,h,m);return p?(0,s.X)(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}})},9151:function(e,t,n){"use strict";n.d(t,{I0:function(){return y},Ix:function(){return c},Rf:function(){return o},Xw:function(){return s},aO:function(){return p},jT:function(){return b},jw:function(){return l},m:function(){return k},pl:function(){return u},sl:function(){return x}});var r=n(9439),a=n(3433),i=n(6147);function o(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",o=arguments.length>5?arguments[5]:void 0,s=e[3],u=[].concat((0,a.Z)(t),[s]),l=x(i);return c(e,u,n,o,r,null,null,l)}function s(e,t,n,a,i,o){var s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",l=d(t),p=(0,r.Z)(l,2),f=p[0],h=p[1];if("channelsLast"===u)s=[f,h,e[3],e[3]];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));s=[f,h,e[1],e[1]]}return c(e,s,n,a,i,o,!1,u)}function u(e,t,n,a,i,o){var s,u,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",p=f(t),d=(0,r.Z)(p,3),h=d[0],m=d[1],v=d[2];if("NDHWC"===c)u="channelsLast",s=[h,m,v,e[4],e[4]];else{if("NCDHW"!==c)throw new Error("Unknown dataFormat ".concat(c));u="channelsFirst",s=[h,m,v,e[1],e[1]]}return l(e,s,n,a,i,!1,u,o)}function c(e,t,n,a,i,o){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",c=-1,l=-1,p=-1,f=-1;if("channelsLast"===u){var v=(0,r.Z)(e,4);c=v[0],l=v[1],p=v[2],f=v[3]}else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));var g=(0,r.Z)(e,4);c=g[0],f=g[1],l=g[2],p=g[3]}var y,b=(0,r.Z)(t,4),x=b[0],k=b[1],w=b[3],S=d(n),I=(0,r.Z)(S,2),N=I[0],T=I[1],C=d(a),E=(0,r.Z)(C,2),_=E[0],A=E[1],R=h(x,_),F=h(k,A),D=m(i,l,p,N,T,R,F,o,u),Z=D.padInfo,O=D.outHeight,M=D.outWidth,z=s?w*f:w;return"channelsFirst"===u?y=[c,z,O,M]:"channelsLast"===u&&(y=[c,O,M,z]),{batchSize:c,dataFormat:u,inHeight:l,inWidth:p,inChannels:f,outHeight:O,outWidth:M,outChannels:z,padInfo:Z,strideHeight:N,strideWidth:T,filterHeight:x,filterWidth:k,effectiveFilterHeight:R,effectiveFilterWidth:F,dilationHeight:_,dilationWidth:A,inShape:e,outShape:y,filterShape:t}}function l(e,t,n,a,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=arguments.length>7?arguments[7]:void 0,c=-1,l=-1,p=-1,d=-1,m=-1;if("channelsLast"===s){var g=(0,r.Z)(e,5);c=g[0],l=g[1],p=g[2],d=g[3],m=g[4]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var y=(0,r.Z)(e,5);c=y[0],m=y[1],l=y[2],p=y[3],d=y[4]}var b,x=(0,r.Z)(t,5),k=x[0],w=x[1],S=x[2],I=x[4],N=f(n),T=(0,r.Z)(N,3),C=T[0],E=T[1],_=T[2],A=f(a),R=(0,r.Z)(A,3),F=R[0],D=R[1],Z=R[2],O=h(k,F),M=h(w,D),z=h(S,Z),L=v(i,l,p,d,C,E,_,O,M,z,u),P=L.padInfo,B=L.outDepth,W=L.outHeight,V=L.outWidth,U=o?I*m:I;return"channelsFirst"===s?b=[c,U,B,W,V]:"channelsLast"===s&&(b=[c,B,W,V,U]),{batchSize:c,dataFormat:s,inDepth:l,inHeight:p,inWidth:d,inChannels:m,outDepth:B,outHeight:W,outWidth:V,outChannels:U,padInfo:P,strideDepth:C,strideHeight:E,strideWidth:_,filterDepth:k,filterHeight:w,filterWidth:S,effectiveFilterDepth:O,effectiveFilterHeight:M,effectiveFilterWidth:z,dilationDepth:F,dilationHeight:D,dilationWidth:Z,inShape:e,outShape:b,filterShape:t}}function p(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=h(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function d(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function f(e){return"number"===typeof e?[e,e,e]:e}function h(e,t){return t<=1?e:e+(e-1)*(t-1)}function m(e,t,n,r,a,i,o,s,u){var c,l,d;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=p(e,t,n));var i=e[0],o=e[1];return[g((i-t+2*r)/n+1,a),g((o-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=f[0],d=f[1]}else if("same"===e){l=Math.ceil(t/r),d=Math.ceil(n/a);var h=Math.max(0,(l-1)*r+i-t),m=Math.max(0,(d-1)*a+o-n),v=Math.floor(h/2),y=h-v,b=Math.floor(m/2);c={top:v,bottom:y,left:b,right:m-b,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),d=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var x="channelsLast"===u?e[1][0]:e[2][0],k="channelsLast"===u?e[1][1]:e[2][1],w="channelsLast"===u?e[2][0]:e[3][0],S="channelsLast"===u?e[2][1]:e[3][1];c={top:x,bottom:k,left:w,right:S,type:0===x&&0===k&&0===w&&0===S?"VALID":"EXPLICIT"},l=g((t-i+x+k)/r+1,s),d=g((n-o+w+S)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:d}}function v(e,t,n,r,a,i,o,s,u,c,l){var d,f,h,m;if("number"===typeof e){d={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,a,i){null==a&&(a=p(e,t,r));var o=e[0],s=e[1],u=e[2];return[g((o-t+2*a)/r+1,i),g((s-t+2*a)/r+1,i),g((u-t+2*a)/r+1,i),n]}([t,n,r,1],s,1,a,e,l);f=v[0],h=v[1],m=v[2]}else if("same"===e){var y=((f=Math.ceil(t/a))-1)*a+s-t,b=((h=Math.ceil(n/i))-1)*i+u-n,x=((m=Math.ceil(r/o))-1)*o+c-r,k=Math.floor(y/2),w=y-k,S=Math.floor(b/2),I=b-S,N=Math.floor(x/2);d={top:S,bottom:I,left:N,right:x-N,front:k,back:w,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),h=Math.ceil((n-u+1)/i),m=Math.ceil((r-c+1)/o)}return{padInfo:d,outDepth:f,outHeight:h,outWidth:m}}function g(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function y(e){var t=d(e),n=(0,r.Z)(t,3),a=n[0],i=n[1],o=n[2];return 1===a&&1===i&&1===o}function b(e,t){return y(e)||y(t)}function x(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function k(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)i.hu(i.GN(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){i.hu(i.GN(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}))}))}))}}}},1227:function(e,t,n){"use strict";n.d(t,{m:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({cos_:function(e){var t={x:(0,i._1)(e,"x","cos","float32")};return r.BV.runKernel(a.mc,t)}})},6679:function(e,t,n){"use strict";n.d(t,{f:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({cosh_:function(e){var t={x:(0,i._1)(e,"x","cosh","float32")};return r.BV.runKernel(a.TR,t)}})},9457:function(e,t,n){"use strict";n.d(t,{$:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(0,i._1)(e,"x","cumprod"),u={x:s},c={axis:t,exclusive:n,reverse:o};return r.BV.runKernel(a.By,u,c)}})},8862:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(0,i._1)(e,"x","cumsum"),u={x:s},c={axis:t,exclusive:n,reverse:o};return r.BV.runKernel(a.iH,u,c)}})},1878:function(e,t,n){"use strict";n.d(t,{n:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",s=(0,i._1)(e,"x","depthToSpace","float32"),u="NHWC"===n?s.shape[1]:s.shape[2],c="NHWC"===n?s.shape[2]:s.shape[3],l="NHWC"===n?s.shape[3]:s.shape[1];o.hu(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),o.hu(u*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(u," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(s.shape)})),o.hu(c*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(c," and ").concat(t," for depthToSpace with input shape\n        ").concat(s.shape)})),o.hu(l%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(l," for depthToSpace with input shape ").concat(s.shape)}));var p={x:s},d={blockSize:t,dataFormat:n};return r.BV.runKernel(a.T0,p,d)}})},1147:function(e,t,n){"use strict";n.d(t,{B:function(){return l}});var r=n(318),a=n(2145),i=n(8354),o=n(6147),s=n(9151),u=n(8640),c=n(5561);var l=(0,u.op)({depthwiseConv2d_:function(e,t,n,u){var l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],d=arguments.length>6?arguments[6]:void 0,f=(0,i._1)(e,"x","depthwiseConv2d","float32"),h=(0,i._1)(t,"filter","depthwiseConv2d","float32"),m=f,v=!1;3===f.rank&&(v=!0,m=(0,c.X)(f,[1,f.shape[0],f.shape[1],f.shape[2]])),o.hu(4===m.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(m.rank,".")})),o.hu(4===h.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(h.rank,".")}));var g="NHWC"===l?m.shape[3]:m.shape[1];o.hu(g===h.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(g,") must match the inChannels dimension in ")+"filter ".concat(h.shape[2],".")})),s.m("depthwiseConv2d",u,d);var y={x:m,filter:h},b={strides:n,pad:u,dataFormat:l,dilations:p,dimRoundingMode:d},x=r.BV.runKernel(a.ci,y,b);return v?(0,c.X)(x,[x.shape[1],x.shape[2],x.shape[3]]):x}})},288:function(e,t,n){"use strict";n.d(t,{z:function(){return s}});var r=n(318),a=n(2145),i=n(8640),o=n(5561);var s=(0,i.op)({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,i,s){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],c=arguments.length>6?arguments[6]:void 0,l=e;3===e.rank&&(l=(0,o.X)(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var p=t;3===p.rank&&(p=(0,o.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var d={x:l,dy:p},f={strides:i,pad:s,dimRoundingMode:c,dilations:u,filterShape:n};return r.BV.runKernel(a.sL,d,f)}})},6939:function(e,t,n){"use strict";n.d(t,{v:function(){return s}});var r=n(318),a=n(2145),i=n(8640),o=n(5561);var s=(0,i.op)({depthwiseConv2dNativeBackpropInput_:function(e,t,n,i,s){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],c=arguments.length>6?arguments[6]:void 0,l=t,p=!1;3===t.rank&&(p=!0,l=(0,o.X)(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var d={dy:l,filter:n},f={strides:i,pad:s,dimRoundingMode:c,dilations:u,inputShape:e},h=r.BV.runKernel(a.y7,d,f);return p?(0,o.X)(h,[h.shape[1],h.shape[2],h.shape[3]]):h}})},7580:function(e,t,n){"use strict";n.d(t,{W:function(){return c}});var r=n(318),a=n(2145),i=n(8354),o=n(6147),s=n(8640),u=n(5561);var c=(0,s.op)({dilation2d_:function(e,t,n,s){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",p=(0,i._1)(e,"x","dilation2d"),d=(0,i._1)(t,"filter","dilation2d");o.hu(3===p.rank||4===p.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(p.rank,".")})),o.hu(3===d.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(d.rank,".")})),o.hu("NHWC"===l,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(l)}));var f=p,h=!1;3===p.rank&&(f=(0,u.X)(p,[1,p.shape[0],p.shape[1],p.shape[2]]),h=!0);var m={x:f,filter:d},v={strides:n,pad:s,dilations:c},g=r.BV.runKernel(a.p4,m,v);return h?(0,u.X)(g,[g.shape[1],g.shape[2],g.shape[3]]):g}})},5750:function(e,t,n){"use strict";n.d(t,{h:function(){return c}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(7145);var c=(0,n(8640).op)({div_:function(e,t){var n=(0,s._1)(e,"a","div"),c=(0,s._1)(t,"b","div"),l=(0,o.makeTypesMatch)(n,c),p=(0,r.Z)(l,2);if(n=p[0],c=p[1],"int32"===n.dtype&&"int32"===c.dtype)return(0,u.q)(n,c);var d={a:n,b:c};return a.BV.runKernel(i.oH,d,{})}})},5923:function(e,t,n){"use strict";n.d(t,{N:function(){return p}});var r=n(9439),a=n(9064),i=n(8354),o=n(5750),s=n(3254),u=n(8640),c=n(329),l=n(7293);var p=(0,u.op)({divNoNan_:function(e,t){var n=(0,i._1)(e,"a","div"),u=(0,i._1)(t,"b","div"),p=(0,a.makeTypesMatch)(n,u),d=(0,r.Z)(p,2);n=d[0],u=d[1];var f=(0,o.h)(n,u),h=(0,l.P)(f),m=(0,s.D)(u,h);return(0,c.a)(m,h,f)}})},5043:function(e,t,n){"use strict";n.d(t,{A:function(){return u}});var r=n(8354),a=n(6147),i=n(7221),o=n(8640),s=n(5561);var u=(0,o.op)({dot_:function(e,t){var n=(0,r._1)(e,"t1","dot"),o=(0,r._1)(t,"t2","dot");a.hu((1===n.rank||2===n.rank)&&(1===o.rank||2===o.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(o.rank,".")}));var u=1===n.rank?n.size:n.shape[1],c=1===o.rank?o.size:o.shape[0];if(a.hu(u===c,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(u," and ").concat(c,".")})),1===n.rank&&1===o.rank){var l=(0,s.X)(n,[1,-1]),p=(0,s.X)(o,[-1,1]),d=(0,i.O)(l,p);return(0,s.X)(d,[])}if(1===n.rank&&2===o.rank){var f=(0,s.X)(n,[1,-1]),h=(0,s.X)(o,[o.shape[0],o.shape[1]]),m=(0,i.O)(f,h);return(0,s.X)(m,[m.size])}if(2===n.rank&&1===o.rank){var v=(0,s.X)(o,[-1,1]),g=(0,i.O)(n,v);return(0,s.X)(g,[g.size])}var y=(0,s.X)(o,[o.shape[0],o.shape[1]]);return(0,i.O)(n,y)}})},2353:function(e,t,n){"use strict";n.d(t,{p:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({elu_:function(e){var t={x:(0,i._1)(e,"x","elu","float32")};return r.BV.runKernel(a.SX,t)}})},3254:function(e,t,n){"use strict";n.d(t,{D:function(){return c}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(5774);var c=(0,n(8640).op)({equal_:function(e,t){var n=(0,s._1)(e,"a","equal","string_or_numeric"),c=(0,s._1)(t,"b","equal","string_or_numeric"),l=(0,o.makeTypesMatch)(n,c),p=(0,r.Z)(l,2);n=p[0],c=p[1],(0,u.assertAndGetBroadcastShape)(n.shape,c.shape);var d={a:n,b:c};return a.BV.runKernel(i.hd,d)}})},3891:function(e,t,n){"use strict";n.d(t,{q:function(){return u}});var r=n(318),a=n(2145),i=n(8354),o=n(6147),s=n(9118);var u=(0,n(8640).op)({erf_:function(e){var t=(0,i._1)(e,"x","erf");o.hu("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=(0,s.p)(t,"float32"));var n={x:t};return r.BV.runKernel(a.Om,n)}})},3313:function(e,t,n){"use strict";n.d(t,{d:function(){return a}});var r=n(6662);var a=(0,n(8640).op)({euclideanNorm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,r.K)(e,"euclidean",t,n)}})},411:function(e,t,n){"use strict";n.d(t,{Q:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({exp_:function(e){var t={x:(0,i._1)(e,"x","exp")};return r.BV.runKernel(a.NE,t)}})},2975:function(e,t,n){"use strict";n.d(t,{d:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,i._1)(e,"x","expandDims","string_or_numeric");o.hu(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var s={input:n},u={dim:t};return r.BV.runKernel(a.YF,s,u)}})},5682:function(e,t,n){"use strict";n.d(t,{t:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({expm1_:function(e){var t={x:(0,i._1)(e,"x","expm1")};return r.BV.runKernel(a.Y0,t)}})},8582:function(e,t,n){"use strict";n.d(t,{h:function(){return i}});var r=n(318),a=n(2145);function i(e,t,n){var i={shape:e,value:t,dtype:n};return r.BV.runKernel(a.de,{},i)}},2628:function(e,t,n){"use strict";n.d(t,{G:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({floor_:function(e){var t={x:(0,i._1)(e,"x","floor","float32")};return r.BV.runKernel(a.OR,t)}})},7145:function(e,t,n){"use strict";n.d(t,{q:function(){return u}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354);var u=(0,n(8640).op)({floorDiv_:function(e,t){var n=(0,s._1)(e,"a","floorDiv"),u=(0,s._1)(t,"b","floorDiv"),c=(0,o.makeTypesMatch)(n,u),l=(0,r.Z)(c,2),p={a:n=l[0],b:u=l[1]};return a.BV.runKernel(i.je,p)}})},5171:function(e,t,n){"use strict";n.d(t,{Fr:function(){return h},QH:function(){return v},pf:function(){return m},uy:function(){return g}});var r=n(5774),a=n(2353),i=n(4419),o=n(651),s=n(6859),u=n(7539),c=n(5900),l=n(5561),p=n(7643),d=n(4031),f=n(227);function h(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return(0,o.d)(e,(0,d.N)(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function m(e,t){var n=t,a=r.getReductionAxes(e.shape,t.shape);return a.length>0&&(n=(0,f.S)(n,a)),(0,l.X)(n,e.shape)}function v(e,t,n,r){if("linear"===t)return e;if("relu"===t)return(0,u.U)(e);if("elu"===t)return(0,a.p)(e);if("relu6"===t)return(0,c.b)(e);if("prelu"===t)return(0,s.A)(e,n);if("leakyrelu"===t)return(0,i.h)(e,r);if("sigmoid"===t)return(0,p.X)(e);throw new Error("Unknown fused activation ".concat(t,"."))}var g=function(e,t){return!(e>0)||"linear"===t}},9498:function(e,t,n){"use strict";n.d(t,{I:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=(0,i._1)(e,"x","gather"),u=(0,i._1)(t,"indices","gather","int32"),c={x:s,indices:u},l={axis:n,batchDims:o};return r.BV.runKernel(a.qi,c,l)}})},5014:function(e,t,n){"use strict";n.d(t,{p:function(){return c}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(5774);var c=(0,n(8640).op)({greater_:function(e,t){var n=(0,s._1)(e,"a","greater","string_or_numeric"),c=(0,s._1)(t,"b","greater","string_or_numeric"),l=(0,o.makeTypesMatch)(n,c),p=(0,r.Z)(l,2);n=p[0],c=p[1],(0,u.assertAndGetBroadcastShape)(n.shape,c.shape);var d={a:n,b:c};return a.BV.runKernel(i.iZ,d)}})},8327:function(e,t,n){"use strict";n.d(t,{b:function(){return c}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(5774);var c=(0,n(8640).op)({greaterEqual_:function(e,t){var n=(0,s._1)(e,"a","greaterEqual","string_or_numeric"),c=(0,s._1)(t,"b","greaterEqual","string_or_numeric"),l=(0,o.makeTypesMatch)(n,c),p=(0,r.Z)(l,2);n=p[0],c=p[1],(0,u.assertAndGetBroadcastShape)(n.shape,c.shape);var d={a:n,b:c};return a.BV.runKernel(i.Ac,d)}})},6996:function(e,t,n){"use strict";n.d(t,{a:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({imag_:function(e){var t={input:(0,i._1)(e,"input","imag")};return r.BV.runKernel(a.J_,t)}})},464:function(e,t,n){"use strict";n.d(t,{I:function(){return l}});var r=n(4506),a=n(318),i=n(2145),o=n(8354),s=n(6147),u=n(8640),c=n(5561);var l=(0,u.op)({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=(0,o._1)(e,"images","resizeBilinear");s.hu(3===l.rank||4===l.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(l.rank,".")})),s.hu(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),s.hu(!1===u||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var p=l,d=!1;3===l.rank&&(d=!0,p=(0,c.X)(l,[1,l.shape[0],l.shape[1],l.shape[2]])),(0,r.Z)(t);var f={images:p},h={alignCorners:n,halfPixelCenters:u,size:t},m=a.BV.runKernel(i._Y,f,h);return d?(0,c.X)(m,[m.shape[1],m.shape[2],m.shape[3]]):m}})},8600:function(e,t,n){"use strict";n.d(t,{j:function(){return l}});var r=n(4506),a=n(318),i=n(2145),o=n(8354),s=n(6147),u=n(8640),c=n(5561);var l=(0,u.op)({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=(0,o._1)(e,"images","resizeNearestNeighbor");s.hu(3===l.rank||4===l.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(l.rank,".")})),s.hu(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),s.hu("float32"===l.dtype||"int32"===l.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),s.hu(!1===u||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var p=l,d=!1;3===l.rank&&(d=!0,p=(0,c.X)(l,[1,l.shape[0],l.shape[1],l.shape[2]])),(0,r.Z)(t);var f={images:p},h={alignCorners:n,halfPixelCenters:u,size:t},m=a.BV.runKernel(i.dp,f,h);return d?(0,c.X)(m,[m.shape[1],m.shape[2],m.shape[3]]):m}})},300:function(e,t,n){"use strict";n.d(t,{x:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({isFinite_:function(e){var t={x:(0,i._1)(e,"x","isFinite")};return r.BV.runKernel(a.av,t)}})},4652:function(e,t,n){"use strict";n.d(t,{U:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({isInf_:function(e){var t={x:(0,i._1)(e,"x","isInf")};return r.BV.runKernel(a.iW,t)}})},7005:function(e,t,n){"use strict";n.d(t,{i:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({isNaN_:function(e){var t={x:(0,i._1)(e,"x","isNaN")};return r.BV.runKernel(a.r7,t)}})},4419:function(e,t,n){"use strict";n.d(t,{h:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=(0,i._1)(e,"x","leakyRelu"),o={x:n},s={alpha:t};return r.BV.runKernel(a.J$,o,s)}})},4920:function(e,t,n){"use strict";n.d(t,{d:function(){return c}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(5774);var c=(0,n(8640).op)({less_:function(e,t){var n=(0,s._1)(e,"a","less","string_or_numeric"),c=(0,s._1)(t,"b","less","string_or_numeric"),l=(0,o.makeTypesMatch)(n,c),p=(0,r.Z)(l,2);n=p[0],c=p[1],(0,u.assertAndGetBroadcastShape)(n.shape,c.shape);var d={a:n,b:c};return a.BV.runKernel(i.vt,d)}})},2642:function(e,t,n){"use strict";n.d(t,{z:function(){return c}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(5774);var c=(0,n(8640).op)({lessEqual_:function(e,t){var n=(0,s._1)(e,"a","lessEqual","string_or_numeric"),c=(0,s._1)(t,"b","lessEqual","string_or_numeric"),l=(0,o.makeTypesMatch)(n,c),p=(0,r.Z)(l,2);n=p[0],c=p[1],(0,u.assertAndGetBroadcastShape)(n.shape,c.shape);var d={a:n,b:c};return a.BV.runKernel(i.CA,d)}})},936:function(e,t,n){"use strict";n.d(t,{G:function(){return c}});var r=n(318),a=n(2145),i=n(8354),o=n(6147),s=n(8640),u=n(5561);var c=(0,s.op)({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,l=(0,i._1)(e,"x","localResponseNormalization");o.hu(4===l.rank||3===l.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(l.rank,".")})),o.hu(o.GN(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var p=l,d=!1;3===l.rank&&(d=!0,p=(0,u.X)(l,[1,l.shape[0],l.shape[1],l.shape[2]]));var f={x:p},h={depthRadius:t,bias:n,alpha:s,beta:c},m=r.BV.runKernel(a.eZ,f,h);return d?(0,u.X)(m,[m.shape[1],m.shape[2],m.shape[3]]):m}})},378:function(e,t,n){"use strict";n.d(t,{c:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({log_:function(e){var t={x:(0,i._1)(e,"x","log","float32")};return r.BV.runKernel(a.Zb,t)}})},5341:function(e,t,n){"use strict";n.d(t,{K:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({log1p_:function(e){var t={x:(0,i._1)(e,"x","log1p")};return r.BV.runKernel(a.kU,t)}})},5113:function(e,t,n){"use strict";n.d(t,{e:function(){return l}});var r=n(6450),a=n(8354),i=n(651),o=n(4362),s=n(8640),u=n(7643),c=n(4626);var l=(0,s.op)({logSigmoid_:function(e){var t=(0,a._1)(e,"x","logSigmoid"),n=(0,r.cb)((function(e){return{value:(0,o.W)((0,c.W)((0,o.W)(e))),gradFunc:function(t){return(0,i.d)(t,(0,u.X)((0,o.W)(e)))}}}));return n(t)}})},4561:function(e,t,n){"use strict";n.d(t,{C:function(){return h}});var r=n(9439),a=n(6450),i=n(8354),o=n(9118),s=n(411),u=n(378),c=n(6176),l=n(651),p=n(8640),d=n(4774),f=n(227);var h=(0,p.op)({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=(0,i._1)(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var p=(0,a.cb)((function(e,n){var a=(0,c.F)(e,t,!0),i=(0,d.l)(e,a),p=(0,d.l)((0,o.p)(i,"float32"),(0,u.c)((0,f.S)((0,s.Q)(i),t,!0)));n([p]);return{value:p,gradFunc:function(e,n){var a=(0,r.Z)(n,1)[0],i=(0,s.Q)(a);return(0,d.l)(e,(0,l.d)((0,f.S)(e,t,!0),i))}}}));return p(n)}})},5530:function(e,t,n){"use strict";n.d(t,{l:function(){return h}});var r=n(8354),a=n(6147),i=n(3312),o=n(8473),s=n(411),u=n(378),c=n(6176),l=n(8640),p=n(5561),d=n(4774),f=n(227);var h=(0,l.op)({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=(0,r._1)(e,"x","logSumExp"),h=(0,a.EC)(t,l.shape),m=(0,c.F)(l,h,!0),v=(0,d.l)(l,m),g=(0,s.Q)(v),y=(0,f.S)(g,h),b=(0,u.c)(y),x=(0,i.I)((0,p.X)(m,b.shape),b);if(n){var k=(0,o.rv)(x.shape,h);return(0,p.X)(x,k)}return x}})},2177:function(e,t,n){"use strict";n.d(t,{H:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(5774);var s=(0,n(8640).op)({logicalAnd_:function(e,t){var n=(0,i._1)(e,"a","logicalAnd","bool"),s=(0,i._1)(t,"b","logicalAnd","bool");(0,o.assertAndGetBroadcastShape)(n.shape,s.shape);var u={a:n,b:s};return r.BV.runKernel(a.PY,u)}})},875:function(e,t,n){"use strict";n.d(t,{h:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({logicalNot_:function(e){var t={x:(0,i._1)(e,"x","logicalNot","bool")};return r.BV.runKernel(a.Vf,t)}})},5117:function(e,t,n){"use strict";n.d(t,{K:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(5774);var s=(0,n(8640).op)({logicalOr_:function(e,t){var n=(0,i._1)(e,"a","logicalOr","bool"),s=(0,i._1)(t,"b","logicalOr","bool");(0,o.assertAndGetBroadcastShape)(n.shape,s.shape);var u={a:n,b:s};return r.BV.runKernel(a.MZ,u)}})},1712:function(e,t,n){"use strict";n.d(t,{e:function(){return u}});var r=n(8354),a=n(5774),i=n(2177),o=n(875),s=n(5117);var u=(0,n(8640).op)({logicalXor_:function(e,t){var n=(0,r._1)(e,"a","logicalXor","bool"),u=(0,r._1)(t,"b","logicalXor","bool");return(0,a.assertAndGetBroadcastShape)(n.shape,u.shape),(0,i.H)((0,s.K)(e,t),(0,o.h)((0,i.H)(e,t)))}})},7627:function(e,t,n){"use strict";var r;n.d(t,{I:function(){return r}}),function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(r||(r={}))},7221:function(e,t,n){"use strict";n.d(t,{O:function(){return u}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354);var u=(0,n(8640).op)({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=(0,s._1)(e,"a","matMul"),l=(0,s._1)(t,"b","matMul"),p=(0,o.makeTypesMatch)(c,l),d=(0,r.Z)(p,2),f={a:c=d[0],b:l=d[1]},h={transposeA:n,transposeB:u};return a.BV.runKernel(i.XL,f,h)}})},6176:function(e,t,n){"use strict";n.d(t,{F:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=(0,i._1)(e,"x","max"),s={x:o},u={reductionIndices:t,keepDims:n};return r.BV.runKernel(a.Yo,s,u)}})},5777:function(e,t,n){"use strict";n.d(t,{_:function(){return l}});var r=n(318),a=n(2145),i=n(8354),o=n(6147),s=n(9151),u=n(8640),c=n(5561);var l=(0,u.op)({maxPool_:function(e,t,n,u,l){var p=(0,i._1)(e,"x","maxPool"),d=p,f=!1;3===p.rank&&(f=!0,d=(0,c.X)(p,[1,p.shape[0],p.shape[1],p.shape[2]])),o.hu(4===d.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(d.rank,".")})),o.hu(s.jT(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),s.m("maxPool",u,l);var h={x:d},m={filterSize:t,strides:n,pad:u,dimRoundingMode:l},v=r.BV.runKernel(a.mT,h,m);return f?(0,c.X)(v,[v.shape[1],v.shape[2],v.shape[3]]):v}})},705:function(e,t,n){"use strict";n.d(t,{g:function(){return l}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(5774),c=n(9118);var l=(0,n(8640).op)({maximum_:function(e,t){var n=(0,s._1)(e,"a","maximum"),l=(0,s._1)(t,"b","maximum"),p=(0,o.makeTypesMatch)(n,l),d=(0,r.Z)(p,2);n=d[0],l=d[1],"bool"===n.dtype&&(n=(0,c.p)(n,"int32"),l=(0,c.p)(l,"int32")),(0,u.assertAndGetBroadcastShape)(n.shape,l.shape);var f={a:n,b:l};return a.BV.runKernel(i.BM,f)}})},6568:function(e,t,n){"use strict";n.d(t,{J:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=(0,i._1)(e,"x","mean"),s={x:o},u={axis:t,keepDims:n};return r.BV.runKernel(a.q2,s,u)}})},7891:function(e,t,n){"use strict";n.d(t,{V:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=(0,i._1)(e,"x","min"),s={x:o},u={axis:t,keepDims:n};return r.BV.runKernel(a.c1,s,u)}})},2273:function(e,t,n){"use strict";n.d(t,{L:function(){return l}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(5774),c=n(9118);var l=(0,n(8640).op)({minimum_:function(e,t){var n=(0,s._1)(e,"a","minimum"),l=(0,s._1)(t,"b","minimum"),p=(0,o.makeTypesMatch)(n,l),d=(0,r.Z)(p,2);n=d[0],l=d[1],"bool"===n.dtype&&(n=(0,c.p)(n,"int32"),l=(0,c.p)(l,"int32")),(0,u.assertAndGetBroadcastShape)(n.shape,l.shape);var f={a:n,b:l};return a.BV.runKernel(i.q8,f)}})},9719:function(e,t,n){"use strict";n.d(t,{V:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({mirrorPad_:function(e,t,n){o.hu("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var s=(0,i._1)(e,"x","mirrorPad");if(0===s.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");o.hu(t.length===s.rank,(function(){return"Padding doesn't match input. Must be ".concat(s.rank,". ")+"Got ".concat(t.length,".")}));for(var u="reflect"===n?1:0,c=function(e){o.hu(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),o.hu(t[e][0]>=0&&t[e][0]<=s.shape[e]-u&&t[e][1]>=0&&t[e][1]<=s.shape[e]-u,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(s.shape[e]-u," or less than 0 for input of ")+"shape ".concat(s.shape)}))},l=0;l<s.rank;l++)c(l);var p={paddings:t,mode:n},d={x:s};return r.BV.runKernel(a.jQ,d,p)}})},4645:function(e,t,n){"use strict";n.d(t,{w:function(){return u}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354);var u=(0,n(8640).op)({mod_:function(e,t){var n=(0,s._1)(e,"a","mod"),u=(0,s._1)(t,"b","mod"),c=(0,o.makeTypesMatch)(n,u),l=(0,r.Z)(c,2),p={a:n=l[0],b:u=l[1]};return a.BV.runKernel(i.Vb,p)}})},651:function(e,t,n){"use strict";n.d(t,{d:function(){return u}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354);var u=(0,n(8640).op)({mul_:function(e,t){var n=(0,s._1)(e,"a","mul"),u=(0,s._1)(t,"b","mul"),c=(0,o.makeTypesMatch)(n,u),l=(0,r.Z)(c,2),p={a:n=l[0],b:u=l[1]};return a.BV.runKernel(i.wY,p)}})},4362:function(e,t,n){"use strict";n.d(t,{W:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({neg_:function(e){var t={x:(0,i._1)(e,"x","neg")};return r.BV.runKernel(a.ku,t)}})},6662:function(e,t,n){"use strict";n.d(t,{K:function(){return g}});var r=n(8354),a=n(6147),i=n(7613),o=n(8473),s=n(6176),u=n(7891),c=n(8640),l=n(4334),p=n(5561),d=n(7067),f=n(6902),h=n(7391),m=n(227);function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return(0,i.W)(e);if(1!==e.rank&&null===n)return v((0,p.X)(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return(0,m.S)((0,i.W)(e),n);if(t===1/0)return(0,s.F)((0,i.W)(e),n);if(t===-1/0)return(0,u.V)((0,i.W)(e),n);if("euclidean"===t||2===t)return(0,f._)((0,m.S)((0,l.s)((0,i.W)(e),(0,d.i)(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return(0,s.F)((0,m.S)((0,i.W)(e),n[0]),n[1]-1);if(t===1/0)return(0,s.F)((0,m.S)((0,i.W)(e),n[1]),n[0]);if(t===-1/0)return(0,u.V)((0,m.S)((0,i.W)(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return(0,f._)((0,m.S)((0,h.h)(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var g=(0,c.op)({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=v(e=(0,r._1)(e,"x","norm"),t,n),u=s.shape;if(i){var c=(0,a.EC)(n,e.shape);u=o.rv(s.shape,c)}return(0,p.X)(s,u)}})},5549:function(e,t,n){"use strict";n.d(t,{Q:function(){return c}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(5774);var c=(0,n(8640).op)({notEqual_:function(e,t){var n=(0,s._1)(e,"a","notEqual","string_or_numeric"),c=(0,s._1)(t,"b","notEqual","string_or_numeric"),l=(0,o.makeTypesMatch)(n,c),p=(0,r.Z)(l,2);n=p[0],c=p[1],(0,u.assertAndGetBroadcastShape)(n.shape,c.shape);var d={a:n,b:c};return a.BV.runKernel(i.yQ,d)}})},4326:function(e,t,n){"use strict";n.d(t,{l:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var s=(0,i._1)(e,"indices","oneHot","int32"),u={indices:s},c={depth:t,onValue:n,offValue:o};return r.BV.runKernel(a.we,u,c)}})},6100:function(e,t,n){"use strict";n.d(t,{i:function(){return s}});var r=n(318),a=n(6147),i=n(9253),o=n(7742);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=s(e,"float32"),u=(0,o.l)(e,"float32");return(0,i.P)(n,u)}var c=(0,a.p8)((0,a.NA)(e),t);return r.BV.makeTensor(c,e,t)}},773:function(e,t,n){"use strict";n.d(t,{J:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({onesLike_:function(e){var t={x:(0,i._1)(e,"x","onesLike")};return r.BV.runKernel(a.qW,t)}})},8640:function(e,t,n){"use strict";n.d(t,{op:function(){return o},z:function(){return i}});var r=n(318),a=n(6147),i="__op";function o(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],o=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=i;var s=function(){r.BV.startScope(n);try{var e=o.apply(void 0,arguments);return(0,a.tI)(e)&&console.error("Cannot return a Promise inside of tidy."),r.BV.endScope(e),e}catch(t){throw r.BV.endScope(null),t}};return Object.defineProperty(s,"name",{value:n,configurable:!0}),s}},4348:function(e,t,n){"use strict";n.d(t,{zvA:function(){return d.z},WnP:function(){return a.W},Khb:function(){return i.K},__u:function(){return o._},IHx:function(){return s.I},QBD:function(){return f},$6P:function(){return h.$},YjB:function(){return m.Y},NqF:function(){return v.N},vHJ:function(){return g.v},ZRM:function(){return y.Z},VfV:function(){return b.V},z4N:function(){return x.z},fvJ:function(){return k.f},C80:function(){return w.C},wS1:function(){return S.w},uR5:function(){return C},zEQ:function(){return Z},tgs:function(){return M.t},Dxk:function(){return z},JY5:function(){return L},p3b:function(){return P},E4h:function(){return O.E},yE8:function(){return B},anm:function(){return tr},XsQ:function(){return W},UFq:function(){return V.U},f3b:function(){return U.f},pju:function(){return N.p},mDi:function(){return G.m},iUl:function(){return j.i},d9v:function(){return H.d},PYB:function(){return q.P},zoF:function(){return E.z},gME:function(){return K},Izb:function(){return X},MNy:function(){return Y},ZaL:function(){return Q},PAt:function(){return J.P},Tek:function(){return $.T},bc:function(){return ee.b},pdZ:function(){return te},$QV:function(){return re},mCk:function(){return ae.m},f9Y:function(){return ie.f},mew:function(){return fr},$Gn:function(){return oe.$},zbp:function(){return se.z},ppE:function(){return ue},nTT:function(){return ce.n},B10:function(){return le.B},Ka3:function(){return pe},WmZ:function(){return de.W},hiC:function(){return fe.h},NTj:function(){return he.N},AKD:function(){return me.A},rvX:function(){return pr},WYO:function(){return ve},pyx:function(){return ge.p},GRh:function(){return dr},DgJ:function(){return ye.D},qNN:function(){return be.q},d2q:function(){return xe.d},Qqt:function(){return ke.Q},dt4:function(){return we.d},t$B:function(){return Se.t},iyy:function(){return Ne},kp_:function(){return xn.k},hlL:function(){return Te.h},GWj:function(){return Ce.G},qPi:function(){return Ee.q},imm:function(){return r},Iqj:function(){return _e.I},dbB:function(){return lr},pjt:function(){return Ae.p},brS:function(){return Re.b},Sxn:function(){return kn.S},asL:function(){return Fe.a},BHj:function(){return Sa},V3u:function(){return mr},wx0:function(){return wn.w},xVT:function(){return De.x},UWc:function(){return Ze.U},i2d:function(){return Oe.i},hi7:function(){return Me.h},d9m:function(){return ze.d},zN1:function(){return Le.z},$r2:function(){return Ia},SX3:function(){return Pe},G9k:function(){return Be.G},cM7:function(){return We.c},Krr:function(){return Ve.K},e_t:function(){return Ue.e},CmS:function(){return Ge.C},l_t:function(){return je.l},HvI:function(){return He.H},hJK:function(){return qe.h},K5V:function(){return Ke.K},egP:function(){return Xe.e},MB5:function(){return Na},eab:function(){return Je},OI3:function(){return _.O},Fp7:function(){return $e.F},_sB:function(){return et._},YQQ:function(){return tt},Ip$:function(){return nt},gWQ:function(){return rt.g},J69:function(){return at.J},ry_:function(){return st},VV$:function(){return ut.V},LTh:function(){return ct.L},VdP:function(){return lt.V},wQq:function(){return pt.w},Gi7:function(){return mt},p_:function(){return ir},dC7:function(){return A.d},rq4:function(){return vt},SJ_:function(){return gt},W76:function(){return yt.W},KOy:function(){return rr.K},Quu:function(){return bt.Q},lfX:function(){return xt.l},iUs:function(){return it.i},JpU:function(){return kt.J},op:function(){return d.op},N2O:function(){return wt},vku:function(){return St.v},pNR:function(){return It},koy:function(){return Nt},t1L:function(){return Tt},lGY:function(){return Ct},d_R:function(){return Et.d},sQ3:function(){return _t.s},AL3:function(){return At.A},S0v:function(){return Rt.S},WVs:function(){return Ft.W},TN_:function(){return Dt},wzB:function(){return Bt},nGf:function(){return Wt},ruB:function(){return Vt},LGj:function(){return Ut},w6H:function(){return Gt},kwC:function(){return jt.k},M25:function(){return Ht.M},UYe:function(){return qt.U},btT:function(){return Kt.b},XLQ:function(){return T.X},GYS:function(){return Xt.G},SDf:function(){return Yt},diP:function(){return Qt},sx7:function(){return Jt},mG2:function(){return $t},QEs:function(){return Sn.Q},NMM:function(){return en.N},bp0:function(){return tn.b},iD$:function(){return nn.i},snQ:function(){return sr},zcT:function(){return Qe},U8D:function(){return rn.U},U_I:function(){return an.U},ODp:function(){return cn},XD2:function(){return R.X},Xxe:function(){return ln.X},tdS:function(){return wa},O$l:function(){return pn.O},R_K:function(){return dn.R},tPi:function(){return F.t},jZU:function(){return fn},SmN:function(){return hn},CnO:function(){return mn},p0P:function(){return vn},XAC:function(){return gn.X},Wvh:function(){return yn.W},fBT:function(){return bn.f},rVs:function(){return Ta},ers:function(){return cr},uN7:function(){return ka},Vl2:function(){return In.V},_b3:function(){return Nn._},h62:function(){return ft.h},$i:function(){return Tn.$},L9e:function(){return Cn.L},knu:function(){return En.k},Nbs:function(){return _n.N},NXj:function(){return An.N},Z_8:function(){return Ca},luU:function(){return ht.l},Smz:function(){return Rn.S},ORZ:function(){return Fn.O},AEp:function(){return D.A},XeE:function(){return Dn.X},RRF:function(){return On},odF:function(){return Mn},wOQ:function(){return zn.w},yXz:function(){return Ln},Bfx:function(){return Pn},xZs:function(){return Bn},Gg6:function(){return Ie.G},hg7:function(){return Wn.h},p4s:function(){return nr.p},Xu6:function(){return Vn},Two:function(){return Un.T},pUJ:function(){return Gn.p},HHK:function(){return jn.H},GaM:function(){return Hn},VD$:function(){return qn},arb:function(){return Kn.a},itS:function(){return Qn},lls:function(){return Jn.l},P84:function(){return $n.P}});var r={};n.r(r),n.d(r,{conv2d:function(){return wr},depthwiseConv2d:function(){return Nr},matMul:function(){return Tr}});var a=n(7613),i=n(1719),o=n(4502),s=n(3312),u=n(318),c=n(2145),l=n(8354),p=n(6147),d=n(8640);var f=(0,d.op)({addN_:function(e){p.hu(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),p.hu(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(e.length)}));var t=e.map((function(e,t){return(0,l._1)(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!p.cO(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return u.BV.runKernel(c.Xz,r)}}),h=n(4108),m=n(8543),v=n(9995),g=n(5157),y=n(3053),b=n(54),x=n(4778),k=n(2227),w=n(7897),S=n(9204),I=n(9151),N=n(9118),T=n(5561);var C=(0,d.op)({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=(0,l._1)(e,"x","avgPool3d","float32"),s=o,d=!1;4===o.rank&&(d=!0,s=(0,T.X)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),p.hu(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),p.hu("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),(0,I.m)("avgPool3d",r,a);var f={x:s},h={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},m=u.BV.runKernel(c._k,f,h);return m=(0,N.p)(m,s.dtype),d?(0,T.X)(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),E=n(4836),_=n(7221),A=n(651),R=n(7643),F=n(9238),D=n(1744);var Z=(0,d.op)({basicLSTMCell_:function(e,t,n,r,a,i){var o=(0,l._1)(e,"forgetBias","basicLSTMCell"),u=(0,l._1)(t,"lstmKernel","basicLSTMCell"),c=(0,l._1)(n,"lstmBias","basicLSTMCell"),p=(0,l._1)(r,"data","basicLSTMCell"),d=(0,l._1)(a,"c","basicLSTMCell"),f=(0,l._1)(i,"h","basicLSTMCell"),h=(0,E.z)([p,f],1),m=(0,_.O)(h,u),v=(0,s.I)(m,c),g=v.shape[0],y=v.shape[1]/4,b=[g,y],x=(0,F.t)(v,[0,0],b),k=(0,F.t)(v,[0,y],b),w=(0,F.t)(v,[0,2*y],b),S=(0,F.t)(v,[0,3*y],b),I=(0,s.I)((0,A.d)((0,R.X)(x),(0,D.A)(k)),(0,A.d)(d,(0,R.X)((0,s.I)(o,w))));return[I,(0,A.d)((0,D.A)(I),(0,R.X)(S))]}}),O=n(6994),M=n(3700);var z=(0,d.op)({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=(0,l._1)(e,"x","batchNorm"),c=(0,l._1)(t,"mean","batchNorm"),d=(0,l._1)(n,"variance","batchNorm");return null!=a&&(o=(0,l._1)(a,"scale","batchNorm")),null!=r&&(s=(0,l._1)(r,"offset","batchNorm")),p.hu(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(u.rank,".")})),p.hu(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(c.rank,".")})),p.hu(2===d.rank||1===d.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(d.rank,".")})),null!=o&&p.hu(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&p.hu(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(s.rank,".")})),(0,M.t)(u,c,d,s,o,i)}});var L=(0,d.op)({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=(0,l._1)(e,"x","batchNorm"),c=(0,l._1)(t,"mean","batchNorm"),d=(0,l._1)(n,"variance","batchNorm");return null!=a&&(o=(0,l._1)(a,"scale","batchNorm")),null!=r&&(s=(0,l._1)(r,"offset","batchNorm")),p.hu(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),p.hu(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(c.rank,".")})),p.hu(3===d.rank||1===d.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(d.rank,".")})),null!=o&&p.hu(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&p.hu(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(s.rank,".")})),(0,M.t)(u,c,d,s,o,i)}});var P=(0,d.op)({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=(0,l._1)(e,"x","batchNorm"),c=(0,l._1)(t,"mean","batchNorm"),d=(0,l._1)(n,"variance","batchNorm");return null!=a&&(o=(0,l._1)(a,"scale","batchNorm")),null!=r&&(s=(0,l._1)(r,"offset","batchNorm")),p.hu(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(u.rank,".")})),p.hu(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(c.rank,".")})),p.hu(4===d.rank||1===d.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(d.rank,".")})),null!=o&&p.hu(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&p.hu(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(s.rank,".")})),(0,M.t)(u,c,d,s,o,i)}});var B=(0,d.op)({bincount_:function(e,t,n){var r=(0,l._1)(e,"x","bincount"),a=(0,l._1)(t,"weights","bincount");p.hu("int32"===r.dtype,(function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)})),p.hu(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),p.hu(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return u.BV.runKernel(c.zv,i,o)}});var W=(0,d.op)({broadcastArgs_:function(e,t){var n=(0,l._1)(e,"s0","broadcastArgs","int32"),r=(0,l._1)(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:n,s1:r};return u.BV.runKernel(c.eE,a)}}),V=n(9742),U=n(7039),G=n(1396),j=n(9836),H=n(672),q=n(9253);var K=(0,d.op)({concat1d_:function(e){return(0,E.z)(e,0)}});var X=(0,d.op)({concat2d_:function(e,t){return(0,E.z)(e,t)}});var Y=(0,d.op)({concat3d_:function(e,t){return(0,E.z)(e,t)}});var Q=(0,d.op)({concat4d_:function(e,t){return(0,E.z)(e,t)}}),J=n(4918),$=n(3457),ee=n(1732);var te=(0,d.op)({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=(0,l._1)(e,"x","conv3d"),s=(0,l._1)(t,"filter","conv3d"),d=o,f=!1;4===o.rank&&(f=!0,d=(0,T.X)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),p.hu(5===d.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(d.rank,".")})),p.hu(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),p.hu(d.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(d.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),p.hu((0,I.jT)(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),p.hu("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var h={x:d,filter:s},m={strides:n,pad:r,dataFormat:a,dilations:i},v=u.BV.runKernel(c.x1,h,m);return f?(0,T.X)(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),ne=n(1873);var re=(0,d.op)({conv3dTranspose_:function(e,t,n,r,a){var i=(0,l._1)(e,"x","conv3dTranspose"),o=(0,l._1)(t,"filter","conv3dTranspose");return(0,ne._)(n,i,o,r,a)}}),ae=n(1227),ie=n(6679),oe=n(9457),se=n(8862);var ue=(0,d.op)({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=(0,l._1)(e,"x","denseBincount"),i=(0,l._1)(t,"weights","denseBincount");p.hu("int32"===a.dtype,(function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)})),p.hu(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")})),p.hu(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),p.hu(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return u.BV.runKernel(c.QR,o,s)}}),ce=n(1878),le=n(1147);var pe=(0,d.op)({diag_:function(e){var t={x:(0,l._1)(e,"x","diag")};return u.BV.runKernel(c.$w,t)}}),de=n(7580),fe=n(5750),he=n(5923),me=n(5043);var ve=(0,d.op)({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return(0,l._1)(e,"tensors".concat(t),"einsum")})),i={equation:e};return u.BV.runKernel(c.$g,a,i)}}),ge=n(2353),ye=n(3254),be=n(3891),xe=n(3313),ke=n(411),we=n(2975),Se=n(5682),Ie=n(2343);var Ne=(0,d.op)({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=(0,U.f)([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=(0,T.X)(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return(0,Ie.G)((0,we.d)(s,0),[n[0],1,1]);if(2===n.length)return(0,Ie.G)((0,we.d)((0,we.d)(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return(0,Ie.G)((0,we.d)((0,we.d)((0,we.d)(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}}),Te=n(8582),Ce=n(2628),Ee=n(7145),_e=n(9498),Ae=n(5014),Re=n(8327),Fe=n(6996),De=n(300),Ze=n(4652),Oe=n(7005),Me=n(4419),ze=n(4920),Le=n(2642);function Pe(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return u.BV.runKernel(c.e7,{},r)}var Be=n(936),We=n(378),Ve=n(5341),Ue=n(5113),Ge=n(4561),je=n(5530),He=n(2177),qe=n(875),Ke=n(5117),Xe=n(1712),Ye=2147483648;var Qe=(0,d.op)({searchSorted_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",r=(0,l._1)(e,"sortedSequence","searchSorted"),a=(0,l._1)(t,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=(0,T.X)(r,[-1,i]),d=(0,T.X)(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==d.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if((0,p.NA)(d.shape)>=Ye)throw new Error("values tensor size must less than ".concat(Ye));if(s.shape[1]>=Ye)throw new Error("trailing dim_size must less than ".concat(Ye," for int32 output type, was ").concat(s.shape[1]));var f={sortedSequence:s,values:d},h={side:n};return u.BV.runKernel(c.nr,f,h)}});function Je(e,t){return Qe(e,t,"left")}var $e=n(6176),et=n(5777);var tt=(0,d.op)({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=(0,l._1)(e,"x","maxPool3d"),s=o,d=!1;4===o.rank&&(d=!0,s=(0,T.X)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),p.hu(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),p.hu("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),(0,I.m)("maxPool3d",r,a);var f={x:s},h={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},m=u.BV.runKernel(c.OA,f,h);return d?(0,T.X)(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}});var nt=(0,d.op)({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=(0,l._1)(e,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},p=u.BV.runKernel(c.vF,o,s);return{result:p[0],indexes:p[1]}}}),rt=n(705),at=n(6568),it=n(6100),ot=n(4376);function st(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.indexing,a=void 0===r?"xy":r;if("xy"!==a&&"ij"!==a)throw new TypeError("".concat(a," is not a valid third argument to meshgrid"));if(void 0===e)return[];var i=(0,l._1)(e,"x","meshgrid",e instanceof ot.es?e.dtype:"float32");if(void 0===t)return[i];var o=(0,l._1)(t,"y","meshgrid",t instanceof ot.es?t.dtype:"float32"),s=(0,p.NA)(i.shape),u=(0,p.NA)(o.shape);return"xy"===a?(i=(0,T.X)(i,[1,-1]),o=(0,T.X)(o,[-1,1]),[(0,_.O)((0,it.i)([u,1],i.dtype),i),(0,_.O)(o,(0,it.i)([1,s],o.dtype))]):(i=(0,T.X)(i,[-1,1]),o=(0,T.X)(o,[1,-1]),[(0,_.O)(i,(0,it.i)([1,u],i.dtype)),(0,_.O)((0,it.i)([s,1],o.dtype),o)])}var ut=n(7891),ct=n(2273),lt=n(9719),pt=n(4645),dt=n(8473),ft=n(7391),ht=n(4774);var mt=(0,d.op)({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=(0,l._1)(e,"x","moments");var r=(0,p.EC)(t,e.shape),a=(0,at.J)(e,r,n),i=a.shape;n||(i=(0,dt.rv)(a.shape,r));var o=(0,ft.h)((0,ht.l)((0,N.p)(e,"float32"),(0,T.X)(a,i))),s=(0,at.J)(o,r,n);return{mean:a,variance:s}}});var vt=(0,d.op)({multiRNNCell_:function(e,t,n,r){for(var a=(0,l._1)(t,"data","multiRNNCell"),i=(0,l.sI)(n,"c","multiRNNCell"),o=(0,l.sI)(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var p=e[c](s,i[c],o[c]);u.push(p[0]),u.push(p[1]),s=p[1]}for(var d=[],f=[],h=0;h<u.length;h+=2)d.push(u[h]),f.push(u[h+1]);return[d,f]}});var gt=(0,d.op)({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=(0,l._1)(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s=1===o?(0,T.X)(a,[1,-1]):a,p={logits:s},d={numSamples:t,seed:n,normalized:r},f=u.BV.runKernel(c.NZ,p,d);return 1===o?(0,T.X)(f,[f.size]):f}}),yt=n(4362),bt=n(5549),xt=n(4326),kt=n(773);var wt=(0,d.op)({outerProduct_:function(e,t){var n=(0,l._1)(e,"v1","outerProduct"),r=(0,l._1)(t,"v2","outerProduct");p.hu(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=(0,T.X)(n,[-1,1]),i=(0,T.X)(r,[1,-1]);return(0,_.O)(a,i)}}),St=n(1970);var It=(0,d.op)({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,p.hu)(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),(0,St.v)(e,[t],n)}});var Nt=(0,d.op)({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,p.hu)(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),(0,St.v)(e,t,n)}});var Tt=(0,d.op)({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,p.hu)(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),(0,St.v)(e,t,n)}});var Ct=(0,d.op)({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,p.hu)(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),(0,St.v)(e,t,n)}}),Et=n(7226),_t=n(4334),At=n(6859),Rt=n(4600),Ft=n(7722);var Dt=(0,d.op)({rand_:function(e,t,n){var r=(0,p.NA)(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return u.BV.makeTensor(a,e,n)}}),Zt=n(5671),Ot=n(3144),Mt=n(6699),zt=function(){function e(t,n,r,a,i){(0,Zt.Z)(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Mt.alea(o.toString())}return(0,Ot.Z)(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),Lt=function(){function e(t,n,r,a){(0,Zt.Z)(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=Mt.alea(i.toString()),this.randn=new zt(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return(0,Ot.Z)(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),Pt=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if((0,Zt.Z)(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=Mt.alea(i)}return(0,Ot.Z)(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var Bt=(0,d.op)({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new Lt(t,n,r,a),o=(0,U.f)(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Wt=(0,d.op)({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new zt(t,n,r,!1,a),o=(0,U.f)(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Vt=(0,d.op)({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return Wt(e,0,1,t,n)}});var Ut=(0,d.op)({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=(0,U.f)(e,r),o=new Pt(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function Gt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return u.BV.runKernel(c.e6,{},a)}var jt=n(6972),Ht=n(2209),qt=n(7539),Kt=n(5900),Xt=n(4933);var Yt=(0,d.op)({reverse1d_:function(e){var t=(0,l._1)(e,"x","reverse");return p.hu(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),(0,Xt.G)(t,0)}});var Qt=(0,d.op)({reverse2d_:function(e,t){var n=(0,l._1)(e,"x","reverse");return p.hu(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),(0,Xt.G)(n,t)}});var Jt=(0,d.op)({reverse3d_:function(e,t){var n=(0,l._1)(e,"x","reverse");return p.hu(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),(0,Xt.G)(n,t)}});var $t=(0,d.op)({reverse4d_:function(e,t){var n=(0,l._1)(e,"x","reverse");return p.hu(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),(0,Xt.G)(n,t)}}),en=n(766),tn=n(5115),nn=n(7067),rn=n(413),an=n(119),on=n(4165),sn=n(5861);function un(){return un=(0,sn.Z)((0,on.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,d,f,h,m;return(0,on.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,l._1)(t,"x","setdiff1d"),a=(0,l._1)(n,"y","setdiff1d"),p.hu(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),p.hu(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),p.hu(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=7,r.data();case 7:return i=e.sent,e.next=10,a.data();case 10:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(d=new ot.YD([u],r.dtype),f=new ot.YD([u],"int32"),h=0,m=0;h<i.length;h++)s.has(i[h])||(d.values[m]=i[h],f.values[m]=h,m++);return e.abrupt("return",[d.toTensor(),f.toTensor()]);case 18:case"end":return e.stop()}}),e)}))),un.apply(this,arguments)}var cn=function(e,t){return un.apply(this,arguments)},ln=n(2070),pn=n(7254),dn=n(7657);var fn=(0,d.op)({slice1d_:function(e,t,n){var r=(0,l._1)(e,"x","slice1d");return p.hu(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),(0,F.t)(r,[t],[n])}});var hn=(0,d.op)({slice2d_:function(e,t,n){var r=(0,l._1)(e,"x","slice2d");return p.hu(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),(0,F.t)(r,t,n)}});var mn=(0,d.op)({slice3d_:function(e,t,n){var r=(0,l._1)(e,"x","slice3d");return p.hu(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),(0,F.t)(r,t,n)}});var vn=(0,d.op)({slice4d_:function(e,t,n){var r=(0,l._1)(e,"x","slice4d");return p.hu(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),(0,F.t)(r,t,n)}}),gn=n(4910),yn=n(4626),bn=n(5696),xn=n(7635),kn=n(530),wn=n(774),Sn=n(4617),In=n(2588),Nn=n(6902),Tn=n(7993),Cn=n(3931),En=n(8306),_n=n(4031),An=n(9017),Rn=n(227),Fn=n(6999),Dn=n(2442),Zn=n(7960);function On(e,t){(0,p.Cq)(e);var n=(0,l.C)(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return(0,Zn.H)(e,null,n,t)}function Mn(e,t,n){if((0,p.Cq)(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=(0,l.C)(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return(0,Zn.H)(e,t,r,n)}var zn=n(3123);function Ln(e,t,n){if((0,p.Cq)(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=(0,l.C)(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return(0,Zn.H)(e,t,r,n)}function Pn(e,t,n){if((0,p.Cq)(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=(0,l.C)(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return(0,Zn.H)(e,t,r,n)}function Bn(e,t,n){if((0,p.Cq)(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=(0,l.C)(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,(0,Zn.H)(e,t,r,n)}var Wn=n(9085);var Vn=(0,d.op)({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new zt(t,n,r,!0,a),o=(0,U.f)(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Un=n(4860),Gn=n(6918),jn=n(4566);function Hn(e,t){return Qe(e,t,"right")}function qn(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return u.BV.makeVariable(e,t,n,r)}var Kn=n(329),Xn=n(4189);function Yn(){return(Yn=(0,sn.Z)((0,on.Z)().mark((function e(t){var n,r,a;return(0,on.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,l._1)(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=(0,Xn.Z)(n.shape,r),t!==n&&n.dispose(),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qn=function(e){return Yn.apply(this,arguments)},Jn=n(7742),$n=n(7293);function er(){return er=(0,sn.Z)((0,on.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,d,f,h,m,v,g,y;return(0,on.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=(0,l._1)(t,"tensor","boolMask"),i=(0,l._1)(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,p.hu(s>0,(function(){return"mask cannot be scalar"})),p.k5(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,d=o;d<o+s;d++)c*=u[d];return f=u.slice(0,o).concat([c],u.slice(o+s)),h=(0,T.X)(a,f),m=(0,T.X)(i,[-1]),e.next=14,Qn(m);case 14:return v=e.sent,g=(0,Cn.L)(v,[1]),y=(0,_e.I)(h,g,o),t!==a&&a.dispose(),n!==i&&i.dispose(),g.dispose(),h.dispose(),m.dispose(),v.dispose(),e.abrupt("return",y);case 24:case"end":return e.stop()}}),e)}))),er.apply(this,arguments)}var tr=function(e,t,n){return er.apply(this,arguments)},nr=n(1240),rr=n(6662),ar=n(9064);var ir=(0,d.op)({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=(0,l._1)(e,"v","movingAverage"),o=(0,l._1)(t,"x","movingAverage"),u=(0,l._1)(n,"decay","movingAverage");(0,ar.assertTypesMatch)(i,o),p.hu(p.cO(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var c=(0,nn.i)(1),d=(0,ht.l)(c,u),f=(0,A.d)((0,ht.l)(o,i),d);if(a){p.hu(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=(0,l._1)(r,"step","movingAverage");f=(0,fe.h)(f,(0,ht.l)(c,(0,_t.s)(u,h)))}return(0,s.I)(i,f)}}),or=n(8604);var sr=(0,d.op)({scatterND_:function(e,t,n){var r=(0,l._1)(e,"indices","scatterND","int32"),a=(0,l._1)(t,"updates","scatterND");or.validateInput(a,r,n);var i={indices:r,updates:a},o={shape:n};return u.BV.runKernel(c.xQ,i,o)}});function ur(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape "+"".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}var cr=(0,d.op)({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=(0,l._1)(e,"sparseIndices","sparseToDense","int32"),i=(0,l._1)(t,"sparseValues","sparseToDense","string_or_numeric"),o=(0,l._1)(r,"defaultValue","sparseToDense",i.dtype);ur(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},p={outputShape:n};return u.BV.runKernel(c.D2,s,p)}});var lr=(0,d.op)({gatherND_:function(e,t){var n=(0,l._1)(t,"indices","gatherND","int32"),r={params:(0,l._1)(e,"x","gatherND","string_or_numeric"),indices:n};return u.BV.runKernel(c.q1,r)}});var pr=(0,d.op)({dropout_:function(e,t,n,r){var a=(0,l._1)(e,"x","dropout");if(p.hu("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")})),p.hu(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof ot.es?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(p.cO(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,u=(0,fe.h)((0,Ce.G)((0,s.I)(Ut(i,0,1,"float32",r),o)),o);return(0,A.d)(a,u)}});function dr(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function fr(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return On(a,"float32")}function hr(){return hr=(0,sn.Z)((0,on.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,d,f,h,m,v,g,y,b,x=arguments;return(0,on.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=x.length>2&&void 0!==x[2]?x[2]:1,a=(0,l._1)(t,"predictions","inTopK"),i=(0,l._1)(n,"targets","inTopK"),(0,p.hu)(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(a.rank)})),(0,p.hu)(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(a.rank," and targets rank ").concat(i.rank)})),(0,p.k5)(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],(0,p.hu)(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(o,"), but got ").concat(r)})),e.next=10,a.data();case 10:return s=e.sent,e.next=13,i.data();case 13:u=e.sent,c=s.length/o,d=o,f=(0,p.WP)("bool",c),h=0;case 17:if(!(h<c)){e.next=35;break}for(m=h*d,v=s.subarray(m,m+d),g=[],y=0;y<v.length;y++)g.push({value:v[y],index:y});g.sort((function(e,t){return t.value-e.value})),f[h]=0,b=0;case 25:if(!(b<r)){e.next=32;break}if(g[b].index!==u[h]){e.next=29;break}return f[h]=1,e.abrupt("break",32);case 29:b++,e.next=25;break;case 32:h++,e.next=17;break;case 35:return t!==a&&a.dispose(),n!==i&&i.dispose(),e.abrupt("return",(0,Dn.X)(f,i.shape,"bool"));case 38:case"end":return e.stop()}}),e)}))),hr.apply(this,arguments)}var mr=function(e,t){return hr.apply(this,arguments)},vr=n(9439),gr=n(6450),yr=n(5774),br=n(8744),xr=n(1045),kr=n(5171);var wr=(0,d.op)({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,d=e.dilations,f=void 0===d?[1,1]:d,h=e.dimRoundingMode,m=e.bias,v=e.activation,g=void 0===v?"linear":v,y=e.preluActivationWeights,b=e.leakyreluAlpha;if(g=g||"linear",!1===(0,kr.uy)(u.BV.state.gradientDepth,g)){p.hu("NHWC"===o,(function(){return"Error in fused conv2d: got dataFormat of ".concat(o," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."}));var x=(0,$.T)(t,n,r,a,o,f,h);return null!=m&&(x=(0,s.I)(x,m)),(0,kr.QH)(x,g,y,b)}var k=(0,l._1)(t,"x","conv2d","float32"),w=(0,l._1)(n,"filter","conv2d","float32"),S=k,N=!1;3===k.rank&&(N=!0,S=(0,T.X)(k,[1,k.shape[0],k.shape[1],k.shape[2]])),p.hu(4===S.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(S.rank,".")})),p.hu(4===w.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(w.rank,".")})),I.m("fused conv2d",a,h);var C="NHWC"===o?S.shape[3]:S.shape[1];p.hu(w.shape[2]===C,(function(){return"Error in conv2d: depth of input (".concat(C,") must match ")+"input depth for filter ".concat(w.shape[2],".")})),p.hu(I.jT(r,f),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(f,"'")}));var E,_,A=I.Ix(S.shape,w.shape,r,f,a,h);if(null!=m){E=(0,l._1)(m,"bias","fused conv2d");var R=(0,ar.makeTypesMatch)(E,k),F=(0,vr.Z)(R,1);E=F[0],"NHWC"===o?yr.assertAndGetBroadcastShape(A.outShape,E.shape):(p.hu(E.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(E.shape.length,".")})),p.hu(0===E.shape.length||E.shape[0]===A.outChannels||1===E.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(E.shape,") is not ")+"compatible with the number of output channels "+"(".concat(A.outChannels,")")})))}if(null!=y){var D=y.shape;if(p.hu(D.length<=1||3===D.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(D.length,".")})),1===D.length)p.hu(1===D[0]||D[0]===A.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(D,") is not compatible with the number of output ")+"channels (".concat(A.outChannels,").")}));else if(3===D.length)try{yr.assertAndGetBroadcastShape(D,A.outShape)}catch(B){var Z="Error in fused conv2d: PReLU activation weights (".concat(D,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(A.outShape,").");throw Error(Z)}_=(0,l._1)(y,"prelu weights","fused conv2d")}var O=function(e,t){p.hu("NHWC"===o,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var n=(0,vr.Z)(t,4),i=n[0],s=n[1],u=n[2],c=n[3],l=(0,kr.Fr)(e,u,g);p.hu(I.I0(f),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(f,"'")}));var d=[(0,xr._)(s.shape,l,i,r,a),(0,br.p)(s,l,i.shape,r,a)];if(null!=c){var h=(0,kr.pf)(c,l);d.push(h)}return d},M={x:S,filter:w,bias:E,preluActivationWeights:_},z={strides:r,pad:a,dataFormat:o,dilations:f,dimRoundingMode:h,activation:g,leakyreluAlpha:b};if(null==m){var L=(0,gr.cb)((function(e,t,n){var r=u.BV.runKernel(c._V,M,z);return n([t,e,r]),N&&(r=(0,T.X)(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:O}}));return L(S,w)}var P=(0,gr.cb)((function(e,t,n,r){var a=u.BV.runKernel(c._V,M,z);return r([t,e,a,n]),N&&(a=(0,T.X)(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:O}}));return P(S,w,E)}}),Sr=n(288),Ir=n(6939);var Nr=(0,d.op)({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,d=e.dilations,f=void 0===d?[1,1]:d,h=e.dimRoundingMode,m=e.bias,v=e.activation,g=void 0===v?"linear":v,y=e.preluActivationWeights,b=e.leakyreluAlpha;if(!1===(0,kr.uy)(u.BV.state.gradientDepth,g)){var x=(0,le.B)(t,n,r,a,o,f,h);return null!=m&&(x=(0,s.I)(x,m)),(0,kr.QH)(x,g,y,b)}var k=(0,l._1)(t,"x","depthwiseConv2d","float32"),w=(0,l._1)(n,"filter","depthwiseConv2d","float32"),S=k,N=!1;3===k.rank&&(N=!0,S=(0,T.X)(k,[1,k.shape[0],k.shape[1],k.shape[2]])),p.hu(4===S.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(S.rank,".")})),p.hu(4===w.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(w.rank,".")})),p.hu(S.shape[3]===w.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(S.shape[3],") must match the inChannels dimension in ")+"filter ".concat(w.shape[2],".")})),null==f&&(f=[1,1]),p.hu(I.jT(r,f),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(f,"'")})),I.m("fused depthwiseConv2d",a,h);var C,E,_=I.Ix(S.shape,w.shape,r,f,a,h,!0);if(null!=m){C=(0,l._1)(m,"bias","fused conv2d");var A=(0,ar.makeTypesMatch)(C,k),R=(0,vr.Z)(A,1);C=R[0],yr.assertAndGetBroadcastShape(_.outShape,C.shape)}null!=y&&(E=(0,l._1)(y,"prelu weights","fused depthwiseConv2d"));var F=function(e,t){p.hu(I.I0(f),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(f,"'")}));var n=(0,vr.Z)(t,4),i=n[0],o=n[1],s=n[2],u=n[3],c=(0,kr.Fr)(e,s,g),l=(0,Ir.v)(o.shape,c,i,r,a,f,h),d=(0,Sr.z)(o,c,i.shape,r,a,f,h);return null!=u?[l,d,(0,kr.pf)(C,c)]:[l,d]},D={x:S,filter:w,bias:C,preluActivationWeights:E},Z={strides:r,pad:a,dataFormat:o,dilations:f,dimRoundingMode:h,activation:g,leakyreluAlpha:b};if(null==m){var O=(0,gr.cb)((function(e,t,n){var r=u.BV.runKernel(c.lu,D,Z);return n([t,e,r]),N&&(r=(0,T.X)(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:F}}));return O(S,w)}var M=(0,gr.cb)((function(e,t,n,r){var a=u.BV.runKernel(c.lu,D,Z);return r([t,e,a,n]),N&&(a=(0,T.X)(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:F}}));return M(S,w,C)}});var Tr=(0,d.op)({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,d=e.bias,f=e.activation,h=void 0===f?"linear":f,m=e.preluActivationWeights,v=e.leakyreluAlpha,g=void 0===v?.2:v;if(!1===(0,kr.uy)(u.BV.state.gradientDepth,h)){var y=(0,_.O)(t,n,a,o);return null!=d&&(y=(0,s.I)(y,d)),(0,kr.QH)(y,h,m,g)}var b=(0,l._1)(t,"a","fused matMul"),x=(0,l._1)(n,"b","fused matMul"),k=(0,ar.makeTypesMatch)(b,x),w=(0,vr.Z)(k,2);b=w[0],x=w[1];var S=a?b.shape[b.rank-2]:b.shape[b.rank-1],I=o?x.shape[x.rank-1]:x.shape[x.rank-2],N=a?b.shape[b.rank-1]:b.shape[b.rank-2],C=o?x.shape[x.rank-2]:x.shape[x.rank-1],E=b.shape.slice(0,-2),A=x.shape.slice(0,-2),R=p.NA(E),F=p.NA(A);p.hu(S===I,(function(){return"Error in fused matMul: inner shapes (".concat(S,") and (")+"".concat(I,") of Tensors with shapes ").concat(b.shape," and ")+"".concat(x.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match.")}));var D,Z,O=yr.assertAndGetBroadcastShape(b.shape.slice(0,-2),x.shape.slice(0,-2)).concat([N,C]),M=a?(0,T.X)(b,[R,S,N]):(0,T.X)(b,[R,N,S]),z=o?(0,T.X)(x,[F,C,I]):(0,T.X)(x,[F,I,C]);if(null!=d){D=(0,l._1)(d,"bias","fused matMul");var L=(0,ar.makeTypesMatch)(D,b);D=(0,vr.Z)(L,1)[0],yr.assertAndGetBroadcastShape(O,D.shape)}null!=m&&(Z=(0,l._1)(m,"prelu weights","fused matMul"));var P=function(e,t){var n,r,i=(0,vr.Z)(t,4),s=i[0],u=i[1],c=i[2],l=i[3],p=(0,kr.Fr)((0,T.X)(e,c.shape),c,h);return a||o?!a&&o?(n=(0,_.O)(p,u,!1,!1),r=(0,_.O)(p,s,!0,!1)):a&&!o?(n=(0,_.O)(u,p,!1,!0),r=(0,_.O)(s,p,!1,!1)):(n=(0,_.O)(u,p,!0,!0),r=(0,_.O)(p,s,!0,!0)):(n=(0,_.O)(p,u,!1,!0),r=(0,_.O)(s,p,!0,!1)),null!=d?[n,r,(0,kr.pf)(l,p)]:[n,r]},B={a:M,b:z,bias:D,preluActivationWeights:Z},W={transposeA:a,transposeB:o,activation:h,leakyreluAlpha:g};if(null==d){var V=(0,gr.cb)((function(e,t,n){var r=u.BV.runKernel(c.us,B,W);return n([e,t,r]),{value:(0,T.X)(r,O),gradFunc:P}}));return V(M,z)}var U=(0,gr.cb)((function(e,t,n,r){var a=u.BV.runKernel(c.us,B,W);return r([e,t,a,n]),{value:(0,T.X)(a,O),gradFunc:P}}));return U(M,z,D)}});var Cr=(0,d.op)({hammingWindow_:function(e){return fr(e,.54,.46)}});var Er=(0,d.op)({hannWindow_:function(e){return fr(e,.5,.5)}});var _r=(0,d.op)({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push((0,F.t)(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=(0,E.z)([(0,F.t)(e,i,t-s),(0,Te.h)([s],a)]);o.push(u),i+=n}return 0===o.length?Mn([],[0,t]):(0,T.X)((0,E.z)(o),[o.length,t])}});var Ar=(0,d.op)({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Er;null==r&&(r=dr(t));var i=_r(e,t,n),o=(0,A.d)(i,a(t));return(0,Sn.Q)(o,r)}});var Rr=(0,d.op)({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=(0,l._1)(e,"image","cropAndResize"),s=(0,l._1)(t,"boxes","cropAndResize","float32"),d=(0,l._1)(n,"boxInd","cropAndResize","int32"),f=s.shape[0];p.hu(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),p.hu(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(f,",4] ")+"but had shape ".concat(s.shape,".")})),p.hu(1===d.rank&&d.shape[0]===f,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(f,"] ")+"but had shape ".concat(s.shape,".")})),p.hu(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),p.hu(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),p.hu("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var h={image:o,boxes:s,boxInd:d},m={method:a,extrapolationValue:i,cropSize:r},v=u.BV.runKernel(c.Vc,h,m);return v}});var Fr=(0,d.op)({flipLeftRight_:function(e){var t=(0,l._1)(e,"image","flipLeftRight","float32");p.hu(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return u.BV.runKernel(c.Uy,n,{})}});var Dr=(0,d.op)({grayscaleToRGB_:function(e){var t=(0,l._1)(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];p.hu(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")})),p.hu(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,(0,Ie.G)(t,a)}});var Zr=(0,d.op)({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=(0,l._1)(e,"image","rotateWithOffset","float32");p.hu(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r},s=u.BV.runKernel(c.b9,i,o);return s}});function Or(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),p.hu(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),p.hu(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),p.hu(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),p.hu(1===t.rank,(function(){return"scores must be a 1D tensor"})),p.hu(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),p.hu(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Mr=(0,d.op)({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=(0,l._1)(e,"boxes","nonMaxSuppression","float32"),o=(0,l._1)(t,"scores","nonMaxSuppression","float32"),s=Or(i,o,n,r,a),p={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return u.BV.runKernel(c.uv,{boxes:i,scores:o},p)}}),zr=n(745);function Lr(){return Lr=(0,sn.Z)((0,on.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,p,d,f,h,m=arguments;return(0,on.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=m.length>3&&void 0!==m[3]?m[3]:.5,i=m.length>4&&void 0!==m[4]?m[4]:Number.NEGATIVE_INFINITY,o=(0,l._1)(t,"boxes","nonMaxSuppressionAsync"),s=(0,l._1)(n,"scores","nonMaxSuppressionAsync"),u=Or(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=10,Promise.all([o.data(),s.data()]);case 10:return c=e.sent,p=c[0],d=c[1],f=(0,zr.GP)(p,d,r,a,i),h=f.selectedIndices,o!==t&&o.dispose(),s!==n&&s.dispose(),e.abrupt("return",On(h,"int32"));case 17:case"end":return e.stop()}}),e)}))),Lr.apply(this,arguments)}var Pr=function(e,t,n){return Lr.apply(this,arguments)};var Br=(0,d.op)({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=(0,l._1)(e,"boxes","nonMaxSuppression"),s=(0,l._1)(t,"scores","nonMaxSuppression"),p=Or(o,s,n,r,a,i),d={boxes:o,scores:s},f={maxOutputSize:n=p.maxOutputSize,iouThreshold:r=p.iouThreshold,scoreThreshold:a=p.scoreThreshold,softNmsSigma:i=p.softNmsSigma},h=u.BV.runKernel(c.W0,d,f);return{selectedIndices:h[0],selectedScores:h[1]}}});function Wr(){return Wr=(0,sn.Z)((0,on.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,p,d,f,h,m,v,g=arguments;return(0,on.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>3&&void 0!==g[3]?g[3]:.5,i=g.length>4&&void 0!==g[4]?g[4]:Number.NEGATIVE_INFINITY,o=g.length>5&&void 0!==g[5]?g[5]:0,s=(0,l._1)(t,"boxes","nonMaxSuppressionAsync"),u=(0,l._1)(n,"scores","nonMaxSuppressionAsync"),c=Or(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=12,Promise.all([s.data(),u.data()]);case 12:return p=e.sent,d=p[0],f=p[1],h=(0,zr.pA)(d,f,r,a,i,o),m=h.selectedIndices,v=h.selectedScores,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:On(m,"int32"),selectedScores:On(v)});case 19:case"end":return e.stop()}}),e)}))),Wr.apply(this,arguments)}var Vr=function(e,t,n){return Wr.apply(this,arguments)};var Ur=(0,d.op)({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=(0,l._1)(e,"boxes","nonMaxSuppression"),s=(0,l._1)(t,"scores","nonMaxSuppression"),p=Or(o,s,n,r,a,null),d=p.maxOutputSize,f=p.iouThreshold,h=p.scoreThreshold,m={boxes:o,scores:s},v={maxOutputSize:d,iouThreshold:f,scoreThreshold:h,padToMaxOutputSize:i},g=u.BV.runKernel(c.cy,m,v);return{selectedIndices:g[0],validOutputs:g[1]}}});function Gr(){return Gr=(0,sn.Z)((0,on.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,p,d,f,h,m,v,g,y,b,x,k=arguments;return(0,on.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k.length>3&&void 0!==k[3]?k[3]:.5,i=k.length>4&&void 0!==k[4]?k[4]:Number.NEGATIVE_INFINITY,o=k.length>5&&void 0!==k[5]&&k[5],s=(0,l._1)(t,"boxes","nonMaxSuppressionAsync"),u=(0,l._1)(n,"scores","nonMaxSuppressionAsync"),c=Or(s,u,r,a,i,null),p=c.maxOutputSize,d=c.iouThreshold,f=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return h=e.sent,m=(0,vr.Z)(h,2),v=m[0],g=m[1],y=(0,zr.qP)(v,g,p,d,f,o),b=y.selectedIndices,x=y.validOutputs,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:On(b,"int32"),validOutputs:(0,nn.i)(x,"int32")});case 19:case"end":return e.stop()}}),e)}))),Gr.apply(this,arguments)}var jr=function(e,t,n){return Gr.apply(this,arguments)},Hr=n(464),qr=n(8600);function Kr(e,t){for(var n,r,a,i,o,u,c=On([-1]),l=On([0]),p=On([0]),d=0;d<e.size-1;d++){n=(0,F.t)(e,0,d+1),r=(0,F.t)(e,d+1),o=(0,fe.h)((0,Rn.S)(n),t),u=(0,fe.h)((0,Rn.S)(r),t);var f=(0,Rn.S)((0,A.d)(n,Gt(0,n.size)));a=(0,fe.h)(f,(0,Rn.S)(n));var h=(0,Te.h)(r.shape,n.size),m=(0,s.I)(Gt(0,r.size),h),v=(0,A.d)(r,m);i=(0,fe.h)((0,Rn.S)(v),(0,Rn.S)(r));var g=(0,ht.l)(a,i),y=(0,ht.l)(a,i),b=(0,A.d)(o,u);p=(0,A.d)((0,A.d)(b,g),y);var x=(0,Ae.p)(p,l);l=(0,Kn.a)(x,p,l),c=(0,Kn.a)(x,On([d]),c)}return c}var Xr=(0,d.op)({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,c=(0,l._1)(e,"image","threshold"),d=.2989,f=.587,h=.114,m=c.shape[0]*c.shape[1],v=(0,A.d)(On([u]),255);if(p.hu(3===c.rank,(function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(c.rank,".")})),p.hu(3===c.shape[2]||1===c.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(c.shape[2],".")})),p.hu("int32"===c.dtype||"float32"===c.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(c.dtype,".")})),p.hu("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===c.shape[2]){var g=(0,In.V)(c,[1,1,1],-1),y=(0,vr.Z)(g,3);t=y[0],n=y[1],r=y[2];var b=(0,A.d)(t,d),x=(0,A.d)(n,f),k=(0,A.d)(r,h);a=(0,s.I)((0,s.I)(b,x),k)}else a=e;if("otsu"===i){var w=B((0,N.p)((0,en.N)(a),"int32"),(0,Dn.X)([]),256);v=Kr(w,m)}var S=o?(0,Le.z)(a,v):(0,Ae.p)(a,v),I=(0,N.p)((0,A.d)(S,255),"int32");return I}});var Yr=(0,d.op)({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=(0,l._1)(e,"image","transform","float32"),s=(0,l._1)(t,"transforms","transform","float32");p.hu(4===o.rank,(function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),p.hu(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),p.hu(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")}));var d={image:o,transforms:s},f={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return u.BV.runKernel(c.wx,d,f)}});var Qr=(0,d.op)({bandPart_:function(e,t,n){(0,p.hu)(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),(0,p.hu)(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=(0,l._1)(e,"a","bandPart");(0,p.hu)(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=r.shape.slice(-2),o=(0,vr.Z)(i,2),s=o[0],u=o[1];if(!(t<=s))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(s,")."));if(!(n<=u))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(u,")."));t<0&&(t=s),n<0&&(n=u);var c=(0,T.X)(Gt(0,s,1,"int32"),[-1,1]),d=Gt(0,u,1,"int32"),f=(0,ht.l)(c,d),h=(0,He.H)((0,Le.z)(f,(0,nn.i)(+t,"int32")),(0,Re.b)(f,(0,nn.i)(-n,"int32"))),m=(0,Jn.l)([s,u],r.dtype);return(0,T.X)((0,En.k)((0,jn.H)((0,T.X)(r,[-1,s,u])).map((function(e){return(0,Kn.a)(h,e,m)}))),a)}});var Jr=(0,d.op)({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,(0,p.hu)(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){(0,p.hu)(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=(0,In.V)(e,e.shape[0],0).map((function(e){return(0,Cn.L)(e,[0])}))),(0,p.hu)(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(u.BV.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=(0,A.d)((0,Rn.S)((0,A.d)(n[a],t)),n[a]);t=(0,ht.l)(t,i)}return(0,fe.h)(t,(0,rr.K)(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?(0,En.k)(n,0):n}}),$r=n(5875);function ea(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.BV.tidy((function(){(0,p.hu)(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=Ne(n),i=(0,H.d)(e),o=Mn([[1]],[1,1]),s=(0,H.d)(o),c=n>=r?r:n,l=function(e){var t=i,c=s,l=a,p=u.BV.tidy((function(){var t=(0,F.t)(i,[e,e],[n-e,1]),u=(0,rr.K)(t),c=(0,F.t)(i,[e,e],[1,1]),l=(0,Kn.a)((0,Ae.p)(c,0),Mn([[-1]]),Mn([[1]])),p=(0,ht.l)(c,(0,A.d)(l,u)),d=(0,fe.h)(t,p);s=1===d.shape[0]?(0,H.d)(o):(0,E.z)([o,(0,F.t)(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);var f=(0,yt.W)((0,fe.h)((0,_.O)(l,p),u)),h=(0,F.t)(i,[e,0],[n-e,r]),m=(0,A.d)(f,s),v=(0,nr.p)(s);if(0===e)i=(0,ht.l)(h,(0,_.O)(m,(0,_.O)(v,h)));else{var g=(0,ht.l)(h,(0,_.O)(m,(0,_.O)(v,h)));i=(0,E.z)([(0,F.t)(i,[0,0],[e,r]),g],0)}var y=(0,nr.p)(m),b=(0,F.t)(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=(0,ht.l)(b,(0,_.O)((0,_.O)(b,s),y));else{var x=(0,ht.l)(b,(0,_.O)((0,_.O)(b,s),y));a=(0,E.z)([(0,F.t)(a,[0,0],[n,e]),x],1)}return[s,i,a]})),d=(0,vr.Z)(p,3);s=d[0],i=d[1],a=d[2],(0,$r.B9)([t,c,l])},d=0;d<c;++d)l(d);return!t&&n>r&&(a=(0,F.t)(a,[0,0],[n,r]),i=(0,F.t)(i,[0,0],[r,r])),[a,i]}))}var ta=(0,d.op)({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((0,p.hu)(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return ea(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=(0,jn.H)((0,T.X)(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((function(e){var n=ea(e,t),r=(0,vr.Z)(n,2),o=r[0],s=r[1];a.push(o),i.push(s)}));var o=(0,T.X)((0,En.k)(a,0),e.shape),s=(0,T.X)((0,En.k)(i,0),e.shape);return[o,s]}}),na=n(7627);var ra=(0,d.op)({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:na.I.SUM_BY_NONZERO_WEIGHTS,r=(0,l._1)(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=(0,l._1)(t,"weights","computeWeightedLoss"));var i=null==a?r:(0,A.d)(r,a);if(n===na.I.NONE)return i;if(n===na.I.SUM)return(0,Rn.S)(i);if(n===na.I.MEAN){if(null==a)return(0,at.J)(i);var o=r.size/a.size,s=(0,fe.h)((0,Rn.S)(i),(0,Rn.S)(a));return o>1?(0,fe.h)(s,(0,nn.i)(o)):s}if(n===na.I.SUM_BY_NONZERO_WEIGHTS){if(null==a)return(0,fe.h)((0,Rn.S)(i),(0,nn.i)(r.size));var u=(0,A.d)(a,(0,it.i)(r.shape)),c=(0,N.p)((0,Rn.S)((0,bt.Q)(u,(0,nn.i)(0))),"float32");return(0,fe.h)((0,Rn.S)(i),c)}throw Error("Unknown reduction: ".concat(n))}});var aa=(0,d.op)({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:na.I.SUM_BY_NONZERO_WEIGHTS,i=(0,l._1)(e,"labels","absoluteDifference"),o=(0,l._1)(t,"predictions","absoluteDifference"),s=null;null!=n&&(s=(0,l._1)(n,"weights","absoluteDifference")),(0,p.k5)(i.shape,o.shape,"Error in absoluteDifference: ");var u=(0,a.W)((0,ht.l)(i,o));return ra(u,s,r)}});var ia=(0,d.op)({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:na.I.SUM_BY_NONZERO_WEIGHTS,i=(0,l._1)(e,"labels","cosineDistance"),o=(0,l._1)(t,"predictions","cosineDistance"),s=null;null!=r&&(s=(0,l._1)(r,"weights","cosineDistance")),(0,p.k5)(i.shape,o.shape,"Error in cosineDistance: ");var u=(0,nn.i)(1),c=(0,ht.l)(u,(0,Rn.S)((0,A.d)(i,o),n,!0));return ra(c,s,a)}});var oa=(0,d.op)({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:na.I.SUM_BY_NONZERO_WEIGHTS,a=(0,l._1)(e,"labels","hingeLoss"),i=(0,l._1)(t,"predictions","hingeLoss"),o=null;null!=n&&(o=(0,l._1)(n,"weights","hingeLoss")),(0,p.k5)(a.shape,i.shape,"Error in hingeLoss: ");var s=(0,nn.i)(1);a=(0,ht.l)((0,A.d)((0,nn.i)(2),a),s);var u=(0,qt.U)((0,ht.l)(s,(0,A.d)(a,i)));return ra(u,o,r)}});var sa=(0,d.op)({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:na.I.SUM_BY_NONZERO_WEIGHTS,o=(0,l._1)(e,"labels","huberLoss"),u=(0,l._1)(t,"predictions","huberLoss"),c=null;null!=n&&(c=(0,l._1)(n,"weights","huberLoss")),(0,p.k5)(o.shape,u.shape,"Error in huberLoss: ");var d=(0,nn.i)(r),f=(0,a.W)((0,ht.l)(u,o)),h=(0,ct.L)(f,d),m=(0,ht.l)(f,h),v=(0,s.I)((0,A.d)((0,nn.i)(.5),(0,ft.h)(h)),(0,A.d)(d,m));return ra(v,c,i)}});var ua=(0,d.op)({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:na.I.SUM_BY_NONZERO_WEIGHTS,i=(0,l._1)(e,"labels","logLoss"),o=(0,l._1)(t,"predictions","logLoss"),u=null;null!=n&&(u=(0,l._1)(n,"weights","logLoss")),(0,p.k5)(i.shape,o.shape,"Error in logLoss: ");var c=(0,nn.i)(1),d=(0,nn.i)(r),f=(0,yt.W)((0,A.d)(i,(0,We.c)((0,s.I)(o,d)))),h=(0,A.d)((0,ht.l)(c,i),(0,We.c)((0,s.I)((0,ht.l)(c,o),d))),m=(0,ht.l)(f,h);return ra(m,u,a)}});var ca=(0,d.op)({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:na.I.SUM_BY_NONZERO_WEIGHTS,a=(0,l._1)(e,"labels","meanSquaredError"),i=(0,l._1)(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=(0,l._1)(n,"weights","meanSquaredError")),(0,p.k5)(a.shape,i.shape,"Error in meanSquaredError: ");var s=(0,Tn.$)(a,i);return ra(s,o,r)}});function la(e,t){var n=(0,l._1)(e,"labels","sigmoidCrossEntropyWithLogits"),r=(0,l._1)(t,"logits","sigmoidCrossEntropyWithLogits");(0,p.k5)(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=(0,qt.U)(r),o=(0,A.d)(r,n),u=(0,Ve.K)((0,ke.Q)((0,yt.W)((0,a.W)(r))));return(0,s.I)((0,ht.l)(i,o),u)}var pa=(0,d.op)({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:na.I.SUM_BY_NONZERO_WEIGHTS,i=(0,l._1)(e,"multiClassLabels","sigmoidCrossEntropy"),o=(0,l._1)(t,"logits","sigmoidCrossEntropy"),u=null;if(null!=n&&(u=(0,l._1)(n,"weights","sigmoidCrossEntropy")),(0,p.k5)(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=(0,nn.i)(r),d=(0,nn.i)(1),f=(0,nn.i)(.5);i=(0,s.I)((0,A.d)(i,(0,ht.l)(d,c)),(0,A.d)(f,c))}var h=la(i,o);return ra(h,u,a)}});function da(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));var r=(0,gr.cb)((function(e,t,r){var a=(0,je.l)(t,[n],!0),i=(0,ht.l)((0,N.p)(t,"float32"),a);r([e,i]);var o=(0,yt.W)((0,A.d)(i,e));return{value:(0,Rn.S)(o,[n]),gradFunc:function(e,t){var r=(0,vr.Z)(t,2),a=r[0],i=r[1],o=(0,dt.rv)(e.shape,[n]);return[(0,A.d)((0,T.X)(e,o),(0,ht.l)((0,N.p)(a,"float32"),(0,ke.Q)(i))),(0,A.d)((0,T.X)(e,o),(0,ht.l)((0,ke.Q)(i),(0,N.p)(a,"float32")))]}}}));return r(e,t)}var fa=(0,d.op)({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:na.I.SUM_BY_NONZERO_WEIGHTS,i=(0,l._1)(e,"onehotLabels","softmaxCrossEntropy"),o=(0,l._1)(t,"logits","softmaxCrossEntropy"),u=null;if(null!=n&&(u=(0,l._1)(n,"weights","softmaxCrossEntropy")),(0,p.k5)(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var c=(0,nn.i)(r),d=(0,nn.i)(1),f=(0,nn.i)(i.shape[1]);i=(0,s.I)((0,A.d)(i,(0,ht.l)(d,c)),(0,fe.h)(c,f))}var h=da(i,o);return ra(h,u,a)}});var ha=(0,d.op)({sparseFillEmptyRows_:function(e,t,n,r){var a=(0,l._1)(e,"indices","sparseFillEmptyRows","int32"),i=(0,l._1)(t,"values","sparseFillEmptyRows"),o=(0,l._1)(n,"denseShape","sparseFillEmptyRows","int32"),s=(0,l._1)(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var p={indices:a,values:i,denseShape:o,defaultValue:s},d=u.BV.runKernel(c.O3,p);return{outputIndices:d[0],outputValues:d[1],emptyRowIndicator:d[2],reverseIndexMap:d[3]}}});var ma=(0,d.op)({sparseReshape_:function(e,t,n){var r=(0,l._1)(e,"inputIndices","sparseReshape","int32"),a=(0,l._1)(t,"inputShape","sparseReshape","int32"),i=(0,l._1)(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=u.BV.runKernel(c.nh,o);return{outputIndices:s[0],outputShape:s[1]}}});var va=(0,d.op)({sparseSegmentMean_:function(e,t,n){var r=(0,l._1)(e,"data","sparseSegmentMean"),a=(0,l._1)(t,"indices","sparseSegmentMean","int32"),i=(0,l._1)(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return u.BV.runKernel(c.YW,o)}});var ga=(0,d.op)({sparseSegmentSum_:function(e,t,n){var r=(0,l._1)(e,"data","sparseSegmentSum"),a=(0,l._1)(t,"indices","sparseSegmentSum","int32"),i=(0,l._1)(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return u.BV.runKernel(c.Zj,o)}});var ya=(0,d.op)({stringNGrams_:function(e,t,n,r,a,i,o,s){var p=(0,l._1)(e,"data","stringNGrams","string");if("string"!==p.dtype)throw new Error("Data must be of datatype string");if(1!==p.shape.length)throw new Error("Data must be a vector, saw: ".concat(p.shape));var d=(0,l._1)(t,"dataSplits","stringNGrams");if("int32"!==d.dtype)throw new Error("Data splits must be of datatype int32");var f={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},h={data:p,dataSplits:d},m=u.BV.runKernel(c._J,h,f);return{nGrams:m[0],nGramsSplits:m[1]}}});var ba=(0,d.op)({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=(0,l._1)(e,"input","stringSplit","string"),a=(0,l._1)(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=u.BV.runKernel(c.s1,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var xa=(0,d.op)({stringToHashBucketFast_:function(e,t){var n=(0,l._1)(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return u.BV.runKernel(c.Xk,a,r)}}),ka={fft:xn.k,ifft:kn.S,rfft:Sn.Q,irfft:wn.w},wa={hammingWindow:Cr,hannWindow:Er,frame:_r,stft:Ar},Sa={flipLeftRight:Fr,grayscaleToRGB:Dr,resizeNearestNeighbor:qr.j,resizeBilinear:Hr.I,rotateWithOffset:Zr,cropAndResize:Rr,nonMaxSuppression:Mr,nonMaxSuppressionAsync:Pr,nonMaxSuppressionWithScore:Br,nonMaxSuppressionWithScoreAsync:Vr,nonMaxSuppressionPadded:Ur,nonMaxSuppressionPaddedAsync:jr,threshold:Xr,transform:Yr},Ia={bandPart:Qr,gramSchmidt:Jr,qr:ta},Na={absoluteDifference:aa,computeWeightedLoss:ra,cosineDistance:ia,hingeLoss:oa,huberLoss:sa,logLoss:ua,meanSquaredError:ca,sigmoidCrossEntropy:pa,softmaxCrossEntropy:fa},Ta={sparseFillEmptyRows:ha,sparseReshape:ma,sparseSegmentMean:va,sparseSegmentSum:ga},Ca={stringNGrams:ya,stringSplit:ba,stringToHashBucketFast:xa}},1970:function(e,t,n){"use strict";n.d(t,{v:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=(0,i._1)(e,"x","pad");if(0===o.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var s={paddings:t,constantValue:n},u={x:o};return r.BV.runKernel(a.ly,u,s)}})},7226:function(e,t,n){"use strict";n.d(t,{d:function(){return f}});var r=n(9439),a=n(8354),i=n(6147),o=n(9204),s=n(6994),u=n(9151),c=n(5777),l=n(8640),p=n(5561),d=n(5696);var f=(0,l.op)({pool_:function(e,t,n,l,f,h,m){null==f&&(f=[1,1]),null==h&&(h=1),0===l&&(l="valid");var v=(0,a._1)(e,"x","maxPool"),g=v,y=!1;3===v.rank&&(y=!0,g=(0,p.X)(v,[1,v.shape[0],v.shape[1],v.shape[2]])),i.hu(u.jT(h,f),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(h," and dilations '").concat(f,"'")}));var b,x=u.Xw(g.shape,t,h,f,l),k=[x.dilationHeight,x.dilationWidth];b="same"===l?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([x.filterHeight,x.filterWidth],k):[[0,0],[0,0]];var w=1===k[0]&&1===k[1],S=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([x.inHeight,x.inWidth],k,b),I=(0,r.Z)(S,2),N=I[0],T=I[1],C=w?l:"valid",E=w?g:(0,d.f)(g,k,N),_=("avg"===n?function(){return(0,o.w)(E,t,h,C,m)}:function(){return(0,c._)(E,t,h,C,m)})(),A=w?_:(0,s.E)(_,k,T);return y?(0,p.X)(A,[A.shape[1],A.shape[2],A.shape[3]]):A}})},4334:function(e,t,n){"use strict";n.d(t,{s:function(){return u}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354);var u=(0,n(8640).op)({pow_:function(e,t){var n=(0,s._1)(e,"base","pow"),u=(0,s._1)(t,"exp","pow"),c=(0,o.makeTypesMatch)(n,u),l=(0,r.Z)(c,2),p={a:n=l[0],b:u=l[1]};return a.BV.runKernel(i.pe,p)}})},6859:function(e,t,n){"use strict";n.d(t,{A:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({prelu_:function(e,t){var n={x:(0,i._1)(e,"x","prelu"),alpha:(0,i._1)(t,"alpha","prelu")};return r.BV.runKernel(a.o0,n)}})},4600:function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}n.d(t,{S:function(){return r}})},7722:function(e,t,n){"use strict";n.d(t,{W:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(9118);var s=(0,n(8640).op)({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=(0,i._1)(e,"x","prod");"bool"===s.dtype&&(s=(0,o.p)(s,"int32"));var u={x:s},c={axis:t,keepDims:n};return r.BV.runKernel(a.Dl,u,c)}})},6972:function(e,t,n){"use strict";n.d(t,{k:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({real_:function(e){var t={input:(0,i._1)(e,"input","real")};return r.BV.runKernel(a.xJ,t)}})},2209:function(e,t,n){"use strict";n.d(t,{M:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({reciprocal_:function(e){var t={x:(0,i._1)(e,"x","reciprocal")};return r.BV.runKernel(a.$H,t)}})},7539:function(e,t,n){"use strict";n.d(t,{U:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({relu_:function(e){var t={x:(0,i._1)(e,"x","relu")};return r.BV.runKernel(a.qk,t)}})},5900:function(e,t,n){"use strict";n.d(t,{b:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({relu6_:function(e){var t={x:(0,i._1)(e,"x","relu6")};return r.BV.runKernel(a.Sb,t)}})},5561:function(e,t,n){"use strict";n.d(t,{X:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({reshape_:function(e,t){var n={x:(0,i._1)(e,"x","reshape","string_or_numeric")},o={shape:t};return r.BV.runKernel(a.HZ,n,o)}})},4933:function(e,t,n){"use strict";n.d(t,{G:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({reverse_:function(e,t){var n={x:(0,i._1)(e,"x","reverse")},o={dims:t};return r.BV.runKernel(a.mK,n,o)}})},766:function(e,t,n){"use strict";n.d(t,{N:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({round_:function(e){var t={x:(0,i._1)(e,"x","round")};return r.BV.runKernel(a.e0,t)}})},5115:function(e,t,n){"use strict";n.d(t,{b:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({rsqrt_:function(e){var t={x:(0,i._1)(e,"x","rsqrt","float32")};return r.BV.runKernel(a.bV,t)}})},7067:function(e,t,n){"use strict";n.d(t,{i:function(){return i}});var r=n(6147),a=n(7960);function i(e,t){if(((0,r.fU)(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&(0,r.fU)(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return(0,a.H)(e,[],[],t)}},8604:function(e,t,n){"use strict";n.r(t),n.d(t,{calculateShapes:function(){return s},validateInput:function(){return o},validateUpdateShape:function(){return i}});var r=n(3433),a=n(6147);function i(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function o(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}i(n,t,e)}function s(e,t,n){for(var i=t.shape.length,o=i>1?t.shape[i-1]:1,s=n.length,u=1,c=o;c<s;++c)u*=n[c];var l=o<1?1:o;return{sliceRank:o,numUpdates:(0,a.NA)(t.shape)/l,sliceSize:u,strides:[].concat((0,r.Z)((0,a.e3)(n.slice(0,o))),[1]),outputSize:(0,a.NA)(n)}}},413:function(e,t,n){"use strict";n.d(t,{U:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({selu_:function(e){var t={x:(0,i._1)(e,"x","selu")};return r.BV.runKernel(a.oF,t)}})},349:function(e,t,n){"use strict";n.d(t,{$:function(){return a},y:function(){return r}});var r=1.7580993408473768,a=1.0507009873554805},119:function(e,t,n){"use strict";n.d(t,{U:function(){return c}});var r=n(8354),a=n(6147),i=n(3457),o=n(1147),s=n(8640),u=n(5561);var c=(0,s.op)({separableConv2d_:function(e,t,n,s,c){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",d=(0,r._1)(e,"x","separableConv2d"),f=(0,r._1)(t,"depthwiseFilter","separableConv2d"),h=(0,r._1)(n,"pointwiseFilter","separableConv2d"),m=d,v=!1;if(3===d.rank&&(v=!0,m=(0,u.X)(d,[1,d.shape[0],d.shape[1],d.shape[2]])),"NCHW"===p)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");a.hu(4===m.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(m.rank,".")})),a.hu(4===f.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(f.rank,".")})),a.hu(4===h.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(f.rank,".")})),a.hu(1===h.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(h.shape[0],".")})),a.hu(1===h.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(h.shape[1],".")}));var g=f.shape[2],y=f.shape[3];a.hu(h.shape[2]===g*y,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(g*y,", ")+"but got ".concat(h.shape[2],".")}));var b=(0,o.B)(m,f,s,c,p,l),x=1,k=(0,i.T)(b,h,x,"valid",p);return v?(0,u.X)(k,[k.shape[1],k.shape[2],k.shape[3]]):k}})},7643:function(e,t,n){"use strict";n.d(t,{X:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({sigmoid_:function(e){var t={x:(0,i._1)(e,"x","sigmoid","float32")};return r.BV.runKernel(a.a5,t)}})},2070:function(e,t,n){"use strict";n.d(t,{X:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({sign_:function(e){var t={x:(0,i._1)(e,"x","sign")};return r.BV.runKernel(a.i5,t)}})},7254:function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({sin_:function(e){var t={x:(0,i._1)(e,"x","sin","float32")};return r.BV.runKernel(a.RQ,t)}})},7657:function(e,t,n){"use strict";n.d(t,{R:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({sinh_:function(e){var t={x:(0,i._1)(e,"x","sinh")};return r.BV.runKernel(a.w3,t)}})},9238:function(e,t,n){"use strict";n.d(t,{t:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({slice_:function(e,t,n){var o=(0,i._1)(e,"x","slice","string_or_numeric");if(0===o.rank)throw new Error("Slicing scalar is not possible");var s={x:o},u={begin:t,size:n};return r.BV.runKernel(a.p2,s,u)}})},2875:function(e,t,n){"use strict";n.r(t),n.d(t,{assertParamsValid:function(){return i},computeFlatOffset:function(){return y},computeOutShape:function(){return s},getNormalizedAxes:function(){return p},isSliceContinous:function(){return g},maskToAxes:function(){return o},parseSliceParams:function(){return b},sliceInfo:function(){return x},startForAxis:function(){return m},startIndicesWithElidedDims:function(){return d},stopForAxis:function(){return v},stopIndicesWithElidedDims:function(){return f},stridesForAxis:function(){return h},stridesWithElidedDims:function(){return u}});var r=n(3433),a=n(6147);function i(e,t,n){var r=e.shape.length;a.hu(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),a.hu(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var i=function(i){a.hu(t[i]+n[i]<=e.shape[i],(function(){return"Error in slice".concat(r,"D: begin[").concat(i,"] + size[").concat(i,"] ")+"(".concat(t[i]+n[i],") would overflow input.shape[").concat(i,"] (").concat(e.shape[i],")")}))},o=0;o<r;++o)i(o)}function o(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function s(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function u(e,t,n,a){for(var i=(0,r.Z)(e),o=i.length;o<a.length;o++)i.push(1);for(var s=0;s<n;s++)0===s?i[t]=1:(i.splice(t,0,1),i.pop());return i}function c(e,t,n){return n<=e?n:n-(t-1)}function l(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function p(e,t,n,r,a,i,o,s,c){var l=e.length,p=new Array(l),g=new Array(l),y=new Array(l);if(t.length&&n>0){var b=t[0],x=n+1;p=d(o,b,x,r,e),g=f(s,b,x,a,e),y=u(i,b,x,e)}else for(var k=0;k<l;k++)p[k]=m(o,r,i,e,k,c),g[k]=v(s,a,i,e,k,c),y[k]=h(i,k,c);return{begin:p,end:g,strides:y}}function d(e,t,n,a,i){for(var o=(0,r.Z)(i),s=l(n,t),u=0;u<o.length;u++)if(s.indexOf(u)>-1)o[u]=0;else{var p=c(t,n,u),d=a[p];e&1<<p&&(d=0),o[u]=d}return o}function f(e,t,n,i,o){for(var s=(0,r.Z)(o),u=l(n,t),p=0;p<s.length;p++)if(u.indexOf(p)>-1)s[p]=Number.MAX_SAFE_INTEGER;else{var d=c(t,n,p),f=i[d];e&1<<d&&(f=Number.MAX_SAFE_INTEGER),s[p]=f}for(var h=0;h<s.length;h++){var m=o[h];s[h]<0&&(s[h]+=m),s[h]=a.uZ(0,s[h],o[h])}return s}function h(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function m(e,t,n,r,i,o){var s=t[i],u=n[i]||1;(e&1<<i||o&1<<i||null==s)&&(s=u>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var c=r[i];return s<0&&(s+=c),s=a.uZ(0,s,c-1)}function v(e,t,n,r,i,o){var s=t[i],u=n[i]||1;(e&1<<i||o&1<<i||null==s)&&(s=u>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var c=r[i];return s<0&&(s+=c),s=u>0?a.uZ(0,s,c):a.uZ(-1,s,c-1)}function g(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function y(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function b(e,t,n){var i,o,s=e.shape.length;return(i="number"===typeof t?[t].concat((0,r.Z)(new Array(s-1).fill(0))):t.length<s?t.concat(new Array(s-t.length).fill(0)):t.slice()).forEach((function(e){a.hu(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=null==n?new Array(s).fill(-1):"number"===typeof n?[n].concat((0,r.Z)(new Array(s-1).fill(-1))):n.length<s?n.concat(new Array(s-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(a.hu(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-i[n])})),[i,o]}function x(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,p={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},d=0;d<p.dims;d++)l&&0!==(1<<d&s)&&p.numAddAxisAfterEllipsis++,1<<d&o&&(l=!0);l||(p.ellipsisMask|=1<<p.dims,p.dims++);var f={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(p,f);for(var h=!0,m=!0,v=!0,g=[],y=[],b=0;b<e.length;++b){if(0===f.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(f.shrinkAxisMask&1<<b),w=e[b];if(-1!==w){var S=[f.beginMask&1<<b,f.endMask&1<<b],I=[f.strides[b]>0?0:-1,f.strides[b]>0?w:w-1];if(x&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===f.strides[b];var N=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(x){var T=f.begin[b]<0?w+f.begin[b]:f.begin[b];if(f.begin[b]=T,f.end[b]=f.begin[b]+1,T<0||T>=w)throw Error("slice index ".concat(f.begin[b]," of dimension ").concat(b," out of bounds."))}else f.begin[b]=k(f.begin[b],0,f.strides[b],w,S,I),f.end[b]=k(f.end[b],1,f.strides[b],w,S,I);var C=1===f.strides[b]&&0===f.begin[b]&&f.end[b]===w;h=h&&C,m=m&&(0===b&&1===f.strides[b]||C)}else h=h&&1===f.strides[b]&&N,m=m&&(0===b&&1===f.strides[b]||N);var E=void 0,_=!1;if(f.beginValid&&f.endValid?(E=f.end[b]-f.begin[b],_=!0):x?(E=1,_=!0):N&&w>=0&&(E=f.strides[b]<0?-w:w,_=!0),_){var A=void 0;A=0===E||E<0!==f.strides[b]<0?0:Math.trunc(E/f.strides[b])+(E%f.strides[b]!==0?1:0),g.push(A)}else g.push(-1)}else g.push(x?1:-1)}for(var R=0;R<f.finalShapeGatherIndices.length;++R){var F=f.finalShapeGatherIndices[R];F>=0?y.push(g[F]):-2===F&&y.push(1)}var D=y.filter((function(e,t){return-2!==f.finalShapeGatherIndices[t]}));return{finalShapeSparse:D,finalShape:y,isIdentity:h,sliceDim0:m,isSimpleSlice:v,begin:f.begin,end:f.end,strides:f.strides}}function k(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}},4910:function(e,t,n){"use strict";n.d(t,{X:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=(0,i._1)(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var o={logits:n},s={dim:t};return r.BV.runKernel(a.Gc,o,s)}})},4626:function(e,t,n){"use strict";n.d(t,{W:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({softplus_:function(e){var t={x:(0,i._1)(e,"x","softplus")};return r.BV.runKernel(a.MR,t)}})},5696:function(e,t,n){"use strict";n.d(t,{f:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({spaceToBatchND_:function(e,t,n){var s=(0,i._1)(e,"x","spaceToBatchND");o.hu(s.rank>=1+t.length,(function(){return"input rank ".concat(s.rank," should be > than [blockShape] ").concat(t.length)})),o.hu(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),o.hu(s.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(s.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var u={x:s},c={blockShape:t,paddings:n};return r.BV.runKernel(a.TQ,u,c)}})},7635:function(e,t,n){"use strict";n.d(t,{k:function(){return o}});var r=n(318),a=n(2145),i=n(6147);var o=(0,n(8640).op)({fft_:function(e){(0,i.hu)("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return r.BV.runKernel(a.vw,t)}})},530:function(e,t,n){"use strict";n.d(t,{S:function(){return o}});var r=n(318),a=n(2145),i=n(6147);var o=(0,n(8640).op)({ifft_:function(e){(0,i.hu)("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return r.BV.runKernel(a.Qg,t)}})},774:function(e,t,n){"use strict";n.d(t,{w:function(){return h}});var r=n(9253),a=n(4836),i=n(6996),o=n(651),s=n(8640),u=n(6972),c=n(5561),l=n(4933),p=n(7067),d=n(9238),f=n(530);var h=(0,s.op)({irfft_:function(e){var t,n=e.shape[e.shape.length-1],s=e.size/n;if(n<=2){var h=(0,c.X)(e,[s,n]);t=(0,f.S)(h)}else{var m=[s,2*(n-1)],v=(0,c.X)((0,u.k)(e),[s,n]),g=(0,c.X)((0,i.a)(e),[s,n]),y=(0,l.G)((0,d.t)(v,[0,1],[s,n-2]),1),b=(0,o.d)((0,l.G)((0,d.t)(g,[0,1],[s,n-2]),1),(0,p.i)(-1)),x=(0,a.z)([v,y],1),k=(0,a.z)([g,b],1),w=(0,c.X)((0,r.P)(x,k),[m[0],m[1]]);t=(0,f.S)(w)}if(t=(0,u.k)(t),3===e.rank&&0!==e.shape[0]){var S=t,I=e.shape[0];t=(0,c.X)(t,[I,t.shape[0]/I,t.shape[1]]),S.dispose()}return t}})},4617:function(e,t,n){"use strict";n.d(t,{Q:function(){return m}});var r=n(6147),a=n(9253),i=n(4836),o=n(6996),s=n(8640),u=n(6972),c=n(5561),l=n(9238),p=n(2588),d=n(7742),f=n(7293),h=n(7635);var m=(0,s.op)({rfft_:function(e,t){(0,r.hu)("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,s=e.shape[e.shape.length-1],m=e.size/s;if(null!=t&&t<s){var v=e.shape.map((function(e){return 0})),g=e.shape.map((function(e){return e}));g[e.shape.length-1]=t,n=(0,l.t)(e,v,g),s=t}else if(null!=t&&t>s){var y=e.shape.map((function(e){return e}));y[e.shape.length-1]=t-s,n=(0,i.z)([e,(0,d.l)(y)],e.shape.length-1),s=t}else n=e;var b=(0,f.P)(n),x=(0,c.X)((0,a.P)(n,b),[m,s]),k=(0,h.k)(x),w=Math.floor(s/2)+1,S=(0,u.k)(k),I=(0,o.a)(k),N=(0,p.V)(S,[w,s-w],S.shape.length-1),T=(0,p.V)(I,[w,s-w],I.shape.length-1),C=n.shape.slice();return C[n.shape.length-1]=w,(0,c.X)((0,a.P)(N[0],T[0]),C)}})},2588:function(e,t,n){"use strict";n.d(t,{V:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=(0,i._1)(e,"x","split"),s={x:o},u={numOrSizeSplits:t,axis:n};return r.BV.runKernel(a.L8,s,u)}})},6902:function(e,t,n){"use strict";n.d(t,{_:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({sqrt_:function(e){var t={x:(0,i._1)(e,"x","sqrt","float32")};return r.BV.runKernel(a.FK,t)}})},7391:function(e,t,n){"use strict";n.d(t,{h:function(){return i}});var r=n(318),a=n(8354);var i=(0,n(8640).op)({square_:function(e){var t=(0,a._1)(e,"x","square");return r.BV.runKernel("Square",{x:t},{})}})},7993:function(e,t,n){"use strict";n.d(t,{$:function(){return c}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354),u=n(5774);var c=(0,n(8640).op)({squaredDifference_:function(e,t){var n=(0,s._1)(e,"a","squaredDifference"),c=(0,s._1)(t,"b","squaredDifference"),l=(0,o.makeTypesMatch)(n,c),p=(0,r.Z)(l,2);n=p[0],c=p[1],(0,u.assertAndGetBroadcastShape)(n.shape,c.shape);var d={a:n,b:c};return a.BV.runKernel(i._t,d,{})}})},3931:function(e,t,n){"use strict";n.d(t,{L:function(){return s}});var r=n(8354),a=n(6147),i=n(8640),o=n(5561);var s=(0,i.op)({squeeze_:function(e,t){var n=(0,r._1)(e,"x","squeeze","string_or_numeric");return(0,o.X)(n,(0,a.bp)(n.shape,t).newShape)}})},8306:function(e,t,n){"use strict";n.d(t,{k:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,i.sI)(e,"tensors","stack","string_or_numeric");o.hu(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&o.hu(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var s=n,u={axis:t};return r.BV.runKernel(a.Qi,s,u)}})},4031:function(e,t,n){"use strict";n.d(t,{N:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,i._1)(e,"x","step"),o={x:n},s={alpha:t};return r.BV.runKernel(a.h8,o,s)}})},9017:function(e,t,n){"use strict";n.d(t,{N:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({stridedSlice_:function(e,t,n,o){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=(0,i._1)(e,"x","stridedSlice","string_or_numeric"),f={x:d},h={begin:t,end:n,strides:o,beginMask:s,endMask:u,ellipsisMask:c,newAxisMask:l,shrinkAxisMask:p};return r.BV.runKernel(a.m2,f,h)}})},4774:function(e,t,n){"use strict";n.d(t,{l:function(){return u}});var r=n(9439),a=n(318),i=n(2145),o=n(9064),s=n(8354);var u=(0,n(8640).op)({sub_:function(e,t){var n=(0,s._1)(e,"a","sub"),u=(0,s._1)(t,"b","sub"),c=(0,o.makeTypesMatch)(n,u),l=(0,r.Z)(c,2),p={a:n=l[0],b:u=l[1]};return a.BV.runKernel(i.Tr,p)}})},227:function(e,t,n){"use strict";n.d(t,{S:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(9118);var s=(0,n(8640).op)({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=(0,i._1)(e,"x","sum");"bool"===s.dtype&&(s=(0,o.p)(s,"int32"));var u={x:s},c={axis:t,keepDims:n};return r.BV.runKernel(a.GB,u,c)}})},6999:function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({tan_:function(e){var t={x:(0,i._1)(e,"x","tan","float32")};return r.BV.runKernel(a.sE,t)}})},1744:function(e,t,n){"use strict";n.d(t,{A:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({tanh_:function(e){var t={x:(0,i._1)(e,"x","tanh","float32")};return r.BV.runKernel(a.MI,t)}})},2442:function(e,t,n){"use strict";n.d(t,{X:function(){return i}});var r=n(8354),a=n(7960);function i(e,t,n){var i=(0,r.C)(e,n);return(0,a.H)(e,t,i,n)}},3123:function(e,t,n){"use strict";n.d(t,{w:function(){return o}});var r=n(8354),a=n(6147),i=n(7960);function o(e,t,n){if((0,a.Cq)(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var o=(0,r.C)(e,n);if(3!==o.length&&1!==o.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===o.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return(0,i.H)(e,t,o,n)}},7960:function(e,t,n){"use strict";n.d(t,{H:function(){return o}});var r=n(318),a=n(6147),i=n(115);function o(e,t,n,o){if(null==o&&(o=(0,a.D2)(e)),"complex64"===o)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!(0,a.fU)(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){(0,a.Mu)(t);var s=(0,a.NA)(t),u=(0,a.NA)(n);(0,a.hu)(s===u,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(s," values but has ").concat(u)}));for(var c=0;c<n.length;++c){var l=n[c],p=c!==n.length-1||l!==(0,a.NA)(t.slice(c));(0,a.hu)(n[c]===t[c]||!p,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return(0,a.fU)(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==o?(0,i.toTypedArray)(e,o):(0,a.xH)(e,[],!0),r.BV.makeTensor(e,t,o)}},2343:function(e,t,n){"use strict";n.d(t,{G:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({tile_:function(e,t){var n=(0,i._1)(e,"x","tile","string_or_numeric");o.hu(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var s={x:n},u={reps:t};return r.BV.runKernel(a.n9,s,u)}})},9085:function(e,t,n){"use strict";n.d(t,{h:function(){return s}});var r=n(9439),a=n(318),i=n(2145),o=n(8354);var s=(0,n(8640).op)({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=(0,o._1)(e,"x","topk");if(0===s.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var u=s.shape[s.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>u)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(u,") ")+"but got ".concat(t));var c={x:s},l={k:t,sorted:n},p=a.BV.runKernel(i.cW,c,l),d=(0,r.Z)(p,2),f=d[0],h=d[1];return{values:f,indices:h}}})},1240:function(e,t,n){"use strict";n.d(t,{p:function(){return f}});var r=n(318),a=n(5875),i=n(2145),o=n(8354),s=n(6147),u=n(9253),c=n(6996),l=n(4362),p=n(8640),d=n(6972);var f=(0,p.op)({transpose_:function(e,t,n){var p=(0,o._1)(e,"x","transpose");if(null==t&&(t=p.shape.map((function(e,t){return t})).reverse()),s.hu(p.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(p.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){s.hu(e>=0&&e<p.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(p.rank-1)+" but got ".concat(t)}))})),p.rank<=1)return p.clone();var f={x:p},h={perm:t};return"complex64"===p.dtype?(0,a.lu)((function(){var e=(0,d.k)(p),t=(0,c.a)(p);return e=r.BV.runKernel(i.G3,{x:e},h),t=r.BV.runKernel(i.G3,{x:t},h),n&&(t=(0,l.W)(t)),(0,u.P)(e,t)})):r.BV.runKernel(i.G3,f,h)}})},4860:function(e,t,n){"use strict";n.d(t,{T:function(){return u}});var r=n(9439),a=n(318),i=n(2145),o=n(8354),s=n(6147);var u=(0,n(8640).op)({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,o._1)(e,"x","unique","string_or_numeric");(0,s.hu)(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var u={x:n},c={axis:t},l=a.BV.runKernel(i.kp,u,c),p=(0,r.Z)(l,2),d=p[0],f=p[1];return{values:d,indices:f}}})},6918:function(e,t,n){"use strict";n.d(t,{p:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({unsortedSegmentSum_:function(e,t,n){var s=(0,i._1)(e,"x","unsortedSegmentSum"),u=(0,i._1)(t,"segmentIds","unsortedSegmentSum","int32");(0,o.hu)((0,o.GN)(n),(function(){return"numSegments must be of dtype int"}));var c={x:s,segmentIds:u},l={numSegments:n};return r.BV.runKernel(a.Qv,c,l)}})},4566:function(e,t,n){"use strict";n.d(t,{H:function(){return s}});var r=n(318),a=n(2145),i=n(8354),o=n(6147);var s=(0,n(8640).op)({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,i._1)(e,"x","unstack","string_or_numeric");o.hu(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var s={value:n},u={axis:t};return r.BV.runKernel(a.To,s,u)}})},329:function(e,t,n){"use strict";n.d(t,{a:function(){return u}});var r=n(318),a=n(2145),i=n(8354),o=n(9742),s=n(5774);var u=(0,n(8640).op)({where_:function(e,t,n){var u=(0,i._1)(t,"a","where"),c=(0,i._1)(n,"b","where"),l=(0,i._1)(e,"condition","where","bool"),p=(0,s.assertAndGetBroadcastShape)((0,s.assertAndGetBroadcastShape)(l.shape,u.shape),c.shape),d={condition:(0,o.U)(l,p),t:(0,o.U)(u,p),e:(0,o.U)(c,p)};return r.BV.runKernel(a.Ph,d)}})},7742:function(e,t,n){"use strict";n.d(t,{l:function(){return o}});var r=n(318),a=n(6147),i=n(9253);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=o(e,"float32"),s=o(e,"float32");return(0,i.P)(n,s)}var u=(0,a.wT)((0,a.NA)(e),t);return r.BV.makeTensor(u,e,t)}},7293:function(e,t,n){"use strict";n.d(t,{P:function(){return o}});var r=n(318),a=n(2145),i=n(8354);var o=(0,n(8640).op)({zerosLike_:function(e){var t={x:(0,i._1)(e,"x","zerosLike")};return r.BV.runKernel(a.Ru,t)}})},4376:function(e,t,n){"use strict";n.d(t,{es:function(){return I},YD:function(){return y},_w:function(){return T},t3:function(){return N},FZ:function(){return S},Vp:function(){return w},Vi:function(){return k}});var r=n(136),a=n(9388),i=n(4165),o=n(5861),s=n(5671),u=n(3144),c=n(6581),l=n(3433),p=n(6147);function d(e,t,n,r){var a=(0,p.e3)(t),i=function(e,t,n,r){var a=(0,p.NA)(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?v(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,d=0;d<i;d++)o[d]=Math.max(o[d],f(u[l+d],0,n).length);return o}(e,t,n,a),o=t.length,s=m(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function f(e,t,n){var r;return r=Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):(0,p.HD)(e)?"'".concat(e,"'"):"bool"===n?h(e):parseFloat(e.toFixed(7)).toString(),(0,p.oj)(r,t)}function h(e){return 0===e?"false":"true"}function m(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u){if("complex64"===n){var c=v(e);return[f(c[0],0,n)]}return"bool"===n?[h(e[0])]:[e[0].toString()]}if(1===u){if(s>20){var p=3*o,d=Array.from(e.slice(0,p)),g=Array.from(e.slice((s-3)*o,s*o));return"complex64"===n&&(d=v(d),g=v(g)),["["+d.map((function(e,t){return f(e,a[t],n)})).join(", ")+", ..., "+g.map((function(e,t){return f(e,a[s-3+t],n)})).join(", ")+"]"]}var y="complex64"===n?v(e):Array.from(e);return["["+y.map((function(e,t){return f(e,a[t],n)})).join(", ")+"]"]}var b=t.slice(1),x=r.slice(1),k=r[0]*o,w=[];if(s>20){for(var S=0;S<3;S++){var I=S*k,N=I+k;w.push.apply(w,(0,l.Z)(m(e.slice(I,N),b,n,x,a,!1)))}w.push("...");for(var T=s-3;T<s;T++){var C=T*k,E=C+k;w.push.apply(w,(0,l.Z)(m(e.slice(C,E),b,n,x,a,T===s-1)))}}else for(var _=0;_<s;_++){var A=_*k,R=A+k;w.push.apply(w,(0,l.Z)(m(e.slice(A,R),b,n,x,a,_===s-1)))}var F=2===u?",":"";w[0]="["+w[0]+F;for(var D=1;D<w.length-1;D++)w[D]=" "+w[D]+F;for(var Z=",\n",O=2;O<u;O++)Z+="\n";return w[w.length-1]=" "+w[w.length-1]+"]"+(i?"":Z),w}function v(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var g=n(115),y=function(){function e(t,n,r){var a=this;if((0,s.Z)(this,e),this.dtype=n,this.shape=t.slice(),this.size=p.NA(t),null!=r){var i=r.length;p.hu(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||p.rQ(n,this.size),this.strides=(0,p.e3)(t)}return(0,u.Z)(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),p.hu(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return b().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),b=null,x=null;function k(e){b=e}function w(e){x=e}function S(e){e}var I=function(){function e(t,n,r,a){(0,s.Z)(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=p.NA(t),this.strides=(0,p.e3)(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return(0,u.Z)(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",x.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return x.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",(0,p.GX)(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return(0,p.GX)(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=b().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return g.decodeString(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),b().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=b().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return g.decodeString(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,b().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(b().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return x.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),x.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.dataSync();return d(t,this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),x.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),b().makeVariable(this,e,t,n)}}]),e}();function N(){return(0,c.R)("Tensor",(function(){return I}))}Object.defineProperty(I,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),N();var T=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e,r,a,i){var o;return(0,s.Z)(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return(0,u.Z)(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!p.cO(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));b().disposeTensor(this),this.dataId=e.dataId,b().incRef(this,null)}},{key:"dispose",value:function(){b().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(I);Object.defineProperty(T,Symbol.hasInstance,{value:function(e){return e instanceof I&&null!=e.assign&&e.assign instanceof Function}})},9064:function(e,t,n){"use strict";n.r(t),n.d(t,{assertTypesMatch:function(){return s},getTensorsInContainer:function(){return c},isTensorInList:function(){return u},makeTypesMatch:function(){return o}});var r=n(4376),a=n(3525),i=n(6147);function o(e,t){if(e.dtype===t.dtype)return[e,t];var n=(0,a.x8)(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function s(e,t){(0,i.hu)(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and")+" second(".concat(t.dtype,") input must match")}))}function u(e,t){return t.some((function(t){return t.id===e.id}))}function c(e){var t=[];return l(e,t,new Set),t}function l(e,t,n){if(null!=e)if(e instanceof r.es)t.push(e);else if(a=e,Array.isArray(a)||"object"===typeof a){var a,i=e;for(var o in i){var s=i[o];n.has(s)||(n.add(s),l(s,t,n))}}}},8354:function(e,t,n){"use strict";n.d(t,{C:function(){return u},_1:function(){return p},sI:function(){return d}});var r=n(318),a=n(5050),i=n(4376),o=n(6147),s=n(115);function u(e,t){var n=e;if((0,o.fU)(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||(0,o.fU)(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&(0,a.OB)().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&c(e,r,[]),r}function c(e,t,n){if(n=n||[],Array.isArray(e)||(0,o.fU)(e)){(0,o.hu)(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),(0,o.hu)(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)c(e[a],r,n.concat(a))}else(0,o.hu)(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function l(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function p(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof i.es)return l(a,e.dtype,t,n),e;var c=(0,o.D2)(e);if("string"!==c&&["bool","int32","float32"].indexOf(a)>=0&&(c=a),l(a,c,t,n),null==e||!(0,o.fU)(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var p=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(p,"'"))}var d=u(e,c);(0,o.fU)(e)||Array.isArray(e)||(e=[e]);var f=!0,h="string"!==c?(0,s.toTypedArray)(e,c):(0,o.xH)(e,[],f);return r.BV.makeTensor(h,d,c)}function d(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=e;return a.map((function(e,a){return p(e,"".concat(t,"[").concat(a,"]"),n,r)}))}},3525:function(e,t,n){"use strict";var r,a,i,o,s;n.d(t,{x8:function(){return c},yw:function(){return r},z4:function(){return l}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(r||(r={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(a||(a={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(i||(i={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(o||(o={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(s||(s={}));var u={float32:o,int32:a,bool:i,complex64:s};function c(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return u[e][t]}function l(e){return c(e,"int32")}},115:function(e,t,n){"use strict";n.r(t),n.d(t,{arraysEqual:function(){return a.cO},assert:function(){return a.hu},assertNonNegativeIntegerDimensions:function(){return a.Mu},assertNonNull:function(){return a.Cq},assertShapesMatch:function(){return a.k5},bytesFromStringArray:function(){return a.Ub},bytesPerElement:function(){return a.bT},checkConversionForErrors:function(){return a.D5},clamp:function(){return a.uZ},computeStrides:function(){return a.e3},createScalarValue:function(){return w},createShuffledIndices:function(){return a.U$},decodeString:function(){return C},distSquared:function(){return a.E7},encodeString:function(){return T},fetch:function(){return N},fingerPrint64:function(){return k},flatten:function(){return a.xH},getArrayFromDType:function(){return a.rQ},getTypedArrayFromDType:function(){return a.WP},hasEncodingLoss:function(){return a.QB},hexToLong:function(){return s},indexToLoc:function(){return a.NE},inferDtype:function(){return a.D2},inferFromImplicitShape:function(){return a.JZ},isBoolean:function(){return a.jn},isFunction:function(){return a.mf},isInt:function(){return a.GN},isNumber:function(){return a.hj},isPromise:function(){return a.tI},isScalarShape:function(){return a.N9},isString:function(){return a.HD},isTypedArray:function(){return a.fU},isValidDtype:function(){return a.LP},locToIndex:function(){return a.qy},makeOnesTypedArray:function(){return a.p8},makeZerosNestedTypedArray:function(){return a.l6},makeZerosTypedArray:function(){return a.wT},nearestDivisor:function(){return a.jP},nearestLargerEven:function(){return a.nY},now:function(){return I},parseAxisParam:function(){return a.EC},randUniform:function(){return a.bj},repeatedTry:function(){return a.WD},rightPad:function(){return a.oj},shuffle:function(){return a.TV},shuffleCombo:function(){return a.d7},sizeFromShape:function(){return a.NA},sizeToSquarishShape:function(){return a.YP},squeezeShape:function(){return a.bp},sum:function(){return a.Sm},swap:function(){return a.LF},tanh:function(){return a.AE},toNestedArray:function(){return a.GX},toTypedArray:function(){return S}});var r=n(5050),a=n(6147),i=n(8987),o=n.n(i)()||i;function s(e){return o.fromString(e,!0,16)}var u=s("c3a5c85c97cb3127"),c=s("b492b66fbe98f273"),l=s("9ae16a3b2f90404f");function p(e){return e.xor(e.shru(47))}function d(e,t,n){var r=e.slice(t,t+n);return o.fromBytes(Array.from(r),!0,!0)}function f(e,t){return d(e,t,8)}function h(e,t){return d(e,t,4)}function m(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function g(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=m(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(m(a,44)),[a.add(r),i.add(o)]}(f(e,t),f(e,t+8),f(e,t+16),f(e,t+24),n,r)}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=l.add(2*t),r=f(e,0).add(l),a=f(e,t-8),i=m(a,37).mul(n).add(r),o=m(r,25).add(a).mul(n);return v(i,o,n)}if(t>=4){var s=l.add(2*t),c=h(e,0);return v(c.shl(3).add(t),h(e,t-4),s)}if(t>0){var d=e[0],g=e[t>>1],y=e[t-1],b=d+(g<<8),x=t+(y<<2);return p(l.mul(b).xor(u.mul(x))).mul(l)}return l}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=l.add(2*t),r=f(e,0).mul(c),a=f(e,8),i=f(e,t-8).mul(n),o=f(e,t-16).mul(l);return v(m(r.add(a),43).add(m(i,30)).add(o),r.add(m(a.add(l),18)).add(i),n)}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=l.add(2*t),r=f(e,0).mul(l),a=f(e,8),i=f(e,t-8).mul(n),o=f(e,t-16).mul(l),s=m(r.add(a),43).add(m(i,30)).add(o),u=v(s,r.add(m(a.add(l),18)).add(i),n),c=f(e,16).mul(n),p=f(e,24),d=s.add(f(e,t-32)).mul(n),h=u.add(f(e,t-24)).mul(n);return v(m(c.add(p),43).add(m(d,30)).add(h),c.add(m(p.add(r),18)).add(d),n)}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=o.fromNumber(81,!0);if(t<=32)return t<=16?y(e,t):b(e,t);if(t<=64)return x(e,t);var r=n,a=n.mul(c).add(113),i=p(a.mul(l).add(113)).mul(l),s=[o.UZERO,o.UZERO],d=[o.UZERO,o.UZERO];r=r.mul(l).add(f(e,0));var h=0,k=64*(t-1>>6),w=k+(t-1&63)-63;do{r=m(r.add(a).add(s[0]).add(f(e,h+8)),37).mul(c),a=m(a.add(s[1]).add(f(e,h+48)),42).mul(c),r=r.xor(d[1]),a=a.add(s[0]).add(f(e,h+40)),i=m(i.add(d[0]),33).mul(c),s=g(e,h,s[1].mul(c),r.add(d[0])),d=g(e,h+32,i.add(d[1]),a.add(f(e,h+16)));var S=[r,i];i=S[0],r=S[1],h+=64}while(h!==k);var I=c.add(i.and(255).shl(1));h=w,d[0]=d[0].add(t-1&63),s[0]=s[0].add(d[0]),d[0]=d[0].add(s[0]),r=m(r.add(a).add(s[0]).add(f(e,h+8)),37).mul(I),a=m(a.add(s[1]).add(f(e,h+48)),42).mul(I),r=r.xor(d[1].mul(9)),a=a.add(s[0].mul(9).add(f(e,h+40))),i=m(i.add(d[0]),33).mul(I),s=g(e,h,s[1].mul(I),r.add(d[0])),d=g(e,h+32,i.add(d[1]),a.add(f(e,h+16)));var N=[r,i];return i=N[0],r=N[1],v(v(s[0],d[0],I).add(p(a).mul(u)).add(i),v(s[1],d[1],I).add(r),I)}function w(e,t){return"string"===t?T(e):S([e],t)}function S(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=a.xH(e)),(0,r.OB)().getBool("DEBUG")&&a.D5(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),i=0;i<n.length;++i)0!==Math.round(e[i])&&(n[i]=1);return n}throw new Error("Unknown data type ".concat(t))}function I(){return(0,r.OB)().platform.now()}function N(e,t){return(0,r.OB)().platform.fetch(e,t)}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",(0,r.OB)().platform.encode(e,t)}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",(0,r.OB)().platform.decode(e,t)}},6147:function(e,t,n){"use strict";function r(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,s(e,--t,n)}function a(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(e.length)+"Second array length was ".concat(t.length));for(var n=e.length,r=0;n>0;)r=Math.random()*n|0,s(e,--n,r),s(t,n,r)}function i(e,t,n){return Math.max(e,Math.min(t,n))}function o(e){return e%2===0?e:e+1}function s(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function u(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function c(e,t){var n=Math.random();return t*n+(1-n)*e}function l(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function p(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";p(g(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function f(e){p(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||F(e)&&!n)for(var r=0;r<e.length;++r)h(e[r],t,n);else t.push(e);return t}function m(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function v(e){return 0===e.length}function g(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function y(e){return e%1===0}function b(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function x(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function k(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return r(t),t}function w(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function I(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function N(e,t){var n=t.length;return p((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),p(e.every((function(e){return y(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function T(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:N(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function C(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function E(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function _(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function A(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function R(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function F(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function D(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Z(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function O(e){return"string"===typeof e||e instanceof String}function M(e){return"boolean"===typeof e}function z(e){return"number"===typeof e}function L(e){return Array.isArray(e)?L(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":z(e)?"float32":O(e)?"string":M(e)?"bool":"float32"}function P(e){return!!(e&&e.constructor&&e.call&&e.apply)}function B(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function W(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function V(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=V(e+l*c,u,n,r);return a}function U(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return V(0,e,t,n)}function G(e,t){for(var n=j(e,t),r=0;r<n.length;r++)n[r]=1;return n}function j(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function H(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return U(e,new Float32Array(n));if("int32"===t)return U(e,new Int32Array(n));if("bool"===t)return U(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function q(e){e.forEach((function(t){p(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function K(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function X(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Y(e){return e&&e.then&&"function"===typeof e.then}n.d(t,{AE:function(){return b},Cq:function(){return f},D2:function(){return L},D5:function(){return _},E7:function(){return l},EC:function(){return N},GN:function(){return y},GX:function(){return U},HD:function(){return O},JZ:function(){return I},LF:function(){return s},LP:function(){return A},Mu:function(){return q},N9:function(){return v},NA:function(){return m},NE:function(){return X},QB:function(){return R},Sm:function(){return u},TV:function(){return r},U$:function(){return k},Ub:function(){return Z},WD:function(){return S},WP:function(){return C},YP:function(){return x},bT:function(){return D},bj:function(){return c},bp:function(){return T},cO:function(){return g},d7:function(){return a},e3:function(){return W},fU:function(){return F},hj:function(){return z},hu:function(){return p},jP:function(){return B},jn:function(){return M},k5:function(){return d},l6:function(){return H},mf:function(){return P},nY:function(){return o},oj:function(){return w},p8:function(){return G},qy:function(){return K},rQ:function(){return E},tI:function(){return Y},uZ:function(){return i},wT:function(){return j},xH:function(){return h}})},8158:function(e,t,n){"use strict";n.r(t),n.d(t,{Abs:function(){return l.Abs},Acos:function(){return l.Acos},Acosh:function(){return l.Acosh},AdadeltaOptimizer:function(){return l.AdadeltaOptimizer},AdagradOptimizer:function(){return l.AdagradOptimizer},AdamOptimizer:function(){return l.AdamOptimizer},AdamaxOptimizer:function(){return l.AdamaxOptimizer},Add:function(){return l.Add},AddN:function(){return l.AddN},All:function(){return l.All},Any:function(){return l.Any},ArgMax:function(){return l.ArgMax},ArgMin:function(){return l.ArgMin},Asin:function(){return l.Asin},Asinh:function(){return l.Asinh},Atan:function(){return l.Atan},Atan2:function(){return l.Atan2},Atanh:function(){return l.Atanh},AvgPool:function(){return l.AvgPool},AvgPool3D:function(){return l.AvgPool3D},AvgPool3DGrad:function(){return l.AvgPool3DGrad},AvgPoolGrad:function(){return l.AvgPoolGrad},BatchMatMul:function(){return l.BatchMatMul},BatchToSpaceND:function(){return l.BatchToSpaceND},Bincount:function(){return l.Bincount},BroadcastArgs:function(){return l.BroadcastArgs},BroadcastTo:function(){return l.BroadcastTo},Callback:function(){return Ed},CallbackList:function(){return es},Cast:function(){return l.Cast},Ceil:function(){return l.Ceil},ClipByValue:function(){return l.ClipByValue},Complex:function(){return l.Complex},ComplexAbs:function(){return l.ComplexAbs},Concat:function(){return l.Concat},Conv2D:function(){return l.Conv2D},Conv2DBackpropFilter:function(){return l.Conv2DBackpropFilter},Conv2DBackpropInput:function(){return l.Conv2DBackpropInput},Conv3D:function(){return l.Conv3D},Conv3DBackpropFilterV2:function(){return l.Conv3DBackpropFilterV2},Conv3DBackpropInputV2:function(){return l.Conv3DBackpropInputV2},Cos:function(){return l.Cos},Cosh:function(){return l.Cosh},CropAndResize:function(){return l.CropAndResize},Cumprod:function(){return l.Cumprod},Cumsum:function(){return l.Cumsum},CustomCallback:function(){return rs},DataStorage:function(){return l.DataStorage},DenseBincount:function(){return l.DenseBincount},DepthToSpace:function(){return l.DepthToSpace},DepthwiseConv2dNative:function(){return l.DepthwiseConv2dNative},DepthwiseConv2dNativeBackpropFilter:function(){return l.DepthwiseConv2dNativeBackpropFilter},DepthwiseConv2dNativeBackpropInput:function(){return l.DepthwiseConv2dNativeBackpropInput},Diag:function(){return l.Diag},Dilation2D:function(){return l.Dilation2D},Dilation2DBackpropFilter:function(){return l.Dilation2DBackpropFilter},Dilation2DBackpropInput:function(){return l.Dilation2DBackpropInput},ENV:function(){return l.ENV},EarlyStopping:function(){return Rd},Einsum:function(){return l.Einsum},Elu:function(){return l.Elu},EluGrad:function(){return l.EluGrad},Environment:function(){return l.Environment},Equal:function(){return l.Equal},Erf:function(){return l.Erf},Exp:function(){return l.Exp},ExpandDims:function(){return l.ExpandDims},Expm1:function(){return l.Expm1},FFT:function(){return l.FFT},Fill:function(){return l.Fill},FlipLeftRight:function(){return l.FlipLeftRight},Floor:function(){return l.Floor},FloorDiv:function(){return l.FloorDiv},FromPixels:function(){return l.FromPixels},FusedBatchNorm:function(){return l.FusedBatchNorm},FusedConv2D:function(){return l.FusedConv2D},FusedDepthwiseConv2D:function(){return l.FusedDepthwiseConv2D},GatherNd:function(){return l.GatherNd},GatherV2:function(){return l.GatherV2},GraphModel:function(){return Dd.g_},Greater:function(){return l.Greater},GreaterEqual:function(){return l.GreaterEqual},History:function(){return ns},IFFT:function(){return l.IFFT},Identity:function(){return l.Identity},Imag:function(){return l.Imag},InputSpec:function(){return to},IsFinite:function(){return l.IsFinite},IsInf:function(){return l.IsInf},IsNan:function(){return l.IsNan},KernelBackend:function(){return l.KernelBackend},LRN:function(){return l.LRN},LRNGrad:function(){return l.LRNGrad},LayerVariable:function(){return Ji},LayersModel:function(){return Nu},LeakyRelu:function(){return l.LeakyRelu},Less:function(){return l.Less},LessEqual:function(){return l.LessEqual},LinSpace:function(){return l.LinSpace},Log:function(){return l.Log},Log1p:function(){return l.Log1p},LogSoftmax:function(){return l.LogSoftmax},LogicalAnd:function(){return l.LogicalAnd},LogicalNot:function(){return l.LogicalNot},LogicalOr:function(){return l.LogicalOr},LogicalXor:function(){return l.LogicalXor},LowerBound:function(){return l.LowerBound},Max:function(){return l.Max},MaxPool:function(){return l.MaxPool},MaxPool3D:function(){return l.MaxPool3D},MaxPool3DGrad:function(){return l.MaxPool3DGrad},MaxPoolGrad:function(){return l.MaxPoolGrad},MaxPoolWithArgmax:function(){return l.MaxPoolWithArgmax},Maximum:function(){return l.Maximum},Mean:function(){return l.Mean},Min:function(){return l.Min},Minimum:function(){return l.Minimum},MirrorPad:function(){return l.MirrorPad},Mod:function(){return l.Mod},MomentumOptimizer:function(){return l.MomentumOptimizer},Multinomial:function(){return l.Multinomial},Multiply:function(){return l.Multiply},Neg:function(){return l.Neg},NonMaxSuppressionV3:function(){return l.NonMaxSuppressionV3},NonMaxSuppressionV4:function(){return l.NonMaxSuppressionV4},NonMaxSuppressionV5:function(){return l.NonMaxSuppressionV5},NotEqual:function(){return l.NotEqual},OP_SCOPE_SUFFIX:function(){return l.OP_SCOPE_SUFFIX},OneHot:function(){return l.OneHot},OnesLike:function(){return l.OnesLike},Optimizer:function(){return l.Optimizer},OptimizerConstructors:function(){return l.OptimizerConstructors},Pack:function(){return l.Pack},PadV2:function(){return l.PadV2},Pool:function(){return l.Pool},Pow:function(){return l.Pow},Prelu:function(){return l.Prelu},Prod:function(){return l.Prod},RMSPropOptimizer:function(){return l.RMSPropOptimizer},RNN:function(){return Pc},Range:function(){return l.Range},Rank:function(){return l.Rank},Real:function(){return l.Real},RealDiv:function(){return l.RealDiv},Reciprocal:function(){return l.Reciprocal},Reduction:function(){return l.Reduction},Relu:function(){return l.Relu},Relu6:function(){return l.Relu6},Reshape:function(){return l.Reshape},ResizeBilinear:function(){return l.ResizeBilinear},ResizeBilinearGrad:function(){return l.ResizeBilinearGrad},ResizeNearestNeighbor:function(){return l.ResizeNearestNeighbor},ResizeNearestNeighborGrad:function(){return l.ResizeNearestNeighborGrad},Reverse:function(){return l.Reverse},RotateWithOffset:function(){return l.RotateWithOffset},Round:function(){return l.Round},Rsqrt:function(){return l.Rsqrt},SGDOptimizer:function(){return l.SGDOptimizer},ScatterNd:function(){return l.ScatterNd},SearchSorted:function(){return l.SearchSorted},Select:function(){return l.Select},Selu:function(){return l.Selu},Sequential:function(){return Du},Sigmoid:function(){return l.Sigmoid},Sign:function(){return l.Sign},Sin:function(){return l.Sin},Sinh:function(){return l.Sinh},Slice:function(){return l.Slice},Softmax:function(){return l.Softmax},Softplus:function(){return l.Softplus},SpaceToBatchND:function(){return l.SpaceToBatchND},SparseFillEmptyRows:function(){return l.SparseFillEmptyRows},SparseReshape:function(){return l.SparseReshape},SparseSegmentMean:function(){return l.SparseSegmentMean},SparseSegmentSum:function(){return l.SparseSegmentSum},SparseToDense:function(){return l.SparseToDense},SplitV:function(){return l.SplitV},Sqrt:function(){return l.Sqrt},Square:function(){return l.Square},SquaredDifference:function(){return l.SquaredDifference},Step:function(){return l.Step},StridedSlice:function(){return l.StridedSlice},StringNGrams:function(){return l.StringNGrams},StringSplit:function(){return l.StringSplit},StringToHashBucketFast:function(){return l.StringToHashBucketFast},Sub:function(){return l.Sub},Sum:function(){return l.Sum},SymbolicTensor:function(){return no},Tan:function(){return l.Tan},Tanh:function(){return l.Tanh},Tensor:function(){return l.Tensor},TensorBuffer:function(){return l.TensorBuffer},Tile:function(){return l.Tile},TopK:function(){return l.TopK},Transform:function(){return l.Transform},Transpose:function(){return l.Transpose},Unique:function(){return l.Unique},Unpack:function(){return l.Unpack},UnsortedSegmentSum:function(){return l.UnsortedSegmentSum},UpperBound:function(){return l.UpperBound},Variable:function(){return l.Variable},ZerosLike:function(){return l.ZerosLike},_FusedMatMul:function(){return l._FusedMatMul},abs:function(){return l.abs},acos:function(){return l.acos},acosh:function(){return l.acosh},add:function(){return l.add},addN:function(){return l.addN},all:function(){return l.all},any:function(){return l.any},argMax:function(){return l.argMax},argMin:function(){return l.argMin},asin:function(){return l.asin},asinh:function(){return l.asinh},atan:function(){return l.atan},atan2:function(){return l.atan2},atanh:function(){return l.atanh},avgPool:function(){return l.avgPool},avgPool3d:function(){return l.avgPool3d},backend:function(){return l.backend},backend_util:function(){return l.backend_util},basicLSTMCell:function(){return l.basicLSTMCell},batchNorm:function(){return l.batchNorm},batchNorm2d:function(){return l.batchNorm2d},batchNorm3d:function(){return l.batchNorm3d},batchNorm4d:function(){return l.batchNorm4d},batchToSpaceND:function(){return l.batchToSpaceND},bincount:function(){return l.bincount},booleanMaskAsync:function(){return l.booleanMaskAsync},broadcastArgs:function(){return l.broadcastArgs},broadcastTo:function(){return l.broadcastTo},broadcast_util:function(){return l.broadcast_util},browser:function(){return l.browser},buffer:function(){return l.buffer},callbacks:function(){return Fd},cast:function(){return l.cast},ceil:function(){return l.ceil},clipByValue:function(){return l.clipByValue},clone:function(){return l.clone},complex:function(){return l.complex},concat:function(){return l.concat},concat1d:function(){return l.concat1d},concat2d:function(){return l.concat2d},concat3d:function(){return l.concat3d},concat4d:function(){return l.concat4d},constraints:function(){return r},conv1d:function(){return l.conv1d},conv2d:function(){return l.conv2d},conv2dTranspose:function(){return l.conv2dTranspose},conv3d:function(){return l.conv3d},conv3dTranspose:function(){return l.conv3dTranspose},copyRegisteredKernels:function(){return l.copyRegisteredKernels},cos:function(){return l.cos},cosh:function(){return l.cosh},cosineWindow:function(){return l.cosineWindow},cumprod:function(){return l.cumprod},cumsum:function(){return l.cumsum},customGrad:function(){return l.customGrad},data:function(){return c},denseBincount:function(){return l.denseBincount},deprecationWarn:function(){return l.deprecationWarn},depthToSpace:function(){return l.depthToSpace},depthwiseConv2d:function(){return l.depthwiseConv2d},deregisterOp:function(){return Dd.Ue},device_util:function(){return l.device_util},diag:function(){return l.diag},dilation2d:function(){return l.dilation2d},disableDeprecationWarnings:function(){return l.disableDeprecationWarnings},dispose:function(){return l.dispose},disposeVariables:function(){return l.disposeVariables},div:function(){return l.div},divNoNan:function(){return l.divNoNan},dot:function(){return l.dot},dropout:function(){return l.dropout},einsum:function(){return l.einsum},elu:function(){return l.elu},enableDebugMode:function(){return l.enableDebugMode},enableProdMode:function(){return l.enableProdMode},enclosingPowerOfTwo:function(){return l.enclosingPowerOfTwo},engine:function(){return l.engine},env:function(){return l.env},equal:function(){return l.equal},erf:function(){return l.erf},euclideanNorm:function(){return l.euclideanNorm},exp:function(){return l.exp},expandDims:function(){return l.expandDims},expm1:function(){return l.expm1},eye:function(){return l.eye},fft:function(){return l.fft},fill:function(){return l.fill},findBackend:function(){return l.findBackend},findBackendFactory:function(){return l.findBackendFactory},floor:function(){return l.floor},floorDiv:function(){return l.floorDiv},fused:function(){return l.fused},gather:function(){return l.gather},gatherND:function(){return l.gatherND},gather_util:function(){return l.gather_util},getBackend:function(){return l.getBackend},getGradient:function(){return l.getGradient},getKernel:function(){return l.getKernel},getKernelsForBackend:function(){return l.getKernelsForBackend},grad:function(){return l.grad},grads:function(){return l.grads},greater:function(){return l.greater},greaterEqual:function(){return l.greaterEqual},ifft:function(){return l.ifft},imag:function(){return l.imag},image:function(){return l.image},inTopKAsync:function(){return l.inTopKAsync},initializers:function(){return a},input:function(){return zu},io:function(){return l.io},irfft:function(){return l.irfft},isFinite:function(){return l.isFinite},isInf:function(){return l.isInf},isNaN:function(){return l.isNaN},keep:function(){return l.keep},kernel_impls:function(){return l.kernel_impls},layers:function(){return i},leakyRelu:function(){return l.leakyRelu},less:function(){return l.less},lessEqual:function(){return l.lessEqual},linalg:function(){return l.linalg},linspace:function(){return l.linspace},loadGraphModel:function(){return Dd.YL},loadGraphModelSync:function(){return Dd.fM},loadLayersModel:function(){return Mu},localResponseNormalization:function(){return l.localResponseNormalization},log:function(){return l.log},log1p:function(){return l.log1p},logSigmoid:function(){return l.logSigmoid},logSoftmax:function(){return l.logSoftmax},logSumExp:function(){return l.logSumExp},logicalAnd:function(){return l.logicalAnd},logicalNot:function(){return l.logicalNot},logicalOr:function(){return l.logicalOr},logicalXor:function(){return l.logicalXor},losses:function(){return l.losses},lowerBound:function(){return l.lowerBound},matMul:function(){return l.matMul},math:function(){return l.math},max:function(){return l.max},maxPool:function(){return l.maxPool},maxPool3d:function(){return l.maxPool3d},maxPoolWithArgmax:function(){return l.maxPoolWithArgmax},maximum:function(){return l.maximum},mean:function(){return l.mean},memory:function(){return l.memory},meshgrid:function(){return l.meshgrid},metrics:function(){return o},min:function(){return l.min},minimum:function(){return l.minimum},mirrorPad:function(){return l.mirrorPad},mod:function(){return l.mod},model:function(){return Zu},models:function(){return s},moments:function(){return l.moments},movingAverage:function(){return l.movingAverage},mul:function(){return l.mul},multiRNNCell:function(){return l.multiRNNCell},multinomial:function(){return l.multinomial},neg:function(){return l.neg},nextFrame:function(){return l.nextFrame},norm:function(){return l.norm},notEqual:function(){return l.notEqual},oneHot:function(){return l.oneHot},ones:function(){return l.ones},onesLike:function(){return l.onesLike},op:function(){return l.op},outerProduct:function(){return l.outerProduct},pad:function(){return l.pad},pad1d:function(){return l.pad1d},pad2d:function(){return l.pad2d},pad3d:function(){return l.pad3d},pad4d:function(){return l.pad4d},pool:function(){return l.pool},pow:function(){return l.pow},prelu:function(){return l.prelu},print:function(){return l.print},prod:function(){return l.prod},profile:function(){return l.profile},rand:function(){return l.rand},randomGamma:function(){return l.randomGamma},randomNormal:function(){return l.randomNormal},randomStandardNormal:function(){return l.randomStandardNormal},randomUniform:function(){return l.randomUniform},range:function(){return l.range},ready:function(){return l.ready},real:function(){return l.real},reciprocal:function(){return l.reciprocal},registerBackend:function(){return l.registerBackend},registerCallbackConstructor:function(){return Lu},registerGradient:function(){return l.registerGradient},registerKernel:function(){return l.registerKernel},registerOp:function(){return Dd.iw},regularizers:function(){return u},relu:function(){return l.relu},relu6:function(){return l.relu6},removeBackend:function(){return l.removeBackend},reshape:function(){return l.reshape},reverse:function(){return l.reverse},reverse1d:function(){return l.reverse1d},reverse2d:function(){return l.reverse2d},reverse3d:function(){return l.reverse3d},reverse4d:function(){return l.reverse4d},rfft:function(){return l.rfft},round:function(){return l.round},rsqrt:function(){return l.rsqrt},scalar:function(){return l.scalar},scatterND:function(){return l.scatterND},scatter_util:function(){return l.scatter_util},searchSorted:function(){return l.searchSorted},selu:function(){return l.selu},separableConv2d:function(){return l.separableConv2d},sequential:function(){return Ou},serialization:function(){return l.serialization},setBackend:function(){return l.setBackend},setPlatform:function(){return l.setPlatform},setdiff1dAsync:function(){return l.setdiff1dAsync},sigmoid:function(){return l.sigmoid},sign:function(){return l.sign},signal:function(){return l.signal},sin:function(){return l.sin},sinh:function(){return l.sinh},slice:function(){return l.slice},slice1d:function(){return l.slice1d},slice2d:function(){return l.slice2d},slice3d:function(){return l.slice3d},slice4d:function(){return l.slice4d},slice_util:function(){return l.slice_util},softmax:function(){return l.softmax},softplus:function(){return l.softplus},spaceToBatchND:function(){return l.spaceToBatchND},sparse:function(){return l.sparse},sparseToDense:function(){return l.sparseToDense},spectral:function(){return l.spectral},split:function(){return l.split},sqrt:function(){return l.sqrt},square:function(){return l.square},squaredDifference:function(){return l.squaredDifference},squeeze:function(){return l.squeeze},stack:function(){return l.stack},step:function(){return l.step},stridedSlice:function(){return l.stridedSlice},string:function(){return l.string},sub:function(){return l.sub},sum:function(){return l.sum},sumOutType:function(){return l.sumOutType},tan:function(){return l.tan},tanh:function(){return l.tanh},tensor:function(){return l.tensor},tensor1d:function(){return l.tensor1d},tensor2d:function(){return l.tensor2d},tensor3d:function(){return l.tensor3d},tensor4d:function(){return l.tensor4d},tensor5d:function(){return l.tensor5d},tensor6d:function(){return l.tensor6d},tensor_util:function(){return l.tensor_util},test_util:function(){return l.test_util},tidy:function(){return l.tidy},tile:function(){return l.tile},time:function(){return l.time},topk:function(){return l.topk},train:function(){return l.train},transpose:function(){return l.transpose},truncatedNormal:function(){return l.truncatedNormal},unique:function(){return l.unique},unregisterGradient:function(){return l.unregisterGradient},unregisterKernel:function(){return l.unregisterKernel},unsortedSegmentSum:function(){return l.unsortedSegmentSum},unstack:function(){return l.unstack},upcastType:function(){return l.upcastType},upperBound:function(){return l.upperBound},util:function(){return l.util},valueAndGrad:function(){return l.valueAndGrad},valueAndGrads:function(){return l.valueAndGrads},variable:function(){return l.variable},variableGrads:function(){return l.variableGrads},version:function(){return j_},version_converter:function(){return Dd.gJ},version_core:function(){return l.version_core},version_layers:function(){return Hs},where:function(){return l.where},whereAsync:function(){return l.whereAsync},zeros:function(){return l.zeros},zerosLike:function(){return l.zerosLike}});var r={};n.r(r),n.d(r,{maxNorm:function(){return Eo},minMaxNorm:function(){return Ro},nonNeg:function(){return Ao},unitNorm:function(){return _o}});var a={};n.r(a),n.d(a,{constant:function(){return Zo},glorotNormal:function(){return Wo},glorotUniform:function(){return Bo},heNormal:function(){return Vo},heUniform:function(){return Uo},identity:function(){return Lo},leCunNormal:function(){return Go},leCunUniform:function(){return jo},ones:function(){return Do},orthogonal:function(){return Ho},randomNormal:function(){return Mo},randomUniform:function(){return Oo},truncatedNormal:function(){return zo},varianceScaling:function(){return Po},zeros:function(){return Fo}});var i={};n.r(i),n.d(i,{Layer:function(){return oo},RNN:function(){return Pc},RNNCell:function(){return Bc},activation:function(){return cp},add:function(){return yp},alphaDropout:function(){return ud},average:function(){return bp},averagePooling1d:function(){return Ep},averagePooling2d:function(){return Rp},averagePooling3d:function(){return Zp},avgPool1d:function(){return _p},avgPool2d:function(){return Fp},avgPool3d:function(){return Op},avgPooling1d:function(){return Ap},avgPooling2d:function(){return Dp},avgPooling3d:function(){return Mp},batchNormalization:function(){return Np},bidirectional:function(){return ed},concatenate:function(){return xp},conv1d:function(){return ep},conv2d:function(){return tp},conv2dTranspose:function(){return np},conv3d:function(){return rp},conv3dTranspose:function(){return ap},convLstm2d:function(){return Yp},convLstm2dCell:function(){return Qp},cropping2D:function(){return op},dense:function(){return lp},depthwiseConv2d:function(){return up},dot:function(){return Ip},dropout:function(){return pp},elu:function(){return Kl},embedding:function(){return gp},flatten:function(){return fp},gaussianDropout:function(){return sd},gaussianNoise:function(){return od},globalAveragePooling1d:function(){return zp},globalAveragePooling2d:function(){return Lp},globalMaxPool1d:function(){return nd},globalMaxPool2d:function(){return rd},globalMaxPooling1d:function(){return Pp},globalMaxPooling2d:function(){return Bp},gru:function(){return Gp},gruCell:function(){return jp},input:function(){return zu},inputLayer:function(){return ql},layerNormalization:function(){return Tp},leakyReLU:function(){return Yl},lstm:function(){return Hp},lstmCell:function(){return qp},masking:function(){return cd},maxPool1d:function(){return ad},maxPool2d:function(){return id},maxPooling1d:function(){return Wp},maxPooling2d:function(){return Vp},maxPooling3d:function(){return Up},maximum:function(){return kp},minimum:function(){return wp},multiply:function(){return Sp},permute:function(){return vp},prelu:function(){return Ql},reLU:function(){return Xl},repeatVector:function(){return hp},reshape:function(){return mp},rnn:function(){return Jp},separableConv2d:function(){return ip},simpleRNN:function(){return Kp},simpleRNNCell:function(){return Xp},softmax:function(){return Jl},spatialDropout1d:function(){return dp},stackedRNNCells:function(){return $p},thresholdedReLU:function(){return $l},timeDistributed:function(){return td},upSampling2d:function(){return sp},zeroPadding2d:function(){return Cp}});var o={};n.r(o),n.d(o,{MAPE:function(){return xd},MSE:function(){return Sd},binaryAccuracy:function(){return ld},binaryCrossentropy:function(){return pd},categoricalAccuracy:function(){return fd},categoricalCrossentropy:function(){return hd},cosineProximity:function(){return gd},mape:function(){return kd},meanAbsoluteError:function(){return yd},meanAbsolutePercentageError:function(){return bd},meanSquaredError:function(){return wd},mse:function(){return Id},precision:function(){return md},recall:function(){return vd},sparseCategoricalAccuracy:function(){return dd}});var s={};n.r(s),n.d(s,{modelFromJSON:function(){return Cu}});var u={};n.r(u),n.d(u,{l1:function(){return Td},l1l2:function(){return Nd},l2:function(){return Cd}});var c={};n.r(c),n.d(c,{CSVDataset:function(){return Cf},Dataset:function(){return mf},FileDataSource:function(){return Vf},TextLineDataset:function(){return xf},URLDataSource:function(){return Uf},array:function(){return gf},csv:function(){return Gf},func:function(){return jf},generator:function(){return Hf},microphone:function(){return Xf},version_data:function(){return Qf},webcam:function(){return qf},zip:function(){return yf}});var l=n(3772),p=n(9439),d=n(2145),f=n(9118),h=n(651),m=n(4031),v={kernelName:d.SY,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)(e,(0,m.N)((0,f.p)(n,"float32"),-1))}}}},g=n(5750),y=n(4362),b=n(7067),x=n(6902),k=n(7391),w=n(4774),S={kernelName:d.VG,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){var t=(0,k.h)((0,f.p)(n,"float32")),r=(0,x._)((0,w.l)((0,b.i)(1),t));return(0,y.W)((0,g.h)(e,r))}}}},I={kernelName:d.Sp,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){var t=(0,x._)((0,w.l)((0,k.h)((0,f.p)(n,"float32")),1));return(0,g.h)(e,t)}}}},N=n(5774),T=n(5561),C=n(227),E={kernelName:d.mm,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1],i=N.assertAndGetBroadcastShape(r.shape,a.shape);return{a:function(){var t=e,n=N.getReductionAxes(r.shape,i);return n.length>0&&(t=(0,C.S)(t,n)),(0,T.X)(t,r.shape)},b:function(){var t=e,n=N.getReductionAxes(a.shape,i);return n.length>0&&(t=(0,C.S)(t,n)),(0,T.X)(t,a.shape)}}}},_={kernelName:d.Xz,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},A=n(7293),R={kernelName:d.sJ,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,A.P)(n)}}}},F={kernelName:d.aJ,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,A.P)(n)}}}},D={kernelName:d.M2,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,g.h)(e,(0,x._)((0,w.l)((0,b.i)(1),(0,k.h)((0,f.p)(n,"float32")))))}}}},Z=n(3312),O={kernelName:d.qw,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){var t=(0,x._)((0,Z.I)((0,b.i)(1),(0,k.h)((0,f.p)(n,"float32"))));return(0,g.h)(e,t)}}}},M={kernelName:d.QC,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1],i=(0,N.assertAndGetBroadcastShape)(r.shape,a.shape);return{a:function(){var t=(0,Z.I)((0,k.h)(r),(0,k.h)(a)),n=(0,h.d)(e,(0,g.h)(a,t)),o=(0,N.getReductionAxes)(r.shape,i);return o.length>0&&(n=(0,C.S)(n,o)),(0,T.X)(n,r.shape)},b:function(){var t=(0,Z.I)((0,k.h)(r),(0,k.h)(a)),n=(0,y.W)((0,h.d)(e,(0,g.h)(r,t))),o=(0,N.getReductionAxes)(a.shape,i);return o.length>0&&(n=(0,C.S)(n,o)),(0,T.X)(n,a.shape)}}}},z={kernelName:d.jM,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,g.h)(e,(0,Z.I)((0,k.h)((0,f.p)(n,"float32")),1))}}}},L={kernelName:d.Oy,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,g.h)(e,(0,w.l)((0,b.i)(1),(0,k.h)((0,f.p)(n,"float32"))))}}}},P=n(318),B=n(8354),W=n(6147),V=n(9151),U=n(8640);var G=(0,U.op)({avgPool3dGrad_:function(e,t,n,r,a,i){var o=(0,B._1)(e,"dy","avgPool3dGrad"),s=(0,B._1)(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=(0,T.X)(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=(0,T.X)(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),W.hu(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")})),W.hu(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")})),(0,V.m)("avgPool3dGrad",a,i);var p={dy:u,input:c},f={filterSize:n,strides:r,pad:a,dimRoundingMode:i},h=P.BV.runKernel(d.IM,p,f);return l?(0,T.X)(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),j={kernelName:d._k,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return G(e,r,a,i,o,s)}}}};var H=(0,U.op)({avgPoolGrad_:function(e,t,n,r,a){var i=(0,B._1)(e,"dy","avgPoolGrad"),o=(0,B._1)(t,"input","avgPoolGrad");W.hu(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=(0,T.X)(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=(0,T.X)(i,[1,i.shape[0],i.shape[1],i.shape[2]])),W.hu(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),W.hu(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")}));var l={dy:u,input:s},p={filterSize:n,strides:r,pad:a},f=P.BV.runKernel(d.RO,l,p);return c?(0,T.X)(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),q={kernelName:d.Jh,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return H(e,r,a,i,o)}}}},K=n(7221),X={kernelName:d.XL,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return(0,K.O)(e,i,!1,!1)},b:function(){return(0,K.O)(e,a,!0,!1)}}:o&&!s?{a:function(){return(0,K.O)(i,e,!1,!0)},b:function(){return(0,K.O)(a,e,!1,!1)}}:{a:function(){return(0,K.O)(i,e,!0,!0)},b:function(){return(0,K.O)(e,a,!0,!0)}}:{a:function(){return(0,K.O)(e,i,!1,!0)},b:function(){return(0,K.O)(a,e,!0,!1)}}}},Y=n(5696),Q={kernelName:d.zw,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return(0,Y.f)(e,r,a)}}}},J={kernelName:d.Ly,gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return(0,C.S)(e,u,!0)}}}},$={kernelName:d.RF,gradFunc:function(e){return{x:function(){return e.clone()}}}},ee={kernelName:d.gJ,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},te=n(8327),ne=n(2642),re=n(2177),ae=n(329),ie={kernelName:d.xn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return(0,ae.a)((0,re.H)((0,te.b)(r,a),(0,ne.z)(r,i)),e,(0,A.P)(e))}}}},oe={kernelName:d.yj,inputsToSave:["x"],gradFunc:v.gradFunc},se=n(2588),ue={kernelName:d.Eh,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=n.axis,i=(0,W.EC)(a,t[0].shape)[0],o=r.map((function(e){return e[i]}));return(0,se.V)(e,o,i).map((function(e){return function(){return e}}))}},ce=n(8744),le=n(1045),pe={kernelName:d.mh,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return W.hu(V.I0(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return(0,le._)(a.shape,e,i,s,u,c)},filter:function(){return(0,ce.p)(a,e,i.shape,s,u,c)}}}},de=n(3457),fe={kernelName:d.wm,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return(0,de.T)(e,i,o,s,u,1,c)},filter:function(){return(0,ce.p)(e,a,i.shape,o,s,u,c)}}}};var he=(0,U.op)({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=(0,T.X)(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=(0,T.X)(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),W.hu(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),W.hu(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),W.hu(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),W.hu(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),W.hu(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return P.BV.runKernel(d.o2,s,u)}}),me=n(1873),ve={kernelName:d.x1,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;W.hu((0,V.I0)(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=(0,p.Z)(t,2),s=o[0],u=o[1];return{x:function(){return(0,me._)(s.shape,e,u,a,i)},filter:function(){return he(s,e,u.shape,a,i)}}}},ge=n(7254),ye={kernelName:d.mc,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)((0,y.W)((0,ge.O)((0,f.p)(n,"float32"))),e)}}}},be=n(7657),xe={kernelName:d.TR,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)((0,be.R)((0,f.p)(n,"float32")),e)}}}},ke=n(8473),we=n(8862),Se=n(1240),Ie={kernelName:d.iH,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=(0,ke.Q3)([a],r.rank),n=(0,we.z)(e,a,i,!o);return null!=t&&(n=(0,Se.p)(n,t)),n}}}},Ne=n(288),Te=n(6939),Ce={kernelName:d.ci,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;W.hu(V.I0(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=(0,p.Z)(t,2),c=u[0],l=u[1];return W.hu(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")})),W.hu(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")})),W.hu(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")})),W.hu(V.jT(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),V.m("depthwiseConv2d",i,o),{x:function(){return(0,Te.v)(c.shape,e,l,a,i,s,o)},filter:function(){return(0,Ne.z)(c,e,l.shape,a,i,s,o)}}}},Ee={kernelName:d.p4,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return P.BV.runKernel(d.ek,o,n)},filter:function(){return P.BV.runKernel(d.Vn,s,n)}}}},_e={kernelName:d.SX,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:(0,p.Z)(t,1)[0]};return{x:function(){return P.BV.runKernel(d.HE,n)}}}},Ae=n(411),Re={kernelName:d.Om,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0],r=(0,h.d)((0,Ae.Q)((0,y.W)((0,k.h)(n))),2/Math.sqrt(Math.PI));return{x:function(){return(0,h.d)(e,r)}}}},Fe={kernelName:d.NE,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)(e,n)}}}},De={kernelName:d.YF,inputsToSave:["input"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{input:function(){return(0,T.X)(e,n.shape)}}}},Ze={kernelName:d.Y0,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)(e,(0,Ae.Q)(n))}}}},Oe={kernelName:d.OR,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},Me={kernelName:d.je,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1],i=(0,N.assertAndGetBroadcastShape)(r.shape,a.shape);return{a:function(){var t=(0,g.h)(e,(0,f.p)(a,"float32")),n=(0,N.getReductionAxes)(r.shape,i);return n.length>0?(0,T.X)((0,C.S)(t,n),r.shape):t},b:function(){var t=(0,h.d)(e,(0,f.p)(r,"float32")),n=(0,N.getReductionAxes)(a.shape,i);n.length>0&&(t=(0,T.X)((0,C.S)(t,n),a.shape));var o=(0,k.h)(a);return(0,y.W)((0,g.h)(t,(0,f.p)(o,"float32")))}}}},ze=n(5115),Le=n(2343),Pe={kernelName:d.sH,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=(0,p.Z)(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?(0,b.i)(1):u,l=(0,N.getReductionAxes)(o.shape,i.shape),d=[];if(1===o.rank){for(var f=0;f<i.shape.length-1;++f)d.push(i.shape[f]);d.push(1)}var m=(0,w.l)(i,o),v=(0,h.d)(e,c),g=(0,ze.b)((0,Z.I)(s,(0,b.i)(r))),y=(0,h.d)((0,h.d)((0,h.d)(g,g),g),(0,b.i)(-.5));return{x:function(){return 1===o.rank?(0,T.X)((0,h.d)((0,h.d)(e,(0,Le.G)((0,T.X)(g,[1,1,1,o.shape[0]]),d)),c),i.shape):(0,T.X)((0,h.d)((0,h.d)(e,g),c),i.shape)},mean:function(){var e=(0,h.d)((0,h.d)(g,(0,b.i)(-1)),v);return 1===o.rank&&(e=(0,C.S)(e,l)),(0,T.X)(e,o.shape)},variance:function(){var e=(0,h.d)((0,h.d)(y,m),v);return 1===o.rank&&(e=(0,C.S)(e,l)),(0,T.X)(e,o.shape)},scale:function(){var t=(0,h.d)(m,g),n=(0,h.d)(e,t);return 1===o.rank&&(n=(0,C.S)(n,l)),(0,T.X)(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=(0,C.S)(t,l)),(0,T.X)(t,o.shape)}}}},Be=n(6918),We={kernelName:d.qi,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,2),a=r[0],i=r[1],o=n.axis,s=(0,W.EC)(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,p=Ve(0,u),d=Ve(u+1,u+1+l),f=Ue([r,[n],c]),h=(0,T.X)(e,f),m=(0,T.X)(i,[n]),v=Ue([[u],p,d]),g=(0,Se.p)(h,v),y=(0,Be.p)(g,m,a.shape[s]),b=(0,ke.LJ)(v);return y=(0,Se.p)(y,b)},indices:function(){return i}}}};function Ve(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Ue(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Ge={kernelName:d.Ac,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1];return{a:function(){return(0,A.P)(r)},b:function(){return(0,A.P)(a)}}}},je={kernelName:d.iJ,gradFunc:function(e){return{x:function(){return(0,f.p)(e,"float32")}}}},He={kernelName:d.av,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},qe={kernelName:d.iW,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},Ke={kernelName:d.r7,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},Xe=n(5014),Ye={kernelName:d.J$,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.alpha,i=(0,Xe.p)(r,0);return{x:function(){return(0,ae.a)(i,e,(0,h.d)(e,a))}}}},Qe={kernelName:d.kU,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,g.h)(e,(0,Z.I)(n,1))}}}},Je={kernelName:d.Zb,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,g.h)(e,(0,f.p)(n,"float32"))}}}},$e={kernelName:d.qC,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.axis;return{logits:function(){var t=(0,Ae.Q)(r);return(0,w.l)(e,(0,h.d)((0,C.S)(e,a,!0),t))}}}};var et=(0,U.op)({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5,s={x:e,y:t,dy:n},u={depthRadius:r,bias:a,alpha:i,beta:o};return P.BV.runKernel(d.Hh,s,u)}}),tt={kernelName:d.eZ,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,p.Z)(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return et(a,i,e,o,s,u,c)}}}},nt=n(3254);function rt(e,t,n,r){return t.rank<n.rank&&(t=(0,T.X)(t,ke.rv(t.shape,r))),e.rank<n.rank&&(e=(0,T.X)(e,ke.rv(e.shape,r))),{x:function(){return(0,h.d)(e,(0,f.p)((0,nt.D)(n,t),e.dtype))}}}var at={kernelName:d.Yo,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=rt(e,t[1],a,W.EC(r,a.shape));return{x:function(){return i.x()}}}},it=n(4920),ot={kernelName:d.BM,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1];return{a:function(){return(0,h.d)(e,(0,f.p)((0,te.b)(r,a),"float32"))},b:function(){return(0,h.d)(e,(0,f.p)((0,it.d)(r,a),"float32"))}}}};var st=(0,U.op)({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=(0,B._1)(e,"dy","maxPool3dGrad"),u=(0,B._1)(t,"input","maxPool3dGrad"),c=(0,B._1)(n,"output","maxPool3dGrad"),l=s,p=u,f=c,h=!1;4===u.rank&&(h=!0,l=(0,T.X)(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),p=(0,T.X)(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=(0,T.X)(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),W.hu(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")})),W.hu(5===p.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(p.rank,".")})),W.hu(5===f.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(f.rank,".")})),(0,V.m)("maxPool3dGrad",i,o);var m={dy:l,input:p,output:f},v={filterSize:r,strides:a,pad:i,dimRoundingMode:o},g=P.BV.runKernel(d.OU,m,v);return h?(0,T.X)(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),ut={kernelName:d.OA,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,p.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return st(e,a,i,o,s,u,c)}}}};var ct=(0,U.op)({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=(0,B._1)(e,"dy","maxPoolGrad"),u=(0,B._1)(t,"input","maxPoolGrad"),c=(0,B._1)(n,"output","maxPoolGrad");W.hu(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")})),W.hu(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")})),W.hu(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")})),V.m("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},p={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return P.BV.runKernel(d.OV,l,p)}}),lt={kernelName:d.mT,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,p.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return ct(e,a,i,o,s,u)}}}},pt=n(6100),dt={kernelName:d.q2,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.axis,i=W.EC(a,r.shape),o=(0,ke.kz)(r.shape,i)[1],s=W.NA(o);return{x:function(){var t=r.shape.slice();i.forEach((function(e){t[e]=1}));var n=(0,T.X)(e,t);return(0,g.h)((0,h.d)(n,(0,pt.i)(r.shape,"float32")),s)}}}},ft={kernelName:d.c1,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=(0,p.Z)(t,2),i=a[0],o=rt(e,a[1],i,W.EC(r,i.shape));return{x:function(){return o.x()}}}},ht={kernelName:d.q8,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1];return{a:function(){return(0,h.d)(e,(0,f.p)((0,ne.z)(r,a),"float32"))},b:function(){return(0,h.d)(e,(0,f.p)((0,Xe.p)(r,a),"float32"))}}}},mt=n(9238),vt={kernelName:d.jQ,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return(0,mt.t)(e,a,r.shape)}}}},gt=n(2628),yt={kernelName:d.Vb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1],i=(0,N.assertAndGetBroadcastShape)(r.shape,a.shape);return{a:function(){var t=(0,N.getReductionAxes)(r.shape,i);return t.length>0?(0,T.X)((0,C.S)(e,t),r.shape):e},b:function(){var t=(0,h.d)(e,(0,y.W)((0,gt.G)((0,g.h)(r,a)))),n=(0,N.getReductionAxes)(a.shape,i);return n.length>0?(0,T.X)((0,C.S)(t,n),a.shape):t}}}},bt={kernelName:d.wY,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1],i=(0,N.assertAndGetBroadcastShape)(r.shape,a.shape);return{a:function(){var t=(0,h.d)(e,(0,f.p)(a,"float32")),n=(0,N.getReductionAxes)(r.shape,i);return n.length>0?(0,T.X)((0,C.S)(t,n),r.shape):t},b:function(){var t=(0,h.d)(e,(0,f.p)(r,"float32")),n=(0,N.getReductionAxes)(a.shape,i);return n.length>0?(0,T.X)((0,C.S)(t,n),a.shape):t}}}},xt={kernelName:d.ku,gradFunc:function(e){return{x:function(){return(0,y.W)(e)}}}},kt=n(7742),wt={kernelName:d.we,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return(0,kt.l)(n.shape,"float32")}}}},St={kernelName:d.qW,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},It=n(4566),Nt={kernelName:d.Qi,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return(0,It.H)(e,r).map((function(e){return function(){return e}}))}},Tt={kernelName:d.ly,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return(0,mt.t)(e,a,r.shape)}}}},Ct=n(378),Et=n(4334),_t={kernelName:d.pe,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=(0,p.Z)(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=N.assertAndGetBroadcastShape(o.shape,s.shape);return{a:function(){var t=(0,f.p)(s,"float32"),n=(0,h.d)(e,(0,h.d)(t,(0,Et.s)(o,(0,w.l)(t,(0,b.i)(1))))),r=N.getReductionAxes(o.shape,u);return r.length>0&&(n=(0,C.S)(n,r)),(0,T.X)(n,o.shape)},b:function(){var t=(0,Xe.p)(o,0),n=(0,ae.a)(t,(0,Ct.c)(o),(0,A.P)(o)),r=(0,h.d)(e,(0,h.d)(i,n)),a=N.getReductionAxes(s.shape,u);return a.length>0&&(r=(0,C.S)(r,a)),(0,T.X)(r,s.shape)}}}},At={kernelName:d.o0,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1],i=(0,Xe.p)(r,0);return{x:function(){return(0,ae.a)(i,e,(0,h.d)(e,a))},alpha:function(){var t=(0,ae.a)(i,(0,A.P)(e),(0,h.d)(e,r)),n=(0,N.getReductionAxes)(a.shape,e.shape);return n.length>0&&(t=(0,C.S)(t,n)),(0,T.X)(t,a.shape)}}}},Rt=n(9457);function Ft(e,t,n){var r=e.shape.length,a=r-n.length,i=ke.Q3(n,r),o=e;null!=i&&(o=(0,Se.p)(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=(0,T.X)(t,r),i=(0,Rt.$)(e,n,!0,!1),o=(0,Rt.$)(e,n,!0,!0),s=(0,h.d)(i,o);return(0,h.d)(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=ke.LJ(i);c=(0,Se.p)(c,l)}return c}var Dt={kernelName:d.Dl,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.axis,i=[];return i=void 0===a||null===a?r.shape.map((function(e,t){return t})):"number"===typeof a?[a]:a,{x:function(){return Ft(r,e,i)}}}},Zt={kernelName:d.oH,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1],i=N.assertAndGetBroadcastShape(r.shape,a.shape);return{a:function(){var t=(0,g.h)(e,(0,f.p)(a,"float32")),n=N.getReductionAxes(r.shape,i);return n.length>0?(0,T.X)((0,C.S)(t,n),r.shape):t},b:function(){var t=(0,h.d)(e,(0,f.p)(r,"float32")),n=N.getReductionAxes(a.shape,i);n.length>0&&(t=(0,T.X)((0,C.S)(t,n),a.shape));var o=(0,k.h)(a);return(0,y.W)((0,g.h)(t,(0,f.p)(o,"float32")))}}}},Ot={kernelName:d.$H,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,g.h)(e,(0,y.W)((0,k.h)(n)))}}}},Mt={kernelName:d.Sb,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0],r=(0,h.d)((0,ne.z)(n,6),(0,m.N)(n));return{x:function(){return(0,h.d)(e,(0,f.p)(r,"float32"))}}}},zt={kernelName:d.qk,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)(e,(0,f.p)((0,m.N)(n),"float32"))}}}},Lt={kernelName:d.HZ,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,T.X)(e,n.shape)}}}},Pt={kernelName:d._Y,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,p.Z)(t,1)[0]};return{images:function(){return P.BV.runKernel(d.zb,r,n)}}}},Bt={kernelName:d.dp,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,p.Z)(t,1)[0]};return{images:function(){return P.BV.runKernel(d.Hm,r,n)}}}},Wt=n(4933),Vt={kernelName:d.mK,gradFunc:function(e,t,n){var r=n.dims,a=(0,W.EC)(r,e.shape);return{x:function(){return(0,Wt.G)(e,a)}}}},Ut={kernelName:d.e0,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},Gt={kernelName:d.bV,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,y.W)((0,g.h)(e,(0,h.d)((0,Et.s)(n,1.5),2)))}}}},jt=n(875),Ht={kernelName:d.Ph,inputsToSave:["condition"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{condition:function(){return(0,f.p)((0,A.P)(n),"float32")},t:function(){return(0,h.d)(e,(0,f.p)(n,e.dtype))},e:function(){return(0,h.d)(e,(0,f.p)((0,jt.h)(n),e.dtype))}}}},qt=n(349),Kt={kernelName:d.oF,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){var t=(0,Xe.p)(n,(0,b.i)(0)),r=(0,b.i)(qt.y),a=(0,b.i)(qt.$),i=(0,h.d)(e,a),o=(0,h.d)((0,h.d)(e,r),(0,Ae.Q)((0,f.p)(n,"float32")));return(0,ae.a)(t,i,o)}}}},Xt={kernelName:d.a5,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)(e,(0,h.d)(n,(0,w.l)((0,b.i)(1),n)))}}}},Yt={kernelName:d.i5,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},Qt=n(1227),Jt={kernelName:d.RQ,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)((0,Qt.m)((0,f.p)(n,"float32")),e)}}}},$t=n(6679),en={kernelName:d.w3,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)((0,$t.f)((0,f.p)(n,"float32")),e)}}}},tn=n(1970),nn=n(2875),rn={kernelName:d.p2,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=(0,p.Z)(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=(0,nn.parseSliceParams)(r,a,i),u=(0,p.Z)(s,2),c=u[0],l=u[1],d=[],f=0;f<e.rank;f++)d.push([c[f],o[f]-c[f]-l[f]]);return{x:function(){return(0,tn.v)(e,d)}}}},an={kernelName:d.Gc,outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.dim,i=(0,h.d)(e,r);return{logits:function(){return(0,w.l)(i,(0,h.d)((0,C.S)(i,[a],true),r))}}}},on=n(7643),sn={kernelName:d.MR,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)(e,(0,on.X)(n))}}}},un=n(6994),cn={kernelName:d.TQ,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return(0,un.E)(e,r,a)}}}},ln=n(4836),pn={kernelName:d.L8,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return(0,ln.z)(e,r)}}}},dn={kernelName:d.FK,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,g.h)(e,(0,h.d)((0,x._)((0,f.p)(n,"float32")),2))}}}},fn={kernelName:d.bK,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)(e,(0,h.d)((0,f.p)(n,"float32"),2))}}}},hn={kernelName:d._t,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1],i=(0,b.i)(2);return{a:function(){return(0,h.d)(e,(0,h.d)(i,(0,w.l)(r,a)))},b:function(){return(0,h.d)(e,(0,h.d)(i,(0,w.l)(a,r)))}}}},mn={kernelName:d.h8,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},vn={kernelName:d.Tr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,p.Z)(t,2),r=n[0],a=n[1],i=N.assertAndGetBroadcastShape(r.shape,a.shape);return{a:function(){var t=e,n=N.getReductionAxes(r.shape,i);return n.length>0&&(t=(0,C.S)(t,n)),(0,T.X)(t,r.shape)},b:function(){var t=e,n=N.getReductionAxes(a.shape,i);return n.length>0&&(t=(0,C.S)(t,n)),(0,T.X)((0,y.W)(t),a.shape)}}}},gn={kernelName:d.GB,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=r.shape.slice(),i=n.axis;(0,W.EC)(i,r.shape).forEach((function(e){a[e]=1}));var o=(0,T.X)(e,a),s=(0,h.d)(o,(0,pt.i)(r.shape,"float32"));return{x:function(){return s}}}},yn={kernelName:d.sE,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,g.h)(e,(0,k.h)((0,Qt.m)(n)))}}}},bn={kernelName:d.MI,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return(0,h.d)((0,w.l)((0,b.i)(1),(0,k.h)(n)),e)}}}},xn={kernelName:d.n9,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,p.Z)(t,1)[0],a=n.reps;return{x:function(){var t=(0,A.P)(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=(0,Z.I)(t,(0,mt.t)(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=(0,Z.I)(t,(0,mt.t)(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=(0,Z.I)(t,(0,mt.t)(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var p=0;p<a[1];++p)for(var d=0;d<a[2];++d)for(var f=0;f<a[3];++f)t=(0,Z.I)(t,(0,mt.t)(e,[l*r.shape[0],p*r.shape[1],d*r.shape[2],f*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},kn={kernelName:d.G3,gradFunc:function(e,t,n){var r=n.perm,a=ke.LJ(r);return{x:function(){return(0,Se.p)(e,a)}}}},wn=n(8306),Sn={kernelName:d.To,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return(0,wn.k)(e,r)}}}},In=n(2975),Nn=n(9498),Tn=n(705),Cn={kernelName:d.Qv,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=(0,p.Z)(t,1)[0];return{x:function(){return function(e,t){for(var n=(0,Tn.g)(t,(0,A.P)(t)),r=(0,Nn.I)(e,n),a=(0,te.b)(t,(0,b.i)(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=(0,In.d)(a,o+1);a=(0,re.H)(a,(0,pt.i)(r.shape,"bool"));var s=(0,A.P)(r);return(0,ae.a)(a,r,s)}(e,n)}}}};for(var En={kernelName:d.Ru,gradFunc:function(e){return{x:function(){return(0,A.P)(e)}}}},_n=n(8864),An=0,Rn=[v,S,I,E,_,R,F,D,O,M,z,L,j,q,X,Q,J,$,ee,ie,oe,ue,fe,pe,ve,ye,xe,Ie,Ce,Ee,Zt,_e,Re,Fe,De,Ze,Me,Oe,Pe,We,Ge,je,He,qe,Ke,Ye,Qe,Je,$e,tt,at,at,ot,ut,lt,dt,ft,ht,vt,yt,bt,xt,wt,St,Nt,Tt,Tt,_t,At,Dt,Ot,Mt,zt,Lt,Pt,Bt,Vt,Ut,Gt,Ht,Kt,Xt,Yt,Jt,en,rn,an,sn,cn,cn,pn,pn,dn,hn,fn,mn,vn,gn,yn,bn,xn,kn,Sn,Cn,En];An<Rn.length;An++){var Fn=Rn[An];(0,_n.Li)(Fn)}var Dn=n(7613),Zn=n(4376);(0,Zn.t3)().prototype.abs=function(){return this.throwIfDisposed(),(0,Dn.W)(this)};var On=n(1719);(0,Zn.t3)().prototype.acos=function(){return this.throwIfDisposed(),(0,On.K)(this)};var Mn=n(4502);(0,Zn.t3)().prototype.acosh=function(){return this.throwIfDisposed(),(0,Mn._)(this)},(0,Zn.t3)().prototype.add=function(e){return this.throwIfDisposed(),(0,Z.I)(this,e)};var zn=n(4108);(0,Zn.t3)().prototype.all=function(e,t){return this.throwIfDisposed(),(0,zn.$)(this,e,t)};var Ln=n(8543);(0,Zn.t3)().prototype.any=function(e,t){return this.throwIfDisposed(),(0,Ln.Y)(this,e,t)};var Pn=n(9995);(0,Zn.t3)().prototype.argMax=function(e){return this.throwIfDisposed(),(0,Pn.N)(this,e)};var Bn=n(5157);(0,Zn.t3)().prototype.argMin=function(e){return this.throwIfDisposed(),(0,Bn.v)(this,e)},(0,Zn.t3)().prototype.asScalar=function(){return this.throwIfDisposed(),(0,W.hu)(1===this.size,(function(){return"The array must have only 1 element."})),(0,T.X)(this,[])},(0,Zn.t3)().prototype.asType=function(e){return this.throwIfDisposed(),(0,f.p)(this,e)},(0,Zn.t3)().prototype.as1D=function(){return this.throwIfDisposed(),(0,T.X)(this,[this.size])},(0,Zn.t3)().prototype.as2D=function(e,t){return this.throwIfDisposed(),(0,T.X)(this,[e,t])},(0,Zn.t3)().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),(0,T.X)(this,[e,t,n])},(0,Zn.t3)().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),(0,T.X)(this,[e,t,n,r])},(0,Zn.t3)().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),(0,T.X)(this,[e,t,n,r,a])};var Wn=n(3053);(0,Zn.t3)().prototype.asin=function(){return this.throwIfDisposed(),(0,Wn.Z)(this)};var Vn=n(54);(0,Zn.t3)().prototype.asinh=function(){return this.throwIfDisposed(),(0,Vn.V)(this)};var Un=n(4778);(0,Zn.t3)().prototype.atan=function(){return this.throwIfDisposed(),(0,Un.z)(this)};var Gn=n(2227);(0,Zn.t3)().prototype.atan2=function(e){return this.throwIfDisposed(),(0,Gn.f)(this,e)};var jn=n(7897);(0,Zn.t3)().prototype.atanh=function(){return this.throwIfDisposed(),(0,jn.C)(this)};var Hn=n(9204);(0,Zn.t3)().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),(0,Hn.w)(this,e,t,n,r)},(0,Zn.t3)().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),(0,un.E)(this,e,t)};var qn=n(3700);(0,Zn.t3)().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),(0,qn.t)(this,e,t,n,r,a)};var Kn=n(9742);(0,Zn.t3)().prototype.broadcastTo=function(e){return this.throwIfDisposed(),(0,Kn.U)(this,e)},(0,Zn.t3)().prototype.cast=function(e){return this.throwIfDisposed(),(0,f.p)(this,e)};var Xn=n(1396);(0,Zn.t3)().prototype.ceil=function(){return this.throwIfDisposed(),(0,Xn.m)(this)};var Yn=n(9836);(0,Zn.t3)().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),(0,Yn.i)(this,e,t)};var Qn=n(3433);(0,Zn.t3)().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Zn.es&&(e=[e]),(0,ln.z)([this].concat((0,Qn.Z)(e)),t)};var Jn=n(4918);(0,Zn.t3)().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),(0,Jn.P)(this,e,t,n,r,a,i)};var $n=n(1732);(0,Zn.t3)().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),(0,$n.b)(this,e,t,n,r,a)},(0,Zn.t3)().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),(0,de.T)(this,e,t,n,r,a,i)},(0,Zn.t3)().prototype.cos=function(){return this.throwIfDisposed(),(0,Qt.m)(this)},(0,Zn.t3)().prototype.cosh=function(){return this.throwIfDisposed(),(0,$t.f)(this)},(0,Zn.t3)().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),(0,Rt.$)(this,e,t,n)},(0,Zn.t3)().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),(0,we.z)(this,e,t,n)};var er=n(1878);(0,Zn.t3)().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),(0,er.n)(this,e,t)};var tr=n(1147);(0,Zn.t3)().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),(0,tr.B)(this,e,t,n,r,a,i)};var nr=n(7580);(0,Zn.t3)().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),(0,nr.W)(this,e,t,n,r,a)};var rr=n(5923);(0,Zn.t3)().prototype.divNoNan=function(e){return this.throwIfDisposed(),(0,rr.N)(this,e)},(0,Zn.t3)().prototype.div=function(e){return this.throwIfDisposed(),(0,g.h)(this,e)};var ar=n(5043);(0,Zn.t3)().prototype.dot=function(e){return this.throwIfDisposed(),(0,ar.A)(this,e)};var ir=n(2353);(0,Zn.t3)().prototype.elu=function(){return this.throwIfDisposed(),(0,ir.p)(this)},(0,Zn.t3)().prototype.equal=function(e){return this.throwIfDisposed(),(0,nt.D)(this,e)};var or=n(3891);(0,Zn.t3)().prototype.erf=function(){return this.throwIfDisposed(),(0,or.q)(this)};var sr=n(3313);(0,Zn.t3)().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),(0,sr.d)(this,e,t)},(0,Zn.t3)().prototype.exp=function(){return this.throwIfDisposed(),(0,Ae.Q)(this)},(0,Zn.t3)().prototype.expandDims=function(e){return this.throwIfDisposed(),(0,In.d)(this,e)};var ur=n(5682);(0,Zn.t3)().prototype.expm1=function(){return this.throwIfDisposed(),(0,ur.t)(this)};var cr=n(7635);(0,Zn.t3)().prototype.fft=function(){return this.throwIfDisposed(),(0,cr.k)(this)},(0,Zn.t3)().prototype.flatten=function(){return this.throwIfDisposed(),(0,T.X)(this,[this.size])},(0,Zn.t3)().prototype.floor=function(){return this.throwIfDisposed(),(0,gt.G)(this)};var lr=n(7145);(0,Zn.t3)().prototype.floorDiv=function(e){return this.throwIfDisposed(),(0,lr.q)(this,e)},(0,Zn.t3)().prototype.gather=function(e,t){return this.throwIfDisposed(),(0,Nn.I)(this,e,t)},(0,Zn.t3)().prototype.greaterEqual=function(e){return this.throwIfDisposed(),(0,te.b)(this,e)},(0,Zn.t3)().prototype.greater=function(e){return this.throwIfDisposed(),(0,Xe.p)(this,e)};var pr=n(530);(0,Zn.t3)().prototype.ifft=function(){return this.throwIfDisposed(),(0,pr.S)(this)};var dr=n(774);(0,Zn.t3)().prototype.irfft=function(){return this.throwIfDisposed(),(0,dr.w)(this)};var fr=n(300);(0,Zn.t3)().prototype.isFinite=function(){return this.throwIfDisposed(),(0,fr.x)(this)};var hr=n(4652);(0,Zn.t3)().prototype.isInf=function(){return this.throwIfDisposed(),(0,hr.U)(this)};var mr=n(7005);(0,Zn.t3)().prototype.isNaN=function(){return this.throwIfDisposed(),(0,mr.i)(this)};var vr=n(4419);(0,Zn.t3)().prototype.leakyRelu=function(e){return this.throwIfDisposed(),(0,vr.h)(this,e)},(0,Zn.t3)().prototype.lessEqual=function(e){return this.throwIfDisposed(),(0,ne.z)(this,e)},(0,Zn.t3)().prototype.less=function(e){return this.throwIfDisposed(),(0,it.d)(this,e)};var gr=n(936);(0,Zn.t3)().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),(0,gr.G)(this,e,t,n,r)};var yr=n(5113);(0,Zn.t3)().prototype.logSigmoid=function(){return this.throwIfDisposed(),(0,yr.e)(this)};var br=n(4561);(0,Zn.t3)().prototype.logSoftmax=function(e){return this.throwIfDisposed(),(0,br.C)(this,e)};var xr=n(5530);(0,Zn.t3)().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),(0,xr.l)(this,e,t)},(0,Zn.t3)().prototype.log=function(){return this.throwIfDisposed(),(0,Ct.c)(this)};var kr=n(5341);(0,Zn.t3)().prototype.log1p=function(){return this.throwIfDisposed(),(0,kr.K)(this)},(0,Zn.t3)().prototype.logicalAnd=function(e){return this.throwIfDisposed(),(0,re.H)(this,e)},(0,Zn.t3)().prototype.logicalNot=function(){return this.throwIfDisposed(),(0,jt.h)(this)};var wr=n(5117);(0,Zn.t3)().prototype.logicalOr=function(e){return this.throwIfDisposed(),(0,wr.K)(this,e)};var Sr=n(1712);(0,Zn.t3)().prototype.logicalXor=function(e){return this.throwIfDisposed(),(0,Sr.e)(this,e)},(0,Zn.t3)().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),(0,K.O)(this,e,t,n)};var Ir=n(5777);(0,Zn.t3)().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),(0,Ir._)(this,e,t,n,r)};var Nr=n(6176);(0,Zn.t3)().prototype.max=function(e,t){return this.throwIfDisposed(),(0,Nr.F)(this,e,t)},(0,Zn.t3)().prototype.maximum=function(e){return this.throwIfDisposed(),(0,Tn.g)(this,e)};var Tr=n(6568);(0,Zn.t3)().prototype.mean=function(e,t){return this.throwIfDisposed(),(0,Tr.J)(this,e,t)};var Cr=n(7891);(0,Zn.t3)().prototype.min=function(e,t){return this.throwIfDisposed(),(0,Cr.V)(this,e,t)};var Er=n(2273);(0,Zn.t3)().prototype.minimum=function(e){return this.throwIfDisposed(),(0,Er.L)(this,e)};var _r=n(9719);(0,Zn.t3)().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),(0,_r.V)(this,e,t)};var Ar=n(4645);(0,Zn.t3)().prototype.mod=function(e){return this.throwIfDisposed(),(0,Ar.w)(this,e)},(0,Zn.t3)().prototype.mul=function(e){return this.throwIfDisposed(),(0,h.d)(this,e)},(0,Zn.t3)().prototype.neg=function(){return this.throwIfDisposed(),(0,y.W)(this)};var Rr=n(6662);(0,Zn.t3)().prototype.norm=function(e,t,n){return this.throwIfDisposed(),(0,Rr.K)(this,e,t,n)};var Fr=n(5549);(0,Zn.t3)().prototype.notEqual=function(e){return this.throwIfDisposed(),(0,Fr.Q)(this,e)};var Dr=n(4326);(0,Zn.t3)().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),(0,Dr.l)(this,e,t,n)};var Zr=n(773);(0,Zn.t3)().prototype.onesLike=function(){return this.throwIfDisposed(),(0,Zr.J)(this)},(0,Zn.t3)().prototype.pad=function(e,t){return this.throwIfDisposed(),(0,tn.v)(this,e,t)};var Or=n(7226);(0,Zn.t3)().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),(0,Or.d)(this,e,t,n,r,a,i)},(0,Zn.t3)().prototype.pow=function(e){return this.throwIfDisposed(),(0,Et.s)(this,e)};var Mr=n(6859);(0,Zn.t3)().prototype.prelu=function(e){return this.throwIfDisposed(),(0,Mr.A)(this,e)};var zr=n(7722);(0,Zn.t3)().prototype.prod=function(e,t){return this.throwIfDisposed(),(0,zr.W)(this,e,t)};var Lr=n(2209);(0,Zn.t3)().prototype.reciprocal=function(){return this.throwIfDisposed(),(0,Lr.M)(this)};var Pr=n(7539);(0,Zn.t3)().prototype.relu=function(){return this.throwIfDisposed(),(0,Pr.U)(this)};var Br=n(5900);(0,Zn.t3)().prototype.relu6=function(){return this.throwIfDisposed(),(0,Br.b)(this)},(0,Zn.t3)().prototype.reshapeAs=function(e){return this.throwIfDisposed(),(0,T.X)(this,e.shape)},(0,Zn.t3)().prototype.reshape=function(e){return this.throwIfDisposed(),(0,T.X)(this,e)};var Wr=n(464);(0,Zn.t3)().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),(0,Wr.I)(this,e,t,n)};var Vr=n(8600);(0,Zn.t3)().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),(0,Vr.j)(this,e,t,n)},(0,Zn.t3)().prototype.reverse=function(e){return this.throwIfDisposed(),(0,Wt.G)(this,e)};var Ur=n(4617);(0,Zn.t3)().prototype.rfft=function(){return this.throwIfDisposed(),(0,Ur.Q)(this)};var Gr=n(766);(0,Zn.t3)().prototype.round=function(){return this.throwIfDisposed(),(0,Gr.N)(this)},(0,Zn.t3)().prototype.rsqrt=function(){return this.throwIfDisposed(),(0,ze.b)(this)};var jr=n(413);(0,Zn.t3)().prototype.selu=function(){return this.throwIfDisposed(),(0,jr.U)(this)};var Hr=n(119);(0,Zn.t3)().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),(0,Hr.U)(this,e,t,n,r,a,i)},(0,Zn.t3)().prototype.sigmoid=function(){return this.throwIfDisposed(),(0,on.X)(this)};var qr=n(2070);(0,Zn.t3)().prototype.sign=function(){return this.throwIfDisposed(),(0,qr.X)(this)},(0,Zn.t3)().prototype.sin=function(){return this.throwIfDisposed(),(0,ge.O)(this)},(0,Zn.t3)().prototype.sinh=function(){return this.throwIfDisposed(),(0,be.R)(this)},(0,Zn.t3)().prototype.slice=function(e,t){return this.throwIfDisposed(),(0,mt.t)(this,e,t)};var Kr=n(4910);(0,Zn.t3)().prototype.softmax=function(e){return this.throwIfDisposed(),(0,Kr.X)(this,e)};var Xr=n(4626);(0,Zn.t3)().prototype.softplus=function(){return this.throwIfDisposed(),(0,Xr.W)(this)},(0,Zn.t3)().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),(0,Y.f)(this,e,t)},(0,Zn.t3)().prototype.split=function(e,t){return this.throwIfDisposed(),(0,se.V)(this,e,t)},(0,Zn.t3)().prototype.sqrt=function(){return this.throwIfDisposed(),(0,x._)(this)},(0,Zn.t3)().prototype.square=function(){return this.throwIfDisposed(),(0,k.h)(this)};var Yr=n(7993);(0,Zn.t3)().prototype.squaredDifference=function(e){return this.throwIfDisposed(),(0,Yr.$)(this,e)};var Qr=n(3931);(0,Zn.t3)().prototype.squeeze=function(e){return this.throwIfDisposed(),(0,Qr.L)(this,e)},(0,Zn.t3)().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof Zn.es?[this,e]:[this].concat((0,Qn.Z)(e));return(0,wn.k)(n,t)},(0,Zn.t3)().prototype.step=function(e){return this.throwIfDisposed(),(0,m.N)(this,e)};var Jr=n(9017);(0,Zn.t3)().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),(0,Jr.N)(this,e,t,n,r,a,i,o,s)},(0,Zn.t3)().prototype.sub=function(e){return this.throwIfDisposed(),(0,w.l)(this,e)},(0,Zn.t3)().prototype.sum=function(e,t){return this.throwIfDisposed(),(0,C.S)(this,e,t)};var $r=n(6999);(0,Zn.t3)().prototype.tan=function(){return this.throwIfDisposed(),(0,$r.O)(this)};var ea=n(1744);(0,Zn.t3)().prototype.tanh=function(){return this.throwIfDisposed(),(0,ea.A)(this)},(0,Zn.t3)().prototype.tile=function(e){return this.throwIfDisposed(),(0,Le.G)(this,e)},(0,Zn.t3)().prototype.toBool=function(){return this.throwIfDisposed(),(0,f.p)(this,"bool")},(0,Zn.t3)().prototype.toFloat=function(){return this.throwIfDisposed(),(0,f.p)(this,"float32")},(0,Zn.t3)().prototype.toInt=function(){return this.throwIfDisposed(),(0,f.p)(this,"int32")};var ta=n(9085);(0,Zn.t3)().prototype.topk=function(e,t){return this.throwIfDisposed(),(0,ta.h)(this,e,t)},(0,Zn.t3)().prototype.transpose=function(e){return this.throwIfDisposed(),(0,Se.p)(this,e)};var na=n(4860);(0,Zn.t3)().prototype.unique=function(e){return this.throwIfDisposed(),(0,na.T)(this,e)},(0,Zn.t3)().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),(0,Be.p)(this,e,t)},(0,Zn.t3)().prototype.unstack=function(e){return this.throwIfDisposed(),(0,It.H)(this,e)},(0,Zn.t3)().prototype.where=function(e,t){return this.throwIfDisposed(),(0,ae.a)(e,this,t)},(0,Zn.t3)().prototype.zerosLike=function(){return this.throwIfDisposed(),(0,A.P)(this)};var ra=n(7762),aa=n(5671),ia=n(3144),oa=n(7326),sa=n(136),ua=n(9388),ca=n(8737),la=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,oa.Z)(r),n.prototype),r}return(0,ia.Z)(n)}((0,ca.Z)(Error)),pa=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,oa.Z)(r),n.prototype),r}return(0,ia.Z)(n)}((0,ca.Z)(Error)),da=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,oa.Z)(r),n.prototype),r}return(0,ia.Z)(n)}((0,ca.Z)(Error)),fa=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,oa.Z)(r),n.prototype),r}return(0,ia.Z)(n)}((0,ca.Z)(Error)),ha=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,oa.Z)(r),n.prototype),r}return(0,ia.Z)(n)}((0,ca.Z)(Error)),ma=(Error,function(){function e(t){(0,aa.Z)(this,e),this.maxEntries=t||100,this.cache=new Map}return(0,ia.Z)(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}());function va(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function ga(e,t){if(!e)throw new ha(t)}function ya(e,t){var n,r=0,a=(0,ra.Z)(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(i){a.e(i)}finally{a.f()}return r}function ba(e){return 1===e.length?e[0]:e}function xa(e){return Array.isArray(e)?e:[e]}function ka(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function wa(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var Sa={};function Ia(e){if(null===e||void 0===e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function Na(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((function(e){return Na(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"===typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!==typeof a.value?Na(a):e[r]=a.value)}}function Ta(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){var i,o=e;if(o in n)i=n[o];else if(o in Sa)i=Sa[o];else if(null==(i=t[o]))throw new da("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}var s=e;if(null==s.className||null==s.config)throw new da("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(s),".\n")+"'className' and 'config' must set.");var u,c,l=s.className;if(l in n){var d=(0,p.Z)(n[l],2);u=d[0],c=d[1]}else if(l in Sa){var f=(0,p.Z)(Sa.className,2);u=f[0],c=f[1]}else if(l in t){var h=(0,p.Z)(t[l],2);u=h[0],c=h[1]}if(null==u)throw new da("Unknown ".concat(r,": ").concat(l,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=c){for(var m={},v=0,g=Object.keys(Sa);v<g.length;v++){var y=g[v];m[y]=Sa[y]}for(var b=0,x=Object.keys(n);b<x.length;b++){var k=x[b];m[k]=n[k]}var w=s.config;w.customObjects=m;for(var S=Object.assign({},Sa),I=0,N=Object.keys(n);I<N.length;I++){var T=N[I];Sa[T]=n[T]}Na(s.config);var C=c(u,s.config,n,a);return Sa=Object.assign({},S),C}for(var E=Object.assign({},Sa),_=0,A=Object.keys(n);_<A.length;_++){var R=A[_];Sa[R]=n[R]}var F=new u(s.config);return Sa=Object.assign({},E),F}function Ca(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Ea(e){if(null==e)return e;var t,n=[],r=(0,ra.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}function _a(e){if(null==e)throw new da("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function Aa(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new da("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Ra(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return ga(n>=0),ga(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function Fa(e,t){Array.isArray(e)?(l.util.assert(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return Fa(e,"element ".concat(n+1," of ").concat(t))}))):l.util.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+"".concat(Da(e),".")}))}function Da(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return Da(e)})).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function Za(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var Oa=0;function Ma(){return Oa++}var za={};function La(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in za||(za[e]=0),za[e]+=1,e+za[e].toString()}var Pa=["channelsFirst","channelsLast"],Ba=["nearest","bilinear"],Wa=["valid","same","causal"],Va=["max","avg"],Ua=["sum","mul","concat","ave"],Ga=new Map;function ja(e){Aa(Pa,"DataFormat",e)}function Ha(e){Aa(Wa,"PaddingMode",e)}function qa(e){Aa(Va,"PoolMode",e)}var Ka=[];function Xa(e,t){Ka.push(e);try{var n=t();return Ka.pop(),n}catch(r){throw Ka.pop(),r}}function Ya(e){if(!ei(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Ka.length?"":Ka.join("/")+"/")+e}function Qa(e){if(!ei(e))throw new Error("Not a valid tensor name: '"+e+"'");Ga.has(e)||Ga.set(e,0);var t=Ga.get(e);if(Ga.set(e,Ga.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return Ga.set(n,1),n}return e}var Ja,$a=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function ei(e){return!!e.match($a)}function ti(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function ni(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function ri(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function ai(e,t){if(t<e)throw new da("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function ii(){return null==Ja&&(Ja=(0,l.backend)().epsilon()),Ja}function oi(e,t){return l.cast(e,t)}function si(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),l.reshape(e,n)}function ui(e){var t=[ti(e.shape)];return l.reshape(e,t)}function ci(e,t,n){return(0,l.tidy)((function(){switch(e.rank){case 1:return l.slice1d(e,t,n);case 2:return l.slice2d(e,[t,0],[n,e.shape[1]]);case 3:return l.slice3d(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return l.slice4d(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return l.slice(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return l.slice(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new da("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function li(e,t,n){return(0,l.tidy)((function(){switch(e.rank){case 1:return l.slice1d(e,t,n);case 2:return l.slice2d(e,[0,t],[e.shape[0],n]);case 3:return l.slice3d(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return l.slice4d(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new da("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function pi(e,t,n,r){return(0,l.tidy)((function(){switch(e.rank){case 1:return l.slice1d(e,t,n);case 2:switch(r){case 1:return ci(e,t,n);case 2:return li(e,t,n);default:throw new da("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return ci(e,t,n);case 2:return l.slice3d(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return li(e,t,n);default:throw new da("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return ci(e,t,n);case 2:return l.slice4d(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return l.slice4d(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return li(e,t,n);default:throw new da("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new da("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function di(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),l.concat(e,n)}function fi(e,t){switch(e.rank){case 1:return l.concat1d([e,t]);case 2:return l.concat2d([e,t],0);case 3:return l.concat3d([e,t],0);case 4:return l.concat4d([e,t],0);default:throw new da("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function hi(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new da("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return l.tile(e,t)}function mi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return l.randomNormal(e,t,n,r,a)}function vi(e,t,n,r){if(e.rank<2||t.rank<2)throw new fa("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new fa("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape));if(2===e.rank&&2===t.rank){return l.fused.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?bi(e.rank,r,"channelsLast"):null,activation:n})}var a=e.shape.slice(),i=a.pop();e=l.reshape(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat((0,Qn.Z)(o),[s]),p=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=l.reshape(l.transpose(t,p),[u,-1]);var d=[].concat((0,Qn.Z)(a),(0,Qn.Z)(c));return l.reshape(l.fused.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?bi(e.rank,r,"channelsLast"):null,activation:n}),d)}function gi(e,t,n){return(0,l.tidy)((function(){return t=Array.isArray(t)?(0,l.tensor1d)(t,"int32"):l.cast(t,"int32"),l.gather(e,t,n)}))}function yi(e){return l.mul(e,e)}function bi(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new da("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?l.reshape(t,[1,r[0],1,1,1]):l.reshape(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?l.reshape(t,[1,1,1,1,r[0]]):l.reshape(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?l.reshape(t,[1,r[0],1,1]):l.reshape(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?l.reshape(t,[1,1,1,r[0]]):l.reshape(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?l.reshape(t,[1,r[0],1]):l.reshape(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?l.reshape(t,[1,1,r[0]]):l.reshape(t,[1].concat(r))}else if(e<3)return t;throw new da("Unsupported input rank by biasAdd: ".concat(t.rank))}function xi(e,t,n){return(0,l.tidy)((function(){return null==n&&(n="channelsLast"),ja(n),l.add(e,bi(e.rank,t,n))}))}function ki(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new fa("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return l.elu(e)}function wi(e,t,n,r){return(0,l.tidy)((function(){return l.dropout(e,t,n,r)}))}function Si(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var Ii=["fanIn","fanOut","fanAvg"],Ni=["normal","uniform","truncatedNormal"];var Ti=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(l.serialization.Serializable),Ci=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){return(0,l.zeros)(e,t)}}]),n}(Ti);Ci.className="Zeros",l.serialization.registerClass(Ci);var Ei=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){return(0,l.ones)(e,t)}}]),n}(Ti);Ei.className="Ones",l.serialization.registerClass(Ei);var _i=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),r=t.call(this),"object"!==typeof e)throw new da("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new da("config must have value set but got ".concat(e));return r.value=e.value,r}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){var n=this;return(0,l.tidy)((function(){return(0,l.mul)((0,l.scalar)(n.value),(0,l.ones)(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(Ti);_i.className="Constant",l.serialization.registerClass(_i);var Ai=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){return(0,l.randomUniform)(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(Ti);Ai.className="RandomUniform",l.serialization.registerClass(Ai);var Ri=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new fa("randomNormal does not support dType ".concat(t,"."));return mi(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(Ti);Ri.className="RandomNormal",l.serialization.registerClass(Ri);var Fi=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new fa("truncatedNormal does not support dType ".concat(t,"."));return(0,l.truncatedNormal)(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(Ti);Fi.className="TruncatedNormal",l.serialization.registerClass(Fi);var Di=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){var n=this;return(0,l.tidy)((function(){if(2!==e.length||e[0]!==e[1])throw new da("Identity matrix initializer can only be used for 2D square matrices.");return(0,l.mul)(n.gain,(0,l.eye)(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(Ti);Di.className="Identity",l.serialization.registerClass(Di);var Zi=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r,a;if((0,aa.Z)(this,n),r=t.call(this),e.scale<0)throw new da("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,a=r.mode,Aa(Ii,"FanMode",a),r.distribution=null==e.distribution?"normal":e.distribution,function(e){Aa(Ni,"Distribution",e)}(r.distribution),r.seed=e.seed,r}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(ja(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=ti(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=ti(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=ti(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new fa("".concat(this.getClassName()," does not support dType ").concat(t,"."));return(0,l.truncatedNormal)(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return(0,l.randomUniform)(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(Ti);Zi.className="VarianceScaling",l.serialization.registerClass(Zi);var Oi=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return(0,ia.Z)(n,[{key:"getClassName",value:function(){return Zi.className}}]),n}(Zi);Oi.className="GlorotUniform",l.serialization.registerClass(Oi);var Mi=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return(0,ia.Z)(n,[{key:"getClassName",value:function(){return Zi.className}}]),n}(Zi);Mi.className="GlorotNormal",l.serialization.registerClass(Mi);var zi=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return(0,ia.Z)(n,[{key:"getClassName",value:function(){return Zi.className}}]),n}(Zi);zi.className="HeNormal",l.serialization.registerClass(zi);var Li=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return(0,ia.Z)(n,[{key:"getClassName",value:function(){return Zi.className}}]),n}(Zi);Li.className="HeUniform",l.serialization.registerClass(Li);var Pi=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return(0,ia.Z)(n,[{key:"getClassName",value:function(){return Zi.className}}]),n}(Zi);Pi.className="LeCunNormal",l.serialization.registerClass(Pi);var Bi=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return(0,ia.Z)(n,[{key:"getClassName",value:function(){return Zi.className}}]),n}(Zi);Bi.className="LeCunNormal",l.serialization.registerClass(Bi);var Wi=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new fa("Random seed is not implemented for Orthogonal Initializer yet.");return r}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){var n=this;return(0,l.tidy)((function(){if(e.length<2)throw new fa("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(e[0]*e[1],") elements: ")+"Slowness may result.");var t=mi(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=l.linalg.gramSchmidt(t);return e[0]>e[1]&&(r=(0,l.transpose)(r)),(0,l.mul)(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(Ti);Wi.className="Orthogonal",l.serialization.registerClass(Wi);var Vi={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Ui(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ta(e,l.serialization.SerializationMap.getMap().classNameMap,t,"initializer")}function Gi(e){return Ia(e)}function ji(e){if("string"===typeof e){var t=e in Vi?Vi[e]:e;if("GlorotNormal"===t)return new Mi;if("GlorotUniform"===t)return new Oi;if("HeNormal"===t)return new zi;if("HeUniform"===t)return new Li;if("LeCunNormal"===t)return new Pi;if("LeCunUniform"===t)return new Bi;var n={};return n.className=t,n.config={},Ui(n)}return e instanceof Ti?e:Ui(e)}function Hi(e){return Array.isArray(e)&&Array.isArray(e[0])}function qi(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Ki(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new da("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function Xi(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new da("Expected exactly 1 Shape; got ".concat(e.length))}return e}function Yi(e){var t,n=0,r=(0,ra.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(i){r.e(i)}finally{r.f()}return n}var Qi="Variable",Ji=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Qi,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,aa.Z)(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=Ma(),r=null==r?Qi:r,this.originalName=Ya(r),this.name=Qa(this.originalName),this.trainable_=a,this.constraint=i,this.val=l.variable(t,this.trainable_,this.name,this.dtype)}return(0,ia.Z)(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function $i(e){return e.map((function(e){return e.read()}))}function eo(e){e.forEach((function(e){e[0].write(e[1])}))}var to=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),no=(0,ia.Z)((function e(t,n,r,a,i,o,s){(0,aa.Z)(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=Ma(),null!=o&&(this.originalName=Ya(o),this.name=Qa(this.originalName)),this.rank=n.length})),ro=0,ao=function(){function e(t,n){(0,aa.Z)(this,e),this.callArgs=n,this.id=ro++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=(0,ra.Z)(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(o){a.e(o)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return(0,ia.Z)(e,[{key:"getConfig",value:function(){var e,t=[],n=(0,ra.Z)(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(a){n.e(a)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),io=0,oo=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,aa.Z)(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=io++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=ka(i)+"_"+La(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return(0,ia.Z)(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new pa("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new da("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return ba(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return ba(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new la("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new la("Layer ".concat(this.name)+" is not connected, no input to return.");return ba(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new la("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new la("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return ba(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=xa(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=xa(this.inputSpec);if(e.length!==t.length)throw new da("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new da("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new da("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new da("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new da("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new da("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(u," of input shape to ")+"have value ".concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var p=0;p<a.shape.length;++p){var d=a.shape[p],f=r.shape[p];if(null!=d&&null!=f&&d!==f)throw new da("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=xa(e),i=!0,o=(0,ra.Z)(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof no)){i=!1;break}}}catch(l){o.e(l)}finally{o.f()}var s,u=!0,c=(0,ra.Z)(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof no){u=!1;break}}}catch(l){c.e(l)}finally{c.f()}if(i===u)throw new da("Arguments to apply() must be all SymbolicTensors or all Tensors");return Xa(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=(0,ra.Z)(xa(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(l){o.e(l)}finally{o.f()}n.build(ba(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,p=n.call(e,t),d=xa(p),f=[],h=(0,ra.Z)(d);try{for(h.s();!(c=h.n()).done;){var m=c.value;-1!==a.indexOf(m)&&(m=m.clone()),f.push(m)}}catch(l){h.e(l)}finally{h.f()}if(p=ba(f),null!=n.activityRegularizer)throw new fa("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}var v,g=function(e){e=xa(e);var t,n=[],r=(0,ra.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(l){r.e(l)}finally{r.f()}return ba(n)}(e),y=n.computeOutputShape(g),b="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?g[0]:g),v=null!=y&&y.length>0&&Array.isArray(y[0])?y.map((function(r,a){return new no(b,r,n,xa(e),t,n.name,a)})):new no(b,y,n,xa(e),t,n.name),n.addInboundNode(e,v,null,null,g,y,t),n._refCount++,null!=n.activityRegularizer)throw new fa("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new la("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var e,t=[],n=(0,ra.Z)(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(o){n.e(o)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new la("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}},{key:"countParams",value:function(){if(!this.built)throw new pa("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return Yi(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return $i(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;(0,l.tidy)((function(){var n=t.weights;if(n.length!==e.length)throw new da('You called setWeights(weights) on layer "'.concat(t.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(n.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0!==n.length){for(var r=[],a=$i(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!l.util.arraysEqual(o.shape,u.shape))throw new da("Layer weight shape ".concat(o.shape," ")+"not compatible with provided weight shape ".concat(u.shape));r.push([s,u])}eo(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new da("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():ji("zeros"));var u=r.apply(t,n),c=new Ji(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=xa(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,(0,Qn.Z)(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=xa(e);t=xa(t),n=xa(n),r=xa(r),a=qi(a),i=qi(i);var u,c=[],l=[],p=[],d=(0,ra.Z)(s);try{for(d.s();!(u=d.n()).done;){var f=u.value;c.push(f.sourceLayer),l.push(f.nodeIndex),p.push(f.tensorIndex)}}catch(m){d.e(m)}finally{d.f()}new ao({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:p,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(l.serialization.Serializable);function so(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=so(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]),u=(0,ra.Z)(s);try{for(u.s();!(o=u.n()).done;){var c=o.value;-1===a.indexOf(c)&&a.push(c)}}catch(l){u.e(l)}finally{u.f()}}return a}var uo=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:La("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new da("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new da("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new da("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new no(r.dtype,r.batchInputShape,(0,oa.Z)(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new ao({outboundLayer:(0,oa.Z)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){throw new da("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(oo);function co(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new da("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new uo({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}uo.className="InputLayer",l.serialization.registerClass(uo);var lo=function(){function e(t){if((0,aa.Z)(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=(0,ra.Z)(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(o){a.e(o)}finally{a.f()}}}return(0,ia.Z)(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new da("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return(0,l.cast)(t,e.dtype)}catch(n){throw new da("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof no){if(null==this.id2Value[e.id])throw new da("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new da("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof no){if(null==this.id2Value[e.id])throw new da("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new da("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&(0,l.dispose)(this.id2Mask)}}]),e}(),po=new ma,fo=new ma;function ho(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],p=t.names(),d=(0,ra.Z)(u);try{for(d.s();!(a=d.n()).done;){var f=a.value;-1!==p.indexOf(f)?c.push(t.getValue(f)):c.push(null)}}catch(L){d.e(L)}finally{d.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var h,m=u.join(",")+"|"+t.names().sort().join(","),v=po.get(m);if(null==v){var g=function(e,t){l.util.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=vo(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=(0,ra.Z)(e);try{for(s.s();!(i=s.n()).done;){var u,c=vo(i.value,t),p=c.sorted,d=c.recipientMap,f=(0,ra.Z)(p);try{for(f.s();!(u=f.n()).done;){var h=u.value;o.has(h.name)||(n.push(h),o.add(h.name))}}catch(L){f.e(L)}finally{f.f()}var m=function(e){null==r[e]&&(r[e]=new Set),d[e].forEach((function(t){return r[e].add(t)}))};for(var v in d)m(v)}}catch(L){s.e(L)}finally{s.f()}}return{sorted:n,recipientCounts:mo(r)}}(s,t);v=g.sorted,h=g.recipientCounts,po.put(m,v),fo.put(m,h)}h={},i||Object.assign(h,fo.get(m));for(var y=new lo(t),b=0;b<v.length;++b){if(null!=r){var x=(0,l.memory)().numTensors;x>r.maxNumTensors&&(r.maxNumTensors=x),x<r.minNumTensors&&(r.minNumTensors=x)}var k=v[b],w=k.sourceLayer;if(!(w instanceof uo)){var S,I=[],N=[],T=[],C=!1,E=(0,ra.Z)(k.inputs);try{for(E.s();!(S=E.n()).done;){var _=S.value,A=y.getValue(_),R=y.getMask(_);I.push(A),N.push(R),null!=R&&(C=!0),i||(h[_.name]--,0!==h[_.name]||t.hasKey(_)||-1!==u.indexOf(_.name)||A.isDisposed||!0===_.sourceLayer.stateful||T.push(A))}}catch(L){E.e(L)}finally{E.f()}C&&((n=n||{}).mask=N[0]);var F=xa(w.apply(I,n)),D=null;w.supportsMasking&&(D=w.computeMask(I,N));for(var Z=go(k),O=Array.isArray(Z)?Z:[Z],M=0;M<O.length;++M){y.hasKey(O[M])||y.add(O[M],F[M],Array.isArray(D)?D[0]:D);var z=u.indexOf(O[M].name);-1!==z&&(c[z]=F[M])}i||(0,l.dispose)(T)}}return y.disposeMasks(),o?c:c[0]}function mo(e){var t={};for(var n in e)t[n]=e[n].size;return t}function vo(e,t){var n,r=new Set,a=[],i={},o=(0,ra.Z)(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(m){o.e(m)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var p=c[c.length-1]===u.length-1;if(0===l.inputs.length||p)u.pop(),a.push(l),r.add(l.name),p&&c.pop();else{c.push(u.length-1);var d,f=(0,ra.Z)(l.inputs);try{for(f.s();!(d=f.n()).done;){var h=d.value;null==i[h.name]&&(i[h.name]=new Set),i[h.name].add(l.name),r.has(h.name)||u.push(h)}}catch(m){f.e(m)}finally{f.f()}}}}return{sorted:a,recipientMap:i}}function go(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=(0,ra.Z)(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(o){i.e(o)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function yo(e,t){return(0,l.tidy)((function(){return l.sqrt(l.sum(l.mul(e,e),t,!0))}))}(0,l.env)().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=po&&po.setMaxEntries(e),null!=fo&&fo.setMaxEntries(e)}));var bo=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"getConfig",value:function(){return{}}}]),n}(l.serialization.Serializable),xo=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,ia.Z)(n,[{key:"apply",value:function(e){var t=this;return(0,l.tidy)((function(){var n=yo(e,t.axis),r=l.clipByValue(n,0,t.maxValue);return l.mul(e,l.div(r,l.add(ii(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(bo);xo.className="MaxNorm",l.serialization.registerClass(xo);var ko=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,ia.Z)(n,[{key:"apply",value:function(e){var t=this;return(0,l.tidy)((function(){return l.div(e,l.add(ii(),yo(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(bo);ko.className="UnitNorm",l.serialization.registerClass(ko);var wo=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return l.relu(e)}}]),n}(bo);wo.className="NonNeg",l.serialization.registerClass(wo);var So=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,ia.Z)(n,[{key:"apply",value:function(e){var t=this;return(0,l.tidy)((function(){var n=yo(e,t.axis),r=l.add(l.mul(t.rate,l.clipByValue(n,t.minValue,t.maxValue)),l.mul(1-t.rate,n));return l.mul(e,l.div(r,l.add(ii(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(bo);So.className="MinMaxNorm",l.serialization.registerClass(So);var Io={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function No(e){return Ia(e)}function To(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ta(e,l.serialization.SerializationMap.getMap().classNameMap,t,"constraint")}function Co(e){return null==e?null:"string"===typeof e?To({className:e in Io?Io[e]:e,config:{}}):e instanceof bo?e:To(e)}function Eo(e){return new xo(e)}function _o(e){return new ko(e)}function Ao(){return new wo}function Ro(e){return new So(e)}function Fo(){return new Ci}function Do(){return new Ei}function Zo(e){return new _i(e)}function Oo(e){return new Ai(e)}function Mo(e){return new Ri(e)}function zo(e){return new Fi(e)}function Lo(e){return new Di(e)}function Po(e){return new Zi(e)}function Bo(e){return new Oi(e)}function Wo(e){return new Mi(e)}function Vo(e){return new zi(e)}function Uo(e){return new Li(e)}function Go(e){return new Pi(e)}function jo(e){return new Bi(e)}function Ho(e){return new Wi(e)}var qo,Ko=n(4165),Xo=n(5861);function Yo(e){return Qo.apply(this,arguments)}function Qo(){return(Qo=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n,r,a,i,o,s,u,c;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!==typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=12;break}return e.next=9,Promise.all(n);case 9:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];(0,l.dispose)(a);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jo(e){if(null!=e)for(var t in e){var n=e[t];"number"!==typeof n&&n.dispose()}}!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(qo||(qo={}));var $o=function(){function e(){(0,aa.Z)(this,e),this.validationData=null}return(0,ia.Z)(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),es=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,aa.Z)(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return(0,ia.Z)(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=(0,ra.Z)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=(0,ra.Z)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,ra.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,ra.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,ra.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,ra.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n,r,a;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=(0,ra.Z)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n,r,a;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=(0,ra.Z)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ts=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.call(this)}return(0,ia.Z)(n,[{key:"onEpochBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i,o=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=function(e){var t=n[e];if("number"===typeof t)o.totals.hasOwnProperty(e)||(o.totals[e]=0),o.totals[e]=o.totals[e]+t*r;else{var a;e in o.totals?a=o.totals[e]:o.totals[e]=0;var i=(0,l.tidy)((function(){return(0,l.add)(o.totals[e],(0,l.mul)(t,r))}));o.totals[e]=i,null!=a&&a.dispose()}},n)a(i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i,o=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=19;break}r=(0,ra.Z)(this.params.metrics),e.prev=2,i=function(){var e=a.value;if(null==o.totals[e])return"continue";"number"===typeof o.totals[e]?n[e]=o.totals[e]/o.seen:(0,l.tidy)((function(){var t=(0,l.mul)((0,l.div)(1,o.seen),o.totals[e]);n[e]=t,o.totals[e].dispose(),(0,l.keep)(n[e])}))},r.s();case 5:if((a=r.n()).done){e.next=11;break}if("continue"!==i()){e.next=9;break}return e.abrupt("continue",9);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}($o),ns=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"onTrainBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a,i,o,s,u,c;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!==typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=6,Promise.all(t);case 6:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}($o),rs=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;if((0,aa.Z)(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||l.nextFrame,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return l.util.isNumber(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():l.util.now();return function(){var i=null!=n?n():l.util.now();return i-a<t?r:(a=i,r=e.apply(void 0,arguments))}}(a.maybeWait.bind((0,oa.Z)(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,a}return(0,ia.Z)(n,[{key:"maybeWait",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n,r){var a;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],null==this.yield){e.next=5;break}return e.next=4,Yo(r);case 4:a.push(this.yield(t,n,r));case 5:return a.push(this.nextFrameFunc()),e.next=8,Promise.all(a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,null==this.epochBegin){e.next=6;break}return e.next=4,Yo(n);case 4:return e.next=6,this.epochBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.epochEnd){e.next=5;break}return e.next=4,Yo(n);case 4:r.push(this.epochEnd(t,n));case 5:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.batchBegin){e.next=5;break}return e.next=3,Yo(n);case 3:return e.next=5,this.batchBegin(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.batchEnd){e.next=5;break}return e.next=4,Yo(n);case 4:r.push(this.batchEnd(t,n));case 5:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):l.util.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainBegin){e.next=5;break}return e.next=3,Yo(t);case 3:return e.next=5,this.trainBegin(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainEnd){e.next=5;break}return e.next=3,Yo(t);case 3:return e.next=5,this.trainEnd(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}($o);function as(e,t){return null==e&&(e={}),e instanceof $o?[e]:Array.isArray(e)&&e[0]instanceof $o?e:xa(e).map((function(e){return new rs(e,t)}))}var is=function(){function e(){(0,aa.Z)(this,e)}return(0,ia.Z)(e,null,[{key:"registerCallbackConstructor",value:function(t,n){l.util.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors){e.constructors[+n].forEach((function(e){if(e===t)throw new da("Duplicate callback constructor.")}))}}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,(0,Qn.Z)(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function os(e,t,n,r,a,i,o,s,u){var c=new ns,l=[new ts].concat((0,Qn.Z)(is.createCallbacks(t)));null!=e&&l.push.apply(l,(0,Qn.Z)(e)),l.push(c);var p=new es(l);return p.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:p,history:c}}is.constructors={};var ss=n(1752),us=n(1120);function cs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ta(e,l.serialization.SerializationMap.getMap().classNameMap,t,"layer",n)}function ls(e,t){return(0,l.tidy)((function(){"float32"!==e.dtype&&(e=l.cast(e,"float32"));var n=l.sum(yi(e),t,!0),r=l.fill(n.shape,ii()),a=l.sqrt(l.maximum(n,r));return l.div(e,a)}))}function ps(e,t){return(0,l.tidy)((function(){return l.mean(yi(l.sub(t,e)),-1)}))}function ds(e,t){return(0,l.tidy)((function(){return l.mean(l.abs(l.sub(t,e)),-1)}))}function fs(e,t){return(0,l.tidy)((function(){var n=l.sub(e,t),r=l.clipByValue(l.abs(e),ii(),Number.MAX_VALUE),a=l.abs(l.div(n,r));return l.mul(100,l.mean(a,-1))}))}function hs(e,t){return(0,l.tidy)((function(){var n=l.clipByValue(t,ii(),Number.MAX_VALUE),r=l.log(l.add(1,n)),a=l.clipByValue(e,ii(),Number.MAX_VALUE),i=l.log(l.add(1,a));return l.mean(yi(l.sub(r,i)),-1)}))}function ms(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,l.tidy)((function(){if(n)t=l.softmax(t);else{var r=l.sum(t,t.shape.length-1,!0);t=l.div(t,r)}return t=l.clipByValue(t,ii(),1-ii()),l.neg(l.sum(l.mul(l.cast(e,"float32"),l.log(t)),t.shape.length-1))}))}function vs(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,l.tidy)((function(){var r=l.cast(l.floor(ui(e)),"int32"),a=(t=l.clipByValue(t,ii(),1-ii())).shape;return ms(l.reshape(l.oneHot(r,a[a.length-1]),a),t,n)}))}function gs(e,t){return(0,l.tidy)((function(){var n;return n=l.clipByValue(t,ii(),1-ii()),n=l.log(l.div(n,l.sub(1,n))),l.mean(function(e,t){if(!l.util.arraysEqual(e.shape,t.shape))throw new da("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return(0,l.tidy)((function(){var n=l.relu(t),r=l.neg(l.abs(t));return l.add(l.sub(n,l.mul(t,e)),l.log1p(l.exp(r)))}))}(e,n),-1)}))}function ys(e,t){return(0,l.tidy)((function(){var n=l.clipByValue(e,ii(),1),r=l.clipByValue(t,ii(),1);return l.sum(l.mul(e,l.log(l.div(n,r))),-1)}))}function bs(e,t){return(0,l.tidy)((function(){var n=ls(e,-1),r=ls(t,-1),a=l.mul(n,r);return l.neg(l.sum(a,-1))}))}var xs={meanSquaredError:ps,meanAbsoluteError:ds,meanAbsolutePercentageError:fs,meanSquaredLogarithmicError:hs,squaredHinge:function(e,t){return(0,l.tidy)((function(){var n=l.maximum(0,l.sub(1,l.mul(e,t)));return l.mean(yi(n),-1)}))},hinge:function(e,t){return(0,l.tidy)((function(){var n=l.maximum(0,l.sub(1,l.mul(e,t)));return l.mean(n,-1)}))},categoricalHinge:function(e,t){return(0,l.tidy)((function(){var n=l.sum(l.mul(e,t),-1),r=l.max(l.mul(l.sub(1,e),t),-1);return l.maximum(0,l.add(1,l.sub(r,n)))}))},logcosh:function(e,t){return(0,l.tidy)((function(){var n=Math.log(2),r=l.sub(t,e),a=l.sub(l.add(r,l.softplus(l.mul(-2,r))),n);return l.mean(a,-1)}))},categoricalCrossentropy:ms,sparseCategoricalCrossentropy:vs,binaryCrossentropy:gs,kullbackLeiblerDivergence:ys,poisson:function(e,t){return(0,l.tidy)((function(){var n=l.log(l.add(ii(),t));return l.mean(l.sub(t,l.mul(e,n)),-1)}))},cosineProximity:bs};function ks(e){if("string"===typeof e){if(e in xs)return xs[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new da(t)}return e}function ws(e,t){return(0,l.tidy)((function(){var n=l.mul(.5,l.onesLike(t)),r=oi(l.greater(t,n),e.dtype);return l.mean(l.equal(e,r),-1)}))}function Ss(e,t){return(0,l.tidy)((function(){return oi(l.equal(l.argMax(e,-1),l.argMax(t,-1)),"float32")}))}function Is(e,t){return(0,l.tidy)((function(){return l.cast(l.sum(l.logicalAnd(l.equal(e,1),l.equal(t,1))),"float32")}))}function Ns(e,t){return(0,l.tidy)((function(){var n=Is(e,t),r=function(e,t){return(0,l.tidy)((function(){return l.cast(l.sum(l.logicalAnd(l.equal(e,0),l.equal(t,1))),"float32")}))}(e,t),a=l.add(n,r);return l.cast(l.where(l.greater(a,0),l.div(n,a),0),"float32")}))}function Ts(e,t){return(0,l.tidy)((function(){var n=Is(e,t),r=function(e,t){return(0,l.tidy)((function(){return l.cast(l.sum(l.logicalAnd(l.equal(e,1),l.equal(t,0))),"float32")}))}(e,t),a=l.add(n,r);return l.cast(l.where(l.greater(a,0),l.div(n,a),0),"float32")}))}function Cs(e,t){return gs(e,t)}function Es(e,t){return e.rank===t.rank&&(e=l.squeeze(e,[e.rank-1])),(t=l.argMax(t,-1)).dtype!==e.dtype&&(t=l.cast(t,e.dtype)),l.cast(l.equal(e,t),"float32")}var _s=ms,As=vs,Rs={binaryAccuracy:ws,categoricalAccuracy:Ss,precision:Ns,categoricalCrossentropy:_s,sparseCategoricalCrossentropy:As,mse:ps,MSE:ps,mae:ds,MAE:ds,mape:fs,MAPE:fs,cosine:bs};function Fs(e){if("string"===typeof e&&e in Rs)return Rs[e];if("string"!==typeof e&&null!=e)return e;throw new da("Unknown metric ".concat(e))}function Ds(e){if(ga(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;for(var t,n=0,r=Object.keys(xs);n<r.length;n++){var a=r[n];if(xs[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(Rs);i<o.length;i++){var s=o[i];if(Rs[s]===e){t=s;break}}return void 0!==t?t:e.name}var Zs=1048576;function Os(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!Ms(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>Zs&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(Zs,"."))}}function Ms(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!==typeof r)return!1;if(!Ms(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=(0,ra.Z)(e);try{for(i.s();!(a=i.n()).done;){if(!Ms(a.value))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function zs(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=Ps(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,(0,Qn.Z)(e.nodesByDepth[s]))}a("_".repeat(t)),Bs(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?Ws(c[l],n,a):Vs(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var p=Ls(e),d=Yi(e.nonTrainableWeights);a("Total params: ".concat(p+d)),a("Trainable params: ".concat(p)),a("Non-trainable params: ".concat(d)),a("_".repeat(t))}function Ls(e){return null!=e.collectedTrainableWeights?Yi(e.collectedTrainableWeights):Yi(e.trainableWeights)}function Ps(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,(0,Qn.Z)(s))}if(t){var u,c=(0,ra.Z)(e.layers);try{for(c.s();!(u=c.n()).done;){var l,p=u.value,d=!1,f=(0,ra.Z)(p.inboundNodes);try{for(f.s();!(l=f.n()).done;){var h=l.value;if(-1!==r.indexOf(h)){if(d){t=!1;break}d=!0}}}catch(m){f.e(m)}finally{f.f()}if(!t)break}}catch(m){c.e(m)}finally{c.f()}}return t}function Bs(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function Ws(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(s){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(s){r="multiple"}var i=e.name,o=e.getClassName();Bs(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function Vs(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(y){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(y){a="multiple"}var o,s=[],u=(0,ra.Z)(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var p=c.inboundLayers[l].name,d=c.nodeIndices[l],f=c.tensorIndices[l];s.push("".concat(p,"[").concat(d,"][").concat(f,"]"))}}}catch(y){u.e(y)}finally{u.f()}var h=e.name,m=e.getClassName(),v=0===s.length?"":s[0];Bs(["".concat(h," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var g=1;g<s.length;++g)Bs(["","","","",s[g]],t,r)}function Us(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function Gs(e,t){if(null===e)return null;if("string"===typeof e)return wa(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];Us(t,a,i)?n.push(i):n.push(Gs(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"===typeof l)o[c]=l;else{var p=wa(c);o[p]=Gs(l,p)}}return o}function js(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return ka(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];Us(t,a,i)?n.push(i):n.push(js(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],p=ka(c);o[p]="name"!==c&&"className"!==c||"string"!==typeof l?js(l,c):l}return o}var Hs="3.19.0",qs=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=La(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],Ea(r.inputs).length!==r.inputs.length)throw new da("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(r.inputs.map((function(e){return e.name}))));Ea(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=(0,ra.Z)(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch(we){o.e(we)}finally{o.f()}var p,d=(0,ra.Z)(r.inputs);try{for(d.s();!(p=d.n()).done;){var f=p.value,h=f.sourceLayer,m=f.nodeIndex,v=f.tensorIndex;ga(0===m,"input layer has >1 nodes"),ga(0===v,"input layer has >1 tensors"),r.inputLayers.push(h),r.inputLayersNodeIndices.push(m),r.inputLayersTensorIndices.push(v)}}catch(we){d.e(we)}finally{d.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var g=0;g<r.inputLayers.length;g++){var y=r.inputLayers[g];if(!(y instanceof uo))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(g," (0-based) originates ")+"from layer type ".concat(y.getClassName(),"."));r.inputNames.push(y.name),r.feedInputShapes.push(y.batchInputShape),r.feedInputNames.push(y.name)}var b,x=(0,ra.Z)(r.outputLayers);try{for(x.s();!(b=x.n()).done;){var k=b.value;r.outputNames.push(k.name)}}catch(we){x.e(we)}finally{x.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var w,S={},I={},N={},T={},C={},E=[],_=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new pa("The tensor ".concat(t.name,' at layer "').concat(o.name,'" ')+"is part of a cycle.");if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in C||(C[o.id]=Object.keys(C).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,p=0;p<l;p++){e(c.inputTensors[p],a,i,c.inboundLayers[p],c.nodeIndices[p],c.tensorIndices[p])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);E.push(c)}},A=[],R=[],F=(0,ra.Z)(r.outputs);try{for(F.s();!(w=F.n()).done;){_(w.value,A,R)}}catch(we){F.e(we)}finally{F.f()}var D,Z=E.slice().reverse(),O=(0,ra.Z)(Z);try{for(O.s();!(D=O.n()).done;){var M=D.value;I[M.id]=M,M.id in S||(S[M.id]=0);var z=S[M.id],L=null==N[M.outboundLayer.id]?0:N[M.outboundLayer.id];z=Math.max(z,L),N[M.outboundLayer.id]=z,T[M.outboundLayer.id]=M.outboundLayer,S[M.id]=z;for(var P=0;P<M.inboundLayers.length;P++){var B=M.inboundLayers[P],W=M.nodeIndices[P],V=B.inboundNodes[W],U=null==S[V.id]?0:S[V.id];S[V.id]=Math.max(z+1,U),I[V.id]=V}}}catch(we){O.e(we)}finally{O.f()}var G={};for(var j in S){var H=S[j];H in G||(G[H]=[]),G[H].push(I[j])}var q={};for(var K in N){var X=N[K];X in q||(q[X]=[]),q[X].push(T[K])}var Y=Object.keys(q).map((function(e){return parseInt(e,10)})).sort(Ca);r.layers=[];var Q,J=(0,ra.Z)(Y);try{for(J.s();!(Q=J.n()).done;){var $=q[Q.value];$.sort((function(e,t){var n=C[e.id],r=C[t.id];return n<r?-1:n>r?1:0}));var ee,te=(0,ra.Z)($);try{for(te.s();!(ee=te.n()).done;){var ne=ee.value;ne instanceof n&&r.internalContainerRefs.push(ne),r.layers.push(ne)}}catch(we){te.e(we)}finally{te.f()}}}catch(we){J.e(we)}finally{J.f()}r.layersByDepth=q,Y=Object.keys(G).map((function(e){return parseInt(e,10)})).sort(Ca);var re,ae=r.inputs.slice(),ie=[],oe=(0,ra.Z)(Y);try{for(oe.s();!(re=oe.n()).done;){var se,ue=re.value,ce=(0,ra.Z)(G[ue]);try{for(ce.s();!(se=ce.n()).done;){var le=se.value,pe=le.outboundLayer;if(null!=pe){var de,fe=(0,ra.Z)(le.inputTensors);try{for(fe.s();!(de=fe.n()).done;){var he=de.value;if(-1===ae.indexOf(he))throw new pa("Graph disconnected: cannot obtain value for tensor ".concat(he)+' at layer "'.concat(pe.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(ie))}}catch(we){fe.e(we)}finally{fe.f()}var me,ve=(0,ra.Z)(le.outputTensors);try{for(ve.s();!(me=ve.n()).done;){var ge=me.value;ae.push(ge)}}catch(we){ve.e(we)}finally{ve.f()}ie.push(pe.name)}}}catch(we){ce.e(we)}finally{ce.f()}}}catch(we){oe.e(we)}finally{oe.f()}r.nodesByDepth=G;var ye,be=r.layers.map((function(e){return e.name})),xe=(0,ra.Z)(be);try{var ke=function(){var e=ye.value,t=be.filter((function(t){return t===e})).length;if(1!==t)throw new pa('The name "'.concat(e,'" is used ').concat(t," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(be))};for(xe.s();!(ye=xe.n()).done;)ke()}catch(we){xe.e(we)}finally{xe.f()}return r.outboundNodes=[],r.inboundNodes=[],new ao({outboundLayer:(0,oa.Z)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return(0,ia.Z)(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=(0,ra.Z)(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(s){n.e(s)}finally{n.f()}var a,i=(0,ra.Z)(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(s){i.e(s)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new da("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=(0,ra.Z)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=(0,ra.Z)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,Qn.Z)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=(0,ra.Z)(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,Qn.Z)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=(0,ra.Z)(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=(0,ra.Z)(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new da("Duplicate weight name: ".concat(c.originalName));r[c.originalName]=c,a++}}catch(g){u.e(g)}finally{u.f()}}}catch(g){i.e(g)}finally{i.f()}var l=[];for(var p in e){var d=p;if(null==r[p]){var f=p.split("/"),h=f.slice(0,-2).concat([f[f.length-1]]);d=h.join("/")}if(null!=r[d])l.push([r[d],e[p]]);else if(n)throw new da("Provided weight data has no target variable: ".concat(p));delete r[d]}if(n){var m=[];for(var v in r)m.push(v);if(m.length>0)throw new da("".concat(m.length," of ").concat(a," weights are not set: ")+"".concat(m))}eo(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(Hs),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=js(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){e=xa(e);for(var r=new lo,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return ho(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return(0,l.tidy)((function(){var r;return e=xa(e),r=null==t?va(null,e.length):xa(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=qi(e);if(t.length!==this.inputLayers.length)throw new da("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Ca);if(o.length>1){var s,u=(0,ra.Z)(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,p=this.nodesByDepth[l],d=(0,ra.Z)(p);try{for(d.s();!(c=d.n()).done;){var f=c.value,h=f.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(h.id)){for(var m=[],v=0;v<f.inboundLayers.length;v++){var g=f.inboundLayers[v],y=f.nodeIndices[v],b=f.tensorIndices[v],x=n["".concat(g.name,"_").concat(y,"_").concat(b)];m.push(x)}for(var k=qi(h.computeOutputShape(ba(m))),w=h.inboundNodes.indexOf(f),S=0;S<k.length;S++){n["".concat(h.name,"_").concat(w,"_").concat(S)]=k[S]}}}}catch(D){d.e(D)}finally{d.f()}}}catch(D){u.e(D)}finally{u.f()}}for(var I=[],N=[],T=0;T<this.outputLayers.length;T++){var C=this.outputLayers[T],E=this.outputLayersNodeIndices[T],_=this.outputLayersTensorIndices[T],A="".concat(C.name,"_").concat(E,"_").concat(_);N.push(A)}for(var R=0;R<N.length;R++){var F=N[R];ga(F in n),I.push(n[F])}return ba(I)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=va(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Ca),c=(0,ra.Z)(u);try{for(c.s();!(s=c.n()).done;){var l,d=s.value,f=this.nodesByDepth[d],h=(0,ra.Z)(f);try{for(h.s();!(l=h.n()).done;){var m,v=l.value,g=v.outboundLayer,y=v.inputTensors,b=v.outputTensors,x=new Array,k=(0,ra.Z)(y);try{for(k.s();!(m=k.n()).done;){var w=m.value;w.id in n&&x.push(n[w.id])}}catch(G){k.e(G)}finally{k.f()}if(x.length===y.length){var S={},I=void 0,N=void 0,T=void 0,C=void 0;if(null!=v.callArgs&&(S=v.callArgs),1===x.length){var E=(0,p.Z)(x[0],2),_=E[0],A=E[1];null==S.mask&&(S.mask=A),T=xa(g.call(_,S)),C=xa(g.computeMask(_,A)),I=[_],N=[A]}else I=x.map((function(e){return e[0]})),N=x.map((function(e){return e[1]})),null==S.mask&&(S.mask=N),T=xa(g.call(I,S)),C=xa(g.computeMask(I,N));if(g.activityRegularizer)throw new fa("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var R=0;R<b.length;++R){var F=b[R],D=T[R],Z=C[R];n[F.id]=[D,Z]}}}}catch(G){h.e(G)}finally{h.f()}}}catch(G){c.e(G)}finally{c.f()}var O,M=[],z=[],L=[],P=(0,ra.Z)(this.outputs);try{for(P.s();!(O=P.n()).done;){var B=O.value;ga(B.id in n,"Could not compute output ".concat(B.name," : ").concat(B.id));var W=(0,p.Z)(n[B.id],2),V=W[0],U=W[1];L.push(V.shape),M.push(V),z.push(U)}}catch(G){P.e(G)}finally{P.f()}return[M,z,L]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=(0,ra.Z)(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new da("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new da("Provide either a layer name or layer index");var n,r=(0,ra.Z)(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(i){r.e(i)}finally{r.f()}throw new da("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return(0,l.tidy)((function(){var t,r=[],a=(0,ra.Z)(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,(0,Qn.Z)(i.calculateLosses()))}}catch(u){a.e(u)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=(0,ra.Z)(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var p=o.inboundNodes[l],d=n.nodeKey(o,l),f={};if(this.containerNodes.has(d)){if(p.callArgs)try{JSON.stringify(p.callArgs),f=p.callArgs}catch(O){console.warn("Layer ".concat(o.name," was passed ")+"non-serializable keyword arguments: "+"".concat(p.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),f={}}if(p.inboundLayers.length>0){for(var h=[],m=0;m<p.inboundLayers.length;m++){var v=p.inboundLayers[m],g=p.nodeIndices[m],y=p.tensorIndices[m],b=r[n.nodeKey(v,g)];null==b&&(b=0),h.push([v.name,b,y,f])}c.push(h)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=c,a.push(x)}}catch(O){i.e(O)}finally{i.f()}t.layers=a;for(var k=[],w=0;w<this.inputLayers.length;w++){var S=this.inputLayers[w],I=this.inputLayersNodeIndices[w],N=n.nodeKey(S,I);if(this.containerNodes.has(N)){var T=r[N];null!==T&&void 0!==T||(T=0);var C=this.inputLayersTensorIndices[w];k.push([S.name,T,C])}}t.inputLayers=k;for(var E=[],_=0;_<this.outputLayers.length;_++){var A=this.outputLayers[_],R=this.outputLayersNodeIndices[_],F=n.nodeKey(A,R);if(this.containerNodes.has(F)){var D=r[F];null!==D&&void 0!==D||(D=0);var Z=this.outputLayersTensorIndices[_];E.push([A.name,D,Z])}}return t.outputLayers=E,t}},{key:"stateful",get:function(){if(this._stateful)throw new da("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=(0,ra.Z)(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;(0,l.tidy)((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=(0,ra.Z)(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],p=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var d=r[c];if(d.inboundNodes.length<=l)return void i(e,t);var f=d.inboundNodes[l];o.push(f.outputTensors[p])}}catch(h){s.e(h)}finally{s.f()}o.length>0&&e.apply(ba(o),n)}function s(e){var a=e.name,o=cs(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new da("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,p=(0,ra.Z)(l);try{for(p.s();!(u=p.n()).done;){var d=u.value;s(d)}}catch(W){p.e(W)}finally{p.f()}for(;!_a(a);){var f,h=(0,ra.Z)(l);try{for(h.s();!(f=h.n()).done;){var m=f.value,v=r[m.name];if(v.name in a){var g=a[v.name];delete a[v.name];var y,b=(0,ra.Z)(g);try{for(b.s();!(y=b.n()).done;){var x=y.value;o(v,x)}}catch(W){b.e(W)}finally{b.f()}}}}catch(W){h.e(W)}finally{h.f()}}var k,w=[],S=[],I=t.inputLayers,N=(0,ra.Z)(I);try{for(N.s();!(k=N.n()).done;){var T=k.value,C=T[0],E=T[1],_=T[2];ga(C in r);var A=r[C],R=A.inboundNodes[E].outputTensors;w.push(R[_])}}catch(W){N.e(W)}finally{N.f()}var F,D=t.outputLayers,Z=(0,ra.Z)(D);try{for(Z.s();!(F=Z.n()).done;){var O=F.value,M=O[0],z=O[1],L=O[2];ga(M in r);var P=r[M],B=P.inboundNodes[z].outputTensors;S.push(B[L])}}catch(W){Z.e(W)}finally{Z.f()}return new e({inputs:w,outputs:S,name:c})}}]),n}(oo);function Ks(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function Xs(e,t){return Ks(e,t,"classWeight")}function Ys(e,t,n,r){return Qs.apply(this,arguments)}function Qs(){return(Qs=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n,r,a){var i,o,s;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=15;break}return i=(0,l.tidy)((function(){if(1===t.shape.length)return(0,l.clone)(t);if(2===t.shape.length){if(t.shape[1]>1){return(0,l.argMax)(t,1)}if(1===t.shape[1])return(0,l.reshape)(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),(0,l.dispose)(i),s=[],o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");s.push(r[e])})),e.abrupt("return",(0,l.tensor1d)(s,"float32"));case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Js(e,t){return(0,l.mul)(e,t)}function $s(e,t){var n,r,a=t;n=a.xs,r=a.ys,l.util.assert(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)}));var i=eu("input",e.inputNames,n),o=eu("output",e.outputNames,r),s=i[0].shape[0];l.util.assert(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")})),l.util.assert(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){l.util.assert(i[t].shape[0]===s,(function(){return"Batch size mismatch: input "+"".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var p=function(t){l.util.assert(o[t].shape[0]===s,(function(){return"Batch size mismatch: output "+"".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},d=0;d<o.length;d++)p(d);return{xs:i,ys:o}}function eu(e,t,n){if(n instanceof l.Tensor)return[n];if(Array.isArray(n))return l.util.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=(0,ra.Z)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new da("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(s){i.e(s)}finally{i.f()}return a}function tu(e){if(3===e.length)throw new fa("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function nu(e,t,n){return ru.apply(this,arguments)}function ru(){return ru=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,p,d,f,h,m,v,g,y,b,x,k,w,S,I,N,T,C,E,_,A,R,F,D,Z,O,M,z;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,l.util.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),l.util.assert(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),l.util.assert(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(r.epochs)})),l.util.assert(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(r.batchesPerEpoch)})),l.util.assert(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=8;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 8:return t.isTraining=!0,e.prev=9,(i=null!=r.validationData)&&(iu(r.validationData)?l.util.assert(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(r.validationBatches)})):(u=tu(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),p=t.getDedupedMetricsNames(),d=i?p.slice().concat(p.map((function(e){return"val_"+e}))):p.slice(),f=as(r.callbacks,r.yieldEvery),h=null==r.verbose?1:r.verbose,m=os(f,h,r.epochs,null,null,au(n,r),null,i,d),v=m.callbackList,g=m.history,v.setModel(t),t.history=g,e.next=22,v.onTrainBegin();case 22:return t.stopTraining_=!1,y=null==r.initialEpoch?0:r.initialEpoch,e.next=26,n.iterator();case 26:b=e.sent;case 27:if(!(y<r.epochs)){e.next=98;break}return x={},e.next=31,v.onEpochBegin(y);case 31:if(k=0,w=0,a){e.next=37;break}return e.next=36,n.iterator();case 36:b=e.sent;case 37:if(a&&!(k<r.batchesPerEpoch)){e.next=91;break}return e.next=40,b.next();case 40:if(S=e.sent,!a||!S.done){e.next=44;break}return console.warn("You provided `batchesPerEpoch` as "+"".concat(r.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(k," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(r.batchesPerEpoch*r.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("break",91);case 44:if(null==S.value){e.next=73;break}return I=$s(t,S.value),N=I.xs,T=I.ys,(C={}).batch=w,C.size=N[0].shape[0],e.next=51,v.onBatchBegin(w,C);case 51:if(E=[],null==r.classWeight){e.next=64;break}_=Xs(r.classWeight,t.outputNames),A=0;case 55:if(!(A<_.length)){e.next=64;break}return e.t0=E,e.next=59,Ys(T[A],null,_[A]);case 59:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 61:++A,e.next=55;break;case 64:for(R=N.concat(T).concat(E),F=c(R),l.dispose(R),D=0;D<p.length;++D)Z=p[D],O=F[D],C[Z]=O,l.keep(O);return e.next=70,v.onBatchEnd(w,C);case 70:Jo(C),w++,k++;case 73:if(!(a?k>=r.batchesPerEpoch:S.done)){e.next=87;break}if(!i){e.next=86;break}if(M=void 0,!iu(r.validationData)){e.next=84;break}return e.t2=xa,e.next=80,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 80:e.t3=e.sent,M=(0,e.t2)(e.t3),e.next=85;break;case 84:M=xa(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?32:r.validationBatchSize,verbose:0}));case 85:for(z=0;z<t.metricsNames.length;++z)x["val_".concat(t.metricsNames[z])]=M[z];case 86:return e.abrupt("break",91);case 87:if(!t.stopTraining_){e.next=89;break}return e.abrupt("break",91);case 89:e.next=37;break;case 91:return e.next=93,v.onEpochEnd(y,x);case 93:if(y++,!t.stopTraining_){e.next=96;break}return e.abrupt("break",98);case 96:e.next=27;break;case 98:return e.next=100,v.onTrainEnd();case 100:return e.next=102,t.history.syncData();case 102:return e.abrupt("return",t.history);case 103:return e.prev=103,t.isTraining=!1,e.finish(103);case 106:case"end":return e.stop()}}),e,null,[[9,,103,106]])}))),ru.apply(this,arguments)}function au(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function iu(e){return"function"===typeof e.iterator}function ou(e){return"function"===typeof e.next}function su(e,t,n){return uu.apply(this,arguments)}function uu(){return uu=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,p,d,f;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=6;break}throw new fa("Verbose mode is not implemented yet.");case 6:if(l.util.assert(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(r.batches))})),!ou(n)){e.next=11;break}e.t0=n,e.next=14;break;case 11:return e.next=13,n.iterator();case 13:e.t0=e.sent;case 14:s=e.t0,u=0,c=0,p=(0,Ko.Z)().mark((function e(){var n;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=l.tidy((function(){return n.value&&function(){var e=$s(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),p=l.tidy((function(){return i(s)}));if(l.dispose(s),0===c)for(var d=0;d<p.length;++d)o.push((0,l.scalar)(0));for(var f=s[0].shape[0],h=function(e){var t=p[e],n=o[e];o[e]=l.tidy((function(){return l.add(o[e],l.mul(f,t))})),c>0&&l.dispose(n)},m=0;m<p.length;++m)h(m);l.dispose(p),u+=f,++c}(),o})),!n.done){e.next=7;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(r.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("return","break");case 7:case"end":return e.stop()}}),e)}));case 18:if(a&&!(c<r.batches)){e.next=25;break}return e.delegateYield(p(),"t1",20);case 20:if("break"!==e.t1){e.next=23;break}return e.abrupt("break",25);case 23:e.next=18;break;case 25:for(d=0;d<o.length;++d)f=o[d],o[d]=l.div(o[d],u),l.dispose(f);return e.abrupt("return",ba(o));case 27:case"end":return e.stop()}}),e)}))),uu.apply(this,arguments)}function cu(e){l.util.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function lu(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return ci(e,t,n-t)})):ci(e,t,n-t)}function pu(e,t){return l.tidy((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return pu(e,t)})):gi(e,"int32"===t.dtype?t:l.cast(t,"int32"))}))}function du(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function fu(e,t,n,r,a,i,o,s,u,c,l,p,d,f,h){return hu.apply(this,arguments)}function hu(){return hu=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n,r,a,i,o,s,u,c,p,d,f,h,m,v){var g,y,b,x,k,w,S,I;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i&&(i=32),null==o&&(o=1),null==d&&(d=!0),null==h&&(h=0),g=!1,null!=c&&null!=p&&(g=!0),null==v){e.next=10;break}if(g=!0,null!=m){e.next=10;break}throw new da("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 10:return null!=(y=t.checkNumSamples(r,i,m,"steps_per_epoch"))&&(b=ai(0,y)),null==s&&(s=1),x=os(u,s,o,h,y,m,i,g,f),k=x.callbackList,w=x.history,k.setModel(t),t.history=w,e.next=18,k.onTrainBegin();case 18:t.stopTraining_=!1,S=(0,Ko.Z)().mark((function e(o){var s;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.onEpochBegin(o);case 2:if(s={},null==m){e.next=7;break}throw new fa("stepsPerEpoch mode is not implemented yet.");case 7:return e.delegateYield((0,Ko.Z)().mark((function e(){var o,u,f,h;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==d){e.next=4;break}throw new fa("batch shuffling is not implemneted yet");case 4:d&&l.util.shuffle(b);case 5:o=(0,l.tensor1d)(b),u=du(y,i),f=(0,Ko.Z)().mark((function e(d){var f;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f={},e.next=3,k.onBatchBegin(d,f);case 3:return l.tidy((function(){var e=u[d][0],h=u[d][1],m=ci(o,e,h-e);f.batch=d,f.size=h-e;for(var v=pu(r,m),y=n(v),b=0;b<a.length;++b){var x=a[b],k=y[b];f[x]=k,l.keep(k)}if(d===u.length-1&&g)for(var w=t.testLoop(c,p,i),S=0;S<a.length;++S){var I=a[S],N=w[S];l.keep(N),s["val_"+I]=N}})),e.next=6,k.onBatchEnd(d,f);case 6:if(Jo(f),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),h=0;case 9:if(!(h<u.length)){e.next=17;break}return e.delegateYield(f(h),"t0",11);case 11:if("break"!==e.t0){e.next=14;break}return e.abrupt("break",17);case 14:++h,e.next=9;break;case 17:o.dispose();case 18:case"end":return e.stop()}}),e)}))(),"t0",8);case 8:return e.next=10,k.onEpochEnd(o,s);case 10:if(!t.stopTraining_){e.next=12;break}return e.abrupt("return","break");case 12:case"end":return e.stop()}}),e)})),I=h;case 21:if(!(I<o)){e.next=29;break}return e.delegateYield(S(I),"t0",23);case 23:if("break"!==e.t0){e.next=26;break}return e.abrupt("break",29);case 26:++I,e.next=21;break;case 29:return e.next=31,k.onTrainEnd();case 31:return e.next=33,t.history.syncData();case 33:return e.abrupt("return",t.history);case 34:case"end":return e.stop()}}),e)}))),hu.apply(this,arguments)}function mu(e,t,n){return vu.apply(this,arguments)}function vu(){return vu=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,p,d,f,h,m,v,g,y,b,x,k,w,S,I,N,T,C,E,_,A,R=arguments;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=R.length>3&&void 0!==R[3]?R[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,cu(m=null==a.batchSize?32:a.batchSize),v=!1,e.next=10,t.standardizeUserData(n,r,a.sampleWeight,a.classWeight,v,m);case 10:if(g=e.sent,i=g[0],o=g[1],h=g[2],y=!1,!(null!=a.validationData&&a.validationData.length>0)){e.next=36;break}if(y=!0,2!==a.validationData.length){e.next=22;break}c=a.validationData[0],p=a.validationData[1],e.next=27;break;case 22:if(3!==a.validationData.length){e.next=26;break}throw new fa("validationData including sample weights is not supported yet.");case 26:throw new da("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));case 27:return x=!0,e.next=30,t.standardizeUserData(c,p,null,null,x,m);case 30:k=e.sent,d=k[0],f=k[1],b=d.concat(f),e.next=37;break;case 36:null!=a.validationSplit&&a.validationSplit>0&&a.validationSplit<1?(y=!0,w=Math.floor(i[0].shape[0]*(1-a.validationSplit)),S=i[0].shape[0],d=lu(i,w,S),s=i,i=lu(i,0,w),f=lu(o,w,S),u=o,o=lu(o,0,w),b=d.concat(f)):null!=a.validationSteps&&(y=!0);case 37:return I=i.concat(o).concat(h),t.checkTrainableWeightsConsistency(),N=t.makeTrainFunction(),T=t.getDedupedMetricsNames(),y?(t.makeTestFunction(),C=t.testFunction,E=T.slice().concat(T.map((function(e){return"val_"+e})))):(C=null,b=[],E=T.slice()),_=as(a.callbacks,a.yieldEvery),e.next=45,fu(t,N,I,T,m,a.epochs,a.verbose,_,C,b,a.shuffle,E,a.initialEpoch,null,null);case 45:return A=e.sent,e.abrupt("return",A);case 47:return e.prev=47,t.isTraining=!1,yu(i,n),yu(o,r),yu(s,n),yu(u,r),yu(d,c),yu(f,p),null!=h&&l.dispose(h),e.finish(47);case 57:case"end":return e.stop()}}),e,null,[[4,,47,57]])}))),vu.apply(this,arguments)}function gu(e){var t=[];e instanceof l.Tensor&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(si(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function yu(e,t){if(null!=e){var n=[];if(t instanceof l.Tensor)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof l.Tensor)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function bu(e){return Array.isArray(e)}function xu(e){return!function(e){return e instanceof l.Tensor}(e)&&!bu(e)}function ku(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(bu(e)&&e.length>0)o=!0;else if(xu(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new da("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(xu(e)){r=[];var u,c=(0,ra.Z)(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new da('No data provided for "'.concat(l,'". Need data for each key in: ')+"".concat(t));r.push(e[l])}}catch(v){c.e(v)}finally{c.f()}}else if(bu(e)){if(e.length!==t.length)throw new da("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new da("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=gu(r),null!=n)for(var p=0;p<t.length;++p)if(null!=n[p]){var d=r[p];if(d.shape.length!==n[p].length)throw new da("Error when checking ".concat(i,": expected ").concat(t[p]," ")+"to have ".concat(n[p].length," dimension(s). but got array with ")+"shape ".concat(d.shape));for(var f=0;f<n[p].length;++f)if(0!==f||a){var h=d.shape[f],m=n[p][f];if(null!=m&&m>=0&&h!==m)throw new da("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[p].slice(1,n[p].length),"] ")+"(i.e.,tensor shape [*,".concat(n[p].slice(1,n[p].length),"])")+" but the ".concat(i," received an input with ").concat(d.shape[0])+" examples, each with shape [".concat(d.shape.slice(1,d.shape.length),"]")+" (tensor shape [".concat(d.shape,"])"))}}return r}function wu(e,t,n){var r=Ea(e.map((function(e){return e.shape[0]})));r.sort();var a=Ea(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new da("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new da("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!l.util.arraysEqual(r,a))throw new da("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function Su(e,t,n){for(var r=[ps,gs,ms],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===ms&&1===i.shape[i.shape.length-1])throw new da("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var p=u[l],d=c[l];if(null!=d&&p!==d)throw new da("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function Iu(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new da("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new da("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new da("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new da("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}var Nu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).isTraining=!1,r}return(0,ia.Z)(n,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new da("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");zs(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return l.train.adagrad(.01)},Adadelta:function(){return l.train.adadelta(1,.95,ii())},Adam:function(){return l.train.adam(.001,.9,.999,ii())},Adamax:function(){return l.train.adamax(.002,.9,.999,ii(),0)},RMSProp:function(){return l.train.rmsprop(.001,.9,0,ii())},SGD:function(){return l.train.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new da("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof l.Optimizer))throw new da("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new da("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));var r=e.loss;n=r.map((function(e){return ks(e)}))}else{var a=ks(e.loss);this.outputs.forEach((function(e){n.push(a)}))}else{for(var i in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(i))throw new da('Unknown entry in loss dictionary: "'.concat(i,'". ')+"Only expected the following keys: ".concat(this.outputNames));var o,s=(0,ra.Z)(this.outputNames);try{for(s.s();!(o=s.n()).done;){var u=o.value;null==e.loss[u]&&console.warn('Output "'.concat(u,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(u," during training")),n.push(ks(e.loss[u]))}}catch(v){s.e(v)}finally{s.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var c=0;c<this.outputs.length;++c){var p=this.internalOutputShapes[c],d=this.outputNames[c];this.feedOutputNames.push(d),this.feedOutputShapes.push(p),this.feedLossFns.push(this.lossFunctions[c])}var f=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Xa("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===f.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=(0,ra.Z)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(v){i.e(v)}finally{i.f()}return a}(e.metrics,this.outputNames),m=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};Xa("metric",(function(){for(var e=function(e){if(-1!==f.indexOf(e))return"continue";!function(n){var r,a,i,o,s=(0,ra.Z)(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"===typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===gs?-1!==["accuracy","acc"].indexOf(u)?a=ws:-1!==["crossentropy","ce"].indexOf(u)&&(a=Cs):t.lossFunctions[e]===vs?-1!==["accuracy","acc"].indexOf(u)?a=Es:-1!==["crossentropy","ce"].indexOf(u)&&(a=As):-1!==["accuracy","acc"].indexOf(u)?a=Ss:-1!==["crossentropy","ce"].indexOf(u)&&(a=_s);var l=void 0;-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else{var p=Fs(u);i=p,r=""+Ds(u)}var d=void 0;Xa(r,(function(){d=i})),m(e,r,d)}}catch(v){s.e(v)}finally{s.f()}}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;cu(r);var a=!0,i=this.standardizeUserDataXY(e,t,a,r);try{var o=i[0].concat(i[1]);this.makeTestFunction();var s=this.testFunction,u=this.testLoop(s,o,r,n.verbose,n.steps);return ba(u)}finally{yu(i[0],e),yu(i[1],t)}}},{key:"evaluateDataset",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.makeTestFunction(),e.abrupt("return",su(this,t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new da("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new da("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new da("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new lo;if(e instanceof l.Tensor&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new da("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=(0,ra.Z)(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,p=e[c.name];if(null==p)throw new da("No value is provided for the model's input ".concat(c.name));i.add(c,p)}}catch(f){u.e(f)}finally{u.f()}}var d=ho(a,i);return n?d:d[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=va(null,e.length),r=e.length,a=(0,ra.Z)(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(p){a.e(p)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new da("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return l.tidy((function(){var a=t.checkNumSamples(e);if(r)throw new fa("Verbose predictLoop() is not implemented yet.");for(var i=du(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){l.tidy((function(){var r=i[n][0],a=i[n][1],o=lu(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new lo(s);return ho(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return ba(o.map((function(e){return l.concat(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=gu(e);Iu(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return cu(r),this.predictLoop(n,r)}finally{yu(n,e)}}},{key:"predictOnBatch",value:function(e){Iu(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new pa("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a],o=this.feedLossFns[a];o===vs?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(wu(e=ku(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=ku(t,this.feedOutputNames,r,!1,"target")),Su(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new da("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,d,f,h,m=arguments;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(m.length>4&&void 0!==m[4])||m[4],o=m.length>5?m[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=(0,p.Z)(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(d=null,null==a){e.next=19;break}f=Xs(a,this.outputNames),d=[],h=0;case 10:if(!(h<f.length)){e.next=19;break}return e.t0=d,e.next=14,Ys(l[h],null,f[h]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++h,e.next=10;break;case 19:return e.abrupt("return",[c,l,d]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return l.tidy((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new fa("Verbose mode is not implemented yet.");if(null!=i)throw new fa("steps mode in testLoop() is not implemented yet");for(var u=du(o,n),c=(0,l.tensor1d)(ai(0,o)),p=0;p<u.length;++p){var d=u[p][0],f=u[p][1],h=ci(c,d,f-d),m=pu(t,h),v=e(m);if(0===p)for(var g=0;g<v.length;++g)s.push((0,l.scalar)(0));for(var y=0;y<v.length;++y){var b=v[y];s[y]=l.add(s[y],l.mul(f-d,b))}}for(var x=0;x<s.length;++x)s[x]=l.div(s[x],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(ya(e,r)>1){var i=ya(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new lo(t),p=ho(e.outputs,c,{training:!0}),d=0;d<e.lossFunctions.length;++d){var f=(0,e.lossFunctions[d])(a[d],p[d]);null!=i[d]&&(f=Js(f,i[d]));var h=l.mean(f);n.push(h),u=0===d?f:l.add(u,f)}for(var m=0;m<e.metricsTensors.length;++m){var v=void 0;if(e.outputs.length>1&&m<e.outputs.length)v=n[m];else{var g=e.metricsTensors[m][0],y=e.metricsTensors[m][1];v=l.mean(g(a[y],p[y]))}l.keep(v),o.push(v)}return u=l.mean(u),e.calculateLosses().forEach((function(e){u=l.add(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return l.tidy((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new lo(o),c=ho(e.outputs,u),p=0;p<e.lossFunctions.length;++p){var d=e.lossFunctions[p],f=l.mean(d(i[p],c[p]));n=0===p?f:l.add(n,f),r.push(n)}for(var h=0;h<e.metricsTensors.length;++h){var m=e.metricsTensors[h][0],v=e.metricsTensors[h][1],g=l.mean(m(i[v],c[v]));r.push(g)}return r}))}}},{key:"fit",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a=arguments;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",mu(this,t,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",nu(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,p,d,f;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction(),s=o(a.concat(i)),u=[],c=(0,ra.Z)(s),e.prev=9,c.s();case 11:if((p=c.n()).done){e.next=19;break}return d=p.value,e.next=15,d.data();case 15:f=e.sent,u.push(f[0]);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),c.e(e.t0);case 24:return e.prev=24,c.f(),e.finish(24);case 27:return l.dispose(s),yu(r[0],t),yu(r[1],n),e.abrupt("return",ba(u));case 31:case"end":return e.stop()}}),e,this,[[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=l.memory().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-l.memory().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"===typeof this.loss)e=ka(this.loss);else if(Array.isArray(this.loss)){var t,n=(0,ra.Z)(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!==typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(u){n.e(u)}finally{n.f()}e=this.loss.map((function(e){return ka(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!==typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=ka(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[ka(Ds(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return ka(Ds(e))}));var e={};for(var t in this.metrics)e[t]=ka(Ds(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=cs(Gs(e.optimizer_config));if("string"===typeof e.loss)t=wa(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return wa(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=wa(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return wa(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=wa(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,p,d;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}if(0!==(r=l.io.getSaveHandlers(t)).length){e.next=6;break}throw new da("Cannot find any save handlers for URL '".concat(t,"'"));case 6:if(!(r.length>1)){e.next=8;break}throw new da("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(t,"'"));case 8:t=r[0];case 9:if(null!=t.save){e.next=11;break}throw new da("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.next=13,l.io.encodeWeights(this.getNamedWeights(n));case 13:if(a=e.sent,!1,null,i=this.toJSON(null,false),o={modelTopology:i,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(Hs),convertedBy:null},!(null!=n&&n.includeOptimizer)||null==this.optimizer){e.next=34;break}return o.trainingConfig=this.getTrainingConfig(),u="optimizer",e.t0=l.io,e.next=25,this.optimizer.getWeights();case 25:return e.t1=e.sent,e.t2=u,e.next=29,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 29:c=e.sent,p=c.data,d=c.specs,(s=a.specs).push.apply(s,(0,Qn.Z)(d)),a.data=l.io.concatenateArrayBuffers([a.data,p]);case 34:return null!=this.userDefinedMetadata&&(!0,Os(this.userDefinedMetadata,this.name,true),o.userDefinedMetadata=this.userDefinedMetadata),o.weightData=a.data,o.weightSpecs=a.specs,e.abrupt("return",t.save(o));case 38:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){Os(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),n}(qs);Nu.className="Model",l.serialization.registerClass(Nu);var Tu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n)}(Nu);function Cu(e,t){return Eu.apply(this,arguments)}function Eu(){return Eu=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,p;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("modelTopology"in t||(t={modelTopology:t}),null!=(r=t.modelTopology).model_config&&(r=r.model_config),a=Gs(r),i=cs(a,n),null==t.weightsManifest){e.next=15;break}return e.next=9,l.io.loadWeights(t.weightsManifest,t.pathPrefix,i.weights.map((function(e){return e.originalName})));case 9:o=e.sent,s={},u=(0,ra.Z)(i.weights);try{for(u.s();!(c=u.n()).done;)p=c.value,s[p.originalName]=o[p.originalName]}catch(d){u.e(d)}finally{u.f()}i.loadWeights(s),(0,l.dispose)(o);case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}}),e)}))),Eu.apply(this,arguments)}function _u(){return(_u=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!==typeof t){e.next=10;break}if(0!==(r=l.io.getLoadHandlers(t,n)).length){e.next=7;break}r.push(l.io.browserHTTPRequest(t,n)),e.next=9;break;case 7:if(!(r.length>1)){e.next=9;break}throw new da("Found more than one (".concat(r.length,") load handlers for ")+"URL '".concat(t,"'"));case 9:t=r[0];case 10:return e.abrupt("return",Au(t,void 0,n));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Au(e,t,n){return Ru.apply(this,arguments)}function Ru(){return Ru=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,p,d,f;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=3;break}throw new da("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 3:return e.next=5,t.load();case 5:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,s=null!=a.weightData&&null!=a.weightSpecs&&o,u=cs(Gs(i),n,s),null!=(c=a.trainingConfig)&&u.loadTrainingConfig(c),null!=a.userDefinedMetadata&&u.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=24;break}if(null!=a.weightSpecs){e.next=17;break}throw new da("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 17:if(p=Fu(a.weightData,a.weightSpecs),d=p.modelWeights,f=p.optimizerWeights,u.loadWeights(d,o),!(null!=u.optimizer&&f.length>0)){e.next=22;break}return e.next=22,u.optimizer.setWeights(f);case 22:(0,l.dispose)(d),(0,l.dispose)(f.map((function(e){return e.tensor})));case 24:return e.abrupt("return",u);case 25:case"end":return e.stop()}}),e)}))),Ru.apply(this,arguments)}function Fu(e,t){var n=l.io.decodeWeights(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}Tu.className="Functional",l.serialization.registerClass(Tu);var Du=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:La("sequential_"),null!=e.layers){var a,i=(0,ra.Z)(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(s){i.e(s)}finally{i.f()}}return r}return(0,ia.Z)(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new da("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof Nu;if(r){if(1!==(t=e).outputs.length)throw new da("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new da("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new da("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=co({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new da("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new da("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=so(this.outputs[0])}this.inboundNodes=[],new ao({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:va(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(Xi(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Nu({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),(0,ss.Z)((0,us.Z)(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),(0,ss.Z)((0,us.Z)(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new pa("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new pa("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a=arguments;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new pa("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new pa("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new da("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new da("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=(0,ra.Z)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(i){n.e(i)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new da("Legacy serialization format not supported yet.");r=t}else l.util.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new fa("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=(0,ra.Z)(r);try{for(u.s();!(s=u.n()).done;){var c=s.value,p=void 0,d=cs(c,p,a);a&&d.setFastWeightInitDuringBuild(!0),o.add(d)}}catch(f){u.e(f)}finally{u.f()}return o}}]),n}(Nu);function Zu(e){return new Nu(e)}function Ou(e){return new Du(e)}function Mu(e,t){return null==t&&(t={}),function(e,t){return _u.apply(this,arguments)}(e,t)}function zu(e){return co(e)}function Lu(e,t){is.registerCallbackConstructor(e,t)}Du.className="Sequential",l.serialization.registerClass(Du);var Pu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"getConfig",value:function(){return{}}}]),n}(l.serialization.Serializable),Bu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return ki(e,t)}}]),n}(Pu);Bu.className="elu",l.serialization.registerClass(Bu);var Wu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return l.selu(e)}}]),n}(Pu);Wu.className="selu",l.serialization.registerClass(Wu);var Vu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return l.relu(e)}}]),n}(Pu);Vu.className="relu",l.serialization.registerClass(Vu);var Uu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return(0,l.tidy)((function(){return l.minimum(6,l.relu(e))}))}}]),n}(Pu);Uu.className="relu6",l.serialization.registerClass(Uu);var Gu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return e}}]),n}(Pu);Gu.className="linear",l.serialization.registerClass(Gu);var ju=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return l.sigmoid(e)}}]),n}(Pu);ju.className="sigmoid",l.serialization.registerClass(ju);var Hu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return function(e){return(0,l.tidy)((function(){var t=l.add(.5,l.mul(.2,e));return l.clipByValue(t,0,1)}))}(e)}}]),n}(Pu);Hu.className="hardSigmoid",l.serialization.registerClass(Hu);var qu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return l.softplus(e)}}]),n}(Pu);qu.className="softplus",l.serialization.registerClass(qu);var Ku=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return function(e){return(0,l.tidy)((function(){return l.div(e,l.add(l.abs(e),1))}))}(e)}}]),n}(Pu);Ku.className="softsign",l.serialization.registerClass(Ku);var Xu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return l.tanh(e)}}]),n}(Pu);Xu.className="tanh",l.serialization.registerClass(Xu);var Yu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return l.softmax(e,t)}}]),n}(Pu);Yu.className="softmax",l.serialization.registerClass(Yu);var Qu=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return l.logSoftmax(e,t)}}]),n}(Pu);Qu.className="logSoftmax",l.serialization.registerClass(Qu);var Ju=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,l.tidy)((function(){return l.mul(l.sigmoid(l.mul(e,t)),e)}))}}]),n}(Pu);Ju.className="swish",l.serialization.registerClass(Ju);var $u=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e){return(0,l.tidy)((function(){return l.mul(e,l.tanh(l.softplus(e)))}))}}]),n}(Pu);function ec(e){return e.getClassName()}function tc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ta(e,l.serialization.SerializationMap.getMap().classNameMap,t,"activation")}function nc(e){if(null==e){var t={className:"linear",config:{}};return tc(t)}if("string"===typeof e){var n={};return n.className=e,n.config={},tc(n)}return e instanceof Pu?e:tc(e)}function rc(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}$u.className="mish",l.serialization.registerClass($u);var ac=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n)}(l.serialization.Serializable),ic=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this),rc(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return(0,ia.Z)(n,[{key:"apply",value:function(e){var t=this;return(0,l.tidy)((function(){var n=(0,l.zeros)([1]);return t.hasL1&&(n=(0,l.add)(n,(0,l.sum)(l.mul(t.l1,(0,l.abs)(e))))),t.hasL2&&(n=(0,l.add)(n,(0,l.sum)(l.mul(t.l2,yi(e))))),l.reshape(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(ac);ic.className="L1L2",l.serialization.registerClass(ic);var oc={l1l2:"L1L2"};function sc(e){return Ia(e)}function uc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ta(e,l.serialization.SerializationMap.getMap().classNameMap,t,"regularizer")}function cc(e){return null==e?null:"string"===typeof e?uc({className:e in oc?oc[e]:e,config:{}}):e instanceof ac?e:uc(e)}var lc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return(0,ia.Z)(n,[{key:"call",value:function(e,t){e=Ki(e);var n=(0,l.relu)(e);return null!=this.maxValue&&(n=(0,l.clipByValue)(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);lc.className="ReLU",l.serialization.registerClass(lc);var pc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var n=Ki(e);return(0,l.leakyRelu)(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);pc.className="LeakyReLU",l.serialization.registerClass(pc);var dc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=ji(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=cc(e.alphaRegularizer),r.alphaConstraint=Co(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new da("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return r}return(0,ia.Z)(n,[{key:"build",value:function(e){var t=(e=Xi(e)).slice(1);if(null!=this.sharedAxes){var n,r=(0,ra.Z)(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(o){r.e(o)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new to({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=Ki(e),(0,l.prelu)(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:Gi(this.alphaInitializer),alphaRegularizer:sc(this.alphaRegularizer),alphaConstraint:No(this.alphaConstraint),sharedAxes:this.sharedAxes},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);dc.className="PReLU",l.serialization.registerClass(dc);var fc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new fa("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var n=Ki(e);return(0,l.elu)(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);fc.className="ELU",l.serialization.registerClass(fc);var hc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var n=Ki(e);return(0,l.mul)(n,(0,l.cast)((0,l.greater)(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);hc.className="ThresholdedReLU",l.serialization.registerClass(hc);var mc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new Yu).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var n=Ki(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);mc.className="Softmax",l.serialization.registerClass(mc);var vc=n(4942);function gc(e,t,n){if("number"===typeof e)return va(e,t);if(e.length!==t)throw new da("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if((i=a)!==parseInt(i.toString(),10))throw new da("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e;var i}function yc(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(null==e)return e;var i,o=t+(t-1)*(a-1);return i="same"===n?e:e-o+1,Math.floor((i+r-1)/r)}function bc(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+ri([n-t,0]);else{if("same"!==r)throw new da("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function xc(e,t){return(0,l.tidy)((function(){return ja(t),"channelsFirst"===t?l.transpose(e,[0,2,3,1]):e}))}function kc(e,t){return(0,l.tidy)((function(){return ja(t),"channelsFirst"===t?l.transpose(e,[0,2,3,4,1]):e}))}function wc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return(0,l.tidy)((function(){if(null==i&&(i="channelsLast"),ja(i),3!==e.shape.length)throw new da("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new da("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new da("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=l.transpose(e,[0,2,1])),"causal"===a)throw new fa("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=l.conv1d(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=xi(s,n)),s}))}function Sc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return(0,l.tidy)((function(){if(null==i&&(i="channelsLast"),ja(i),3!==e.rank&&4!==e.rank)throw new da("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new da("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));var u=xc(e,i);if("causal"===a)throw new fa("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=l.fused.conv2d({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=l.transpose(u,[0,3,1,2])),u}))}function Ic(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return(0,l.tidy)((function(){if(null==i&&(i="channelsLast"),ja(i),4!==e.rank&&5!==e.rank)throw new da("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new da("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));var s=kc(e,i);if("causal"===a)throw new fa("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=l.conv3d(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=xi(s,n)),"channelsFirst"===i&&(s=l.transpose(s,[0,4,1,2,3])),s}))}var Nc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;if((0,aa.Z)(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,Fa(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new fa("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=gc(r.kernelSize,e,"kernelSize"),a.strides=gc(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,Ha(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,ja(a.dataFormat),a.activation=nc(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=ji(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Co(r.biasConstraint),a.biasRegularizer=cc(r.biasRegularizer),a.activityRegularizer=cc(r.activityRegularizer),a.dilationRate=gc(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new da("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new da("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new da("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)));return a}return(0,ia.Z)(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ec(this.activation),useBias:this.useBias,biasInitializer:Gi(this.biasInitializer),biasRegularizer:sc(this.biasRegularizer),activityRegularizer:sc(this.activityRegularizer),biasConstraint:No(this.biasConstraint)},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(ga("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!Ra(e.kernelSize,"number",1,3))throw new da("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(oo),Tc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,Fa(a.filters,"filters"),a.kernelInitializer=ji(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Co(r.kernelConstraint),a.kernelRegularizer=cc(r.kernelRegularizer),a}return(0,ia.Z)(n,[{key:"build",value:function(e){e=Xi(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new da("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(0,vc.Z)({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var t;e=Ki(e);var r=null==n.bias?null:n.bias.read(),a=Za(n.activation.getClassName());if(null!=a&&2===n.rank)t=Sc(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=wc(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=Sc(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new fa("convolutions greater than 3D are not implemented yet.");t=Ic(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=Xi(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=yc(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:Gi(this.kernelInitializer),kernelRegularizer:sc(this.kernelRegularizer),kernelConstraint:No(this.kernelConstraint)},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new da("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}]),n}(Nc),Cc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return(0,ia.Z)(n,[{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!Ra(e.kernelSize,"number",1,2))throw new da("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Tc);Cc.className="Conv2D",l.serialization.registerClass(Cc);var Ec=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return(0,ia.Z)(n,[{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new da("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Tc);Ec.className="Conv3D",l.serialization.registerClass(Ec);var _c=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),(r=t.call(this,e)).inputSpec=[new to({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new da("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return(0,ia.Z)(n,[{key:"build",value:function(e){if(4!==(e=Xi(e)).length)throw new da("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new da("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new to({ndim:4,axes:(0,vc.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return l.tidy((function(){var t=Ki(e);if(4!==t.shape.length)throw new da("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],p=n.kernelSize[1],d=n.strides[0],f=n.strides[1],h=[o,bc(s,d,c,n.padding),bc(u,f,p,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=l.transpose(t,[0,2,3,1]));var m=l.conv2dTranspose(t,n.kernel.read(),h,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(m=l.transpose(m,[0,3,1,2])),null!=n.bias&&(m=xi(m,n.bias.read(),n.dataFormat)),null!=n.activation&&(m=n.activation.apply(m)),m}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=Xi(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=bc(a[n],s,i,this.padding),a[r]=bc(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(Cc);_c.className="Conv2DTranspose",l.serialization.registerClass(_c);var Ac=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),(r=t.call(this,e)).inputSpec=[new to({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new da("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return(0,ia.Z)(n,[{key:"build",value:function(e){if(5!==(e=Xi(e)).length)throw new da("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new da("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new to({ndim:5,axes:(0,vc.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return l.tidy((function(){var t=Ki(e);if(5!==t.shape.length)throw new da("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],p=o[a],d=n.kernelSize[0],f=n.kernelSize[1],h=n.kernelSize[2],m=n.strides[0],v=n.strides[1],g=n.strides[2],y=[s,bc(u,m,d,n.padding),bc(c,v,f,n.padding),bc(p,g,h,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=l.transpose(t,[0,2,3,4,1]));var b=l.conv3dTranspose(t,n.kernel.read(),y,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(b=l.transpose(b,[0,4,1,2,3])),null!==n.bias&&(b=xi(b,n.bias.read(),n.dataFormat)),null!==n.activation&&(b=n.activation.apply(b)),b}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=Xi(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],p=this.strides[2];return i[t]=this.filters,i[n]=bc(i[n],c,o,this.padding),i[r]=bc(i[r],l,s,this.padding),i[a]=bc(i[a],p,u,this.padding),i}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(Ec);Ac.className="Conv3DTranspose",l.serialization.registerClass(Ac);var Rc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;if((0,aa.Z)(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new da("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new da("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new da("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=ji(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=cc(r.depthwiseRegularizer),a.depthwiseConstraint=Co(r.depthwiseConstraint),a.pointwiseInitializer=ji(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=cc(r.pointwiseRegularizer),a.pointwiseConstraint=Co(r.pointwiseConstraint),a}return(0,ia.Z)(n,[{key:"build",value:function(e){if((e=Xi(e)).length<this.rank+2)throw new da("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new da("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new to({ndim:this.rank+2,axes:(0,vc.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var t;if(e=Ki(e),1===n.rank)throw new fa("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=l.transpose(e,[0,2,3,1])),t=l.separableConv2d(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=xi(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=l.transpose(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Gi(this.depthwiseInitializer),e.pointwiseInitializer=Gi(this.pointwiseInitializer),e.depthwiseRegularizer=sc(this.depthwiseRegularizer),e.pointwiseRegularizer=sc(this.pointwiseRegularizer),e.depthwiseConstraint=No(this.depthwiseConstraint),e.pointwiseConstraint=No(this.pointwiseConstraint),e}}]),n}(Tc);Rc.className="SeparableConv";var Fc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,2,e)}return(0,ia.Z)(n)}(Rc);Fc.className="SeparableConv2D",l.serialization.registerClass(Fc);var Dc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return(0,ia.Z)(n,[{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!Ra(e.kernelSize,"number",1,1))throw new da("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Tc);Dc.className="Conv1D",l.serialization.registerClass(Dc);var Zc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),r=t.call(this,e),"number"===typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){if(e=Ki(e),"channelsLast"===n.dataFormat){var t=pi(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return pi(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=pi(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return pi(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);Zc.className="Cropping2D",l.serialization.registerClass(Zc);var Oc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r,a;return(0,aa.Z)(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,ja(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,a=r.interpolation,Aa(Ba,"InterpolationFormat",a),r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return l.tidy((function(){var t=Ki(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=l.transpose(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?l.image.resizeNearestNeighbor(t,[a,i]):l.image.resizeBilinear(t,[a,i]);return l.transpose(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?l.image.resizeNearestNeighbor(t,[s,u]):l.image.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);Oc.className="UpSampling2D",l.serialization.registerClass(Oc);var Mc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=ji(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=Co(e.depthwiseConstraint),r.depthwiseRegularizer=cc(e.depthwiseRegularizer),r}return(0,ia.Z)(n,[{key:"build",value:function(e){if((e=Xi(e)).length<4)throw new da("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new da("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return(0,l.tidy)((function(){null==a&&(a="channelsLast"),ja(a);var o=xc(e,a);if(4!==e.rank)throw new da("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new da("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=l.depthwiseConv2d(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=l.transpose(o,[0,3,1,2])),o}))}(e=Ki(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=xi(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=Xi(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=yc(t,this.kernelSize[0],this.padding,this.strides[0]),i=yc(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Gi(this.depthwiseInitializer),e.depthwiseRegularizer=sc(this.depthwiseRegularizer),e.depthwiseConstraint=No(this.depthwiseRegularizer),e}}]),n}(Nc);function zc(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new da("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function Lc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return l.tidy((function(){var u=t.shape.length;if(u<3)throw new da("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(ai(2,u));if(t=l.transpose(t,c),null!=i)throw new fa("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=l.cast(l.cast(a,"bool"),"float32")).rank===u-1&&(a=l.expandDims(a,-1)),a=l.transpose(a,c)),r&&(t=l.reverse(t,0),null!=a&&(a=l.reverse(a,0)));var p,d,f=[],h=n,m=t.shape[0],v=l.unstack(t);null!=a&&(d=l.unstack(a));for(var g,y=function(t){var n=v[t],r=l.tidy((function(){return e(n,h)}));if(null==a)p=r[0],h=r[1];else{var i=l.tidy((function(){var e=d[t],n=l.sub(l.onesLike(e),e);return{output:l.add(l.mul(r[0],e),l.mul(h[0],n)),newStates:h.map((function(t,a){return l.add(l.mul(r[1][a],e),l.mul(t,n))}))}}));p=i.output,h=i.newStates}s&&f.push(p)},b=0;b<m;++b)y(b);if(s){g=l.stack(f,1)}return[p,g,h]}))}Mc.className="DepthwiseConv2D",l.serialization.registerClass(Mc);var Pc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r,a;if((0,aa.Z)(this,n),r=t.call(this,e),null==e.cell)throw new da("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new qc({cells:e.cell}):e.cell).stateSize)throw new da("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new to({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return(0,ia.Z)(n,[{key:"getStates",value:function(){return null==this.states_?ai(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){Hi(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=(0,ra.Z)(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(u){o.e(u)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return l.tidy((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new fa("Constants support is not implemented in RNN yet.");Hi(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new to({shape:[t,null].concat((0,Qn.Z)(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!l.util.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new da("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new to({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,l.tidy)((function(){if(!t.stateful)throw new la("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new da("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return l.zeros([r,e])})):t.states_=[l.zeros([r,t.cell.stateSize])];else if(null==e)l.dispose(t.states_),null!=t.keptStates&&(l.dispose(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return l.zeros([r,e])})):t.states_[0]=l.zeros([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new da("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===n?t.keptStates.push(t.states_.slice()):l.dispose(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!l.util.arraysEqual(i.shape,s))throw new da("State ".concat(a," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return l.keep(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=zc(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=(0,ra.Z)(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new to({shape:l.shape}))}}catch(m){c.e(m)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof no){var p=[e].concat(o),d=this.inputSpec.concat(s),f=this.inputSpec;this.inputSpec=d;var h=(0,ss.Z)((0,us.Z)(n.prototype),"apply",this).call(this,p,t);return this.inputSpec=f,h}return(0,ss.Z)((0,us.Z)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=Ki(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new da("RNN Layer has ".concat(o," state(s) but was passed ")+"".concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=Lc((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],p=u[2];n.stateful&&n.resetStates(p,a);var d=n.returnSequences?l:c;return n.returnState?[d].concat(p):d}))}},{key:"getInitialState",value:function(e){var t=this;return(0,l.tidy)((function(){var n=l.zeros(e.shape);return n=si(n=l.sum(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?hi(n,[1,e]):n})):t.cell.stateSize>1?[hi(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){(0,ss.Z)((0,us.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.cell,a=cs(r,n);return new e(Object.assign(t,{cell:a}))}}]),n}(oo);Pc.className="RNN",l.serialization.registerClass(Pc);var Bc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n)}(oo),Wc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Fa(r.units,"units"),r.activation=nc(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=ji(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=ji(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=ji(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=cc(e.kernelRegularizer),r.recurrentRegularizer=cc(e.recurrentRegularizer),r.biasRegularizer=cc(e.biasRegularizer),r.kernelConstraint=Co(e.kernelConstraint),r.recurrentConstraint=Co(e.recurrentConstraint),r.biasConstraint=Co(e.biasConstraint),r.dropout=ni([1,ri([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=ni([1,ri([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,ia.Z)(n,[{key:"build",value:function(e){e=Xi(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){if(2!==e.length)throw new da("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Kc({ones:function(){return l.onesLike(e)},rate:n.dropout,training:i,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Kc({ones:function(){return l.onesLike(r)},rate:n.recurrentDropout,training:i,dropoutFunc:n.dropoutFunc}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=vi(null!=o?l.mul(e,o):e,n.kernel.read()),null!=n.bias&&(a=xi(a,n.bias.read())),null!=s&&(r=l.mul(r,s));var u=l.add(a,vi(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:ec(this.activation),useBias:this.useBias,kernelInitializer:Gi(this.kernelInitializer),recurrentInitializer:Gi(this.recurrentInitializer),biasInitializer:Gi(this.biasInitializer),kernelRegularizer:sc(this.kernelRegularizer),recurrentRegularizer:sc(this.recurrentRegularizer),biasRegularizer:sc(this.biasRegularizer),activityRegularizer:sc(this.activityRegularizer),kernelConstraint:No(this.kernelConstraint),recurrentConstraint:No(this.recurrentConstraint),biasConstraint:No(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}(Bc);Wc.className="SimpleRNNCell",l.serialization.registerClass(Wc);var Vc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),e.cell=new Wc(e),t.call(this,e)}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var r=this;return(0,l.tidy)((function(){null!=r.cell.dropoutMask&&(l.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(l.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return(0,ss.Z)((0,us.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(Pc);Vc.className="SimpleRNN",l.serialization.registerClass(Vc);var Uc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new da("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,Fa(r.units,"units"),r.activation=nc(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=nc(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=ji(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=ji(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=ji(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=cc(e.kernelRegularizer),r.recurrentRegularizer=cc(e.recurrentRegularizer),r.biasRegularizer=cc(e.biasRegularizer),r.kernelConstraint=Co(e.kernelConstraint),r.recurrentConstraint=Co(e.recurrentConstraint),r.biasConstraint=Co(e.biasConstraint),r.dropout=ni([1,ri([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=ni([1,ri([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,ia.Z)(n,[{key:"build",value:function(e){var t=(e=Xi(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){if(2!==e.length)throw new da("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Kc({ones:function(){return l.onesLike(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Kc({ones:function(){return l.onesLike(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=l.mul(e,u[0]));var d=vi(e,n.kernel.read());n.useBias&&(d=xi(d,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=l.mul(a,c[0]));var f=n.recurrentKernel.read(),h=l.split(f,[2*n.units,n.units],f.rank-1),m=(0,p.Z)(h,2),v=m[0],g=m[1],y=vi(a,v),b=l.split(d,3,d.rank-1),x=(0,p.Z)(b,3),k=x[0],w=x[1],S=x[2],I=l.split(y,2,y.rank-1),N=(0,p.Z)(I,2),T=N[0],C=N[1];i=n.recurrentActivation.apply(l.add(k,T)),o=n.recurrentActivation.apply(l.add(w,C));var E=vi(l.mul(o,a),g);s=n.activation.apply(l.add(S,E));var _=l.add(l.mul(i,a),l.mul(l.add(1,l.neg(i)),s));return[_,_]}))}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:ec(this.activation),recurrentActivation:ec(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Gi(this.kernelInitializer),recurrentInitializer:Gi(this.recurrentInitializer),biasInitializer:Gi(this.biasInitializer),kernelRegularizer:sc(this.kernelRegularizer),recurrentRegularizer:sc(this.recurrentRegularizer),biasRegularizer:sc(this.biasRegularizer),activityRegularizer:sc(this.activityRegularizer),kernelConstraint:No(this.kernelConstraint),recurrentConstraint:No(this.recurrentConstraint),biasConstraint:No(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),n}(Bc);Uc.className="GRUCell",l.serialization.registerClass(Uc);var Gc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Uc(e),t.call(this,e)}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var r=this;return(0,l.tidy)((function(){null!=r.cell.dropoutMask&&(l.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(l.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return(0,ss.Z)((0,us.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(Pc);Gc.className="GRU",l.serialization.registerClass(Gc);var jc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Fa(r.units,"units"),r.activation=nc(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=nc(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=ji(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=ji(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=ji(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=cc(e.kernelRegularizer),r.recurrentRegularizer=cc(e.recurrentRegularizer),r.biasRegularizer=cc(e.biasRegularizer),r.kernelConstraint=Co(e.kernelConstraint),r.recurrentConstraint=Co(e.recurrentConstraint),r.biasConstraint=Co(e.biasConstraint),r.dropout=ni([1,ri([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=ni([1,ri([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,ia.Z)(n,[{key:"build",value:function(e){var t,n,r=(e=Xi(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new Ei).apply([i]),o=a.apply([2*i]);return fi(fi(n,r),o)}}]),n}(Ti),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new da("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Kc({ones:function(){return l.onesLike(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Kc({ones:function(){return l.onesLike(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,c,d=n.dropoutMask,f=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=l.mul(e,d[0]));var h=vi(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=l.mul(a,f[0])),h=l.add(h,vi(a,n.recurrentKernel.read())),n.useBias&&(h=xi(h,n.bias.read()));var m=l.split(h,4,h.rank-1),v=(0,p.Z)(m,4),g=v[0],y=v[1],b=v[2],x=v[3];o=n.recurrentActivation.apply(g),s=n.recurrentActivation.apply(y),u=l.add(l.mul(s,i),l.mul(o,n.activation.apply(b))),c=n.recurrentActivation.apply(x);var k=l.mul(c,n.activation.apply(u));return[k,k,u]}))}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:ec(this.activation),recurrentActivation:ec(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Gi(this.kernelInitializer),recurrentInitializer:Gi(this.recurrentInitializer),biasInitializer:Gi(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:sc(this.kernelRegularizer),recurrentRegularizer:sc(this.recurrentRegularizer),biasRegularizer:sc(this.biasRegularizer),activityRegularizer:sc(this.activityRegularizer),kernelConstraint:No(this.kernelConstraint),recurrentConstraint:No(this.recurrentConstraint),biasConstraint:No(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),n}(Bc);jc.className="LSTMCell",l.serialization.registerClass(jc);var Hc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new jc(e),t.call(this,e)}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var r=this;return(0,l.tidy)((function(){null!=r.cell.dropoutMask&&(l.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(l.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return(0,ss.Z)((0,us.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(Pc);Hc.className="LSTM",l.serialization.registerClass(Hc);var qc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).cells=e.cells,r}return(0,ia.Z)(n,[{key:"stateSize",get:function(){var e,t=[],n=(0,ra.Z)(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,(0,Qn.Z)(r.stateSize)):t.push(r.stateSize)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var r,a=e.slice(1),i=[],o=(0,ra.Z)(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(v){o.e(v)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var p=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=p.call(u,t),c.push(u.slice(1))}a=[];var d,f=(0,ra.Z)(c.slice().reverse());try{for(f.s();!(d=f.n()).done;){var h,m=d.value;(h=a).push.apply(h,(0,Qn.Z)(m))}}catch(v){f.e(v)}finally{f.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;Hi(e)&&(e=e[0]),this.cells.forEach((function(n,r){Xa("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign({},e,t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=(0,ra.Z)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,Qn.Z)(r.trainableWeights))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=(0,ra.Z)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,Qn.Z)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=(0,ra.Z)(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,Qn.Z)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=(0,ra.Z)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,Qn.Z)(r.weights))}}catch(a){n.e(a)}finally{n.f()}return $i(t)}},{key:"setWeights",value:function(e){var t,n=[],r=(0,ra.Z)(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(u){r.e(u)}finally{r.f()}eo(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=(0,ra.Z)(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(cs(o,r))}}catch(s){i.e(s)}finally{i.f()}return new e({cells:a})}}]),n}(Bc);function Kc(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):wi(t(),n)},c=function(){return Si(u,t,a)};return!o||o<=1?l.keep(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return l.keep(e.clone())}))}qc.className="StackedRNNCells",l.serialization.registerClass(qc);var Xc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},Yc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),e.unroll)throw new fa("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new fa("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new to({ndim:5})],r}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var r=this;return l.tidy((function(){if(null!=r.cell.dropoutMask&&(l.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(l.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new da("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return(0,ss.Z)((0,us.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat((0,Qn.Z)(t.slice(2)))),this.returnState&&(t=[t].concat((0,Qn.Z)(Array(2).fill([e[0]].concat((0,Qn.Z)(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return l.tidy((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat((0,Qn.Z)(a.slice(2))),o=l.zeros(i);return Array.isArray(n)?Array(n.length).fill(o):[o]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l.tidy((function(){if(!t.stateful)throw new la("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat((0,Qn.Z)(a.slice(2)));if(null==r[0])throw new da("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return l.zeros(i)})):t.states_=[l.zeros(i)];else if(null==e)l.dispose(t.states_),null!=t.keptStates&&(l.dispose(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return l.zeros(i)})):t.states_[0]=l.zeros(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new da("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));n?t.keptStates.push(t.states_.slice()):l.dispose(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!l.util.arraysEqual(s.shape,u))throw new da("State ".concat(o," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return l.keep(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],p=yc(c,a[0],i,o[0],s[0]),d=yc(l,a[1],i,o[1],s[1]);return[].concat((0,Qn.Z)(e.slice(0,2)),(0,Qn.Z)(u?[r,p,d]:[p,d,r]))}}]),n}(Pc);Yc.className="ConvRNN2D";var Qc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;(0,aa.Z)(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign({},e,{units:a}))).filters=a,Fa(r.filters,"filters"),r.kernelSize=gc(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return Fa(e,"kernelSize")})),r.strides=gc(o||1,2,"strides"),r.strides.forEach((function(e){return Fa(e,"strides")})),r.padding=s||"valid",Ha(r.padding),r.dataFormat=u||"channelsLast",ja(r.dataFormat),r.dilationRate=gc(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return Fa(e,"dilationRate")})),r}return(0,ia.Z)(n,[{key:"build",value:function(e){var t;e=Xi(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new da("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"apply",value:function(e,t){return di([s.apply([u]),l.ones([u]),s.apply([2*u])])}}]),n}(Ti),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return l.tidy((function(){if(3!==e.length)throw new da("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Kc({ones:function(){return l.onesLike(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?l.mul(t[n],e):e},c=u(a,s,0),d=u(a,s,1),f=u(a,s,2),h=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Kc({ones:function(){return l.onesLike(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var m=n.recurrentDropoutMask,v=u(i,m,0),g=u(i,m,1),y=u(i,m,2),b=u(i,m,3),x=l.split(n.kernel.read(),4,3),k=(0,p.Z)(x,4),w=k[0],S=k[1],I=k[2],N=k[3],T=n.useBias?l.split(n.bias.read(),4):[null,null,null,null],C=(0,p.Z)(T,4),E=C[0],_=C[1],A=C[2],R=C[3];c=n.inputConv(c,w,E,n.padding),d=n.inputConv(d,S,_,n.padding),f=n.inputConv(f,I,A,n.padding),h=n.inputConv(h,N,R,n.padding);var F=l.split(n.recurrentKernel.read(),4,3),D=(0,p.Z)(F,4),Z=D[0],O=D[1],M=D[2],z=D[3];v=n.recurrentConv(v,Z),g=n.recurrentConv(g,O),y=n.recurrentConv(y,M),b=n.recurrentConv(b,z);var L=n.recurrentActivation.apply(l.add(c,v)),P=n.recurrentActivation.apply(l.add(d,g)),B=l.add(l.mul(P,o),l.mul(L,n.activation.apply(l.add(f,y)))),W=l.mul(n.recurrentActivation.apply(l.add(h,b)),n.activation.apply(B));return[W,W,B]}))}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t=(e.units,Xc(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,r)}},{key:"inputConv",value:function(e,t,n,r){var a=l.conv2d(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?xi(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return l.conv2d(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(jc);Qc.className="ConvLSTM2DCell",l.serialization.registerClass(Qc);var Jc=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){(0,aa.Z)(this,n);var r=new Qc(e);return t.call(this,Object.assign({},e,{cell:r}))}return(0,ia.Z)(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(Yc);Jc.className="ConvLSTM2D",l.serialization.registerClass(Jc);var $c=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return(0,ia.Z)(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t);var r=Ki(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return Si((function(){return wi(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return(0,ss.Z)((0,us.Z)(n.prototype),"dispose",this).call(this)}}]),n}(oo);$c.className="Dropout",l.serialization.registerClass($c);var el=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return(0,ia.Z)(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}($c);el.className="SpatialDropout1D",l.serialization.registerClass(el);var tl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,Fa(r.units,"units"),r.activation=nc(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=ji(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=ji(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=Co(e.kernelConstraint),r.biasConstraint=Co(e.biasConstraint),r.kernelRegularizer=cc(e.kernelRegularizer),r.biasRegularizer=cc(e.biasRegularizer),r.activityRegularizer=cc(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return(0,ia.Z)(n,[{key:"build",value:function(e){var t=(e=Xi(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(0,vc.Z)({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=Xi(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t);var r,a=Ki(e),i=Za(n.activation.getClassName());return null!=i?r=vi(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=vi(a,n.kernel.read()),null!=n.bias&&(r=xi(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:ec(this.activation),useBias:this.useBias,kernelInitializer:Gi(this.kernelInitializer),biasInitializer:Gi(this.biasInitializer),kernelRegularizer:sc(this.kernelRegularizer),biasRegularizer:sc(this.biasRegularizer),activityRegularizer:sc(this.activityRegularizer),kernelConstraint:No(this.kernelConstraint),biasConstraint:No(this.biasConstraint)},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);tl.className="Dense",l.serialization.registerClass(tl);var nl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){e=Xi(e);var t,n=(0,ra.Z)(e.slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new da('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(r){n.e(r)}finally{n.f()}return[e[0],ti(e,1)]}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t);var r=Ki(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=(0,l.transpose)(r,a)}return function(e){if(e.rank<=1)throw new da("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],ti(e.shape,1)];return l.reshape(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);nl.className="Flatten",l.serialization.registerClass(nl);var rl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=nc(e.activation),r}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t);var r=Ki(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:ec(this.activation)},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);rl.className="Activation",l.serialization.registerClass(rl);var al=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){return e=Ki(e),t=e,r=n.n,(0,l.tidy)((function(){if(2!==t.shape.length)throw new da("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(t.shape.length," tensor."));return hi(si(t,1),[1,r,1])}));var t,r}))}},{key:"getConfig",value:function(){var e={n:this.n},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);al.className="RepeatVector",l.serialization.registerClass(al);var il=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;(0,aa.Z)(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return(0,ia.Z)(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new da("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=ti(e);if(null!==i){if(0===a||u%a!==0)throw new da(n);r[i]=u/a}else if(u!==a)throw new da(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t);var r=Ki(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return(0,l.reshape)(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);il.className="Reshape",l.serialization.registerClass(il);var ol=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));var a=ai(1,e.dims.length+1);if(!l.util.arraysEqual(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new to({ndim:r.dims.length+1})],r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){var t=(e=Xi(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return(0,l.transpose)(Ki(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);ol.className="Permute",l.serialization.registerClass(ol);var sl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=Ki(e);return(0,l.any)((0,l.notEqual)(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t);var r=Ki(e),a=(0,l.any)((0,l.notEqual)(r,n.maskValue),-1,!0);return(0,l.mul)(r,(0,l.cast)(a,r.dtype))}))}}]),n}(oo);sl.className="Masking",l.serialization.registerClass(sl);var ul=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(xa(e.inputLength))}return r.inputDim=e.inputDim,Fa(r.inputDim,"inputDim"),r.outputDim=e.outputDim,Fa(r.outputDim,"outputDim"),r.embeddingsInitializer=ji(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=cc(e.embeddingsRegularizer),r.activityRegularizer=cc(e.activityRegularizer),r.embeddingsConstraint=Co(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,r}return(0,ia.Z)(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return(0,l.tidy)((function(){return n.maskZero?(e=Ki(e),(0,l.notEqual)(e,(0,l.zerosLike)(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=Xi(e),null==this.inputLength)return[].concat((0,Qn.Z)(e),[this.outputDim]);var t=xa(this.inputLength);if(t.length!==e.length-1)throw new da('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new da('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat((0,Qn.Z)(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t);var r=Ki(e);"int32"!==r.dtype&&(r=oi(r,"int32"));var a=gi(n.embeddings.read(),(0,l.reshape)(r,[r.size]));return(0,l.reshape)(a,Xi(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Gi(this.embeddingsInitializer),embeddingsRegularizer:sc(this.embeddingsRegularizer),activityRegularizer:sc(this.activityRegularizer),embeddingsConstraint:No(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);ul.className="Embedding",l.serialization.registerClass(ul);var cl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return(0,ia.Z)(n,[{key:"mergeFunction",value:function(e){throw new fa}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new da("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Xi(e)]),e.length<2)throw new da("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));var t,n=[],r=(0,ra.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(c){r.e(c)}finally{r.f()}if((n=Ea(n)).length>1)throw new da("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===Ea(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=ri(r),o=(0,ra.Z)(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=si(s,1);t.push(s)}}catch(C){o.e(C)}finally{o.f()}return n.mergeFunction(t)}var p,d=!1,f=(0,ra.Z)(e);try{for(f.s();!(p=f.n()).done;){var h=p.value,m=h.rank;if(null==m){var v=h.shape,g=v[0],y=v.slice(1).concat([g]),b=l.reshape(h,[g].concat(ti(v.slice(1))));b=l.transpose(b,[1,0]),b=l.reshape(b,y),t.push(b),d=!0}else if(m>1){var x=ai(1,m).concat([0]);t.push(l.transpose(h,x)),d=!0}else t.push(h)}}catch(C){f.e(C)}finally{f.f()}var k=n.mergeFunction(t),w=k.rank;if(d)if(null==w){var S=k.shape,I=S[S.length-1],N=[I].concat(S.slice(0,S.length-1));k=l.reshape(l.transpose(l.reshape(k,[-1,I]),[1,0]),N)}else if(w>1){var T=[w-1].concat(ai(0,w-1));k=l.transpose(k,T)}return k}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=(0,ra.Z)(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(u){o.e(u)}finally{o.f()}return t=1===(i=Ea(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return l.tidy((function(){if(null==t)return null;if(!Array.isArray(t))throw new da("`mask` should be an Array");if(!Array.isArray(e))throw new da("`inputs` should be an Array");if(t.length!==e.length)throw new da("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:l.expandDims(e,0)})))[0],r=1;r<t.length-1;++r)n=l.logicalAnd(n,t[r]);return n}))}}]),n}(oo),ll=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"mergeFunction",value:function(e){return(0,l.tidy)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=l.add(t,e[n]);return t}))}}]),n}(cl);ll.className="Add",l.serialization.registerClass(ll);var pl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"mergeFunction",value:function(e){return(0,l.tidy)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=l.mul(t,e[n]);return t}))}}]),n}(cl);pl.className="Multiply",l.serialization.registerClass(pl);var dl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"mergeFunction",value:function(e){return(0,l.tidy)((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=l.add(t,e[n]);return l.mul(1/e.length,t)}))}}]),n}(cl);dl.className="Average",l.serialization.registerClass(dl);var fl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"mergeFunction",value:function(e){return(0,l.tidy)((function(){for(var t=e[0],n=1;n<e.length;++n)t=l.maximum(t,e[n]);return t}))}}]),n}(cl);fl.className="Maximum",l.serialization.registerClass(fl);var hl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"mergeFunction",value:function(e){return(0,l.tidy)((function(){for(var t=e[0],n=1;n<e.length;++n)t=l.minimum(t,e[n]);return t}))}}]),n}(cl);hl.className="Minimum",l.serialization.registerClass(hl);var ml=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return(0,ia.Z)(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new da("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=(0,ra.Z)(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(d){r.e(d)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=(0,ra.Z)(a);try{for(c.s();!(s=c.n()).done;){var p=s.value;if(l.util.arraysEqual(p,o)){u=!0;break}}}catch(d){c.e(d)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new da("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return(0,l.tidy)((function(){return di(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new da("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=(0,ra.Z)(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new da("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new da("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new da("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return l.tidy((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(l.cast(l.onesLike(e[i]),"bool")):t[i].rank<e[i].rank?a.push(l.expandDims(t[i],-1)):a.push(t[i]);var o=l.concat(a,n.axis);return l.all(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(cl);function vl(e,t){for(;e<0;)e+=t;return e}ml.className="Concatenate",l.serialization.registerClass(ml);var gl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return(0,ia.Z)(n,[{key:"build",value:function(e){l.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new fa("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new da("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new da("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return vl(t,e[n].shape.length)})):[vl(this.axes,n.shape.length),vl(this.axes,r.shape.length)],this.normalize&&(n=ls(n,t[0]),r=ls(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new fa("batchDot is not implemented for tensors of 4D or higher rank yet");if(l.util.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)})),l.util.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)})),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new fa("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return l.tidy((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=l.reshape(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],p=0;p<n;++p)c.push(1);e=l.reshape(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?l.sum(l.mul(e,t),i[0]):l.sum(l.mul(l.transpose(e,[1,0]),t),i[1]);else{var d=i[0]!==e.shape.length-1,f=i[1]===t.shape.length-1;o=l.matMul(e,t,d,f)}if(n>0){for(var h,m=[],v=h=r>a?r+a-3:r-1;v<h+n;++v)m.push(v);o=l.squeeze(o,m)}return 1===o.shape.length&&(o=l.expandDims(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[vl(this.axes,e.length),vl(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){l.util.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new fa("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(cl);gl.className="Dot",l.serialization.registerClass(gl);var yl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t);var r=Ki(e);return Si((function(){return(0,l.add)(mi(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(oo);yl.className="GaussianNoise",l.serialization.registerClass(yl);var bl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t);var r=Ki(e);if(n.rate>0&&n.rate<1){return Si((function(){var e=Math.sqrt(n.rate/(1-n.rate));return(0,l.mul)(r,mi(r.shape,1,e))}),(function(){return r}),t.training||!1)}return r}))}}]),n}(oo);bl.className="GaussianDropout",l.serialization.registerClass(bl);var xl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return(0,ia.Z)(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||Ki(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return Si((function(){var t=Ki(e),a=-1.7580993408473766,i=(0,l.greaterEqual)((0,l.randomUniform)(r),n.rate);i=oi(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=(0,l.add)((0,l.mul)(t,i),(0,l.mul)((0,l.add)(i,-1),a));return(0,l.add)((0,l.mul)(u,o),s)}),(function(){return Ki(e)}),t.training||!1)}return e}))}}]),n}(oo);function kl(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=l.batchNorm2d(e,t,n,r,a,o);else if(3===e.rank)i=l.batchNorm3d(e,t,n,r,a,o);else{if(4!==e.rank)throw new fa("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=l.batchNorm4d(e,t,n,r,a,o)}return i}function wl(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return(0,l.tidy)((function(){var i=l.moments(e,r),o=i.mean,s=i.variance;return[kl(e,o,s,n,t,a),o,s]}))}function Sl(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return(0,l.tidy)((function(){var i,o=l.moments(e,r),s=o.mean,u=o.variance,c=[],p=(0,ra.Z)(ai(0,e.rank));try{for(p.s();!(i=p.n()).done;){var d=i.value;-1!==r.indexOf(d)?c.push(1):c.push(e.shape[d])}}catch(g){p.e(g)}finally{p.f()}var f=(0,l.reshape)(s,c),h=(0,l.reshape)(u,c),m=null==t?null:(0,l.reshape)(t,c),v=null==n?null:(0,l.reshape)(n,c);return[kl(e,f,h,v,m,a),s,u]}))}xl.className="AlphaDropout",l.serialization.registerClass(xl);var Il=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=ji(e.betaInitializer||"zeros"),r.gammaInitializer=ji(e.gammaInitializer||"ones"),r.movingMeanInitializer=ji(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=ji(e.movingVarianceInitializer||"ones"),r.betaConstraint=Co(e.betaConstraint),r.gammaConstraint=Co(e.gammaConstraint),r.betaRegularizer=cc(e.betaRegularizer),r.gammaRegularizer=cc(e.gammaRegularizer),r}return(0,ia.Z)(n,[{key:"build",value:function(e){e=Xi(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new da("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new to({ndim:e.length,axes:(0,vc.Z)({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var r=null!=t.training&&t.training,a=Ki(e),i=a.shape,o=i.length,s=ai(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=va(1,o);c[u]=i[u];var d=s.slice();d.sort();var f=!l.util.arraysEqual(d,ai(0,o).slice(0,o-1));if(!r)return function(){if(f){var e=(0,l.reshape)(n.movingMean.read(),c),t=(0,l.reshape)(n.movingVariance.read(),c),r=n.center?(0,l.reshape)(n.beta.read(),c):null,i=n.scale?(0,l.reshape)(n.gamma.read(),c):null;return kl(a,e,t,r,i,n.epsilon)}return kl(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var h=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return l.util.arraysEqual(r.slice().sort(),ai(0,e.rank-1))?wl(e,t,n,r,a):Sl(e,t,n,r,a)}(a,n.gamma.read(),n.beta.read(),s,n.epsilon),m=(0,p.Z)(h,3),v=m[0],g=m[1],y=m[2],b=function(e,t,n){l.tidy((function(){var r=1-n,a=e.read(),i=l.mul(l.sub(a,t),r);e.write(l.sub(a,i))}))};return b(n.movingMean,g,n.momentum),b(n.movingVariance,y,n.momentum),v}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Gi(this.betaInitializer),gammaInitializer:Gi(this.gammaInitializer),movingMeanInitializer:Gi(this.movingMeanInitializer),movingVarianceInitializer:Gi(this.movingVarianceInitializer),betaRegularizer:sc(this.betaRegularizer),gammaRegularizer:sc(this.gammaRegularizer),betaConstraint:No(this.betaConstraint),gammaConstraint:No(this.gammaConstraint)},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);Il.className="BatchNormalization",l.serialization.registerClass(Il);var Nl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"===typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(r.axis)));var a,i=(0,ra.Z)(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(r.axis)))}}catch(s){i.e(s)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=ji(e.betaInitializer||"zeros"),r.gammaInitializer=ji(e.gammaInitializer||"ones"),r.betaRegularizer=cc(e.betaRegularizer),r.gammaRegularizer=cc(e.gammaRegularizer),r.supportsMasking=!0,r}return(0,ia.Z)(n,[{key:"build",value:function(e){var t=(e=Xi(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=(0,ra.Z)(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(s){a.e(s)}finally{a.f()}if(this.axis.length!==Ea(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=Ki(e),a=r.shape,i=a.length;return(0,l.tidy)((function(){var e,t=(0,l.moments)(r,n.axis,!0),o=t.mean,s=t.variance,u=va(1,i),c=(0,ra.Z)(n.axis);try{for(c.s();!(e=c.n()).done;){var p=e.value;u[p]=a[p]}}catch(y){c.e(y)}finally{c.f()}for(var d=function(e){return null!=e&&e.shape.length!==i?l.reshape(e,u):e},f=n.scale?d(n.gamma.read()):null,h=n.center?d(n.beta.read()):null,m=[],v=[],g=0;g<i;++g)-1!==n.axis.indexOf(g)?(m.push(a[g]),v.push(1)):(m.push(1),v.push(a[g]));return o=l.tile(o,m),s=l.tile(s,m),null!=f&&(f=l.tile(f,v)),null!=h&&(h=l.tile(h,v)),kl(r,o,s,h,f,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Gi(this.betaInitializer),gammaInitializer:Gi(this.gammaInitializer),betaRegularizer:sc(this.betaRegularizer),gammaRegularizer:sc(this.gammaRegularizer)},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);Nl.className="LayerNormalization",l.serialization.registerClass(Nl);var Tl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new da("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));var a,i;if("number"===typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new da("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new da("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new to({ndim:4})],r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=Xi(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){return t=Ki(e),r=n.padding,a=n.dataFormat,(0,l.tidy)((function(){if(4!==t.rank)throw new da("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(t.rank,"-D tensor."));if(null==r&&(r=[[1,1],[1,1]]),2!==r.length||2!==r[0].length||2!==r[1].length)throw new da("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==a&&(a="channelsLast"),"channelsLast"!==a&&"channelsFirst"!==a)throw new da("Unknown data format: ".concat(a,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var e;return e="channelsFirst"===a?[[0,0],[0,0],r[0],r[1]]:[[0,0],r[0],r[1],[0,0]],l.pad(t,e)}));var t,r,a}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo);function Cl(e,t,n,r,a,i){return(0,l.tidy)((function(){var o;ja(a),qa(i),Ha(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=xc(e,a);var s="same"===r?"same":"valid";return o="max"===i?l.maxPool(e,t,n,s):l.avgPool(e,t,n,s),"channelsFirst"===a&&(o=l.transpose(o,[0,3,1,2])),o}))}function El(e,t,n,r,a,i){return(0,l.tidy)((function(){var o;ja(a),qa(i),Ha(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=kc(e,a);var s="same"===r?"same":"valid";return o="max"===i?l.maxPool3d(e,t,n,s):l.avgPool3d(e,t,n,s),"channelsFirst"===a&&(o=l.transpose(o,[0,4,1,2,3])),o}))}Tl.className="ZeroPadding2D",l.serialization.registerClass(Tl);var _l=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"===typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new da("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(Fa(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"===typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new da("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));r.strides=e.strides}return Fa(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Ha(r.padding),r.inputSpec=[new to({ndim:3})],r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){var t=yc((e=Xi(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){n.invokeCallHook(e,t),e=si(Ki(e),2);var r=n.poolingFunction(Ki(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return l.squeeze(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo),Al=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return ja(a),Ha(r),Cl(e,t,n,r,a,"max")}}]),n}(_l);Al.className="MaxPooling1D",l.serialization.registerClass(Al);var Rl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return ja(a),Ha(r),Cl(e,t,n,r,a,"avg")}}]),n}(_l);Rl.className="AveragePooling1D",l.serialization.registerClass(Rl);var Fl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new da("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return Fa(r.poolSize,"poolSize"),Fa(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,ja(r.dataFormat),Ha(r.padding),r.inputSpec=[new to({ndim:4})],r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){e=Xi(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=yc(t,this.poolSize[0],this.padding,this.strides[0]),n=yc(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){return n.invokeCallHook(e,t),n.poolingFunction(Ki(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo),Dl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return ja(a),Ha(r),Cl(e,t,n,r,a,"max")}}]),n}(Fl);Dl.className="MaxPooling2D",l.serialization.registerClass(Dl);var Zl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return ja(a),Ha(r),Cl(e,t,n,r,a,"avg")}}]),n}(Fl);Zl.className="AveragePooling2D",l.serialization.registerClass(Zl);var Ol=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new da("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return Fa(r.poolSize,"poolSize"),Fa(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,ja(r.dataFormat),Ha(r.padding),r.inputSpec=[new to({ndim:5})],r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){e=Xi(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=yc(t,this.poolSize[0],this.padding,this.strides[0]),n=yc(n,this.poolSize[1],this.padding,this.strides[1]),r=yc(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){return n.invokeCallHook(e,t),n.poolingFunction(Ki(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo),Ml=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return ja(a),Ha(r),El(e,t,n,r,a,"max")}}]),n}(Ol);Ml.className="MaxPooling3D",l.serialization.registerClass(Ml);var zl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e)}return(0,ia.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return ja(a),Ha(r),El(e,t,n,r,a,"avg")}}]),n}(Ol);zl.className="AveragePooling3D",l.serialization.registerClass(zl);var Ll=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).inputSpec=[new to({ndim:3})],r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new fa}}]),n}(oo),Pl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e||{})}return(0,ia.Z)(n,[{key:"call",value:function(e,t){return(0,l.tidy)((function(){var t=Ki(e);return l.mean(t,1)}))}}]),n}(Ll);Pl.className="GlobalAveragePooling1D",l.serialization.registerClass(Pl);var Bl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){return(0,aa.Z)(this,n),t.call(this,e||{})}return(0,ia.Z)(n,[{key:"call",value:function(e,t){return(0,l.tidy)((function(){var t=Ki(e);return l.max(t,1)}))}}]),n}(Ll);Bl.className="GlobalMaxPooling1D",l.serialization.registerClass(Bl);var Wl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,ja(r.dataFormat),r.inputSpec=[new to({ndim:4})],r}return(0,ia.Z)(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new fa}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(oo),Vl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var t=Ki(e);return"channelsLast"===n.dataFormat?l.mean(t,[1,2]):l.mean(t,[2,3])}))}}]),n}(Wl);Vl.className="GlobalAveragePooling2D",l.serialization.registerClass(Vl);var Ul=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var t=Ki(e);return"channelsLast"===n.dataFormat?l.max(t,[1,2]):l.max(t,[2,3])}))}}]),n}(Wl);Ul.className="GlobalMaxPooling2D",l.serialization.registerClass(Ul);var Gl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).layer=e.layer,r}return(0,ia.Z)(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){(0,ss.Z)((0,us.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.layer,a=cs(r,n);delete t.layer;var i={layer:a};return Object.assign(i,t),new e(i)}}]),n}(oo),jl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return(0,ia.Z)(n,[{key:"build",value:function(e){if((e=Xi(e)).length<3)throw new da("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),(0,ss.Z)((0,us.Z)(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=Xi(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){return Lc((function(e,r){return[Ki(n.layer.call(e,t)),[]]}),e=Ki(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(Gl);jl.className="TimeDistributed",l.serialization.registerClass(jl);var Hl=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;(0,aa.Z)(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=cs(i),a.goBackwards=!0!==a.goBackwards;var o,s={};if(s.className=e.layer.getClassName(),s.config=a,r.backwardLayer=cs(s),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,o=r.mergeMode,Aa(Ua,"BidirectionalMergeMode",o),e.weights)throw new fa("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return(0,ia.Z)(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):ba(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=zc(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return(0,ss.Z)((0,us.Z)(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new da("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,(0,Qn.Z)(r));var c=r.map((function(e){return new to({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,(0,Qn.Z)(c))}if(null!=a)throw new fa("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof no,p=0,d=o;p<d.length;p++){if(d[p]instanceof no!==l)throw new da("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var f=[e].concat(o),h=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=h;var v=(0,ss.Z)((0,us.Z)(n.prototype),"apply",this).call(this,f,t);return this.inputSpec=m,v}return(0,ss.Z)((0,us.Z)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return(0,l.tidy)((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=l.reverse(a,1)),"concat"===n.mergeMode?o=di([r,a]):"sum"===n.mergeMode?o=l.add(r,a):"ave"===n.mergeMode?o=l.mul(.5,l.add(r,a)):"mul"===n.mergeMode?o=l.mul(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;Xa(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),Xa(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){(0,ss.Z)((0,us.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=(0,ss.Z)((0,us.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=cs(t.layer);if(delete t.layer,null!=t.numConstants)throw new fa("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(Gl);function ql(e){return new uo(e)}function Kl(e){return new fc(e)}function Xl(e){return new lc(e)}function Yl(e){return new pc(e)}function Ql(e){return new dc(e)}function Jl(e){return new mc(e)}function $l(e){return new hc(e)}function ep(e){return new Dc(e)}function tp(e){return new Cc(e)}function np(e){return new _c(e)}function rp(e){return new Ec(e)}function ap(e){return new Ac(e)}function ip(e){return new Fc(e)}function op(e){return new Zc(e)}function sp(e){return new Oc(e)}function up(e){return new Mc(e)}function cp(e){return new rl(e)}function lp(e){return new tl(e)}function pp(e){return new $c(e)}function dp(e){return new el(e)}function fp(e){return new nl(e)}function hp(e){return new al(e)}function mp(e){return new il(e)}function vp(e){return new ol(e)}function gp(e){return new ul(e)}function yp(e){return new ll(e)}function bp(e){return new dl(e)}function xp(e){return new ml(e)}function kp(e){return new fl(e)}function wp(e){return new hl(e)}function Sp(e){return new pl(e)}function Ip(e){return new gl(e)}function Np(e){return new Il(e)}function Tp(e){return new Nl(e)}function Cp(e){return new Tl(e)}function Ep(e){return new Rl(e)}function _p(e){return Ep(e)}function Ap(e){return Ep(e)}function Rp(e){return new Zl(e)}function Fp(e){return Rp(e)}function Dp(e){return Rp(e)}function Zp(e){return new zl(e)}function Op(e){return Zp(e)}function Mp(e){return Zp(e)}function zp(e){return new Pl(e)}function Lp(e){return new Vl(e)}function Pp(e){return new Bl(e)}function Bp(e){return new Ul(e)}function Wp(e){return new Al(e)}function Vp(e){return new Dl(e)}function Up(e){return new Ml(e)}function Gp(e){return new Gc(e)}function jp(e){return new Uc(e)}function Hp(e){return new Hc(e)}function qp(e){return new jc(e)}function Kp(e){return new Vc(e)}function Xp(e){return new Wc(e)}function Yp(e){return new Jc(e)}function Qp(e){return new Qc(e)}function Jp(e){return new Pc(e)}function $p(e){return new qc(e)}function ed(e){return new Hl(e)}function td(e){return new jl(e)}Hl.className="Bidirectional",l.serialization.registerClass(Hl);var nd=Pp,rd=Bp,ad=Wp,id=Vp;function od(e){return new yl(e)}function sd(e){return new bl(e)}function ud(e){return new xl(e)}function cd(e){return new sl(e)}function ld(e,t){return ws(e,t)}function pd(e,t){return Cs(e,t)}function dd(e,t){return Es(e,t)}function fd(e,t){return Ss(e,t)}function hd(e,t){return _s(e,t)}function md(e,t){return Ns(e,t)}function vd(e,t){return Ts(e,t)}function gd(e,t){return bs(e,t)}function yd(e,t){return ds(e,t)}function bd(e,t){return fs(e,t)}function xd(e,t){return fs(e,t)}function kd(e,t){return fs(e,t)}function wd(e,t){return ps(e,t)}function Sd(e,t){return ps(e,t)}function Id(e,t){return ps(e,t)}function Nd(e){return new ic(e)}function Td(e){return rc(t=e),new ic({l1:null!=t?t.l1:null,l2:0});var t}function Cd(e){return rc(t=e),new ic({l2:null!=t?t.l2:null,l1:0});var t}var Ed=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){var e;return(0,aa.Z)(this,n),(e=t.apply(this,arguments)).model=null,e}return(0,ia.Z)(n,[{key:"setModel",value:function(e){if(!(e instanceof Nu))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}]),n}($o);function _d(e,t){return e<t}function Ad(e,t){return e>t}var Rd=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;if((0,aa.Z)(this,n),r=t.call(this),null==e&&(e={}),e.restoreBestWeights)throw new fa("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=e.monitor||"val_loss",r.minDelta=Math.abs(e.minDelta||0),r.patience=e.patience||0,r.verbose=e.verbose||0,r.mode=e.mode||"auto",r.baseline=e.baseline,-1===["auto","min","max"].indexOf(r.mode)&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. ")+"Falling back to mode 'auto'."),r.mode="auto"),"min"===r.mode?r.monitorFunc=_d:"max"===r.mode||-1!==r.monitor.indexOf("acc")?r.monitorFunc=Ad:r.monitorFunc=_d,r.monitorFunc===_d&&(r.minDelta*=-1),r}return(0,ia.Z)(n,[{key:"onTrainBegin",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===_d?1/0:-1/0;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Yo(n);case 2:if(null!=(r=this.getMonitorValue(n))){e.next=5;break}return e.abrupt("return");case 5:this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMonitorValue",value:function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. ")+"Available metrics are: ".concat(Object.keys(e))),t}}]),n}(Ed);var Fd={earlyStopping:function(e){return new Rd(e)}},Dd=n(2652),Zd=n(6699);function Od(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(Wd(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=e[o],u=Od(s,t,n,r);i[o]=u}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function Md(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ld;return zd(e,t)}function zd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(Wd(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=zd(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function Ld(e){return null===e?null:Wd(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function Pd(e,t){return Bd.apply(this,arguments)}function Bd(){return Bd=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){var r,a,i,o,s,u,c;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Map,Od(t,n,r),a=0,i=Array.from(r.keys());case 3:if(!(a<i.length)){e.next=14;break}if(o=i[a],s=r.get(o),!l.util.isPromise(s)){e.next=11;break}return e.next=9,s;case 9:u=e.sent,r.set(o,u);case 11:a++,e.next=3;break;case 14:return c=Od(t,n,r),e.abrupt("return",c);case 16:case"end":return e.stop()}}),e)}))),Bd.apply(this,arguments)}function Wd(e){var t=!1;l.env().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof n(4977).StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof l.Tensor)&&!(e instanceof Promise)&&!t)}function Vd(e){return function(e,t){return Od(e,t)}(e,Ud)}function Ud(e){return e instanceof l.Tensor?{value:e.clone(),recurse:!1}:Wd(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var Gd=function(){function e(t){if((0,aa.Z)(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return(0,ia.Z)(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=(0,ra.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),jd=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.call(this,n.INITIAL_CAPACITY)}return(0,ia.Z)(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){(0,ss.Z)((0,us.Z)(n.prototype),"isFull",this).call(this)&&this.expand(),(0,ss.Z)((0,us.Z)(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){(0,ss.Z)((0,us.Z)(n.prototype),"isFull",this).call(this)&&this.expand(),(0,ss.Z)((0,us.Z)(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(Gd);function Hd(e){return new Jd(e)}function qd(e){return new $d(e)}function Kd(e,t){return new pf(e,t)}function Xd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yd.FAIL;return new df(e,t)}jd.INITIAL_CAPACITY=32;var Yd,Qd=function(){function e(){(0,aa.Z)(this,e)}return(0,ia.Z)(e,[{key:"toArray",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent,e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent,e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n,r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value),e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new sf(this,e)}},{key:"filter",value:function(e){return new af(this,e)}},{key:"map",value:function(e){return new of(this,e)}},{key:"mapAsync",value:function(e){return new uf(this,e)}},{key:"serialMapAsync",value:function(e){return new uf(this,e).serial()}},{key:"flatmap",value:function(e){return new lf(this,e)}},{key:"forEachAsync",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new rf(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ld,r=this.rowMajorBatch(e,t);return r.map((function(e){return Md(e,n)}))}},{key:"concatenate",value:function(e,t){return new pf(Hd([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new nf(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new tf(this,e)}},{key:"prefetch",value:function(e){return new ff(this,e)}},{key:"shuffle",value:function(e,t){return new hf(this,e,t)}},{key:"serial",value:function(){return new ef(this)}}]),e}(),Jd=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).items=e,r.trav=0,r}return(0,ia.Z)(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],this.trav++,e.abrupt("return",{value:Vd(t),done:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),$d=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).nextFn=e,r}return(0,ia.Z)(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),ef=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),tf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:l.dispose(t.value),e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),nf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++>=this.maxCount)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.abrupt("return",this.upstream.next());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),rf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=12;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=9;break}if(!(this.enableSmallLastBatch&&t.length>0)){e.next=8;break}return e.abrupt("return",{value:t,done:!1});case 8:return e.abrupt("return",{value:null,done:!0});case 9:t.push(n.value),e.next=1;break;case 12:return e.abrupt("return",{value:t,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),af=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=6;break}return e.abrupt("return",t);case 6:l.dispose(t.value),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),of=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=l.tensor_util.getTensorsInContainer(t.value),r=this.transform(t.value),a=l.tensor_util.getTensorsInContainer(r),i=(0,ra.Z)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,l.tensor_util.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),sf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.upstream.next();case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),this.handler(e.t0)){e.next=11;break}return e.abrupt("return",{value:null,done:!0});case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),uf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=l.tensor_util.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=l.tensor_util.getTensorsInContainer(r),i=(0,ra.Z)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,l.tensor_util.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),cf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){var e;return(0,aa.Z)(this,n),(e=t.call(this)).outputQueue=new jd,e.lastRead=Promise.resolve({value:null,done:!1}),e}return(0,ia.Z)(n,[{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),lf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=l.tensor_util.getTensorsInContainer(t.value),r=this.transform(t.value),a=l.tensor_util.getTensorsInContainer(r),this.outputQueue.pushAll(r),i=(0,ra.Z)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,l.tensor_util.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(cf),pf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.readFromChain(this.lastRead),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n,r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=10;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 10:return e.next=12,this.iterator.next();case 12:if(!(r=e.sent).done){e.next=16;break}return this.iterator=null,e.abrupt("return",this.readFromChain(t));case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Qd);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(Yd||(Yd={}));var df=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yd.FAIL;return(0,aa.Z)(this,n),(r=t.call(this)).iterators=e,r.mismatchMode=a,r.count=0,r.currentPromise=null,r}return(0,ia.Z)(n,[{key:"summary",value:function(){return"{".concat("TODO: fill in upstream of zip summaries","} -> Zip")}},{key:"nextState",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n,r,a,i;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e instanceof Qd?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}},e.next=3,t;case 3:return n=0,r=0,e.next=7,Pd(this.iterators,a);case 7:if(i=e.sent,n!==r){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:if(!(r>0)){e.next=16;break}e.t0=this.mismatchMode,e.next=e.t0===Yd.FAIL?14:e.t0===Yd.SHORTEST?15:(e.t0,Yd.LONGEST,16);break;case 14:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case 15:return e.abrupt("return",{value:null,done:!0});case 16:return this.count++,e.abrupt("return",{value:i,done:!1});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentPromise=this.nextState(this.currentPromise),e.abrupt("return",this.currentPromise);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),ff=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new Gd(r),a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(Qd),hf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r,a){var i;return(0,aa.Z)(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=Zd.alea(a||l.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return(0,ia.Z)(n,[{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=14;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=12;break;case 10:return this.refill(),e.abrupt("return",n);case 12:e.next=1;break;case 14:return e.abrupt("return",{value:null,done:!0});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ff),mf=function(){function e(){(0,aa.Z)(this,e),this.size=null}return(0,ia.Z)(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return l.util.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,bf));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return l.tidy((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return vf((0,Xo.Z)((0,Ko.Z)().mark((function n(){return(0,Ko.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return l.tidy((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return vf((0,Xo.Z)((0,Ko.Z)().mark((function n(){return(0,Ko.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return vf((0,Xo.Z)((0,Ko.Z)().mark((function n(){return(0,Ko.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){var r;return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=qd((0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 4:case"end":return e.stop()}}),e)})))),t.abrupt("return",Kd(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=Zd.alea(t||l.util.now().toString());return vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){var i;return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function vf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){(0,sa.Z)(a,n);var r=(0,ua.Z)(a);function a(){var e;return(0,aa.Z)(this,a),(e=r.apply(this,arguments)).size=t,e}return(0,ia.Z)(a,[{key:"iterator",value:function(){var t=(0,Xo.Z)((0,Ko.Z)().mark((function t(){return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(mf))}function gf(e){return vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Hd(e));case 1:case"end":return t.stop()}}),t)}))),e.length)}function yf(e){if(!Wd(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){var n;return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Pd(e,(function(e){if(e instanceof mf)return{value:e.iterator(),recurse:!1};if(Wd(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 2:return n=t.sent,t.abrupt("return",Xd(n,Yd.SHORTEST));case 4:case"end":return t.stop()}}),t)}))),t)}function bf(e){return null===e?null:function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof l.Tensor||l.util.isTypedArray(e);var t}(e[0])?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof l.Tensor?l.stack(e):l.tensor(e)}(e),recurse:!1}:{value:null,recurse:!0}}mf.MAX_BUFFER_SIZE=1e4;var xf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).input=e,r}return(0,ia.Z)(n,[{key:"iterator",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return t=e.sent,n=t.decodeUTF8(),r=n.split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mf),kf='"',wf=Symbol("out"),Sf=Symbol("field"),If=Symbol("quote"),Nf=Symbol("quoteafterquote"),Tf=Symbol("quoteinquote"),Cf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).input=e,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new xf(e),r||(r={}),a.hasHeader=!1!==r.hasHeader,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(l.util.assert(null==r.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return(0,ia.Z)(n,[{key:"columnNames",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.columnNamesValidated){e.next=3;break}return e.next=3,this.setColumnNames();case 3:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setColumnNames",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a,i,o,s=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=7;break}throw new Error("Column names must be provided if there is no header line.");case 7:this.fullColumnNames&&t&&l.util.assert(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}));case 8:if(this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),r=Object.keys(n).filter((function(e){return n[e]>1})),l.util.assert(0===r.length,(function(){return"Duplicate column names found: "+r.toString()})),!this.columnConfigs){e.next=22;break}a=0,i=Object.keys(this.columnConfigs);case 14:if(!(a<i.length)){e.next=22;break}if(o=i[a],-1!==this.fullColumnNames.indexOf(o)){e.next=19;break}throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 19:a++,e.next=14;break;case 22:this.columnNamesValidated=!0;case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"maybeReadHeaderLine",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=14;break}return e.next=3,this.base.iterator();case 3:return t=e.sent,e.next=6,t.next();case 6:if(!(n=e.sent).done){e.next=9;break}throw new Error("No data was found for CSV parsing.");case 9:return r=n.value,a=this.parseRow(r,!1),e.abrupt("return",a);case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"iterator",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.columnNamesValidated){e.next=3;break}return e.next=3,this.setColumnNames();case 3:return e.next=5,this.base.iterator();case 5:return t=e.sent,this.hasHeader&&(t=t.skip(1)),e.abrupt("return",t.map((function(e){return n.makeDataElement(e)})));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":default:u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s)}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=wf,o=0;o<a;o++)switch(i){case wf:switch(e.charAt(o)){case kf:r=o+1,i=If;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=wf;break;default:i=Sf,r=o}break;case Sf:if(e.charAt(o)===this.delimiter)n.push(e.substring(r,o)),i=wf,r=o+1;break;case If:if(e.charAt(o)===kf)i=Nf;break;case Nf:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=wf,r=o+1;break;case kf:i=If;break;default:i=Tf}break;case Tf:if(e.charAt(o)===kf)i=If}if(i===Nf?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),n}(mf),Ef=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;(0,aa.Z)(this,n),(r=t.call(this)).microphoneConfig=e,r.isClosed=!1,r.fftSize=e.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+"2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=e.numFramesPerSpectrogram||43,r.sampleRateHz=e.sampleRateHz,r.columnTruncateLength=e.columnTruncateLength||r.fftSize,r.audioTrackConstraints=e.audioTrackConstraints,r.smoothingTimeConstant=e.smoothingTimeConstant||0,r.includeSpectrogram=!1!==e.includeSpectrogram,r.includeWaveform=!0===e.includeWaveform,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return(0,ia.Z)(n,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: ".concat(e.t0.message));case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,this.sampleRateHz){e.next=17;break}this.sampleRateHz=this.audioContext.sampleRate,e.next=19;break;case 17:if(this.audioContext.sampleRate===this.sampleRateHz){e.next=19;break}throw new Error("Mismatch in sampling rate: "+"Expected: ".concat(this.sampleRateHz,"; ")+"Actual: ".concat(this.audioContext.sampleRate));case 19:return n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),e.abrupt("return");case 27:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a,i;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"capture",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAudioData",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(l.util.sizeFromShape(t));return n.set(e,n.length-e.length),(0,l.tensor)(n,t)}}],[{key:"create",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,r,a=arguments;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},(0,l.env)().get("IS_BROWSER")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return r=new n(t),e.next=6,r.start();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(Qd),_f=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;if((0,aa.Z)(this,n),(a=t.call(this)).webcamVideoElement=e,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=(0,l.tensor1d)([0],"int32"),a.webcamConfig.centerCrop){var i=1*a.webcamConfig.resizeWidth/a.webcamVideoElement.width,o=1*a.webcamConfig.resizeHeight/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,p=o+u;a.cropBox=(0,l.tensor2d)([u,s,p,c],[1,4])}else a.cropBox=(0,l.tensor2d)([0,0,1,1],[1,4]);return a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&l.util.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". ")+"Please provide 'user' or 'environment'"})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: ".concat(e.t0.message),e.t0;case 11:if(this.stream){e.next=13;break}throw new Error("Could not obtain video from webcam.");case 13:try{this.webcamVideoElement.srcObject=this.stream}catch(n){console.log(n),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,e.abrupt("return",new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}})));case 17:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=l.browser.fromPixels(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(e.t0)));case 9:if(!this.resize){e.next=22;break}return e.prev=10,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 14:throw e.prev=14,e.t1=e.catch(10),new Error("Error thrown cropping the video: ".concat(e.t1.message));case 17:return e.prev=17,t.dispose(),e.finish(17);case 20:e.next=23;break;case 22:return e.abrupt("return",{value:t,done:!1});case 23:case"end":return e.stop()}}),e,this,[[2,6],[10,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return(0,l.tidy)((function(){var n,r=(0,l.expandDims)((0,l.cast)(e,"float32"),0),a=(n=l.image.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return(0,l.reshape)(n,a.slice(1))}))}},{key:"capture",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var r,a,i=arguments;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},(0,l.env)().get("IS_BROWSER")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=9;break}if(t=document.createElement("video"),r.resizeWidth&&r.resizeHeight){e.next=7;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 7:t.width=r.resizeWidth,t.height=r.resizeHeight;case 9:return a=new n(t,r),e.next=12,a.start();case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Qd),Af=(0,ia.Z)((function e(){(0,aa.Z)(this,e)})),Rf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"split",value:function(e){return new Ff(this,e)}}]),n}(Qd),Ff=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.impl=new Df(e,r),a}return(0,ia.Z)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Rf),Df=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e,r){var a;return(0,aa.Z)(this,n),(a=t.call(this)).upstream=e,a.separator=r,a.carryover="",a}return(0,ia.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a,i;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=9;break}if(""!==this.carryover){e.next=6;break}return e.abrupt("return",!1);case 6:return this.outputQueue.push(this.carryover),this.carryover="",e.abrupt("return",!0);case 9:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=(0,ra.Z)(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch(o){r.e(o)}finally{r.f()}return this.carryover=n[n.length-1],e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(cf),Zf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){return(0,aa.Z)(this,n),t.apply(this,arguments)}return(0,ia.Z)(n,[{key:"decodeUTF8",value:function(){return new Of(this)}}]),n}(Qd),Of=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r;return(0,aa.Z)(this,n),(r=t.call(this)).upstream=e,r.impl=new Mf(e),r}return(0,ia.Z)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Rf),Mf=function(e){(0,sa.Z)(r,e);var t=(0,ua.Z)(r);function r(e){var a;if((0,aa.Z)(this,r),(a=t.call(this)).upstream=e,(0,l.env)().get("IS_BROWSER"))a.decoder=new TextDecoder("utf-8");else{var i=n(1601).StringDecoder;a.decoder=new i("utf8")}return a}return(0,ia.Z)(r,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Utf8")}},{key:"pump",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=7;break}return e.abrupt("return",!1);case 7:n=t.value;case 8:return r=(0,l.env)().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(r),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(cf),zf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,aa.Z)(this,n),(r=t.call(this)).file=e,r.options=a,l.util.assert(e instanceof Uint8Array||!!(0,l.env)().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=a.offset||0,r.chunkSize=a.chunkSize||1048576,r}return(0,ia.Z)(n,[{key:"summary",value:function(){return"FileChunks ".concat(this.file)}},{key:"next",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=new Promise((function(e,t){var r=n.offset+n.chunkSize;if(n.file instanceof Uint8Array)e(new Uint8Array(n.file.slice(n.offset,r)));else{var a=new FileReader;a.onload=function(n){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return t(new Error("Aborted"))},a.onerror=function(e){return t(new Error(e.type))};var i=n.file.slice(n.offset,r);a.readAsArrayBuffer(i)}n.offset=r})),e.next=5,t;case 5:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Zf);function Lf(e){return Pf.apply(this,arguments)}function Pf(){return Pf=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n,r,a,i,o,s,u=arguments;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2?u[2]:void 0,"string"===typeof t?a=t:(a=t.url,i=Bf(t)),e.next=5,(r||l.util.fetch)(a,i);case 5:if(!(o=e.sent).ok){e.next=15;break}return e.t0=Uint8Array,e.next=10,o.arrayBuffer();case 10:return e.t1=e.sent,s=new e.t0(e.t1),e.abrupt("return",new zf(s,n));case 15:throw new Error(o.statusText);case 16:case"end":return e.stop()}}),e)}))),Pf.apply(this,arguments)}var Bf=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function Wf(e){return"string"===typeof e&&"file://"===e.slice(0,7)}var Vf=function(e){(0,sa.Z)(r,e);var t=(0,ua.Z)(r);function r(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,aa.Z)(this,r),(n=t.call(this)).input=e,n.options=a,n}return(0,ia.Z)(r,[{key:"iterator",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Wf(this.input)&&(0,l.env)().get("IS_NODE")&&(t=n(7792),this.input=t.readFileSync(this.input.slice(7))),e.abrupt("return",new zf(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(Af),Uf=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,aa.Z)(this,n),(r=t.call(this)).url=e,r.fileOptions=a,r}return(0,ia.Z)(n,[{key:"iterator",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Wf(this.url)){e.next=4;break}return e.abrupt("return",new Vf(this.url,this.fileOptions).iterator());case 4:return e.abrupt("return",Lf(this.url,this.fileOptions));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Af);function Gf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Cf(new Uf(e),t)}function jf(e){var t=qd(e);return vf((0,Xo.Z)((0,Ko.Z)().mark((function e(){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}function Hf(e){return vf((0,Xo.Z)((0,Ko.Z)().mark((function t(){var n;return(0,Ko.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",qd((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))}function qf(e,t){return Kf.apply(this,arguments)}function Kf(){return(Kf=(0,Xo.Z)((0,Ko.Z)().mark((function e(t,n){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",_f.create(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xf(e){return Yf.apply(this,arguments)}function Yf(){return(Yf=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ef.create(t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Qf="3.19.0";function Jf(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&l.util.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var $f=l.kernel_impls.whereImpl,eh=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(){var e;return(0,aa.Z)(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new l.DataStorage((0,oa.Z)(e),(0,l.engine)()),e}return(0,ia.Z)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,(0,l.env)().get("IS_NODE")&&l.backend_util.warn("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&l.util.isString(n[0])){var a=n.map((function(e){return l.util.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;if("complex64"===n){var a=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return l.backend_util.mergeRealAndImagArrays(a,i)}return this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return l.util.decodeString(e)}));return(0,l.buffer)(e.shape,e.dtype,n)}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return(0,l.buffer)(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return(0,l.engine)().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e),r=n.complexTensorInfos;null!=r&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n,r;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.util.now(),t(),r=l.util.now()-n,e.abrupt("return",{kernelMs:r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){Jf([e],"where");var t=this.readSync(e.dataId);return $f(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return(0,ss.Z)((0,us.Z)(n.prototype),"epsilon",this).call(this)}}]),n}(l.KernelBackend);eh.nextDataId=0;function th(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(Jf(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,p=l.util.sizeFromShape(s.shape),d=n||s.dtype,f=l.util.getArrayFromDType(d,p),h=0;h<p;++h)f[h]=t(c[h],i);return u.makeTensorInfo(s.shape,d,f)}}function nh(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(Jf(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,p=t(c,l,i);return u.makeTensorInfo(s.shape,l,p)}}(0,l.registerBackend)("cpu",(function(){return new eh}),1);var rh=th(l.Elu,(function(e){return e>=0?e:Math.exp(e)-1})),ah={kernelName:l.Elu,backendName:"cpu",kernelFunc:rh};function ih(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var oh={kernelName:l.Identity,backendName:"cpu",kernelFunc:ih};function sh(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;Jf([a],"leakyRelu");for(var o=l.util.sizeFromShape(a.shape),s=n.data.get(a.dataId).values,u=l.util.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var uh={kernelName:l.LeakyRelu,backendName:"cpu",kernelFunc:sh};function ch(e){return function(t,n,r,a,i){var o=l.backend_util.assertAndGetBroadcastShape(t,n),s=o.length,u=l.util.computeStrides(o),c=l.util.sizeFromShape(o),p=l.util.getTypedArrayFromDType(i,c),d=t.length,f=n.length,h=l.util.computeStrides(t),m=l.util.computeStrides(n),v=l.backend_util.getBroadcastDims(t,o),g=l.backend_util.getBroadcastDims(n,o);if(v.length+g.length===0)for(var y=0;y<p.length;++y)p[y]=e(r[y%r.length],a[y%a.length]);else for(var b=function(t){var n=l.util.indexToLoc(t,s,u),i=n.slice(-d);v.forEach((function(e){return i[e]=0}));var o=l.util.locToIndex(i,d,h),c=n.slice(-f);g.forEach((function(e){return c[e]=0}));var y=l.util.locToIndex(c,f,m);p[t]=e(r[o],a[y])},x=0;x<p.length;++x)b(x);return[p,o]}}var lh=ch((function(e,t){return e<0?t*e:e}));function ph(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;Jf([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=lh(r.shape,a.shape,i,o,"float32"),u=(0,p.Z)(s,2),c=u[0],l=u[1];return n.makeTensorInfo(l,"float32",c)}var dh={kernelName:l.Prelu,backendName:"cpu",kernelFunc:ph},fh=th(l.Relu,(function(e){return Math.max(0,e)})),hh={kernelName:l.Relu,backendName:"cpu",kernelFunc:fh},mh=th(l.Relu6,(function(e){return Math.min(Math.max(0,e),6)})),vh={kernelName:l.Relu6,backendName:"cpu",kernelFunc:mh};function gh(e){return function(t,n,r){for(var a=l.util.getTypedArrayFromDType(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}var yh=gh((function(e){return 1/(1+Math.exp(-e))})),bh=th(l.Sigmoid,(function(e){return 1/(1+Math.exp(-e))})),xh={kernelName:l.Sigmoid,backendName:"cpu",kernelFunc:bh};function kh(e,t,n,r,a){if("linear"===n)return ih({inputs:{x:t},backend:e});if("relu"===n)return fh({inputs:{x:t},backend:e});if("elu"===n)return rh({inputs:{x:t},backend:e});if("relu6"===n)return mh({inputs:{x:t},backend:e});if("prelu"===n)return ph({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return sh({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return bh({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function wh(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var Sh={kernelName:l.Complex,backendName:"cpu",kernelFunc:wh};function Ih(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){var r=Ih(e,t,"float32"),a=Ih(e,t,"float32");return wh({inputs:{real:r,imag:a},backend:e})}var i=l.util.makeZerosTypedArray(l.util.sizeFromShape(t),n);return e.makeTensorInfo(t,n,i)}function Nh(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var Th={kernelName:l.Real,backendName:"cpu",kernelFunc:Nh};function Ch(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return ih({inputs:{x:a},backend:n});var o=Ih(n,a.shape,a.dtype),s=Ch({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=wh({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=Nh({inputs:{input:a},backend:n}),d=Ch({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),d}if(!l.util.hasEncodingLoss(a.dtype,i)){var f=ih({inputs:{x:a},backend:n});return{dataId:f.dataId,shape:f.shape,dtype:i}}if("int32"===i){var h=n.data.get(a.dataId).values,m=Int32Array.from(h);return n.makeTensorInfo(a.shape,"int32",m)}if("bool"===i){var v=n.data.get(a.dataId).values,g=l.util.toTypedArray([0],a.dtype),y=ch((function(e,t){return e!==t?1:0}))(a.shape,[],v,g,"bool"),b=(0,p.Z)(y,2),x=b[0],k=b[1];return n.makeTensorInfo(k,"bool",x)}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var Eh={kernelName:l.Cast,backendName:"cpu",kernelFunc:Ch};function _h(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;Jf([o,s],e);var c=u.data.get(o.dataId).values,d=u.data.get(s.dataId).values,f="string"===o.dtype?l.backend_util.fromUint8ToStringArray(c):c,h="string"===o.dtype?l.backend_util.fromUint8ToStringArray(d):d,m=r||o.dtype,v=t(o.shape,s.shape,f,h,m),g=(0,p.Z)(v,2),y=g[0],b=g[1];return u.makeTensorInfo(b,m,y)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=Ch({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),d=l.complexTensorInfos.real,f=l.complexTensorInfos.imag,h=u.data.get(d.dataId).values,m=u.data.get(f.dataId).values,v=Ch({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),g=u.data.get(v.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,x=u.data.get(y.dataId).values,k=u.data.get(b.dataId).values,w=n(o.shape,s.shape,h,m,x,k),S=(0,p.Z)(w,3),I=S[0],N=S[1],T=S[2],C=u.makeTensorInfo(T,"float32",I),E=u.makeTensorInfo(T,"float32",N),_=wh({inputs:{real:C,imag:E},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(v),u.disposeIntermediateTensorInfo(C),u.disposeIntermediateTensorInfo(E),_}var A=u.data.get(o.dataId).values,R=u.data.get(s.dataId).values,F=r||o.dtype,D=t(o.shape,s.shape,A,R,F),Z=(0,p.Z)(D,2),O=Z[0],M=Z[1];return u.makeTensorInfo(M,F,O)}}function Ah(e){return function(t,n,r,a,i,o){var s=l.backend_util.assertAndGetBroadcastShape(t,n),u=l.util.sizeFromShape(s),c=s.length,p=l.util.computeStrides(s),d=l.util.getTypedArrayFromDType("float32",u),f=l.util.getTypedArrayFromDType("float32",u),h=l.backend_util.getBroadcastDims(t,s),m=l.backend_util.getBroadcastDims(n,s),v=l.backend_util.mergeRealAndImagArrays(r,a),g=l.backend_util.mergeRealAndImagArrays(i,o),y=t.length,b=l.util.computeStrides(t),x=n.length,k=l.util.computeStrides(n);if(h.length+m.length===0)for(var w=0;w<d.length;w++){var S=w%v.length,I=w%g.length,N=e(v[2*S],v[2*S+1],g[2*I],g[2*I+1]);d[w]=N.real,f[w]=N.imag}else for(var T=function(t){var n=l.util.indexToLoc(t,c,p),r=n.slice(-y);h.forEach((function(e){return r[e]=0}));var a=l.util.locToIndex(r,y,b),i=n.slice(-x);m.forEach((function(e){return i[e]=0}));var o=l.util.locToIndex(i,x,k),s=e(v[2*a],v[2*a+1],g[2*o],g[2*o+1]);d[t]=s.real,f[t]=s.imag},C=0;C<d.length;C++)T(C);return[d,f,s]}}var Rh=ch((function(e,t){return e+t})),Fh=Ah((function(e,t,n,r){return{real:e+n,imag:t+r}})),Dh=_h(l.Add,Rh,Fh),Zh={kernelName:l.Add,backendName:"cpu",kernelFunc:Dh};function Oh(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=l.util.sizeFromShape(a.shape),s=l.util.inferFromImplicitShape(i,o),u=l.util.sizeFromShape(s);l.util.assert(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var p=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;p.shape=s,d.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var Mh={kernelName:l.Reshape,backendName:"cpu",kernelFunc:Oh};function zh(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;Jf([a,i],"matMul");var u=a.shape.length,c=i.shape.length,d=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],m=s?i.shape[c-2]:i.shape[c-1],v=a.shape.slice(0,-2),g=i.shape.slice(0,-2),y=l.util.sizeFromShape(v),b=l.util.sizeFromShape(g),x=l.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([h,m]);l.util.assert(d===f,(function(){return"Error in matMul: inner shapes (".concat(d,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")}));for(var k=s?[b,m,f]:[b,f,m],w=Oh({inputs:{x:a},backend:n,attrs:{shape:o?[y,d,h]:[y,h,d]}}),S=Oh({inputs:{x:i},backend:n,attrs:{shape:k}}),I=o?w.shape[1]:w.shape[2],N=o?w.shape[2]:w.shape[1],T=s?S.shape[1]:S.shape[2],C=Math.max(y,b),E=n.data.get(w.dataId).values,_=n.data.get(S.dataId).values,A=l.util.computeStrides(w.shape),R=l.util.computeStrides(S.shape),F=o?[A[0],1,A[1]]:[A[0],A[1],1],D=(0,p.Z)(F,3),Z=D[0],O=D[1],M=D[2],z=s?[1,R[1],R[0]]:[R[1],1,R[0]],L=(0,p.Z)(z,3),P=L[0],B=L[1],W=L[2],V=N*T,U=(0,l.buffer)([C,N,T],w.dtype),G=U.values,j=n.blockSize,H=0;H<C;H++)for(var q=0;q<N;q+=j)for(var K=0;K<T;K+=j)for(var X=0;X<I;X+=j)for(var Y=Math.min(q+j,N),Q=Math.min(K+j,T),J=Math.min(X+j,I),$=q;$<Y;$++)for(var ee=K;ee<Q;ee++){for(var te=0,ne=X;ne<J;ne++){var re=Math.min(H,y-1)*Z,ae=Math.min(H,b-1)*W;te+=E[re+$*O+ne*M]*_[ne*P+ee*B+ae]}G[H*V+($*T+ee)]+=te}return n.disposeIntermediateTensorInfo(w),n.disposeIntermediateTensorInfo(S),n.makeTensorInfo(x,U.dtype,U.values)}var Lh={kernelName:l.BatchMatMul,backendName:"cpu",kernelFunc:zh};var Ph={kernelName:l._FusedMatMul,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,p=o.transposeA,d=o.transposeB,f=o.activation,h=o.leakyreluAlpha,m=[];t=zh({inputs:{a:s,b:u},attrs:{transposeA:p,transposeB:d},backend:i}),c&&(n=Dh({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),f&&(r=kh(i,t,f,l,h),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}};function Bh(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var Wh={kernelName:l.Abs,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;Jf(t,"abs");var r=new Float32Array(l.util.sizeFromShape(t.shape));return r=Bh(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},Vh=th(l.Acos,(function(e){return Math.acos(e)})),Uh={kernelName:l.Acos,backendName:"cpu",kernelFunc:Vh},Gh=th(l.Acosh,(function(e){return Math.acosh(e)})),jh={kernelName:l.Acosh,backendName:"cpu",kernelFunc:Gh};var Hh={kernelName:l.AddN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;Jf(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=(0,l.buffer)(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function qh(e,t,n,r,a){for(var i=t.length,o=l.util.sizeFromShape(t),s=l.util.computeStrides(t),u=l.util.computeStrides(a),c=l.util.getTypedArrayFromDType(n,l.util.sizeFromShape(a)),p=0;p<o;++p){for(var d=l.util.indexToLoc(p,i,s),f=new Array(d.length),h=0;h<f.length;h++)f[h]=d[r[h]];c[l.util.locToIndex(f,i,u)]=e[p]}return c}function Kh(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;Jf(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=qh(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var Xh={kernelName:l.Transpose,backendName:"cpu",kernelFunc:Kh};var Yh={kernelName:l.All,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;Jf(a,"all");var s=l.util.parseAxisParam(i,a.shape),u=s,c=l.backend_util.getAxesPermutation(u,a.shape.length),d=a;null!=c&&(d=Kh({inputs:{x:a},backend:n,attrs:{perm:c}}),u=l.backend_util.getInnerMostAxes(u.length,a.shape.length)),l.backend_util.assertAxesAreInnerMostDims("all",u,d.shape.length);for(var f=l.backend_util.computeOutAndReduceShapes(d.shape,u),h=(0,p.Z)(f,2),m=h[0],v=h[1],g=l.util.sizeFromShape(v),y=l.util.makeZerosTypedArray(l.util.sizeFromShape(m),d.dtype),b=n.data.get(d.dataId).values,x=0;x<y.length;++x){for(var k=x*g,w=b[k],S=0;S<g;++S){var I=b[k+S];w=w&&I}y[x]=w}null!=c&&n.disposeIntermediateTensorInfo(d);var N=n.makeTensorInfo(m,d.dtype,y);if(o){var T=Oh({inputs:{x:N},backend:n,attrs:{shape:l.backend_util.expandShapeToKeepDim(m,s)}});return n.disposeIntermediateTensorInfo(N),T}return N}};var Qh={kernelName:l.Any,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;Jf(a,"any");var s=l.util.parseAxisParam(i,a.shape),u=s,c=l.backend_util.getAxesPermutation(u,a.shape.length),d=a;null!=c&&(d=Kh({inputs:{x:a},backend:n,attrs:{perm:c}}),u=l.backend_util.getInnerMostAxes(u.length,a.shape.length)),l.backend_util.assertAxesAreInnerMostDims("any",u,d.shape.length);for(var f=l.backend_util.computeOutAndReduceShapes(d.shape,u),h=(0,p.Z)(f,2),m=h[0],v=h[1],g=l.util.sizeFromShape(v),y=l.util.makeZerosTypedArray(l.util.sizeFromShape(m),d.dtype),b=n.data.get(d.dataId).values,x=0;x<y.length;++x){for(var k=x*g,w=b[k],S=0;S<g;++S){var I=b[k+S];w=w||I}y[x]=w}null!=c&&n.disposeIntermediateTensorInfo(d);var N=n.makeTensorInfo(m,d.dtype,y);if(o){var T=Oh({inputs:{x:N},backend:n,attrs:{shape:l.backend_util.expandShapeToKeepDim(m,s)}});return n.disposeIntermediateTensorInfo(N),T}return N}};var Jh={kernelName:l.ArgMax,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;Jf(a,"argMax");var o=l.util.parseAxisParam(i,a.shape),s=l.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=Kh({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=l.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],l.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var d=l.backend_util.computeOutAndReduceShapes(u.shape,o),f=(0,p.Z)(d,2),h=f[0],m=f[1],v=l.util.sizeFromShape(h),g=l.util.makeZerosTypedArray(v,"int32"),y=l.util.sizeFromShape(m),b=n.data.get(u.dataId).values,x=0;x<g.length;++x){for(var k=x*y,w=b[k],S=0,I=0;I<y;++I){var N=b[k+I];N>w&&(w=N,S=I)}g[x]=S}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",g)}};var $h={kernelName:l.ArgMin,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;Jf(a,"argMin");var o=l.util.parseAxisParam(i,a.shape),s=l.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=Kh({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=l.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],l.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var d=l.backend_util.computeOutAndReduceShapes(u.shape,o),f=(0,p.Z)(d,2),h=f[0],m=f[1],v=l.util.sizeFromShape(h),g=l.util.makeZerosTypedArray(v,"int32"),y=l.util.sizeFromShape(m),b=n.data.get(u.dataId).values,x=0;x<g.length;++x){for(var k=x*y,w=b[k],S=0,I=0;I<y;++I){var N=b[k+I];N<w&&(w=N,S=I)}g[x]=S}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",g)}},em=th(l.Asin,(function(e){return Math.asin(e)})),tm={kernelName:l.Asin,backendName:"cpu",kernelFunc:em},nm=th(l.Asinh,(function(e){return Math.asinh(e)})),rm={kernelName:l.Asinh,backendName:"cpu",kernelFunc:nm},am=th(l.Atan,(function(e){return Math.atan(e)})),im={kernelName:l.Atan,backendName:"cpu",kernelFunc:am},om=ch((function(e,t){return Math.atan2(e,t)})),sm=_h(l.Atan2,om),um={kernelName:l.Atan2,backendName:"cpu",kernelFunc:sm},cm=th(l.Atanh,(function(e){return Math.atanh(e)})),lm={kernelName:l.Atanh,backendName:"cpu",kernelFunc:cm};function pm(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,p=a.effectiveFilterHeight,d=a.effectiveFilterWidth,f=a.padInfo.top,h=a.padInfo.left,m="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=(0,l.buffer)(a.outShape,n),g=v.values,y=a.outShape[1]*a.outShape[2]*a.outShape[3],b=a.outShape[2]*a.outShape[3],x=a.outShape[3],k=0;k<a.batchSize;++k)for(var w=k*y,S=k*r[0],I=0;I<a.inChannels;++I)for(var N=0;N<a.outHeight;++N)for(var T=N*o-f,C=Math.max(0,T),E=Math.min(a.inHeight,p+T),_=w+N*b,A=0;A<a.outWidth;++A){for(var R=A*s-h,F=Math.max(0,R),D=Math.min(a.inWidth,d+R),Z=m,O=0,M=0,z=C;z<E;z+=u){for(var L=S+z*r[1],P=F;P<D;P+=c){var B=e[L+P*r[2]+I];"max"===i&&B>Z?Z=B:"avg"===i&&(O+=B,M++)}if(isNaN(Z))break}g[_+A*x+I]="avg"===i?O/M:Z}return v}function dm(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=(0,l.buffer)(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,p=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,h=r.padInfo.top,m=r.padInfo.left,v=(0,l.buffer)(t,n,e),g=0;g<r.batchSize;++g)for(var y=0;y<r.inChannels;++y)for(var b=0;b<r.outHeight;++b){for(var x=b*s-h,k=x;k<0;)k+=c;for(var w=Math.min(r.inHeight,d+x),S=0;S<r.outWidth;++S){for(var I=S*u-m,N=I;N<0;)N+=p;for(var T=Math.min(r.inWidth,f+I),C=Number.NEGATIVE_INFINITY,E=-1,_=k;_<w;_+=c)for(var A=_-x,R=N;R<T;R+=p){var F=R-I,D=v.get(g,_,R,y);D>C&&(C=D,E=a?i?((g*r.inHeight+_)*r.inWidth+R)*r.inChannels+y:(_*r.inWidth+R)*r.inChannels+y:A*f+F)}o.set(E,g,b,S,y)}}return o}function fm(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,p=a.dilationHeight,d=a.dilationWidth,f=a.effectiveFilterDepth,h=a.effectiveFilterHeight,m=a.effectiveFilterWidth,v=a.padInfo.front,g=a.padInfo.top,y=a.padInfo.left,b="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=(0,l.buffer)(a.outShape,n),k=x.values,w=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[2]*a.outShape[3]*a.outShape[4],I=a.outShape[3]*a.outShape[4],N=a.outShape[4],T=0;T<a.batchSize;++T)for(var C=T*w,E=T*r[0],_=0;_<a.inChannels;++_)for(var A=0;A<a.outDepth;++A){for(var R=A*o-v,F=R;F<0;)F+=c;for(var D=Math.min(a.inDepth,f+R),Z=C+A*S,O=0;O<a.outHeight;++O){for(var M=O*s-g,z=M;z<0;)z+=p;for(var L=Math.min(a.inHeight,h+M),P=Z+O*I,B=0;B<a.outWidth;++B){for(var W=B*u-y,V=W;V<0;)V+=d;for(var U=Math.min(a.inWidth,m+W),G=P+B*N,j=b,H=0,q=0,K=F;K<D;K+=c){for(var X=E+K*r[1],Y=z;Y<L;Y+=p){for(var Q=X+Y*r[2],J=V;J<U;J+=d){var $=e[Q+J*r[3]+_];if("max"===i&&$>j?j=$:"avg"===i&&(H+=$,q++),isNaN(j))break}if(isNaN(j))break}if(isNaN(j))break}k[G+_]="avg"===i?H/q:j}}}return x}var hm={kernelName:l.AvgPool,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Jf(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;l.util.assert(l.backend_util.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,p=l.backend_util.computePool2DInfo(a.shape,i,o,1,s,u);if(1===p.filterWidth&&1===p.filterHeight&&l.util.arraysEqual(p.inShape,p.outShape))c=ih({inputs:{x:a},backend:n});else{var d=n.data.get(a.dataId).values,f=l.util.computeStrides(a.shape),h=pm(d,a.shape,a.dtype,f,p,"avg");c=n.makeTensorInfo(p.outShape,a.dtype,h.values)}return c}};var mm={kernelName:l.AvgPool3D,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;Jf(a,"avgPool3d");var p=l.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),d=fm(n.data.get(a.dataId).values,a.shape,a.dtype,l.util.computeStrides(a.shape),p,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}};var vm={kernelName:l.AvgPool3DGrad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;Jf([a,i],"avgPool3DGrad");for(var p=l.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),d=p.strideDepth,f=p.strideHeight,h=p.strideWidth,m=p.filterDepth,v=p.filterHeight,g=p.filterWidth,y=p.dilationDepth,b=p.dilationHeight,x=p.dilationWidth,k=p.effectiveFilterDepth,w=p.effectiveFilterHeight,S=p.effectiveFilterWidth,I=k-1-p.padInfo.front,N=S-1-p.padInfo.left,T=w-1-p.padInfo.top,C=(0,l.buffer)(i.shape,"float32"),E=1/(m*v*g),_=n.bufferSync(a),A=0;A<p.batchSize;++A)for(var R=0;R<p.inChannels;++R)for(var F=0;F<p.inDepth;++F)for(var D=0;D<p.inHeight;++D)for(var Z=0;Z<p.inWidth;++Z){for(var O=F-I,M=D-T,z=Z-N,L=0,P=0;P<k;P+=y){var B=(O+P)/d;if(!(B<0||B>=p.outDepth||Math.floor(B)!==B))for(var W=0;W<w;W+=b){var V=(M+W)/f;if(!(V<0||V>=p.outHeight||Math.floor(V)!==V))for(var U=0;U<S;U+=x){var G=(z+U)/h;if(!(G<0||G>=p.outWidth||Math.floor(G)!==G))L+=_.get(A,B,V,G,R)}}}C.set(L*E,A,F,D,Z,R)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}};var gm={kernelName:l.AvgPoolGrad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Jf([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,p=l.backend_util.computePool2DInfo(o.shape,s,u,1,c),d=p.strideHeight,f=p.strideWidth,h=p.filterHeight,m=p.filterWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.effectiveFilterHeight,b=p.effectiveFilterWidth,x=b-1-p.padInfo.left,k=y-1-p.padInfo.top,w=(0,l.buffer)(o.shape,"float32"),S=1/(h*m),I=n.data.get(a.dataId).values,N=(0,l.buffer)(a.shape,"float32",I),T=0;T<p.batchSize;++T)for(var C=0;C<p.inChannels;++C)for(var E=0;E<p.inHeight;++E)for(var _=0;_<p.inWidth;++_){for(var A=E-k,R=_-x,F=0,D=0;D<y;D+=v){var Z=(A+D)/d;if(!(Z<0||Z>=p.outHeight||Math.floor(Z)!==Z))for(var O=0;O<b;O+=g){var M=(R+O)/f;if(!(M<0||M>=p.outWidth||Math.floor(M)!==M))F+=N.get(T,Z,M,C)}}w.set(F*S,T,E,_,C)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var ym={kernelName:l.FusedBatchNorm,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;l.util.assert(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),l.util.assert(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),l.util.assert(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),Jf([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var p=n.data.get(a.dataId).values,d=n.data.get(s.dataId).values,f=n.data.get(u.dataId).values,h=i?n.data.get(i.dataId).values:new Float32Array([1]),m=o?n.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(p.length),g=m.length,y=h.length,b=f.length,x=d.length,k=0,w=0,S=0,I=0,N=0;N<p.length;++N)v[N]=m[k++]+(p[N]-d[w++])*h[S++]/Math.sqrt(f[I++]+c),k>=g&&(k=0),w>=x&&(w=0),S>=y&&(S=0),I>=b&&(I=0);return n.makeTensorInfo(a.shape,a.dtype,v)}};function bm(e,t,n,r,a){var i=l.slice_util.isSliceContinous(r,t,n),o=l.util.sizeFromShape(n),s=l.util.computeStrides(r);if(i){var u=l.slice_util.computeFlatOffset(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c="string"===a?l.backend_util.fromUint8ToStringArray(e):e,p=(0,l.buffer)(r,a,c),d=(0,l.buffer)(n,a),f=0;f<d.size;++f){var h=d.indexToLoc(f),m=h.map((function(e,n){return e+t[n]}));d.set.apply(d,[p.get.apply(p,(0,Qn.Z)(m))].concat((0,Qn.Z)(h)))}return"string"===a?l.backend_util.fromStringArrayToUint8(d.values):d.values}function xm(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;Jf(a,"slice");var s=l.slice_util.parseSliceParams(a,i,o),u=(0,p.Z)(s,2),c=u[0],d=u[1];l.slice_util.assertParamsValid(a,c,d);var f=bm(n.data.get(a.dataId).values,c,d,a.shape,a.dtype);return n.makeTensorInfo(d,a.dtype,f)}var km={kernelName:l.Slice,backendName:"cpu",kernelFunc:xm};var wm={kernelName:l.BatchToSpaceND,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;Jf([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=l.backend_util.getReshaped(a.shape,i,s),c=l.backend_util.getPermuted(u.length,i.length),p=l.backend_util.getReshapedPermuted(a.shape,i,s),d=l.backend_util.getSliceBeginCoords(o,i.length),f=l.backend_util.getSliceSize(p,o,i.length),h=Oh({inputs:{x:a},backend:n,attrs:{shape:u}}),m=Kh({inputs:{x:h},backend:n,attrs:{perm:c}}),v=Oh({inputs:{x:m},backend:n,attrs:{shape:p}}),g=xm({inputs:{x:v},backend:n,attrs:{begin:d,size:f}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),g}};function Sm(e,t,n,r,a){for(var i=l.util.sizeFromShape(r),o=l.util.makeZerosTypedArray(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function Im(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=(0,l.buffer)([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var Nm={kernelName:l.Bincount,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=Sm(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var Tm={kernelName:l.BroadcastArgs,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=l.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},Cm=gh((function(e){return Math.ceil(e)})),Em=nh(l.Ceil,Cm),_m={kernelName:l.Ceil,backendName:"cpu",kernelFunc:Em},Am=th(l.ClipByValue,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),Rm={kernelName:l.ClipByValue,backendName:"cpu",kernelFunc:Am},Fm={kernelName:l.ComplexAbs,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(l.util.sizeFromShape(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var p=s[c],d=u[c];r[c]=Math.hypot(p,d)}return n.makeOutput(r,t.shape,"float32")}};function Dm(e,t,n,r){var a=l.util.getArrayFromDType(n,l.util.sizeFromShape(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=l.util.sizeFromShape(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?l.backend_util.fromUint8ToStringArray(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}function Zm(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var Om={kernelName:l.Imag,backendName:"cpu",kernelFunc:Zm};function Mm(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=l.util.parseAxisParam(r,t[0].shape)[0],i=l.backend_util.computeOutShape(t.map((function(e){return e.shape})),a);if(0===l.util.sizeFromShape(i))return n.makeTensorInfo(i,t[0].dtype,[]);var o=t.filter((function(e){return l.util.sizeFromShape(e.shape)>0}));if(1===o.length)return ih({inputs:{x:o[0]},backend:n});var s=o.map((function(e){return e.shape}));if(l.backend_util.assertParamsConsistent(s,a),"complex64"===o[0].dtype){var u=o.map((function(e){return Nh({inputs:{input:e},backend:n})})),c=o.map((function(e){return Zm({inputs:{input:e},backend:n})})),p=Mm({inputs:u,backend:n,attrs:{axis:a}}),d=Mm({inputs:c,backend:n,attrs:{axis:a}}),f=wh({inputs:{real:p,imag:d},backend:n});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),f}var h=o.map((function(e){var t=l.util.sizeFromShape(e.shape.slice(a));return Oh({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),m=h.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));i=l.backend_util.computeOutShape(h.map((function(e){return e.shape})),1);var v=1===h[0].shape[0],g=Dm(m,i,t[0].dtype,v),y=l.backend_util.computeOutShape(o.map((function(e){return e.shape})),a),b=n.makeTensorInfo(y,t[0].dtype,g);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}var zm={kernelName:l.Concat,backendName:"cpu",kernelFunc:Mm};function Lm(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,p=r.dimRoundingMode;Jf([a,i],"conv2d");for(var d=l.backend_util.convertConv2DDataFormat(u),f=l.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,p,!1,d),h=f.filterHeight,m=f.filterWidth,v=f.dilationHeight,g=f.dilationWidth,y=f.padInfo.left,b=f.padInfo.top,x="channelsLast"===f.dataFormat,k=new l.TensorBuffer(f.outShape,a.dtype),w=l.util.computeStrides(a.shape),S=l.util.computeStrides(i.shape),I=w[0],N=x?w[1]:w[2],T=x?w[2]:1,C=x?1:w[1],E=k.strides[0],_=x?k.strides[1]:k.strides[2],A=x?k.strides[2]:1,R=x?1:k.strides[1],F=n.data.get(a.dataId).values,D=n.data.get(i.dataId).values,Z=k.values,O=0;O<f.batchSize;++O)for(var M=O*I,z=O*E,L=0;L<f.outHeight;++L)for(var P=z+L*_,B=L*f.strideHeight-b,W=0;W<h;++W){var V=B+W*v;if(!(V<0||V>=f.inHeight))for(var U=W*S[0],G=M+V*N,j=0;j<f.outWidth;++j)for(var H=P+j*A,q=j*f.strideWidth-y,K=0;K<m;++K){var X=q+K*g;if(!(X<0||X>=f.inWidth))for(var Y=G+X*T,Q=U+K*S[1],J=0;J<f.inChannels;++J){for(var $=F[Y+J*C],ee=0;ee<f.outChannels;++ee)Z[H+ee*R]+=$*D[Q+ee];Q+=f.outChannels}}}return n.makeTensorInfo(k.shape,k.dtype,Z)}var Pm={kernelName:l.Conv2D,backendName:"cpu",kernelFunc:Lm};var Bm={kernelName:l.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,p=r.filterShape;Jf([a,i],"conv2dBackpropFilter");for(var d=l.backend_util.convertConv2DDataFormat(u),f=l.backend_util.computeConv2DInfo(a.shape,p,o,1,s,c,!1,d),h=f.strideHeight,m=f.strideWidth,v=f.filterHeight,g=f.filterWidth,y="channelsLast"===f.dataFormat,b=new l.TensorBuffer(f.filterShape,"float32"),x=f.padInfo.left,k=f.padInfo.top,w=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,I=new l.TensorBuffer(a.shape,a.dtype,w),N=new l.TensorBuffer(i.shape,i.dtype,S),T=0;T<v;++T)for(var C=Math.max(0,Math.ceil((k-T)/h)),E=Math.min(f.outHeight,(f.inHeight+k-T)/h),_=0;_<g;++_)for(var A=Math.max(0,Math.ceil((x-_)/m)),R=Math.min(f.outWidth,(f.inWidth+x-_)/m),F=0;F<f.inChannels;++F)for(var D=0;D<f.outChannels;++D){for(var Z=0,O=0;O<f.batchSize;++O)for(var M=C;M<E;++M)for(var z=T+M*h-k,L=A;L<R;++L){var P=_+L*m-x;Z+=y?I.get(O,z,P,F)*N.get(O,M,L,D):I.get(O,F,z,P)*N.get(O,D,M,L)}b.set(Z,T,_,F,D)}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var Wm={kernelName:l.Conv2DBackpropInput,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,d=r.dimRoundingMode;Jf([a,i],"conv2dBackpropInput");var f=l.util.computeStrides(i.shape),h=l.util.computeStrides(a.shape),m=l.backend_util.convertConv2DDataFormat(c),v=l.backend_util.computeConv2DInfo(o,i.shape,s,1,u,d,!1,m),g=new l.TensorBuffer(v.inShape,"float32"),y=g.values,b=n.data.get(a.dataId).values,x=n.data.get(i.dataId).values,k=(0,p.Z)(f,3),w=k[0],S=k[1],I=k[2],N=v.batchSize,T=v.filterHeight,C=v.filterWidth,E=v.inChannels,_=v.inHeight,A=v.inWidth,R=v.outChannels,F=v.outHeight,D=v.outWidth,Z=v.strideHeight,O=v.strideWidth;m=v.dataFormat;for(var M=T-1-v.padInfo.top,z=C-1-v.padInfo.left,L="channelsLast"===m,P=g.strides[0],B=L?g.strides[1]:g.strides[2],W=L?g.strides[2]:1,V=L?1:g.strides[1],U=h[0],G=L?h[1]:h[2],j=L?h[2]:1,H=L?1:h[1],q=0;q<N;++q)for(var K=0;K<E;++K)for(var X=0;X<_;++X)for(var Y=X-M,Q=Math.max(0,Math.ceil(Y/Z)),J=Math.min(F,(T+Y)/Z),$=0;$<A;++$){for(var ee=$-z,te=Math.max(0,Math.ceil(ee/O)),ne=Math.min(D,(C+ee)/O),re=0,ae=Q;ae<J;++ae)for(var ie=ae*Z-Y,oe=te;oe<ne;++oe)for(var se=U*q+G*ae+j*oe,ue=w*(T-1-ie)+S*(C-1-(oe*O-ee))+I*K,ce=0;ce<R;++ce){re+=b[se+H*ce]*x[ue+ce]}y[P*q+B*X+W*$+V*K]=re}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};var Vm={kernelName:l.Conv3D,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;Jf([a,i],"conv3d");for(var c=l.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),p=c.filterDepth,d=c.filterHeight,f=c.filterWidth,h=c.dilationDepth,m=c.dilationHeight,v=c.dilationWidth,g=c.padInfo,y=g.front,b=g.left,x=g.top,k=new l.TensorBuffer(c.outShape,a.dtype),w=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,I=k.values,N=l.util.computeStrides(a.shape),T=l.util.computeStrides(i.shape),C=0;C<c.batchSize;++C)for(var E=C*N[0],_=C*k.strides[0],A=0;A<c.outDepth;++A)for(var R=_+A*k.strides[1],F=A*c.strideDepth-y,D=0;D<p;++D){var Z=F+D*h;if(!(Z<0||Z>=c.inDepth))for(var O=D*T[0],M=E+Z*N[1],z=0;z<c.outHeight;++z)for(var L=R+z*k.strides[2],P=z*c.strideHeight-x,B=0;B<d;++B){var W=P+B*m;if(!(W<0||W>=c.inHeight))for(var V=O+B*T[1],U=M+W*N[2],G=0;G<c.outWidth;++G)for(var j=L+G*c.outChannels,H=G*c.strideWidth-b,q=0;q<f;++q){var K=H+q*v;if(!(K<0||K>=c.inWidth))for(var X=V+q*T[2],Y=U+K*c.inChannels,Q=X,J=0;J<c.inChannels;++J){for(var $=w[Y+J],ee=0;ee<c.outChannels;++ee)I[j+ee]+=$*S[Q+ee];Q+=c.outChannels}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var Um={kernelName:l.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;Jf([a,i],"conv3dBackpropFilterV2");for(var c=l.util.computeStrides(a.shape),d=l.util.computeStrides(i.shape),f=l.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,m=f.strideHeight,v=f.strideWidth,g=f.filterDepth,y=f.filterHeight,b=f.filterWidth,x=new l.TensorBuffer(f.filterShape,"float32"),k=x.values,w=(0,p.Z)(x.strides,4),S=w[0],I=w[1],N=w[2],T=w[3],C=n.data.get(i.dataId).values,E=(0,p.Z)(d,4),_=E[0],A=E[1],R=E[2],F=E[3],D=n.data.get(a.dataId).values,Z=(0,p.Z)(c,4),O=Z[0],M=Z[1],z=Z[2],L=Z[3],P=f.padInfo.front,B=f.padInfo.left,W=f.padInfo.top,V=0;V<g;++V)for(var U=Math.max(0,Math.ceil((P-V)/h)),G=Math.min(f.outDepth,(f.inDepth+P-V)/h),j=V*S,H=0;H<y;++H)for(var q=Math.max(0,Math.ceil((W-H)/m)),K=Math.min(f.outHeight,(f.inHeight+W-H)/m),X=H*I+j,Y=0;Y<b;++Y)for(var Q=Math.max(0,Math.ceil((B-Y)/v)),J=Math.min(f.outWidth,(f.inWidth+B-Y)/v),$=Y*N+X,ee=0;ee<f.inChannels;++ee)for(var te=ee*T+$,ne=0;ne<f.outChannels;++ne){for(var re=0,ae=0;ae<f.batchSize;++ae)for(var ie=ae*O,oe=ae*_,se=U;se<G;++se)for(var ue=(V+se*h-P)*M+ie,ce=se*A+oe,le=q;le<K;++le)for(var pe=(H+le*m-W)*z+ue,de=le*R+ce,fe=Q;fe<J;++fe){var he=fe*F+de;re+=D[(Y+fe*v-B)*L+pe+ee]*C[he+ne]}k[te+ne]=re}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var Gm={kernelName:l.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;Jf([a],"conv3dBackpropInputV2");for(var c=l.util.computeStrides(a.shape),d=l.util.computeStrides(i.shape),f=l.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new l.TensorBuffer(f.inShape,"float32"),m=h.values,v=(0,p.Z)(h.strides,4),g=v[0],y=v[1],b=v[2],x=v[3],k=n.data.get(a.dataId).values,w=(0,p.Z)(c,4),S=w[0],I=w[1],N=w[2],T=w[3],C=n.data.get(i.dataId).values,E=(0,p.Z)(d,4),_=E[0],A=E[1],R=E[2],F=E[3],D=f.batchSize,Z=f.filterDepth,O=f.filterHeight,M=f.filterWidth,z=f.inChannels,L=f.inDepth,P=f.inHeight,B=f.inWidth,W=f.outChannels,V=f.outDepth,U=f.outHeight,G=f.outWidth,j=f.strideDepth,H=f.strideHeight,q=f.strideWidth,K=Z-1-f.padInfo.front,X=O-1-f.padInfo.top,Y=M-1-f.padInfo.left,Q=0;Q<D;++Q)for(var J=0;J<z;++J)for(var $=0;$<L;++$)for(var ee=$-K,te=Math.max(0,Math.ceil(ee/j)),ne=Math.min(V,(Z+ee)/j),re=0;re<P;++re)for(var ae=re-X,ie=Math.max(0,Math.ceil(ae/H)),oe=Math.min(U,(O+ae)/H),se=0;se<B;++se){for(var ue=se-Y,ce=Math.max(0,Math.ceil(ue/q)),le=Math.min(G,(M+ue)/q),pe=0,de=te;de<ne;++de)for(var fe=de*j-ee,he=ie;he<oe;++he)for(var me=he*H-ae,ve=ce;ve<le;++ve)for(var ge=S*Q+I*de+N*he+T*ve,ye=_*(Z-1-fe)+A*(O-1-me)+R*(M-1-(ve*q-ue))+F*J,be=0;be<W;++be){pe+=k[ge+be]*C[ye+be]}m[g*Q+y*$+b*re+x*se+J]=pe}return n.makeTensorInfo(h.shape,h.dtype,h.values)}},jm=th(l.Cos,(function(e){return Math.cos(e)})),Hm={kernelName:l.Cos,backendName:"cpu",kernelFunc:jm},qm=th(l.Cosh,(function(e){return Math.cosh(e)})),Km={kernelName:l.Cosh,backendName:"cpu",kernelFunc:qm};var Xm={kernelName:l.CropAndResize,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,d=(0,p.Z)(a.shape,4),f=d[0],h=d[1],m=d[2],v=d[3],g=i.shape[0],y=(0,p.Z)(s,2),b=y[0],x=y[1],k=(0,l.buffer)([g,b,x,v],"float32"),w=n.data.get(i.dataId).values,S=n.data.get(o.dataId).values,I=n.data.get(a.dataId).values,N=l.util.computeStrides(a.shape),T=l.util.computeStrides(k.shape),C=0;C<g;C++){var E=4*C,_=w[E],A=w[E+1],R=w[E+2],F=w[E+3],D=S[C];if(!(D>=f))for(var Z=b>1?(R-_)*(h-1)/(b-1):0,O=x>1?(F-A)*(m-1)/(x-1):0,M=0;M<b;M++){var z=b>1?_*(h-1)+M*Z:.5*(_+R)*(h-1);if(z<0||z>h-1)for(var L=0;L<x;L++)for(var P=0;P<v;P++){var B=P+L*T[2]+M*T[1]+C*T[0];k.values[B]=c}else if("bilinear"===u)for(var W=Math.floor(z),V=Math.ceil(z),U=z-W,G=0;G<x;G++){var j=x>1?A*(m-1)+G*O:.5*(A+F)*(m-1);if(j<0||j>m-1)for(var H=0;H<v;H++){var q=H+G*T[2]+M*T[1]+C*T[0];k.values[q]=c}else for(var K=Math.floor(j),X=Math.ceil(j),Y=j-K,Q=0;Q<v;Q++){var J=Q+K*N[2]+W*N[1]+D*N[0],$=I[J],ee=I[J=Q+X*N[2]+W*N[1]+D*N[0]],te=I[J=Q+K*N[2]+V*N[1]+D*N[0]],ne=$+(ee-$)*Y,re=te+(I[J=Q+X*N[2]+V*N[1]+D*N[0]]-te)*Y;J=Q+G*T[2]+M*T[1]+C*T[0],k.values[J]=ne+(re-ne)*U}}else for(var ae=0;ae<x;++ae){var ie=x>1?A*(m-1)+ae*O:.5*(A+F)*(m-1);if(ie<0||ie>m-1)for(var oe=0;oe<v;oe++){var se=oe+ae*T[2]+M*T[1]+C*T[0];k.values[se]=c}else for(var ue=Math.round(ie),ce=Math.round(z),le=0;le<v;le++){var pe=le+ue*N[2]+ce*N[1]+D*N[0],de=le+ae*T[2]+M*T[1]+C*T[0];k.values[de]=I[pe]}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var Ym={kernelName:l.Cumprod,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;Jf(a,"cumprod");var u=l.backend_util.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=Kh({inputs:{x:a},backend:n,attrs:{perm:u}}));var p=l.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(p!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(p));for(var d=(0,l.upcastType)(c.dtype,"int32"),f=l.util.makeOnesTypedArray(l.util.sizeFromShape(c.shape),d),h=n.data.get(c.dataId).values,m=c.shape[c.shape.length-1],v=s?function(e,t){return e+m-t-1}:function(e,t){return e+t},g=0;g<h.length;g+=m)for(var y=0;y<m;y++){var b=v(g,y);if(0===y)f[b]=o?1:h[b];else{var x=v(g,y-1);f[b]=o?h[x]*f[x]:h[b]*f[x]}}var k=n.makeTensorInfo(c.shape,d,f);if(null!=u){var w=Kh({inputs:{x:k},backend:n,attrs:{perm:l.backend_util.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(c),w}return k}};var Qm={kernelName:l.Cumsum,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;Jf(a,"cumsum");var u=l.backend_util.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=Kh({inputs:{x:a},backend:n,attrs:{perm:u}}));var p=l.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(p!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(p));for(var d=(0,l.upcastType)(c.dtype,"int32"),f=l.util.makeZerosTypedArray(l.util.sizeFromShape(c.shape),d),h=n.data.get(c.dataId).values,m=c.shape[c.shape.length-1],v=s?function(e,t){return e+m-t-1}:function(e,t){return e+t},g=0;g<h.length;g+=m)for(var y=0;y<m;y++){var b=v(g,y);if(0===y)f[b]=o?0:h[b];else{var x=v(g,y-1);f[b]=o?h[x]+f[x]:h[b]+f[x]}}var k=n.makeTensorInfo(c.shape,d,f);if(null!=u){var w=Kh({inputs:{x:k},backend:n,attrs:{perm:l.backend_util.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(c),w}return k}};var Jm={kernelName:l.DenseBincount,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=Sm(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=Im(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};var $m={kernelName:l.DepthToSpace,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;l.util.assert("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],p=a.shape[3],d=u*i,f=c*i,h=p/(i*i),m=n.data.get(a.dataId).values,v=new Float32Array(s*d*f*h),g=0,y=0;y<s;++y)for(var b=0;b<d;++b)for(var x=Math.floor(b/i),k=b%i,w=0;w<f;++w)for(var S=Math.floor(w/i),I=(k*i+w%i)*h,N=0;N<h;++N){var T=N+I+p*(S+c*(x+u*y));v[g++]=m[T]}return n.makeTensorInfo([s,d,f,h],a.dtype,v)}};function ev(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;Jf([a,i],"depthwiseConv2DNative");var p=l.util.computeStrides(a.shape),d=l.util.computeStrides(i.shape),f=u;null==f&&(f=[1,1]),l.util.assert(l.backend_util.eitherStridesOrDilationsAreOne(o,f),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(f,"'")}));for(var h=l.backend_util.computeConv2DInfo(a.shape,i.shape,o,f,s,c,!0),m=h.filterHeight,v=h.filterWidth,g=h.dilationHeight,y=h.dilationWidth,b=h.padInfo,x=b.left,k=b.top,w=h.outChannels/h.inChannels,S=new l.TensorBuffer(h.outShape,a.dtype),I=n.data.get(a.dataId).values,N=n.data.get(i.dataId).values,T=S.values,C=0;C<h.batchSize;++C)for(var E=C*p[0],_=C*S.strides[0],A=0;A<h.outHeight;++A)for(var R=_+A*S.strides[1],F=A*h.strideHeight-k,D=0;D<m;++D){var Z=F+D*g;if(!(Z<0||Z>=h.inHeight))for(var O=D*d[0],M=E+Z*p[1],z=0;z<h.outWidth;++z)for(var L=R+z*S.strides[2],P=z*h.strideWidth-x,B=0;B<v;++B){var W=P+B*y;if(!(W<0||W>=h.inWidth))for(var V=O+B*d[1],U=M+W*h.inChannels,G=L,j=V,H=0;H<h.inChannels;++H){for(var q=I[U+H],K=0;K<w;++K)T[G+K]+=q*N[j+K];G+=w,j+=w}}}return n.makeTensorInfo(S.shape,S.dtype,S.values)}var tv={kernelName:l.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:ev};var nv={kernelName:l.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,p=r.filterShape;Jf([a,i],"depthwiseConv2dNativeBackpropFilter");for(var d=l.backend_util.computeConv2DInfo(a.shape,p,o,s,u,c,!0),f=d.strideHeight,h=d.strideWidth,m=d.filterHeight,v=d.filterWidth,g=new l.TensorBuffer(d.filterShape,"float32"),y=d.padInfo.left,b=d.padInfo.top,x=d.outChannels/d.inChannels,k=n.data.get(a.dataId).values,w=new l.TensorBuffer(a.shape,a.dtype,k),S=n.data.get(i.dataId).values,I=new l.TensorBuffer(i.shape,i.dtype,S),N=0;N<m;++N)for(var T=Math.max(0,Math.ceil((b-N)/f)),C=Math.min(d.outHeight,(d.inHeight+b-N)/f),E=0;E<v;++E)for(var _=Math.max(0,Math.ceil((y-E)/h)),A=Math.min(d.outWidth,(d.inWidth+y-E)/h),R=0;R<d.outChannels;++R){for(var F=Math.trunc(R/x),D=R%x,Z=0,O=0;O<d.batchSize;++O)for(var M=T;M<C;++M)for(var z=N+M*f-b,L=_;L<A;++L){var P=E+L*h-y;Z+=w.get(O,z,P,F)*I.get(O,M,L,R)}g.set(Z,N,E,F,D)}return n.makeTensorInfo(g.shape,g.dtype,g.values)}};var rv={kernelName:l.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,d=r.inputShape;Jf([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=l.util.computeStrides(a.shape),h=l.util.computeStrides(i.shape),m=l.backend_util.computeConv2DInfo(d,i.shape,o,s,u,c,!0),v=new l.TensorBuffer(m.inShape,"float32"),g=v.values,y=(0,p.Z)(v.strides,3),b=y[0],x=y[1],k=y[2],w=n.data.get(a.dataId).values,S=(0,p.Z)(f,3),I=S[0],N=S[1],T=S[2],C=n.data.get(i.dataId).values,E=(0,p.Z)(h,3),_=E[0],A=E[1],R=E[2],F=m.batchSize,D=m.filterHeight,Z=m.filterWidth,O=m.inChannels,M=m.inHeight,z=m.inWidth,L=m.outChannels,P=m.outHeight,B=m.outWidth,W=m.strideHeight,V=m.strideWidth,U=D-1-m.padInfo.top,G=Z-1-m.padInfo.left,j=L/O,H=0;H<F;++H)for(var q=0;q<O;++q)for(var K=0;K<M;++K)for(var X=K-U,Y=Math.max(0,Math.ceil(X/W)),Q=Math.min(P,(D+X)/W),J=0;J<z;++J){for(var $=J-G,ee=Math.max(0,Math.ceil($/V)),te=Math.min(B,(Z+$)/V),ne=0,re=Y;re<Q;++re)for(var ae=re*W-X,ie=ee;ie<te;++ie)for(var oe=I*H+N*re+T*ie,se=_*(D-1-ae)+A*(Z-1-(ie*V-$))+R*q,ue=0;ue<j;++ue){ne+=w[oe+(q*j+ue)]*C[se+ue]}g[b*H+x*K+k*J+q]=ne}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var av={kernelName:l.Diag,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=l.util.sizeFromShape(r.shape),i=n.data.get(r.dataId).values,o=(0,l.buffer)([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat((0,Qn.Z)(r.shape),(0,Qn.Z)(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},iv={kernelName:l.Dilation2D,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,p=c.data.get(a.dataId).values,d=a.shape.length,f=c.data.get(i.dataId).values,h=i.shape.length,m=l.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),v=m.batchSize,g=m.inHeight,y=m.inWidth,b=m.inChannels,x=m.outHeight,k=m.outWidth,w=m.padInfo,S=m.strideHeight,I=m.strideWidth,N=m.filterHeight,T=m.filterWidth,C=m.dilationHeight,E=m.dilationWidth,_=m.outShape,A=l.util.sizeFromShape(_),R=_.length,F=l.util.getArrayFromDType(a.dtype,A),D=0;D<v;++D)for(var Z=0;Z<x;++Z)for(var O=Z*S-w.top,M=0;M<k;++M)for(var z=M*I-w.left,L=0;L<b;++L){for(var P=Number.MIN_SAFE_INTEGER,B=0;B<N;++B){var W=O+B*C;if(W>=0&&W<g)for(var V=0;V<T;++V){var U=z+V*E;if(U>=0&&U<y){var G=l.util.locToIndex([D,W,U,L],d,l.util.computeStrides(a.shape)),j=l.util.locToIndex([B,V,L],h,l.util.computeStrides(i.shape)),H=p[G]+f[j];H>P&&(P=H)}}}F[l.util.locToIndex([D,Z,M,L],R,l.util.computeStrides(_))]=P}return{dataId:c.write(l.util.toTypedArray(F,a.dtype),_,a.dtype),shape:_,dtype:a.dtype}}},ov={kernelName:l.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,p=n,d=l.util.toNestedArray(a.shape,p.data.get(a.dataId).values),f=l.util.toNestedArray(i.shape,p.data.get(i.dataId).values),h=l.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),m=h.batchSize,v=h.inHeight,g=h.inWidth,y=h.inChannels,b=h.outHeight,x=h.outWidth,k=h.padInfo,w=h.strideHeight,S=h.strideWidth,I=h.filterHeight,N=h.filterWidth,T=h.dilationHeight,C=h.dilationWidth,E=h.outShape;l.util.assert(o.rank===E.length,(function(){return"Error in ".concat(l.Dilation2DBackpropFilter,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank)}));for(var _=l.util.toNestedArray(E,p.data.get(o.dataId).values),A=l.util.makeZerosNestedTypedArray(i.shape,i.dtype),R=0;R<m;++R)for(var F=0;F<b;++F)for(var D=F*w-k.top,Z=0;Z<x;++Z)for(var O=Z*S-k.left,M=0;M<y;++M){for(var z=Number.MIN_SAFE_INTEGER,L=0,P=0,B=0;B<I;++B){var W=D+B*T;if(W>=0&&W<v)for(var V=0;V<N;++V){var U=O+V*C;if(U>=0&&U<g){var G=d[R][W][U][M]+f[B][V][M];G>z&&(z=G,L=B,P=V)}}}A[L][P][M]+=_[R][F][Z][M]}return{dataId:p.write(l.util.toTypedArray(A,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},sv={kernelName:l.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,p=n,d=l.util.toNestedArray(a.shape,p.data.get(a.dataId).values),f=l.util.toNestedArray(i.shape,p.data.get(i.dataId).values),h=l.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),m=h.batchSize,v=h.inHeight,g=h.inWidth,y=h.inChannels,b=h.outHeight,x=h.outWidth,k=h.padInfo,w=h.strideHeight,S=h.strideWidth,I=h.filterHeight,N=h.filterWidth,T=h.dilationHeight,C=h.dilationWidth,E=h.outShape;l.util.assert(o.rank===E.length,(function(){return"Error in ".concat(l.Dilation2DBackpropInput,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank)}));for(var _=l.util.toNestedArray(E,p.data.get(o.dataId).values),A=l.util.makeZerosNestedTypedArray(a.shape,a.dtype),R=0;R<m;++R)for(var F=0;F<b;++F)for(var D=F*w-k.top,Z=0;Z<x;++Z)for(var O=Z*S-k.left,M=0;M<y;++M){for(var z=Number.MIN_SAFE_INTEGER,L=D<0?0:D,P=O<0?0:O,B=0;B<I;++B){var W=D+B*T;if(W>=0&&W<v)for(var V=0;V<N;++V){var U=O+V*C;if(U>=0&&U<g){var G=d[R][W][U][M]+f[B][V][M];G>z&&(z=G,L=W,P=U)}}}A[R][L][P][M]+=_[R][F][Z][M]}return{dataId:p.write(l.util.toTypedArray(A,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},uv=ch((function(e,t){return e*t})),cv=Ah((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),lv=_h(l.Multiply,uv,cv),pv={kernelName:l.Multiply,backendName:"cpu",kernelFunc:lv};function dv(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;Jf(i,"sum");var u=(t="bool"===i.dtype?Ch({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):ih({inputs:{x:i},backend:r})).shape.length,c=l.util.parseAxisParam(o,t.shape),d=l.backend_util.getAxesPermutation(c,u),f=c,h=t;null!=d&&(h=Kh({inputs:{x:t},backend:r,attrs:{perm:d}}),f=l.backend_util.getInnerMostAxes(f.length,u)),l.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var m=l.backend_util.computeOutAndReduceShapes(h.shape,f),v=(0,p.Z)(m,2),g=v[0],y=v[1],b=Ih(r,g,l.backend_util.upcastType(h.dtype,"int32")),x=l.util.sizeFromShape(y),k=r.data.get(b.dataId).values,w=r.data.get(h.dataId).values,S=0;S<k.length;++S){for(var I=S*x,N=0,T=0;T<x;++T)N+=w[I+T];k[S]=N}if(s){var C=b;b=Oh({inputs:{x:b},backend:r,attrs:{shape:l.backend_util.expandShapeToKeepDim(b.shape,c)}}),r.disposeIntermediateTensorInfo(C)}return r.disposeIntermediateTensorInfo(t),null!=d&&r.disposeIntermediateTensorInfo(h),b}var fv={kernelName:l.Sum,backendName:"cpu",kernelFunc:dv};var hv={kernelName:l.Einsum,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=l.backend_util.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;l.backend_util.checkEinsumDimSizes(o.length,u,a);for(var c=l.backend_util.getEinsumComputePath(s,u),p=c.path,d=c.steps,f=d.length,h=null,m=o.length,v=[],g=0;g<f;++g){var y,b=(0,ra.Z)(d[g]);try{for(b.s();!(y=b.n()).done;){var x=y.value,k=l.backend_util.getEinsumPermutation(m,u[x]),w=k.permutationIndices,S=k.expandDims,I=void 0;l.backend_util.isIdentityPermutation(w)?I=a[x]:(I=Kh({inputs:{x:a[x]},backend:n,attrs:{perm:w}}),v.push(I));for(var N=I.shape.slice(),T=0;T<S.length;++T)N.splice(S[T],0,1);l.util.arraysEqual(I.shape,N)||(I=Oh({inputs:{x:I},backend:n,attrs:{shape:N}}),v.push(I)),null===h?h=I:(h=lv({inputs:{a:I,b:h},backend:n}),v.push(h))}}catch(A){b.e(A)}finally{b.f()}g<f-1&&(p[g]>=0&&(h=dv({inputs:{x:h},backend:n,attrs:{axis:p[g]-(o.length-m),keepDims:!1}}),v.push(h)),m--)}for(var C=0,E=v;C<E.length;C++){var _=E[C];_!==h&&n.disposeIntermediateTensorInfo(_)}return h}};var mv={kernelName:l.EluGrad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;Jf([r,a],"eluGrad");for(var i=new Float32Array(l.util.sizeFromShape(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},vv=ch((function(e,t){return e===t?1:0})),gv=_h(l.Equal,vv,null,"bool"),yv={kernelName:l.Equal,backendName:"cpu",kernelFunc:gv},bv=l.backend_util.ERF_P,xv=l.backend_util.ERF_A1,kv=l.backend_util.ERF_A2,wv=l.backend_util.ERF_A3,Sv=l.backend_util.ERF_A4,Iv=l.backend_util.ERF_A5,Nv=th(l.Erf,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+bv*n);return t*(1-((((Iv*r+Sv)*r+wv)*r+kv)*r+xv)*r*Math.exp(-n*n))})),Tv={kernelName:l.Erf,backendName:"cpu",kernelFunc:Nv},Cv=gh((function(e){return Math.exp(e)})),Ev=nh(l.Exp,Cv,"float32"),_v={kernelName:l.Exp,backendName:"cpu",kernelFunc:Ev};function Av(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(l.util.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),Oh({inputs:{x:a},backend:n,attrs:{shape:s}})}var Rv={kernelName:l.ExpandDims,backendName:"cpu",kernelFunc:Av},Fv=gh((function(e){return Math.expm1(e)})),Dv=nh(l.Expm1,Fv),Zv={kernelName:l.Expm1,backendName:"cpu",kernelFunc:Dv},Ov=ch((function(e,t){return e/t})),Mv=_h(l.RealDiv,Ov),zv={kernelName:l.RealDiv,backendName:"cpu",kernelFunc:Mv},Lv=ch((function(e,t){return e-t})),Pv=Ah((function(e,t,n,r){return{real:e-n,imag:t-r}})),Bv=_h(l.Sub,Lv,Pv),Wv={kernelName:l.Sub,backendName:"cpu",kernelFunc:Bv};function Vv(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],p=l.util.sizeFromShape(c),d=l.util.getTypedArrayFromDType("float32",p),f=l.util.getTypedArrayFromDType("float32",p),h=0;h<a;h++){for(var m=xm({inputs:{x:s},backend:n,attrs:{begin:[h,0],size:[1,i]}}),v=xm({inputs:{x:u},backend:n,attrs:{begin:[h,0],size:[1,i]}}),g=wh({inputs:{real:m,imag:v},backend:n}),y=Uv(g,t,n),b=y.real,x=y.imag,k=l.backend_util.mergeRealAndImagArrays(b,x),w=0;w<i;w++){var S=l.backend_util.getComplexWithIndex(k,w);d[h*i+w]=S.real,f[h*i+w]=S.imag}n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g)}var I=n.makeTensorInfo(c,"float32",d),N=n.makeTensorInfo(c,"float32",f),T=wh({inputs:{real:I,imag:N},backend:n});return n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(N),T}function Uv(e,t,n){var r=l.util.sizeFromShape(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((y=r)&y-1)){var s=Gv(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),p=n.makeTensorInfo(u,"float32",s.imag),d=n.makeTensorInfo([],"float32",l.util.createScalarValue(r,"float32")),f=ih({inputs:{x:d},backend:n}),h=zv.kernelFunc({inputs:{a:c,b:d},backend:n}),m=zv.kernelFunc({inputs:{a:p,b:f},backend:n}),v=n.data.get(h.dataId).values,g=n.data.get(m.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),{real:v,imag:g}}return s}var y,b=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=l.backend_util.exponent(a*s,t,n),c=l.backend_util.getComplexWithIndex(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),l.backend_util.assignToTypedArray(r,i,o,a)}return r}(l.backend_util.mergeRealAndImagArrays(i,o),r,t);return l.backend_util.splitRealAndImagArrays(b)}function Gv(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=l.backend_util.mergeRealAndImagArrays(e,t),o=n/2,s=l.backend_util.complexWithEvenIndex(i),u=s.real,c=s.imag,p=[u.length],d=a.makeTensorInfo(p,"float32",u),f=a.makeTensorInfo(p,"float32",c),h=wh({inputs:{real:d,imag:f},backend:a}),m=l.backend_util.complexWithOddIndex(i),v=m.real,g=m.imag,y=[v.length],b=a.makeTensorInfo(y,"float32",v),x=a.makeTensorInfo(y,"float32",g),k=wh({inputs:{real:b,imag:x},backend:a}),w=Gv(u,c,o,r,a),S=w.real,I=w.imag,N=[S.length],T=a.makeTensorInfo(N,"float32",S),C=a.makeTensorInfo(N,"float32",I),E=wh({inputs:{real:T,imag:C},backend:a}),_=Gv(v,g,o,r,a),A=_.real,R=_.imag,F=[A.length],D=a.makeTensorInfo(F,"float32",A),Z=a.makeTensorInfo(F,"float32",R),O=wh({inputs:{real:D,imag:Z},backend:a}),M=l.backend_util.exponents(n,r),z=[M.real.length],L=a.makeTensorInfo(z,"float32",M.real),P=a.makeTensorInfo(z,"float32",M.imag),B=wh({inputs:{real:L,imag:P},backend:a}),W=lv({inputs:{a:B,b:O},backend:a}),V=Dh({inputs:{a:E,b:W},backend:a}),U=Bv({inputs:{a:E,b:W},backend:a}),G=Nh({inputs:{input:V},backend:a}),j=Nh({inputs:{input:U},backend:a}),H=Zm({inputs:{input:V},backend:a}),q=Zm({inputs:{input:U},backend:a}),K=Mm({inputs:[G,j],backend:a,attrs:{axis:0}}),X=Mm({inputs:[H,q],backend:a,attrs:{axis:0}}),Y=a.data.get(K.dataId).values,Q=a.data.get(X.dataId).values;return a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(k),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(Z),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(X),{real:Y,imag:Q}}var jv={kernelName:l.FFT,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=l.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=Oh({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=Vv(o,!1,n),u=Oh({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function Hv(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||l.util.inferDtype(a),o=l.util.getArrayFromDType(i,l.util.sizeFromShape(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var qv={kernelName:l.Fill,backendName:"cpu",kernelFunc:Hv};var Kv={kernelName:l.FlipLeftRight,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=l.util.getTypedArrayFromDType(r.dtype,l.util.sizeFromShape(r.shape)),o=(0,p.Z)(r.shape,4),s=o[0],u=o[1],c=o[2],d=o[3],f=a.data.get(r.dataId).values,h=0;h<s;h++)for(var m=h*c*u*d,v=0;v<u;v++)for(var g=v*(c*d),y=0;y<c;y++)for(var b=y*d,x=0;x<d;x++){var k=Math.round(c-y-1),w=m+g+b+x,S=f[w];if(k>=0&&k<c)S=f[m+g+k*d+x];i[w]=S}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Xv=gh((function(e){return Math.floor(e)})),Yv=nh(l.Floor,Xv),Qv={kernelName:l.Floor,backendName:"cpu",kernelFunc:Yv},Jv=ch((function(e,t){return Math.floor(e/t)})),$v=_h(l.FloorDiv,Jv,null,"int32"),eg={kernelName:l.FloorDiv,backendName:"cpu",kernelFunc:$v};var tg={kernelName:l.FusedConv2D,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,d=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=Lm({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:d}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var g=Oh({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=Dh({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=Dh({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(f){var y=m;if("NCHW"===l&&"prelu"===f&&1===s.shape.length&&1!==s.shape[0]){var b=Oh({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=kh(n,m,f,b,h),n.disposeIntermediateTensorInfo(b)}else m=kh(n,m,f,s,h);n.disposeIntermediateTensorInfo(y)}return m}};var ng={kernelName:l.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,d=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=ev({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:d}});if(o){var v=m;m=Dh({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(f){var g=m;m=kh(n,m,f,s,h),n.disposeIntermediateTensorInfo(g)}return m}};function rg(e,t,n,r,a,i,o,s,u){for(var c=(0,l.buffer)([r,i],n),p=0;p<r;p++){for(var d=[],f=0,h=0;h<a;h++){var m=e[p*a+h];f+=m*o[h],d.push(m)}if(f<0||f>=u/i)throw new Error("Invalid indices: ".concat(d," does not index into ").concat(s));for(var v=0;v<i;v++)c.values[p*i+v]=t.get.apply(t,(0,Qn.Z)(t.indexToLoc(f*i+v)))}return c}var ag={kernelName:l.GatherNd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=l.util.sizeFromShape(r.shape),o=a.shape,s=o[o.length-1],u=l.backend_util.prepareAndValidate(r,a),c=(0,p.Z)(u,4),d=c[0],f=c[1],h=c[2],m=c[3];if(0===f)return n.makeTensorInfo(d,r.dtype,[]);var v=rg(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,f,s,h,m,r.shape,i);return n.makeTensorInfo(d,r.dtype,v.values)}};function ig(e,t,n){for(var r=(0,l.buffer)(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var og={kernelName:l.GatherV2,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;Jf([a,i],"gatherV2");for(var u=l.util.parseAxisParam(o,a.shape)[0],c=n.data.get(i.dataId).values,p=a.shape[u],d=function(e){var t=c[e];l.util.assert(t<=p-1&&t>=0,(function(){return"GatherV2: the index value ".concat(t," is not in [0, ").concat(p-1,"]")}))},f=0;f<c.length;++f)d(f);var h=s;null==s&&(h=0);var m=l.util.sizeFromShape(i.shape),v=l.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,h),g=Oh({inputs:{x:a},backend:n,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),y=Oh({inputs:{x:i},backend:n,attrs:{shape:[v.batchSize,m/v.batchSize]}}),b=[v.batchSize,v.outerSize,m/v.batchSize,v.sliceSize],x=n.bufferSync(y),k=ig(n.bufferSync(g),x,b);return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),n.makeTensorInfo(v.outputShape,k.dtype,k.values)}},sg=ch((function(e,t){return e>t?1:0})),ug=_h(l.Greater,sg,null,"bool"),cg={kernelName:l.Greater,backendName:"cpu",kernelFunc:ug},lg=ch((function(e,t){return e>=t?1:0})),pg=_h(l.GreaterEqual,lg,null,"bool"),dg={kernelName:l.GreaterEqual,backendName:"cpu",kernelFunc:pg};var fg={kernelName:l.IFFT,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=l.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=Oh({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=Vv(o,!0,n),u=Oh({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},hg=th(l.IsFinite,(function(e){return Number.isFinite(e)?1:0}),"bool"),mg={kernelName:l.IsFinite,backendName:"cpu",kernelFunc:hg},vg=th(l.IsInf,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),gg={kernelName:l.IsInf,backendName:"cpu",kernelFunc:vg},yg=th(l.IsNan,(function(e){return Number.isNaN(e)?1:0}),"bool"),bg={kernelName:l.IsNan,backendName:"cpu",kernelFunc:yg},xg=ch((function(e,t){return e<t?1:0})),kg=_h(l.Less,xg,null,"bool"),wg={kernelName:l.Less,backendName:"cpu",kernelFunc:kg},Sg=ch((function(e,t){return e<=t?1:0})),Ig=_h(l.LessEqual,Sg,null,"bool"),Ng={kernelName:l.LessEqual,backendName:"cpu",kernelFunc:Ig};function Tg(e,t,n){var r=(t-e)/(n-1),a=l.util.makeZerosTypedArray(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var Cg={kernelName:l.LinSpace,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=Tg(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},Eg=gh((function(e){return Math.log(e)})),_g=nh(l.Log,Eg),Ag={kernelName:l.Log,backendName:"cpu",kernelFunc:_g},Rg=th(l.Log1p,(function(e){return Math.log1p(e)})),Fg={kernelName:l.Log1p,backendName:"cpu",kernelFunc:Rg},Dg=ch((function(e,t){return e&&t})),Zg=_h(l.LogicalAnd,Dg,null,"bool"),Og={kernelName:l.LogicalAnd,backendName:"cpu",kernelFunc:Zg},Mg=th(l.LogicalNot,(function(e){return e?0:1}),"bool"),zg={kernelName:l.LogicalNot,backendName:"cpu",kernelFunc:Mg},Lg=ch((function(e,t){return e||t})),Pg=_h(l.LogicalOr,Lg,null,"bool"),Bg={kernelName:l.LogicalOr,backendName:"cpu",kernelFunc:Pg};var Wg={kernelName:l.LRN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;Jf(a,"LRN");var c=a.shape[3],p=c-1,d=n.data.get(a.dataId).values,f=l.util.sizeFromShape(a.shape),h=new Float32Array(f);function m(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,p),a=0;n<=r;n++){var o=d[n];a+=o*o}return a}for(var v=0;v<f;v++){var g=m(v),y=d[v]*Math.pow(o+s*g,-u);h[v]=y}return n.makeTensorInfo(a.shape,a.dtype,h)}};var Vg={kernelName:l.LRNGrad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,p=r.beta;Jf(o,"LRNGrad");for(var d=l.util.sizeFromShape(o.shape),f=o.shape[3],h=n.data.get(o.dataId).values,m=n.data.get(a.dataId).values,v=n.data.get(i.dataId).values,g=new Float32Array(d),y=d,b=0;b<y;b++){for(var x=b%f,k=b-x+Math.max(0,x-s),w=b-x+Math.min(f,x+s+1),S=0,I=k;I<w;I++)S+=Math.pow(m[I],2);S=c*S+u;for(var N=k;N<w;N++){var T=-2*c*p*m[N]*v[b]/S;b===N&&(T+=Math.pow(S,-p)),T*=h[b],g[N]+=T}}return n.makeTensorInfo(o.shape,a.dtype,g)}};function Ug(e,t,n,r){for(var a=l.util.getTypedArrayFromDType(r,l.util.sizeFromShape(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}function Gg(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,d=l.util.parseAxisParam(i,u),f=d,h=l.backend_util.getAxesPermutation(f,c),m=s.data.get(a.dataId).values;if(null!=h){for(var v=new Array(c),g=0;g<v.length;g++)v[g]=u[h[g]];m=qh(m,u,a.dtype,h,v),f=l.backend_util.getInnerMostAxes(f.length,c),u=v}Jf(a,"max"),l.backend_util.assertAxesAreInnerMostDims("max",f,c);var y=l.backend_util.computeOutAndReduceShapes(u,f),b=(0,p.Z)(y,2),x=b[0],k=b[1],w=Ug(m,l.util.sizeFromShape(k),x,a.dtype),S=s.write(w,x,a.dtype),I=x;o&&(I=v=l.backend_util.expandShapeToKeepDim(x,d));return{dataId:S,shape:I,dtype:a.dtype}}var jg={kernelName:l.Max,backendName:"cpu",kernelFunc:Gg},Hg=ch((function(e,t){return Math.max(e,t)})),qg=_h(l.Maximum,Hg),Kg={kernelName:l.Maximum,backendName:"cpu",kernelFunc:qg};var Xg={kernelName:l.MaxPool,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Jf(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;l.util.assert(l.backend_util.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,p=l.backend_util.computePool2DInfo(a.shape,i,o,1,s,u);if(1===p.filterWidth&&1===p.filterHeight&&l.util.arraysEqual(p.inShape,p.outShape))c=ih({inputs:{x:a},backend:n});else{var d=n.data.get(a.dataId).values,f=l.util.computeStrides(a.shape),h=pm(d,a.shape,a.dtype,f,p,"max");c=n.makeTensorInfo(p.outShape,a.dtype,h.values)}return c}};var Yg={kernelName:l.MaxPool3D,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;Jf(a,"maxPool3d");var p=l.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),d=fm(n.data.get(a.dataId).values,a.shape,a.dtype,l.util.computeStrides(a.shape),p,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}};var Qg={kernelName:l.MaxPool3DGrad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;Jf([a,i],"maxPool3DGrad");for(var p=l.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),d=function(e,t){for(var n=(0,l.buffer)(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,p=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.front,h=t.padInfo.top,m=t.padInfo.left,v=0;v<t.batchSize;++v)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-f,x=b;x<0;)x+=o;for(var k=Math.min(t.inDepth,c+b),w=0;w<t.outHeight;++w){for(var S=w*a-h,I=S;I<0;)I+=s;for(var N=Math.min(t.inHeight,p+S),T=0;T<t.outWidth;++T){for(var C=T*i-m,E=C;E<0;)E+=u;for(var _=Math.min(t.inWidth,d+C),A=Number.NEGATIVE_INFINITY,R=-1,F=x;F<k;F+=o)for(var D=F-b,Z=I;Z<N;Z+=s)for(var O=Z-S,M=E;M<_;M+=u){var z=M-C,L=e.get(v,F,Z,M,g);L>=A&&(A=L,R=D*p*d+O*p+z)}n.set(R,v,y,w,T,g)}}}return n}(n.bufferSync(i),p),f=p.strideDepth,h=p.strideHeight,m=p.strideWidth,v=p.dilationDepth,g=p.dilationHeight,y=p.dilationWidth,b=p.effectiveFilterDepth,x=p.effectiveFilterHeight,k=p.effectiveFilterWidth,w=b-1-p.padInfo.front,S=k-1-p.padInfo.left,I=x-1-p.padInfo.top,N=(0,l.buffer)(i.shape,"float32"),T=n.bufferSync(a),C=0;C<p.batchSize;++C)for(var E=0;E<p.inChannels;++E)for(var _=0;_<p.inDepth;++_)for(var A=0;A<p.inHeight;++A)for(var R=0;R<p.inWidth;++R){for(var F=_-w,D=A-I,Z=R-S,O=0,M=0;M<b;M+=v){var z=(F+M)/f;if(!(z<0||z>=p.outDepth||Math.floor(z)!==z))for(var L=0;L<x;L+=g){var P=(D+L)/h;if(!(P<0||P>=p.outHeight||Math.floor(P)!==P))for(var B=0;B<k;B+=y){var W=(Z+B)/m;if(!(W<0||W>=p.outWidth||Math.floor(W)!==W)){var V=b*x*k-1-d.get(C,z,P,W,E)===M*x*k+L*k+B?1:0;if(0!==V)O+=T.get(C,z,P,W,E)*V}}}}N.set(O,C,_,A,R,E)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}};var Jg={kernelName:l.MaxPoolGrad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Jf([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,p=r.dimRoundingMode,d=l.backend_util.computePool2DInfo(o.shape,s,u,1,c,p),f=n.data.get(o.dataId).values,h=(0,l.buffer)(d.outShape,o.dtype,dm(f,o.shape,o.dtype,d).values),m=d.strideHeight,v=d.strideWidth,g=d.dilationHeight,y=d.dilationWidth,b=d.effectiveFilterHeight,x=d.effectiveFilterWidth,k=x-1-d.padInfo.left,w=b-1-d.padInfo.top,S=(0,l.buffer)(o.shape,"float32"),I=n.data.get(a.dataId).values,N=(0,l.buffer)(a.shape,"float32",I),T=0;T<d.batchSize;++T)for(var C=0;C<d.inChannels;++C)for(var E=0;E<d.inHeight;++E)for(var _=0;_<d.inWidth;++_){for(var A=E-w,R=_-k,F=0,D=0;D<b;D+=g){var Z=(A+D)/m;if(!(Z<0||Z>=d.outHeight||Math.floor(Z)!==Z))for(var O=0;O<x;O+=y){var M=(R+O)/v;if(!(M<0||M>=d.outWidth||Math.floor(M)!==M)){var z=b*x-1-h.get(T,Z,M,C)===D*x+O?1:0;if(0!==z)F+=N.get(T,Z,M,C)*z}}}S.set(F,T,E,_,C)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};var $g={kernelName:l.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;Jf(a,"MaxPoolWithArgmax");var d=c.data.get(a.dataId).values,f=l.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=function(e,t,n,r,a){var i=pm(e,0,n,l.util.computeStrides(t),a,"max"),o=dm(e,t,n,a,!0,r);return[i.values,o.values]}(d,a.shape,a.dtype,u,f),m=(0,p.Z)(h,2),v=m[0],g=m[1],y=c.write(v,f.outShape,a.dtype),b=c.write(g,f.outShape,a.dtype);return[{dataId:y,shape:f.outShape,dtype:a.dtype},{dataId:b,shape:f.outShape,dtype:"int32"}]}};var ey={kernelName:l.Mean,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=l.util.parseAxisParam(i,a.shape),u=l.backend_util.computeOutAndReduceShapes(a.shape,s)[1],c=l.util.sizeFromShape(u),p=[],d=n.makeTensorInfo([],"float32",new Float32Array([c]));p.push(d);var f=Ch({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});p.push(f);var h=Mv({inputs:{a:f,b:d},backend:n});p.push(h);var m=dv({inputs:{x:h},backend:n,attrs:{axis:i,keepDims:o}});return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}};var ty={kernelName:l.Min,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;Jf(a,"min");var s=l.util.parseAxisParam(i,a.shape),u=s,c=l.backend_util.getAxesPermutation(u,a.shape.length),d=a;null!=c&&(d=Kh({inputs:{x:a},backend:n,attrs:{perm:c}}),u=l.backend_util.getInnerMostAxes(u.length,a.shape.length)),l.backend_util.assertAxesAreInnerMostDims("min",u,d.shape.length);for(var f=l.backend_util.computeOutAndReduceShapes(d.shape,u),h=(0,p.Z)(f,2),m=h[0],v=h[1],g=l.util.sizeFromShape(v),y=l.util.makeZerosTypedArray(l.util.sizeFromShape(m),d.dtype),b=n.data.get(d.dataId).values,x=0;x<y.length;++x){for(var k=x*g,w=b[k],S=0;S<g;++S){var I=b[k+S];(Number.isNaN(I)||I<w)&&(w=I)}y[x]=w}null!=c&&n.disposeIntermediateTensorInfo(d);var N=n.makeTensorInfo(m,d.dtype,y);if(o){var T=Oh({inputs:{x:N},backend:n,attrs:{shape:l.backend_util.expandShapeToKeepDim(m,s)}});return n.disposeIntermediateTensorInfo(N),T}return N}},ny=ch((function(e,t){return Math.min(e,t)})),ry=_h(l.Minimum,ny),ay={kernelName:l.Minimum,backendName:"cpu",kernelFunc:ry};var iy={kernelName:l.MirrorPad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;Jf(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),p="reflect"===o?0:1,d=n.data.get(a.dataId).values,f=a.shape.length,h=l.util.computeStrides(a.shape),m=l.util.sizeFromShape(s),v=s.length,g=l.util.computeStrides(s),y=l.util.getTypedArrayFromDType(a.dtype,m),b=0;b<m;b++){for(var x=l.util.indexToLoc(b,v,g),k=0;k<v;k++)x[k]<u[k]?x[k]=2*u[k]-x[k]-p:x[k]>=c[k]&&(x[k]=2*(c[k]-1)-x[k]+p);x=x.map((function(e,t){return e-u[t]}));var w=l.util.locToIndex(x,f,h);y[b]=d[w]}return{dataId:n.write(y,s,a.dtype),shape:s,dtype:a.dtype}}},oy=ch((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),sy=_h(l.Mod,oy),uy={kernelName:l.Mod,backendName:"cpu",kernelFunc:sy};function cy(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=l.util.parseAxisParam([s],a.shape),c=Gg({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),p=l.backend_util.expandShapeToKeepDim(c.shape,u),d=Oh({inputs:{x:c},backend:n,attrs:{shape:p}}),f=Bv({inputs:{a:a,b:d},backend:n}),h=Ev({inputs:{x:f},backend:n}),m=dv({inputs:{x:h},backend:n,attrs:{axis:u,keepDims:!1}}),v=Oh({inputs:{x:m},backend:n,attrs:{shape:p}}),g=Mv({inputs:{a:h,b:v},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),g}var ly={kernelName:l.Softmax,backendName:"cpu",kernelFunc:cy};var py={kernelName:l.Multinomial,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;Jf(a,"multinomial");for(var u=s?a:cy({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],p=u.shape[1],d=n.data.get(u.dataId).values,f=[c,i],h=l.util.makeZerosTypedArray(l.util.sizeFromShape(f),"int32"),m=0;m<c;++m){var v=m*p,g=new Float32Array(p-1);g[0]=d[v];for(var y=1;y<g.length;++y)g[y]=g[y-1]+d[v+y];for(var b=Zd.alea(o.toString()),x=m*i,k=0;k<i;++k){var w=b();h[x+k]=g.length;for(var S=0;S<g.length;S++)if(w<g[S]){h[x+k]=S;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(f,"int32",h)}};function dy(e,t,n){var r=l.util.createScalarValue(-1,n);return uv([],t,r,e,n)}var fy={kernelName:l.Neg,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;Jf(r,"neg");var a=dy(n.data.get(r.dataId).values,r.shape,r.dtype),i=(0,p.Z)(a,2),o=i[0],s=i[1];return n.makeTensorInfo(s,r.dtype,o)}},hy=l.kernel_impls.nonMaxSuppressionV3Impl;var my={kernelName:l.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;Jf(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=hy(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},vy=l.kernel_impls.nonMaxSuppressionV4Impl;var gy={kernelName:l.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;Jf(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,d=vy(l,p,o,s,u,c),f=d.selectedIndices,h=d.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},yy=l.kernel_impls.nonMaxSuppressionV5Impl;var by={kernelName:l.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;Jf(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,d=yy(l,p,o,s,u,c),f=d.selectedIndices,h=d.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}},xy=ch((function(e,t){return e!==t?1:0})),ky=_h(l.NotEqual,xy,null,"bool"),wy={kernelName:l.NotEqual,backendName:"cpu",kernelFunc:ky};var Sy={kernelName:l.OneHot,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue;Jf(a,"oneHot");var u=l.util.sizeFromShape(a.shape),c=new Float32Array(u*i);c.fill(s);for(var p=n.data.get(a.dataId).values,d=0;d<u;++d)p[d]>=0&&p[d]<i&&(c[d*i+p[d]]=o);return n.makeTensorInfo([].concat((0,Qn.Z)(a.shape),[i]),"int32",c)}};function Iy(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=Nh({inputs:{input:r},backend:n}),i=Iy({inputs:{x:a},backend:n}),o=Zm({inputs:{input:r},backend:n}),s=Iy({inputs:{x:o},backend:n}),u=wh({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return Hv({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var Ny={kernelName:l.ZerosLike,backendName:"cpu",kernelFunc:Iy};var Ty={kernelName:l.OnesLike,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=Nh({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=Zm({inputs:{input:a},backend:r}),u=Iy({inputs:{x:s},backend:r}),c=wh({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return Hv({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function Cy(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return Av({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){l.util.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),l.util.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=Mm({inputs:t.map((function(e){var t=Av({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}var Ey={kernelName:l.Pack,backendName:"cpu",kernelFunc:Cy};var _y={kernelName:l.PadV2,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;Jf(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,p=l.util.sizeFromShape(a.shape),d=a.shape.length,f=l.util.computeStrides(a.shape),h=l.util.sizeFromShape(s),m=s.length,v=l.util.computeStrides(s),g=l.util.getTypedArrayFromDType(a.dtype,h);0!==o&&g.fill(o);for(var y=0;y<p;y++){var b=l.util.indexToLoc(y,d,f).map((function(e,t){return e+u[t]}));g[l.util.locToIndex(b,m,v)]=c[y]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},Ay=ch((function(e,t){return Math.pow(e,t)})),Ry=_h(l.Pow,Ay),Fy={kernelName:l.Pow,backendName:"cpu",kernelFunc:Ry};function Dy(e,t,n,r){for(var a=l.backend_util.computeOutAndReduceShapes(e,r),i=(0,p.Z)(a,2),o=i[0],s=i[1],u=(0,l.upcastType)(t,"int32"),c=l.util.makeZerosTypedArray(l.util.sizeFromShape(o),u),d=l.util.sizeFromShape(s),f=0;f<c.length;++f){for(var h=f*d,m=1,v=0;v<d;++v)m*=n[h+v];c[f]=m}return{outVals:c,outShape:o,outDtype:u}}var Zy={kernelName:l.Prod,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;Jf(a,"prod");var s=a.shape.length,u=l.util.parseAxisParam(i,a.shape),c=l.backend_util.getAxesPermutation(u,s),p=u,d=a,f=[];null!=c&&(d=Kh({inputs:{x:a},backend:n,attrs:{perm:c}}),f.push(d),p=l.backend_util.getInnerMostAxes(p.length,s));var h=n.data.get(d.dataId).values,m=Dy(d.shape,d.dtype,h,p),v=m.outVals,g=m.outShape,y=m.outDtype,b=g;return o&&(b=l.backend_util.expandShapeToKeepDim(g,u)),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(b,y,v)}};function Oy(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return l.util.makeZerosTypedArray(0,r);var a=Math.abs(Math.ceil((t-e)/n)),i=l.util.makeZerosTypedArray(a,r);t<e&&1===n&&(n=-1),i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return i}var My={kernelName:l.Range,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=Oy(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},zy=th(l.Reciprocal,(function(e){return 1/e})),Ly={kernelName:l.Reciprocal,backendName:"cpu",kernelFunc:zy};var Py={kernelName:l.ResizeBilinear,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;Jf(a,"resizeBilinear");for(var u=l.util.computeStrides(a.shape),c=(0,p.Z)(s,2),d=c[0],f=c[1],h=(0,p.Z)(a.shape,4),m=h[0],v=h[1],g=h[2],y=h[3],b=n.data.get(a.dataId).values,x=new Float32Array(l.util.sizeFromShape([m,d,f,y])),k=[i&&d>1?v-1:v,i&&f>1?g-1:g],w=[i&&d>1?d-1:d,i&&f>1?f-1:f],S=0,I=k[0]/w[0],N=k[1]/w[1],T=0;T<m;T++)for(var C=0;C<d;C++){var E=void 0;E=o?I*(C+.5)-.5:I*C;for(var _=Math.max(0,Math.floor(E)),A=E-_,R=Math.min(v-1,Math.ceil(E)),F=T*u[0]+_*u[1],D=T*u[0]+R*u[1],Z=0;Z<f;Z++){var O=void 0;O=o?N*(Z+.5)-.5:N*Z;for(var M=Math.max(0,Math.floor(O)),z=O-M,L=Math.min(g-1,Math.ceil(O)),P=F+M*u[2],B=D+M*u[2],W=F+L*u[2],V=D+L*u[2],U=0;U<y;U++){var G=b[P+U],j=b[B+U],H=G+(b[W+U]-G)*z,q=H+(j+(b[V+U]-j)*z-H)*A;x[S++]=q}}}return n.makeTensorInfo([m,d,f,y],"float32",x)}};var By={kernelName:l.ResizeBilinearGrad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;Jf([i,a],"resizeBilinearGrad");for(var s=l.util.computeStrides(a.shape),u=(0,p.Z)(a.shape,4),c=u[0],d=u[1],f=u[2],h=u[3],m=(0,p.Z)(i.shape,3),v=m[1],g=m[2],y=new Float32Array(c*d*f*h),b=[o&&v>1?d-1:d,o&&g>1?f-1:f],x=[o&&v>1?v-1:v,o&&g>1?g-1:g],k=b[0]/x[0],w=b[1]/x[1],S=n.data.get(i.dataId).values,I=0,N=0;N<c;N++)for(var T=N*s[0],C=0;C<v;C++)for(var E=C*k,_=Math.floor(E),A=Math.min(Math.ceil(E),d-1),R=T+_*s[1],F=T+A*s[1],D=E-_,Z=1-D,O=0;O<g;O++)for(var M=O*w,z=Math.floor(M),L=Math.min(Math.ceil(M),f-1),P=M-z,B=1-P,W=R+z*s[2],V=R+L*s[2],U=F+z*s[2],G=F+L*s[2],j=Z*B,H=Z*P,q=D*B,K=D*P,X=0;X<h;X++){var Y=S[I++];y[W+X]+=Y*j,y[V+X]+=Y*H,y[U+X]+=Y*q,y[G+X]+=Y*K}return n.makeTensorInfo([c,f,d,h],"float32",y)}};var Wy={kernelName:l.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;Jf(a,"resizeNearestNeighbor");for(var u=l.util.computeStrides(a.shape),c=(0,p.Z)(s,2),d=c[0],f=c[1],h=(0,p.Z)(a.shape,4),m=h[0],v=h[1],g=h[2],y=h[3],b=n.data.get(a.dataId).values,x=new Float32Array(m*d*f*y),k=[i&&d>1?v-1:v,i&&f>1?g-1:g],w=[i&&d>1?d-1:d,i&&f>1?f-1:f],S=k[0]/w[0],I=k[1]/w[1],N=0,T=0;T<m;T++)for(var C=T*u[0],E=0;E<d;E++){var _=o?S*(E+.5):S*E,A=Math.min(v-1,i?Math.round(_):Math.floor(_));o&&(A=Math.max(0,A));for(var R=C+A*u[1],F=0;F<f;F++){var D=o?I*(F+.5):I*F,Z=Math.min(g-1,i?Math.round(D):Math.floor(D));o&&(Z=Math.max(0,Z));for(var O=R+Z*u[2],M=0;M<y;M++){var z=b[O+M];x[N++]=z}}}return n.makeTensorInfo([m,d,f,y],a.dtype,x)}};var Vy={kernelName:l.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;Jf([i,a],"resizeNearestNeighborGrad");for(var s=l.util.computeStrides(a.shape),u=l.util.computeStrides(i.shape),c=(0,p.Z)(a.shape,4),d=c[0],f=c[1],h=c[2],m=c[3],v=(0,p.Z)(i.shape,3),g=v[1],y=v[2],b=new Float32Array(d*f*h*m),x=n.data.get(i.dataId).values,k=[o&&g>1?f-1:f,o&&y>1?h-1:h],w=[o&&g>1?g-1:g,o&&y>1?y-1:y],S=k[0]/w[0],I=k[1]/w[1],N=1/S,T=1/I,C=2*Math.ceil(N)+2,E=2*Math.ceil(T)+2,_=0;_<d;_++)for(var A=_*s[0],R=0;R<f;R++)for(var F=A+R*s[1],D=Math.floor(R*N),Z=Math.floor(D-C/2),O=0;O<h;O++)for(var M=F+O*s[2],z=Math.floor(O*T),L=Math.floor(z-E/2),P=0;P<m;P++){for(var B=0,W=0;W<C;W++){var V=W+Z;if(!(V<0||V>=g)){var U=A+V*u[1],G=V*S;if(R===Math.min(f-1,o?Math.round(G):Math.floor(G)))for(var j=0;j<E;j++){var H=j+L;if(!(H<0||H>=y)){var q=U+H*u[2],K=H*I;O===Math.min(h-1,o?Math.round(K):Math.floor(K))&&(B+=x[q+P])}}}}b[M+P]=B}return n.makeTensorInfo(a.shape,a.dtype,b)}};var Uy={kernelName:l.Reverse,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;Jf(a,"reverse");var o=a.shape.length,s=l.util.parseAxisParam(i,a.shape);if(0===o)return ih({inputs:{x:a},backend:n});for(var u=new l.TensorBuffer(a.shape,a.dtype),c=n.bufferSync(a),p=function(e){var t=u.indexToLoc(e),n=t.slice();s.forEach((function(e){return n[e]=a.shape[e]-1-n[e]})),u.set.apply(u,[c.get.apply(c,(0,Qn.Z)(n))].concat((0,Qn.Z)(t)))},d=0;d<u.size;d++)p(d);return n.makeTensorInfo(u.shape,u.dtype,u.values)}},Gy={kernelName:l.RotateWithOffset,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=l.util.getTypedArrayFromDType(a.dtype,l.util.sizeFromShape(a.shape)),d=(0,p.Z)(a.shape,4),f=d[0],h=d[1],m=d[2],v=d[3],g=l.backend_util.getImageCenter(s,h,m),y=(0,p.Z)(g,2),b=y[0],x=y[1],k=Math.sin(i),w=Math.cos(i),S=u.data.get(a.dataId).values,I=0;I<f;I++)for(var N=I*m*h*v,T=0;T<h;T++)for(var C=T*(m*v),E=0;E<m;E++)for(var _=E*v,A=0;A<v;A++){var R=[f,T,E,A],F=R[2],D=R[1],Z=(F-b)*w-(D-x)*k,O=(F-b)*k+(D-x)*w;Z=Math.round(Z+b),O=Math.round(O+x);var M=o;if("number"!==typeof o&&(M=3===A?255:o[A]),Z>=0&&Z<m&&O>=0&&O<h)M=S[N+O*(m*v)+Z*v+A];c[N+C+_+A]=M}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},jy=th(l.Round,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),Hy={kernelName:l.Round,backendName:"cpu",kernelFunc:jy},qy=gh((function(e){return 1/Math.sqrt(e)})),Ky=nh(l.Rsqrt,qy),Xy={kernelName:l.Rsqrt,backendName:"cpu",kernelFunc:Ky};function Yy(e,t,n,r,a,i,o,s,u,c){var p=[r/a,a],d=e.values,f=t.values;if(0===r)return(0,l.buffer)(n,t.dtype);var h=(0,l.buffer)(p,t.dtype);"string"===typeof u||"number"===typeof u?h.values.fill(u):"boolean"===typeof u&&h.values.fill(+u);for(var m=0;m<i;m++){for(var v=[],g=0,y=0;y<o;y++){var b=d[m*o+y];v.push(b),g+=b*s[y]}if(g<0||g>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(n));for(var x=0;x<a;x++)c?h.values[g*a+x]+=f[m*a+x]:h.values[g*a+x]=0===t.rank?f[0]:f[m*a+x]}return h}var Qy={kernelName:l.ScatterNd,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=l.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,p=s.sliceSize,d=s.strides,f=s.outputSize,h=Yy(n.bufferSync(a),n.bufferSync(i),o,f,p,c,u,d,0,!0);return n.makeTensorInfo(o,h.dtype,h.values)}};function Jy(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function $y(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var eb={kernelName:l.SearchSorted,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=l.util.getArrayFromDType("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,p=0;p<a;++p)o[c+p]="left"===i?Jy(u,t[p+c]):$y(u,t[p+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var tb={kernelName:l.Select,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;Jf([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,p=(0,l.upcastType)(a.dtype,i.dtype),d=l.util.makeZerosTypedArray(l.util.sizeFromShape(a.shape),p),f=0,h=0===o||o>1||1===a.shape.length?1:l.util.sizeFromShape(a.shape.slice(1)),m=0;m<s.length;m++)for(var v=0;v<h;v++)1===s[m]?d[f++]=u[m]:d[f++]=c[m];return n.makeTensorInfo(a.shape,p,d)}},nb=l.backend_util.SELU_SCALEALPHA,rb=l.backend_util.SELU_SCALE,ab=th(l.Selu,(function(e){return e>=0?rb*e:nb*(Math.exp(e)-1)})),ib={kernelName:l.Selu,backendName:"cpu",kernelFunc:ab},ob=th(l.Sign,(function(e){return e<0?-1:e>0?1:0})),sb={kernelName:l.Sign,backendName:"cpu",kernelFunc:ob},ub=th(l.Sin,(function(e){return Math.sin(e)})),cb={kernelName:l.Sin,backendName:"cpu",kernelFunc:ub},lb=th(l.Sinh,(function(e){return Math.sinh(e)})),pb={kernelName:l.Sinh,backendName:"cpu",kernelFunc:lb},db=Math.log(1.1920928955078125e-7)+2,fb=th(l.Softplus,(function(e){var t=e>-db,n=e<db,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),hb={kernelName:l.Softplus,backendName:"cpu",kernelFunc:fb};var mb={kernelName:l.SpaceToBatchND,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;Jf([a],"spaceToBatchND");var s=l.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,(0,Qn.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var p=_y.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=l.backend_util.getReshaped(p.shape,i,s,!1),f=l.backend_util.getPermuted(d.length,i.length,!1),h=l.backend_util.getReshapedPermuted(p.shape,i,s,!1),m=Oh({inputs:{x:p},backend:n,attrs:{shape:d}}),v=Kh({inputs:{x:m},backend:n,attrs:{perm:f}}),g=Oh({inputs:{x:v},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),g}};function vb(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),p=new Array(s),d=t[1];if(0===u){if(0!==s)throw new Error(l.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));return[l.util.getArrayFromDType(n,0),[0,d],l.util.getArrayFromDType(a,0),c,p]}for(var f=!0,h=0,m=new Array(u).fill(0),v=0;v<s;++v){var g=e[v*d];if(g<0)throw new Error(l.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(v,g));if(g>=u)throw new Error(l.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(v,g,u));++m[g],f=f&&g>=h,h=g}for(var y=!0,b=0;b<u;++b){var x=0===m[b];c[b]=x,y=y&&!x,m[b]=Math.max(m[b],1),b>0&&(m[b]+=m[b-1])}if(y&&f){for(var k=e,w=r,S=0;S<s;++S)p[S]=S;return[k,[s,d],w,c,p]}for(var I=m[u-1],N=l.util.getArrayFromDType(n,I*d),T=l.util.getArrayFromDType(a,I),C=new Array(u).fill(0),E=0;E<s;++E){var _=e[E*d],A=C[_],R=(0===_?0:m[_-1])+A;C[_]++;for(var F=0;F<d;++F)N[R*d+F]=e[E*d+F];T[R]=r[E],p[E]=R}for(var D=0;D<u;++D){if(0===C[D]){var Z=0===D?0:m[D-1];N[Z*d+0]=D;for(var O=1;O<d;++O)N[Z*d+O]=0;T[Z]=o}}return[N,[I,d],T,c,p]}var gb={kernelName:l.SparseFillEmptyRows,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],d=vb(s,r.shape,r.dtype,u,a.dtype,c,l),f=(0,p.Z)(d,5),h=f[0],m=f[1],v=f[2],g=f[3],y=f[4];return[n.makeTensorInfo(m,r.dtype,h),n.makeTensorInfo([m[0]],a.dtype,v),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}};function yb(e,t,n,r,a){for(var i=l.util.sizeFromShape(r),o=t[0],s=a.length,u=[],c=1,p=-1,d=0;d<s;++d){var f=a[d];if(-1===f){if(-1!==p)throw new Error(l.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(p,d));p=d,u.push(1)}else{if(f<0)throw new Error(l.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(d,f));c*=f,u.push(f)}}if(-1!==p){if(c<=0)throw new Error(l.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var h=Math.trunc(i/c);if(c*h!==i)throw new Error(l.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[p]=h}if(l.util.sizeFromShape(u)!==i)throw new Error(l.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var m=r.length,v=[];if(m>0){v[m-1]=1;for(var g=m-2;g>=0;--g)v[g]=v[g+1]*r[g+1]}var y=[];if(s>0){y[s-1]=1;for(var b=s-2;b>=0;--b)y[b]=y[b+1]*u[b+1]}for(var x=l.util.getArrayFromDType(n,o*s),k=0;k<o;++k){for(var w=0,S=0;S<m;++S)w+=e[k*m+S]*v[S];for(var I=0;I<s;++I)x[k*s+I]=Math.trunc(w/y[I]),w%=y[I]}return[x,[o,s],u]}var bb={kernelName:l.SparseReshape,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),c=yb(s,r.shape,r.dtype,o,u),l=(0,p.Z)(c,3),d=l[0],f=l[1],h=l[2];return[n.makeTensorInfo(f,r.dtype,d),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};function xb(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],p=s>0?a[s-1]+1:0,d=p;if(d<0)throw new Error(l.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var f=t.slice();f[0]=d;var h=f.reduce((function(e,t){return e*t}),1),m=l.util.getArrayFromDType(n,h);if(0===s)return d>0&&m.fill(o),[m,f];if(d<=0)throw new Error(l.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,g=1,y=0,b=a[v];;){var x=0;if(g<s){if(b===(x=a[g])){++g;continue}if(b>=x)throw new Error(l.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(b<0||b>=d)throw new Error(l.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(b,d));b>y&&m.fill(o,y*c,b*c);for(var k=v;k<g;++k){var w=r[k];if(w<0||w>=u[0])throw new Error(l.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(k,r[k],u[0]));for(var S=0;S<c;S++)m[b*c+S]+=e[w*c+S]}if(i)for(var I=0;I<c;I++)m[b*c+I]/=g-v;if(v=g,y=b+1,b=x,++g>s)break}return y<d&&m.fill(o,y*c,d*c),[m,f]}var kb={kernelName:l.SparseSegmentMean,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=xb(o,r.shape,r.dtype,s,u,!0),l=(0,p.Z)(c,2),d=l[0],f=l[1];return n.makeTensorInfo(f,r.dtype,d)}};var wb={kernelName:l.SparseSegmentSum,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=xb(o,r.shape,r.dtype,s,u),l=(0,p.Z)(c,2),d=l[0],f=l[1];return n.makeTensorInfo(f,r.dtype,d)}};var Sb={kernelName:l.SparseToDense,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=l.backend_util.calculateShapes(o,i,u),p=c.sliceRank,d=c.numUpdates,f=c.sliceSize,h=c.strides,m=c.outputSize,v=!1,g=r.bufferSync(i);switch(o.dtype){case"bool":t=Yy(g,r.bufferSync(o),u,m,f,d,p,h,Boolean(r.data.get(s.dataId).values[0]),v);break;case"float32":t=Yy(g,r.bufferSync(o),u,m,f,d,p,h,r.data.get(s.dataId).values[0],v);break;case"int32":t=Yy(g,r.bufferSync(o),u,m,f,d,p,h,r.data.get(s.dataId).values[0],v);break;case"string":t=Yy(g,r.bufferSync(o),u,m,f,d,p,h,l.util.decodeString(r.data.get(s.dataId).values[0]),v);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var Ib={kernelName:l.SplitV,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=l.util.parseAxisParam(o,a.shape)[0],u=l.backend_util.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),p=a.shape.slice();return u.map((function(e){var t=(0,Qn.Z)(p);t[s]=e;var r=xm({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[s]+=e,r}))}},Nb=gh((function(e){return Math.sqrt(e)})),Tb=th(l.Sqrt,(function(e){return Math.sqrt(e)})),Cb={kernelName:l.Sqrt,backendName:"cpu",kernelFunc:Tb},Eb={kernelName:l.Square,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;Jf(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},_b=ch((function(e,t){var n=e-t;return n*n})),Ab=_h(l.SquaredDifference,_b),Rb={kernelName:l.SquaredDifference,backendName:"cpu",kernelFunc:Ab},Fb=th(l.Step,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),Db={kernelName:l.Step,backendName:"cpu",kernelFunc:Fb};function Zb(e,t,n,r){for(var a=(0,l.buffer)(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat((0,Qn.Z)(o)))}return a}var Ob={kernelName:l.StridedSlice,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,p=r.ellipsisMask,d=r.newAxisMask,f=r.shrinkAxisMask;Jf(a,"stridedSlice");var h,m=l.slice_util.sliceInfo(a.shape,i,o,s,u,c,p,d,f),v=m.finalShapeSparse,g=m.finalShape,y=m.isIdentity,b=m.sliceDim0,x=m.isSimpleSlice,k=m.begin,w=m.end,S=m.strides;if(y)h=Oh({inputs:{x:a},backend:n,attrs:{shape:g}});else if(b||x){l.util.assert(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var I=l.slice_util.computeOutShape(k,w,S),N=xm({inputs:{x:a},backend:n,attrs:{begin:k,size:I}});h=Oh({inputs:{x:N},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(N)}else{var T=Zb(v,n.bufferSync(a),S,k);h=n.makeTensorInfo(g,T.dtype,T.values)}return h}},Mb=function(){function e(t,n,r,a,i,o){(0,aa.Z)(this,e),this.separator=l.util.encodeString(t),this.nGramWidths=n,this.leftPad=l.util.encodeString(r),this.rightPad=l.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return(0,ia.Z)(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(s){var u=o.getPadWidth(i),c=Math.max(0,u-s),l=Math.max(0,u-(a-(s+1))),p=i-(c+l),d=t+(c>0?0:s-u),f=0;f+=c*o.leftPad.length;for(var h=0;h<p;++h)f+=e[d+h].length;f+=l*o.rightPad.length,f+=(c+l+p-1)*o.separator.length,n[r+s]=new Uint8Array(f);for(var m=n[r+s],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<p-1;++b)g(e[d+b]),g(o.separator);if(p>0){g(e[d+p-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var k=0;k<l-1;++k)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s(u)}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=l.util.getArrayFromDType("int32",a);if(0===r||0===a){for(var p=new Array(r),d=0;d<=u;++d)c[d]=0;return[p,c]}c[0]=0;for(var f=function(e){var r=t[e]-t[e-1],a=0;n.nGramWidths.forEach((function(e){a+=n.getNumNGrams(r,e)})),n.preserveShort&&r>0&&0===a&&(a=1),c[e]=c[e-1]+a},h=1;h<=u;++h)f(h);for(var m=new Array(c[u]),v=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,m,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,m,i,1,s)}},g=0;g<u;++g)v(g);return[m,c]}}]),e}();function zb(e,t,n,r,a,i,o,s){return new Mb(n,r,a,i,o,s).compute(e,t)}var Lb={kernelName:l.StringNGrams,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,d=t.dataSplits,f=zb(n.data.get(l.dataId).values,n.data.get(d.dataId).values,a,i,o,s,u,c),h=(0,p.Z)(f,2),m=h[0],v=h[1];return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(d.shape,"int32",v)]}};function Pb(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);n&&0===o.length||r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);n&&0===c.length||r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}n&&0===e.length||r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function Bb(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;Pb(e[u],t,n,a);var p=a.length-c;s[u]=p,i+=p,o=Math.max(o,p)}for(var d=l.util.getArrayFromDType("int32",2*i),f=new Array(i),h=[r,o],m=0,v=0;v<r;++v)for(var g=0;g<s[v];++g)d[2*m]=v,d[2*m+1]=g,f[m]=a[m],++m;return[d,f,h]}var Wb={kernelName:l.StringSplit,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=Bb(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),s=(0,p.Z)(o,3),u=s[0],c=s[1],l=s[2],d=c.length;return[n.makeTensorInfo([d,2],"int32",u),n.makeTensorInfo([d],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(l))]}};function Vb(e,t){for(var n=l.util.getArrayFromDType("int32",e.length),r=0;r<e.length;++r)n[r]=l.util.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var Ub={kernelName:l.StringToHashBucketFast,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=Vb(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},Gb=th(l.Tan,(function(e){return Math.tan(e)})),jb={kernelName:l.Tan,backendName:"cpu",kernelFunc:Gb},Hb=th(l.Tanh,(function(e){return Math.tanh(e)})),qb={kernelName:l.Tanh,backendName:"cpu",kernelFunc:Hb};function Kb(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=(0,l.buffer)(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var Xb={kernelName:l.Tile,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;Jf(a,"tile");var o=Kb(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},Yb=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function Qb(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(n,Math.floor(t-i*s/a+u)),p=Math.min(r,Math.floor(t+(a-i)*s/a+u));Qb(e,t,c,p)}var d=e[t],f=n,h=r;for(l.util.swap(e,n,t),Yb(e[r],d)>0&&l.util.swap(e,n,r);f<h;){for(l.util.swap(e,f,h),f++,h--;Yb(e[f],d)<0;)f+=1;for(;Yb(e[h],d)>0;)h-=1}0===Yb(e[n],d)?l.util.swap(e,n,h):(h+=1,l.util.swap(e,h,r)),h<=t&&(n=h+1),t<=h&&(r=h-1)}}function Jb(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=l.util.getTypedArrayFromDType(n,o*r),c=l.util.getTypedArrayFromDType("int32",o*r),p=function(t){var n=t*s,i=e.subarray(n,n+s),o=new Array(i.length);i.forEach((function(e,t){return o[t]={value:e,index:t}})),r<o.length&&(Qb(o,r),o=o.slice(0,r)),a&&o.sort(Yb);for(var l=t*r,p=u.subarray(l,l+r),d=c.subarray(l,l+r),f=0;f<r;f++)p[f]=o[f].value,d[f]=o[f].index},d=0;d<o;d++)p(d);var f=t.slice();return f[f.length-1]=r,[(0,l.buffer)(f,n,u),(0,l.buffer)(f,"int32",c)]}var $b={kernelName:l.TopK,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;Jf(a,"topk");var s=Jb(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),u=(0,p.Z)(s,2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var ex={kernelName:l.Transform,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,d=(0,p.Z)(a.shape,4),f=d[0],h=d[1],m=d[2],v=d[3],g=null!=c?c:[h,m],y=(0,p.Z)(g,2),b=y[0],x=y[1],k=[f,b,x,v],w=l.util.computeStrides(a.shape),S=w[0],I=w[1],N=w[2],T=l.util.getTypedArrayFromDType(a.dtype,l.util.sizeFromShape(k));T.fill(u);for(var C=r.data.get(a.dataId).values,E=r.data.get(i.dataId).values,_=0;_<f;++_){for(var A=1===i.shape[0]?E:E.subarray(8*_,8*_+8),R=0;R<b;++R)for(var F=0;F<x;++F)for(var D=0;D<v;++D){var Z=void 0,O=A[6]*F+A[7]*R+1;if(0!==O){var M=(A[0]*F+A[1]*R+A[2])/O,z=(A[3]*F+A[4]*R+A[5])/O,L=tx(M,m,s),P=tx(z,h,s);switch(o){case"nearest":Z=rx(C,h,m,S,I,N,_,P,L,D,u);break;case"bilinear":Z=ax(C,h,m,S,I,N,_,P,L,D,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}T[_*S+R*I+F*N+D]=Z}}return r.makeTensorInfo(k,a.dtype,T)}return{dataId:r.write(T,k,a.dtype),shape:a.shape,dtype:a.dtype}}};function tx(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return l.util.clamp(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return l.util.clamp(0,n,t-1)}(e,t);case"nearest":return function(e,t){return l.util.clamp(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function nx(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function rx(e,t,n,r,a,i,o,s,u,c,l){return nx(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function ax(e,t,n,r,a,i,o,s,u,c,l){var p=Math.floor(s),d=Math.floor(u),f=p+1,h=d+1;return(f-s)*((h-u)*nx(e,t,n,r,a,i,o,p,d,c,l)+(u-d)*nx(e,t,n,r,a,i,o,p,h,c,l))+(s-p)*((h-u)*nx(e,t,n,r,a,i,o,f,d,c,l)+(u-d)*nx(e,t,n,r,a,i,o,f,h,c,l))}function ix(e,t,n,r){for(var a=l.util.parseAxisParam(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),p=new l.TensorBuffer(i,r,e),d=[],f=1===i[0]&&1===i[2],h=0;h<n[a];h++){var m=void 0;if(f)m=e[h].toString();else{for(var v=[],g=0;g<i[0];g++)for(var y=0;y<i[2];y++)v.push(p.get(g,h,y));m=v.join(",")}if(void 0!==u[m])c[h]=u[m];else{var b=Object.keys(u).length;u[m]=b,c[h]=b,d.push(h)}}var x=i.slice();x[1]=Object.keys(u).length;var k=new l.TensorBuffer(x,r);d.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)k.set(p.get(n,e,r),n,t,r)}));var w=n.slice();return w[a]=x[1],{outputValues:k.values,outputShape:w,indices:c}}var ox={kernelName:l.Unique,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;Jf(i,"unique");var o=ix(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var sx={kernelName:l.Unpack,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o).fill(0),d=a.shape.slice();d[i]=1;for(var f=new Array(s),h=0;h<f.length;h++){p[i]=h;var m=xm({inputs:{x:a},backend:n,attrs:{begin:p,size:d}});f[h]=Oh({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return f}};for(var ux={kernelName:l.UnsortedSegmentSum,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;Jf(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,p=i,d=0;d<c;++d){var f=Av({inputs:{input:p},backend:n,attrs:{dim:d+1}});p=f,u.push(f)}for(var h=0;h<o;++h){var m=l.util.createScalarValue(h,"int32"),v=n.makeTensorInfo([],"int32",m),g=gv({inputs:{a:v,b:p},backend:n}),y=Ch({inputs:{x:g},backend:n,attrs:{dtype:"float32"}}),b=lv({inputs:{a:y,b:a},backend:n}),x=dv({inputs:{x:b},backend:n,attrs:{axis:0,keepDims:!1}});s.push(x),u.push(v),u.push(g),u.push(y),u.push(b),u.push(x)}var k=Cy({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),k}},cx=0,lx=[Ph,Wh,Uh,jh,Zh,Hh,Yh,Qh,Jh,$h,tm,rm,im,um,lm,hm,mm,vm,gm,Lh,ym,wm,Nm,Tm,Eh,_m,Rm,Sh,Fm,zm,Pm,Bm,Wm,Vm,Um,Gm,Hm,Km,Xm,Ym,Qm,Jm,$m,tv,nv,rv,av,iv,ov,sv,hv,ah,mv,yv,Tv,_v,Rv,Zv,jv,qv,Kv,Qv,eg,tg,ng,ag,og,cg,dg,oh,fg,Om,mg,gg,bg,uh,wg,Ng,Cg,Ag,Fg,Og,zg,Bg,Wg,Vg,jg,Kg,Xg,Yg,Qg,Jg,$g,ey,ty,ay,iy,uy,py,pv,fy,my,gy,by,wy,Sy,Ty,Ey,_y,Fy,dh,Zy,My,Th,zv,Ly,hh,vh,Mh,Py,By,Wy,Vy,Uy,Gy,Hy,Xy,Qy,eb,tb,ib,xh,sb,cb,pb,km,ly,hb,mb,gb,bb,kb,wb,Sb,Ib,Cb,Eb,Rb,Db,Ob,Lb,Wb,Ub,Wv,fv,jb,qb,Xb,$b,ex,Xh,ox,sx,ux,Ny];cx<lx.length;cx++){var px=lx[cx];(0,l.registerKernel)(px)}var dx,fx,hx,mx={},vx={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function gx(e,t){if(!(e in mx)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if("undefined"!==typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;if(n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete mx[e]}),!1),1===e)return n.getContext("webgl",vx)||n.getContext("experimental-webgl",vx);return n.getContext("webgl2",vx)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;mx[e]=n}var r=mx[e];return null==r||r.isContextLost()?(delete mx[e],gx(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),mx[e])}function yx(e,t){return[t,e]}function bx(e){var t=l.util.sizeFromShape(e),n=Math.ceil(t/4);return l.util.sizeToSquarishShape(n)}function xx(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function kx(e,t){var n,r,a,i,o,s,u,c,p,d,f=e;return 2===(0,l.env)().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,a=f.RGBA16F,i=f.RGBA32F,o=f.RED,u=4,c=1,p=f.HALF_FLOAT,d=f.FLOAT,s=f.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=f.RGBA,o=e.RGBA,u=4,c=4,p=null!=t?t.HALF_FLOAT_OES:null,d=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:p,textureTypeFloat:d}}function wx(e,t){var n=t();return(0,l.env)().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(dx||(dx={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(fx||(fx={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(hx||(hx={}));function Sx(e){return!!((0,l.env)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Ix(e,t){return zx(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}var Nx,Tx,Cx=/ERROR: [0-9]+:([0-9]+):/g;function Ex(e,t){var n=Cx.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return l.util.rightPad((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),p=o.slice(r-1,r),d=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(l.util.rightPad(p[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join("\n"))}function _x(e,t){if(wx(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Ax(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(wx(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),wx(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),wx(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function Rx(e,t,n){return zx(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function Fx(e,t,n){return e.getUniformLocation(t,n)}function Dx(e,t,n,r){wx(e,(function(){return function(e,t,n){Lx(e,n),wx(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),wx(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),wx(e,(function(){return e.uniform1i(n,r)}))}function Zx(e,t,n){wx(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),wx(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function Ox(e,t){wx(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),wx(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function Mx(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function zx(e,t,n){var r=wx(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function Lx(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function Px(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return l.util.sizeFromShape(e.slice(0,e.length-t))}function Bx(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Wx(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Px(e)].concat((0,Qn.Z)(Bx(e)))),t}function Vx(e){return e%2===0}function Ux(e,t){if(e=e.slice(-2),t=t.slice(-2),l.util.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Vx(n)&&Vx(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Vx(e[0])&&Vx(t[0])}function Gx(e,t){return null!=e.getExtension(t)}function jx(e){try{if(null!=gx(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function Hx(e){if(0===e)return!1;var t=gx(e);if(1!==e){if(Gx(t,"EXT_color_buffer_float"))return qx(t);var n="EXT_color_buffer_half_float";if(Gx(t,n)){var r=t.getExtension(n);return function(e,t){var n=kx(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!!Gx(t,"OES_texture_float")&&(!!Gx(t,"WEBGL_color_buffer_float")&&qx(t))}function qx(e){var t=kx(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function Kx(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&l.util.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var Xx=(0,l.env)();function Yx(){var e,t,n,r,a,i,o,s,u,c;return 2===(0,l.env)().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Qx(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=l.util.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function Jx(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=l.util.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function $x(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}function ek(e){var t=l.util.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}Xx.registerFlag("HAS_WEBGL",(function(){return Xx.getNumber("WEBGL_VERSION")>0})),Xx.registerFlag("WEBGL_VERSION",(function(){return jx(2)?2:jx(1)?1:0})),Xx.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),Xx.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Xx.get("WEBGL_VERSION")})),Xx.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Xx.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Xx.registerFlag("WEBGL_PACK",(function(){return Xx.getBool("HAS_WEBGL")})),Xx.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_PACK_CLIP",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_PACK_REDUCE",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_CONV_IM2COL",(function(){return Xx.getBool("WEBGL_PACK")})),Xx.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==Nx){var t=gx(e);Nx=t.getParameter(t.MAX_TEXTURE_SIZE)}return Nx}(Xx.getNumber("WEBGL_VERSION"))})),Xx.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==Tx){var t=gx(e);Tx=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Tx)}(Xx.getNumber("WEBGL_VERSION"))})),Xx.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Xx.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=gx(e);return Gx(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:Gx(t,"EXT_disjoint_timer_query")?1:0}(e)})),Xx.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Xx.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!l.device_util.isMobile()})),Xx.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=gx(e);if(1===e){if(!Gx(t,"OES_texture_float"))return!1}else if(!Gx(t,"EXT_color_buffer_float"))return!1;return qx(t)}(Xx.getNumber("WEBGL_VERSION"))})),Xx.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Xx.getBool("WEBGL_FORCE_F16_TEXTURES")&&Xx.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Xx.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Hx(Xx.getNumber("WEBGL_VERSION"))})),Xx.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=Xx.getNumber("WEBGL_VERSION"))&&null!=gx(e).fenceSync;var e})),Xx.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Xx.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),Xx.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))})),Xx.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return l.device_util.isMobile()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))})),Xx.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),Xx.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),Xx.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),Xx.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128}));var tk="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",nk=l.backend_util.getBroadcastDims;function rk(e,t,n){var r=[];if(e.forEach((function(e){var t=l.util.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(wk(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?ik(e,r):ak(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;i.length<=o.length&&(a+=n?bk(e,t):xk(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=Yx(),p=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),d=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(ok,"\n    ").concat(sk,"\n    ").concat(uk,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(l.util.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(l.util.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){var r=Jx(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(r,"\n    return ivec3(r, c, d);\n  }\n")}var a=Qx(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){var r=Jx(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}var a=Qx(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=Qx(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=Qx(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(d+=ck),[d,p,i,o,a,s,n.userCode].join("\n")}function ak(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return pk(e,t);case 1:return dk(e,t);case 2:return fk(e,t);case 3:return hk(e,t);case 4:return mk(e,t);case 5:return vk(e);case 6:return gk(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function ik(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Yx();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=Yx();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=Yx();if(null!=i&&l.util.arraysEqual(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],p=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(p,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=Sk(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(ik(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(Ik(c,s),");\n        }\n      ")}var l=Yx();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var p=o[0],d=o[1],f=Math.ceil(n[2]/2),h=f*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(p,", ").concat(d,", ").concat(h,", ").concat(f,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Yx();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],p=Math.ceil(i[o-1]/2),d=p*Math.ceil(i[o-2]/2),f="int b, int row, int col",h="b * ".concat(d," + (row / 2) * ").concat(p," + (col / 2)"),m=2;m<o-1;m++)f="int b".concat(m,", ")+f,d*=i[o-m-1],h="b".concat(m," * ").concat(d," + ")+h;return"\n    vec4 ".concat(r,"(").concat(f,") {\n      int index = ").concat(h,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var ok="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",sk="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",uk="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ck="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function lk(e){return"offset".concat(e)}function pk(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=(0,p.Z)(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=lk(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=(0,p.Z)(e.shapeInfo.texShape,2),c=u[0],l=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(c,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function dk(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(yk(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=lk(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function fk(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&l.util.arraysEqual(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=l.util.squeezeShape(n),c=u.newShape,p=u.keptDims,d=c;if(d.length<n.length){var f=Sk(e,d);return"\n      ".concat(ak(f,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(Ik(["row","col"],p),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(yk(e),"\n      }\n    ");var h=i[0],m=i[1],v=lk(r);return 1===m?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===h?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(m,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}function hk(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=l.util.squeezeShape(n),u=s.newShape,c=s.keptDims,p=u;if(p.length<n.length){var d=Sk(e,p);return"\n        ".concat(ak(d,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(Ik(["row","col","depth"],c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(yk(e),"\n      }\n    ");var f=e.shapeInfo.texShape,h=f[0],m=f[1],v=e.shapeInfo.flatOffset;if(m===i&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(m,".0, ").concat(h,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(m===o&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(m,".0, ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var g=lk(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(g,";\n        vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}function mk(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=l.util.squeezeShape(n),c=u.newShape,p=u.keptDims;if(c.length<n.length){var d=Sk(e,c);return"\n      ".concat(ak(d,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(Ik(["row","col","depth","depth2"],p),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(yk(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,m=h[0],v=h[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(v===s&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(g,"\n        ").concat(y,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(v===i&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var x=lk(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(g,"\n      ").concat(y,"\n      ").concat(b,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}function vk(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=l.util.squeezeShape(t),c=u.newShape,p=u.keptDims;if(c.length<t.length){var d=Sk(e,c);return"\n      ".concat(ak(d),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Ik(["row","col","depth","depth2","depth3"],p),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(yk(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,m=h[0],v=h[1];if(v===s&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=lk(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function gk(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=l.util.squeezeShape(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=Sk(e,i);return"\n      ".concat(ak(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Ik(["row","col","depth","depth2","depth3","depth4"],o),");\n      }\n    ")}var u=t[5],c=t[4]*u,p=t[3]*c,d=t[2]*p,f=t[1]*d;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(f,", ").concat(d,", ").concat(p,", ").concat(c,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(u,", 1)));\n        ").concat(yk(e),"\n      }\n    ");var h=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],g=m[1];if(g===f&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(d,", ").concat(p,", ").concat(c,", ").concat(u,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===u&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=lk(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(f," + col * ").concat(d," + depth * ").concat(p," +\n          depth2 * ").concat(c," + depth3 * ").concat(u," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function yk(e){var t=e.name,n=l.util.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function bk(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=nk(e.shapeInfo.logicalShape,t.logicalShape),c=kk(s),p=s-o,d=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(d[e+p]," = 0;")})).join("\n");var f="";f=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+p])})).join(", ");var h="return outputValue;",m=1===l.util.sizeFromShape(e.shapeInfo.logicalShape),v=1===l.util.sizeFromShape(t.logicalShape);if(1!==o||m||v){if(m&&!v)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var g=o-2,y=o-1;u.indexOf(g)>-1&&u.indexOf(y)>-1?h="return vec4(outputValue.x);":u.indexOf(g)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(y)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(f,");\n      ").concat(h,"\n    }\n  ")}function xk(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&l.util.arraysEqual(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,p=kk(u),d=nk(e.shapeInfo.logicalShape,t.logicalShape),f=u-s,h=["x","y","z","w","u","v"];c=0===s?"":u<2&&d.length>=1?"coords = 0;":d.map((function(e){return"coords.".concat(h[e+f]," = 0;")})).join("\n");var m="";return m=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+f])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(p," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(m,");\n    }\n  ")}function kk(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function wk(e,t,n){var r=l.util.squeezeShape(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!l.util.arraysEqual(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function Sk(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Ik(e,t){return t.map((function(t){return e[t]})).join(", ")}function Nk(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=rk(a,o,t),u=function(e,t){var n=zx(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(wx(e,(function(){return e.shaderSource(n,t)})),wx(e,(function(){return e.compileShader(n)})),(0,l.env)().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw Ex(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),c=e.createProgram(u);return(0,l.env)().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},Tk(e,t,c))}function Tk(e,t,n){var r,a,i,o,s={},u={},c={},p=[],d=null;o=e.getUniformLocation(n,"NAN",!1),1===(0,l.env)().getNumber("WEBGL_VERSION")&&(d=e.getUniformLocation(n,"INFINITY",!1));for(var f=!1,h=0;h<t.variableNames.length;h++){var m=t.variableNames[h];s[m]=e.getUniformLocation(n,m,f),s["offset".concat(m)]=e.getUniformLocation(n,"offset".concat(m),f),t.enableShapeUniforms&&(u["".concat(m,"Shape")]=e.getUniformLocation(n,"".concat(m,"Shape"),f),c["".concat(m,"TexShape")]=e.getUniformLocation(n,"".concat(m,"TexShape"),f))}return t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",f),i=e.getUniformLocation(n,"outShapeStrides",f),a=e.getUniformLocation(n,"outTexShape",f)),t.customUniforms&&t.customUniforms.forEach((function(t,r){p[r]=e.getUniformLocation(n,t.name,f)})),{uniformLocations:s,customUniformLocations:p,infLoc:d,nanLoc:o,inShapesLocations:u,inTexShapesLocations:c,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function Ck(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!l.util.arraysEqual(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!l.util.arraysEqual(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function Ek(e,t,n,r,a){t.program.enableShapeUniforms||(Ck(t.inShapeInfos,n),Ck([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),1===(0,l.env)().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)],s=t.inShapesLocations["".concat(a,"Shape")],u=t.inTexShapesLocations["".concat(a,"TexShape")];if(s){var c=wk(t.program.packedInputs,n.shape,n.texData.texShape).uniformShape;switch(c.length){case 1:e.gl.uniform1iv(s,new Int32Array(c));break;case 2:e.gl.uniform2iv(s,new Int32Array(c));break;case 3:e.gl.uniform3iv(s,new Int32Array(c));break;case 4:e.gl.uniform4iv(s,new Int32Array(c))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=i)if(n.isUniform)if(l.util.sizeFromShape(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var p=n.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),e.gl.uniform1fv(i,p)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,i,r)}));var s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var u=l.util.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach((function(n,r){var i=t.customUniformLocations[r],o=a[r];if("float"===n.type)e.gl.uniform1fv(i,o);else if("vec2"===n.type)e.gl.uniform2fv(i,o);else if("vec3"===n.type)e.gl.uniform3fv(i,o);else if("vec4"===n.type)e.gl.uniform4fv(i,o);else if("int"===n.type)e.gl.uniform1iv(i,o);else if("ivec2"===n.type)e.gl.uniform2iv(i,o);else if("ivec3"===n.type)e.gl.uniform3iv(i,o);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(i,o)}})),e.executeProgram()}function _k(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=wk(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,p="",d="",f="";if(1===u.length&&e.packedInputs){var h=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];p="".concat(h[0]>1,"_").concat(h[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var m=l.util.computeStrides(u);f="".concat(m[0]===i[1],"_").concat(m[m.length-1]===i[1])}}else d="".concat(u[0]>1,"_").concat(u[1]>1);var v=t.shape.length,g=2===u.length&&l.util.arraysEqual(t.shape,i),y=1===l.util.sizeFromShape(t.shape),b=l.backend_util.getBroadcastDims(t.shape,n.shape),x=!e.packedInputs&&v===n.shape.length&&l.util.arraysEqual(i,n.texData.texShape),k=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(v,"_").concat(x,"_").concat(s?c:"","_").concat(u.length,"_").concat(y,"_").concat(b,"_").concat(g,"_").concat(p,"_").concat(d,"_").concat(f,"_").concat(k,"_").concat(a)}else{var w=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(w,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+="_"+r+"_"+a+"".concat((0,l.env)().getNumber("WEBGL_VERSION"))}function Ak(e){return(0,l.env)().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var Rk=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=dx.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Yx();this.outputShape=t,this.enableShapeUniforms=Ak(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Jx(["r","c","d"],t):Qx(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Fk=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=dx.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Yx();this.outputShape=t,this.enableShapeUniforms=Ak(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Jx(["r","c","d"],t):Qx(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Dk=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["A"],this.outTexUsage=fx.DOWNLOAD;var n=Yx();this.outputShape=t,this.userCode="\n      ".concat(tk,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),Zk=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=fx.DOWNLOAD;var n=Yx();this.outputShape=t,this.userCode="\n      ".concat(tk,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),Ok=(0,ia.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,aa.Z)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=Yx();this.outputShape=t,this.enableShapeUniforms=Ak(this.outputShape.length);var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":ek(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")})),Mk=(0,ia.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=Yx();this.outputShape=t,this.enableShapeUniforms=Ak(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":ek(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")}));function zk(e){var t=Yx();return function(e,t){var n=zx(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(wx(e,(function(){return e.shaderSource(n,t)})),wx(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function Lk(e){return function(e,t){var n=zx(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return wx(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),wx(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Pk(e){return function(e,t){var n=zx(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return wx(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),wx(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function Bk(e,t,n,r,a,i){!function(e,t){var n=(0,l.env)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);var o=function(e){return zx(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return wx(e,(function(){return e.bindTexture(s,o)})),wx(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),wx(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),wx(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),wx(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===(0,l.env)().getNumber("WEBGL_VERSION")?wx(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):wx(e,(function(){return e.texStorage2D(s,1,r,t,n)})),wx(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function Wk(e){return e.internalFormatFloat}function Vk(e){return e.internalFormatHalfFloat}function Uk(e){return e.downloadTextureFormat}function Gk(e){return e.internalFormatPackedFloat}function jk(e){return e.internalFormatPackedHalfFloat}function Hk(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=xx(e,t),r=(0,p.Z)(n,2);return r[0]*r[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}var qk=function(){function e(t){(0,aa.Z)(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=(0,l.env)().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){mx[e]=t}(n,t)):this.gl=gx(n);var r="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===(0,l.env)().getNumber("WEBGL_VERSION")){var i="OES_texture_half_float";if(this.textureFloatExtension=Ix(this.gl,"OES_texture_float"),Gx(this.gl,i))this.textureHalfFloatExtension=Ix(this.gl,i);else if((0,l.env)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Gx(this.gl,a))this.colorBufferHalfFloatExtension=Ix(this.gl,a);else if((0,l.env)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Gx(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Gx(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=Lk(this.gl),this.indexBuffer=Pk(this.gl),this.framebuffer=function(e){return zx(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=kx(this.gl,this.textureHalfFloatExtension)}return(0,ia.Z)(e,[{key:"debug",get:function(){return(0,l.env)().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;wx(t,(function(){return t.finish()})),wx(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),wx(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),wx(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),wx(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),wx(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=yx(t,n),i=(0,p.Z)(a,2);return Bk(e,i[0],i[1],Wk(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=yx(t,n),i=(0,p.Z)(a,2);return Bk(e,i[0],i[1],Vk(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=yx(t,n),i=(0,p.Z)(a,2);return Bk(e,i[0],i[1],Uk(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){wx(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===(0,l.env)().getNumber("WEBGL_VERSION")?wx(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):wx(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===(0,l.env)().getNumber("WEBGL_VERSION")?wx(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):wx(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),wx(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;wx(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===(0,l.env)().getNumber("WEBGL_VERSION")?wx(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):wx(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),wx(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=xx(t,n),i=(0,p.Z)(a,2);return Bk(e,i[0],i[1],jk(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=xx(t,n),i=(0,p.Z)(a,2);return Bk(e,i[0],i[1],Gk(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Ox(this.gl,this.framebuffer),this.outputTexture=null),wx(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=yx(t,n),i=(0,p.Z)(a,2),o=i[0],s=i[1],u=new Uint8Array(t*n*4);return wx(e,(function(){return e.readPixels(0,0,o,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return Hk(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();wx(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return wx(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),wx(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),wx(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if((0,l.env)().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return wx(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=zk(n));var r=function(e){return zx(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(n);return wx(n,(function(){return n.attachShader(r,t.vertexShader)})),wx(n,(function(){return n.attachShader(r,e)})),function(e,t){if(wx(e,(function(){return e.linkProgram(t)})),!(0,l.env)().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(n,r),this.debug&&_x(n,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=function(e,t,n){return wx(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Ax(e,t,"clipSpacePos",n,3,20,0)&&Ax(e,t,"uv",n,2,20,12)}(n,this.program,this.vertexBuffer)),r}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&wx(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&_x(this.gl,this.program),wx(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?Rx(this.gl,e,t):Fx(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),wx(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),Dx(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=xx(t,n),a=(0,p.Z)(r,2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&_x(this.gl,this.program),Mx(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),wx(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),wx(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Ix(this.gl,2===(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.util.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||l.util.repeatedTry((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),Zx(this.gl,e,this.framebuffer),this.debug&&Mx(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(Zx(this.gl,this.outputTexture,this.framebuffer),this.debug&&Mx(this.gl)):Ox(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;Zx(r,e,this.framebuffer),this.debug&&Mx(r),this.outputTexture=e,wx(r,(function(){return r.viewport(0,0,t,n)})),wx(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),wx(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var Kk=Rh,Xk=Sm,Yk=Im,Qk=Cm,Jk=Dm,$k=vv,ew=Cv,tw=Fv,nw=Xv,rw=rg,aw=ig,iw=sg,ow=lg,sw=xg,uw=Sg,cw=Tg,lw=Eg,pw=Ug,dw=Hg,fw=ny,hw=uv,mw=dy,vw=xy,gw=Dy,yw=Oy,bw=qy,xw=Yy,kw=yh,ww=Bh,Sw=bm,Iw=vb,Nw=yb,Tw=xb,Cw=Nb,Ew=Zb,_w=zb,Aw=Bb,Rw=Vb,Fw=Lv,Dw=Kb,Zw=Jb,Ow=qh,Mw=ix;function zw(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function Lw(e,t){return 1===t?[e]:zw(e,t)}var Pw=function(){function e(t){if((0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Ak(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=Lw("rc",this.rank),r=kk(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return(0,ia.Z)(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);if(1===this.rank){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),Bw=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Ak(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){var n=t?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=e.map((function(e,t){return t})),a=$x(r,t);return a.map((function(t,r){var i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")})).join("")}(["r","c","d"],"inputShape"):Qx(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":ek(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var Ww=function(){function e(t){(0,aa.Z)(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return(0,ia.Z)(e,[{key:"acquireTexture",value:function(e,t,n){var r=Uw(t,n),a=Gw(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=Vw(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===hx.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===hx.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===hx.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===hx.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===hx.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=Uw(n,r),i=Gw(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=Vw(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=(0,l.env)().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function Vw(e,t,n,r,a){var i,o=function(e,t){switch(e){case hx.PACKED_2X2_FLOAT32:return Gk(t);case hx.PACKED_2X2_FLOAT16:return jk(t);case hx.UNPACKED_FLOAT32:return Wk(t);case hx.UNPACKED_FLOAT16:return Vk(t);case hx.PACKED_4X1_UNSIGNED_BYTE:return Uk(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=xx(e[0],e[1]),u=(0,p.Z)(s,2);i=u[0]*u[1]}else{var c=yx(e[0],e[1]),l=(0,p.Z)(c,2);i=l[0]*l[1]}var d=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*d}function Uw(e,t){if(e===fx.UPLOAD)return hx.PACKED_2X2_FLOAT32;if(e===fx.RENDER||null==e)return function(e){return(0,l.env)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?hx.PACKED_2X2_FLOAT32:hx.UNPACKED_FLOAT32:e?hx.PACKED_2X2_FLOAT16:hx.UNPACKED_FLOAT16}(t);if(e===fx.DOWNLOAD||e===fx.PIXELS)return hx.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function Gw(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var jw=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Ak(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),Hw="if (isnan(x)) return x;",qw="return x;",Kw="return abs(x);";var Xw="return (x >= 0.0) ? x : (exp(x) - 1.0);",Yw=Hw+"\n  return (x < 0.0) ? 0.0 : x;\n",Qw=Hw+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Jw="return x;",$w="return 1.0 / (1.0 + exp(-1.0 * x));",eS="return x;",tS="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",nS="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",rS="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",aS="return 1.0 / (1.0 + exp(-1.0 * x));",iS=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Ak(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),oS=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Ak(this.outputShape.length);var n=t.length,r=Lw("rc",n),a=kk(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),sS=l.kernel_impls.whereImpl,uS={};var cS=(0,l.env)().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var lS=function(e){(0,sa.Z)(n,e);var t=(0,ua.Z)(n);function n(e){var r,a,i;if((0,aa.Z)(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!(0,l.env)().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof qk)a=e;else{var o=gx((0,l.env)().getNumber("WEBGL_VERSION"),e);a=new qk(o)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var s=gx((0,l.env)().getNumber("WEBGL_VERSION"));a=new qk(s),r.binaryCache=((i=(0,l.env)().getNumber("WEBGL_VERSION"))in uS||(uS[i]={}),uS[i]),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new Ww(r.gpgpu),r.numMBBeforeWarning=null==(0,l.env)().global.screen?1024:(0,l.env)().global.screen.height*(0,l.env)().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new l.DataStorage((0,oa.Z)(r),(0,l.engine)()),r}return(0,ia.Z)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"write",value:function(e,t,n){if(((0,l.env)().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||(0,l.env)().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:fx.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if((0,l.env)().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:fx.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new iS(o,Jw):new jw(o,Jw);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),p=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),p}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var d,f,h=null!=this.activeTimers;if(h&&(d=l.util.now()),"complex64"===r){var m=this.readSync(a.real.dataId),v=this.readSync(a.imag.dataId);f=l.backend_util.mergeRealAndImagArrays(m,v)}else f=this.getValuesFromTexture(e);return h&&(this.downloadWaitMs+=l.util.now()-d),this.convertAndCacheOnCPU(e,f)}},{key:"read",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,p,d,f,h,m,v,g,y,b,x,k,w,S,I,N;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=11;break}return p=c?new iS(i,Jw):new jw(i,Jw),d=this.runWebGLProgram(p,[{dataId:t,shape:i,dtype:s}],s),f=this.read(d.dataId),this.disposeIntermediateTensorInfo(d),e.abrupt("return",f);case 11:if(null==a){e.next=13;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 13:if(!(0,l.env)().getBool("DEBUG")){e.next=16;break}if((0,l.env)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==(0,l.env)().getNumber("WEBGL_VERSION")){e.next=16;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 16:if(h=null,"complex64"!==s&&(0,l.env)().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),g=this.texData.get(m.dataId),h=(v=this.gpgpu).createBufferFromTexture.apply(v,[g.texture.texture].concat((0,Qn.Z)(bx(i))))),this.pendingRead.set(t,[]),"complex64"===s){e.next=22;break}return e.next=22,this.gpgpu.createAndWaitForFence();case 22:if("complex64"!==s){e.next=31;break}return e.next=25,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 25:b=e.sent,x=b[0],k=b[1],y=l.backend_util.mergeRealAndImagArrays(x,k),e.next=32;break;case 31:null==h?y=this.getValuesFromTexture(t):(w=l.util.sizeFromShape(i),y=this.gpgpu.downloadFloat32MatrixFromBuffer(h,w));case 32:return null!=m&&this.disposeIntermediateTensorInfo(m),null!=h&&wx(S=this.gpgpu.gl,(function(){return S.deleteBuffer(h)})),I=this.convertAndCacheOnCPU(t,y),N=this.pendingRead.get(t),this.pendingRead.delete(t),N.forEach((function(e){return e(I)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&(0,l.engine)().removeDataId(t,this),this.pendingDeletes--),e.abrupt("return",I);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new iS(a,Jw):new jw(a,Jw);var p=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),d=this.readToGPU(p,t);return this.disposeIntermediateTensorInfo(p),d}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var f=this.decode(e,t.customTexShape),h=(0,l.engine)().makeTensorFromTensorInfo(f),m=this.texData.get(f.dataId);return Object.assign({tensorRef:h},m.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return l.util.decodeString(e)}));return(0,l.buffer)(e.shape,e.dtype,n)}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return(0,l.buffer)(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Sx(n)){if((0,l.env)().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=l.util.sizeFromShape(n);if((0,l.env)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat((0,Qn.Z)(bx(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var p=(0,l.env)().getBool("WEBGL_PACK")&&!0===a,d=p?Wx(n):n,f=p?new Zk(d):new Dk(d),h=this.runWebGLProgram(f,[{shape:d,dtype:r,dataId:e}],"float32"),m=this.texData.get(h.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(h),v}},{key:"timerAvailable",value:function(){return(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=l.util.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=l.util.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(0,Xo.Z)((0,Ko.Z)().mark((function e(){var n;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=8;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=l.util.sum(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=9;break;case 8:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 9:return t.uploadWaitMs=0,t.downloadWaitMs=0,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:l.util.now(),endMs:null}}},{key:"endTimer",value:function(e){return(0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=l.util.now(),e)}},{key:"getQueryTime",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){var n;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((0,l.env)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e),r=n.complexTensorInfos;return null!=r&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cS;return(0,l.env)().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&l.util.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){l.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return sS(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new iS(e.shape,t),a=this.compileAndRun(r,[e],n);return(0,l.engine)().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=ww(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if((0,l.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Kw,e.dtype);var n=new jw(e.shape,Kw),r=this.compileAndRun(n,[e]);return(0,l.engine)().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&l.util.isString(n[0])){var a=n.map((function(e){return l.util.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return(0,l.engine)().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new oS(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new Pw(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[Px(e.shape)].concat((0,Qn.Z)(Bx(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[Px(t)].concat((0,Qn.Z)(Bx(t))),i=new Bw(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;if(null!=t){var o=l.util.sizeFromShape(a),s=t[0]*t[1]*4;l.util.assert(o<=s,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}))}var u,c=Wx(a);u=r?new Fk(c):new Rk(c);var p=[null!=t?t:bx(c)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(u,[{shape:c,dtype:i,dataId:e}],i,p,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===dx.DENSE){var c=null!=o?o:bx(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===l.util.sizeFromShape(s.shape))return u.values=l.util.getTypedArrayFromDType(s.dtype,0),s;var p=[],d=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&l.util.sizeFromShape(t.shape)<=(0,l.env)().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),p.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!Ux(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),p.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var f,h={shape:s.shape,texData:u,isUniform:!1},m=_k(e,d,h),v=this.getAndSaveBinary(m,(function(){return Nk(a.gpgpu,e,d,h)})),g=null!=this.activeTimers;g&&(f=this.startTimer()),(0,l.env)().get("ENGINE_COMPILE_ONLY")||Ek(this.gpgpu,v,d,h,r),p.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),g&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)}));var y=(0,l.env)().get("WEBGL_FLUSH_THRESHOLD");if(y>0){var b=l.util.now();b-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!(0,l.env)().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var x=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),x}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return i}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;if(!this.disposed){if(!(0,l.env)().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}));this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=(0,l.tidy)((function(){if(!(0,l.env)().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=(0,l.env)().getBool("DEBUG");(0,l.env)().set("DEBUG",!1);var n=e.abs((0,l.scalar)(1e-8)).dataSync()[0];if((0,l.env)().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=l.util.now());var d=t.texShape;if(null==d&&(d=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,l.env)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((function(t,n){return n>=e.length-2?l.util.nearestLargerEven(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var r=l.util.squeezeShape(e);e=r.newShape}var a=l.util.sizeFromShape(e);if(e.length<=1&&a<=n)return[1,a];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var i=Px(e),o=2,s=2;if(e.length){var u=Bx(e),c=(0,p.Z)(u,2);o=c[0],s=c[1]}return a=i*(o/2)*(s/2),l.util.sizeToSquarishShape(a).map((function(e){return 2*e}))}return l.util.sizeToSquarishShape(a)}(n,s),t.texShape=d),null!=a){var f,h=Wx(n),m=d[1],v=d[0],g=a instanceof Uint8Array||a instanceof Uint8ClampedArray;if(s||!g){var y=xx(d[0],d[1]),b=(0,p.Z)(y,2);m=b[0],v=b[1]}f=s?new Mk(h,g):new Ok(h,g);var x=g?[v,m]:d,k=this.makeTensorInfo(x,r),w=this.texData.get(k.dataId);w.usage=g?fx.PIXELS:fx.UPLOAD,w.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(k.dataId),m,v,a);var S=[[v,m]],I=this.runWebGLProgram(f,[k],r,S,!0),N=this.texData.get(I.dataId);t.texShape=N.texShape,t.isPacked=N.isPacked,t.usage=N.usage,(0,l.env)().get("ENGINE_COMPILE_ONLY")?this.disposeData(I.dataId):(t.texture=N.texture,t.values=null,this.texData.delete(I.dataId)),this.disposeIntermediateTensorInfo(k),c&&(this.uploadWaitMs+=l.util.now()-u)}else{var T=this.acquireTexture(d,o,r,s);t.texture=T}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*l.util.bytesPerElement(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,p.Z)(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(){var t,n,r,a,i,o,s,u,c=this;return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=(0,p.Z)(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:for(o=function(){var e=(0,p.Z)(u[s],2)[1],n=new Promise((function(t){try{c.checkCompletion_(e),t(!0)}catch(n){throw n}}));t.push(n)},s=0,u=Object.entries(this.binaryCache);s<u.length;s++)o();return e.abrupt("return",Promise.all(t));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=(0,Xo.Z)((0,Ko.Z)().mark((function e(t){return(0,Ko.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}return e.abrupt("return",this.checkCompletion_(t));case 4:return e.next=6,(0,l.nextFrame)();case 6:return e.abrupt("return",this.checkCompletionAsync_(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw Ex(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,p.Z)(t[e],2)[1],r=Tk(this.gpgpu,n.program,n.webGLProgram),a=r.uniformLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.inShapesLocations,c=r.inTexShapesLocations,l=r.outShapeLocation,d=r.outShapeStridesLocation,f=r.outTexShapeLocation;n.uniformLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.inShapesLocations=u,n.inTexShapesLocations=c,n.outShapeLocation=l,n.outShapeStridesLocation=d,n.outTexShapeLocation=f}}}]),n}(l.KernelBackend);lS.nextDataId=0;l.device_util.isBrowser()&&(0,l.registerBackend)("webgl",(function(){return new lS}),2);var pS=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["A","B"],this.outputShape=l.backend_util.assertAndGetBroadcastShape(n,r),this.enableShapeUniforms=Ak(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),dS=(0,ia.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,aa.Z)(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=l.backend_util.assertAndGetBroadcastShape(n,r);var i=this.outputShape.length;this.enableShapeUniforms=Ak(i);var o="";if(a)if(0===i||1===l.util.sizeFromShape(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{var s=kk(i);if(o="\n          ".concat(s," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=Lw("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function fS(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var hS={kernelName:l.Identity,backendName:"webgl",kernelFunc:fS};function mS(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=fS({inputs:{x:r},backend:n}),u=fS({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var vS={kernelName:l.Complex,backendName:"webgl",kernelFunc:mS},gS="return (a < 0.) ? b * a : a;",yS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var bS={kernelName:l.LeakyRelu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",l.util.createScalarValue(i,"float32")),s=(0,l.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dS(yS,a.shape,o.shape):new pS(gS,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},xS="return (a < 0.) ? b * a : a;",kS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var wS={kernelName:l.Prelu,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=(0,l.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dS(kS,r.shape,a.shape):new pS(xS,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}};function SS(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,p=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var d=c.texData.get(u.dataId),f=r(d.values,p);return c.makeTensorInfo(u.shape,p,f)}return i=(0,l.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new iS(u.shape,n):new jw(u.shape,t),c.runWebGLProgram(i,[u],p)}}function IS(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,d=r.b,f=i;if(o&&"complex64"===c.dtype){var h=f.texData.get(c.dataId),m=f.texData.get(d.dataId),v=[[h.complexTensorInfos.real,m.complexTensorInfos.real],[h.complexTensorInfos.imag,m.complexTensorInfos.imag]].map((function(e){var n=(0,p.Z)(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:d.shape},s=new pS(t,c.shape,d.shape);return f.runWebGLProgram(s,[i,o],(0,l.upcastType)(r.dtype,a.dtype))})),g=(0,p.Z)(v,2),y=g[0],b=g[1],x=mS({inputs:{real:y,imag:b},backend:f});return f.disposeIntermediateTensorInfo(y),f.disposeIntermediateTensorInfo(b),x}var k,w=u||(0,l.upcastType)(c.dtype,d.dtype);if(("string"===c.dtype||"string"===d.dtype||f.shouldExecuteOnCPU([c,d]))&&null!=s){var S=f.texData.get(c.dataId).values,I=f.texData.get(d.dataId).values,N="string"===c.dtype?l.backend_util.fromUint8ToStringArray(S):S,T="string"===c.dtype?l.backend_util.fromUint8ToStringArray(I):I,C=s(c.shape,d.shape,N,T,w),E=(0,p.Z)(C,2),_=E[0],A=E[1],R=f.makeTensorInfo(A,w);return f.texData.get(R.dataId).values=_,R}return k=(0,l.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new dS(n,c.shape,d.shape,a):new pS(t,c.shape,d.shape),f.runWebGLProgram(k,[c,d],w)}}function NS(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?eS:qw;if("relu"===e)return t?nS:Yw;if("elu"===e)return t?tS:Xw;if("relu6"===e)return t?rS:Qw;if("prelu"===e)return t?kS:xS;if("leakyrelu"===e)return t?yS:gS;if("sigmoid"===e)return t?aS:$w;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var TS=(0,ia.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];(0,aa.Z)(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Ak(this.outputShape.length);var l=a?t[1]:t[2],p=Math.ceil(l/2),d=a?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",h=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",x="rc.x";t[0]<n[0]?b="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(x="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(p,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(p,"; i++) {\n          int batchA = ").concat(b,";\n          int batchB = ").concat(x,";\n          vec4 a = getMatrixA(batchA, ").concat(d,");\n          vec4 b = getMatrixB(batchB, ").concat(f,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(h[0]," * ").concat(m[0],");\n          result += (").concat(h[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),CS="return areal * breal - aimag * bimag;",ES="return areal * bimag + aimag * breal;",_S=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=l.backend_util.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),AS="return a * b;";function RS(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=l.backend_util.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new _S(CS,a.shape,i.shape),d=new _S(ES,a.shape,i.shape),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],h=r.runWebGLProgram(c,f,"float32"),m=r.runWebGLProgram(d,f,"float32"),v=mS({inputs:{real:h,imag:m},backend:r});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(m),v}if(r.shouldExecuteOnCPU([a,i])){var g=r.texData.get(a.dataId),y=r.texData.get(i.dataId),b=hw(a.shape,i.shape,g.values,y.values,o),x=(0,p.Z)(b,2),k=x[0],w=x[1],S=r.makeTensorInfo(w,o);return r.texData.get(S.dataId).values=k,S}return t=(0,l.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dS(AS,a.shape,i.shape):new pS(AS,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var FS={kernelName:l.Multiply,backendName:"webgl",kernelFunc:RS};function DS(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=l.util.sizeFromShape(a.shape),u=l.util.inferFromImplicitShape(i,s),c=l.util.sizeFromShape(u);l.util.assert(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."}));var p=o.texData.get(a.dataId);return!p.isPacked||Ux(a.shape,u)||null!==p.texture&&Ux(p.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[Px(e.shape)].concat((0,Qn.Z)(Bx(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[Px(t)].concat((0,Qn.Z)(Bx(t))),o=new Bw(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var ZS={kernelName:l.Reshape,backendName:"webgl",kernelFunc:DS},OS=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var p=1/n;c="sumValue += dot(values * ".concat(l.util.isInt(p)?p.toPrecision(2):p,", ones);")}var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),MS=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),p=r%4,d="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),f="vec4";"all"===n?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(d,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===p,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(2===p,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(3===p,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(d,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function zS(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=l.backend_util.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,p=u.windowSize,d=u.outSize,f=void 0;f="mean"===n?0===o?new OS({windowSize:p,inSize:c,batchSize:e.shape[0],outSize:d},c):new OS({windowSize:p,inSize:c,batchSize:e.shape[0],outSize:d}):new MS({windowSize:p,inSize:c,batchSize:e.shape[0],outSize:d},n),s=i,i=r.runWebGLProgram(f,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var LS=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=kk(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var PS=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=kk(this.rank),o=zw("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),p="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(p,";\n      if(").concat(l,") {\n        result[1] = ").concat(p,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(p,";\n        if(").concat(l,") {\n          result[3] = ").concat(p,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function BS(e,t,n){var r=(0,l.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new PS(e.shape,t):new LS(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function WS(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=l.util.parseAxisParam(a,e.shape),s=o,u=l.backend_util.getAxesPermutation(s,i),c=null!=u,d=e;c&&(d=BS(e,u,r),s=l.backend_util.getInnerMostAxes(s.length,i)),l.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=l.backend_util.computeOutAndReduceShapes(d.shape,s),h=(0,p.Z)(f,2),m=h[0],v=h[1],g=m;n&&(g=l.backend_util.expandShapeToKeepDim(m,o));var y=l.util.sizeFromShape(v),b=DS({inputs:{x:d},attrs:{shape:[l.util.sizeFromShape(e.shape)/y,y]},backend:r}),x=zS(b,(0,l.sumOutType)(e.dtype),"sum",r),k=DS({inputs:{x:x},attrs:{shape:g},backend:r});return r.disposeIntermediateTensorInfo(b),r.disposeIntermediateTensorInfo(x),c&&r.disposeIntermediateTensorInfo(d),k}(t.x,r.axis,r.keepDims,n)}var VS={kernelName:l.Sum,backendName:"webgl",kernelFunc:WS};function US(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var p=s.texData.get(i.dataId).values,d=Ow(p,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=d}else t=BS(i,o,s);return t}var GS={kernelName:l.Transpose,backendName:"webgl",kernelFunc:US};function jS(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,p=e.leakyreluAlpha,d=void 0===p?0:p,f=e.activation,h=void 0===f?null:f,m=t.shape.length,v=n.shape.length,g=r?t.shape[m-2]:t.shape[m-1],y=a?n.shape[v-1]:n.shape[v-2],b=r?t.shape[m-1]:t.shape[m-2],x=a?n.shape[v-2]:n.shape[v-1],k=t.shape.slice(0,-2),w=n.shape.slice(0,-2),S=l.util.sizeFromShape(k),I=l.util.sizeFromShape(w),N=l.broadcast_util.assertAndGetBroadcastShape(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([b,x]);l.util.assert(g===y,(function(){return"Error in matMul: inner shapes (".concat(g,") and (")+"".concat(y,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")}));var T,C=r?[S,g,b]:[S,b,g],E=a?[I,x,y]:[I,y,x],_=DS({inputs:{x:t},backend:i,attrs:{shape:C}}),A=DS({inputs:{x:n},backend:i,attrs:{shape:E}}),R=[_,A],F=Math.max(S,I),D=r?_.shape[1]:_.shape[2],Z=null!=s,O=null!=c,M="leakyrelu"===h,z=null!=h?NS(h,!0):null;if((1===b||1===x)&&D>1e3&&!1===(Z||O||M||null!=z)){var L=_,P=A;r&&(L=US({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),R.push(L)),a&&(P=US({inputs:{x:A},backend:i,attrs:{perm:[0,2,1]}}),R.push(P));var B=1===x,W=L;1!==x&&(W=DS({inputs:{x:L},backend:i,attrs:{shape:[F,D,1]}}),R.push(W));var V=1===x?2:1,U=P;B&&(U=DS({inputs:{x:P},backend:i,attrs:{shape:[F,1,D]}}),R.push(U));var G=RS({inputs:{a:W,b:U},backend:i});T=WS({inputs:{x:G},backend:i,attrs:{axis:V,keepDims:!0}}),R.push(G)}else{var j=(0,l.upcastType)(t.dtype,n.dtype),H=new TS(C,E,[F,b,x],r,a,Z,z,O,M),q=[_,A];if(null!=s&&q.push(s),O&&q.push(c),M){var K=i.makeTensorInfo([],"float32",l.util.createScalarValue(d,"float32"));q.push(K),R.push(K)}T=i.runWebGLProgram(H,q,j)}var X=DS({inputs:{x:T},backend:i,attrs:{shape:N}});R.push(T);for(var Y=0,Q=R;Y<Q.length;Y++){var J=Q[Y];i.disposeIntermediateTensorInfo(J)}return X}var HS={kernelName:l._FusedMatMul,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return jS({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},qS="return abs(x);";var KS={kernelName:l.Abs,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=ww(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=(0,l.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new iS(a.shape,qS):new jw(a.shape,qS),r.runWebGLProgram(t,[a],a.dtype)}},XS=SS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),YS={kernelName:l.Acos,backendName:"webgl",kernelFunc:XS},QS=SS({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),JS={kernelName:l.Acosh,backendName:"webgl",kernelFunc:QS},$S="return a + b;",eI=IS({opSnippet:$S,packedOpSnippet:$S,supportsComplex:!0,cpuKernelImpl:Kk}),tI={kernelName:l.Add,backendName:"webgl",kernelFunc:eI},nI=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),rI=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var aI={kernelName:l.AddN,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return fS({inputs:{x:a[0]},backend:r});if(a.length>(0,l.env)().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return(0,l.upcastType)(e,t)})),c=a.map((function(e){return e.shape})),p=(0,l.env)().getBool("WEBGL_PACK")?new rI(a[0].shape,c):new nI(a[0].shape,c);return r.runWebGLProgram(p,a,u)}};var iI={kernelName:l.All,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=l.util.parseAxisParam(i,a.shape),c=u,d=l.backend_util.getAxesPermutation(c,s),f=a;null!=d&&(f=US({inputs:{x:a},backend:n,attrs:{perm:d}}),c=l.backend_util.getInnerMostAxes(c.length,s)),l.backend_util.assertAxesAreInnerMostDims("all",c,s);var h,m=l.backend_util.computeOutAndReduceShapes(f.shape,c),v=(0,p.Z)(m,2),g=v[0],y=v[1],b=DS({inputs:{x:f},backend:n,attrs:{shape:[-1,l.util.sizeFromShape(y)]}}),x=zS(b,b.dtype,"all",n);return h=DS(o?{inputs:{x:x},backend:n,attrs:{shape:l.backend_util.expandShapeToKeepDim(g,u)}}:{inputs:{x:x},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x),null!=d&&n.disposeIntermediateTensorInfo(f),h}};var oI={kernelName:l.Any,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=l.util.parseAxisParam(i,a.shape),c=u,d=l.backend_util.getAxesPermutation(c,s),f=a;null!=d&&(f=US({inputs:{x:a},backend:n,attrs:{perm:d}}),c=l.backend_util.getInnerMostAxes(c.length,s)),l.backend_util.assertAxesAreInnerMostDims("any",c,s);var h,m=l.backend_util.computeOutAndReduceShapes(f.shape,c),v=(0,p.Z)(m,2),g=v[0],y=v[1],b=DS({inputs:{x:f},backend:n,attrs:{shape:[-1,l.util.sizeFromShape(y)]}}),x=zS(b,b.dtype,"any",n);return h=DS(o?{inputs:{x:x},backend:n,attrs:{shape:l.backend_util.expandShapeToKeepDim(g,u)}}:{inputs:{x:x},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x),null!=d&&n.disposeIntermediateTensorInfo(f),h}},sI=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),uI=(0,ia.Z)((function e(t,n,r,a){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,l.util.assert(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,p=c.length,d=kk(p),f=Lw("coords",p);if(1===o){var h=kk(u=p+1);s="\n        ".concat(h," sourceLocR = ").concat(h,"(").concat(f.join(),", 0);\n        ++").concat(f[p-1],";\n        ").concat(h," sourceLocG = ").concat(h,"(").concat(f.join(),", 0);\n        ++").concat(f[p-2],";\n        ").concat(h," sourceLocA = ").concat(h,"(").concat(f.join(),", 0);\n        --").concat(f[p-1],";\n        ").concat(h," sourceLocB = ").concat(h,"(").concat(f.join(),", 0);\n        --").concat(f[p-2],";")}else u=p,s="\n        ".concat(d," sourceLocR = coords;\n        ++").concat(f[p-1],";\n        ").concat(d," sourceLocG = coords;\n        ++").concat(f[p-2],";\n        ").concat(d," sourceLocA = coords;\n        --").concat(f[p-1],";\n        ").concat(d," sourceLocB = coords;\n        --").concat(f[p-2],";");var m=["x","y","z","w","u","v"].slice(0,u),v="."+m[u-1],g=m.map((function(e){return"int "+e})),y=Lw("sourceLocR",u-1).concat("inIdx.r"),b=Lw("sourceLocG",u-1).concat("inIdx.g"),x=Lw("sourceLocB",u-1).concat("inIdx.b"),k=Lw("sourceLocA",u-1).concat("inIdx.a"),w="max"===r?"greaterThan":"lessThan",S=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),"),\n                             getBestIndicesAChannel(").concat(k.join(),")));"),I="vec4(\n            getAChannel(".concat(y.join(),"),\n            hasNextCol ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(x.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(k.join(),") : 0.)"),N=a?"":"\n      float getBestIndicesAChannel(".concat(g.join(),") {\n        return getChannel(getBestIndicesA(").concat(m.join(),"),\n                                          vec2(").concat(m.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(g.join(),") {\n        return getChannel(getA(").concat(m.join(),"),\n                               vec2(").concat(m.slice(-2).join(),"));\n      }\n      ").concat(N,"\n      void main() {\n        ").concat(d," coords = getOutputCoords();\n        bool hasNextCol = ").concat(f[p-1]," < ").concat(c[p-1]-1,";\n        bool hasNextRow = ").concat(f[p-2]," < ").concat(c[p-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(v,", sourceLocG").concat(v,",\n          sourceLocB").concat(v,", sourceLocA").concat(v,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(I,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(S,"\n          vec4 candidate = ").concat(I,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(w,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function cI(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=l.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new sI(s,n,null==r),c=[t];null!=r&&c.push(r);var p=e.runWebGLProgram(u,c,"int32");if(1===p.shape[1])return p;var d=cI(e,t,n,p);return e.disposeIntermediateTensorInfo(p),d}function lI(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=a[a.length-1],o=l.backend_util.computeOptimalWindowSize(i),s=new uI(a,o,n,null==r),u=null==r?[t]:[t,r],c=e.runWebGLProgram(s,u,"int32");if(c.shape.length===t.shape.length){var p=lI(e,t,n,c);return e.disposeIntermediateTensorInfo(c),p}return c}function pI(e,t,n,r){var a=[n];if(l.backend_util.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!(0,l.env)().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=l.backend_util.computeOutAndReduceShapes(s.shape,a),c=(0,p.Z)(u,2),d=c[0],f=c[1],h=l.util.sizeFromShape(f),m=DS({inputs:{x:s},backend:e,attrs:{shape:[-1,h]}});i.push(m);var v=cI(e,m,r);i.push(v);var g=DS({inputs:{x:v},backend:e,attrs:{shape:d}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),g}return lI(e,t,r)}var dI={kernelName:l.ArgMax,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=l.util.parseAxisParam(i,a.shape),s=l.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=US({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=l.backend_util.getInnerMostAxes(o.length,u.shape.length)),l.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var p=pI(n,u,o[0],"max");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),p}};var fI={kernelName:l.ArgMin,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=l.util.parseAxisParam(i,a.shape),s=l.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=US({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=l.backend_util.getInnerMostAxes(o.length,u.shape.length)),l.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var p=pI(n,u,o[0],"min");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),p}},hI=SS({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),mI={kernelName:l.Asin,backendName:"webgl",kernelFunc:hI},vI=SS({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),gI={kernelName:l.Asinh,backendName:"webgl",kernelFunc:vI},yI=SS({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),bI={kernelName:l.Atan,backendName:"webgl",kernelFunc:yI},xI=IS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),kI={kernelName:l.Atan2,backendName:"webgl",kernelFunc:xI},wI=SS({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),SI={kernelName:l.Atanh,backendName:"webgl",kernelFunc:wI},II=(0,ia.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,aa.Z)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),r){var b=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(f,", ").concat(h,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(b," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?v:g:"wR * ".concat(d," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var x="max",k="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(k="avgValue / count");var w=4*Math.floor(o/4),S=o%4,I="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(x,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(f,", ").concat(h,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(I,"\n          }\n\n          int xC = xCCorner + ").concat(w,";\n          if (").concat(1===S,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(I,"\n          } else if (").concat(2===S,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(I,"\n          } else if (").concat(3===S,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(I,"\n          }\n        }\n        setOutput(").concat(k,");\n      }\n    ")}})),NI=(0,ia.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,aa.Z)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,p=t.dilationHeight,d=t.dilationWidth,f=t.effectiveFilterDepth,h=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,x="0.0";if(b||(x="-1.0 / 1e-20"),r){var k=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(f,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(h,";\n                wR += ").concat(p,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(d,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(k," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(h," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="max",S="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(S="avgValue / count");var I=4*Math.floor(o/4),N=o%4,T="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(w,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(f,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(p,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(I,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(d,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(d,", ch)\n              );\n\n              ").concat(T,"\n            }\n\n            int xC = xCCorner + ").concat(I,";\n            if (").concat(1===N,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(2===N,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(3===N,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                initializationValue\n              );\n\n              ").concat(T,"\n            }\n          }\n          setOutput(").concat(S,");\n        }\n      }\n    ")}}));var TI={kernelName:l.AvgPool,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Kx(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;l.util.assert(l.backend_util.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=l.backend_util.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&l.util.arraysEqual(c.inShape,c.outShape))return fS({inputs:{x:a},backend:n});var p=new II(c,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}};var CI={kernelName:l.AvgPool3D,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,p=l.backend_util.computePool3DInfo(a.shape,i,o,[1,1,1],s,u,c),d=new NI(p,"avg",!1);return n.runWebGLProgram(d,[a],"float32")}},EI=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,p=c-1-t.padInfo.left,d=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(p,");\n      const float avgMultiplier = float(").concat(d,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),_I=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=p-1-t.padInfo.front,m=d-1-t.padInfo.top,v=f-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(m,", ").concat(v,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var AI={kernelName:l.AvgPool3DGrad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,p=l.backend_util.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),d=new _I(p);return n.runWebGLProgram(d,[a],i.dtype)}};var RI={kernelName:l.AvgPoolGrad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Kx([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,p=l.backend_util.computePool2DInfo(o.shape,s,u,1,c),d=new EI(p);return n.runWebGLProgram(d,[a],o.dtype)}};var FI={kernelName:l.BatchMatMul,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return jS({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},DI=(0,ia.Z)((function e(t,n,r,a,i,o){(0,aa.Z)(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],l.backend_util.assertAndGetBroadcastShape(t,n),l.backend_util.assertAndGetBroadcastShape(t,r);var s="0.0";null!=a&&(l.backend_util.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(l.backend_util.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),ZI=(0,ia.Z)((function e(t,n,r,a,i,o){(0,aa.Z)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],l.backend_util.assertAndGetBroadcastShape(t,n),l.backend_util.assertAndGetBroadcastShape(t,r);var s="vec4(0.0)";null!=a&&(l.backend_util.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(l.backend_util.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),OI={kernelName:l.FusedBatchNorm,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;l.util.assert(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),l.util.assert(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),l.util.assert(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var p=[a,i,o],d=null;null!=s&&(d=s.shape,p.push(s));var f=null;null!=u&&(f=u.shape,p.push(u));var h=(0,l.env)().getBool("WEBGL_PACK_NORMALIZATION")?new ZI(a.shape,i.shape,o.shape,d,f,c):new DI(a.shape,i.shape,o.shape,d,f,c);return n.runWebGLProgram(h,p,p[0].dtype)}},MI=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=kk(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return zI.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(zI[t]," = start[").concat(t,"] + coords.").concat(zI[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),zI=["x","y","z","w","u","v"];var LI=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=kk(this.rank),r=Lw("coords",this.rank),a=Lw("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function PI(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size,s=l.slice_util.parseSliceParams(a,i,o),u=(0,p.Z)(s,2),c=u[0],d=u[1];if(l.slice_util.assertParamsValid(a,c,d),0===l.util.sizeFromShape(d))return n.makeTensorInfo(d,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var f=n.texData.get(a.dataId),h=Sw(f.values,c,d,a.shape,a.dtype);return n.makeTensorInfo(d,a.dtype,h)}var m=n.texData.get(a.dataId).isPacked,v=l.slice_util.isSliceContinous(a.shape,c,d);if(m||!v){var g=(0,l.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new LI(d):new MI(d),y=[c];return n.runWebGLProgram(g,[a],a.dtype,y)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=l.slice_util.computeFlatOffset(t,l.util.computeStrides(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,c,d,n)}var BI={kernelName:l.Slice,backendName:"webgl",kernelFunc:PI},WI={kernelName:l.BatchToSpaceND,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;l.util.assert(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=l.backend_util.getReshaped(a.shape,i,s),c=l.backend_util.getPermuted(u.length,i.length),p=l.backend_util.getReshapedPermuted(a.shape,i,s),d=l.backend_util.getSliceBeginCoords(o,i.length),f=l.backend_util.getSliceSize(p,o,i.length),h=[],m=DS({inputs:{x:a},backend:n,attrs:{shape:u}}),v=US({inputs:{x:m},backend:n,attrs:{perm:c}}),g=DS({inputs:{x:v},backend:n,attrs:{shape:p}}),y=PI({inputs:{x:g},backend:n,attrs:{begin:d,size:f}});return h.push(m),h.push(v),h.push(g),h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}};var VI={kernelName:l.Bincount,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=Xk(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var UI={kernelName:l.BroadcastArgs,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=l.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},GI=IS({opSnippet:"return float(a != b);",cpuKernelImpl:vw,dtype:"bool"}),jI={kernelName:l.NotEqual,backendName:"webgl",kernelFunc:GI};function HI(e){var t=e.inputs,n=e.backend,r=t.input;return fS({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var qI={kernelName:l.Real,backendName:"webgl",kernelFunc:HI};var KI={kernelName:l.Cast,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return fS({inputs:{x:i},backend:r});var s=l.zeros(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=mS({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var p=HI({inputs:{input:i},backend:r}),d=e({inputs:{x:p},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(p),d}if(!l.util.hasEncodingLoss(i.dtype,o)){var f=fS({inputs:{x:i},backend:r});return{dataId:f.dataId,shape:f.shape,dtype:o}}if("int32"===o)return function(e,t){var n=new jw(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var h=r.makeTensorInfo([],"bool",l.util.getTypedArrayFromDType("bool",1)),m=GI({inputs:{a:i,b:h},backend:r});return r.disposeIntermediateTensorInfo(h),m}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},XI="return ceil(x);",YI=SS({opSnippet:XI,packedOpSnippet:XI,cpuKernelImpl:Qk}),QI={kernelName:l.Ceil,backendName:"webgl",kernelFunc:YI},JI=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),$I=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var eN={kernelName:l.ClipByValue,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=(0,l.env)().getBool("WEBGL_PACK_CLIP")?new $I(i.shape):new JI(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},tN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function nN(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var rN={kernelName:l.ComplexAbs,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new tN(r.shape),o=[nN(r,a.complexTensorInfos.real),nN(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},aN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.outputShape=[],this.outputShape=l.backend_util.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),iN=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=l.backend_util.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=kk(a),o=Lw("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var p=s[n],d=s.slice(-2),f=s.join(),h="if (".concat(p," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(f,"), vec2(").concat(d.join(),"));\n        }"),m=1;m<u.length;m++){var v=u[m-1];h+="\n        if (".concat(p," < ").concat(u[m],"  && ").concat(p," >= ").concat(u[m-1],") {\n          return getChannel(\n            getT").concat(m,"(").concat(oN(s,p,v),"),\n            vec2(").concat(oN(d,p,v),"));\n        }")}var g=u.length,y=u[u.length-1];h+="\n        return getChannel(\n          getT".concat(g,"(").concat(oN(s,p,y),"),\n          vec2(").concat(oN(d,p,y),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(h,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function oN(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function sN(e){var t=e.inputs,n=e.backend,r=t.input;return fS({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var uN={kernelName:l.Imag,backendName:"webgl",kernelFunc:sN};function cN(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return HI({inputs:{input:e},backend:n})})),i=e.map((function(e){return sN({inputs:{input:e},backend:n})})),o=cN(a,t,n),s=cN(i,t,n),u=mS({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var p=e.map((function(e){var r=l.util.sizeFromShape(e.shape.slice(t));return DS({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),d=p.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),f=l.backend_util.computeOutShape(p.map((function(e){return e.shape})),1),h=1===p[0].shape[0],m=Jk(d,f,r,h),v=l.backend_util.computeOutShape(e.map((function(e){return e.shape})),t),g=n.makeTensorInfo(v,r,m);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}var y=(0,l.env)().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(e.length>y){for(var b=[],x=0;x<e.length;x+=y){var k=e.slice(x,x+y);b.push(cN(k,t,n))}for(var w=cN(b,t,n),S=0,I=b;S<I.length;S++){var N=I[S];n.disposeIntermediateTensorInfo(N)}return w}if((0,l.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var T=new iN(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(T,e,r)}var C=function(e,t,n){var r=l.backend_util.computeOutShape(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return DS({inputs:{x:e},attrs:{shape:[-1,l.util.sizeFromShape(e.shape.slice(t))]},backend:n})})),outShape:r}}(e,t,n),E=C.tensors2D,_=C.outShape,A=new aN(E.map((function(e){return e.shape}))),R=n.runWebGLProgram(A,E,r);E.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var F=DS({inputs:{x:R},attrs:{shape:_},backend:n});return n.disposeIntermediateTensorInfo(R),F}function lN(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=l.util.parseAxisParam(r,t[0].shape)[0],i=l.backend_util.computeOutShape(t.map((function(e){return e.shape})),a);if(0===l.util.sizeFromShape(i))return n.makeTensorInfo(i,t[0].dtype,[]);var o=t.filter((function(e){return l.util.sizeFromShape(e.shape)>0}));if(1===o.length)return fS({inputs:{x:o[0]},backend:n});var s=o.map((function(e){return e.shape}));return l.backend_util.assertParamsConsistent(s,a),cN(o,a,n)}var pN={kernelName:l.Concat,backendName:"webgl",kernelFunc:lN},dN=(0,ia.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,aa.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,p=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,g=v?1:2,y=v?2:3,b=v?3:1,x="",k="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(h,") *\n                    getW(wR, wC, ").concat(h,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(h,", xR, xC) *\n                    getW(wR, wC, ").concat(h,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2),\n                getW(wR, wC, ").concat(h," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1),\n                  getX(batch, xR, xC, ").concat(h," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC),\n                  getX(batch, ").concat(h," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")})),fN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.filterDepth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(p,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(d,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(h,") *\n                  getW(wF, wR, wC, ").concat(h,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1),\n                  getX(batch, xF, xR, xC, ").concat(h," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2),\n                  getW(wF, wR, wC, ").concat(h," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),hN=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Ak(this.outputShape.length);for(var r=n.dataFormat,a=Yx(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var p=0;p<=1;p++)c+="\n          blockIndex = rc.z + ".concat(p,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function mN(e,t){var n=e.length;return n>=3?[].concat((0,Qn.Z)(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function vN(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,p=e.leakyreluAlpha,d=void 0===p?0:p,f=e.activation,h=void 0===f?null:f,m=n.shape,v=i.texData.get(n.dataId),g=a.inChannels,y=m[0]*m[1]*m[2],b=a.outChannels,x="channelsLast"===a.dataFormat,k=[];if(null!=c){var w=mN(c.shape,x);null!=w&&(c=DS({inputs:{x:c},backend:i,attrs:{shape:w}}),k.push(c))}if(null!=s){var S=mN(s.shape,x);null!=S&&(s=DS({inputs:{x:s},backend:i,attrs:{shape:S}}),k.push(s))}if(!((1===y||1===b)&&g>1e3)&&v.isPacked&&x&&null!=v.texture&&m[2]%2!==0&&l.util.arraysEqual(v.shape.slice(-3),m.slice(-3))){var I=m[0]*m[1]*(m[2]+1),N={dataId:n.dataId,shape:[1,I,a.inChannels],dtype:n.dtype},T=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,l.util.assert(Ux(v.shape,N.shape),(function(){return"packed reshape ".concat(v.shape," to ").concat(N.shape," isn't free")}));var C=DS({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});k.push(C);var E=jS({a:N,b:C,backend:i,transposeA:!1,transposeB:false,bias:s,activation:h,preluActivationWeights:c,leakyreluAlpha:d}),_=i.texData.get(E.dataId);l.util.assert(_.isPacked,(function(){return"batchMatMul result is expected to be packed"})),v.shape=T,_.shape=a.outShape,(t=fS({inputs:{x:E},backend:i})).shape=a.outShape,k.push(E)}else{var A=a.outHeight*a.outWidth,R=DS({inputs:{x:n},backend:i,attrs:{shape:x?[a.batchSize,A,a.inChannels]:[a.batchSize,a.inChannels,A]}}),F=DS({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),D=jS({a:x?R:F,b:x?F:R,transposeA:!x,transposeB:false,backend:i,bias:s,activation:h,preluActivationWeights:c,leakyreluAlpha:d});t=DS({inputs:{x:D},backend:i,attrs:{shape:a.outShape}}),k.push(R),k.push(F),k.push(D)}for(var Z=0,O=k;Z<O.length;Z++){var M=O[Z];i.disposeIntermediateTensorInfo(M)}return t}function gN(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,p=void 0===c?0:c,d=e.activation,f=void 0===d?null:d,h=r.filterWidth,m=r.filterHeight,v=r.inChannels,g=r.outWidth,y=r.outHeight,b="channelsLast"===r.dataFormat,x=h*m*v,k=y*g,w=[r.batchSize,x,k],S=[];if(null!=u){var I=mN(u.shape,b);null!=I&&(u=DS({inputs:{x:u},backend:a,attrs:{shape:I}}),S.push(u))}if(null!=o){var N=mN(o.shape,b);null!=N&&(o=DS({inputs:{x:o},backend:a,attrs:{shape:N}}),S.push(o))}var T=DS({inputs:{x:n},backend:a,attrs:{shape:[1,x,l.util.sizeFromShape(n.shape)/x]}});S.push(T);var C=new hN(w,r),E=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],_=a.runWebGLProgram(C,[t],"float32",E),A=DS({inputs:{x:_},backend:a,attrs:{shape:w}});S.push(_),S.push(A);var R=null!=o,F=null!=u,D="leakyrelu"===f,Z=f?NS(f,!0):null,O=new TS(b?A.shape:T.shape,b?T.shape:A.shape,b?[r.batchSize,k,r.outChannels]:[r.batchSize,r.outChannels,k],!0,!1,R,Z,F,D),M=b?[A,T]:[T,A];if(o&&M.push(o),F&&M.push(u),D){var z=a.makeTensorInfo([],"float32",l.util.createScalarValue(p,"float32"));M.push(z),S.push(z)}var L=a.runWebGLProgram(O,M,"float32"),P=DS({inputs:{x:L},backend:a,attrs:{shape:r.outShape}});S.push(L);for(var B=0,W=S;B<W.length;B++){var V=W[B];a.disposeIntermediateTensorInfo(V)}return P}var yN={kernelName:l.Conv2D,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,p=a.dilations,d=a.dimRoundingMode,f=l.backend_util.convertConv2DDataFormat(c),h=l.backend_util.computeConv2DInfo(i.shape,o.shape,s,p,u,d,!1,f);if(1!==h.filterHeight||1!==h.filterWidth||1!==h.dilationHeight||1!==h.dilationWidth||1!==h.strideHeight||1!==h.strideWidth||"SAME"!==h.padInfo.type&&"VALID"!==h.padInfo.type)if((0,l.env)().getBool("WEBGL_CONV_IM2COL"))t=gN({x:i,filter:o,convInfo:h,backend:r});else{var m=new dN(h);t=r.runWebGLProgram(m,[i,o],"float32")}else t=vN({x:i,filter:o,convInfo:h,backend:r});var v=DS({inputs:{x:t},backend:r,attrs:{shape:h.outShape}});return r.disposeIntermediateTensorInfo(t),v}},bN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),xN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,p=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(p,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),kN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),wN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var SN={kernelName:l.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,p=r.filterShape,d=l.backend_util.convertConv2DDataFormat(u),f=l.backend_util.computeConv2DInfo(a.shape,p,o,1,s,c,!1,d),h=new bN(f);return n.runWebGLProgram(h,[a,i],"float32")}};var IN={kernelName:l.Conv2DBackpropInput,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,p=r.dimRoundingMode,d=l.backend_util.convertConv2DDataFormat(c),f=l.backend_util.computeConv2DInfo(o,i.shape,s,1,u,p,!1,d),h=new xN(f);return n.runWebGLProgram(h,[a,i],"float32")}};var NN={kernelName:l.Conv3D,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=l.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),p=new fN(c);return n.runWebGLProgram(p,[a,i],"float32")}};var TN={kernelName:l.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=l.backend_util.computeConv3DInfo(a.shape,u,o,1,s),p=new kN(c);return n.runWebGLProgram(p,[a,i],"float32")}};var CN,EN={kernelName:l.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape,c=l.backend_util.computeConv3DInfo(u,i.shape,s,1,o),p=new wN(c);return n.runWebGLProgram(p,[a,i],"float32")}},_N=SS({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),AN={kernelName:l.Cos,backendName:"webgl",kernelFunc:_N},RN=SS({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),FN={kernelName:l.Cosh,backendName:"webgl",kernelFunc:RN},DN=(0,ia.Z)((function e(t,n,r,a,i){(0,aa.Z)(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=(0,p.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3],d=(0,p.Z)(n,1)[0],f=(0,p.Z)(r,2),h=f[0],m=f[1];this.outputShape=[d,h,m,l];var v="bilinear"===a?1:0,g="".concat(u-1,".0"),y="".concat(c-1,".0"),b=h>1?["".concat((u-1)/(h-1)),"(y2-y1) * height_ratio","y1*".concat(g," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(g)],x=(0,p.Z)(b,3),k=x[0],w=x[1],S=x[2],I=m>1?["".concat((c-1)/(m-1)),"(x2-x1) * width_ratio","x1*".concat(y," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(y)],N=(0,p.Z)(I,3),T=N[0],C=N[1],E=N[2];this.userCode="\n      const float height_ratio = float(".concat(k,");\n      const float width_ratio = float(").concat(T,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(w,";\n        float width_scale = ").concat(C,";\n\n        float in_y = ").concat(S,";\n        if( in_y < 0.0 || in_y > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(E,";\n        if( in_x < 0.0 || in_x > ").concat(y," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(v," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),ZN={kernelName:l.CropAndResize,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new DN(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(CN||(CN={}));var ON=(0,ia.Z)((function e(t,n,r,a){(0,aa.Z)(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===CN.Prod?"1.0":"0.0",s=r?o:"getX(".concat(MN(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(kk(i)," coords = getOutputCoords();\n        int end = ").concat(zN(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(zN(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(MN(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function MN(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function zN(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function LN(e,t,n,r,a,i){var o=t.shape.length,s=l.backend_util.getAxesPermutation([r],o),u=t;null!=s&&(u=US({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=l.backend_util.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));for(var p=u.shape[c],d=fS({inputs:{x:u},backend:n}),f=0;f<=Math.ceil(Math.log2(p))-1;f++){var h=new ON(e,u.shape,!1,i),m=[[f]],v=d;d=n.runWebGLProgram(h,[d],d.dtype,m),n.disposeIntermediateTensorInfo(v)}if(a){var g=new ON(e,u.shape,a,i),y=d;d=n.runWebGLProgram(g,[d],d.dtype),n.disposeIntermediateTensorInfo(y)}if(null!=s){var b=US({inputs:{x:d},backend:n,attrs:{perm:l.backend_util.getUndoAxesPermutation(s)}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(u),b}return d}var PN={kernelName:l.Cumprod,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return LN(CN.Prod,a,n,i,o,s)}};var BN={kernelName:l.Cumsum,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return LN(CN.Sum,a,n,i,o,s)}};var WN={kernelName:l.DenseBincount,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=Xk(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var p=n.bufferSync(a),d=n.bufferSync(i),f=Yk(p,d,o,s);return n.makeTensorInfo(f.shape,i.dtype,f.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}},VN=function(){function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return(0,ia.Z)(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var UN={kernelName:l.DepthToSpace,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p=new VN("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(p,[a],a.dtype)}},GN=(0,ia.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,aa.Z)(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ak(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var p=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(p,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),jN=(0,ia.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,aa.Z)(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Ak(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,p=t.filterHeight,d=t.filterWidth,f=d,h="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",m=0;m<d;m++)h+="\n          vec4 xTexelC".concat(2*m,";\n          int xTexelC").concat(2*m,"Ready;\n          vec4 xTexelC").concat(2*m+1,";\n          int xTexelC").concat(2*m+1,"Ready;\n          vec4 xC").concat(m,";");h+="\n    for (int r = 0; r < ".concat(p,"; r++) {\n      ");for(var v=0;v<d;v++)h+="\n          xTexelC".concat(2*v," = vec4(0.0);\n          xTexelC").concat(2*v,"Ready = 0;\n          xTexelC").concat(2*v+1," = vec4(0.0);\n          xTexelC").concat(2*v+1,"Ready = 0;\n          xC").concat(v," = vec4(0.0);");h+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var g=0;g<(f+1)/2;g++){var y=2*g;if(h+="\n          xC = xCCorner + ".concat(y*c,";\n          "),1===u){if(y<d&&(s%2===1?(h+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n              "),h+=1===c&&y>0?"\n                xC".concat(y," = vec4(xTexelC").concat(y-2,".zw, xTexelC").concat(y,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(y," = vec4(previous.zw, xTexelC").concat(y,".xy);\n                  } else {\n                    xC").concat(y," = vec4(0.0, 0.0, xTexelC").concat(y,".xy);\n                  }\n                  ")):h+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xC").concat(y," = xTexelC").concat(y,";\n                "),y+1<d)){var b=s%2===0?l.util.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(h+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(b,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                    xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(y+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(y+1,"Ready = 1;\n                  }\n                  "),c>1&&(h+="\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                      xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n                      xTexelC").concat(y,"Ready = 1;\n                    }\n                    ")),h+="\n                  xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".xy);\n                  ")):h+=1===b?"\n                    xC".concat(y+1," = xTexelC").concat(y,";\n                    "):"\n                    xCOffset = xC + ".concat(b,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                      xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(y+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(y+1,"Ready = 1;\n                    }\n\n                    xC").concat(y+1," = xTexelC").concat(y+1,";\n                    ")}}else y<d&&(s%2===1?(h+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n              "),y+1<d&&(h+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(y+1," = vec4(xTexelC").concat(y+1,".xy, final.xy);\n                "))):(h+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(\n                  xTexelC").concat(y,".xy, xTexelC").concat(y+1,".xy);\n              "),y+1<d&&(h+="\n                  xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n                "))));y<d&&(h+="\n            wTexel = getW(r, ".concat(y,", d1, q);\n            dotProd += xC").concat(y," * vec4(wTexel.xz, wTexel.xz);\n          "),y+1<d&&(h+="\n              wTexel = getW(r, ".concat(y+1,", d1, q);\n              dotProd += xC").concat(y+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}h+="\n    }\n  ",h+="\n      }\n    ";var x="",k="";r&&(x=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(h,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")}));var HN={kernelName:l.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,p=u;null==p&&(p=[1,1]),l.util.assert(l.backend_util.eitherStridesOrDilationsAreOne(o,p),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(p,"'")}));var d,f=l.backend_util.computeConv2DInfo(a.shape,i.shape,o,p,s,c,!0);d=(0,l.env)().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?new jN(f):new GN(f);var h=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(d,[a,i],"float32",h)}},qN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),KN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var XN={kernelName:l.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,p=r.filterShape,d=l.backend_util.computeConv2DInfo(a.shape,p,o,s,u,c,!0),f=new qN(d);return n.runWebGLProgram(f,[a,i],"float32")}};var YN={kernelName:l.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,p=r.inputShape,d=l.backend_util.computeConv2DInfo(p,i.shape,o,s,u,c,!0),f=new KN(d);return n.runWebGLProgram(f,[a,i],"float32")}},QN=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var JN={kernelName:l.Diag,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat((0,Qn.Z)(r.shape),(0,Qn.Z)(r.shape)),i=l.util.sizeFromShape(r.shape),o=DS({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new QN(i),u=n.runWebGLProgram(s,[o],o.dtype),c=DS({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},$N=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,p=a.top,d=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(d,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var eT={kernelName:l.Dilation2D,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,p=l.backend_util.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),d=new $N(p),f=DS({inputs:{x:t=r.runWebGLProgram(d,[i,o],"float32")},backend:r,attrs:{shape:p.outShape}});return r.disposeIntermediateTensorInfo(t),f}};var tT={kernelName:l.Einsum,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=l.backend_util.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;l.backend_util.checkEinsumDimSizes(o.length,u,a);for(var c=l.backend_util.getEinsumComputePath(s,u),p=c.path,d=c.steps,f=d.length,h=null,m=o.length,v=[],g=0;g<f;++g){var y,b=(0,ra.Z)(d[g]);try{for(b.s();!(y=b.n()).done;){var x=y.value,k=l.backend_util.getEinsumPermutation(m,u[x]),w=k.permutationIndices,S=k.expandDims,I=void 0;l.backend_util.isIdentityPermutation(w)?I=a[x]:(I=US({inputs:{x:a[x]},backend:n,attrs:{perm:w}}),v.push(I));for(var N=I.shape.slice(),T=0;T<S.length;++T)N.splice(S[T],0,1);l.util.arraysEqual(I.shape,N)||(I=DS({inputs:{x:I},backend:n,attrs:{shape:N}}),v.push(I)),null===h?h=I:(h=RS({inputs:{a:I,b:h},backend:n}),v.push(h))}}catch(A){b.e(A)}finally{b.f()}g<f-1&&(p[g]>=0&&(h=WS({inputs:{x:h},backend:n,attrs:{axis:p[g]-(o.length-m),keepDims:!1}}),v.push(h)),m--)}for(var C=0,E=v;C<E.length;C++){var _=E[C];_!==h&&n.disposeIntermediateTensorInfo(_)}return h}},nT=SS({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),rT={kernelName:l.Elu,backendName:"webgl",kernelFunc:nT},aT={kernelName:l.EluGrad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=(0,l.env)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new dS("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new pS("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},iT=IS({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:$k}),oT={kernelName:l.Equal,backendName:"webgl",kernelFunc:iT},sT=SS({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(l.backend_util.ERF_P,";\n  float a1 = ").concat(l.backend_util.ERF_A1,";\n  float a2 = ").concat(l.backend_util.ERF_A2,";\n  float a3 = ").concat(l.backend_util.ERF_A3,";\n  float a4 = ").concat(l.backend_util.ERF_A4,";\n  float a5 = ").concat(l.backend_util.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),uT={kernelName:l.Erf,backendName:"webgl",kernelFunc:sT},cT=SS({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:ew,dtype:"float32"}),lT={kernelName:l.Exp,backendName:"webgl",kernelFunc:cT};function pT(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(l.util.assert(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),DS({inputs:{x:i},backend:r,attrs:{shape:s}})}var dT={kernelName:l.ExpandDims,backendName:"webgl",kernelFunc:pT},fT="return exp(x) - 1.0;",hT=SS({opSnippet:fT,packedOpSnippet:fT,cpuKernelImpl:tw}),mT={kernelName:l.Expm1,backendName:"webgl",kernelFunc:hT},vT=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function gT(e,t,n){var r=n.texData.get(e.dataId),a=l.util.sizeFromShape(e.shape),i=e.shape[e.shape.length-1],o=DS({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new vT("real",s,t),c=new vT("imag",s,t),p=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],d=n.runWebGLProgram(u,p,"float32"),f=n.runWebGLProgram(c,p,"float32"),h=mS({inputs:{real:d,imag:f},backend:n});n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f);var m=DS({inputs:{x:h},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(h),m}var yT={kernelName:l.FFT,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return gT(t.input,!1,n)}},bT=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function xT(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||l.util.inferDtype(a))){var o=l.util.getArrayFromDType(i,l.util.sizeFromShape(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new bT(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var kT,wT={kernelName:l.Fill,backendName:"webgl",kernelFunc:xT},ST=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),IT={kernelName:l.FlipLeftRight,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new ST(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},NT="return floor(x);",TT=SS({opSnippet:NT,packedOpSnippet:NT,cpuKernelImpl:nw}),CT={kernelName:l.Floor,backendName:"webgl",kernelFunc:TT},ET=IS({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),_T={kernelName:l.FloorDiv,backendName:"webgl",kernelFunc:ET},AT=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["A"];var n=Yx(),r=(0,p.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),RT=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Yx(),r=(0,p.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),FT={kernelName:l.FromPixels,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=(0,p.Z)(u,2),d=c[0],f=c[1],h=[f,d],m=[f,d,i];(s||o)&&(null==kT&&(kT=document.createElement("canvas").getContext("2d")),kT.canvas.width=d,kT.canvas.height=f,kT.drawImage(a,0,0,d,f),a=kT.canvas);var v=n.makeTensorInfo(h,"int32");n.texData.get(v.dataId).usage=fx.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(v.dataId),a);var g=(0,l.env)().getBool("WEBGL_PACK")?new RT(m):new AT(m),y=n.runWebGLProgram(g,[v],"int32");return n.disposeData(v.dataId),y}};var DT={kernelName:l.FusedConv2D,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,p=a.pad,d=a.dataFormat,f=a.dilations,h=a.dimRoundingMode,m=a.activation,v=a.leakyreluAlpha,g=l.backend_util.convertConv2DDataFormat(d),y=l.backend_util.computeConv2DInfo(i.shape,o.shape,c,f,p,h,!1,g),b=[];if(1!==y.filterHeight||1!==y.filterWidth||1!==y.dilationHeight||1!==y.dilationWidth||1!==y.strideHeight||1!==y.strideWidth||"SAME"!==y.padInfo.type&&"VALID"!==y.padInfo.type)if((0,l.env)().getBool("WEBGL_CONV_IM2COL"))t=gN({x:i,filter:o,convInfo:y,backend:r,bias:s,activation:m,preluActivationWeights:u,leakyreluAlpha:v});else{var x=null!=s,k=null!=u,w="leakyrelu"===m,S=m?NS(m,!1):null,I=new dN(y,x,S,k,w),N=[i,o],T=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=DS({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return b.push(n),n}return e};if(x&&N.push(T(s,d)),k&&N.push(T(u,d)),w){var C=r.makeTensorInfo([],"float32",l.util.createScalarValue(v,"float32"));N.push(C),b.push(C)}t=r.runWebGLProgram(I,N,"float32")}else t=vN({x:i,filter:o,convInfo:y,backend:r,bias:s,activation:m,preluActivationWeights:u,leakyreluAlpha:v});var E=DS({inputs:{x:t},backend:r,attrs:{shape:y.outShape}});return b.push(t),b.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),E}};var ZT={kernelName:l.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,p=r.dilations,d=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=[],v=p;null==v&&(v=[1,1]),l.util.assert(l.backend_util.eitherStridesOrDilationsAreOne(u,v),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(v,"'")}));var g,y=l.backend_util.computeConv2DInfo(a.shape,i.shape,u,v,c,d,!0),b=(0,l.env)().getBool("WEBGL_PACK_DEPTHWISECONV")&&y.strideWidth<=2&&y.outChannels/y.inChannels===1,x=f?NS(f,b):null,k=[a,i],w=null!=o,S=null!=s,I="leakyrelu"===f;if(w&&k.push(o),S&&k.push(s),I){var N=n.makeTensorInfo([],"float32",l.util.createScalarValue(h,"float32"));k.push(N),m.push(N)}g=b?new jN(y,w,x,S,I):new GN(y,w,x,S,I);var T=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]],C=n.runWebGLProgram(g,k,"float32",T);return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),C}},OT=(0,ia.Z)((function e(t,n,r,a){(0,aa.Z)(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;var i=kk(n.length),o=kk(r.length),s=this.sliceDim>1?"strides[j]":"strides",u=kk(a.length),c=a.length>1?"paramsShape[j]":"paramsShape";this.userCode="\n        ".concat(i," strides = ").concat(i,"(").concat(this.strides,");\n        ").concat(u," paramsShape = ").concat(u,"(").concat(this.paramsShape,");\n         void main() {\n          ").concat(o," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            out_of_bounds = out_of_bounds || index < 0;\n            out_of_bounds = out_of_bounds || index >= ").concat(c,";\n            flattenIndex += index * ").concat(s,";\n          }\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var MT={kernelName:l.GatherNd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=l.util.sizeFromShape(r.shape),u=l.backend_util.prepareAndValidate(r,a),c=(0,p.Z)(u,4),d=c[0],f=c[1],h=c[2],m=c[3],v=DS({inputs:{x:a},backend:n,attrs:{shape:[f,o]}}),g=DS({inputs:{x:r},backend:n,attrs:{shape:[l.util.sizeFromShape(r.shape)/h,h]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var y=n.readSync(a.dataId),b=n.bufferSync(r),x=rw(y,b,r.dtype,f,o,h,m,r.shape,s);return n.makeTensorInfo(d,r.dtype,x.values)}var k=new OT(o,m,[f,h],r.shape),w=n.runWebGLProgram(k,[g,v],g.dtype),S=DS({inputs:{x:w},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(w),S}},zT=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=kk(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function LT(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=l.util.parseAxisParam(o,a.shape)[0];(0,l.env)().get("DEBUG")&&function(){for(var e=n.readSync(i.dataId),t=a.shape[u],r=function(n){var r=e[n];l.util.assert(r<=t-1&&r>=0,(function(){return"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]")}))},o=0;o<e.length;++o)r(o)}();var c=l.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),p=l.util.sizeFromShape(i.shape),d=[],f=DS({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),h=DS({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,p/c.batchSize]}});d.push(f),d.push(h);var m=[c.batchSize,c.outerSize,p/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var v=n.bufferSync(h),g=n.bufferSync(f),y=aw(g,v,m);return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(c.outputShape,y.dtype,y.values)}var b=new zT(f.shape,m),x=n.runWebGLProgram(b,[f,h],f.dtype);d.push(x);var k=DS({inputs:{x:x},backend:n,attrs:{shape:c.outputShape}});return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),k}var PT={kernelName:l.GatherV2,backendName:"webgl",kernelFunc:LT},BT=IS({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:iw,dtype:"bool"}),WT={kernelName:l.Greater,backendName:"webgl",kernelFunc:BT},VT=IS({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:ow}),UT={kernelName:l.GreaterEqual,backendName:"webgl",kernelFunc:VT};var GT={kernelName:l.IFFT,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return gT(t.input,!0,n)}},jT=SS({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),HT={kernelName:l.IsFinite,backendName:"webgl",kernelFunc:jT},qT=SS({opSnippet:"return float(isinf(x));",dtype:"bool"}),KT={kernelName:l.IsInf,backendName:"webgl",kernelFunc:qT},XT=SS({opSnippet:"return float(isnan(x));",dtype:"bool"}),YT={kernelName:l.IsNan,backendName:"webgl",kernelFunc:XT},QT=IS({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:sw,dtype:"bool"}),JT={kernelName:l.Less,backendName:"webgl",kernelFunc:QT},$T=IS({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:uw,dtype:"bool"}),eC={kernelName:l.LessEqual,backendName:"webgl",kernelFunc:$T};var tC={kernelName:l.LinSpace,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=cw(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},nC=SS({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:lw}),rC={kernelName:l.Log,backendName:"webgl",kernelFunc:nC},aC=SS({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"}),iC={kernelName:l.Log1p,backendName:"webgl",kernelFunc:aC},oC=IS({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),sC={kernelName:l.LogicalAnd,backendName:"webgl",kernelFunc:oC},uC=SS({opSnippet:"return float(!(x >= 1.0));"}),cC={kernelName:l.LogicalNot,backendName:"webgl",kernelFunc:uC},lC=IS({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),pC={kernelName:l.LogicalOr,backendName:"webgl",kernelFunc:lC},dC=(0,ia.Z)((function e(t,n,r,a,i){(0,aa.Z)(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")})),fC=(0,ia.Z)((function e(t,n,r,a,i){(0,aa.Z)(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")})),hC={kernelName:l.LRN,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=(0,l.env)().getBool("WEBGL_PACK_NORMALIZATION")?new fC(a.shape,i,o,s,u):new dC(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},mC=(0,ia.Z)((function e(t,n,r,a,i){(0,aa.Z)(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),vC={kernelName:l.LRNGrad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,p=new mC(a.shape,s,u,c,l);return n.runWebGLProgram(p,[a,i,o],a.dtype)}};function gC(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=l.util.parseAxisParam(i,a.shape),c=u,d=l.backend_util.getAxesPermutation(c,s),f=null!=d,h=n.shouldExecuteOnCPU([a]),m=a;if(f){if(h){for(var v=n.texData.get(m.dataId).values,g=new Array(s),y=0;y<g.length;y++)g[y]=a.shape[d[y]];var b=Ow(v,a.shape,a.dtype,d,g);m=n.makeTensorInfo(g,a.dtype),n.texData.get(m.dataId).values=b}else m=BS(a,d,n);c=l.backend_util.getInnerMostAxes(c.length,s)}l.backend_util.assertAxesAreInnerMostDims("max",c,s);var x,k=l.backend_util.computeOutAndReduceShapes(m.shape,c),w=(0,p.Z)(k,2),S=w[0],I=w[1],N=S;if(o&&(N=l.backend_util.expandShapeToKeepDim(S,u)),h){v=n.texData.get(m.dataId).values;var T=pw(v,l.util.sizeFromShape(I),N,a.dtype);x=n.makeTensorInfo(N,a.dtype),n.texData.get(x.dataId).values=T}else x=function(e,t,n,r){var a=l.util.sizeFromShape(t),i=DS({inputs:{x:e},attrs:{shape:[l.util.sizeFromShape(e.shape)/a,a]},backend:r}),o=zS(i,e.dtype,"max",r),s=DS({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,I,N,n);return f&&n.disposeIntermediateTensorInfo(m),x}var yC={kernelName:l.Max,backendName:"webgl",kernelFunc:gC},bC=IS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:dw}),xC={kernelName:l.Maximum,backendName:"webgl",kernelFunc:bC};var kC={kernelName:l.MaxPool,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Kx(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;l.util.assert(l.backend_util.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=l.backend_util.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&l.util.arraysEqual(c.inShape,c.outShape))return fS({inputs:{x:a},backend:n});var p=new II(c,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}};var wC={kernelName:l.MaxPool3D,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,p=l.backend_util.computePool3DInfo(a.shape,i,o,[1,1,1],s,c,u),d=new NI(p,"max",!1);return n.runWebGLProgram(d,[a],a.dtype)}},SC=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),IC=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,p=u-1-t.padInfo.front,d=c-1-t.padInfo.top,f=l-1-t.padInfo.left,h=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(d,", ").concat(f,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(h," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var NC={kernelName:l.MaxPool3DGrad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,p=l.backend_util.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),d=new NI(p,"max",!0),f=n.runWebGLProgram(d,[i],i.dtype),h=new IC(p),m=n.runWebGLProgram(h,[a,f],i.dtype);return n.disposeIntermediateTensorInfo(f),m}};var TC={kernelName:l.MaxPoolGrad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Kx([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,p=r.dimRoundingMode,d=l.backend_util.computePool2DInfo(o.shape,s,u,1,c,p),f=new II(d,"max",!0),h=n.runWebGLProgram(f,[o],o.dtype),m=new SC(d),v=n.runWebGLProgram(m,[a,h],o.dtype);return n.disposeIntermediateTensorInfo(h),v}};var CC={kernelName:l.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;l.util.assert(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var d=[1,1];l.util.assert(l.backend_util.eitherStridesOrDilationsAreOne(o,d),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(d,"'")}));var f=l.backend_util.computePool2DInfo(a.shape,i,o,d,s),h=function(e,t,n,r){var a=new II(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new II(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,f,c),m=(0,p.Z)(h,2);return[m[0],m[1]]}};var EC={kernelName:l.Mean,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=l.util.parseAxisParam(o,a.shape),d=c,f=l.backend_util.getAxesPermutation(d,u),h=null!=f,m=s.shouldExecuteOnCPU([a]),v=[],g=a;if(h){if(m){for(var y=s.texData.get(g.dataId).values,b=new Array(u),x=0;x<b.length;x++)b[x]=a.shape[f[x]];var k=Ow(y,a.shape,a.dtype,f,b);g=s.makeTensorInfo(b,a.dtype),s.texData.get(g.dataId).values=k}else g=BS(a,f,s);v.push(g),d=l.backend_util.getInnerMostAxes(d.length,u)}l.backend_util.assertAxesAreInnerMostDims("sum",d,u);var w=l.backend_util.computeOutAndReduceShapes(g.shape,d),S=(0,p.Z)(w,2),I=S[0],N=S[1],T=I;i&&(T=l.backend_util.expandShapeToKeepDim(I,c));for(var C=function(e,t,n,r){var a=l.util.sizeFromShape(t),i=DS({inputs:{x:e},attrs:{shape:[l.util.sizeFromShape(e.shape)/a,a]},backend:r}),o=zS(i,"float32","mean",r),s=DS({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(g,N,T,s),E=0,_=v;E<_.length;E++){x=_[E];s.disposeIntermediateTensorInfo(x)}return C}};var _C={kernelName:l.Min,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=l.util.parseAxisParam(i,a.shape),c=u,d=l.backend_util.getAxesPermutation(c,s),f=a;null!=d&&(f=US({inputs:{x:a},backend:n,attrs:{perm:d}}),c=l.backend_util.getInnerMostAxes(c.length,a.shape.length)),l.backend_util.assertAxesAreInnerMostDims("min",c,s);var h,m=l.backend_util.computeOutAndReduceShapes(f.shape,c),v=(0,p.Z)(m,2),g=v[0],y=v[1],b=DS({inputs:{x:f},backend:n,attrs:{shape:[-1,l.util.sizeFromShape(y)]}}),x=zS(b,b.dtype,"min",n);return h=DS(o?{inputs:{x:x},backend:n,attrs:{shape:l.backend_util.expandShapeToKeepDim(g,u)}}:{inputs:{x:x},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(x),null!=d&&n.disposeIntermediateTensorInfo(f),h}},AC=IS({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:fw}),RC={kernelName:l.Minimum,backendName:"webgl",kernelFunc:AC},FC=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=kk(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),DC=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=kk(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=Lw("rc",a),c=Lw("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),d="reflect"===r?0:1,f="";if(1===a){var h="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(d,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(d,";\n        }\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(h,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(h,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(d,") +\n                gte * ((end - 1) * 2 - source + ").concat(d,");\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),ZC={kernelName:l.MirrorPad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=(0,l.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new DC(a.shape,i,o):new FC(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},OC=IS({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),MC={kernelName:l.Mod,backendName:"webgl",kernelFunc:OC},zC=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),LC=IS({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),PC={kernelName:l.RealDiv,backendName:"webgl",kernelFunc:LC},BC="return a - b;",WC=IS({opSnippet:BC,packedOpSnippet:BC,supportsComplex:!0,cpuKernelImpl:Fw}),VC={kernelName:l.Sub,backendName:"webgl",kernelFunc:WC};function UC(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=l.util.parseAxisParam([i],a.shape),s=gC({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=l.backend_util.expandShapeToKeepDim(s.shape,o),c=DS({inputs:{x:s},backend:n,attrs:{shape:u}}),p=WC({inputs:{a:a,b:c},backend:n}),d=cT({inputs:{x:p},backend:n}),f=WS({inputs:{x:d},backend:n,attrs:{axis:o,keepDims:!1}}),h=DS({inputs:{x:f},backend:n,attrs:{shape:u}}),m=LC({inputs:{a:d,b:h},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),m}var GC={kernelName:l.Softmax,backendName:"webgl",kernelFunc:UC};var jC={kernelName:l.Multinomial,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:UC({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],p=new zC(c,l,i),d=[[o]],f=n.runWebGLProgram(p,[u],"int32",d);return s||n.disposeIntermediateTensorInfo(u),f}};var HC={kernelName:l.Neg,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=mw(i.values,a.shape,a.dtype),s=(0,p.Z)(o,2),u=s[0],c=s[1];return r.makeTensorInfo(c,a.dtype,u)}return t=(0,l.env)().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new iS(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new jw(a.shape,"if (isnan(x)) return x;\n  return -x;\n"),r.runWebGLProgram(t,[a],a.dtype)}},qC=l.kernel_impls.nonMaxSuppressionV3Impl;var KC={kernelName:l.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:function(e){l.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),p=n.readSync(i.dataId),d=qC(c,p,o,s,u).selectedIndices;return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}},XC=l.kernel_impls.nonMaxSuppressionV4Impl;var YC={kernelName:l.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:function(e){l.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,p=n.readSync(a.dataId),d=n.readSync(i.dataId),f=XC(p,d,o,s,u,c),h=f.selectedIndices,m=f.validOutputs;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}},QC=l.kernel_impls.nonMaxSuppressionV5Impl;var JC={kernelName:l.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:function(e){l.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,p=n.readSync(a.dataId),d=n.readSync(i.dataId),f=QC(p,d,o,s,u,c),h=f.selectedIndices,m=f.selectedScores;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([m.length],"float32",new Float32Array(m))]}},$C=(0,ia.Z)((function e(t,n,r,a){(0,aa.Z)(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),eE={kernelName:l.OneHot,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue,u=l.util.sizeFromShape(a.shape),c=new $C(u,i,o,s),p=DS({inputs:{x:a},backend:n,attrs:{shape:[u]}}),d=n.runWebGLProgram(c,[p],a.dtype);n.disposeIntermediateTensorInfo(p);var f=DS({inputs:{x:d},backend:n,attrs:{shape:[].concat((0,Qn.Z)(a.shape),[i])}});return n.disposeIntermediateTensorInfo(d),f}};function tE(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=HI({inputs:{input:r},backend:n}),i=tE({inputs:{x:a},backend:n}),o=sN({inputs:{input:r},backend:n}),s=tE({inputs:{x:o},backend:n}),u=mS({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return xT({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var nE={kernelName:l.ZerosLike,backendName:"webgl",kernelFunc:tE};var rE={kernelName:l.OnesLike,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=HI({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=sN({inputs:{input:a},backend:r}),u=tE({inputs:{x:s},backend:r}),c=mS({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return xT({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var aE={kernelName:l.Pack,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return pT({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){l.util.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),l.util.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=lN({inputs:t.map((function(e){var t=pT({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},iE=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=kk(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),oE=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=kk(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=Lw("rc",a),c=Lw("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),d=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],f=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",m=0,v=1===a?2:4;m<v;m++)h+="\n        ".concat(d[m],"\n        if (").concat(f,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ");h+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(h,"\n        setOutput(result);\n      }\n    ")})),sE=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===l.util.sizeFromShape(a.shape)){var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]}));return xT({backend:n,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=(0,l.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oE(a.shape,i,o):new iE(a.shape,i,o),c=[[o]];return n.runWebGLProgram(u,[a],a.dtype,c)},uE={kernelName:l.PadV2,backendName:"webgl",kernelFunc:sE},cE=IS({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),lE={kernelName:l.Pow,backendName:"webgl",kernelFunc:cE};var pE={kernelName:l.Prod,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],d=l.util.parseAxisParam(o,i.shape),f=d,h=l.backend_util.getAxesPermutation(f,u),m=i;if(null!=h&&(m=US({inputs:{x:i},backend:r,attrs:{perm:h}}),f=l.backend_util.getInnerMostAxes(f.length,u),c.push(m)),l.backend_util.assertAxesAreInnerMostDims("prod",f,u),r.shouldExecuteOnCPU([m])){var v=r.texData.get(m.dataId).values,g=gw(m.shape,m.dtype,v,f),y=g.outVals,b=g.outShape,x=g.outDtype;t=r.makeTensorInfo(b,x,y)}else{var k=l.backend_util.computeOutAndReduceShapes(m.shape,f),w=(0,p.Z)(k,2),S=w[0],I=w[1],N=l.util.sizeFromShape(I),T=DS({inputs:{x:m},backend:r,attrs:{shape:[-1,N]}}),C=zS(T,(0,l.sumOutType)(i.dtype),"prod",r);t=DS({inputs:{x:C},backend:r,attrs:{shape:S}}),c.push(T),c.push(C)}if(s){c.push(t);var E=l.backend_util.expandShapeToKeepDim(t.shape,d);t=DS({inputs:{x:t},backend:r,attrs:{shape:E}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}},dE=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=yw(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},fE={kernelName:l.Range,backendName:"webgl",kernelFunc:dE},hE=SS({opSnippet:"return 1.0 / x;"}),mE={kernelName:l.Reciprocal,backendName:"webgl",kernelFunc:hE},vE=SS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),gE={kernelName:l.Relu,backendName:"webgl",kernelFunc:vE},yE=SS({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),bE={kernelName:l.Relu6,backendName:"webgl",kernelFunc:yE},xE=(0,ia.Z)((function e(t,n,r,a,i){(0,aa.Z)(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,p.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var d,f=[a&&n>1?u-1:u,a&&r>1?c-1:c],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];d=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),kE=(0,ia.Z)((function e(t,n,r,a,i){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,p.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var d,f=[a&&n>1?u-1:u,a&&r>1?c-1:c],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];d=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],",\n          ").concat(f[1]/h[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var wE={kernelName:l.ResizeBilinear,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,p.Z)(s,2),c=u[0],d=u[1],f=(0,l.env)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new kE(a.shape,c,d,i,o):new xE(a.shape,c,d,i,o);return n.runWebGLProgram(f,[a],"float32")}},SE=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,p.Z)(n,3),i=a[1],o=a[2],s=(0,p.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],d=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/d[0],h=l[1]/d[1],m=1/f,v=1/h,g=2*Math.ceil(m)+2,y=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(h,");\n\n        const float invHeightScale = float(").concat(m,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var IE={kernelName:l.ResizeBilinearGrad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new SE(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},NE=(0,ia.Z)((function e(t,n,r,a,i){(0,aa.Z)(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,p.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var d,f=[a&&n>1?u-1:u,a&&r>1?c-1:c],h=[a&&n>1?n-1:n,a&&r>1?r-1:r],m=a?"0.5":"0.0";d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(m,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),TE=(0,ia.Z)((function e(t,n,r,a,i){(0,aa.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,p.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var d,f=[a&&n>1?u-1:u,a&&r>1?c-1:c],h=[a&&n>1?n-1:n,a&&r>1?r-1:r],m=a?"0.5":"0.0";d=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/h[0],",\n          ").concat(f[1]/h[1],",\n          ").concat(f[1]/h[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(m,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var CE={kernelName:l.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,p.Z)(s,2),c=u[0],d=u[1],f=(0,l.env)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new TE(a.shape,c,d,i,o):new NE(a.shape,c,d,i,o);return n.runWebGLProgram(f,[a],a.dtype)}},EE=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,p.Z)(n,3),i=a[1],o=a[2],s=(0,p.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],d=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/d[0],h=l[1]/d[1],m=1/f,v=1/h,g=2*Math.ceil(m)+2,y=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(h,");\n\n        const float invHeightScale = float(").concat(m,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(d[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(d[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var _E={kernelName:l.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new EE(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},AE=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=kk(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),RE=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=Lw("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=kk(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var FE={kernelName:l.Reverse,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=l.util.parseAxisParam(i,a.shape);if(0===o)return fS({inputs:{x:a},backend:n});var u=(0,l.env)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RE(a.shape,s):new AE(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},DE=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"===typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),ZE={kernelName:l.RotateWithOffset,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new DE(a.shape,o),d=l.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),f=(0,p.Z)(d,2),h=[[f[0],f[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(c,[a],a.dtype,h)}},OE=SS({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),ME={kernelName:l.Round,backendName:"webgl",kernelFunc:OE},zE=SS({opSnippet:"return inversesqrt(x);",cpuKernelImpl:bw}),LE={kernelName:l.Rsqrt,backendName:"webgl",kernelFunc:zE},PE=(0,ia.Z)((function e(t,n,r,a,i,o){(0,aa.Z)(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=kk(i.length),u=kk(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),p="";1===a?p="i":2===a&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),f=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(f,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}));var BE={kernelName:l.ScatterNd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=l.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,p=s.sliceSize,d=s.strides,f=s.outputSize,h=[f/p,p];if(0===f)return n.makeTensorInfo(o,a.dtype);var m=DS({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),v=DS({inputs:{x:i},backend:n,attrs:{shape:[c,p]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0])),y=new PE(c,u,m.shape.length,v.shape.length,d,h),b=n.runWebGLProgram(y,[v,m,g],v.dtype),x=DS({inputs:{x:b},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(g),x}},WE=(0,ia.Z)((function e(t,n,r,a){(0,aa.Z)(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===(0,l.env)().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var VE={kernelName:l.SearchSorted,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new WE(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},UE=(0,ia.Z)((function e(t,n,r){var a,i;if((0,aa.Z)(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=kk(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var GE={kernelName:l.Select,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new UE(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],(0,l.upcastType)(a.dtype,i.dtype))}},jE=SS({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(l.backend_util.SELU_SCALEALPHA,";\n  float scale = ").concat(l.backend_util.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),HE={kernelName:l.Selu,backendName:"webgl",kernelFunc:jE},qE=SS({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:kw}),KE={kernelName:l.Sigmoid,backendName:"webgl",kernelFunc:qE},XE=SS({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),YE={kernelName:l.Sign,backendName:"webgl",kernelFunc:XE},QE=SS({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),JE={kernelName:l.Sin,backendName:"webgl",kernelFunc:QE},$E=SS({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),e_={kernelName:l.Sinh,backendName:"webgl",kernelFunc:$E},t_=SS({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),n_={kernelName:l.Softplus,backendName:"webgl",kernelFunc:t_},r_={kernelName:l.SpaceToBatchND,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;l.util.assert(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,(0,Qn.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var p=[],d=sE({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),f=l.backend_util.getReshaped(d.shape,i,s,!1),h=l.backend_util.getPermuted(f.length,i.length,!1),m=l.backend_util.getReshapedPermuted(d.shape,i,s,!1),v=DS({inputs:{x:d},backend:n,attrs:{shape:f}}),g=US({inputs:{x:v},backend:n,attrs:{perm:h}}),y=DS({inputs:{x:g},backend:n,attrs:{shape:m}});return p.push(d),p.push(v),p.push(g),p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}};var a_={kernelName:l.SparseFillEmptyRows,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],d=Iw(s,r.shape,r.dtype,u,a.dtype,c,l),f=(0,p.Z)(d,5),h=f[0],m=f[1],v=f[2],g=f[3],y=f[4];return[n.makeTensorInfo(m,r.dtype,h),n.makeTensorInfo([m[0]],a.dtype,v),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}};var i_={kernelName:l.SparseReshape,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),c=Nw(s,r.shape,r.dtype,o,u),l=(0,p.Z)(c,3),d=l[0],f=l[1],h=l[2];return[n.makeTensorInfo(f,r.dtype,d),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};var o_={kernelName:l.SparseSegmentMean,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=Tw(o,r.shape,r.dtype,s,u,!0),l=(0,p.Z)(c,2),d=l[0],f=l[1];return n.makeTensorInfo(f,r.dtype,d)}};var s_={kernelName:l.SparseSegmentSum,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=Tw(o,r.shape,r.dtype,s,u),l=(0,p.Z)(c,2),d=l[0],f=l[1];return n.makeTensorInfo(f,r.dtype,d)}};var u_={kernelName:l.SparseToDense,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=l.backend_util.calculateShapes(i,a,s),c=u.sliceRank,p=u.numUpdates,d=u.sliceSize,f=u.strides,h=u.outputSize;if("string"===i.dtype){var m=n.bufferSync(a),v=n.bufferSync(i),g=l.util.decodeString(n.readSync(o.dataId)[0]),y=xw(m,v,s,h,d,p,c,f,g,false);return n.makeTensorInfo(s,y.dtype,y.values)}var b=new PE(p,c,a.shape.length,i.shape.length,f,[h,1],false),x=n.runWebGLProgram(b,[i,a,o],i.dtype),k=DS({inputs:{x:x},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(x),k}};var c_={kernelName:l.SplitV,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=l.util.parseAxisParam(o,a.shape)[0],u=l.backend_util.prepareSplitSize(a,i,s),c=a.shape.length,p=new Array(c).fill(0),d=a.shape.slice();return u.map((function(e){var t=(0,Qn.Z)(d);t[s]=e;var r=PI({inputs:{x:a},backend:n,attrs:{begin:p,size:t}});return p[s]+=e,r}))}},l_="return sqrt(x);",p_=SS({opSnippet:l_,packedOpSnippet:l_,cpuKernelImpl:Cw}),d_={kernelName:l.Sqrt,backendName:"webgl",kernelFunc:p_},f_=SS({opSnippet:"return x * x;"}),h_={kernelName:l.Square,backendName:"webgl",kernelFunc:f_},m_="return (a - b) * (a - b);",v_=IS({opSnippet:m_,packedOpSnippet:m_}),g_={kernelName:l.SquaredDifference,backendName:"webgl",kernelFunc:v_};var y_={kernelName:l.Step,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=Hw+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new jw(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},b_=(0,ia.Z)((function e(t,n,r){(0,aa.Z)(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=kk(r.length),o=kk(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var x_={kernelName:l.StridedSlice,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,p=a.endMask,d=a.ellipsisMask,f=a.newAxisMask,h=a.shrinkAxisMask,m=l.slice_util.sliceInfo(i.shape,o,s,u,c,p,d,f,h),v=m.finalShapeSparse,g=m.finalShape,y=m.isIdentity,b=m.sliceDim0,x=m.isSimpleSlice,k=m.begin,w=m.end,S=m.strides;if(y)t=DS({inputs:{x:i},backend:r,attrs:{shape:g}});else if(b||x){l.util.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var I=l.slice_util.computeOutShape(k,w,S),N=PI({inputs:{x:i},backend:r,attrs:{begin:k,size:I}});t=DS({inputs:{x:N},backend:r,attrs:{shape:g}}),r.disposeIntermediateTensorInfo(N)}else{if(r.shouldExecuteOnCPU([i])){var T=r.readSync(i.dataId),C=(0,l.buffer)(i.shape,i.dtype,T),E=Ew(v,C,S,k);t=r.makeTensorInfo(g,i.dtype,E.values)}else{var _=new b_(k,S,v);t=r.runWebGLProgram(_,[i],i.dtype)}}var A=DS({inputs:{x:t},backend:r,attrs:{shape:g}});return r.disposeIntermediateTensorInfo(t),A}};var k_={kernelName:l.StringNGrams,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,d=t.dataSplits,f=n.readSync(l.dataId),h=n.readSync(d.dataId),m=_w(f,h,a,i,o,s,u,c),v=(0,p.Z)(m,2),g=v[0],y=v[1];return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(d.shape,"int32",y)]}};var w_={kernelName:l.StringSplit,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=Aw(o,s,r),c=(0,p.Z)(u,3),l=c[0],d=c[1],f=c[2],h=d.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(f))]}};var S_={kernelName:l.StringToHashBucketFast,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=Rw(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},I_=SS({opSnippet:"return tan(x);"}),N_={kernelName:l.Tan,backendName:"webgl",kernelFunc:I_},T_=SS({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),C_={kernelName:l.Tanh,backendName:"webgl",kernelFunc:T_},E_=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=kk(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function __(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return l.util.decodeString(e)})):o,u=(0,l.buffer)(a.shape,a.dtype,s),c=Dw(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var p=new E_(a.shape,i);return n.runWebGLProgram(p,[a],a.dtype)}var A_={kernelName:l.Tile,backendName:"webgl",kernelFunc:__},R_=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),F_=(0,ia.Z)((function e(t){(0,aa.Z)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function D_(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function Z_(e){for(var t=1;t<e;)t*=2;return t}var O_={kernelName:l.TopK,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=(0,l.env)().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=(0,l.env)().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,d=c[c.length-1];if(n.shouldExecuteOnCPU([a])||d<s||i>u){var f=n.readSync(a.dataId),h=Zw(f,c,a.dtype,i,o),m=(0,p.Z)(h,2),v=m[0],g=m[1];return[n.makeTensorInfo(v.shape,v.dtype,v.values),n.makeTensorInfo(g.shape,g.dtype,g.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===d)return[a,xT({attrs:{shape:c,dtype:"int32",value:0},backend:n})];var y=n.texData.get(a.dataId),b=null!==y&&y.isPacked,x=b?n.unpackTensor(a):a,k=l.util.sizeFromShape(c)/d,w=DS({inputs:{x:x},attrs:{shape:[k,d]},backend:n});b&&D_(n,x);for(var S=Z_(i),I=Z_(d),N=null,T=function(){return null===N?[w,w]:[w,N]},C=function(e,t,r){var a=T(),i=new R_(r),o=[[d],[null===N?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=N;N=n.runWebGLProgram(i,a,"int32",o),D_(n,s)},E=1;E<S;E*=2)for(var _=2*E,A=E;A>=1;A/=2)C(_,A,[k,I]);for(var R=I;R>S;R/=2){var F=T(),D=new F_([k,R/2]),Z=[[d],[null===N?1:0],[S]],O=N;N=n.runWebGLProgram(D,F,"int32",Z),D_(n,O);for(var M=S/2,z=2*M,L=M;L>=1;L/=2)C(z,L,N.shape)}var P=N;N=PI({inputs:{x:N},backend:n,attrs:{begin:0,size:[k,i]}}),D_(n,P);var B=LT({inputs:{x:w,indices:N},backend:n,attrs:{axis:1,batchDims:1}});D_(n,w);var W=c.slice(0,-1);W.push(i),P=N,N=DS({inputs:{x:N},attrs:{shape:W},backend:n}),D_(n,P);var V=B;return B=DS({inputs:{x:B},attrs:{shape:W},backend:n}),D_(n,V),[B,N]}},M_=(0,ia.Z)((function e(t,n,r,a,i,o){(0,aa.Z)(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var z_={kernelName:l.Transform,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=(0,p.Z)(a.shape,4),d=l[0],f=l[1],h=l[2],m=l[3],v=null!=c?c:[f,h],g=(0,p.Z)(v,2),y=g[0],b=g[1],x=new M_(f,h,o,s,u,[d,y,b,m]);return n.runWebGLProgram(x,[a,i],"float32")}};var L_={kernelName:l.Unique,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;Kx(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=Mw(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var P_={kernelName:l.Unpack,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,p=0;p<s;p++)p!==i&&(c[l++]=o.shape[p]);var d=[],f=new Array(s).fill(0),h=o.shape.slice();h[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){f[i]=v;var g=PI({inputs:{x:o},backend:n,attrs:{begin:f,size:h}}),y=DS({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,d.push(g)}return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},B_=(0,ia.Z)((function e(t,n){(0,aa.Z)(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(d,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var W_={kernelName:l.UnsortedSegmentSum,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,p=l.backend_util.getAxesPermutation([c],s),d=a;null!=p&&(d=US({inputs:{x:a},backend:n,attrs:{perm:p}}),u.push(d),c=l.backend_util.getInnerMostAxes(1,s)[0]);var f=l.backend_util.segment_util.computeOutShape(d.shape,c,o),h=l.util.sizeFromShape([d.shape[c]]),m=DS({inputs:{x:d},backend:n,attrs:{shape:[-1,h]}});u.push(m);var v=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],p=l.backend_util.segment_util.segOpComputeOptimalWindowSize(c,o),d=new B_({windowSize:p,inSize:c,batchSize:s,numSegments:o},r),f=n.compileAndRun(d,[t,a],i);if(u.push(f),f.shape[1]===o)return f;var h=dE({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),m=__({inputs:{x:h},backend:n,attrs:{reps:[c/p]}});return u.push(h),u.push(m),e(f,r,m,i,o)}(m,"unsortedSegmentSum",i,(0,l.sumOutType)(a.dtype),o),g=DS({inputs:{x:v},backend:n,attrs:{shape:f}}),y=g;if(null!=p){u.push(g);var b=l.backend_util.getUndoAxesPermutation(p);y=US({inputs:{x:y},backend:n,attrs:{perm:b}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}},V_=0,U_=[HS,KS,YS,JS,tI,aI,iI,oI,dI,fI,mI,gI,bI,kI,SI,TI,CI,AI,RI,FI,OI,WI,VI,UI,KI,QI,eN,vS,rN,pN,yN,SN,IN,NN,TN,EN,AN,FN,ZN,PN,BN,WN,UN,HN,XN,YN,JN,eT,tT,rT,aT,oT,uT,lT,dT,mT,yT,wT,IT,CT,_T,FT,DT,ZT,MT,PT,WT,UT,hS,GT,uN,HT,KT,YT,bS,JT,eC,tC,rC,iC,sC,cC,pC,hC,vC,yC,xC,kC,wC,NC,TC,CC,EC,_C,RC,ZC,MC,jC,FS,HC,KC,YC,JC,jI,eE,rE,aE,uE,lE,wS,pE,fE,qI,PC,mE,gE,bE,ZS,wE,IE,CE,_E,FE,ZE,ME,LE,BE,VE,GE,HE,KE,YE,JE,e_,BI,GC,n_,r_,a_,i_,o_,s_,u_,c_,d_,h_,g_,y_,x_,k_,w_,S_,VC,VS,N_,C_,A_,O_,z_,GS,L_,P_,W_,nE];V_<U_.length;V_++){var G_=U_[V_];(0,l.registerKernel)(G_)}var j_={"tfjs-core":l.version_core,"tfjs-backend-cpu":"3.19.0","tfjs-backend-webgl":"3.19.0","tfjs-data":Qf,"tfjs-layers":Hs,"tfjs-converter":Dd.gJ,tfjs:"3.19.0"}},2193:function(e,t,n){"use strict";n.r(t),n.d(t,{AgeGenderNet:function(){return KJ},BoundingBox:function(){return qY},Box:function(){return HY},ComposableTask:function(){return G$},ComputeAllFaceDescriptorsTask:function(){return _0},ComputeFaceDescriptorsTaskBase:function(){return E0},ComputeSingleFaceDescriptorTask:function(){return A0},DetectAllFaceLandmarksTask:function(){return F0},DetectAllFacesTask:function(){return O0},DetectFaceLandmarksTaskBase:function(){return R0},DetectFacesTaskBase:function(){return Z0},DetectSingleFaceLandmarksTask:function(){return D0},DetectSingleFaceTask:function(){return M0},Dimensions:function(){return AY},FACE_EXPRESSION_LABELS:function(){return AJ},FaceDetection:function(){return XY},FaceDetectionNet:function(){return C$},FaceExpressionNet:function(){return FJ},FaceExpressions:function(){return RJ},FaceLandmark68Net:function(){return YJ},FaceLandmark68TinyNet:function(){return JJ},FaceLandmarkNet:function(){return $J},FaceLandmarks:function(){return oQ},FaceLandmarks5:function(){return sQ},FaceLandmarks68:function(){return uQ},FaceMatch:function(){return cQ},FaceMatcher:function(){return j0},FaceRecognitionNet:function(){return u$},Gender:function(){return qJ},LabeledBox:function(){return lQ},LabeledFaceDescriptors:function(){return pQ},NetInput:function(){return VQ},NeuralNetwork:function(){return lJ},ObjectDetection:function(){return KY},Point:function(){return jY},PredictedBox:function(){return dQ},Rect:function(){return iQ},SsdMobilenetv1:function(){return I$},SsdMobilenetv1Options:function(){return S$},TinyFaceDetector:function(){return Q$},TinyFaceDetectorOptions:function(){return U$},TinyYolov2:function(){return W$},TinyYolov2Options:function(){return L$},allFaces:function(){return U0},allFacesSsdMobilenetv1:function(){return P0},allFacesTinyYolov2:function(){return W0},awaitMediaLoaded:function(){return DQ},bufferToImage:function(){return ZQ},computeFaceDescriptor:function(){return a0},createCanvas:function(){return MQ},createCanvasFromMedia:function(){return zQ},createFaceDetectionNet:function(){return T$},createFaceRecognitionNet:function(){return c$},createSsdMobilenetv1:function(){return N$},createTinyFaceDetector:function(){return H0},createTinyYolov2:function(){return V$},detectAllFaces:function(){return L0},detectFaceLandmarks:function(){return n0},detectFaceLandmarksTiny:function(){return r0},detectLandmarks:function(){return g0},detectSingleFace:function(){return z0},draw:function(){return CY},env:function(){return wQ},euclideanDistance:function(){return G0},extendWithAge:function(){return d$},extendWithFaceDescriptor:function(){return l$},extendWithFaceDetection:function(){return hQ},extendWithFaceExpressions:function(){return ZJ},extendWithFaceLandmarks:function(){return zJ},extendWithGender:function(){return h$},extractFaceTensors:function(){return qQ},extractFaces:function(){return jQ},fetchImage:function(){return QQ},fetchJson:function(){return $Q},fetchNetWeights:function(){return tJ},fetchOrThrow:function(){return XQ},fetchVideo:function(){return aJ},getContext2dOrThrow:function(){return IQ},getMediaDimensions:function(){return OQ},imageTensorToCanvas:function(){return LQ},imageToSquare:function(){return WQ},inverseSigmoid:function(){return rQ},iou:function(){return YY},isMediaElement:function(){return BQ},isMediaLoaded:function(){return FQ},isWithAge:function(){return p$},isWithFaceDetection:function(){return fQ},isWithFaceExpressions:function(){return DJ},isWithFaceLandmarks:function(){return MJ},isWithGender:function(){return f$},loadAgeGenderModel:function(){return h0},loadFaceDetectionModel:function(){return m0},loadFaceExpressionModel:function(){return f0},loadFaceLandmarkModel:function(){return l0},loadFaceLandmarkTinyModel:function(){return p0},loadFaceRecognitionModel:function(){return d0},loadSsdMobilenetv1Model:function(){return s0},loadTinyFaceDetectorModel:function(){return u0},loadTinyYolov2Model:function(){return c0},loadWeightMap:function(){return sJ},locateFaces:function(){return v0},matchDimensions:function(){return cJ},minBbox:function(){return QY},nets:function(){return J$},nonMaxSuppression:function(){return JY},normalize:function(){return $Y},padToSquare:function(){return eQ},predictAgeAndGender:function(){return o0},recognizeFaceExpressions:function(){return i0},resizeResults:function(){return q0},resolveInput:function(){return SQ},shuffleArray:function(){return tQ},sigmoid:function(){return nQ},ssdMobilenetv1:function(){return $$},tf:function(){return N},tinyFaceDetector:function(){return e0},tinyYolov2:function(){return t0},toNetInput:function(){return UQ},utils:function(){return _Y},validateConfig:function(){return F$},version:function(){return K0}});var r=n(4942);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var o=n(1752),s=n(1120),u=n(7326),c=n(8737),l=n(2963),p=n(4506),d=n(136),f=n(9388),h=n(3433),m=n(9439),v=n(4165),g=n(5861),y=n(5671),b=n(3144),x=n(7762),k="/index.js",w=Object.defineProperty,S=n(6741),I=function(e,t){for(var n in t)w(e,n,{get:t[n],enumerable:!0})},N={};I(N,{Abs:function(){return ut},Acos:function(){return ct},Acosh:function(){return lt},AdadeltaOptimizer:function(){return Yh},AdagradOptimizer:function(){return Qh},AdamOptimizer:function(){return Jh},AdamaxOptimizer:function(){return $h},Add:function(){return pt},AddN:function(){return dt},All:function(){return ft},Any:function(){return ht},ArgMax:function(){return mt},ArgMin:function(){return vt},Asin:function(){return gt},Asinh:function(){return yt},Atan:function(){return bt},Atan2:function(){return kt},Atanh:function(){return xt},AvgPool:function(){return wt},AvgPool3D:function(){return It},AvgPool3DGrad:function(){return Nt},AvgPoolGrad:function(){return St},BackendWasm:function(){return uY},BatchMatMul:function(){return Tt},BatchToSpaceND:function(){return Ct},Bincount:function(){return Et},BroadcastArgs:function(){return At},BroadcastTo:function(){return _t},Callback:function(){return NT},CallbackList:function(){return ak},Cast:function(){return Rt},Ceil:function(){return Ft},ClipByValue:function(){return Dt},Complex:function(){return Zt},ComplexAbs:function(){return Ot},Concat:function(){return Mt},Conv2D:function(){return zt},Conv2DBackpropFilter:function(){return Lt},Conv2DBackpropInput:function(){return Pt},Conv3D:function(){return Bt},Conv3DBackpropFilterV2:function(){return Wt},Conv3DBackpropInputV2:function(){return Vt},Cos:function(){return Ut},Cosh:function(){return Gt},CropAndResize:function(){return qt},Cumprod:function(){return jt},Cumsum:function(){return Ht},CustomCallback:function(){return sk},DataStorage:function(){return ne},DenseBincount:function(){return Kt},DepthToSpace:function(){return Xt},DepthwiseConv2dNative:function(){return Yt},DepthwiseConv2dNativeBackpropFilter:function(){return Qt},DepthwiseConv2dNativeBackpropInput:function(){return Jt},Diag:function(){return $t},Dilation2D:function(){return en},Dilation2DBackpropFilter:function(){return nn},Dilation2DBackpropInput:function(){return tn},ENV:function(){return it},EarlyStopping:function(){return ET},Einsum:function(){return an},Elu:function(){return on},EluGrad:function(){return sn},Environment:function(){return et},Equal:function(){return cn},Erf:function(){return un},Exp:function(){return ln},ExpandDims:function(){return pn},Expm1:function(){return dn},FFT:function(){return fn},Fill:function(){return hn},FlipLeftRight:function(){return mn},Floor:function(){return vn},FloorDiv:function(){return gn},FromPixels:function(){return ha},FusedBatchNorm:function(){return yn},FusedConv2D:function(){return ga},FusedDepthwiseConv2D:function(){return ya},GPGPUContext:function(){return LL},GatherNd:function(){return xn},GatherV2:function(){return bn},GraphModel:function(){return DE},Greater:function(){return kn},GreaterEqual:function(){return wn},History:function(){return ok},IFFT:function(){return In},Identity:function(){return Sn},Imag:function(){return Nn},InputSpec:function(){return ix},IsFinite:function(){return Tn},IsInf:function(){return Cn},IsNan:function(){return En},KernelBackend:function(){return re},LRN:function(){return Wn},LRNGrad:function(){return Vn},LayerVariable:function(){return nx},LayersModel:function(){return Sw},LeakyRelu:function(){return _n},Less:function(){return An},LessEqual:function(){return Rn},LinSpace:function(){return Fn},Log:function(){return Dn},Log1p:function(){return Zn},LogSoftmax:function(){return Pn},LogicalAnd:function(){return On},LogicalNot:function(){return Mn},LogicalOr:function(){return zn},LogicalXor:function(){return Ln},LowerBound:function(){return Bn},MathBackendWebGL:function(){return tB},Max:function(){return Un},MaxPool:function(){return jn},MaxPool3D:function(){return qn},MaxPool3DGrad:function(){return Kn},MaxPoolGrad:function(){return Hn},MaxPoolWithArgmax:function(){return Xn},Maximum:function(){return Gn},Mean:function(){return Yn},Min:function(){return Qn},Minimum:function(){return Jn},MirrorPad:function(){return $n},Mod:function(){return er},MomentumOptimizer:function(){return tm},Multinomial:function(){return tr},Multiply:function(){return nr},Neg:function(){return rr},NonMaxSuppressionV3:function(){return ir},NonMaxSuppressionV4:function(){return or},NonMaxSuppressionV5:function(){return sr},NotEqual:function(){return ar},OP_SCOPE_SUFFIX:function(){return Xi},OneHot:function(){return cr},OnesLike:function(){return ur},Optimizer:function(){return Xh},OptimizerConstructors:function(){return rm},Pack:function(){return lr},PadV2:function(){return pr},Pool:function(){return dr},Pow:function(){return fr},Prelu:function(){return hr},Prod:function(){return mr},RMSPropOptimizer:function(){return nm},RNN:function(){return ZS},Range:function(){return vr},Rank:function(){return gi},Real:function(){return gr},RealDiv:function(){return rn},Reciprocal:function(){return yr},Reduction:function(){return wh},Relu:function(){return br},Relu6:function(){return Nr},Reshape:function(){return xr},ResizeBilinear:function(){return Sr},ResizeBilinearGrad:function(){return Ir},ResizeNearestNeighbor:function(){return kr},ResizeNearestNeighborGrad:function(){return wr},Reverse:function(){return Tr},RotateWithOffset:function(){return ma},Round:function(){return Cr},Rsqrt:function(){return Er},SGDOptimizer:function(){return em},ScatterNd:function(){return _r},SearchSorted:function(){return Ar},Select:function(){return Rr},Selu:function(){return Fr},Sequential:function(){return Rw},Sigmoid:function(){return zr},Sign:function(){return Mr},Sin:function(){return Zr},Sinh:function(){return Or},Slice:function(){return Dr},Softmax:function(){return Ur},Softplus:function(){return Lr},SpaceToBatchND:function(){return Wr},SparseFillEmptyRows:function(){return Gr},SparseReshape:function(){return jr},SparseSegmentMean:function(){return Hr},SparseSegmentSum:function(){return qr},SparseToDense:function(){return Kr},SplitV:function(){return Vr},Sqrt:function(){return Pr},Square:function(){return Yr},SquaredDifference:function(){return Xr},Step:function(){return fa},StridedSlice:function(){return Qr},StringNGrams:function(){return Jr},StringSplit:function(){return $r},StringToHashBucketFast:function(){return ea},Sub:function(){return ta},Sum:function(){return Br},SymbolicTensor:function(){return ox},Tan:function(){return na},Tanh:function(){return ra},Tensor:function(){return hi},TensorBuffer:function(){return pi},Tile:function(){return aa},TopK:function(){return ia},Transform:function(){return oa},Transpose:function(){return sa},Unique:function(){return ua},Unpack:function(){return ca},UnsortedSegmentSum:function(){return la},UpperBound:function(){return pa},Variable:function(){return vi},ZerosLike:function(){return da},_FusedMatMul:function(){return va},abs:function(){return vc},acos:function(){return gc},acosh:function(){return yc},add:function(){return dc},addN:function(){return bc},all:function(){return xc},any:function(){return kc},argMax:function(){return wc},argMin:function(){return Sc},asin:function(){return Ic},asinh:function(){return Nc},atan:function(){return Tc},atan2:function(){return Cc},atanh:function(){return Ec},avgPool:function(){return Hc},avgPool3d:function(){return qc},backend:function(){return au},backend_util:function(){return sm},basicLSTMCell:function(){return Jc},batchNorm:function(){return tl},batchNorm2d:function(){return nl},batchNorm3d:function(){return rl},batchNorm4d:function(){return al},batchToSpaceND:function(){return $c},bincount:function(){return il},booleanMaskAsync:function(){return bf},broadcastArgs:function(){return ol},broadcastTo:function(){return sl},broadcast_util:function(){return pu},browser:function(){return vu},buffer:function(){return us},callbacks:function(){return RT},cast:function(){return cs},ceil:function(){return ul},clipByValue:function(){return cl},clone:function(){return ls},complex:function(){return Qi},concat:function(){return Kc},concat1d:function(){return ll},concat2d:function(){return pl},concat3d:function(){return dl},concat4d:function(){return fl},constraints:function(){return kx},conv1d:function(){return ml},conv2d:function(){return hl},conv2dTranspose:function(){return gl},conv3d:function(){return yl},conv3dTranspose:function(){return xl},copyRegisteredKernels:function(){return Aa},cos:function(){return kl},cosh:function(){return wl},cosineWindow:function(){return Cf},cumprod:function(){return Sl},cumsum:function(){return Il},customGrad:function(){return Cp},data:function(){return PE},denseBincount:function(){return Nl},deprecationWarn:function(){return Vs},depthToSpace:function(){return Tl},depthwiseConv2d:function(){return Cl},deregisterOp:function(){return OT},device_util:function(){return Pi},diag:function(){return El},dilation2d:function(){return _l},disableDeprecationWarnings:function(){return Ws},dispose:function(){return Ks},disposeVariables:function(){return Us},div:function(){return hc},divNoNan:function(){return Dl},dot:function(){return Zl},dropout:function(){return Nf},einsum:function(){return Ol},elu:function(){return Ml},enableDebugMode:function(){return Bs},enableProdMode:function(){return Ps},enclosingPowerOfTwo:function(){return Tf},engine:function(){return Gs},env:function(){return rt},equal:function(){return Al},erf:function(){return zl},euclideanNorm:function(){return tp},exp:function(){return np},expandDims:function(){return rp},expm1:function(){return ap},eye:function(){return op},fft:function(){return jd},fill:function(){return sp},findBackend:function(){return tu},findBackendFactory:function(){return nu},floor:function(){return up},floorDiv:function(){return fc},forceHalfFloat:function(){return rB},fused:function(){return Af},gather:function(){return cp},gatherND:function(){return If},gather_util:function(){return Nu},getBackend:function(){return $s},getGradient:function(){return Ia},getKernel:function(){return Sa},getKernelsForBackend:function(){return Na},getThreadsCount:function(){return IY},gpgpu_util:function(){return mL},grad:function(){return wp},grads:function(){return Sp},greater:function(){return lp},greaterEqual:function(){return pp},ifft:function(){return Hd},imag:function(){return ou},image:function(){return Gh},inTopKAsync:function(){return _f},initializers:function(){return Mx},input:function(){return Ow},io:function(){return ds},irfft:function(){return qd},isFinite:function(){return dp},isInf:function(){return fp},isNaN:function(){return hp},keep:function(){return Xs},kernel_impls:function(){return sv},layers:function(){return $x},leakyRelu:function(){return mp},less:function(){return vp},lessEqual:function(){return gp},linalg:function(){return jh},linspace:function(){return yp},loadGraphModel:function(){return ZE},loadGraphModelSync:function(){return ME},loadLayersModel:function(){return Zw},localResponseNormalization:function(){return bp},log:function(){return xp},log1p:function(){return kp},logSigmoid:function(){return Ap},logSoftmax:function(){return Fp},logSumExp:function(){return Dp},logicalAnd:function(){return Zp},logicalNot:function(){return Op},logicalOr:function(){return Mp},logicalXor:function(){return zp},losses:function(){return Hh},lowerBound:function(){return Bp},matMul:function(){return zs},math:function(){return Ms},max:function(){return Hl},maxPool:function(){return Wp},maxPool3d:function(){return Vp},maxPoolWithArgmax:function(){return Up},maximum:function(){return Gp},mean:function(){return jp},memory:function(){return js},meshgrid:function(){return Kp},metrics:function(){return aT},min:function(){return ql},minimum:function(){return Xp},mirrorPad:function(){return Yp},mod:function(){return Qp},model:function(){return Fw},models:function(){return xT},moments:function(){return Jp},movingAverage:function(){return xf},mul:function(){return mc},multiRNNCell:function(){return $p},multinomial:function(){return ed},neg:function(){return su},nextFrame:function(){return om},norm:function(){return ep},notEqual:function(){return td},oneHot:function(){return Ls},ones:function(){return qp},onesLike:function(){return nd},op:function(){return Yi},outerProduct:function(){return rd},pad:function(){return ad},pad1d:function(){return id},pad2d:function(){return od},pad3d:function(){return sd},pad4d:function(){return ud},pool:function(){return ld},pow:function(){return Kl},prelu:function(){return pd},print:function(){return ps},prod:function(){return dd},profile:function(){return Hs},rand:function(){return fd},randomGamma:function(){return yd},randomNormal:function(){return bd},randomStandardNormal:function(){return xd},randomUniform:function(){return kd},range:function(){return wd},ready:function(){return Js},real:function(){return uu},reciprocal:function(){return Sd},registerBackend:function(){return ru},registerCallbackConstructor:function(){return Mw},registerGradient:function(){return Ca},registerKernel:function(){return Ta},registerOp:function(){return DT},regularizers:function(){return kT},relu:function(){return Id},relu6:function(){return Nd},removeBackend:function(){return eu},reshape:function(){return jc},reverse:function(){return Td},reverse1d:function(){return Cd},reverse2d:function(){return Ed},reverse3d:function(){return _d},reverse4d:function(){return Ad},rfft:function(){return Xd},round:function(){return Rd},rsqrt:function(){return Fd},scalar:function(){return Xl},scatterND:function(){return kf},scatter_util:function(){return Cu},searchSorted:function(){return Pp},selu:function(){return Dd},separableConv2d:function(){return Zd},sequential:function(){return Dw},serialization:function(){return Xu},setBackend:function(){return Qs},setPlatform:function(){return iu},setThreadsCount:function(){return SY},setWasmPath:function(){return bY},setWasmPaths:function(){return xY},setWebGLContext:function(){return NM},setdiff1dAsync:function(){return Md},sigmoid:function(){return Xc},sign:function(){return zd},signal:function(){return Uh},sin:function(){return Ld},sinh:function(){return Pd},slice:function(){return Yc},slice1d:function(){return Bd},slice2d:function(){return Wd},slice3d:function(){return Vd},slice4d:function(){return Ud},slice_util:function(){return Ru},softmax:function(){return Gd},softplus:function(){return _p},spaceToBatchND:function(){return cd},sparse:function(){return qh},sparseToDense:function(){return Sf},spectral:function(){return Vh},split:function(){return Kd},sqrt:function(){return Yl},square:function(){return Ql},squaredDifference:function(){return Yd},squeeze:function(){return Qd},stack:function(){return Jd},step:function(){return $d},stridedSlice:function(){return ef},string:function(){return Kh},sub:function(){return Rp},sum:function(){return Jl},sumOutType:function(){return Ni},tan:function(){return tf},tanh:function(){return Qc},tensor:function(){return $i},tensor1d:function(){return nf},tensor2d:function(){return rf},tensor3d:function(){return gu},tensor4d:function(){return af},tensor5d:function(){return of},tensor6d:function(){return sf},tensor_util:function(){return wi},test_util:function(){return $u},tidy:function(){return qs},tile:function(){return ip},time:function(){return Ys},topk:function(){return uf},train:function(){return am},transpose:function(){return cu},truncatedNormal:function(){return cf},unique:function(){return lf},unregisterGradient:function(){return _a},unregisterKernel:function(){return Ea},unsortedSegmentSum:function(){return pf},unstack:function(){return df},upcastType:function(){return Ii},upperBound:function(){return ff},util:function(){return Fa},valueAndGrad:function(){return Ip},valueAndGrads:function(){return Np},variable:function(){return hf},variableGrads:function(){return Tp},version:function(){return TY},version_converter:function(){return LE},version_core:function(){return pc},version_layers:function(){return jk},version_wasm:function(){return NY},version_webgl:function(){return nB},webgl:function(){return aB},webgl_util:function(){return bM},where:function(){return Rl},whereAsync:function(){return gf},zeros:function(){return Hp},zerosLike:function(){return Fl}});var T=Object.create,C=Object.defineProperty,E=Object.getOwnPropertyDescriptor,_=Object.getOwnPropertyNames,A=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty,F=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},D=function(e,t){for(var n in t)C(e,n,{get:t[n],enumerable:!0})},Z=function(e,t,n){return n=null!=e?T(A(e)):{},function(e,t,n,r){if(t&&"object"==typeof t||"function"==typeof t){var a,i=(0,x.Z)(_(t));try{var o=function(){var i=a.value;!R.call(e,i)&&i!==n&&C(e,i,{get:function(){return t[i]},enumerable:!(r=E(t,i))||r.enumerable})};for(i.s();!(a=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}return e}(!t&&e&&e.__esModule?n:C(n,"default",{value:e,enumerable:!0}),e)},O=F((function(e,t){t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(T){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function a(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=a;var i={},o={};function s(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=o[e])?r:(n=c(e,(0|e)<0?-1:0,!0),a&&(o[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=c(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function u(e,t){if(isNaN(e))return t?y:g;if(t){if(e<0)return y;if(e>=h)return S}else{if(e<=-m)return I;if(e+1>=m)return w}return e<0?u(-e,t).neg():c(e%f|0,e/f|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=s,r.fromNumber=u,r.fromBits=c;var l=Math.pow;function p(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return p(e.substring(1),t,n).neg();for(var a=u(l(n,8)),i=g,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+s),n);if(s<8){var d=u(l(n,s));i=i.mul(d).add(u(c))}else i=(i=i.mul(a)).add(u(c))}return i.unsigned=t,i}function d(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?p(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=p,r.fromValue=d;var f=4294967296,h=f*f,m=h/2,v=s(1<<24),g=s(0);r.ZERO=g;var y=s(0,!0);r.UZERO=y;var b=s(1);r.ONE=b;var x=s(1,!0);r.UONE=x;var k=s(-1);r.NEG_ONE=k;var w=c(-1,2147483647,!1);r.MAX_VALUE=w;var S=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=S;var I=c(0,-2147483648,!1);r.MIN_VALUE=I;var N=r.prototype;N.toInt=function(){return this.unsigned?this.low>>>0:this.low},N.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},N.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(I)){var t=u(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=u(l(e,6),this.unsigned),i=this,o="";;){var s=i.div(a),c=(i.sub(s.mul(a)).toInt()>>>0).toString(e);if((i=s).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},N.getHighBits=function(){return this.high},N.getHighBitsUnsigned=function(){return this.high>>>0},N.getLowBits=function(){return this.low},N.getLowBitsUnsigned=function(){return this.low>>>0},N.getNumBitsAbs=function(){if(this.isNegative())return this.eq(I)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},N.isZero=function(){return 0===this.high&&0===this.low},N.eqz=N.isZero,N.isNegative=function(){return!this.unsigned&&this.high<0},N.isPositive=function(){return this.unsigned||this.high>=0},N.isOdd=function(){return 1===(1&this.low)},N.isEven=function(){return 0===(1&this.low)},N.equals=function(e){return a(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},N.eq=N.equals,N.notEquals=function(e){return!this.eq(e)},N.neq=N.notEquals,N.ne=N.notEquals,N.lessThan=function(e){return this.comp(e)<0},N.lt=N.lessThan,N.lessThanOrEqual=function(e){return this.comp(e)<=0},N.lte=N.lessThanOrEqual,N.le=N.lessThanOrEqual,N.greaterThan=function(e){return this.comp(e)>0},N.gt=N.greaterThan,N.greaterThanOrEqual=function(e){return this.comp(e)>=0},N.gte=N.greaterThanOrEqual,N.ge=N.greaterThanOrEqual,N.compare=function(e){if(a(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},N.comp=N.compare,N.negate=function(){return!this.unsigned&&this.eq(I)?I:this.not().add(b)},N.neg=N.negate,N.add=function(e){a(e)||(e=d(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,u=e.low>>>16,l=0,p=0,f=0,h=0;return f+=(h+=i+(65535&e.low))>>>16,p+=(f+=r+u)>>>16,l+=(p+=n+s)>>>16,l+=t+o,c((f&=65535)<<16|(h&=65535),(l&=65535)<<16|(p&=65535),this.unsigned)},N.subtract=function(e){return a(e)||(e=d(e)),this.add(e.neg())},N.sub=N.subtract,N.multiply=function(e){if(this.isZero())return g;if(a(e)||(e=d(e)),n)return c(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(I))return e.isOdd()?I:g;if(e.eq(I))return this.isOdd()?I:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return u(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,l=65535&e.high,p=e.low>>>16,f=65535&e.low,h=0,m=0,y=0,b=0;return y+=(b+=o*f)>>>16,m+=(y+=i*f)>>>16,y&=65535,m+=(y+=o*p)>>>16,h+=(m+=r*f)>>>16,m&=65535,h+=(m+=i*p)>>>16,m&=65535,h+=(m+=o*l)>>>16,h+=t*f+r*p+i*l+o*s,c((y&=65535)<<16|(b&=65535),(h&=65535)<<16|(m&=65535),this.unsigned)},N.mul=N.multiply,N.divide=function(e){if(a(e)||(e=d(e)),e.isZero())throw Error("division by zero");var t,r,i;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return x;i=y}else{if(this.eq(I))return e.eq(b)||e.eq(k)?I:e.eq(I)?b:(t=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?b:k:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(I))return this.unsigned?y:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=g}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),s=o<=48?1:l(2,o-48),p=u(t),f=p.mul(e);f.isNegative()||f.gt(r);)f=(p=u(t-=s,this.unsigned)).mul(e);p.isZero()&&(p=b),i=i.add(p),r=r.sub(f)}return i},N.div=N.divide,N.modulo=function(e){return a(e)||(e=d(e)),n?c((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},N.mod=N.modulo,N.rem=N.modulo,N.not=function(){return c(~this.low,~this.high,this.unsigned)},N.and=function(e){return a(e)||(e=d(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},N.or=function(e){return a(e)||(e=d(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},N.xor=function(e){return a(e)||(e=d(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},N.shiftLeft=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},N.shl=N.shiftLeft,N.shiftRight=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},N.shr=N.shiftRight,N.shiftRightUnsigned=function(e){if(a(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},N.shru=N.shiftRightUnsigned,N.shr_u=N.shiftRightUnsigned,N.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},N.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},N.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},N.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},N.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}})),M=F((function(){})),z=F((function(){})),L=F((function(e,t){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.alea=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),P=F((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor128=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),B=F((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorwow=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),W=F((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.x&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorshift7=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),V=F((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.X&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor4096=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),U=F((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.tychei=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),G=F((function(){})),j=F((function(e,t){!function(e,r,a){var i,o=256,s="random",u=a.pow(o,6),c=a.pow(2,52),l=2*c,p=255;function d(t,n,p){var d=[],y=v(m((n=1==n?{entropy:!0}:n||{}).entropy?[t,g(r)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(o):(t=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(t)),g(t)}catch(d){var n=e.navigator,a=n&&n.plugins;return[+new Date,e,a,e.screen,g(r)]}}():t,3),d),b=new f(d),x=function(){for(var e=b.g(6),t=u,n=0;e<c;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|b.g(4)},x.quick=function(){return b.g(4)/4294967296},x.double=x,v(g(b.S),r),(n.pass||p||function(e,t,n,r){return r&&(r.S&&h(r,b),e.state=function(){return h(b,{})}),n?(a[s]=e,t):e})(x,y,"global"in n?n.global:this==a,n.state)}function f(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<o;)s[a]=a++;for(a=0;a<o;a++)s[a]=s[i=p&i+e[a%n]+(t=s[a])],s[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,s=r.S;e--;)t=s[a=p&a+1],n=n*o+s[p&(s[a]=s[i=p&i+t])+(s[i]=t)];return r.i=a,r.j=i,n})(o)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(m(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function v(e,t){for(var n,r=e+"",a=0;a<r.length;)t[p&a]=p&(n^=19*t[p&a])+r.charCodeAt(a++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(v(a.random(),r),"object"==typeof t&&t.exports){t.exports=d;try{i=G()}catch(y){}}else"function"==typeof define&&n.amdO?define((function(){return d})):a["seed"+s]=d}("undefined"!=typeof self?self:e,[],Math)})),H=F((function(e,t){var n=L(),r=P(),a=B(),i=W(),o=V(),s=U(),u=j();u.alea=n,u.xor128=r,u.xorwow=a,u.xorshift7=i,u.xor4096=o,u.tychei=s,t.exports=u})),q=F((function(){})),K=F((function(){})),X=F((function(){})),Y=F((function(){})),Q=F((function(){})),J=F((function(){})),$=F((function(e,t){var r=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||k,function(t){function r(){return Z.buffer!=j&&ne(Z.buffer),H}function a(){return Z.buffer!=j&&ne(Z.buffer),q}function i(){return Z.buffer!=j&&ne(Z.buffer),$}function o(){return Z.buffer!=j&&ne(Z.buffer),ee}var s,u,c,l="undefined"!=typeof(t=t||{})?t:{};l.ready=new Promise((function(e,t){s=e,u=t})),"undefined"!=typeof process&&process.listeners&&(c={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var p,d,f,h,m,v,g=Object.assign({},l),y=[],b=function(e,t){throw t},x="object"==typeof window,k="function"==typeof importScripts,w="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,S=l.ENVIRONMENT_IS_PTHREAD||!1,I="";function N(e){return l.locateFile?l.locateFile(e,I):I+e}if(w){var T;I=k?X().dirname(I)+"/":"//",v=function(){m||(h=K(),m=X())},p=function(e,t){return v(),e=m.normalize(e),h.readFileSync(e,t?void 0:"utf8")},f=function(e){var t=p(e,!0);return t.buffer||(t=new Uint8Array(t)),t},d=function(e,t,n){v(),e=m.normalize(e),h.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),y=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof gt))throw e})),process.on("unhandledRejection",(function(e){throw e})),b=function(e,t){if(ce())throw process.exitCode=e,t;(function(e){e instanceof gt||A("exiting due to exception: "+e)})(t),process.exit(e)},l.inspect=function(){return"[Emscripten Module object]"};try{T=Y()}catch(xt){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),xt}n.g.Worker=T.Worker}else(x||k)&&(k?I=self.location.href:"undefined"!=typeof document&&document.currentScript&&(I=document.currentScript.src),"undefined"!=typeof e&&e&&(I=e),I=0!==I.indexOf("blob:")?I.substr(0,I.replace(/[?#].*/,"").lastIndexOf("/")+1):"",w||(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},k&&(f=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),d=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}),function(e){return document.title=e});w&&"undefined"==typeof performance&&(n.g.performance=Q().performance);var C=console.log.bind(console),E=console.warn.bind(console);w&&(v(),C=function(e){return h.writeSync(1,e+"\n")},E=function(e){return h.writeSync(2,e+"\n")});var _=l.print||C,A=l.printErr||E;Object.assign(l,g),g=null,l.arguments&&(y=l.arguments),l.thisProgram&&l.thisProgram,l.quit&&(b=l.quit);function R(e){R.shown||(R.shown={}),R.shown[e]||(R.shown[e]=1,A(e))}var F;Atomics.load,Atomics.store,Atomics.compareExchange;l.wasmBinary&&(F=l.wasmBinary);var D=l.noExitRuntime||!0;"object"!=typeof WebAssembly&&ve("no native wasm support detected");var Z,O,M,z=!1;function L(e){return l["_"+e]}function P(e,t,n,a,i){var o={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);G(e,t=mt(n),n)}return t},array:function(e){var t=mt(e.length);return function(e,t){r().set(e,t)}(e,t),t}};var s=L(e),u=[],c=0;if(a)for(var l=0;l<a.length;l++){var p=o[n[l]];p?(0===c&&(c=ft()),u[l]=p(a[l])):u[l]=a[l]}var d,f=s.apply(null,u);return d=f,0!==c&&ht(c),f=function(e){return"string"===t?U(e):"boolean"===t?Boolean(e):e}(d),f}function B(e){var t=new TextDecoder(e);this.decode=function(e){return e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),t.decode.call(t,e)}}var W="undefined"!=typeof TextDecoder?new B("utf8"):void 0;function V(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.subarray&&W)return W.decode(e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function U(e,t){return e?V(a(),e,t):""}function G(e,t,n){return function(e,t,n,r){if(!(r>0))return 0;for(var a=n,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=i)break;t[n++]=s}else if(s<=2047){if(n+1>=i)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=i)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-a}(e,a(),t,n)}var j,H,q,$,ee;"undefined"!=typeof TextDecoder&&new B("utf-16le");function te(e,t){return e%t>0&&(e+=t-e%t),e}function ne(e){j=e,l.HEAP8=H=new Int8Array(e),l.HEAP16=new Int16Array(e),l.HEAP32=$=new Int32Array(e),l.HEAPU8=q=new Uint8Array(e),l.HEAPU16=new Uint16Array(e),l.HEAPU32=new Uint32Array(e),l.HEAPF32=new Float32Array(e),l.HEAPF64=ee=new Float64Array(e)}S&&(j=l.buffer);var re=l.INITIAL_MEMORY||16777216;if(S)Z=l.wasmMemory,j=l.buffer;else if(l.wasmMemory)Z=l.wasmMemory;else if(!((Z=new WebAssembly.Memory({initial:re/65536,maximum:32768,shared:!0})).buffer instanceof SharedArrayBuffer))throw A("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),w&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");Z&&(j=Z.buffer),re=j.byteLength,ne(j);var ae,ie=[],oe=[],se=[],ue=[];function ce(){return D||!1}function le(){!0,!S&&we(oe)}function pe(e){ie.unshift(e)}function de(e){ue.unshift(e)}var fe=0,he=null,me=null;function ve(e){S?postMessage({cmd:"onAbort",arg:e}):l.onAbort&&l.onAbort(e),A(e="Aborted("+e+")"),z=!0,M=1,e+=". Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw u(t),t}l.preloadedImages={},l.preloadedAudios={};var ge;function ye(e){return e.startsWith("data:application/octet-stream;base64,")}function be(e){return e.startsWith("file://")}function xe(e){try{if(e==ge&&F)return new Uint8Array(F);if(f)return f(e);throw"both async and sync fetching of the wasm failed"}catch(xt){ve(xt)}}ye(ge="tfjs-backend-wasm-threaded-simd.wasm")||(ge=N(ge));var ke={};function we(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?Ae(n)():Ae(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(l)}}function Se(e){var t=ft(),n=e();return ht(t),n}function Ie(e){var t=Te.pthreads[e];if(t){i()[e>>2]=0;var n=t.worker;Te.returnWorkerToPool(n)}}function Ne(e){!function(e,t){if(M=e,!t&&S)throw Ce(e),"unwind";ce()||S||(Te.terminateAllThreads(),!0),function(e){M=e,ce()||(Te.terminateAllThreads(),l.onExit&&l.onExit(e),z=!0),b(e,new gt(e))}(e)}(e)}var Te={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],init:function(){S?Te.initWorker():Te.initMainThread()},initMainThread:function(){for(var e=0;e<8;++e)Te.allocateUnusedWorker()},initWorker:function(){D=!1},pthreads:{},setExitStatus:function(e){M=e},terminateAllThreads:function(){for(var e in Te.pthreads){var t=Te.pthreads[e];t&&t.worker&&Te.returnWorkerToPool(t.worker)}for(var n=0;n<Te.unusedWorkers.length;++n){Te.unusedWorkers[n].terminate()}Te.unusedWorkers=[]},returnWorkerToPool:function(e){Te.runWithoutMainThreadQueuedCalls((function(){delete Te.pthreads[e.pthread.threadInfoStruct],Te.unusedWorkers.push(e),Te.runningWorkers.splice(Te.runningWorkers.indexOf(e),1),pt(e.pthread.threadInfoStruct),e.pthread=void 0}))},runWithoutMainThreadQueuedCalls:function(e){i()[vt>>2]=0;try{e()}finally{i()[vt>>2]=1}},receiveObjectTransfer:function(e){},threadInit:function(){for(var e in Te.tlsInitFunctions)Te.tlsInitFunctions[e]()},loadWasmModuleToWorker:function(t,n){t.onmessage=function(e){var r=e.data,a=r.cmd;if(t.pthread&&(Te.currentProxiedOperationCallerThread=t.pthread.threadInfoStruct),r.targetThread&&r.targetThread!=it()){var o=Te.pthreads[r.targetThread];return o?o.worker.postMessage(r,r.transferList):A('Internal error! Worker sent a message "'+a+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(Te.currentProxiedOperationCallerThread=void 0)}"processQueuedMainThreadWork"===a?ot():"spawnThread"===a?Fe(r):"cleanupThread"===a?Ie(r.thread):"killThread"===a?function(e){i()[e>>2]=0;var t=Te.pthreads[e];delete Te.pthreads[e],t.worker.terminate(),pt(e),Te.runningWorkers.splice(Te.runningWorkers.indexOf(t.worker),1),t.worker.pthread=void 0}(r.thread):"cancelThread"===a?function(e){Te.pthreads[e].worker.postMessage({cmd:"cancel"})}(r.thread):"loaded"===a?(t.loaded=!0,n&&n(t),t.runPthread&&(t.runPthread(),delete t.runPthread)):"print"===a?_("Thread "+r.threadId+": "+r.text):"printErr"===a?A("Thread "+r.threadId+": "+r.text):"alert"===a?alert("Thread "+r.threadId+": "+r.text):"setimmediate"===r.target?t.postMessage(r):"onAbort"===a?l.onAbort&&l.onAbort(r.arg):A("worker sent an unknown command "+a),Te.currentProxiedOperationCallerThread=void 0},t.onerror=function(e){throw A("worker sent an error! "+e.filename+":"+e.lineno+": "+e.message),e},w&&(t.on("message",(function(e){t.onmessage({data:e})})),t.on("error",(function(e){t.onerror(e)})),t.on("detachedExit",(function(){}))),t.postMessage({cmd:"load",urlOrBlob:l.mainScriptUrlOrBlob||e,wasmMemory:Z,wasmModule:O})},allocateUnusedWorker:function(){var e=N("tfjs-backend-wasm-threaded-simd.worker.js");Te.unusedWorkers.push(new Worker(e))},getNewWorker:function(){return 0==Te.unusedWorkers.length&&(Te.allocateUnusedWorker(),Te.loadWasmModuleToWorker(Te.unusedWorkers[0])),Te.unusedWorkers.pop()}};function Ce(e){if(S)return Ze(1,0,e);try{Ne(e)}catch(xt){!function(e){if(e instanceof gt||"unwind"==e)return M;b(1,e)}(xt)}}l.establishStackSpace=function(){var e=it(),t=i()[e+44>>2],n=i()[e+48>>2];dt(t,t-n),ht(t)};var Ee,_e=[];function Ae(e){var t=_e[e];return t||(e>=_e.length&&(_e.length=e+1),_e[e]=t=ae.get(e)),t}l.invokeEntryPoint=function(e,t){return Ae(e)(t)},Ee=w?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:S?function(){return performance.now()-l.__performance_now_clock_drift}:function(){return performance.now()};function Re(e,t){var n;if(0===e)n=Date.now();else{if(1!==e&&4!==e)return function(e){i()[at()>>2]=e}(28),-1;n=Ee()}return i()[t>>2]=n/1e3|0,i()[t+4>>2]=n%1e3*1e3*1e3|0,0}function Fe(e){var t=Te.getNewWorker();if(!t)return 6;Te.runningWorkers.push(t);var n=Te.pthreads[e.pthread_ptr]={worker:t,threadInfoStruct:e.pthread_ptr};t.pthread=n;var r={cmd:"run",start_routine:e.startRoutine,arg:e.arg,threadInfoStruct:e.pthread_ptr};return t.runPthread=function(){r.time=performance.now(),t.postMessage(r,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread),0}function De(){return 2147483648}function Ze(e,t){var n=arguments.length-2,r=arguments;return Se((function(){for(var a=n,i=mt(8*a),s=i>>3,u=0;u<n;u++){var c=r[2+u];o()[s+u]=c}return ct(e,a,i,t)}))}var Oe=[];function Me(e){try{return Z.grow(e-j.byteLength+65535>>>16),ne(Z.buffer),1}catch(xt){}}var ze={inEventHandler:0,removeAllEventListeners:function(){for(var e=ze.eventHandlers.length-1;e>=0;--e)ze._removeHandler(e);ze.eventHandlers=[],ze.deferredCalls=[]},registerRemoveEventListeners:function(){ze.removeEventListenersRegistered||(se.push(ze.removeAllEventListeners),ze.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function(e,t,n){function r(e,t){if(e.length!=t.length)return!1;for(var n in e)if(e[n]!=t[n])return!1;return!0}for(var a in ze.deferredCalls){var i=ze.deferredCalls[a];if(i.targetFunction==e&&r(i.argsList,n))return}ze.deferredCalls.push({targetFunction:e,precedence:t,argsList:n}),ze.deferredCalls.sort((function(e,t){return e.precedence<t.precedence}))},removeDeferredCalls:function(e){for(var t=0;t<ze.deferredCalls.length;++t)ze.deferredCalls[t].targetFunction==e&&(ze.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function(){return ze.inEventHandler&&ze.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(ze.canPerformEventHandlerRequests())for(var e=0;e<ze.deferredCalls.length;++e){var t=ze.deferredCalls[e];ze.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function(e,t){for(var n=0;n<ze.eventHandlers.length;++n)ze.eventHandlers[n].target==e&&(!t||t==ze.eventHandlers[n].eventTypeString)&&ze._removeHandler(n--)},_removeHandler:function(e){var t=ze.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),ze.eventHandlers.splice(e,1)},registerOrRemoveHandler:function(e){var t=function(t){++ze.inEventHandler,ze.currentEventHandler=e,ze.runDeferredCalls(),e.handlerFunc(t),ze.runDeferredCalls(),--ze.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),ze.eventHandlers.push(e),ze.registerRemoveEventListeners();else for(var n=0;n<ze.eventHandlers.length;++n)ze.eventHandlers[n].target==e.target&&ze.eventHandlers[n].eventTypeString==e.eventTypeString&&ze._removeHandler(n--)},queueEventHandlerOnThread_iiii:function(e,t,n,r,a){Se((function(){var o=mt(12);i()[o>>2]=n,i()[o+4>>2]=r,i()[o+8>>2]=a,lt(e,637534208,t,r,o)}))},getTargetThreadForEventCallback:function(e){switch(e){case 1:return 0;case 2:return Te.currentProxiedOperationCallerThread;default:return e}},getNodeNameForTarget:function(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function Le(e,t,n,r){Se((function(){var a=mt(12),o=0;t&&(o=function(e){var t=function(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}(e)+1,n=nt(t);return G(e,n,t),n}(t)),i()[a>>2]=o,i()[a+4>>2]=n,i()[a+8>>2]=r,lt(e,657457152,0,o,a)}))}var Pe=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];function Be(e){return e=function(e){return e>2?U(e):e}(e),Pe[e]||("undefined"!=typeof document?document.querySelector(e):void 0)}function We(e){return Be(e)}function Ve(e,t,n){var r=We(e);if(!r)return-4;if(r.canvasSharedPtr&&(i()[r.canvasSharedPtr>>2]=t,i()[r.canvasSharedPtr+4>>2]=n),!r.offscreenCanvas&&r.controlTransferredOffscreen)return r.canvasSharedPtr?(function(e,t,n,r){Le(e,t=t?U(t):"",n,r)}(i()[r.canvasSharedPtr+8>>2],e,t,n),1):-4;r.offscreenCanvas&&(r=r.offscreenCanvas);var a=!1;if(r.GLctxObject&&r.GLctxObject.GLctx){var o=r.GLctxObject.GLctx.getParameter(2978);a=0===o[0]&&0===o[1]&&o[2]===r.width&&o[3]===r.height}return r.width=t,r.height=n,a&&r.GLctxObject.GLctx.viewport(0,0,t,n),0}function Ue(e,t,n){return S?Ze(2,1,e,t,n):Ve(e,t,n)}var Ge={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:{},offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(e){Ge.lastError||(Ge.lastError=e)},getNewId:function(e){for(var t=Ge.counter++,n=e.length;n<t;n++)e[n]=null;return t},getSource:function(e,t,n,r){for(var a="",o=0;o<t;++o){var s=r?i()[r+4*o>>2]:-1;a+=U(i()[n+4*o>>2],s<0?void 0:s)}return a},createContext:function(e,t){e.getContextSafariWebGL2Fixed||(e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=function(t,n){var r=e.getContextSafariWebGL2Fixed(t,n);return"webgl"==t==r instanceof WebGLRenderingContext?r:null});var n=e.getContext("webgl",t);return n?Ge.registerContext(n,t):0},registerContext:function(e,t){var n=nt(8);i()[n+4>>2]=it();var r={handle:n,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=r),Ge.contexts[n]=r,("undefined"==typeof t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&Ge.initExtensions(r),n},makeContextCurrent:function(e){return Ge.currentContext=Ge.contexts[e],l.ctx=Ye=Ge.currentContext&&Ge.currentContext.GLctx,!(e&&!Ye)},getContext:function(e){return Ge.contexts[e]},deleteContext:function(e){Ge.currentContext===Ge.contexts[e]&&(Ge.currentContext=null),"object"==typeof ze&&ze.removeAllHandlersOnTarget(Ge.contexts[e].GLctx.canvas),Ge.contexts[e]&&Ge.contexts[e].GLctx.canvas&&(Ge.contexts[e].GLctx.canvas.GLctxObject=void 0),rt(Ge.contexts[e].handle),Ge.contexts[e]=null},initExtensions:function(e){if(e||(e=Ge.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t=e.GLctx;(function(e){var t=e.getExtension("ANGLE_instanced_arrays");if(t)e.vertexAttribDivisor=function(e,n){t.vertexAttribDivisorANGLE(e,n)},e.drawArraysInstanced=function(e,n,r,a){t.drawArraysInstancedANGLE(e,n,r,a)},e.drawElementsInstanced=function(e,n,r,a,i){t.drawElementsInstancedANGLE(e,n,r,a,i)}})(t),function(e){var t=e.getExtension("OES_vertex_array_object");if(t)e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)}}(t),function(e){var t=e.getExtension("WEBGL_draw_buffers");if(t)e.drawBuffers=function(e,n){t.drawBuffersWEBGL(e,n)}}(t),t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query"),function(e){e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw")}(t),(t.getSupportedExtensions()||[]).forEach((function(e){!e.includes("lose_context")&&!e.includes("debug")&&t.getExtension(e)}))}}},je=["default","low-power","high-performance"];var He={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=He.buffers[e];0===t||10===t?((1===e?_:A)(V(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return He.varargs+=4,i()[He.varargs-4>>2]},getStr:function(e){return U(e)},get64:function(e,t){return e}};function qe(e){return S?Ze(3,1,e):0}function Ke(e,t,n,r,a){if(S)return Ze(4,1,e,t,n,r,a)}function Xe(e,t,n,r){if(S)return Ze(5,1,e,t,n,r);for(var o=0,s=0;s<n;s++){var u=i()[t>>2],c=i()[t+4>>2];t+=8;for(var l=0;l<c;l++)He.printChar(e,a()[u+l]);o+=c}return i()[r>>2]=o,0}Te.init();var Ye,Qe,Je,$e,et=[null,Ce,Ue,qe,Ke,Xe],tt={__clock_gettime:function(e,t){return Re(e,t)},__emscripten_init_main_thread_js:function(e){st(e,!k,1,!x),Te.threadInit()},__emscripten_thread_cleanup:function(e){S?postMessage({cmd:"cleanupThread",thread:e}):Ie(e)},__pthread_create_js:function(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return A("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];if(S&&0===a.length)return ut(687865856,e,t,n,r);var i={startRoutine:n,pthread_ptr:e,arg:r,transferList:a};return S?(i.cmd="spawnThread",postMessage(i,a),0):Fe(i)},_emscripten_default_pthread_stack_size:function(){return 2097152},_emscripten_notify_thread_queue:function(e,t){if(e==t)postMessage({cmd:"processQueuedMainThreadWork"});else if(S)postMessage({targetThread:e,cmd:"processThreadQueue"});else{var n=Te.pthreads[e],r=n&&n.worker;if(!r)return;r.postMessage({cmd:"processThreadQueue"})}return 1},abort:function(){ve("")},emscripten_check_blocking_allowed:function(){w||k||R("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},emscripten_get_heap_max:De,emscripten_get_now:Ee,emscripten_memcpy_big:function(e,t,n){a().copyWithin(e,t,t+n)},emscripten_num_logical_cores:function(){return w?J().cpus().length:navigator.hardwareConcurrency},emscripten_receive_on_main_thread_js:function(e,t,n){Oe.length=t;for(var r=n>>3,a=0;a<t;a++)Oe[a]=o()[r+a];return(e<0?ke[-e-1]:et[e]).apply(null,Oe)},emscripten_resize_heap:function(e){var t=a().length;if((e>>>=0)<=t)return!1;var n=2147483648;if(e>n)return!1;for(var r=1;r<=4;r*=2){var i=t*(1+.2/r);if(i=Math.min(i,e+100663296),Me(Math.min(n,te(Math.max(e,i),65536))))return!0}return!1},emscripten_set_canvas_element_size:function(e,t,n){return We(e)?Ve(e,t,n):Ue(e,t,n)},emscripten_unwind_to_js_event_loop:function(){throw"unwind"},emscripten_webgl_create_context:function(e,t){return function(e,t){var n=t>>2,r=i()[n+6],a={alpha:!!i()[n+0],depth:!!i()[n+1],stencil:!!i()[n+2],antialias:!!i()[n+3],premultipliedAlpha:!!i()[n+4],preserveDrawingBuffer:!!i()[n+5],powerPreference:je[r],failIfMajorPerformanceCaveat:!!i()[n+7],majorVersion:i()[n+8],minorVersion:i()[n+9],enableExtensionsByDefault:i()[n+10],explicitSwapControl:i()[n+11],proxyContextToMainThread:i()[n+12],renderViaOffscreenBackBuffer:i()[n+13]},o=We(e);return!o||a.explicitSwapControl?0:Ge.createContext(o,a)}(e,t)},exit:Ne,fd_close:qe,fd_seek:Ke,fd_write:Xe,memory:Z||l.wasmMemory,setTempRet0:function(e){!function(e){e}(e)}},nt=(function(){var e={env:tt,wasi_snapshot_preview1:tt};function t(e,t){var n=e.exports;if(l.asm=n,function(e,t,n){Te.tlsInitFunctions.push(e)}(l.asm.emscripten_tls_init),ae=l.asm.__indirect_function_table,function(e){oe.unshift(e)}(l.asm.__wasm_call_ctors),O=t,!S){var r=Te.unusedWorkers.length;Te.unusedWorkers.forEach((function(e){Te.loadWasmModuleToWorker(e,(function(){--r||function(e){if(fe--,l.monitorRunDependencies&&l.monitorRunDependencies(fe),0==fe&&(null!==he&&(clearInterval(he),he=null),me)){var t=me;me=null,t()}}()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return function(){if(!F&&(x||k)){if("function"==typeof fetch&&!be(ge))return fetch(ge,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ge+"'";return e.arrayBuffer()})).catch((function(){return xe(ge)}));if(d)return new Promise((function(e,t){d(ge,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return xe(ge)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){A("failed to asynchronously prepare wasm: "+e),ve(e)}))}if(S||(fe++,l.monitorRunDependencies&&l.monitorRunDependencies(fe)),l.instantiateWasm)try{return l.instantiateWasm(e,t)}catch(a){return A("Module.instantiateWasm callback failed with error: "+a),!1}(F||"function"!=typeof WebAssembly.instantiateStreaming||ye(ge)||be(ge)||"function"!=typeof fetch?r(n):fetch(ge,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return A("wasm streaming compile failed: "+e),A("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(u)}(),l.___wasm_call_ctors=function(){return(l.___wasm_call_ctors=l.asm.__wasm_call_ctors).apply(null,arguments)},l._init=function(){return(l._init=l.asm.init).apply(null,arguments)},l._init_with_threads_count=function(){return(l._init_with_threads_count=l.asm.init_with_threads_count).apply(null,arguments)},l._get_threads_count=function(){return(l._get_threads_count=l.asm.get_threads_count).apply(null,arguments)},l._register_tensor=function(){return(l._register_tensor=l.asm.register_tensor).apply(null,arguments)},l._dispose_data=function(){return(l._dispose_data=l.asm.dispose_data).apply(null,arguments)},l._dispose=function(){return(l._dispose=l.asm.dispose).apply(null,arguments)},l._Abs=function(){return(l._Abs=l.asm.Abs).apply(null,arguments)},l._Add=function(){return(l._Add=l.asm.Add).apply(null,arguments)},l._AddN=function(){return(l._AddN=l.asm.AddN).apply(null,arguments)},l._All=function(){return(l._All=l.asm.All).apply(null,arguments)},l._Any=function(){return(l._Any=l.asm.Any).apply(null,arguments)},l._ArgMax=function(){return(l._ArgMax=l.asm.ArgMax).apply(null,arguments)},l._AvgPool=function(){return(l._AvgPool=l.asm.AvgPool).apply(null,arguments)},l._BatchMatMul=function(){return(l._BatchMatMul=l.asm.BatchMatMul).apply(null,arguments)},l._Ceil=function(){return(l._Ceil=l.asm.Ceil).apply(null,arguments)},l._ClipByValue=function(){return(l._ClipByValue=l.asm.ClipByValue).apply(null,arguments)},l._Conv2D=function(){return(l._Conv2D=l.asm.Conv2D).apply(null,arguments)},l._Conv2DBackpropInput=function(){return(l._Conv2DBackpropInput=l.asm.Conv2DBackpropInput).apply(null,arguments)},l._Cos=function(){return(l._Cos=l.asm.Cos).apply(null,arguments)},l._Cosh=function(){return(l._Cosh=l.asm.Cosh).apply(null,arguments)},l._CropAndResize=function(){return(l._CropAndResize=l.asm.CropAndResize).apply(null,arguments)},l._Cumprod=function(){return(l._Cumprod=l.asm.Cumprod).apply(null,arguments)},l._Cumsum=function(){return(l._Cumsum=l.asm.Cumsum).apply(null,arguments)},l._DepthToSpace=function(){return(l._DepthToSpace=l.asm.DepthToSpace).apply(null,arguments)},l._DepthwiseConv2dNative=function(){return(l._DepthwiseConv2dNative=l.asm.DepthwiseConv2dNative).apply(null,arguments)},l._Elu=function(){return(l._Elu=l.asm.Elu).apply(null,arguments)},l._Equal=function(){return(l._Equal=l.asm.Equal).apply(null,arguments)},l._Exp=function(){return(l._Exp=l.asm.Exp).apply(null,arguments)},l._FlipLeftRight=function(){return(l._FlipLeftRight=l.asm.FlipLeftRight).apply(null,arguments)},l._Floor=function(){return(l._Floor=l.asm.Floor).apply(null,arguments)},l._FloorDiv=function(){return(l._FloorDiv=l.asm.FloorDiv).apply(null,arguments)},l._FusedBatchNorm=function(){return(l._FusedBatchNorm=l.asm.FusedBatchNorm).apply(null,arguments)},l._FusedConv2D=function(){return(l._FusedConv2D=l.asm.FusedConv2D).apply(null,arguments)},l._FusedDepthwiseConv2D=function(){return(l._FusedDepthwiseConv2D=l.asm.FusedDepthwiseConv2D).apply(null,arguments)},l._Gather=function(){return(l._Gather=l.asm.Gather).apply(null,arguments)},l._GatherNd=function(){return(l._GatherNd=l.asm.GatherNd).apply(null,arguments)},l._Greater=function(){return(l._Greater=l.asm.Greater).apply(null,arguments)},l._GreaterEqual=function(){return(l._GreaterEqual=l.asm.GreaterEqual).apply(null,arguments)},l._LeakyRelu=function(){return(l._LeakyRelu=l.asm.LeakyRelu).apply(null,arguments)},l._Less=function(){return(l._Less=l.asm.Less).apply(null,arguments)},l._LessEqual=function(){return(l._LessEqual=l.asm.LessEqual).apply(null,arguments)},l._Log=function(){return(l._Log=l.asm.Log).apply(null,arguments)},l._LogicalAnd=function(){return(l._LogicalAnd=l.asm.LogicalAnd).apply(null,arguments)},l._LogicalNot=function(){return(l._LogicalNot=l.asm.LogicalNot).apply(null,arguments)},l._LogicalOr=function(){return(l._LogicalOr=l.asm.LogicalOr).apply(null,arguments)},l._LogicalXor=function(){return(l._LogicalXor=l.asm.LogicalXor).apply(null,arguments)},l._Max=function(){return(l._Max=l.asm.Max).apply(null,arguments)},l._MaxPool=function(){return(l._MaxPool=l.asm.MaxPool).apply(null,arguments)},l._Maximum=function(){return(l._Maximum=l.asm.Maximum).apply(null,arguments)},l._Mean=function(){return(l._Mean=l.asm.Mean).apply(null,arguments)},l._Min=function(){return(l._Min=l.asm.Min).apply(null,arguments)},l._Minimum=function(){return(l._Minimum=l.asm.Minimum).apply(null,arguments)},l._MirrorPad=function(){return(l._MirrorPad=l.asm.MirrorPad).apply(null,arguments)},l._Multiply=function(){return(l._Multiply=l.asm.Multiply).apply(null,arguments)},l._Neg=function(){return(l._Neg=l.asm.Neg).apply(null,arguments)},l._NonMaxSuppressionV3=function(){return(l._NonMaxSuppressionV3=l.asm.NonMaxSuppressionV3).apply(null,arguments)},l._NonMaxSuppressionV4=function(){return(l._NonMaxSuppressionV4=l.asm.NonMaxSuppressionV4).apply(null,arguments)},l._NonMaxSuppressionV5=function(){return(l._NonMaxSuppressionV5=l.asm.NonMaxSuppressionV5).apply(null,arguments)},l._NotEqual=function(){return(l._NotEqual=l.asm.NotEqual).apply(null,arguments)},l._OneHot=function(){return(l._OneHot=l.asm.OneHot).apply(null,arguments)},l._PadV2=function(){return(l._PadV2=l.asm.PadV2).apply(null,arguments)},l._Pow=function(){return(l._Pow=l.asm.Pow).apply(null,arguments)},l._Prelu=function(){return(l._Prelu=l.asm.Prelu).apply(null,arguments)},l._Prod=function(){return(l._Prod=l.asm.Prod).apply(null,arguments)},l._RealDiv=function(){return(l._RealDiv=l.asm.RealDiv).apply(null,arguments)},l._Relu=function(){return(l._Relu=l.asm.Relu).apply(null,arguments)},l._Relu6=function(){return(l._Relu6=l.asm.Relu6).apply(null,arguments)},l._ResizeBilinear=function(){return(l._ResizeBilinear=l.asm.ResizeBilinear).apply(null,arguments)},l._ResizeNearestNeighbor=function(){return(l._ResizeNearestNeighbor=l.asm.ResizeNearestNeighbor).apply(null,arguments)},l._Reverse=function(){return(l._Reverse=l.asm.Reverse).apply(null,arguments)},l._RotateWithOffset=function(){return(l._RotateWithOffset=l.asm.RotateWithOffset).apply(null,arguments)},l._Round=function(){return(l._Round=l.asm.Round).apply(null,arguments)},l._Rsqrt=function(){return(l._Rsqrt=l.asm.Rsqrt).apply(null,arguments)},l._ScatterNd=function(){return(l._ScatterNd=l.asm.ScatterNd).apply(null,arguments)},l._SelectV2=function(){return(l._SelectV2=l.asm.SelectV2).apply(null,arguments)},l._Sigmoid=function(){return(l._Sigmoid=l.asm.Sigmoid).apply(null,arguments)},l._Sin=function(){return(l._Sin=l.asm.Sin).apply(null,arguments)},l._Softmax=function(){return(l._Softmax=l.asm.Softmax).apply(null,arguments)},l._SparseFillEmptyRows=function(){return(l._SparseFillEmptyRows=l.asm.SparseFillEmptyRows).apply(null,arguments)},l._SparseReshape=function(){return(l._SparseReshape=l.asm.SparseReshape).apply(null,arguments)},l._SparseSegmentReduction=function(){return(l._SparseSegmentReduction=l.asm.SparseSegmentReduction).apply(null,arguments)},l._Sqrt=function(){return(l._Sqrt=l.asm.Sqrt).apply(null,arguments)},l._Square=function(){return(l._Square=l.asm.Square).apply(null,arguments)},l._SquaredDifference=function(){return(l._SquaredDifference=l.asm.SquaredDifference).apply(null,arguments)},l._Step=function(){return(l._Step=l.asm.Step).apply(null,arguments)},l._StridedSlice=function(){return(l._StridedSlice=l.asm.StridedSlice).apply(null,arguments)},l._Sub=function(){return(l._Sub=l.asm.Sub).apply(null,arguments)},l._Sum=function(){return(l._Sum=l.asm.Sum).apply(null,arguments)},l._Tan=function(){return(l._Tan=l.asm.Tan).apply(null,arguments)},l._Tanh=function(){return(l._Tanh=l.asm.Tanh).apply(null,arguments)},l._Tile=function(){return(l._Tile=l.asm.Tile).apply(null,arguments)},l._TopK=function(){return(l._TopK=l.asm.TopK).apply(null,arguments)},l._Transform=function(){return(l._Transform=l.asm.Transform).apply(null,arguments)},l._Transpose=function(){return(l._Transpose=l.asm.Transpose).apply(null,arguments)},l.__FusedMatMul=function(){return(l.__FusedMatMul=l.asm._FusedMatMul).apply(null,arguments)},l._malloc=function(){return(nt=l._malloc=l.asm.malloc).apply(null,arguments)}),rt=l._free=function(){return(rt=l._free=l.asm.free).apply(null,arguments)},at=(l._emscripten_tls_init=function(){return(l._emscripten_tls_init=l.asm.emscripten_tls_init).apply(null,arguments)},l.___errno_location=function(){return(at=l.___errno_location=l.asm.__errno_location).apply(null,arguments)}),it=l._pthread_self=function(){return(it=l._pthread_self=l.asm.pthread_self).apply(null,arguments)},ot=l._emscripten_main_thread_process_queued_calls=function(){return(ot=l._emscripten_main_thread_process_queued_calls=l.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},st=(l.__emscripten_thread_crashed=function(){return(l.__emscripten_thread_crashed=l.asm._emscripten_thread_crashed).apply(null,arguments)},l.__emscripten_thread_init=function(){return(st=l.__emscripten_thread_init=l.asm._emscripten_thread_init).apply(null,arguments)}),ut=(l._emscripten_current_thread_process_queued_calls=function(){return(l._emscripten_current_thread_process_queued_calls=l.asm.emscripten_current_thread_process_queued_calls).apply(null,arguments)},l._emscripten_main_browser_thread_id=function(){return(l._emscripten_main_browser_thread_id=l.asm.emscripten_main_browser_thread_id).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_2=function(){return(l._emscripten_sync_run_in_main_thread_2=l.asm.emscripten_sync_run_in_main_thread_2).apply(null,arguments)},l._emscripten_sync_run_in_main_thread_4=function(){return(ut=l._emscripten_sync_run_in_main_thread_4=l.asm.emscripten_sync_run_in_main_thread_4).apply(null,arguments)}),ct=l._emscripten_run_in_main_runtime_thread_js=function(){return(ct=l._emscripten_run_in_main_runtime_thread_js=l.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)},lt=l._emscripten_dispatch_to_thread_=function(){return(lt=l._emscripten_dispatch_to_thread_=l.asm.emscripten_dispatch_to_thread_).apply(null,arguments)},pt=l.__emscripten_thread_free_data=function(){return(pt=l.__emscripten_thread_free_data=l.asm._emscripten_thread_free_data).apply(null,arguments)},dt=(l.__emscripten_thread_exit=function(){return(l.__emscripten_thread_exit=l.asm._emscripten_thread_exit).apply(null,arguments)},l._memalign=function(){return(l._memalign=l.asm.memalign).apply(null,arguments)},l._emscripten_stack_set_limits=function(){return(dt=l._emscripten_stack_set_limits=l.asm.emscripten_stack_set_limits).apply(null,arguments)}),ft=l.stackSave=function(){return(ft=l.stackSave=l.asm.stackSave).apply(null,arguments)},ht=l.stackRestore=function(){return(ht=l.stackRestore=l.asm.stackRestore).apply(null,arguments)},mt=l.stackAlloc=function(){return(mt=l.stackAlloc=l.asm.stackAlloc).apply(null,arguments)},vt=(l.dynCall_iijjiiii=function(){return(l.dynCall_iijjiiii=l.asm.dynCall_iijjiiii).apply(null,arguments)},l.dynCall_jiji=function(){return(l.dynCall_jiji=l.asm.dynCall_jiji).apply(null,arguments)},l.__emscripten_allow_main_runtime_queued_calls=21672);function gt(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function yt(e){if(e=e||y,!(fe>0)){if(S)return s(l),le(),void postMessage({cmd:"loaded"});(function(){if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)pe(l.preRun.shift());we(ie)})(),fe>0||(l.setStatus?(l.setStatus("Running..."),setTimeout((function(){setTimeout((function(){l.setStatus("")}),1),t()}),1)):t())}function t(){Qe||(Qe=!0,l.calledRun=!0,!z&&(le(),s(l),l.onRuntimeInitialized&&l.onRuntimeInitialized(),function(){if(!S){if(l.postRun)for("function"==typeof l.postRun&&(l.postRun=[l.postRun]);l.postRun.length;)de(l.postRun.shift());we(ue)}}()))}}if(l.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?L(e):function(){return P(e,t,n,arguments)}},l.keepRuntimeAlive=ce,l.PThread=Te,l.PThread=Te,l.wasmMemory=Z,l.ExitStatus=gt,me=function e(){Qe||yt(),Qe||(me=e)},l.run=yt,l.preInit)for("function"==typeof l.preInit&&(l.preInit=[l.preInit]);l.preInit.length>0;)l.preInit.pop()();if(yt(),c&&(Je={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!c.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!c.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof WasmBackendModule)$e=WasmBackendModule;else{if("undefined"==typeof t)throw new Error("Could not find wasm module in post.js");$e=t}if(Je){var bt=$e._dispose;$e._dispose=function(){bt(),Je.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),Je.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return t.ready}}();"object"==typeof e&&"object"==typeof t?t.exports=r:"function"==typeof define&&n.amdO?define([],(function(){return r})):"object"==typeof e&&(e.WasmBackendModuleThreadedSimd=r)})),ee=F((function(e,t){t.exports.wasmWorkerContents='"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",function(data){onmessage({data:data})});var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8"))},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\n");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=((info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports});self.onmessage=(e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob==="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module).then(function(instance){Module=instance})}else if(e.data.cmd==="run"){Module["__performance_now_clock_drift"]=performance.now()-e.data.time;Module["__emscripten_thread_init"](e.data.threadInfoStruct,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInit();try{var result=Module["invokeEntryPoint"](e.data.start_routine,e.data.arg);if(Module["keepRuntimeAlive"]()){Module["PThread"].setExitStatus(result)}else{Module["__emscripten_thread_exit"](result)}}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processThreadQueue"){if(Module["_pthread_self"]()){Module["_emscripten_current_thread_process_queued_calls"]()}}else if(e.data.cmd==="processProxyingQueue"){if(Module["_pthread_self"]()){Module["_emscripten_proxy_execute_queue"](e.data.queue)}}else{err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){err("worker.js onmessage() captured an uncaught exception: "+ex);if(ex&&ex.stack)err(ex.stack);if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}});'})),te=F((function(e,t){var r=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||k,function(t){var n,r,a,i="undefined"!=typeof(t=t||{})?t:{};i.ready=new Promise((function(e,t){n=e,r=t})),"undefined"!=typeof process&&process.listeners&&(a={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var o,s,u,c,l,p,d=Object.assign({},i),f=[],h="object"==typeof window,m="function"==typeof importScripts,v="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,g="";v?(g=m?X().dirname(g)+"/":"//",p=function(){l||(c=K(),l=X())},o=function(e,t){return p(),e=l.normalize(e),c.readFileSync(e,t?void 0:"utf8")},u=function(e){var t=o(e,!0);return t.buffer||(t=new Uint8Array(t)),t},s=function(e,t,n){p(),e=l.normalize(e),c.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),f=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof le))throw e})),process.on("unhandledRejection",(function(e){throw e})),function(e,t){if(P())throw process.exitCode=e,t;(function(e){e instanceof le||b("exiting due to exception: "+e)})(t),process.exit(e)},i.inspect=function(){return"[Emscripten Module object]"}):(h||m)&&(m?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),e&&(g=e),g=0!==g.indexOf("blob:")?g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},m&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),s=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var y=i.print||console.log.bind(console),b=i.printErr||console.warn.bind(console);Object.assign(i,d),d=null,i.arguments&&(f=i.arguments),i.thisProgram&&i.thisProgram,i.quit&&i.quit;var x;i.wasmBinary&&(x=i.wasmBinary);var k=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&U("no native wasm support detected");var w,S=!1;function I(e){return i["_"+e]}function N(e,t,n,r,a){var i={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,r){if(!(r>0))return 0;for(var a=n,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343)s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o);if(s<=127){if(n>=i)break;t[n++]=s}else if(s<=2047){if(n+1>=i)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=i)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0})(e,R,t,n)})(e,t=ce(n),n)}return t},array:function(e){var t=ce(e.length);return function(e,t){A.set(e,t)}(e,t),t}};var o=I(e),s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=i[n[c]];l?(0===u&&(u=se()),s[c]=l(r[c])):s[c]=r[c]}var p,d=o.apply(null,s);return p=d,0!==u&&ue(u),d=function(e){return"string"===t?E(e):"boolean"===t?Boolean(e):e}(p),d}var T="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function C(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.subarray&&T)return T.decode(e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function E(e,t){return e?C(R,e,t):""}var _,A,R,F;"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");function D(e,t){return e%t>0&&(e+=t-e%t),e}function Z(e){_=e,i.HEAP8=A=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=F=new Int32Array(e),i.HEAPU8=R=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var O,M=[],z=[],L=[];function P(){return k||!1}var B=0,W=null,V=null;function U(e){i.onAbort&&i.onAbort(e),b(e="Aborted("+e+")"),S=!0,1,e+=". Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw r(t),t}i.preloadedImages={},i.preloadedAudios={};var G,j;function H(e){return e.startsWith("data:application/octet-stream;base64,")}function q(e){return e.startsWith("file://")}function Y(e){try{if(e==G&&x)return new Uint8Array(x);if(u)return u(e);throw"both async and sync fetching of the wasm failed"}catch(t){U(t)}}function Q(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var n=t.func;"number"==typeof n?void 0===t.arg?$(n)():$(n)(t.arg):n(void 0===t.arg?null:t.arg)}else t(i)}}H(G="tfjs-backend-wasm.wasm")||(j=G,G=i.locateFile?i.locateFile(j,g):g+j);var J=[];function $(e){var t=J[e];return t||(e>=J.length&&(J.length=e+1),J[e]=t=O.get(e)),t}function ee(){return 2147483648}function te(e){try{return w.grow(e-_.byteLength+65535>>>16),Z(w.buffer),1}catch(t){}}var ne={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var n=ne.buffers[e];0===t||10===t?((1===e?y:b)(C(n,0)),n.length=0):n.push(t)},varargs:void 0,get:function(){return ne.varargs+=4,F[ne.varargs-4>>2]},getStr:function(e){return E(e)},get64:function(e,t){return e}};var re,ae,ie,oe={abort:function(){U("")},emscripten_get_heap_max:ee,emscripten_memcpy_big:function(e,t,n){R.copyWithin(e,t,t+n)},emscripten_resize_heap:function(e){var t=R.length,n=2147483648;if((e>>>=0)>n)return!1;for(var r=1;r<=4;r*=2){var a=t*(1+.2/r);if(a=Math.min(a,e+100663296),te(Math.min(n,D(Math.max(e,a),65536))))return!0}return!1},fd_close:function(e){return 0},fd_seek:function(e,t,n,r,a){},fd_write:function(e,t,n,r){for(var a=0,i=0;i<n;i++){var o=F[t>>2],s=F[t+4>>2];t+=8;for(var u=0;u<s;u++)ne.printChar(e,R[o+u]);a+=s}return F[r>>2]=a,0},setTempRet0:function(e){!function(e){e}(e)}},se=(function(){var e={env:oe,wasi_snapshot_preview1:oe};function t(e,t){var n=e.exports;i.asm=n,Z((w=i.asm.memory).buffer),O=i.asm.__indirect_function_table,function(e){z.unshift(e)}(i.asm.__wasm_call_ctors),function(e){if(B--,i.monitorRunDependencies&&i.monitorRunDependencies(B),0==B&&(null!==W&&(clearInterval(W),W=null),V)){var t=V;V=null,t()}}()}function n(e){t(e.instance)}function a(t){return function(){if(!x&&(h||m)){if("function"==typeof fetch&&!q(G))return fetch(G,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+G+"'";return e.arrayBuffer()})).catch((function(){return Y(G)}));if(s)return new Promise((function(e,t){s(G,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return Y(G)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){b("failed to asynchronously prepare wasm: "+e),U(e)}))}if(B++,i.monitorRunDependencies&&i.monitorRunDependencies(B),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(o){return b("Module.instantiateWasm callback failed with error: "+o),!1}(x||"function"!=typeof WebAssembly.instantiateStreaming||H(G)||q(G)||"function"!=typeof fetch?a(n):fetch(G,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return b("wasm streaming compile failed: "+e),b("falling back to ArrayBuffer instantiation"),a(n)}))}))).catch(r)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.__wasm_call_ctors).apply(null,arguments)},i._init=function(){return(i._init=i.asm.init).apply(null,arguments)},i._init_with_threads_count=function(){return(i._init_with_threads_count=i.asm.init_with_threads_count).apply(null,arguments)},i._get_threads_count=function(){return(i._get_threads_count=i.asm.get_threads_count).apply(null,arguments)},i._register_tensor=function(){return(i._register_tensor=i.asm.register_tensor).apply(null,arguments)},i._dispose_data=function(){return(i._dispose_data=i.asm.dispose_data).apply(null,arguments)},i._dispose=function(){return(i._dispose=i.asm.dispose).apply(null,arguments)},i._Abs=function(){return(i._Abs=i.asm.Abs).apply(null,arguments)},i._Add=function(){return(i._Add=i.asm.Add).apply(null,arguments)},i._AddN=function(){return(i._AddN=i.asm.AddN).apply(null,arguments)},i._All=function(){return(i._All=i.asm.All).apply(null,arguments)},i._Any=function(){return(i._Any=i.asm.Any).apply(null,arguments)},i._ArgMax=function(){return(i._ArgMax=i.asm.ArgMax).apply(null,arguments)},i._AvgPool=function(){return(i._AvgPool=i.asm.AvgPool).apply(null,arguments)},i._BatchMatMul=function(){return(i._BatchMatMul=i.asm.BatchMatMul).apply(null,arguments)},i._Ceil=function(){return(i._Ceil=i.asm.Ceil).apply(null,arguments)},i._ClipByValue=function(){return(i._ClipByValue=i.asm.ClipByValue).apply(null,arguments)},i._Conv2D=function(){return(i._Conv2D=i.asm.Conv2D).apply(null,arguments)},i._Conv2DBackpropInput=function(){return(i._Conv2DBackpropInput=i.asm.Conv2DBackpropInput).apply(null,arguments)},i._Cos=function(){return(i._Cos=i.asm.Cos).apply(null,arguments)},i._Cosh=function(){return(i._Cosh=i.asm.Cosh).apply(null,arguments)},i._CropAndResize=function(){return(i._CropAndResize=i.asm.CropAndResize).apply(null,arguments)},i._Cumprod=function(){return(i._Cumprod=i.asm.Cumprod).apply(null,arguments)},i._Cumsum=function(){return(i._Cumsum=i.asm.Cumsum).apply(null,arguments)},i._DepthToSpace=function(){return(i._DepthToSpace=i.asm.DepthToSpace).apply(null,arguments)},i._DepthwiseConv2dNative=function(){return(i._DepthwiseConv2dNative=i.asm.DepthwiseConv2dNative).apply(null,arguments)},i._Elu=function(){return(i._Elu=i.asm.Elu).apply(null,arguments)},i._Equal=function(){return(i._Equal=i.asm.Equal).apply(null,arguments)},i._Exp=function(){return(i._Exp=i.asm.Exp).apply(null,arguments)},i._FlipLeftRight=function(){return(i._FlipLeftRight=i.asm.FlipLeftRight).apply(null,arguments)},i._Floor=function(){return(i._Floor=i.asm.Floor).apply(null,arguments)},i._FloorDiv=function(){return(i._FloorDiv=i.asm.FloorDiv).apply(null,arguments)},i._FusedBatchNorm=function(){return(i._FusedBatchNorm=i.asm.FusedBatchNorm).apply(null,arguments)},i._FusedConv2D=function(){return(i._FusedConv2D=i.asm.FusedConv2D).apply(null,arguments)},i._FusedDepthwiseConv2D=function(){return(i._FusedDepthwiseConv2D=i.asm.FusedDepthwiseConv2D).apply(null,arguments)},i._Gather=function(){return(i._Gather=i.asm.Gather).apply(null,arguments)},i._GatherNd=function(){return(i._GatherNd=i.asm.GatherNd).apply(null,arguments)},i._Greater=function(){return(i._Greater=i.asm.Greater).apply(null,arguments)},i._GreaterEqual=function(){return(i._GreaterEqual=i.asm.GreaterEqual).apply(null,arguments)},i._LeakyRelu=function(){return(i._LeakyRelu=i.asm.LeakyRelu).apply(null,arguments)},i._Less=function(){return(i._Less=i.asm.Less).apply(null,arguments)},i._LessEqual=function(){return(i._LessEqual=i.asm.LessEqual).apply(null,arguments)},i._Log=function(){return(i._Log=i.asm.Log).apply(null,arguments)},i._LogicalAnd=function(){return(i._LogicalAnd=i.asm.LogicalAnd).apply(null,arguments)},i._LogicalNot=function(){return(i._LogicalNot=i.asm.LogicalNot).apply(null,arguments)},i._LogicalOr=function(){return(i._LogicalOr=i.asm.LogicalOr).apply(null,arguments)},i._LogicalXor=function(){return(i._LogicalXor=i.asm.LogicalXor).apply(null,arguments)},i._Max=function(){return(i._Max=i.asm.Max).apply(null,arguments)},i._MaxPool=function(){return(i._MaxPool=i.asm.MaxPool).apply(null,arguments)},i._Maximum=function(){return(i._Maximum=i.asm.Maximum).apply(null,arguments)},i._Mean=function(){return(i._Mean=i.asm.Mean).apply(null,arguments)},i._Min=function(){return(i._Min=i.asm.Min).apply(null,arguments)},i._Minimum=function(){return(i._Minimum=i.asm.Minimum).apply(null,arguments)},i._MirrorPad=function(){return(i._MirrorPad=i.asm.MirrorPad).apply(null,arguments)},i._Multiply=function(){return(i._Multiply=i.asm.Multiply).apply(null,arguments)},i._Neg=function(){return(i._Neg=i.asm.Neg).apply(null,arguments)},i._NonMaxSuppressionV3=function(){return(i._NonMaxSuppressionV3=i.asm.NonMaxSuppressionV3).apply(null,arguments)},i._NonMaxSuppressionV4=function(){return(i._NonMaxSuppressionV4=i.asm.NonMaxSuppressionV4).apply(null,arguments)},i._NonMaxSuppressionV5=function(){return(i._NonMaxSuppressionV5=i.asm.NonMaxSuppressionV5).apply(null,arguments)},i._NotEqual=function(){return(i._NotEqual=i.asm.NotEqual).apply(null,arguments)},i._OneHot=function(){return(i._OneHot=i.asm.OneHot).apply(null,arguments)},i._PadV2=function(){return(i._PadV2=i.asm.PadV2).apply(null,arguments)},i._Pow=function(){return(i._Pow=i.asm.Pow).apply(null,arguments)},i._Prelu=function(){return(i._Prelu=i.asm.Prelu).apply(null,arguments)},i._Prod=function(){return(i._Prod=i.asm.Prod).apply(null,arguments)},i._RealDiv=function(){return(i._RealDiv=i.asm.RealDiv).apply(null,arguments)},i._Relu=function(){return(i._Relu=i.asm.Relu).apply(null,arguments)},i._Relu6=function(){return(i._Relu6=i.asm.Relu6).apply(null,arguments)},i._ResizeBilinear=function(){return(i._ResizeBilinear=i.asm.ResizeBilinear).apply(null,arguments)},i._ResizeNearestNeighbor=function(){return(i._ResizeNearestNeighbor=i.asm.ResizeNearestNeighbor).apply(null,arguments)},i._Reverse=function(){return(i._Reverse=i.asm.Reverse).apply(null,arguments)},i._RotateWithOffset=function(){return(i._RotateWithOffset=i.asm.RotateWithOffset).apply(null,arguments)},i._Round=function(){return(i._Round=i.asm.Round).apply(null,arguments)},i._Rsqrt=function(){return(i._Rsqrt=i.asm.Rsqrt).apply(null,arguments)},i._ScatterNd=function(){return(i._ScatterNd=i.asm.ScatterNd).apply(null,arguments)},i._SelectV2=function(){return(i._SelectV2=i.asm.SelectV2).apply(null,arguments)},i._Sigmoid=function(){return(i._Sigmoid=i.asm.Sigmoid).apply(null,arguments)},i._Sin=function(){return(i._Sin=i.asm.Sin).apply(null,arguments)},i._Softmax=function(){return(i._Softmax=i.asm.Softmax).apply(null,arguments)},i._SparseFillEmptyRows=function(){return(i._SparseFillEmptyRows=i.asm.SparseFillEmptyRows).apply(null,arguments)},i._SparseReshape=function(){return(i._SparseReshape=i.asm.SparseReshape).apply(null,arguments)},i._SparseSegmentReduction=function(){return(i._SparseSegmentReduction=i.asm.SparseSegmentReduction).apply(null,arguments)},i._Sqrt=function(){return(i._Sqrt=i.asm.Sqrt).apply(null,arguments)},i._Square=function(){return(i._Square=i.asm.Square).apply(null,arguments)},i._SquaredDifference=function(){return(i._SquaredDifference=i.asm.SquaredDifference).apply(null,arguments)},i._Step=function(){return(i._Step=i.asm.Step).apply(null,arguments)},i._StridedSlice=function(){return(i._StridedSlice=i.asm.StridedSlice).apply(null,arguments)},i._Sub=function(){return(i._Sub=i.asm.Sub).apply(null,arguments)},i._Sum=function(){return(i._Sum=i.asm.Sum).apply(null,arguments)},i._Tan=function(){return(i._Tan=i.asm.Tan).apply(null,arguments)},i._Tanh=function(){return(i._Tanh=i.asm.Tanh).apply(null,arguments)},i._Tile=function(){return(i._Tile=i.asm.Tile).apply(null,arguments)},i._TopK=function(){return(i._TopK=i.asm.TopK).apply(null,arguments)},i._Transform=function(){return(i._Transform=i.asm.Transform).apply(null,arguments)},i._Transpose=function(){return(i._Transpose=i.asm.Transpose).apply(null,arguments)},i.__FusedMatMul=function(){return(i.__FusedMatMul=i.asm._FusedMatMul).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.malloc).apply(null,arguments)},i._free=function(){return(i._free=i.asm.free).apply(null,arguments)},i.___errno_location=function(){return(i.___errno_location=i.asm.__errno_location).apply(null,arguments)},i._emscripten_main_thread_process_queued_calls=function(){return(i._emscripten_main_thread_process_queued_calls=i.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},i.stackSave=function(){return(se=i.stackSave=i.asm.stackSave).apply(null,arguments)}),ue=i.stackRestore=function(){return(ue=i.stackRestore=i.asm.stackRestore).apply(null,arguments)},ce=i.stackAlloc=function(){return(ce=i.stackAlloc=i.asm.stackAlloc).apply(null,arguments)};i.dynCall_iijjiiii=function(){return(i.dynCall_iijjiiii=i.asm.dynCall_iijjiiii).apply(null,arguments)},i.dynCall_jiji=function(){return(i.dynCall_jiji=i.asm.dynCall_jiji).apply(null,arguments)};function le(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function pe(e){function t(){re||(re=!0,i.calledRun=!0,!S&&(!0,Q(z),n(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),L.unshift(e);var e;Q(L)}()))}e=e||f,B>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),M.unshift(e);var e;Q(M)}(),B>0)||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t())}if(i.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e}));return"string"!==t&&a&&!r?I(e):function(){return N(e,t,n,arguments)}},V=function e(){re||pe(),re||(V=e)},i.run=pe,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();if(pe(),a&&(ae={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!a.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!a.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof t)ie=t;else{if("undefined"==typeof WasmBackendModuleThreadedSimd)throw new Error("Could not find wasm module in post.js");ie=WasmBackendModuleThreadedSimd}if(ae){var de=ie._dispose;ie._dispose=function(){de(),ae.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),ae.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return t.ready}}();"object"==typeof e&&"object"==typeof t?t.exports=r:"function"==typeof define&&n.amdO?define([],(function(){return r})):"object"==typeof e&&(e.WasmBackendModule=r)})),ne=function(){function e(t,n){(0,y.Z)(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return(0,b.Z)(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),re=function(){function e(){(0,y.Z)(this,e)}return(0,b.Z)(e,[{key:"refCount",value:function(e){return ae("refCount")}},{key:"incRef",value:function(e){return ae("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return ae("time")}},{key:"read",value:function(e){return ae("read")}},{key:"readSync",value:function(e){return ae("readSync")}},{key:"readToGPU",value:function(e,t){return ae("readToGPU")}},{key:"numDataIds",value:function(){return ae("numDataIds")}},{key:"disposeData",value:function(e,t){return ae("disposeData")}},{key:"write",value:function(e,t,n){return ae("write")}},{key:"move",value:function(e,t,n,r,a){return ae("move")}},{key:"memory",value:function(){return ae("memory")}},{key:"floatPrecision",value:function(){return ae("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return ae("dispose")}}]),e}();function ae(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function ie(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,ce(e,--t,n)}function oe(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together First array length was ".concat(e.length,"Second array length was ").concat(t.length));for(var n=e.length,r=0;n>0;)r=Math.random()*n|0,ce(e,--n,r),ce(t,n,r)}function se(e,t,n){return Math.max(e,Math.min(t,n))}function ue(e){return e%2===0?e:e+1}function ce(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function le(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function pe(e,t){var n=Math.random();return t*n+(1-n)*e}function de(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function fe(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function he(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";fe(be(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function me(e){fe(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||Ze(e)&&!n)for(var r=0;r<e.length;++r)ve(e[r],t,n);else t.push(e);return t}function ge(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function ye(e){return 0===e.length}function be(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function xe(e){return e%1===0}function ke(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function we(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Se(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return ie(t),t}function Ie(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Ne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function Te(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!==0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function Ce(e,t){var n=t.length;return fe((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)})),fe(e.every((function(e){return xe(e)})),(function(){return"All values in axis param must be integers but got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function Ee(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:Ce(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function _e(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function Ae(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Re(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function Fe(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function De(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Ze(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function Oe(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Me(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function ze(e){return"string"==typeof e||e instanceof String}function Le(e){return"boolean"==typeof e}function Pe(e){return"number"==typeof e}function Be(e){return Array.isArray(e)?Be(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Pe(e)?"float32":ze(e)?"string":Le(e)?"bool":"float32"}function We(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ve(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function Ue(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Ge(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=Ge(e+l*c,u,n,r);return a}function je(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return Ge(0,e,t,n)}function He(e,t){for(var n=qe(e,t),r=0;r<n.length;r++)n[r]=1;return n}function qe(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Ke(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return je(e,new Float32Array(n));if("int32"===t)return je(e,new Int32Array(n));if("bool"===t)return je(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function Xe(e){e.forEach((function(t){fe(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function Ye(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Qe(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Je(e){return e&&e.then&&"function"==typeof e.then}var $e="tfjsflags",et=function(){function e(t){(0,y.Z)(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=tt,this.populateURLFlags()}return(0,b.Z)(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(rt().getBool("IS_TEST")||rt().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];rt().getBool("IS_TEST")||rt().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=4;break}e.t0=this.flags[t],e.next=8;break;case 4:return e.next=6,this.evaluateFlag(t);case 6:this.flags[t]=e.sent,e.t0=this.flags[t];case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Je(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!=typeof this.global&&"undefined"!=typeof this.global.location&&"undefined"!=typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);$e in t&&t[$e].split(",").forEach((function(t){var n=t.split(":"),r=(0,m.Z)(n,2),a=r[0],i=r[1];e.urlFlags[a]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(a,i)}))}}}]),e}();function tt(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return nt(t,r[0],r[1]),r.join("=")})),t}function nt(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function rt(){return it}var at,it=null;function ot(){if(null==at){var e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}at=e}return at}function st(e,t){var n=function(){var e=ot();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var ut="Abs",ct="Acos",lt="Acosh",pt="Add",dt="AddN",ft="All",ht="Any",mt="ArgMax",vt="ArgMin",gt="Asin",yt="Asinh",bt="Atan",xt="Atanh",kt="Atan2",wt="AvgPool",St="AvgPoolGrad",It="AvgPool3D",Nt="AvgPool3DGrad",Tt="BatchMatMul",Ct="BatchToSpaceND",Et="Bincount",_t="BroadcastTo",At="BroadcastArgs",Rt="Cast",Ft="Ceil",Dt="ClipByValue",Zt="Complex",Ot="ComplexAbs",Mt="Concat",zt="Conv2D",Lt="Conv2DBackpropFilter",Pt="Conv2DBackpropInput",Bt="Conv3D",Wt="Conv3DBackpropFilterV2",Vt="Conv3DBackpropInputV2",Ut="Cos",Gt="Cosh",jt="Cumprod",Ht="Cumsum",qt="CropAndResize",Kt="DenseBincount",Xt="DepthToSpace",Yt="DepthwiseConv2dNative",Qt="DepthwiseConv2dNativeBackpropFilter",Jt="DepthwiseConv2dNativeBackpropInput",$t="Diag",en="Dilation2D",tn="Dilation2DBackpropInput",nn="Dilation2DBackpropFilter",rn="RealDiv",an="Einsum",on="Elu",sn="EluGrad",un="Erf",cn="Equal",ln="Exp",pn="ExpandDims",dn="Expm1",fn="FFT",hn="Fill",mn="FlipLeftRight",vn="Floor",gn="FloorDiv",yn="FusedBatchNorm",bn="GatherV2",xn="GatherNd",kn="Greater",wn="GreaterEqual",Sn="Identity",In="IFFT",Nn="Imag",Tn="IsFinite",Cn="IsInf",En="IsNan",_n="LeakyRelu",An="Less",Rn="LessEqual",Fn="LinSpace",Dn="Log",Zn="Log1p",On="LogicalAnd",Mn="LogicalNot",zn="LogicalOr",Ln="LogicalXor",Pn="LogSoftmax",Bn="LowerBound",Wn="LRN",Vn="LRNGrad",Un="Max",Gn="Maximum",jn="MaxPool",Hn="MaxPoolGrad",qn="MaxPool3D",Kn="MaxPool3DGrad",Xn="MaxPoolWithArgmax",Yn="Mean",Qn="Min",Jn="Minimum",$n="MirrorPad",er="Mod",tr="Multinomial",nr="Multiply",rr="Neg",ar="NotEqual",ir="NonMaxSuppressionV3",or="NonMaxSuppressionV4",sr="NonMaxSuppressionV5",ur="OnesLike",cr="OneHot",lr="Pack",pr="PadV2",dr="Pool",fr="Pow",hr="Prelu",mr="Prod",vr="Range",gr="Real",yr="Reciprocal",br="Relu",xr="Reshape",kr="ResizeNearestNeighbor",wr="ResizeNearestNeighborGrad",Sr="ResizeBilinear",Ir="ResizeBilinearGrad",Nr="Relu6",Tr="Reverse",Cr="Round",Er="Rsqrt",_r="ScatterNd",Ar="SearchSorted",Rr="Select",Fr="Selu",Dr="Slice",Zr="Sin",Or="Sinh",Mr="Sign",zr="Sigmoid",Lr="Softplus",Pr="Sqrt",Br="Sum",Wr="SpaceToBatchND",Vr="SplitV",Ur="Softmax",Gr="SparseFillEmptyRows",jr="SparseReshape",Hr="SparseSegmentMean",qr="SparseSegmentSum",Kr="SparseToDense",Xr="SquaredDifference",Yr="Square",Qr="StridedSlice",Jr="StringNGrams",$r="StringSplit",ea="StringToHashBucketFast",ta="Sub",na="Tan",ra="Tanh",aa="Tile",ia="TopK",oa="Transform",sa="Transpose",ua="Unique",ca="Unpack",la="UnsortedSegmentSum",pa="UpperBound",da="ZerosLike",fa="Step",ha="FromPixels",ma="RotateWithOffset",va="_FusedMatMul",ga="FusedConv2D",ya="FusedDepthwiseConv2D";function ba(){var e;rt().getBool("IS_TEST")||rt().getBool("PROD")||(e=console).warn.apply(e,arguments)}function xa(){var e;rt().getBool("IS_TEST")||rt().getBool("PROD")||(e=console).log.apply(e,arguments)}var ka=st("kernelRegistry",(function(){return new Map})),wa=st("gradRegistry",(function(){return new Map}));function Sa(e,t){var n=Ra(e,t);return ka.get(n)}function Ia(e){return wa.get(e)}function Na(e){for(var t=ka.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=(0,m.Z)(i,2),s=o[0],u=o[1],c=s.split("_");(0,m.Z)(c,1)[0]===e&&n.push(u)}return n}function Ta(e){var t=e.kernelName,n=e.backendName,r=Ra(t,n);ka.has(r)&&ba("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),ka.set(r,e)}function Ca(e){var t=e.kernelName;wa.has(t)&&rt().getBool("DEBUG")&&ba("Overriding the gradient for '".concat(t,"'")),wa.set(t,e)}function Ea(e,t){var n=Ra(e,t);if(!ka.has(n))throw new Error("The kernel '".concat(e,"' for backend '").concat(t,"' is not registered"));ka.delete(n)}function _a(e){if(!wa.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));wa.delete(e)}function Aa(e,t){Na(e).forEach((function(e){Ta(Object.assign({},e,{backendName:t}))}))}function Ra(e,t){return"".concat(t,"_").concat(e)}var Fa={};D(Fa,{arraysEqual:function(){return be},assert:function(){return fe},assertNonNegativeIntegerDimensions:function(){return Xe},assertNonNull:function(){return me},assertShapesMatch:function(){return he},bytesFromStringArray:function(){return Me},bytesPerElement:function(){return Oe},checkConversionForErrors:function(){return Re},clamp:function(){return se},computeStrides:function(){return Ue},createScalarValue:function(){return Ya},createShuffledIndices:function(){return Se},decodeString:function(){return ti},distSquared:function(){return de},encodeString:function(){return ei},fetch:function(){return $a},fingerPrint64:function(){return Xa},flatten:function(){return ve},getArrayFromDType:function(){return Ae},getTypedArrayFromDType:function(){return _e},hasEncodingLoss:function(){return De},hexToLong:function(){return Oa},indexToLoc:function(){return Qe},inferDtype:function(){return Be},inferFromImplicitShape:function(){return Te},isBoolean:function(){return Le},isFunction:function(){return We},isInt:function(){return xe},isNumber:function(){return Pe},isPromise:function(){return Je},isScalarShape:function(){return ye},isString:function(){return ze},isTypedArray:function(){return Ze},isValidDtype:function(){return Fe},locToIndex:function(){return Ye},makeOnesTypedArray:function(){return He},makeZerosNestedTypedArray:function(){return Ke},makeZerosTypedArray:function(){return qe},nearestDivisor:function(){return Ve},nearestLargerEven:function(){return ue},now:function(){return Ja},parseAxisParam:function(){return Ce},randUniform:function(){return pe},repeatedTry:function(){return Ne},rightPad:function(){return Ie},shuffle:function(){return ie},shuffleCombo:function(){return oe},sizeFromShape:function(){return ge},sizeToSquarishShape:function(){return we},squeezeShape:function(){return Ee},sum:function(){return le},swap:function(){return ce},tanh:function(){return ke},toNestedArray:function(){return je},toTypedArray:function(){return Qa}});var Da=Z(O()),Za=Da.default||Da;function Oa(e){return Za.fromString(e,!0,16)}var Ma=Oa("c3a5c85c97cb3127"),za=Oa("b492b66fbe98f273"),La=Oa("9ae16a3b2f90404f");function Pa(e){return e.xor(e.shru(47))}function Ba(e,t,n){var r=e.slice(t,t+n);return Za.fromBytes(Array.from(r),!0,!0)}function Wa(e,t){return Ba(e,t,8)}function Va(e,t){return Ba(e,t,4)}function Ua(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function Ga(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Oa("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function ja(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=Ua(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(Ua(a,44)),[a.add(r),i.add(o)]}(Wa(e,t),Wa(e,t+8),Wa(e,t+16),Wa(e,t+24),n,r)}function Ha(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=La.add(2*t),r=Wa(e,0).add(La),a=Wa(e,t-8),i=Ua(a,37).mul(n).add(r),o=Ua(r,25).add(a).mul(n);return Ga(i,o,n)}if(t>=4){var s=La.add(2*t),u=Va(e,0);return Ga(u.shl(3).add(t),Va(e,t-4),s)}if(t>0){var c=e[0],l=e[t>>1],p=e[t-1],d=c+(l<<8),f=t+(p<<2);return Pa(La.mul(d).xor(Ma.mul(f))).mul(La)}return La}function qa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=La.add(2*t),r=Wa(e,0).mul(za),a=Wa(e,8),i=Wa(e,t-8).mul(n),o=Wa(e,t-16).mul(La);return Ga(Ua(r.add(a),43).add(Ua(i,30)).add(o),r.add(Ua(a.add(La),18)).add(i),n)}function Ka(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=La.add(2*t),r=Wa(e,0).mul(La),a=Wa(e,8),i=Wa(e,t-8).mul(n),o=Wa(e,t-16).mul(La),s=Ua(r.add(a),43).add(Ua(i,30)).add(o),u=Ga(s,r.add(Ua(a.add(La),18)).add(i),n),c=Wa(e,16).mul(n),l=Wa(e,24),p=s.add(Wa(e,t-32)).mul(n),d=u.add(Wa(e,t-24)).mul(n);return Ga(Ua(c.add(l),43).add(Ua(p,30)).add(d),c.add(Ua(l.add(r),18)).add(p),n)}function Xa(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,r=Za.fromNumber(81,!0);if(n<=32)return n<=16?Ha(e,n):qa(e,n);if(n<=64)return Ka(e,n);var a=r,i=r.mul(za).add(113),o=Pa(i.mul(La).add(113)).mul(La),s=[Za.UZERO,Za.UZERO],u=[Za.UZERO,Za.UZERO];a=a.mul(La).add(Wa(e,0));var c=0,l=64*(n-1>>6),p=l+(n-1&63)-63;do{var d;a=Ua(a.add(i).add(s[0]).add(Wa(e,c+8)),37).mul(za),i=Ua(i.add(s[1]).add(Wa(e,c+48)),42).mul(za),a=a.xor(u[1]),i=i.add(s[0]).add(Wa(e,c+40)),o=Ua(o.add(u[0]),33).mul(za),s=ja(e,c,s[1].mul(za),a.add(u[0])),u=ja(e,c+32,o.add(u[1]),i.add(Wa(e,c+16))),o=(d=[a,o])[0],a=d[1],c+=64}while(c!==l);var f=za.add(o.and(255).shl(1));return c=p,u[0]=u[0].add(n-1&63),s[0]=s[0].add(u[0]),u[0]=u[0].add(s[0]),a=Ua(a.add(i).add(s[0]).add(Wa(e,c+8)),37).mul(f),i=Ua(i.add(s[1]).add(Wa(e,c+48)),42).mul(f),a=a.xor(u[1].mul(9)),i=i.add(s[0].mul(9).add(Wa(e,c+40))),o=Ua(o.add(u[0]),33).mul(f),s=ja(e,c,s[1].mul(f),a.add(u[0])),u=ja(e,c+32,o.add(u[1]),i.add(Wa(e,c+16))),o=(t=[a,o])[0],a=t[1],Ga(Ga(s[0],u[0],f).add(Pa(i).mul(Ma)).add(o),Ga(s[1],u[1],f).add(a),f)}function Ya(e,t){return"string"===t?ei(e):Qa([e],t)}function Qa(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ve(e)),rt().getBool("DEBUG")&&Re(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function Ja(){return rt().platform.now()}function $a(e,t){return rt().platform.fetch(e,t)}function ei(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",rt().platform.encode(e,t)}function ti(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",rt().platform.decode(e,t)}var ni=function(){function e(t,n){(0,y.Z)(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new ri)}return(0,b.Z)(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=Ja();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=(0,x.Z)(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(p){u.e(p)}finally{u.f()}a=Promise.resolve({kernelMs:Ja()-o})}if(rt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},l=0;l<r.length;l++)c(l);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var ri=function(){function e(){(0,y.Z)(this,e)}return(0,b.Z)(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?Ie("".concat(r,"ms"),9):r.error,s=Ie(e,25),u=t.rank,c=t.size,l=Ie(t.shape.toString(),14),p="";for(var d in a){var f=a[d];if(null!=f){var h=f.shape||t.shape,m=h.length;p+="".concat(d,": ").concat(m,"D ").concat(m>0?h:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(p,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function ai(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],p=!1,d=0;d<t.length;d++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),p=!0,a[s.id]=!0;break}if(p)break}}var f={};f[n.id]=!0;for(var h={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(f[v.outputs[y].id]){for(var b in g)f[g[b].id]=!0,h[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&h[w.id]){var S={};for(var I in w.inputs){var N=w.inputs[I];r[N.id]&&(S[I]=N)}var T=Object.assign({},w);T.inputs=S,T.outputs=w.outputs,x.push(T)}}return x}function ii(e,t,n,r){for(var a=function(a){var i=t[a],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var a=n((function(){return s[t]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var o=i.inputs[t];if(!be(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(a.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{var u=e[o.id];e[o.id]=r(u,a),u.dispose()}};for(var c in i.inputs)u(c)},i=t.length-1;i>=0;i--)a(i)}function oi(e,t,n,r){var a=Ue(t),i=function(e,t,n,r){var a=ge(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?li(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,p=0;p<i;p++)o[p]=Math.max(o[p],si(u[l+p],0,n).length);return o}(e,t,n,a),o=t.length,s=ci(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function si(e,t,n){return Ie(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ").concat(parseFloat(e[1].toFixed(7)),"j"):ze(e)?"'".concat(e,"'"):"bool"===n?ui(e):parseFloat(e.toFixed(7)).toString(),t)}function ui(e){return 0===e?"false":"true"}function ci(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u){if("complex64"===n){var c=li(e);return[si(c[0],0,n)]}return"bool"===n?[ui(e[0])]:[e[0].toString()]}if(1===u){if(s>20){var l=3*o,p=Array.from(e.slice(0,l)),d=Array.from(e.slice((s-3)*o,s*o));return"complex64"===n&&(p=li(p),d=li(d)),["["+p.map((function(e,t){return si(e,a[t],n)})).join(", ")+", ..., "+d.map((function(e,t){return si(e,a[s-3+t],n)})).join(", ")+"]"]}var f="complex64"===n?li(e):Array.from(e);return["["+f.map((function(e,t){return si(e,a[t],n)})).join(", ")+"]"]}var m=t.slice(1),v=r.slice(1),g=r[0]*o,y=[];if(s>20){for(var b=0;b<3;b++){var x=b*g,k=x+g;y.push.apply(y,(0,h.Z)(ci(e.slice(x,k),m,n,v,a,!1)))}y.push("...");for(var w=s-3;w<s;w++){var S=w*g,I=S+g;y.push.apply(y,(0,h.Z)(ci(e.slice(S,I),m,n,v,a,w===s-1)))}}else for(var N=0;N<s;N++){var T=N*g,C=T+g;y.push.apply(y,(0,h.Z)(ci(e.slice(T,C),m,n,v,a,N===s-1)))}var E=2===u?",":"";y[0]="["+y[0]+E;for(var _=1;_<y.length-1;_++)y[_]=" "+y[_]+E;for(var A=",\n",R=2;R<u;R++)A+="\n";return y[y.length-1]=" "+y[y.length-1]+"]"+(i?"":A),y}function li(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var pi=function(){function e(t,n,r){var a=this;if((0,y.Z)(this,e),this.dtype=n,this.shape=t.slice(),this.size=ge(t),null!=r){var i=r.length;fe(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size inferred by the shape '").concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ae(n,this.size),this.strides=Ue(t)}return(0,b.Z)(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),fe(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,".   Buffer shape=").concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return di().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),di=null,fi=null;var hi=function(){function e(t,n,r,a){(0,y.Z)(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=ge(t),this.strides=Ue(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return(0,b.Z)(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",fi.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return fi.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",je(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return je(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=di().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return ti(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),di().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=di().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return ti(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,di().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(di().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return fi.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),fi.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.dataSync();return oi(t,this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),fi.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),di().makeVariable(this,e,t,n)}}]),e}();function mi(){return st("Tensor",(function(){return hi}))}Object.defineProperty(hi,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),mi();var vi=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a,i){var o;return(0,y.Z)(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return(0,b.Z)(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!be(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));di().disposeTensor(this),this.dataId=e.dataId,di().incRef(this,null)}},{key:"dispose",value:function(){di().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(hi);Object.defineProperty(vi,Symbol.hasInstance,{value:function(e){return e instanceof hi&&null!=e.assign&&e.assign instanceof Function}});var gi,yi,bi,xi,ki,wi={};D(wi,{assertTypesMatch:function(){return Ci},getTensorsInContainer:function(){return _i},isTensorInList:function(){return Ei},makeTypesMatch:function(){return Ti}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(gi||(gi={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(yi||(yi={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(bi||(bi={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(xi||(xi={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(ki||(ki={}));var Si={float32:xi,int32:yi,bool:bi,complex64:ki};function Ii(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Si[e][t]}function Ni(e){return Ii(e,"int32")}function Ti(e,t){if(e.dtype===t.dtype)return[e,t];var n=Ii(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Ci(e,t){fe(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and second(").concat(t.dtype,") input must match")}))}function Ei(e,t){return t.some((function(t){return t.id===e.id}))}function _i(e){var t=[];return Ai(e,t,new Set),t}function Ai(e,t,n){if(null!=e)if(e instanceof hi)t.push(e);else if(function(e){return Array.isArray(e)||"object"==typeof e}(e)){var r=e;for(var a in r){var i=r[a];n.has(i)||(n.add(i),Ai(i,t,n))}}}function Ri(e){return null!=e.kernelName}var Fi=function(){function e(){(0,y.Z)(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return(0,b.Z)(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),Di=function(){function e(t){(0,y.Z)(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Fi}return(0,b.Z)(e,[{key:"ready",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return");case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(ba("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ni(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;Na(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Na(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof re||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,ba("Initialization of backend ".concat(e," failed")),ba(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(r){return ba("Initialization of backend ".concat(e," failed")),ba(r.stack||r.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(r){throw t(),r}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Mi.runKernel(Sn,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return Mi.runKernel(Rt,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,null==Sa(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r=this,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var u,c=Ri(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Ri(e)){var l=e.kernelName,p=e.inputs,d=e.attrs;null==this.backendName&&this.backend;var f=Sa(l,this.backendName);fe(null!=f,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(r.backendName,"'")})),n=function(){var e=r.backend.numDataIds();u=f.kernelFunc({inputs:p,attrs:d,backend:r.backend});var t=Array.isArray(u)?u:[u];r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:r.makeTensorFromTensorInfo(e)}));if(i){var o=r.getTensorsForGradient(l,p,n);a=r.saveTensorsForBackwardMode(o)}return n}}else{var h=e.forwardFunc,m=function(e){!i||(a=e.map((function(e){return r.keep(r.clone(e))})))};n=function(){var e=r.backend.numDataIds();u=r.tidy((function(){return h(r.backend,m)}));var t=Array.isArray(u)?u:[u];return r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(c,e,t),t}}var v,g=e.inputs,y=e.attrs,b=Ri(e)?null:e.backwardsFunc;return this.scopedRun((function(){return r.state.kernelDepth++}),(function(){return r.state.kernelDepth--}),(function(){r.ENV.getBool("DEBUG")||r.state.profiling?(v=r.profiler.profileKernel(c,g,(function(){return n()})),r.ENV.getBool("DEBUG")&&r.profiler.logKernelProfile(v),t=v.outputs):t=n()})),i&&this.addTapeNode(c,g,t,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(u)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Ia(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(fe(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&ze(e[0])&&(a=e.map((function(e){return ei(e)})));var i=r.write(a,t,n),o=new hi(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=Me(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new hi(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new vi(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Oe(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof vi||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*Oe(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,(0,h.Z)(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=(0,x.Z)(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((i=a.n()).done){e.next=23;break}return o=i.value,e.next=17,o.kernelTimeMs;case 17:return o.kernelTimeMs=e.sent,e.next=20,o.extraInfo;case 20:o.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=Ia(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=qe(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=_i(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];!i.kept&&!r.has(i.id)&&i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){!e.kept&&e.scopeId===o.id&&t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(fe(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));fe(i instanceof hi,(function(){return"The result y returned by f() must be a tensor."}));var o=ai(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?Zi(i.shape):n,ii(e,o,(function(e){return r.tidy(e)}),zi);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=(0,x.Z)(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return fe(We(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];fe(r.every((function(e){return e instanceof hi})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i,o={};r.forEach((function(e,t){o[t]=e}));var s=function(t,n){return fe((i=e.apply(void 0,r.concat([n]))).value instanceof hi,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),fe(We(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},u=function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];fe(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),fe(a.every((function(e){return e instanceof hi})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ja(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=Ja()-n,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Fi,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function Zi(e){var t=He(ge(e),"float32");return Mi.makeTensor(t,e,"float32")}function Oi(){var e=ot();if(null==e._tfengine){var t=new et(e);e._tfengine=new Di(t)}return function(e){it=e}(e._tfengine.ENV),function(e){di=e}((function(){return e._tfengine})),e._tfengine}Di.nextTensorId=0,Di.nextVariableId=0;var Mi=Oi();function zi(e,t){var n={a:e,b:t};return Mi.runKernel(pt,n)}var Li,Pi={};function Bi(e){Li=e}function Wi(e){if(void 0!==Li)return Li;if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Vi(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}D(Pi,{isBrowser:function(){return Vi},isMobile:function(){return Wi},mockIsMobile:function(){return Bi}});var Ui=rt();function Gi(e,t){var n=e;if(Ze(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Ze(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&rt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&ji(e,r,[]),r}function ji(e,t,n){if(n=n||[],Array.isArray(e)||Ze(e)){fe(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, but is an array of ").concat(e.length," elements")})),fe(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," elements, but has ").concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)ji(e[a],r,n.concat(a))}else fe(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(t[0]," elements")}))}function Hi(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function qi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof hi)return Hi(r,e.dtype,t,n),e;var a=Be(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Hi(r,a,t,n),null==e||!Ze(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(i,"'"))}var o=Gi(e,a);!Ze(e)&&!Array.isArray(e)&&(e=[e]);var s="string"!==a?Qa(e,a):ve(e,[],!0);return Mi.makeTensor(s,o,a)}function Ki(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,a){return qi(e,"".concat(t,"[").concat(a,"]"),n,r)}))}Ui.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ui.registerFlag("IS_BROWSER",(function(){return Vi()})),Ui.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&"undefined"!=typeof process.versions&&"undefined"!=typeof process.versions.node})),Ui.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ui.registerFlag("PROD",(function(){return!1})),Ui.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ui.getBool("DEBUG")})),Ui.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ui.registerFlag("IS_TEST",(function(){return!1})),Ui.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),Ui.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),Ui.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var Xi="__op";function Yi(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=Xi;var a=function(){Mi.startScope(n);try{var e=r.apply(void 0,arguments);return Je(e)&&console.error("Cannot return a Promise inside of tidy."),Mi.endScope(e),e}catch(e){throw Mi.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Qi=Yi({complex_:function(e,t){var n=qi(e,"real","complex"),r=qi(t,"imag","complex");he(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex()."));var a={real:n,imag:r};return Mi.runKernel(Zt,a)}});function Ji(e,t,n,r){if(null==r&&(r=Be(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ze(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Xe(t);var a=ge(t),i=ge(n);fe(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==ge(t.slice(o));fe(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return!Ze(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e="string"!==r?Qa(e,r):ve(e,[],!0),Mi.makeTensor(e,t,r)}function $i(e,t,n){return Ji(e,t,Gi(e,n),n)}var eo={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function to(e,t){return no.apply(this,arguments)}function no(){return no=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var c=new Promise(function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,u,c;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(c)}else a.push(s.data());null!=n&&(u.group=n),r.push(u)},s=0;s<i.length;++s)o(s);return e.next=5,Promise.all(a);case 5:return u=e.sent,e.abrupt("return",{data:ao(u),specs:r});case 7:case"end":return e.stop()}}),e)}))),no.apply(this,arguments)}function ro(e,t){var n,r,a={},i=0,o=(0,x.Z)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,p=ge(l),d=void 0;if("quantization"in s){var f=s.quantization;if("uint8"===f.dtype||"uint16"===f.dtype){if(!("min"in f)||!("scale"in f))throw new Error("Weight ".concat(s.name," with quantization ").concat(f.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==f.dtype)throw new Error("Weight ".concat(s.name," has unknown quantization dtype ").concat(f.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(f.dtype," which only supports weights of type float32 not ").concat(c,"."))}var h=eo[f.dtype],m=e.slice(i,i+p*h),v="uint8"===f.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===f.dtype||"uint16"===f.dtype){d=new Float32Array(v.length);for(var g=0;g<v.length;g++){var y=v[g];d[g]=y*f.scale+f.min}}else{if("float16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," for weight type float32."));void 0===n&&(n=vo()),d=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," for weight type int32."));d=new Int32Array(v.length);for(var b=0;b<v.length;b++){var k=v[b];d[b]=Math.round(k*f.scale+f.min)}}i+=p*h}else if("string"===c){var w=ge(s.shape);d=[];for(var S=0;S<w;S++){var I=new Uint32Array(e.slice(i,i+4))[0];i+=4;var N=new Uint8Array(e.slice(i,i+I));d.push(N),i+=I}}else{var T=eo[c],C=e.slice(i,i+p*T);if("float32"===c)d=new Float32Array(C);else if("int32"===c)d=new Int32Array(C);else if("bool"===c)d=new Uint8Array(C);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));d=new Float32Array(C);for(var E=new Float32Array(d.length/2),_=new Float32Array(d.length/2),A=0;A<E.length;A++)E[A]=d[2*A],_[A]=d[2*A+1];var R=$i(E,l,"float32"),F=$i(_,l,"float32");a[u]=Qi(R,F),R.dispose(),F.dispose()}i+=p*T}"complex64"!==c&&(a[u]=$i(d,l,c))}}catch(D){o.e(D)}finally{o.f()}return a}function ao(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var io="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function oo(e){return io?Buffer.byteLength(e):new Blob([e]).size}function so(e){if(io)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function uo(e){if(io){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function co(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function lo(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function po(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function fo(e,t){return ho.apply(this,arguments)}function ho(){return ho=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},null!=t.trainingConfig&&(r.trainingConfig=t.trainingConfig),null==t.weightsManifest){e.next=9;break}return e.next=4,n(t.weightsManifest);case 4:a=e.sent,i=(0,m.Z)(a,2),o=i[0],s=i[1],r.weightSpecs=o,r.weightData=s;case 9:return e.abrupt("return",(null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),r));case 10:case"end":return e.stop()}}),e)}))),ho.apply(this,arguments)}function mo(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:oo(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:oo(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function vo(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var go=function(){function e(){(0,y.Z)(this,e),this.saveRouters=[],this.loadRouters=[]}return(0,b.Z)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),yo=function(e){return go.registerSaveRouter(e)},bo=function(e){return go.registerLoadRouter(e)},xo=function(e){return go.getSaveHandlers(e)},ko=function(e,t){return go.getLoadHandlers(e,t)},wo="tensorflowjs",So="models_store",Io="model_info_store";function No(){if(!rt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function To(e){var t=e.result;t.createObjectStore(So,{keyPath:"modelPath"}),t.createObjectStore(Io,{keyPath:"modelPath"})}var Co=function(){function e(t){if((0,y.Z)(this,e),this.indexedDB=No(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return(0,b.Z)(e,[{key:"save",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(wo,1);a.onupgradeneeded=function(){return To(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(So,"readonly"),s=o.objectStore(So).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=mo(t),l=i.transaction(Io,"readwrite"),p=l.objectStore(Io),d=p.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var a=(u=i.transaction(So,"readwrite")).objectStore(So).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(p=l.objectStore(Io)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},d.onerror=function(e){return i.close(),r(d.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();Co.URL_SCHEME="indexeddb://";var Eo=function(e){return rt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Co.URL_SCHEME)?function(e){return new Co(e)}(e.slice(Co.URL_SCHEME.length)):null};function _o(e){return e.startsWith(Co.URL_SCHEME)?e.slice(Co.URL_SCHEME.length):e}go.registerSaveRouter(Eo),go.registerLoadRouter(Eo);var Ao=function(){function e(){(0,y.Z)(this,e),this.indexedDB=No()}return(0,b.Z)(e,[{key:"listModels",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(wo,1);r.onupgradeneeded=function(){return To(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(Io,"readonly"),i=a.objectStore(Io).getAll();i.onsuccess=function(){var t,n={},r=(0,x.Z)(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=_o(t),new Promise((function(e,r){var a=n.indexedDB.open(wo,1);a.onupgradeneeded=function(){return To(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(Io,"readwrite"),s=o.objectStore(Io),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),o=function(){var a=(n=i.transaction(So,"readwrite")).objectStore(So).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ro="/",Fo="tensorflowjs_models",Do="info",Zo="model_topology",Oo="weight_specs",Mo="weight_data",zo="model_metadata";function Lo(e){return{info:[Fo,e,Do].join(Ro),topology:[Fo,e,Zo].join(Ro),weightSpecs:[Fo,e,Oo].join(Ro),weightData:[Fo,e,Mo].join(Ro),modelMetadata:[Fo,e,zo].join(Ro)}}function Po(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function Bo(e){var t=e.split(Ro);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(Ro)}function Wo(e){return e.startsWith(Vo.URL_SCHEME)?e.slice(Vo.URL_SCHEME.length):e}var Vo=function(){function e(t){if((0,y.Z)(this,e),!rt().getBool("IS_BROWSER")||"undefined"==typeof window||"undefined"==typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Lo(this.modelPath)}return(0,b.Z)(e,[{key:"save",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=mo(t),e.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,so(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},e.abrupt("return",(this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}));case 9:throw e.prev=9,e.t0=e.catch(3),Po(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 12:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=uo(s),n));case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();Vo.URL_SCHEME="localstorage://";var Uo=function(e){return rt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Vo.URL_SCHEME)?function(e){return new Vo(e)}(e.slice(Vo.URL_SCHEME.length)):null};go.registerSaveRouter(Uo),go.registerLoadRouter(Uo);var Go=function(){function e(){(0,y.Z)(this,e),fe(rt().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),fe("undefined"==typeof window||"undefined"!=typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return(0,b.Z)(e,[{key:"listModels",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=Fo+Ro,r=Ro+Do,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=Bo(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Wo(t),n=Lo(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),e.abrupt("return",(Po(n),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),jo="://",Ho=function(){function e(){(0,y.Z)(this,e),this.managers={}}return(0,b.Z)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){fe(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(jo)&&(t=t.slice(0,t.indexOf(jo))),fe(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();fe(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function qo(e){if(-1===e.indexOf(jo))throw new Error("The url string provided does not contain a scheme. Supported schemes are: ".concat(Ho.getSchemes().join(",")));return{scheme:e.split(jo)[0],path:e.split(jo)[1]}}function Ko(e,t){return Xo.apply(this,arguments)}function Xo(){return Xo=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,f=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>2&&void 0!==f[2]&&f[2],fe(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),fe((a=go.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),fe(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),i=a[0],fe((o=go.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),fe(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=o[0],u=qo(t).scheme,c=qo(t).path,l=u===qo(t).scheme,e.next=12,i.load();case 12:if(p=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,Ho.getManager(u).removeModel(c);case 17:return e.next=19,s.save(p);case 19:if(d=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,Ho.getManager(u).removeModel(c);case 24:return e.abrupt("return",d.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)}))),Xo.apply(this,arguments)}function Yo(){return Qo.apply(this,arguments)}function Qo(){return Qo=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Ho.getSchemes(),n={},r=(0,x.Z)(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,Ho.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+jo+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])}))),Qo.apply(this,arguments)}function Jo(e){return $o.apply(this,arguments)}function $o(){return $o=(0,g.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=qo(t),e.abrupt("return",Ho.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)}))),$o.apply(this,arguments)}function es(e,t){return ts.apply(this,arguments)}function ts(){return ts=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ko(t,n,!1));case 1:case"end":return e.stop()}}),e)}))),ts.apply(this,arguments)}function ns(e,t){return rs.apply(this,arguments)}function rs(){return rs=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ko(t,n,!0));case 1:case"end":return e.stop()}}),e)}))),rs.apply(this,arguments)}var as=function(){function e(){(0,y.Z)(this,e)}return(0,b.Z)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(rt().get("IS_BROWSER")){rt().setPlatform("browser",new as);try{Ho.registerManager(Vo.URL_SCHEME,new Go)}catch(X0){}try{Ho.registerManager(Co.URL_SCHEME,new Ao)}catch(X0){}}var is,os=function(){return M()},ss=function(){function e(){(0,y.Z)(this,e),this.util=z(),this.textEncoder=new this.util.TextEncoder}return(0,b.Z)(e,[{key:"fetch",value:function(e,t){return null!=rt().global.fetch?rt().global.fetch(e,t):(null==is&&(is=os()),is(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}();function us(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Xe(e),new pi(e,t,n)}rt().get("IS_NODE")&&!rt().get("IS_BROWSER")&&rt().setPlatform("node",new ss);var cs=Yi({cast_:function(e,t){var n=qi(e,"x","cast");if(!Fe(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Mi.runKernel(Rt,r,a)}});var ls=Yi({clone_:function(e){var t={x:qi(e,"x","clone","string_or_numeric")};return Mi.runKernel(Sn,t)}});function ps(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}Oi(),function(e){fi=e}({buffer:us,cast:cs,clone:ls,print:ps});var ds={};D(ds,{browserFiles:function(){return vs},browserHTTPRequest:function(){return Es},concatenateArrayBuffers:function(){return co},copyModel:function(){return es},decodeWeights:function(){return ro},encodeWeights:function(){return to},fromMemory:function(){return Fs},fromMemorySync:function(){return Ds},getLoadHandlers:function(){return ko},getModelArtifactsForJSON:function(){return fo},getModelArtifactsInfoForJSON:function(){return mo},getSaveHandlers:function(){return xo},http:function(){return Cs},isHTTPScheme:function(){return Ns},listModels:function(){return Yo},loadWeights:function(){return xs},moveModel:function(){return ns},registerLoadRouter:function(){return bo},registerSaveRouter:function(){return yo},removeModel:function(){return Jo},weightsLoaderFactory:function(){return ws},withSaveHandler:function(){return Zs},withSaveHandlerSync:function(){return Os}});function fs(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var hs=function(){function e(t){if((0,y.Z)(this,e),!rt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),(null==t||0===t.length)&&(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return(0,b.Z)(e,[{key:"save",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=po(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=10,fs((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=16,fs((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:mo(t)});case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();hs.URL_SCHEME="downloads://";var ms=function(){function e(t){if((0,y.Z)(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return(0,b.Z)(e,[{key:"load",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=fo(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=(0,x.Z)(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,(0,h.Z)(o.weights)),a.push.apply(a,(0,h.Z)(o.paths))}}catch(c){i.e(c)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,co(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return lo(e.name)})),i={},o=(0,x.Z)(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=lo(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: '".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(s){o.e(s)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(this.weightsFiles.length,")."));return i}}]),e}();function vs(e){return new ms(e)}function gs(e,t,n,r){var a;fe(null!=(a=e)&&Array.isArray(a)&&a.length>0,(function(){return"promises must be a none empty array"})),function(e,t){fe(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction ".concat(e)})),fe(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction ".concat(t)})),fe(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function ys(e,t){return bs.apply(this,arguments)}function bs(){return bs=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?rt().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,gs(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0.map((function(e){return e.arrayBuffer()})),u=.5,c=1,null!=n.onProgress){e.next=23;break}return e.next=20,Promise.all(s);case 20:e.t1=e.sent,e.next=26;break;case 23:return e.next=25,gs(s,n.onProgress,u,c);case 25:e.t1=e.sent;case 26:return e.abrupt("return",e.t1);case 27:case"end":return e.stop()}}),e)}))),bs.apply(this,arguments)}function xs(e){return ks.apply(this,arguments)}function ks(){return ks=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",ws((function(e){return ys(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)}))),ks.apply(this,arguments)}function ws(e){return function(){var t=(0,g.Z)((0,v.Z)().mark((function t(n){var r,a,i,o,s,u,c,l,p,d,f,h,m=arguments;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=eo[r]*ge(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: ".concat(c.join(", "),". \nManifest JSON has weights with names: ").concat(u.join(", "),"."));case 6:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),p=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;p.push(t)}))})),t.next=10,e(p);case 10:return d=t.sent,f={},h=0,t.abrupt("return",(l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=d[h+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(d[h+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=ro(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)f[n]=t[n]})),h+=t})),f));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}go.registerSaveRouter((function(e){return rt().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(hs.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new hs(e)}(e.slice(hs.URL_SCHEME.length)):null}));var Ss=function(){function e(t,n){if((0,y.Z)(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(fe("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=rt().platform.fetch,fe(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&fe(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return(0,b.Z)(e,[{key:"save",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=po(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=8,this.fetch(this.path,n);case 8:if(!(i=e.sent).ok){e.next=11;break}return e.abrupt("return",{modelArtifactsInfo:mo(t),responses:[i]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(i.status,"."));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ").concat(t.status,". Please verify this URL points to the model JSON of the model to load."));case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:return e.abrupt("return",fo(n,(function(e){return o.loadWeights(e)})));case 19:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,d,f,g,y,b,k,w,S,I;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=Is(n),a=(0,m.Z)(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=(0,x.Z)(t);try{for(c.s();!(l=c.n()).done;)p=l.value,u.push.apply(u,(0,h.Z)(p.weights))}catch(v){c.e(v)}finally{c.f()}d=[],f=[],g=(0,x.Z)(t);try{for(g.s();!(y=g.n()).done;){b=y.value,k=(0,x.Z)(b.paths);try{for(k.s();!(w=k.n()).done;)S=w.value,null!=this.weightUrlConverter?f.push(this.weightUrlConverter(S)):d.push(s+S+o)}catch(v){k.e(v)}finally{k.f()}}}catch(v){g.e(v)}finally{g.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=16;break}return e.t1=d.push,e.t2=d,e.t3=h.Z,e.next=13,Promise.all(f);case 13:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 16:return e.next=18,ys(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 18:return I=e.sent,e.abrupt("return",[u,co(I)]);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Is(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function Ns(e){return null!=e.match(Ss.URL_SCHEME_REGEX)}Ss.URL_SCHEME_REGEX=/^https?:\/\//;var Ts=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return Ns(e)})):Ns(e))?Cs(e,t):null};function Cs(e,t){return new Ss(e,t)}function Es(e,t){return Cs(e,t)}go.registerSaveRouter(Ts),go.registerLoadRouter(Ts);var _s=function(){function e(t){(0,y.Z)(this,e),this.modelArtifacts=t}return(0,b.Z)(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),As=function(){function e(t){(0,y.Z)(this,e),this.saveHandler=t}return(0,b.Z)(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),Rs=(0,b.Z)((function e(t){(0,y.Z)(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function Fs(e,t,n,r){var a=arguments;return new Rs(Ds.apply(void 0,(0,h.Z)(a)))}function Ds(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new _s(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new _s({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new _s({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function Zs(e){return new As(e)}function Os(e){return new As(e)}var Ms={};D(Ms,{confusionMatrix:function(){return lu}});var zs=Yi({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=qi(e,"a","matMul"),i=qi(t,"b","matMul"),o=Ti(a,i),s=(0,m.Z)(o,2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return Mi.runKernel(Tt,u,c)}});var Ls=Yi({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var a={indices:qi(e,"indices","oneHot","int32")},i={depth:t,onValue:n,offValue:r};return Mi.runKernel(cr,a,i)}});function Ps(){rt().set("PROD",!0)}function Bs(){rt().set("DEBUG",!0)}function Ws(){rt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Vs(e){rt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Us(){Mi.disposeVariables()}function Gs(){return Mi}function js(){return Mi.memory()}function Hs(e){return Mi.profile(e)}function qs(e,t){return Mi.tidy(e,t)}function Ks(e){_i(e).forEach((function(e){return e.dispose()}))}function Xs(e){return Mi.keep(e)}function Ys(e){return Mi.time(e)}function Qs(e){return Mi.setBackend(e)}function Js(){return Mi.ready()}function $s(){return Mi.backendName}function eu(e){Mi.removeBackend(e)}function tu(e){return Mi.findBackend(e)}function nu(e){return Mi.findBackendFactory(e)}function ru(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Mi.registerBackend(e,t,n)}function au(){return Mi.backend}function iu(e,t){rt().setPlatform(e,t)}!function(e){e}(Vs);var ou=Yi({imag_:function(e){var t={input:qi(e,"input","imag")};return Mi.runKernel(Nn,t)}});var su=Yi({neg_:function(e){var t={x:qi(e,"x","neg")};return Mi.runKernel(rr,t)}});var uu=Yi({real_:function(e){var t={input:qi(e,"input","real")};return Mi.runKernel(gr,t)}});var cu=Yi({transpose_:function(e,t,n){var r=qi(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),fe(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){fe(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1," but got ").concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?qs((function(){var e=uu(r),t=ou(r);return e=Mi.runKernel(sa,{x:e},i),t=Mi.runKernel(sa,{x:t},i),n&&(t=su(t)),Qi(e,t)})):Mi.runKernel(sa,a,i)}});var lu=Yi({confusionMatrix_:function(e,t,n){var r=qi(e,"labels","confusionMatrix"),a=qi(t,"predictions","confusionMatrix");fe(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got ".concat(n)})),fe(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)})),fe(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got ".concat(a.rank)})),fe(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: ".concat(r.shape[0]," vs. ").concat(a.shape[0],". Labels and predictions should have the same number of elements.")})),fe(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got ".concat(n)}));var i=Ls(cs(r,"int32"),n),o=Ls(cs(a,"int32"),n),s=cu(i),u=zs(s,o);return cs(u,"int32")}}),pu={};function du(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function fu(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function hu(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}D(pu,{assertAndGetBroadcastShape:function(){return hu},getBroadcastDims:function(){return du},getReductionAxes:function(){return fu}});var mu,vu={};function gu(e,t,n){if(me(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Gi(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ji(e,t,r,n)}function yu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));s=!0}if(a&&a&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=Sa(ha,Mi.backendName)){var u={pixels:e},c={numChannels:t};return Mi.runKernel(ha,u,c)}var l,p,d=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],f=(0,m.Z)(d,2),h=f[0],v=f[1];if(o)l=e.getContext("2d").getImageData(0,0,h,v).data;else if(r||n)l=e.data;else if(i||a||s){if(null==mu)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");mu=new OffscreenCanvas(1,1).getContext("2d")}else mu=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});mu.canvas.width=h,mu.canvas.height=v,mu.drawImage(e,0,0,h,v),l=mu.getImageData(0,0,h,v).data}if(4===t)p=new Int32Array(l);else{u=h*v;p=new Int32Array(u*t);for(c=0;c<u;c++)for(var g=0;g<t;++g)p[c*t+g]=l[4*c+g]}return gu(p,[v,h,t],"int32")}function bu(e){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function xu(e){return ku.apply(this,arguments)}function ku(){return ku=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:3,r=null,!rt().getBool("WRAP_TO_IMAGEBITMAP")||!bu(t)){e.next=15;break}return e.prev=3,e.next=6,createImageBitmap(t,{premultiplyAlpha:"none"});case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=null;case 12:r=null!=a&&a.width===t.width&&a.height===t.height?a:t,e.next=16;break;case 15:r=t;case 16:return e.abrupt("return",yu(r,n));case 17:case"end":return e.stop()}}),e,null,[[3,9]])}))),ku.apply(this,arguments)}function wu(e,t){return Su.apply(this,arguments)}function Su(){return Su=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,f,h,g,y,b,x;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=qi(t,"img","toPixels"),t instanceof hi||(r=cs(a=r,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),o=(0,m.Z)(i,2),s=o[0],u=o[1],!((c=2===r.rank?1:r.shape[2])>4||2===c)){e.next=7;break}throw new Error("toPixels only supports depth of size 1, 3 or 4 but got ".concat(c));case 7:if("float32"===r.dtype||"int32"===r.dtype){e.next=9;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,". Please use float32 or int32 tensors."));case 9:return e.next=11,r.data();case 11:l=e.sent,p="float32"===r.dtype?255:1,d=new Uint8ClampedArray(u*s*4),a=0;case 15:if(!(a<s*u)){e.next=36;break}f=[0,0,0,255],h=0;case 18:if(!(h<c)){e.next=31;break}if(g=l[a*c+h],"float32"!==r.dtype){e.next=25;break}if(!(g<0||g>1)){e.next=23;break}throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(g,"."));case 23:e.next=27;break;case 25:if("int32"!==r.dtype||!(g<0||g>255)){e.next=27;break}throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(g,"."));case 27:1===c?(f[0]=g*p,f[1]=g*p,f[2]=g*p):f[h]=g*p;case 28:h++,e.next=18;break;case 31:d[(y=4*a)+0]=Math.round(f[0]),d[y+1]=Math.round(f[1]),d[y+2]=Math.round(f[2]),d[y+3]=Math.round(f[3]);case 33:++a,e.next=15;break;case 36:return null!=n&&(n.width=u,n.height=s,b=n.getContext("2d"),x=new ImageData(d,u,s),b.putImageData(x,0,0)),e.abrupt("return",(r!==t&&r.dispose(),d));case 38:case"end":return e.stop()}}),e)}))),Su.apply(this,arguments)}D(vu,{fromPixels:function(){return Iu},fromPixelsAsync:function(){return xu},toPixels:function(){return wu}});var Iu=Yi({fromPixels_:yu}),Nu={};function Tu(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===ge(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,p=i;p<n;++p)l*=u[p],c.push(u[p]);var d=[].concat((0,h.Z)(Ue(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,d]}D(Nu,{prepareAndValidate:function(){return Tu}});var Cu={};function Eu(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function _u(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}Eu(n,t,e)}function Au(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:ge(t.shape)/u,sliceSize:o,strides:[].concat((0,h.Z)(Ue(n.slice(0,a))),[1]),outputSize:ge(n)}}D(Cu,{calculateShapes:function(){return Au},validateInput:function(){return _u},validateUpdateShape:function(){return Eu}});var Ru={};D(Ru,{assertParamsValid:function(){return Fu},computeFlatOffset:function(){return ju},computeOutShape:function(){return Zu},getNormalizedAxes:function(){return Lu},isSliceContinous:function(){return Gu},maskToAxes:function(){return Du},parseSliceParams:function(){return Hu},sliceInfo:function(){return qu},startForAxis:function(){return Vu},startIndicesWithElidedDims:function(){return Pu},stopForAxis:function(){return Uu},stopIndicesWithElidedDims:function(){return Bu},stridesForAxis:function(){return Wu},stridesWithElidedDims:function(){return Ou}});function Fu(e,t,n){var r=e.shape.length;fe(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),fe(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){fe(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function Du(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Zu(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Ou(e,t,n,r){for(var a=(0,h.Z)(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Mu(e,t,n){return n<=e?n:n-(t-1)}function zu(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function Lu(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),p=new Array(c),d=new Array(c);if(t.length&&n>0){var f=t[0],h=n+1;l=Pu(o,f,h,r,e),p=Bu(s,f,h,a,e),d=Ou(i,f,h,e)}else for(var m=0;m<c;m++)l[m]=Vu(o,r,i,e,m,u),p[m]=Uu(s,a,i,e,m,u),d[m]=Wu(i,m,u);return{begin:l,end:p,strides:d}}function Pu(e,t,n,r,a){for(var i=(0,h.Z)(a),o=zu(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=Mu(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function Bu(e,t,n,r,a){for(var i=(0,h.Z)(a),o=zu(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=Mu(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var p=a[l];i[l]<0&&(i[l]+=p),i[l]=se(0,i[l],a[l])}return i}function Wu(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function Vu(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=se(0,o,u-1)}function Uu(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?se(0,o,u):se(-1,o,u-1)}function Gu(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function ju(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Hu(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat((0,h.Z)(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){fe(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat((0,h.Z)(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(fe(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function qu(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,p={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},d=0;d<p.dims;d++)l&&0!==(1<<d&s)&&p.numAddAxisAfterEllipsis++,1<<d&o&&(l=!0);l||(p.ellipsisMask|=1<<p.dims,p.dims++);var f={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input has only ").concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(p,f);for(var h=!0,m=!0,v=!0,g=[],y=[],b=0;b<e.length;++b){if(0===f.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(f.shrinkAxisMask&1<<b),k=e[b];if(-1!==k){var w=[f.beginMask&1<<b,f.endMask&1<<b],S=[f.strides[b]>0?0:-1,f.strides[b]>0?k:k-1];if(x&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===f.strides[b];var I=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(x){var N=f.begin[b]<0?k+f.begin[b]:f.begin[b];if(f.begin[b]=N,f.end[b]=f.begin[b]+1,N<0||N>=k)throw Error("slice index ".concat(f.begin[b]," of dimension ").concat(b," out of bounds."))}else f.begin[b]=Ku(f.begin[b],0,f.strides[b],k,w,S),f.end[b]=Ku(f.end[b],1,f.strides[b],k,w,S);var T=1===f.strides[b]&&0===f.begin[b]&&f.end[b]===k;h=h&&T,m=m&&(0===b&&1===f.strides[b]||T)}else h=h&&1===f.strides[b]&&I,m=m&&(0===b&&1===f.strides[b]||I);var C=void 0,E=!1;if(f.beginValid&&f.endValid?(C=f.end[b]-f.begin[b],E=!0):x?(C=1,E=!0):I&&k>=0&&(C=f.strides[b]<0?-k:k,E=!0),E){var _=void 0;_=0===C||C<0!=f.strides[b]<0?0:Math.trunc(C/f.strides[b])+(C%f.strides[b]!==0?1:0),g.push(_)}else g.push(-1)}else g.push(x?1:-1)}for(var A=0;A<f.finalShapeGatherIndices.length;++A){var R=f.finalShapeGatherIndices[A];R>=0?y.push(g[R]):-2===R&&y.push(1)}return{finalShapeSparse:y.filter((function(e,t){return-2!==f.finalShapeGatherIndices[t]})),finalShape:y,isIdentity:h,sliceDim0:m,isSimpleSlice:v,begin:f.begin,end:f.end,strides:f.strides}}function Ku(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var Xu={};D(Xu,{Serializable:function(){return Yu},SerializationMap:function(){return Qu},registerClass:function(){return Ju}});var Yu=function(){function e(){(0,y.Z)(this,e)}return(0,b.Z)(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),Qu=function(){function e(){(0,y.Z)(this,e),this.classNameMap={}}return(0,b.Z)(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function Ju(e){fe(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),fe("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),fe(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Qu.register(e)}var $u={};D($u,{TEST_EPSILON_FLOAT16:function(){return ec},encodeStrings:function(){return lc},expectArrayBuffersEqual:function(){return cc},expectArraysClose:function(){return tc},expectArraysEqual:function(){return ic},expectNumbersClose:function(){return oc},expectPromiseToFail:function(){return ac},expectValuesInRange:function(){return uc},testEpsilon:function(){return nc}});var ec=.1;function tc(e,t,n){return null==n&&(n=nc()),rc(e,t,(function(e,t){return sc(e,t,n)}))}function nc(){return 32===Mi.backend.floatPrecision()?.001:ec}function rc(e,t,n){var r=!0;if((Ze(e)||Ze(t))&&(r=!1),Ze(e)&&Ze(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". Expected: ").concat(i))}if(Array.isArray(e)&&Array.isArray(t)){var o=Gi(e),s=Gi(t);if(!be(o,s))throw new Error("Arrays have different shapes. Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=Ze(e)?e:ve(e),c=Ze(t)?t:ve(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs expected: ").concat(c.length,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."));for(var l=0;l<c.length;++l){var p=u[l],d=c[l];if(!n(p,d))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(p,", expected[").concat(l,"] = ").concat(d,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."))}}function ac(e,t){e().then((function(){return t.fail()}),(function(){return t()}))}function ic(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return ze(e)||ze(e[0])||ze(t)||ze(t[0])?rc(e,n,(function(e,t){return e==t})):rc(e,t,(function(e,t){return sc(e,t,0)}))}function oc(e,t,n){if(null==n&&(n=nc()),!sc(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t))}function sc(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function uc(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))}function cc(e,t){var n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error("Expected ArrayBuffer to be of length ".concat(r.length,", but it was ").concat(n.length));for(var a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ").concat(r[a]," but got ").concat(n[a]," instead"))}function lc(e){for(var t=0;t<e.length;t++){var n=e[t];Array.isArray(n)?lc(n):e[t]=ei(n)}return e}var pc="3.19.0";var dc=Yi({add_:function(e,t){var n=qi(e,"a","add"),r=qi(t,"b","add"),a=Ti(n,r),i=(0,m.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(pt,o)}});var fc=Yi({floorDiv_:function(e,t){var n=qi(e,"a","floorDiv"),r=qi(t,"b","floorDiv"),a=Ti(n,r),i=(0,m.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(gn,o)}});var hc=Yi({div_:function(e,t){var n,r,a=qi(e,"a","div"),i=qi(t,"b","div");if(n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],"int32"===a.dtype&&"int32"===i.dtype)return fc(a,i);var o={a:a,b:i};return Mi.runKernel(rn,o,{})}});var mc=Yi({mul_:function(e,t){var n=qi(e,"a","mul"),r=qi(t,"b","mul"),a=Ti(n,r),i=(0,m.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(nr,o)}});var vc=Yi({abs_:function(e){var t=qi(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return Mi.runKernel(Ot,n)}var r={x:t};return Mi.runKernel(ut,r)}});var gc=Yi({acos_:function(e){var t={x:qi(e,"x","acos")};return Mi.runKernel(ct,t)}});var yc=Yi({acosh_:function(e){var t={x:qi(e,"x","acosh")};return Mi.runKernel(lt,t)}});var bc=Yi({addN_:function(e){fe(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),fe(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got ".concat(e.length)}));var t=e.map((function(e,t){return qi(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!be(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return Mi.runKernel(dt,r)}});var xc=Yi({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:qi(e,"x","all","bool")},a={axis:t,keepDims:n};return Mi.runKernel(ft,r,a)}});var kc=Yi({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:qi(e,"x","any","bool")},a={axis:t,keepDims:n};return Mi.runKernel(ht,r,a)}});var wc=Yi({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:qi(e,"x","argMax")},r={axis:t};return Mi.runKernel(mt,n,r)}});var Sc=Yi({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:qi(e,"x","argMin")},r={axis:t};return Mi.runKernel(vt,n,r)}});var Ic=Yi({asin_:function(e){var t={x:qi(e,"x","asin")};return Mi.runKernel(gt,t)}});var Nc=Yi({asinh_:function(e){var t={x:qi(e,"x","asinh")};return Mi.runKernel(yt,t)}});var Tc=Yi({atan_:function(e){var t={x:qi(e,"x","atan")};return Mi.runKernel(bt,t)}});var Cc=Yi({atan2_:function(e,t){var n=qi(e,"a","atan2"),r=qi(t,"b","atan2"),a=Ti(n,r),i=(0,m.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(kt,o)}});var Ec=Yi({atanh_:function(e){var t={x:qi(e,"x","atanh")};return Mi.runKernel(xt,t)}});function _c(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3],s=[].concat((0,h.Z)(t),[o]),u=Uc(a);return Fc(e,s,n,i,r,null,null,u)}function Ac(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=Oc(t),c=(0,m.Z)(u,2),l=c[0],p=c[1];if("channelsLast"===s)o=[l,p,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,p,e[1],e[1]]}return Fc(e,o,n,r,a,i,!1,s)}function Rc(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=Mc(t),l=(0,m.Z)(c,3),p=l[0],d=l[1],f=l[2];if("NDHWC"===u)s="channelsLast",o=[p,d,f,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[p,d,f,e[1],e[1]]}return Dc(e,o,n,r,a,!1,s,i)}function Fc(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,p=-1;if("channelsLast"===s){var d=(0,m.Z)(e,4);u=d[0],c=d[1],l=d[2],p=d[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var f=(0,m.Z)(e,4);u=f[0],p=f[1],c=f[2],l=f[3]}var h,v=(0,m.Z)(t,4),g=v[0],y=v[1],b=v[3],x=Oc(n),k=(0,m.Z)(x,2),w=k[0],S=k[1],I=Oc(r),N=(0,m.Z)(I,2),T=N[0],C=N[1],E=zc(g,T),_=zc(y,C),A=Lc(a,c,l,w,S,E,_,i,s),R=A.padInfo,F=A.outHeight,D=A.outWidth,Z=o?b*p:b;return"channelsFirst"===s?h=[u,Z,F,D]:"channelsLast"===s&&(h=[u,F,D,Z]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:p,outHeight:F,outWidth:D,outChannels:Z,padInfo:R,strideHeight:w,strideWidth:S,filterHeight:g,filterWidth:y,effectiveFilterHeight:E,effectiveFilterWidth:_,dilationHeight:T,dilationWidth:C,inShape:e,outShape:h,filterShape:t}}function Dc(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,p=-1,d=-1;if("channelsLast"===o){var f=(0,m.Z)(e,5);u=f[0],c=f[1],l=f[2],p=f[3],d=f[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var h=(0,m.Z)(e,5);u=h[0],d=h[1],c=h[2],l=h[3],p=h[4]}var v,g=(0,m.Z)(t,5),y=g[0],b=g[1],x=g[2],k=g[4],w=Mc(n),S=(0,m.Z)(w,3),I=S[0],N=S[1],T=S[2],C=Mc(r),E=(0,m.Z)(C,3),_=E[0],A=E[1],R=E[2],F=zc(y,_),D=zc(b,A),Z=zc(x,R),O=Pc(a,c,l,p,I,N,T,F,D,Z,s),M=O.padInfo,z=O.outDepth,L=O.outHeight,P=O.outWidth,B=i?k*d:k;return"channelsFirst"===o?v=[u,B,z,L,P]:"channelsLast"===o&&(v=[u,z,L,P,B]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:p,inChannels:d,outDepth:z,outHeight:L,outWidth:P,outChannels:B,padInfo:M,strideDepth:I,strideHeight:N,strideWidth:T,filterDepth:y,filterHeight:b,filterWidth:x,effectiveFilterDepth:F,effectiveFilterHeight:D,effectiveFilterWidth:Z,dilationDepth:_,dilationHeight:A,dilationWidth:R,inShape:e,outShape:v,filterShape:t}}function Zc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=zc(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Oc(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Mc(e){return"number"==typeof e?[e,e,e]:e}function zc(e,t){return t<=1?e:e+(e-1)*(t-1)}function Lc(e,t,n,r,a,i,o,s,u){var c,l,p;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var d=function(e,t,n,r,a){null==r&&(r=Zc(e,t,n));var i=e[0],o=e[1];return[Bc((i-t+2*r)/n+1,a),Bc((o-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=d[0],p=d[1]}else if("same"===e){l=Math.ceil(t/r),p=Math.ceil(n/a);var f=Math.max(0,(l-1)*r+i-t),h=Math.max(0,(p-1)*a+o-n),m=Math.floor(f/2),v=f-m,g=Math.floor(h/2);c={top:m,bottom:v,left:g,right:h-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),p=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=Bc((t-i+y+b)/r+1,s),p=Bc((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:p}}function Pc(e,t,n,r,a,i,o,s,u,c,l){var p,d,f,h;if("number"==typeof e){p={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=Zc(e,t,r));var o=e[0],s=e[1],u=e[2];return[Bc((o-t+2*a)/r+1,i),Bc((s-t+2*a)/r+1,i),Bc((u-t+2*a)/r+1,i),n]}([t,n,r,1],s,1,a,e,l);d=m[0],f=m[1],h=m[2]}else if("same"===e){var v=((d=Math.ceil(t/a))-1)*a+s-t,g=((f=Math.ceil(n/i))-1)*i+u-n,y=((h=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,k=Math.floor(g/2),w=g-k,S=Math.floor(y/2);p={top:k,bottom:w,left:S,right:y-S,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));p={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/a),f=Math.ceil((n-u+1)/i),h=Math.ceil((r-c+1)/o)}return{padInfo:p,outDepth:d,outHeight:f,outWidth:h}}function Bc(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function Wc(e){var t=Oc(e),n=(0,m.Z)(t,3),r=n[0],a=n[1],i=n[2];return 1===r&&1===a&&1===i}function Vc(e,t){return Wc(e)||Wc(t)}function Uc(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function Gc(e,t,n){if(null!=n){if("string"==typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,"."));if("number"==typeof t)fe(xe(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}));else{if("object"!=typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){fe(xe(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}))}))}))}}}var jc=Yi({reshape_:function(e,t){var n={x:qi(e,"x","reshape","string_or_numeric")},r={shape:t};return Mi.runKernel(xr,n,r)}});var Hc=Yi({avgPool_:function(e,t,n,r,a){var i=qi(e,"x","avgPool","float32");fe(Vc(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=jc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),fe(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),Gc("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Mi.runKernel(wt,u,c);return l=cs(l,i.dtype),s?jc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var qc=Yi({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=qi(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=jc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),fe(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),fe("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),Gc("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Mi.runKernel(It,c,l);return p=cs(p,s.dtype),u?jc(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var Kc=Yi({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;fe(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Ki(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return ls(n[0]);var r=n,a={axis:t};return Mi.runKernel(Mt,r,a)}});var Xc=Yi({sigmoid_:function(e){var t={x:qi(e,"x","sigmoid","float32")};return Mi.runKernel(zr,t)}});var Yc=Yi({slice_:function(e,t,n){var r=qi(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return Mi.runKernel(Dr,a,i)}});var Qc=Yi({tanh_:function(e){var t={x:qi(e,"x","tanh","float32")};return Mi.runKernel(ra,t)}});var Jc=Yi({basicLSTMCell_:function(e,t,n,r,a,i){var o=qi(e,"forgetBias","basicLSTMCell"),s=qi(t,"lstmKernel","basicLSTMCell"),u=qi(n,"lstmBias","basicLSTMCell"),c=qi(r,"data","basicLSTMCell"),l=qi(a,"c","basicLSTMCell"),p=qi(i,"h","basicLSTMCell"),d=Kc([c,p],1),f=zs(d,s),h=dc(f,u),m=h.shape[0],v=h.shape[1]/4,g=[m,v],y=Yc(h,[0,0],g),b=Yc(h,[0,v],g),x=Yc(h,[0,2*v],g),k=Yc(h,[0,3*v],g),w=dc(mc(Xc(y),Qc(b)),mc(l,Xc(dc(o,x))));return[w,mc(Qc(w),Xc(k))]}});var $c=Yi({batchToSpaceND_:function(e,t,n){var r=qi(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));fe(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),fe(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),fe(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return Mi.runKernel(Ct,i,o)}});function el(e){return 0===e.rank||1===e.rank?jc(e,[1,1,1,e.size]):2===e.rank?jc(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?jc(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var tl=Yi({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=qi(e,"x","batchNorm"),c=qi(t,"mean","batchNorm"),l=qi(n,"variance","batchNorm");null!=a&&(o=qi(a,"scale","batchNorm")),null!=r&&(s=qi(r,"offset","batchNorm")),fe(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),fe(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),fe(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var p={x:el(u),scale:o,offset:s,mean:c,variance:l},d={varianceEpsilon:i},f=Mi.runKernel(yn,p,d);return jc(f,u.shape)}});var nl=Yi({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=qi(e,"x","batchNorm"),c=qi(t,"mean","batchNorm"),l=qi(n,"variance","batchNorm");return null!=a&&(o=qi(a,"scale","batchNorm")),null!=r&&(s=qi(r,"offset","batchNorm")),fe(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank ".concat(u.rank,".")})),fe(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(c.rank,".")})),fe(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&fe(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&fe(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(s.rank,".")})),tl(u,c,l,s,o,i)}});var rl=Yi({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=qi(e,"x","batchNorm"),c=qi(t,"mean","batchNorm"),l=qi(n,"variance","batchNorm");return null!=a&&(o=qi(a,"scale","batchNorm")),null!=r&&(s=qi(r,"offset","batchNorm")),fe(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank ".concat(u.rank,".")})),fe(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(c.rank,".")})),fe(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&fe(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&fe(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(s.rank,".")})),tl(u,c,l,s,o,i)}});var al=Yi({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=qi(e,"x","batchNorm"),c=qi(t,"mean","batchNorm"),l=qi(n,"variance","batchNorm");return null!=a&&(o=qi(a,"scale","batchNorm")),null!=r&&(s=qi(r,"offset","batchNorm")),fe(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank ".concat(u.rank,".")})),fe(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(c.rank,".")})),fe(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&fe(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&fe(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(s.rank,".")})),tl(u,c,l,s,o,i)}});var il=Yi({bincount_:function(e,t,n){var r=qi(e,"x","bincount"),a=qi(t,"weights","bincount");fe("int32"===r.dtype,(function(){return"Error in bincount: input dtype must be int32, but got ".concat(r.dtype)})),fe(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),fe(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ").concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return Mi.runKernel(Et,i,o)}});var ol=Yi({broadcastArgs_:function(e,t){var n=qi(e,"s0","broadcastArgs","int32"),r=qi(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). Has rank ".concat(r.rank));var a={s0:n,s1:r};return Mi.runKernel(At,a)}});var sl=Yi({broadcastTo_:function(e,t){var n=qi(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=jc(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));if(0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return ls(n);var u={x:n},c={reps:o};return Mi.runKernel(aa,u,c)}});var ul=Yi({ceil_:function(e){var t={x:qi(e,"x","ceil","float32")};return Mi.runKernel(Ft,t)}});var cl=Yi({clipByValue_:function(e,t,n){var r=qi(e,"x","clipByValue");fe(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")}));var a={x:r},i={clipValueMin:t,clipValueMax:n};return Mi.runKernel(Dt,a,i)}});var ll=Yi({concat1d_:function(e){return Kc(e,0)}});var pl=Yi({concat2d_:function(e,t){return Kc(e,t)}});var dl=Yi({concat3d_:function(e,t){return Kc(e,t)}});var fl=Yi({concat4d_:function(e,t){return Kc(e,t)}});var hl=Yi({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=qi(e,"x","conv2d","float32"),u=qi(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=jc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),fe(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),fe(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank ".concat(u.rank,".")})),Gc("conv2d",r,o);var p="NHWC"===a?c.shape[3]:c.shape[1];fe(p===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(p,") must match input depth for filter ").concat(u.shape[2],".")})),fe(Vc(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")}));var d={x:c,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},h=Mi.runKernel(zt,d,f);return l?jc(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var ml=Yi({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=qi(e,"x","conv1d"),u=qi(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=jc(s,[1,s.shape[0],s.shape[1]])),fe(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),fe(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank ".concat(u.rank,".")})),Gc("conv1d",r,o),fe(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),fe(Vc(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")})),fe("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var p=jc(u,[1,u.shape[0],u.shape[1],u.shape[2]]),d=jc(c,[c.shape[0],1,c.shape[1],c.shape[2]]),f=hl(d,p,[1,n],r,"NHWC",[1,i],o);return jc(f,l?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}});var vl=Yi({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;fe(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=jc(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),fe(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(s.length,".")})),fe(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(u.rank)})),fe(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],p="NHWC"===i?u.shape[3]:u.shape[1];fe(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")})),fe(p===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(p,") must match output depth for filter ").concat(n.shape[3],".")})),Gc("conv2dDerInput",a,o);var d={dy:u,filter:n},f={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},h=Mi.runKernel(Pt,d,f);return c?jc(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var gl=Yi({conv2dTranspose_:function(e,t,n,r,a,i){var o=qi(e,"x","conv2dTranspose"),s=qi(t,"filter","conv2dTranspose");return vl(n,o,s,r,a,"NHWC",i)}});var yl=Yi({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=qi(e,"x","conv3d"),s=qi(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=jc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),fe(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),fe(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank ".concat(s.rank,".")})),fe(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(s.shape[3],".")})),fe(Vc(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),fe("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var l={x:u,filter:s},p={strides:n,pad:r,dataFormat:a,dilations:i},d=Mi.runKernel(Bt,l,p);return c?jc(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var bl=Yi({conv3DBackpropInput_:function(e,t,n,r,a){fe(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=jc(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];fe(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length ".concat(i.length,".")})),fe(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank ".concat(o.rank)})),fe(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank ".concat(n.rank)})),fe(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must match input depth for filter ").concat(n.shape[3],".")})),fe(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")}));var l={dy:o,filter:n},p={pad:a,strides:r,inputShape:i},d=Mi.runKernel(Vt,l,p);return s?jc(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var xl=Yi({conv3dTranspose_:function(e,t,n,r,a){var i=qi(e,"x","conv3dTranspose"),o=qi(t,"filter","conv3dTranspose");return bl(n,i,o,r,a)}});var kl=Yi({cos_:function(e){var t={x:qi(e,"x","cos","float32")};return Mi.runKernel(Ut,t)}});var wl=Yi({cosh_:function(e){var t={x:qi(e,"x","cosh","float32")};return Mi.runKernel(Gt,t)}});var Sl=Yi({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:qi(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return Mi.runKernel(jt,a,i)}});var Il=Yi({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:qi(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return Mi.runKernel(Ht,a,i)}});var Nl=Yi({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=qi(e,"x","denseBincount"),i=qi(t,"weights","denseBincount");fe("int32"===a.dtype,(function(){return"Error in denseBincount: input dtype must be int32, but got ".concat(a.dtype)})),fe(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got rank ".concat(a.rank,".")})),fe(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),fe(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(a.shape,", weights shape: ").concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return Mi.runKernel(Kt,o,s)}});var Tl=Yi({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=qi(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];fe(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),fe(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),fe(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),fe(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return Mi.runKernel(Xt,s,u)}});var Cl=Yi({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=qi(e,"x","depthwiseConv2d","float32"),u=qi(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=jc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),fe(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),fe(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(u.rank,".")}));var p="NHWC"===a?c.shape[3]:c.shape[1];fe(p===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(p,") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),Gc("depthwiseConv2d",r,o);var d={x:c,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},h=Mi.runKernel(Yt,d,f);return l?jc(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var El=Yi({diag_:function(e){var t={x:qi(e,"x","diag")};return Mi.runKernel($t,t)}});var _l=Yi({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=qi(e,"x","dilation2d"),s=qi(t,"filter","dilation2d");fe(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank ".concat(o.rank,".")})),fe(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank ".concat(s.rank,".")})),fe("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=jc(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l={x:u,filter:s},p={strides:n,pad:r,dilations:a},d=Mi.runKernel(en,l,p);return c?jc(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});var Al=Yi({equal_:function(e,t){var n,r,a=qi(e,"a","equal","string_or_numeric"),i=qi(t,"b","equal","string_or_numeric");n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],hu(a.shape,i.shape);var o={a:a,b:i};return Mi.runKernel(cn,o)}});var Rl=Yi({where_:function(e,t,n){var r=qi(t,"a","where"),a=qi(n,"b","where"),i=qi(e,"condition","where","bool"),o=hu(hu(i.shape,r.shape),a.shape),s={condition:sl(i,o),t:sl(r,o),e:sl(a,o)};return Mi.runKernel(Rr,s)}});var Fl=Yi({zerosLike_:function(e){var t={x:qi(e,"x","zerosLike")};return Mi.runKernel(da,t)}});var Dl=Yi({divNoNan_:function(e,t){var n=qi(e,"a","div"),r=qi(t,"b","div"),a=Ti(n,r),i=(0,m.Z)(a,2);n=i[0],r=i[1];var o=hc(n,r),s=Fl(o),u=Al(r,s);return Rl(u,s,o)}});var Zl=Yi({dot_:function(e,t){var n=qi(e,"t1","dot"),r=qi(t,"t2","dot");fe((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(fe(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=jc(n,[1,-1]),s=jc(r,[-1,1]),u=zs(o,s);return jc(u,[])}if(1===n.rank&&2===r.rank){var c=jc(n,[1,-1]),l=jc(r,[r.shape[0],r.shape[1]]),p=zs(c,l);return jc(p,[p.size])}if(2===n.rank&&1===r.rank){var d=jc(r,[-1,1]),f=zs(n,d);return jc(f,[f.size])}var h=jc(r,[r.shape[0],r.shape[1]]);return zs(n,h)}});var Ol=Yi({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return qi(e,"tensors".concat(t),"einsum")})),i={equation:e};return Mi.runKernel(an,a,i)}});var Ml=Yi({elu_:function(e){var t={x:qi(e,"x","elu","float32")};return Mi.runKernel(on,t)}});var zl=Yi({erf_:function(e){var t=qi(e,"x","erf");fe("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=cs(t,"float32"));var n={x:t};return Mi.runKernel(un,n)}});function Ll(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Pl(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function Bl(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function Wl(e,t){return Pl(e,t.map((function(e){return 1})),t)}function Vl(e,t,n){fe(Ll(t,n),(function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")}))}function Ul(e,t){if(Ll(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Gl(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function jl(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var Hl=Yi({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:qi(e,"x","max")},a={reductionIndices:t,keepDims:n};return Mi.runKernel(Un,r,a)}});var ql=Yi({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:qi(e,"x","min")},a={axis:t,keepDims:n};return Mi.runKernel(Qn,r,a)}});var Kl=Yi({pow_:function(e,t){var n=qi(e,"base","pow"),r=qi(t,"exp","pow"),a=Ti(n,r),i=(0,m.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(fr,o)}});function Xl(e,t){if((Ze(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Ze(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ji(e,[],[],t)}var Yl=Yi({sqrt_:function(e){var t={x:qi(e,"x","sqrt","float32")};return Mi.runKernel(Pr,t)}});var Ql=Yi({square_:function(e){var t=qi(e,"x","square");return Mi.runKernel("Square",{x:t},{})}});var Jl=Yi({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=qi(e,"x","sum");"bool"===r.dtype&&(r=cs(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Mi.runKernel(Br,a,i)}});function $l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return vc(e);if(1!==e.rank&&null===n)return $l(jc(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Jl(vc(e),n);if(t===1/0)return Hl(vc(e),n);if(t===-1/0)return ql(vc(e),n);if("euclidean"===t||2===t)return Yl(Jl(Kl(vc(e),Xl(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return Hl(Jl(vc(e),n[0]),n[1]-1);if(t===1/0)return Hl(Jl(vc(e),n[1]),n[0]);if(t===-1/0)return ql(Jl(vc(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Yl(Jl(Ql(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var ep=Yi({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=$l(e=qi(e,"x","norm"),t,n),i=a.shape;if(r){var o=Ce(n,e.shape);i=Wl(a.shape,o)}return jc(a,i)}});var tp=Yi({euclideanNorm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ep(e,"euclidean",t,n)}});var np=Yi({exp_:function(e){var t={x:qi(e,"x","exp")};return Mi.runKernel(ln,t)}});var rp=Yi({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=qi(e,"x","expandDims","string_or_numeric");fe(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Mi.runKernel(pn,r,a)}});var ap=Yi({expm1_:function(e){var t={x:qi(e,"x","expm1")};return Mi.runKernel(dn,t)}});var ip=Yi({tile_:function(e,t){var n=qi(e,"x","tile","string_or_numeric");fe(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")}));var r={x:n},a={reps:t};return Mi.runKernel(aa,r,a)}});var op=Yi({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=us([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=jc(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return ip(rp(s,0),[n[0],1,1]);if(2===n.length)return ip(rp(rp(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return ip(rp(rp(rp(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}});function sp(e,t,n){var r={shape:e,value:t,dtype:n};return Mi.runKernel(hn,{},r)}var up=Yi({floor_:function(e){var t={x:qi(e,"x","floor","float32")};return Mi.runKernel(vn,t)}});var cp=Yi({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=qi(e,"x","gather"),i=qi(t,"indices","gather","int32"),o={x:a,indices:i},s={axis:n,batchDims:r};return Mi.runKernel(bn,o,s)}});var lp=Yi({greater_:function(e,t){var n,r,a=qi(e,"a","greater","string_or_numeric"),i=qi(t,"b","greater","string_or_numeric");n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],hu(a.shape,i.shape);var o={a:a,b:i};return Mi.runKernel(kn,o)}});var pp=Yi({greaterEqual_:function(e,t){var n,r,a=qi(e,"a","greaterEqual","string_or_numeric"),i=qi(t,"b","greaterEqual","string_or_numeric");n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],hu(a.shape,i.shape);var o={a:a,b:i};return Mi.runKernel(wn,o)}});var dp=Yi({isFinite_:function(e){var t={x:qi(e,"x","isFinite")};return Mi.runKernel(Tn,t)}});var fp=Yi({isInf_:function(e){var t={x:qi(e,"x","isInf")};return Mi.runKernel(Cn,t)}});var hp=Yi({isNaN_:function(e){var t={x:qi(e,"x","isNaN")};return Mi.runKernel(En,t)}});var mp=Yi({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:qi(e,"x","leakyRelu")},r={alpha:t};return Mi.runKernel(_n,n,r)}});var vp=Yi({less_:function(e,t){var n,r,a=qi(e,"a","less","string_or_numeric"),i=qi(t,"b","less","string_or_numeric");n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],hu(a.shape,i.shape);var o={a:a,b:i};return Mi.runKernel(An,o)}});var gp=Yi({lessEqual_:function(e,t){var n,r,a=qi(e,"a","lessEqual","string_or_numeric"),i=qi(t,"b","lessEqual","string_or_numeric");n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],hu(a.shape,i.shape);var o={a:a,b:i};return Mi.runKernel(Rn,o)}});function yp(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return Mi.runKernel(Fn,{},r)}var bp=Yi({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=qi(e,"x","localResponseNormalization");fe(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),fe(xe(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=jc(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=Mi.runKernel(Wn,u,c);return s?jc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var xp=Yi({log_:function(e){var t={x:qi(e,"x","log","float32")};return Mi.runKernel(Dn,t)}});var kp=Yi({log1p_:function(e){var t={x:qi(e,"x","log1p")};return Mi.runKernel(Zn,t)}});function wp(e){return fe(We(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=qi(t,"x","tf.grad","string_or_numeric"),a=null!=n?qi(n,"dy","tf.grad"):null;return Mi.tidy((function(){var t=Mi.gradients((function(){return e(r)}),[r],a),n=t.value,i=t.grads;return null!=a&&he(n.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Ep(i),i[0]}))}}function Sp(e){return fe(We(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){fe(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=Ki(t,"args","tf.grads","string_or_numeric"),a=null!=n?qi(n,"dy","tf.grads"):null;return Mi.tidy((function(){var t=Mi.gradients((function(){return e.apply(void 0,(0,h.Z)(r))}),r,a),n=t.value,i=t.grads;return null!=a&&he(n.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ep(i),i}))}}function Ip(e){return fe(We(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){fe(t instanceof hi,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),fe(null==n||n instanceof hi,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Mi.gradients((function(){return e(t)}),[t],n),a=r.grads,i=r.value;return Ep(a),{grad:a[0],value:i}}}function Np(e){return fe(We(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){fe(Array.isArray(t)&&t.every((function(e){return e instanceof hi})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),fe(null==n||n instanceof hi,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Mi.gradients((function(){return e.apply(void 0,(0,h.Z)(t))}),t,n);return null!=n&&he(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Ep(r.grads),r}}function Tp(e,t){fe(We(e),(function(){return"The f passed in variableGrads(f) must be a function"})),fe(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof vi})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Mi.registeredVariables)t.push(Mi.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),fe(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(i," variables is trainable.")}));var o=Mi.gradients(e,t,null,!0),s=o.value,u=o.grads;fe(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),fe(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function Cp(e){return Mi.customGrad(e)}function Ep(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var _p=Yi({softplus_:function(e){var t={x:qi(e,"x","softplus")};return Mi.runKernel(Lr,t)}});var Ap=Yi({logSigmoid_:function(e){var t=qi(e,"x","logSigmoid");return Cp((function(e){return{value:su(_p(su(e))),gradFunc:function(t){return mc(t,Xc(su(e)))}}}))(t)}});var Rp=Yi({sub_:function(e,t){var n=qi(e,"a","sub"),r=qi(t,"b","sub"),a=Ti(n,r),i=(0,m.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(ta,o)}});var Fp=Yi({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=qi(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return Cp((function(e,n){var r=Hl(e,t,!0),a=Rp(e,r),i=Rp(cs(a,"float32"),xp(Jl(np(a),t,!0)));return n([i]),{value:i,gradFunc:function(e,n){var r=(0,m.Z)(n,1)[0],a=np(r);return Rp(e,mc(Jl(e,t,!0),a))}}}))(n)}});var Dp=Yi({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=qi(e,"x","logSumExp"),a=Ce(t,r.shape),i=Hl(r,a,!0),o=Rp(r,i),s=np(o),u=Jl(s,a),c=xp(u),l=dc(jc(i,c.shape),c);if(n){var p=Wl(l.shape,a);return jc(l,p)}return l}});var Zp=Yi({logicalAnd_:function(e,t){var n=qi(e,"a","logicalAnd","bool"),r=qi(t,"b","logicalAnd","bool");hu(n.shape,r.shape);var a={a:n,b:r};return Mi.runKernel(On,a)}});var Op=Yi({logicalNot_:function(e){var t={x:qi(e,"x","logicalNot","bool")};return Mi.runKernel(Mn,t)}});var Mp=Yi({logicalOr_:function(e,t){var n=qi(e,"a","logicalOr","bool"),r=qi(t,"b","logicalOr","bool");hu(n.shape,r.shape);var a={a:n,b:r};return Mi.runKernel(zn,a)}});var zp=Yi({logicalXor_:function(e,t){var n=qi(e,"a","logicalXor","bool"),r=qi(t,"b","logicalXor","bool");return hu(n.shape,r.shape),Zp(Mp(e,t),Op(Zp(e,t)))}}),Lp=2147483648;var Pp=Yi({searchSorted_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",r=qi(e,"sortedSequence","searchSorted"),a=qi(t,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=jc(r,[-1,i]),u=jc(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(ge(u.shape)>=Lp)throw new Error("values tensor size must less than ".concat(Lp));if(s.shape[1]>=Lp)throw new Error("trailing dim_size must less than ".concat(Lp," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:n};return Mi.runKernel(Ar,c,l)}});function Bp(e,t){return Pp(e,t,"left")}var Wp=Yi({maxPool_:function(e,t,n,r,a){var i=qi(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=jc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),fe(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),fe(Vc(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")})),Gc("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Mi.runKernel(jn,u,c);return s?jc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Vp=Yi({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=qi(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=jc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),fe(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),fe("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),Gc("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Mi.runKernel(qn,c,l);return u?jc(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var Up=Yi({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={x:qi(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},s=Mi.runKernel(Xn,i,o);return{result:s[0],indexes:s[1]}}});var Gp=Yi({maximum_:function(e,t){var n,r,a=qi(e,"a","maximum"),i=qi(t,"b","maximum");n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],"bool"===a.dtype&&(a=cs(a,"int32"),i=cs(i,"int32")),hu(a.shape,i.shape);var o={a:a,b:i};return Mi.runKernel(Gn,o)}});var jp=Yi({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:qi(e,"x","mean")},a={axis:t,keepDims:n};return Mi.runKernel(Yn,r,a)}});function Hp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=Hp(e,"float32"),r=Hp(e,"float32");return Qi(n,r)}var a=qe(ge(e),t);return Mi.makeTensor(a,e,t)}function qp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=qp(e,"float32"),r=Hp(e,"float32");return Qi(n,r)}var a=He(ge(e),t);return Mi.makeTensor(a,e,t)}function Kp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.indexing,a=void 0===r?"xy":r;if("xy"!==a&&"ij"!==a)throw new TypeError("".concat(a," is not a valid third argument to meshgrid"));if(void 0===e)return[];var i=qi(e,"x","meshgrid",e instanceof hi?e.dtype:"float32");if(void 0===t)return[i];var o=qi(t,"y","meshgrid",t instanceof hi?t.dtype:"float32"),s=ge(i.shape),u=ge(o.shape);return"xy"===a?(i=jc(i,[1,-1]),o=jc(o,[-1,1]),[zs(qp([u,1],i.dtype),i),zs(o,qp([1,s],o.dtype))]):(i=jc(i,[-1,1]),o=jc(o,[1,-1]),[zs(i,qp([1,u],i.dtype)),zs(qp([s,1],o.dtype),o)])}var Xp=Yi({minimum_:function(e,t){var n,r,a=qi(e,"a","minimum"),i=qi(t,"b","minimum");n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],"bool"===a.dtype&&(a=cs(a,"int32"),i=cs(i,"int32")),hu(a.shape,i.shape);var o={a:a,b:i};return Mi.runKernel(Jn,o)}});var Yp=Yi({mirrorPad_:function(e,t,n){fe("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=qi(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");fe(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){fe(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),fe(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ").concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return Mi.runKernel($n,u,s)}});var Qp=Yi({mod_:function(e,t){var n=qi(e,"a","mod"),r=qi(t,"b","mod"),a=Ti(n,r),i=(0,m.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Mi.runKernel(er,o)}});var Jp=Yi({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ce(t,(e=qi(e,"x","moments")).shape),a=jp(e,r,n),i=a.shape;n||(i=Wl(a.shape,r));var o=Ql(Rp(cs(e,"float32"),jc(a,i))),s=jp(o,r,n);return{mean:a,variance:s}}});var $p=Yi({multiRNNCell_:function(e,t,n,r){for(var a=qi(t,"data","multiRNNCell"),i=Ki(n,"c","multiRNNCell"),o=Ki(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var p=[],d=[],f=0;f<u.length;f+=2)p.push(u[f]),d.push(u[f+1]);return[p,d]}});var ed=Yi({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=qi(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got ".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s={logits:1===o?jc(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},c=Mi.runKernel(tr,s,u);return 1===o?jc(c,[c.size]):c}});var td=Yi({notEqual_:function(e,t){var n,r,a=qi(e,"a","notEqual","string_or_numeric"),i=qi(t,"b","notEqual","string_or_numeric");n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],hu(a.shape,i.shape);var o={a:a,b:i};return Mi.runKernel(ar,o)}});var nd=Yi({onesLike_:function(e){var t={x:qi(e,"x","onesLike")};return Mi.runKernel(ur,t)}});var rd=Yi({outerProduct_:function(e,t){var n=qi(e,"v1","outerProduct"),r=qi(t,"v2","outerProduct");fe(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=jc(n,[-1,1]),i=jc(r,[1,-1]);return zs(a,i)}});var ad=Yi({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=qi(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return Mi.runKernel(pr,i,a)}});var id=Yi({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return fe(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),ad(e,[t],n)}});var od=Yi({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return fe(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ad(e,t,n)}});var sd=Yi({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return fe(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ad(e,t,n)}});var ud=Yi({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return fe(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ad(e,t,n)}});var cd=Yi({spaceToBatchND_:function(e,t,n){var r=qi(e,"x","spaceToBatchND");fe(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),fe(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),fe(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return Mi.runKernel(Wr,a,i)}});var ld=Yi({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=qi(e,"x","maxPool"),u=s,c=!1;3===s.rank&&(c=!0,u=jc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),fe(Vc(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(a,"'")}));var l,p=Ac(u.shape,t,i,a,r),d=[p.dilationHeight,p.dilationWidth];l="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([p.filterHeight,p.filterWidth],d):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],h=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([p.inHeight,p.inWidth],d,l),v=(0,m.Z)(h,2),g=v[0],y=v[1],b=f?r:"valid",x=f?u:cd(u,d,g),k=("avg"===n?function(){return Hc(x,t,i,b,o)}:function(){return Wp(x,t,i,b,o)})(),w=f?k:$c(k,d,y);return c?jc(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});var pd=Yi({prelu_:function(e,t){var n={x:qi(e,"x","prelu"),alpha:qi(t,"alpha","prelu")};return Mi.runKernel(hr,n)}});var dd=Yi({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=qi(e,"x","prod");"bool"===r.dtype&&(r=cs(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Mi.runKernel(mr,a,i)}});var fd=Yi({rand_:function(e,t,n){var r=ge(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Mi.makeTensor(a,e,n)}}),hd=Z(H()),md=function(){function e(t,n,r,a,i){(0,y.Z)(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=hd.alea(o.toString())}return(0,b.Z)(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),vd=function(){function e(t,n,r,a){(0,y.Z)(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=hd.alea(i.toString()),this.randn=new md(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return(0,b.Z)(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),gd=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if((0,y.Z)(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=hd.alea(i)}return(0,b.Z)(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var yd=Yi({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new vd(t,n,r,a),o=us(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var bd=Yi({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new md(t,n,r,!1,a),o=us(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var xd=Yi({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return bd(e,0,1,t,n)}});var kd=Yi({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=us(e,r),o=new gd(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function wd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Mi.runKernel(vr,{},a)}var Sd=Yi({reciprocal_:function(e){var t={x:qi(e,"x","reciprocal")};return Mi.runKernel(yr,t)}});var Id=Yi({relu_:function(e){var t={x:qi(e,"x","relu")};return Mi.runKernel(br,t)}});var Nd=Yi({relu6_:function(e){var t={x:qi(e,"x","relu6")};return Mi.runKernel(Nr,t)}});var Td=Yi({reverse_:function(e,t){var n={x:qi(e,"x","reverse")},r={dims:t};return Mi.runKernel(Tr,n,r)}});var Cd=Yi({reverse1d_:function(e){var t=qi(e,"x","reverse");return fe(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),Td(t,0)}});var Ed=Yi({reverse2d_:function(e,t){var n=qi(e,"x","reverse");return fe(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),Td(n,t)}});var _d=Yi({reverse3d_:function(e,t){var n=qi(e,"x","reverse");return fe(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),Td(n,t)}});var Ad=Yi({reverse4d_:function(e,t){var n=qi(e,"x","reverse");return fe(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),Td(n,t)}});var Rd=Yi({round_:function(e){var t={x:qi(e,"x","round")};return Mi.runKernel(Cr,t)}});var Fd=Yi({rsqrt_:function(e){var t={x:qi(e,"x","rsqrt","float32")};return Mi.runKernel(Er,t)}});var Dd=Yi({selu_:function(e){var t={x:qi(e,"x","selu")};return Mi.runKernel(Fr,t)}});var Zd=Yi({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=qi(e,"x","separableConv2d"),u=qi(t,"depthwiseFilter","separableConv2d"),c=qi(n,"pointwiseFilter","separableConv2d"),l=s,p=!1;if(3===s.rank&&(p=!0,l=jc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");fe(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),fe(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")})),fe(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")})),fe(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")})),fe(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")}));var d=u.shape[2],f=u.shape[3];fe(c.shape[2]===d*f,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(d*f,", but got ").concat(c.shape[2],".")}));var h=Cl(l,u,r,a,o,i),m=hl(h,c,1,"valid",o);return p?jc(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});function Od(){return Od=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,f;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=qi(t,"x","setdiff1d"),a=qi(n,"y","setdiff1d"),fe(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),fe(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),fe(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new pi([u],r.dtype),p=new pi([u],"int32"),d=0,f=0;d<i.length;d++)s.has(i[d])||(l.values[f]=i[d],p.values[f]=d,f++);return e.abrupt("return",[l.toTensor(),p.toTensor()]);case 14:case"end":return e.stop()}}),e)}))),Od.apply(this,arguments)}var Md=function(e,t){return Od.apply(this,arguments)};var zd=Yi({sign_:function(e){var t={x:qi(e,"x","sign")};return Mi.runKernel(Mr,t)}});var Ld=Yi({sin_:function(e){var t={x:qi(e,"x","sin","float32")};return Mi.runKernel(Zr,t)}});var Pd=Yi({sinh_:function(e){var t={x:qi(e,"x","sinh")};return Mi.runKernel(Or,t)}});var Bd=Yi({slice1d_:function(e,t,n){var r=qi(e,"x","slice1d");return fe(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Yc(r,[t],[n])}});var Wd=Yi({slice2d_:function(e,t,n){var r=qi(e,"x","slice2d");return fe(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Yc(r,t,n)}});var Vd=Yi({slice3d_:function(e,t,n){var r=qi(e,"x","slice3d");return fe(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Yc(r,t,n)}});var Ud=Yi({slice4d_:function(e,t,n){var r=qi(e,"x","slice4d");return fe(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Yc(r,t,n)}});var Gd=Yi({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=qi(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return Mi.runKernel(Ur,r,a)}});var jd=Yi({fft_:function(e){fe("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Mi.runKernel(fn,t)}});var Hd=Yi({ifft_:function(e){fe("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Mi.runKernel(In,t)}});var qd=Yi({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=jc(e,[r,n]);t=Hd(a)}else{var i=[r,2*(n-1)],o=jc(uu(e),[r,n]),s=jc(ou(e),[r,n]),u=Td(Yc(o,[0,1],[r,n-2]),1),c=mc(Td(Yc(s,[0,1],[r,n-2]),1),Xl(-1)),l=Kc([o,u],1),p=Kc([s,c],1),d=jc(Qi(l,p),[i[0],i[1]]);t=Hd(d)}if(t=uu(t),3===e.rank&&0!==e.shape[0]){var f=t,h=e.shape[0];t=jc(t,[h,t.shape[0]/h,t.shape[1]]),f.dispose()}return t}});var Kd=Yi({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:qi(e,"x","split")},a={numOrSizeSplits:t,axis:n};return Mi.runKernel(Vr,r,a)}});var Xd=Yi({rfft_:function(e,t){fe("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Yc(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Kc([e,Hp(s)],e.shape.length-1),r=t}else n=e;var u=Fl(n),c=jc(Qi(n,u),[a,r]),l=jd(c),p=Math.floor(r/2)+1,d=uu(l),f=ou(l),h=Kd(d,[p,r-p],d.shape.length-1),m=Kd(f,[p,r-p],f.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=p,jc(Qi(h[0],m[0]),v)}});var Yd=Yi({squaredDifference_:function(e,t){var n,r,a=qi(e,"a","squaredDifference"),i=qi(t,"b","squaredDifference");n=Ti(a,i),a=(r=(0,m.Z)(n,2))[0],i=r[1],hu(a.shape,i.shape);var o={a:a,b:i};return Mi.runKernel(Xr,o,{})}});var Qd=Yi({squeeze_:function(e,t){var n=qi(e,"x","squeeze","string_or_numeric");return jc(n,Ee(n.shape,t).newShape)}});var Jd=Yi({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ki(e,"tensors","stack","string_or_numeric");fe(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&fe(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Mi.runKernel(lr,r,a)}});var $d=Yi({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:qi(e,"x","step")},r={alpha:t};return Mi.runKernel(fa,n,r)}});var ef=Yi({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:qi(e,"x","stridedSlice","string_or_numeric")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Mi.runKernel(Qr,c,l)}});var tf=Yi({tan_:function(e){var t={x:qi(e,"x","tan","float32")};return Mi.runKernel(na,t)}});function nf(e,t){me(e);var n=Gi(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ji(e,null,n,t)}function rf(e,t,n){if(me(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Gi(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ji(e,t,r,n)}function af(e,t,n){if(me(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Gi(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Ji(e,t,r,n)}function of(e,t,n){if(me(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Gi(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Ji(e,t,r,n)}function sf(e,t,n){if(me(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Gi(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Ji(e,t=t||r,r,n)}var uf=Yi({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=qi(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ").concat(t));var i={x:r},o={k:t,sorted:n},s=Mi.runKernel(ia,i,o),u=(0,m.Z)(s,2),c=u[0],l=u[1];return{values:c,indices:l}}});var cf=Yi({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new md(t,n,r,!0,a),o=us(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var lf=Yi({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=qi(e,"x","unique","string_or_numeric");fe(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=Mi.runKernel(ua,r,a),o=(0,m.Z)(i,2),s=o[0],u=o[1];return{values:s,indices:u}}});var pf=Yi({unsortedSegmentSum_:function(e,t,n){var r=qi(e,"x","unsortedSegmentSum"),a=qi(t,"segmentIds","unsortedSegmentSum","int32");fe(xe(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return Mi.runKernel(la,i,o)}});var df=Yi({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=qi(e,"x","unstack","string_or_numeric");fe(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Mi.runKernel(ca,r,a)}});function ff(e,t){return Pp(e,t,"right")}function hf(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Mi.makeVariable(e,t,n,r)}function mf(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=us(e,"int32"),i=us([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}function vf(){return vf=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=qi(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=mf(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}}),e)}))),vf.apply(this,arguments)}var gf=function(e){return vf.apply(this,arguments)};function yf(){return yf=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,f,h,m,g;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=qi(t,"tensor","boolMask"),i=qi(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,fe(s>0,(function(){return"mask cannot be scalar"})),he(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return p=u.slice(0,o).concat([c],u.slice(o+s)),d=jc(a,p),f=jc(i,[-1]),e.next=9,gf(f);case 9:return h=e.sent,m=Qd(h,[1]),g=cp(d,m,o),e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),m.dispose(),d.dispose(),f.dispose(),h.dispose(),g));case 13:case"end":return e.stop()}}),e)}))),yf.apply(this,arguments)}var bf=function(e,t,n){return yf.apply(this,arguments)};var xf=Yi({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=qi(e,"v","movingAverage"),o=qi(t,"x","movingAverage"),s=qi(n,"decay","movingAverage");Ci(i,o),fe(be(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=Xl(1),c=Rp(u,s),l=mc(Rp(o,i),c);if(a){fe(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var p=qi(r,"step","movingAverage");l=hc(l,Rp(u,Kl(s,p)))}return dc(i,l)}});var kf=Yi({scatterND_:function(e,t,n){var r=qi(e,"indices","scatterND","int32"),a=qi(t,"updates","scatterND");_u(a,r,n);var i={indices:r,updates:a},o={shape:n};return Mi.runKernel(_r,i,o)}});function wf(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}var Sf=Yi({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=qi(e,"sparseIndices","sparseToDense","int32"),i=qi(t,"sparseValues","sparseToDense","string_or_numeric"),o=qi(r,"defaultValue","sparseToDense",i.dtype);wf(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:n};return Mi.runKernel(Kr,s,u)}});var If=Yi({gatherND_:function(e,t){var n=qi(t,"indices","gatherND","int32"),r={params:qi(e,"x","gatherND","string_or_numeric"),indices:n};return Mi.runKernel(xn,r)}});var Nf=Yi({dropout_:function(e,t,n,r){var a=qi(e,"x","dropout");if(fe("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(a.dtype," tensor instead.")})),fe(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof hi?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(be(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=hc(up(dc(kd(i,0,1,"float32",r),o)),o);return mc(a,s)}});function Tf(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Cf(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return nf(a,"float32")}function Ef(){return Ef=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,f,h,m,g,y,b=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=b.length>2&&void 0!==b[2]?b[2]:1,a=qi(t,"predictions","inTopK"),i=qi(n,"targets","inTopK"),fe(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got ".concat(a.rank)})),fe(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank ".concat(a.rank," and targets rank ").concat(i.rank)})),he(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],fe(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension (".concat(o,"), but got ").concat(r)})),e.next=7,a.data();case 7:return s=e.sent,e.next=10,i.data();case 10:u=e.sent,c=s.length/o,l=o,p=_e("bool",c),d=0;case 15:if(!(d<c)){e.next=30;break}for(f=d*l,h=s.subarray(f,f+l),m=[],g=0;g<h.length;g++)m.push({value:h[g],index:g});m.sort((function(e,t){return t.value-e.value})),p[d]=0,y=0;case 20:if(!(y<r)){e.next=27;break}if(m[y].index!==u[d]){e.next=24;break}return p[d]=1,e.abrupt("break",27);case 24:y++,e.next=20;break;case 27:d++,e.next=15;break;case 30:return e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),$i(p,i.shape,"bool")));case 31:case"end":return e.stop()}}),e)}))),Ef.apply(this,arguments)}var _f=function(e,t){return Ef.apply(this,arguments)},Af={};D(Af,{conv2d:function(){return Mf},depthwiseConv2d:function(){return Pf},matMul:function(){return Bf}});var Rf=Yi({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=jc(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=jc(t,[1,t.shape[0],t.shape[1],t.shape[2]])),fe(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(s.shape,".")})),fe(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(u.shape,".")})),fe(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];fe(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")})),fe(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")})),Gc("conv2dDerFilter",a,o);var p={x:s,dy:u},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return Mi.runKernel(Lt,p,d)}});function Ff(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return mc(e,$d(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function Df(e,t){var n=t,r=fu(e.shape,t.shape);return r.length>0&&(n=Jl(n,r)),jc(n,e.shape)}function Zf(e,t,n,r){if("linear"===t)return e;if("relu"===t)return Id(e);if("elu"===t)return Ml(e);if("relu6"===t)return Nd(e);if("prelu"===t)return pd(e,n);if("leakyrelu"===t)return mp(e,r);if("sigmoid"===t)return Xc(e);throw new Error("Unknown fused activation ".concat(t,"."))}var Of=function(e,t){return!(e>0)||"linear"===t};var Mf=Yi({fusedConv2d_:function(e){var t,n,r=e.x,a=e.filter,i=e.strides,o=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,p=e.dimRoundingMode,d=e.bias,f=e.activation,h=void 0===f?"linear":f,v=e.preluActivationWeights,g=e.leakyreluAlpha;if(h=h||"linear",!1===Of(Mi.state.gradientDepth,h)){fe("NHWC"===u,(function(){return"Error in fused conv2d: got dataFormat of ".concat(u," but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.")}));var y=hl(r,a,i,o,u,l,p);return null!=d&&(y=dc(y,d)),Zf(y,h,v,g)}var b=qi(r,"x","conv2d","float32"),x=qi(a,"filter","conv2d","float32"),k=b,w=!1;3===b.rank&&(w=!0,k=jc(b,[1,b.shape[0],b.shape[1],b.shape[2]])),fe(4===k.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank ".concat(k.rank,".")})),fe(4===x.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank ".concat(x.rank,".")})),Gc("fused conv2d",o,p);var S="NHWC"===u?k.shape[3]:k.shape[1];fe(x.shape[2]===S,(function(){return"Error in conv2d: depth of input (".concat(S,") must match input depth for filter ").concat(x.shape[2],".")})),fe(Vc(i,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(l,"'")}));var I,N,T=Fc(k.shape,x.shape,i,l,o,p);if(null!=d&&(t=Ti(I=qi(d,"bias","fused conv2d"),b),n=(0,m.Z)(t,1),I=n[0],"NHWC"===u?hu(T.outShape,I.shape):(fe(I.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-".concat(I.shape.length,".")})),fe(0===I.shape.length||I.shape[0]===T.outChannels||1===I.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(I.shape,") is not compatible with the number of output channels (").concat(T.outChannels,")")})))),null!=v){if(fe((y=v.shape).length<=1||3===y.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-".concat(y.length,".")})),1===y.length)fe(1===y[0]||y[0]===T.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights (".concat(y,") is not compatible with the number of output channels (").concat(T.outChannels,").")}));else if(3===y.length)try{hu(y,T.outShape)}catch(R){var C="Error in fused conv2d: PReLU activation weights (".concat(y,") is not compatible with the output shape of the conv2d (").concat(T.outShape,").");throw Error(C)}N=qi(v,"prelu weights","fused conv2d")}var E=function(e,t){fe("NHWC"===u,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(u," but only NHWC is currently supported.")}));var n=(0,m.Z)(t,4),r=n[0],a=n[1],s=n[2],c=n[3],p=Ff(e,s,h);fe(Wc(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(l,"'")}));var d=[vl(a.shape,p,r,i,o),Rf(a,p,r.shape,i,o)];if(null!=c){var f=Df(c,p);d.push(f)}return d},_={x:k,filter:x,bias:I,preluActivationWeights:N},A={strides:i,pad:o,dataFormat:u,dilations:l,dimRoundingMode:p,activation:h,leakyreluAlpha:g};return null==d?Cp((function(e,t,n){var r=Mi.runKernel(ga,_,A);return n([t,e,r]),w&&(r=jc(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:E}}))(k,x):Cp((function(e,t,n,r){var a=Mi.runKernel(ga,_,A);return r([t,e,a,n]),w&&(a=jc(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:E}}))(k,x,I)}});var zf=Yi({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=jc(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=jc(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return Mi.runKernel(Qt,c,l)}});var Lf=Yi({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=jc(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},p=Mi.runKernel(Jt,c,l);return u?jc(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var Pf=Yi({fusedDepthwiseConv2d_:function(e){var t,n,r=e.x,a=e.filter,i=e.strides,o=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,p=e.dimRoundingMode,d=e.bias,f=e.activation,h=void 0===f?"linear":f,v=e.preluActivationWeights,g=e.leakyreluAlpha;if(!1===Of(Mi.state.gradientDepth,h)){var y=Cl(r,a,i,o,u,l,p);return null!=d&&(y=dc(y,d)),Zf(y,h,v,g)}var b=qi(r,"x","depthwiseConv2d","float32"),x=qi(a,"filter","depthwiseConv2d","float32"),k=b,w=!1;3===b.rank&&(w=!0,k=jc(b,[1,b.shape[0],b.shape[1],b.shape[2]])),fe(4===k.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(k.rank,".")})),fe(4===x.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(x.rank,".")})),fe(k.shape[3]===x.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(k.shape[3],") must match the inChannels dimension in filter ").concat(x.shape[2],".")})),null==l&&(l=[1,1]),fe(Vc(i,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(l,"'")})),Gc("fused depthwiseConv2d",o,p);var S,I,N=Fc(k.shape,x.shape,i,l,o,p,!0);null!=d&&(t=Ti(S=qi(d,"bias","fused conv2d"),b),n=(0,m.Z)(t,1),S=n[0],hu(N.outShape,S.shape)),null!=v&&(I=qi(v,"prelu weights","fused depthwiseConv2d"));var T=function(e,t){fe(Wc(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(l,"'")}));var n=(0,m.Z)(t,4),r=n[0],a=n[1],s=n[2],u=n[3],c=Ff(e,s,h),d=Lf(a.shape,c,r,i,o,l,p),f=zf(a,c,r.shape,i,o,l,p);return null!=u?[d,f,Df(S,c)]:[d,f]},C={x:k,filter:x,bias:S,preluActivationWeights:I},E={strides:i,pad:o,dataFormat:u,dilations:l,dimRoundingMode:p,activation:h,leakyreluAlpha:g};return null==d?Cp((function(e,t,n){var r=Mi.runKernel(ya,C,E);return n([t,e,r]),w&&(r=jc(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:T}}))(k,x):Cp((function(e,t,n,r){var a=Mi.runKernel(ya,C,E);return r([t,e,a,n]),w&&(a=jc(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:T}}))(k,x,S)}});var Bf=Yi({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,p=e.preluActivationWeights,d=e.leakyreluAlpha,f=void 0===d?.2:d;if(!1===Of(Mi.state.gradientDepth,l)){var h=zs(n,r,i,s);return null!=u&&(h=dc(h,u)),Zf(h,l,p,f)}var v=qi(n,"a","fused matMul"),g=qi(r,"b","fused matMul"),y=Ti(v,g),b=(0,m.Z)(y,2);v=b[0],g=b[1];var x=i?v.shape[v.rank-2]:v.shape[v.rank-1],k=s?g.shape[g.rank-1]:g.shape[g.rank-2],w=i?v.shape[v.rank-1]:v.shape[v.rank-2],S=s?g.shape[g.rank-2]:g.shape[g.rank-1],I=v.shape.slice(0,-2),N=g.shape.slice(0,-2),T=ge(I),C=ge(N);fe(x===k,(function(){return"Error in fused matMul: inner shapes (".concat(x,") and (").concat(k,") of Tensors with shapes ").concat(v.shape," and ").concat(g.shape," and transposeA=").concat(i," and transposeB=").concat(s," must match.")}));var E,_,A=hu(v.shape.slice(0,-2),g.shape.slice(0,-2)).concat([w,S]),R=jc(v,i?[T,x,w]:[T,w,x]),F=jc(g,s?[C,S,k]:[C,k,S]);null!=u&&(t=Ti(E=qi(u,"bias","fused matMul"),v),E=(0,m.Z)(t,1)[0],hu(A,E.shape)),null!=p&&(_=qi(p,"prelu weights","fused matMul"));var D=function(e,t){var n,r,a=(0,m.Z)(t,4),o=a[0],c=a[1],p=a[2],d=a[3],f=Ff(jc(e,p.shape),p,l);return i||s?!i&&s?(n=zs(f,c,!1,!1),r=zs(f,o,!0,!1)):i&&!s?(n=zs(c,f,!1,!0),r=zs(o,f,!1,!1)):(n=zs(c,f,!0,!0),r=zs(f,o,!0,!0)):(n=zs(f,c,!1,!0),r=zs(o,f,!0,!1)),null!=u?[n,r,Df(d,f)]:[n,r]},Z={a:R,b:F,bias:E,preluActivationWeights:_},O={transposeA:i,transposeB:s,activation:l,leakyreluAlpha:f};return null==u?Cp((function(e,t,n){var r=Mi.runKernel(va,Z,O);return n([e,t,r]),{value:jc(r,A),gradFunc:D}}))(R,F):Cp((function(e,t,n,r){var a=Mi.runKernel(va,Z,O);return r([e,t,a,n]),{value:jc(a,A),gradFunc:D}}))(R,F,E)}});var Wf=Yi({hammingWindow_:function(e){return Cf(e,.54,.46)}});var Vf=Yi({hannWindow_:function(e){return Cf(e,.5,.5)}});var Uf=Yi({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Yc(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Kc([Yc(e,i,t-s),sp([s],a)]);o.push(u),i+=n}return 0===o.length?rf([],[0,t]):jc(Kc(o),[o.length,t])}});var Gf=Yi({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Vf;null==r&&(r=Tf(t));var i=Uf(e,t,n),o=mc(i,a(t));return Xd(o,r)}});var jf=Yi({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=qi(e,"image","cropAndResize"),s=qi(t,"boxes","cropAndResize","float32"),u=qi(n,"boxInd","cropAndResize","int32"),c=s.shape[0];fe(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")})),fe(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")})),fe(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")})),fe(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),fe(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),fe("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},p={method:a,extrapolationValue:i,cropSize:r};return Mi.runKernel(qt,l,p)}});var Hf=Yi({flipLeftRight_:function(e){var t=qi(e,"image","flipLeftRight","float32");fe(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")}));var n={image:t};return Mi.runKernel(mn,n,{})}});var qf=Yi({grayscaleToRGB_:function(e){var t=qi(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];fe(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, but got rank ".concat(t.rank,".")})),fe(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,ip(t,a)}});var Kf=Yi({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=qi(e,"image","rotateWithOffset","float32");fe(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return Mi.runKernel(ma,i,o)}});function Xf(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),fe(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),fe(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),fe(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),fe(1===t.rank,(function(){return"scores must be a 1D tensor"})),fe(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ").concat(t.shape[0])})),fe(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Yf=Yi({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=qi(e,"boxes","nonMaxSuppression","float32"),o=qi(t,"scores","nonMaxSuppression","float32"),s=Xf(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return Mi.runKernel(ir,{boxes:i,scores:o},u)}});function Qf(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||Jf)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Jf(e,t){return e>t?1:e<t?-1:0}function $f(e,t,n,r,a){return nh(e,t,n,r,a,0)}function eh(e,t,n,r,a,i){return nh(e,t,n,r,a,0,!1,i,!0)}function th(e,t,n,r,a,i){return nh(e,t,n,r,a,i,!0)}function nh(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(ih);for(var p=i>0?-.5/i:0,d=[],f=[];d.length<n&&c.length>0;){var m=c.pop(),v=m.score,g=m.boxIndex,y=m.suppressBeginIndex;if(v<a)break;for(var b=!1,x=d.length-1;x>=y;--x){var k=rh(e,g,d[x]);if(k>=r){b=!0;break}if(m.score=m.score*ah(r,p,k),m.score<=a)break}m.suppressBeginIndex=d.length,b||(m.score===v?(d.push(g),f.push(m.score)):m.score>a&&Qf(c,m,ih))}var w=d.length,S=n-w;s&&S>0&&(d.push.apply(d,(0,h.Z)(new Array(S).fill(0))),f.push.apply(f,(0,h.Z)(new Array(S).fill(0))));var I={selectedIndices:d};return o&&(I.selectedScores=f),u&&(I.validOutputs=w),I}function rh(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),f=(s-i)*(u-o),h=(p-c)*(d-l);if(f<=0||h<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,p),y=Math.min(u,d),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(f+h-b)}function ah(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function ih(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function oh(){return oh=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,f,h=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>3&&void 0!==h[3]?h[3]:.5,i=h.length>4&&void 0!==h[4]?h[4]:Number.NEGATIVE_INFINITY,o=qi(t,"boxes","nonMaxSuppressionAsync"),s=qi(n,"scores","nonMaxSuppressionAsync"),u=Xf(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=c[0],p=c[1],d=$f(l,p,r,a,i),f=d.selectedIndices,e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),nf(f,"int32")));case 12:case"end":return e.stop()}}),e)}))),oh.apply(this,arguments)}var sh=function(e,t,n){return oh.apply(this,arguments)};var uh=Yi({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=qi(e,"boxes","nonMaxSuppression"),s=qi(t,"scores","nonMaxSuppression"),u=Xf(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},p=Mi.runKernel(sr,c,l);return{selectedIndices:p[0],selectedScores:p[1]}}});function ch(){return ch=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,f,h,m,g=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>3&&void 0!==g[3]?g[3]:.5,i=g.length>4&&void 0!==g[4]?g[4]:Number.NEGATIVE_INFINITY,o=g.length>5&&void 0!==g[5]?g[5]:0,s=qi(t,"boxes","nonMaxSuppressionAsync"),u=qi(n,"scores","nonMaxSuppressionAsync"),c=Xf(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,p=l[0],d=l[1],f=th(p,d,r,a,i,o),h=f.selectedIndices,m=f.selectedScores,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:nf(h,"int32"),selectedScores:nf(m)}));case 14:case"end":return e.stop()}}),e)}))),ch.apply(this,arguments)}var lh=function(e,t,n){return ch.apply(this,arguments)};var ph=Yi({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=qi(e,"boxes","nonMaxSuppression"),s=qi(t,"scores","nonMaxSuppression"),u=Xf(o,s,n,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,p=u.scoreThreshold,d={boxes:o,scores:s},f={maxOutputSize:c,iouThreshold:l,scoreThreshold:p,padToMaxOutputSize:i},h=Mi.runKernel(or,d,f);return{selectedIndices:h[0],validOutputs:h[1]}}});function dh(){return dh=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,f,h,g,y,b,x,k,w=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=w.length>3&&void 0!==w[3]?w[3]:.5,i=w.length>4&&void 0!==w[4]?w[4]:Number.NEGATIVE_INFINITY,o=w.length>5&&void 0!==w[5]&&w[5],s=qi(t,"boxes","nonMaxSuppressionAsync"),u=qi(n,"scores","nonMaxSuppressionAsync"),c=Xf(s,u,r,a,i,null),l=c.maxOutputSize,p=c.iouThreshold,d=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return f=e.sent,h=(0,m.Z)(f,2),g=h[0],y=h[1],b=eh(g,y,l,p,d,o),x=b.selectedIndices,k=b.validOutputs,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:nf(x,"int32"),validOutputs:Xl(k,"int32")}));case 19:case"end":return e.stop()}}),e)}))),dh.apply(this,arguments)}var fh=function(e,t,n){return dh.apply(this,arguments)};var hh=Yi({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=qi(e,"images","resizeBilinear");fe(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),fe(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape ".concat(t,".")})),fe(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=jc(a,[1,a.shape[0],a.shape[1],a.shape[2]])),(0,p.Z)(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Mi.runKernel(Sr,s,u);return o?jc(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var mh=Yi({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=qi(e,"images","resizeNearestNeighbor");fe(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),fe(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(t,".")})),fe("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),fe(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=jc(a,[1,a.shape[0],a.shape[1],a.shape[2]])),(0,p.Z)(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Mi.runKernel(kr,s,u);return o?jc(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});function vh(e,t){for(var n,r,a,i,o,s,u=nf([-1]),c=nf([0]),l=nf([0]),p=0;p<e.size-1;p++){n=Yc(e,0,p+1),r=Yc(e,p+1),o=hc(Jl(n),t),s=hc(Jl(r),t);var d=Jl(mc(n,wd(0,n.size)));a=hc(d,Jl(n));var f=sp(r.shape,n.size),h=dc(wd(0,r.size),f),m=mc(r,h);i=hc(Jl(m),Jl(r));var v=Rp(a,i),g=Rp(a,i),y=mc(o,s);l=mc(mc(y,v),g);var b=lp(l,c);c=Rl(b,l,c),u=Rl(b,nf([p]),u)}return u}var gh=Yi({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=qi(e,"image","threshold"),c=.2989,l=.587,p=.114,d=u.shape[0]*u.shape[1],f=mc(nf([s]),255);if(fe(3===u.rank,(function(){return"Error in threshold: image must be rank 3,but got rank ".concat(u.rank,".")})),fe(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1but got ".concat(u.shape[2],".")})),fe("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,but got dtype ".concat(u.dtype,".")})),fe("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var h=Kd(u,[1,1,1],-1),v=(0,m.Z)(h,3);t=v[0],n=v[1],r=v[2];var g=mc(t,c),y=mc(n,l),b=mc(r,p);a=dc(dc(g,y),b)}else a=e;if("otsu"===i){var x=il(cs(Rd(a),"int32"),$i([]),256);f=vh(x,d)}var k=o?gp(a,f):lp(a,f);return cs(mc(k,255),"int32")}});var yh=Yi({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=qi(e,"image","transform","float32"),s=qi(t,"transforms","transform","float32");fe(4===o.rank,(function(){return"Error in transform: image must be rank 4,but got rank ".concat(o.rank,".")})),fe(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),fe(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return Mi.runKernel(oa,u,c)}});var bh=Yi({bandPart_:function(e,t,n){fe(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),fe(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=qi(e,"a","bandPart");fe(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=r.shape.slice(-2),o=(0,m.Z)(i,2),s=o[0],u=o[1];if(!(t<=s))throw new Error("bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(s,")."));if(!(n<=u))throw new Error("bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(u,")."));t<0&&(t=s),n<0&&(n=u);var c=jc(wd(0,s,1,"int32"),[-1,1]),l=wd(0,u,1,"int32"),p=Rp(c,l),d=Zp(gp(p,Xl(+t,"int32")),pp(p,Xl(-n,"int32"))),f=Hp([s,u],r.dtype);return jc(Jd(df(jc(r,[-1,s,u])).map((function(e){return Rl(d,e,f)}))),a)}});var xh=Yi({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,fe(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){fe(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=Kd(e,e.shape[0],0).map((function(e){return Qd(e,[0])}))),fe(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(Mi.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=mc(Jl(mc(n[a],t)),n[a]);t=Rp(t,i)}return hc(t,ep(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?Jd(n,0):n}});function kh(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Mi.tidy((function(){fe(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=op(n),i=ls(e),o=rf([[1]],[1,1]),s=ls(o),u=n>=r?r:n,c=function(e){var t,u,c=i,l=s,p=a;t=Mi.tidy((function(){var t=Yc(i,[e,e],[n-e,1]),u=ep(t),c=Yc(i,[e,e],[1,1]),l=Rl(lp(c,0),rf([[-1]]),rf([[1]])),p=Rp(c,mc(l,u)),d=hc(t,p);s=1===d.shape[0]?ls(o):Kc([o,Yc(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);var f=su(hc(zs(l,p),u)),h=Yc(i,[e,0],[n-e,r]),m=mc(f,s),v=cu(s);if(0===e)i=Rp(h,zs(m,zs(v,h)));else{var g=Rp(h,zs(m,zs(v,h)));i=Kc([Yc(i,[0,0],[e,r]),g],0)}var y=cu(m),b=Yc(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Rp(b,zs(zs(b,s),y));else{var x=Rp(b,zs(zs(b,s),y));a=Kc([Yc(a,[0,0],[n,e]),x],1)}return[s,i,a]})),u=(0,m.Z)(t,3),s=u[0],i=u[1],a=u[2],Ks([c,l,p])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=Yc(a,[0,0],[n,r]),i=Yc(i,[0,0],[r,r])),[a,i]}))}var wh,Sh=Yi({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(fe(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return kh(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=df(jc(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((function(e){var n=kh(e,t),r=(0,m.Z)(n,2),o=r[0],s=r[1];a.push(o),i.push(s)}));var o=jc(Jd(a,0),e.shape),s=jc(Jd(i,0),e.shape);return[o,s]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(wh||(wh={}));var Ih=Yi({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:wh.SUM_BY_NONZERO_WEIGHTS,r=qi(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=qi(t,"weights","computeWeightedLoss"));var i=null==a?r:mc(r,a);if(n===wh.NONE)return i;if(n===wh.SUM)return Jl(i);if(n===wh.MEAN){if(null==a)return jp(i);var o=r.size/a.size,s=hc(Jl(i),Jl(a));return o>1?hc(s,Xl(o)):s}if(n===wh.SUM_BY_NONZERO_WEIGHTS){if(null==a)return hc(Jl(i),Xl(r.size));var u=mc(a,qp(r.shape)),c=cs(Jl(td(u,Xl(0))),"float32");return hc(Jl(i),c)}throw Error("Unknown reduction: ".concat(n))}});var Nh=Yi({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wh.SUM_BY_NONZERO_WEIGHTS,a=qi(e,"labels","absoluteDifference"),i=qi(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=qi(n,"weights","absoluteDifference")),he(a.shape,i.shape,"Error in absoluteDifference: ");var s=vc(Rp(a,i));return Ih(s,o,r)}});var Th=Yi({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:wh.SUM_BY_NONZERO_WEIGHTS,i=qi(e,"labels","cosineDistance"),o=qi(t,"predictions","cosineDistance"),s=null;null!=r&&(s=qi(r,"weights","cosineDistance")),he(i.shape,o.shape,"Error in cosineDistance: ");var u=Xl(1),c=Rp(u,Jl(mc(i,o),n,!0));return Ih(c,s,a)}});var Ch=Yi({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wh.SUM_BY_NONZERO_WEIGHTS,a=qi(e,"labels","hingeLoss"),i=qi(t,"predictions","hingeLoss"),o=null;null!=n&&(o=qi(n,"weights","hingeLoss")),he(a.shape,i.shape,"Error in hingeLoss: ");var s=Xl(1);a=Rp(mc(Xl(2),a),s);var u=Id(Rp(s,mc(a,i)));return Ih(u,o,r)}});var Eh=Yi({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:wh.SUM_BY_NONZERO_WEIGHTS,i=qi(e,"labels","huberLoss"),o=qi(t,"predictions","huberLoss"),s=null;null!=n&&(s=qi(n,"weights","huberLoss")),he(i.shape,o.shape,"Error in huberLoss: ");var u=Xl(r),c=vc(Rp(o,i)),l=Xp(c,u),p=Rp(c,l),d=dc(mc(Xl(.5),Ql(l)),mc(u,p));return Ih(d,s,a)}});var _h=Yi({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:wh.SUM_BY_NONZERO_WEIGHTS,i=qi(e,"labels","logLoss"),o=qi(t,"predictions","logLoss"),s=null;null!=n&&(s=qi(n,"weights","logLoss")),he(i.shape,o.shape,"Error in logLoss: ");var u=Xl(1),c=Xl(r),l=su(mc(i,xp(dc(o,c)))),p=mc(Rp(u,i),xp(dc(Rp(u,o),c))),d=Rp(l,p);return Ih(d,s,a)}});var Ah=Yi({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wh.SUM_BY_NONZERO_WEIGHTS,a=qi(e,"labels","meanSquaredError"),i=qi(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=qi(n,"weights","meanSquaredError")),he(a.shape,i.shape,"Error in meanSquaredError: ");var s=Yd(a,i);return Ih(s,o,r)}});function Rh(e,t){var n=qi(e,"labels","sigmoidCrossEntropyWithLogits"),r=qi(t,"logits","sigmoidCrossEntropyWithLogits");he(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Id(r),i=mc(r,n),o=kp(np(su(vc(r))));return dc(Rp(a,i),o)}var Fh=Yi({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:wh.SUM_BY_NONZERO_WEIGHTS,i=qi(e,"multiClassLabels","sigmoidCrossEntropy"),o=qi(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=qi(n,"weights","sigmoidCrossEntropy")),he(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Xl(r),c=Xl(1),l=Xl(.5);i=dc(mc(i,Rp(c,u)),mc(l,u))}var p=Rh(i,o);return Ih(p,s,a)}});function Dh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ").concat(n));return Cp((function(e,t,r){var a=Dp(t,[n],!0),i=Rp(cs(t,"float32"),a);r([e,i]);var o=su(mc(i,e));return{value:Jl(o,[n]),gradFunc:function(e,t){var r=(0,m.Z)(t,2),a=r[0],i=r[1],o=Wl(e.shape,[n]);return[mc(jc(e,o),Rp(cs(a,"float32"),np(i))),mc(jc(e,o),Rp(np(i),cs(a,"float32")))]}}}))(e,t)}var Zh=Yi({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:wh.SUM_BY_NONZERO_WEIGHTS,i=qi(e,"onehotLabels","softmaxCrossEntropy"),o=qi(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=qi(n,"weights","softmaxCrossEntropy")),he(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Xl(r),c=Xl(1),l=Xl(i.shape[1]);i=dc(mc(i,Rp(c,u)),hc(u,l))}var p=Dh(i,o);return Ih(p,s,a)}});var Oh=Yi({sparseFillEmptyRows_:function(e,t,n,r){var a=qi(e,"indices","sparseFillEmptyRows","int32"),i=qi(t,"values","sparseFillEmptyRows"),o=qi(n,"denseShape","sparseFillEmptyRows","int32"),s=qi(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Mi.runKernel(Gr,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});var Mh=Yi({sparseReshape_:function(e,t,n){var r=qi(e,"inputIndices","sparseReshape","int32"),a=qi(t,"inputShape","sparseReshape","int32"),i=qi(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Mi.runKernel(jr,o);return{outputIndices:s[0],outputShape:s[1]}}});var zh=Yi({sparseSegmentMean_:function(e,t,n){var r=qi(e,"data","sparseSegmentMean"),a=qi(t,"indices","sparseSegmentMean","int32"),i=qi(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Mi.runKernel(Hr,o)}});var Lh=Yi({sparseSegmentSum_:function(e,t,n){var r=qi(e,"data","sparseSegmentSum"),a=qi(t,"indices","sparseSegmentSum","int32"),i=qi(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Mi.runKernel(qr,o)}});var Ph=Yi({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=qi(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=qi(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},p={data:u,dataSplits:c},d=Mi.runKernel(Jr,p,l);return{nGrams:d[0],nGramsSplits:d[1]}}});var Bh=Yi({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=qi(e,"input","stringSplit","string"),a=qi(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=Mi.runKernel($r,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var Wh=Yi({stringToHashBucketFast_:function(e,t){var n=qi(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return Mi.runKernel(ea,a,r)}}),Vh={fft:jd,ifft:Hd,rfft:Xd,irfft:qd},Uh={hammingWindow:Wf,hannWindow:Vf,frame:Uf,stft:Gf},Gh={flipLeftRight:Hf,grayscaleToRGB:qf,resizeNearestNeighbor:mh,resizeBilinear:hh,rotateWithOffset:Kf,cropAndResize:jf,nonMaxSuppression:Yf,nonMaxSuppressionAsync:sh,nonMaxSuppressionWithScore:uh,nonMaxSuppressionWithScoreAsync:lh,nonMaxSuppressionPadded:ph,nonMaxSuppressionPaddedAsync:fh,threshold:gh,transform:yh},jh={bandPart:bh,gramSchmidt:xh,qr:Sh},Hh={absoluteDifference:Nh,computeWeightedLoss:Ih,cosineDistance:Th,hingeLoss:Ch,huberLoss:Eh,logLoss:_h,meanSquaredError:Ah,sigmoidCrossEntropy:Fh,softmaxCrossEntropy:Zh},qh={sparseFillEmptyRows:Oh,sparseReshape:Mh,sparseSegmentMean:zh,sparseSegmentSum:Lh},Kh={stringNGrams:Ph,stringSplit:Bh,stringToHashBucketFast:Wh},Xh=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return Ks(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return Tp(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&Ks(this.iterations_)}},{key:"saveIterations",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Xl(this.iterations_,"int32")}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class ".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Yu);Object.defineProperty(Xh,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Yh=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,y.Z)(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=Mi.backend.epsilon()),a}return(0,b.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mi.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:qs((function(){return Fl(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:qs((function(){return Fl(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;qs((function(){var e=dc(mc(o,t.rho),mc(Ql(i),1-t.rho)),n=mc(hc(Yl(dc(s,t.epsilon)),Yl(dc(o,t.epsilon))),i),r=dc(mc(s,t.rho),mc(Ql(n),1-t.rho));o.assign(e),s.assign(r);var u=dc(mc(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(Ks(this.accumulatedGrads.map((function(e){return e.variable}))),Ks(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,h.Z)(this.accumulatedGrads),(0,h.Z)(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(Xh);Yh.className="Adadelta",Ju(Yh);var Qh=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return(0,y.Z)(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return(0,b.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mi.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:qs((function(){return sp(a.shape,t.initialAccumulatorValue).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;qs((function(){var e=dc(o,Ql(i));o.assign(e);var n=dc(mc(hc(i,Yl(dc(e,Mi.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&Ks(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(Xh);Qh.className="Adagrad",Ju(Qh);var Jh=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,y.Z)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],qs((function(){i.accBeta1=Xl(r).variable(),i.accBeta2=Xl(a).variable()})),null==o&&(i.epsilon=Mi.backend.epsilon()),i}return(0,b.Z)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);qs((function(){var r=Rp(1,t.accBeta1),a=Rp(1,t.accBeta2);n.forEach((function(n,i){var o=Mi.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:qs((function(){return Fl(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:qs((function(){return Fl(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=dc(mc(u,t.beta1),mc(s,1-t.beta1)),p=dc(mc(c,t.beta2),mc(Ql(s),1-t.beta2)),d=hc(l,r),f=hc(p,a);u.assign(l),c.assign(p);var h=dc(mc(hc(d,dc(Yl(f),t.epsilon)),-t.learningRate),o);o.assign(h)}})),t.accBeta1.assign(mc(t.accBeta1,t.beta1)),t.accBeta2.assign(mc(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ks(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Ks(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,h.Z)(this.accumulatedFirstMoment),(0,h.Z)(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,qs((function(){r.accBeta1.assign(Kl(r.beta1,r.iterations_+1)),r.accBeta2.assign(Kl(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(Xh);Jh.className="Adam",Ju(Jh);var $h=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return(0,y.Z)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],qs((function(){i.iteration=Xl(0).variable(),i.accBeta1=Xl(r).variable()})),null==o&&(i.epsilon=Mi.backend.epsilon()),i}return(0,b.Z)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);qs((function(){var r=Rp(1,t.accBeta1),a=hc(-t.learningRate,dc(mc(t.iteration,t.decay),1));n.forEach((function(n,i){var o=Mi.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Fl(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:Fl(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=dc(mc(u,t.beta1),mc(s,1-t.beta1)),p=mc(c,t.beta2),d=vc(s),f=Gp(p,d);u.assign(l),c.assign(f);var h=dc(mc(hc(a,r),hc(l,dc(f,t.epsilon))),o);o.assign(h)}})),t.iteration.assign(dc(t.iteration,1)),t.accBeta1.assign(mc(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ks(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Ks(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(Xh);$h.className="Adamax",Ju($h);var em=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return(0,b.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Mi.registeredVariables[n];qs((function(){var e=dc(mc(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Xs(Xl(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(Xh);em.className="SGD",Ju(em);var tm=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,y.Z)(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=Xl(a.momentum),a}return(0,b.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mi.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:qs((function(){return Fl(a).variable(!1)}))});var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&qs((function(){var e,n=dc(mc(t.m,i),o);e=t.useNesterov?dc(mc(t.c,dc(o,mc(n,t.m))),a):dc(mc(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&Ks(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(em);tm.className="Momentum",Ju(tm);var nm=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,y.Z)(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=Mi.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return(0,l.Z)(r)}return(0,b.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mi.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:qs((function(){return Fl(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:qs((function(){return Fl(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:qs((function(){return Fl(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;qs((function(){var e=dc(mc(s,t.decay),mc(Ql(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=dc(mc(n,t.decay),mc(o,1-t.decay)),c=hc(mc(o,t.learningRate),Yl(Rp(e,dc(Ql(i),t.epsilon)))),l=dc(mc(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var p=Rp(a,l);a.assign(p)}else{var d=dc(mc(s,t.decay),mc(Ql(o),1-t.decay)),f=dc(mc(u,t.momentum),hc(mc(o,t.learningRate),Yl(dc(d,t.epsilon))));s.assign(d),u.assign(f);var h=Rp(a,f);a.assign(h)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&Ks(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Ks(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Ks(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,h.Z)(this.accumulatedMeanSquares),(0,h.Z)(this.accumulatedMoments)),this.centered&&t.push.apply(t,(0,h.Z)(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(Xh);nm.className="RMSProp",Ju(nm);var rm=function(){function e(){(0,y.Z)(this,e)}return(0,b.Z)(e,null,[{key:"sgd",value:function(e){return new em(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new tm(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new nm(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Jh(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Yh(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new $h(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new Qh(e,t)}}]),e}(),am={sgd:rm.sgd,momentum:rm.momentum,adadelta:rm.adadelta,adagrad:rm.adagrad,rmsprop:rm.rmsprop,adamax:rm.adamax,adam:rm.adam},im="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function om(){return new Promise((function(e){return im((function(){return e()}))}))}var sm={};function um(e,t){var n=e[0].length;e.forEach((function(e,t){fe(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),fe(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)fe(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function cm(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}D(sm,{ERF_A1:function(){return km},ERF_A2:function(){return wm},ERF_A3:function(){return Sm},ERF_A4:function(){return Im},ERF_A5:function(){return Nm},ERF_P:function(){return xm},PARALLELIZE_THRESHOLD:function(){return lm},SELU_SCALE:function(){return bm},SELU_SCALEALPHA:function(){return ym},applyActivation:function(){return Zf},assertAndGetBroadcastShape:function(){return hu},assertAxesAreInnerMostDims:function(){return Vl},assertParamsConsistent:function(){return um},assignToTypedArray:function(){return Rm},axesAreInnerMostDims:function(){return Ll},calculateShapes:function(){return Au},checkEinsumDimSizes:function(){return Lm},checkPadOnDimRoundingMode:function(){return Gc},combineLocations:function(){return Pl},complexWithEvenIndex:function(){return Em},complexWithOddIndex:function(){return _m},computeConv2DInfo:function(){return Fc},computeConv3DInfo:function(){return Dc},computeDefaultPad:function(){return Zc},computeDilation2DInfo:function(){return _c},computeOptimalWindowSize:function(){return pm},computeOutAndReduceShapes:function(){return Bl},computeOutShape:function(){return cm},computePool2DInfo:function(){return Ac},computePool3DInfo:function(){return Rc},convertConv2DDataFormat:function(){return Uc},decodeEinsumEquation:function(){return Mm},eitherStridesOrDilationsAreOne:function(){return Vc},expandShapeToKeepDim:function(){return Wl},exponent:function(){return Dm},exponents:function(){return Fm},fromStringArrayToUint8:function(){return ov},fromUint8ToStringArray:function(){return iv},getAxesPermutation:function(){return Ul},getBroadcastDims:function(){return du},getComplexWithIndex:function(){return Am},getEinsumComputePath:function(){return Pm},getEinsumPermutation:function(){return zm},getFusedBiasGradient:function(){return Df},getFusedDyActivation:function(){return Ff},getImageCenter:function(){return dm},getInnerMostAxes:function(){return jl},getPermuted:function(){return hm},getReductionAxes:function(){return fu},getReshaped:function(){return fm},getReshapedPermuted:function(){return mm},getSliceBeginCoords:function(){return vm},getSliceSize:function(){return gm},getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(){return Um},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(){return Gm},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(){return jm},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return Km},getSparseReshapeInputOutputMismatchErrorMessage:function(){return Ym},getSparseReshapeInputOutputMultipleErrorMessage:function(){return Xm},getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(){return Hm},getSparseReshapeNegativeOutputDimErrorMessage:function(){return qm},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(){return ev},getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return Qm},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return Jm},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(){return $m},getUndoAxesPermutation:function(){return Gl},isIdentityPermutation:function(){return Bm},log:function(){return xa},mergeRealAndImagArrays:function(){return Tm},prepareAndValidate:function(){return Tu},prepareSplitSize:function(){return Vm},segment_util:function(){return tv},shouldFuse:function(){return Of},slice_util:function(){return Ru},splitRealAndImagArrays:function(){return Cm},tupleValuesAreOne:function(){return Wc},upcastType:function(){return Ii},validateInput:function(){return _u},validateUpdateShape:function(){return Eu},warn:function(){return ba}});var lm=30;function pm(e){return e<=lm?e:Ve(e,Math.floor(Math.sqrt(e)))}function dm(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function fm(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function hm(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2===1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function mm(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function vm(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function gm(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var ym=1.7580993408473768,bm=1.0507009873554805,xm=.3275911,km=.254829592,wm=-.284496736,Sm=1.421413741,Im=-1.453152027,Nm=1.061405429;function Tm(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Cm(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function Em(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function _m(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function Am(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Rm(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Fm(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function Dm(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var Zm="->",Om=/->/g;function Mm(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(Om,"").length)/Zm.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(Zm,'").'));var r=e.split(Zm),a=(0,m.Z)(r,2),i=a[0],o=a[1];fe(-1===i.indexOf("..."),(function(){return'The ellipsis notation ("'.concat("...",'") is not supported yet.')}));var s=i.split(","),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],l=function(e){var t=o[e];if(!s.some((function(e){return-1!==e.indexOf(t)})))throw new Error("Output subscripts contain the label ".concat(t," not present in the input subscripts."));-1===c.indexOf(t)&&c.push(t)},p=0;p<o.length;++p)l(p);for(var d=0;d<i.length;++d){var f=i[d];-1===c.indexOf(f)&&","!==f&&c.push(f)}for(var h=new Array(s.length),v=0;v<u;++v){if(new Set(s[v].split("")).size!==s[v].length)throw new Error("Found duplicate axes in input component ".concat(s[v],". Support for duplicate axes in input is not implemented yet."));h[v]=[];for(var g=0;g<s[v].length;++g)h[v].push(c.indexOf(s[v][g]))}for(var y=c.length,b=[],x=o.length;x<y;++x)b.push(x);return{allDims:c,summedDims:b,idDims:h}}function zm(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return n=n.filter((function(e){return-1!==e})),{permutationIndices:n,expandDims:a}}function Lm(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:fe(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," of input shaped ").concat(JSON.stringify(a),", but got dimension ").concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function Pm(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=Wm(t,r[s]),l=(0,x.Z)(c);try{for(l.s();!(u=l.n()).done;){var p=u.value;-1===o.indexOf(p)&&(a[s].push(p),o.push(p))}}catch(d){l.e(d)}finally{l.f()}}return{path:r,steps:a}}function Bm(e){return e.every((function(e,t){return e===t}))}function Wm(e,t){for(var n=[],r=0;r<e.length;++r)(0===e[r].length||-1!==e[r].indexOf(t)||-1===t)&&n.push(r);return n}function Vm(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)fe(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);fe(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}fe(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function Um(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function Gm(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function jm(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function Hm(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function qm(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function Km(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Xm(e,t){var n=ge(e),r=ge(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function Ym(e,t){var n=ge(e),r=ge(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function Qm(){return"segment ids must be >= 0"}function Jm(){return"segment ids are not increasing"}function $m(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function ev(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}var tv={};function nv(e,t){var n,r=!1;for(e<=lm?(n=e,r=!0):n=Ve(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Ve(e,n+1);return n}function rv(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function av(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,p=1,d=0;d<r;++d)u.push(e.shape[d]),c*=e.shape[d];for(var f=r;f<n;f++)u.push(e.shape[f]),l*=e.shape[f];for(var h=r;h<a;h++)u.push(t.shape[h]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),p*=e.shape[m];return{batchSize:c,sliceSize:p,outerSize:l,dimSize:s,outputShape:u}}function iv(e){try{return e.map((function(e){return ti(e)}))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(t))}}function ov(e){return e.map((function(e){return ei(e)}))}D(tv,{collectGatherOpShapeInfo:function(){return av},computeOutShape:function(){return rv},segOpComputeOptimalWindowSize:function(){return nv}});var sv={};D(sv,{nonMaxSuppressionV3Impl:function(){return $f},nonMaxSuppressionV4Impl:function(){return eh},nonMaxSuppressionV5Impl:function(){return th},whereImpl:function(){return mf}});var uv={kernelName:ut,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(e,$d(cs(n,"float32"),-1))}}}},cv={kernelName:ct,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){var t=Ql(cs(n,"float32")),r=Yl(Rp(Xl(1),t));return su(hc(e,r))}}}},lv={kernelName:lt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){var t=Yl(Rp(Ql(cs(n,"float32")),1));return hc(e,t)}}}},pv={kernelName:pt,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1],i=hu(r.shape,a.shape);return{a:function(){var t=e,n=fu(r.shape,i);return n.length>0&&(t=Jl(t,n)),jc(t,r.shape)},b:function(){var t=e,n=fu(a.shape,i);return n.length>0&&(t=Jl(t,n)),jc(t,a.shape)}}}},dv={kernelName:dt,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},fv={kernelName:mt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return Fl(n)}}}},hv={kernelName:vt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return Fl(n)}}}},mv={kernelName:gt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return hc(e,Yl(Rp(Xl(1),Ql(cs(n,"float32")))))}}}},vv={kernelName:yt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){var t=Yl(dc(Xl(1),Ql(cs(n,"float32"))));return hc(e,t)}}}},gv={kernelName:kt,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1],i=hu(r.shape,a.shape);return{a:function(){var t=dc(Ql(r),Ql(a)),n=mc(e,hc(a,t)),o=fu(r.shape,i);return o.length>0&&(n=Jl(n,o)),jc(n,r.shape)},b:function(){var t=dc(Ql(r),Ql(a)),n=su(mc(e,hc(r,t))),o=fu(a.shape,i);return o.length>0&&(n=Jl(n,o)),jc(n,a.shape)}}}},yv={kernelName:bt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return hc(e,dc(Ql(cs(n,"float32")),1))}}}},bv={kernelName:xt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return hc(e,Rp(Xl(1),Ql(cs(n,"float32"))))}}}};var xv=Yi({avgPool3dGrad_:function(e,t,n,r,a,i){var o=qi(e,"dy","avgPool3dGrad"),s=qi(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=jc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=jc(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),fe(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank ".concat(u.rank,".")})),fe(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank ".concat(c.rank,".")})),Gc("avgPool3dGrad",a,i);var p={dy:u,input:c},d={filterSize:n,strides:r,pad:a,dimRoundingMode:i},f=Mi.runKernel(Nt,p,d);return l?jc(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),kv={kernelName:It,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return xv(e,r,a,i,o,s)}}}};var wv=Yi({avgPoolGrad_:function(e,t,n,r,a){var i=qi(e,"dy","avgPoolGrad"),o=qi(t,"input","avgPoolGrad");fe(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=jc(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=jc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),fe(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank ".concat(u.rank,".")})),fe(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank ".concat(s.rank,".")}));var l={dy:u,input:s},p={filterSize:n,strides:r,pad:a},d=Mi.runKernel(St,l,p);return c?jc(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),Sv={kernelName:wt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return wv(e,r,a,i,o)}}}},Iv={kernelName:Tt,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return zs(e,i,!1,!1)},b:function(){return zs(e,a,!0,!1)}}:o&&!s?{a:function(){return zs(i,e,!1,!0)},b:function(){return zs(a,e,!1,!1)}}:{a:function(){return zs(i,e,!0,!0)},b:function(){return zs(e,a,!0,!0)}}:{a:function(){return zs(e,i,!1,!0)},b:function(){return zs(a,e,!0,!1)}}}},Nv={kernelName:Ct,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return cd(e,r,a)}}}},Tv={kernelName:_t,gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return Jl(e,u,!0)}}}},Cv={kernelName:Rt,gradFunc:function(e){return{x:function(){return e.clone()}}}},Ev={kernelName:Ft,gradFunc:function(e){return{x:function(){return Fl(e)}}}},_v={kernelName:Dt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return Rl(Zp(pp(r,a),gp(r,i)),e,Fl(e))}}}},Av={kernelName:Ot,inputsToSave:["x"],gradFunc:uv.gradFunc},Rv={kernelName:Mt,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=Ce(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return Kd(e,i,a).map((function(e){return function(){return e}}))}},Fv={kernelName:zt,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return fe(Wc(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return vl(a.shape,e,i,s,u,c)},filter:function(){return Rf(a,e,i.shape,s,u,c)}}}},Dv={kernelName:Pt,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return hl(e,i,o,s,u,1,c)},filter:function(){return Rf(e,a,i.shape,o,s,u,c)}}}};var Zv=Yi({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=jc(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=jc(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),fe(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape ".concat(i.shape,".")})),fe(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape ".concat(o.shape,".")})),fe(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got ".concat(n,".")})),fe(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")})),fe(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return Mi.runKernel(Wt,s,u)}}),Ov={kernelName:Bt,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;fe(Wc(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=(0,m.Z)(t,2),s=o[0],u=o[1];return{x:function(){return bl(s.shape,e,u,a,i)},filter:function(){return Zv(s,e,u.shape,a,i)}}}},Mv={kernelName:Ut,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(su(Ld(cs(n,"float32"))),e)}}}},zv={kernelName:Gt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(Pd(cs(n,"float32")),e)}}}},Lv={kernelName:Ht,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=Ul([a],r.rank),n=Il(e,a,i,!o);return null!=t&&(n=cu(n,t)),n}}}},Pv={kernelName:Yt,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;fe(Wc(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(s,"'")}));var u=(0,m.Z)(t,2),c=u[0],l=u[1];return fe(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(c.rank,".")})),fe(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(l.rank,".")})),fe(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(l.shape[2],".")})),fe(Vc(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(a," and dilations '").concat(s,"'.")})),Gc("depthwiseConv2d",i,o),{x:function(){return Lf(c.shape,e,l,a,i,s,o)},filter:function(){return zf(c,e,l.shape,a,i,s,o)}}}},Bv={kernelName:en,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return Mi.runKernel(tn,o,n)},filter:function(){return Mi.runKernel(nn,s,n)}}}},Wv={kernelName:on,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:(0,m.Z)(t,1)[0]};return{x:function(){return Mi.runKernel(sn,n)}}}},Vv={kernelName:un,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0],r=mc(np(su(Ql(n))),2/Math.sqrt(Math.PI));return{x:function(){return mc(e,r)}}}},Uv={kernelName:ln,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(e,n)}}}},Gv={kernelName:pn,inputsToSave:["input"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{input:function(){return jc(e,n.shape)}}}},jv={kernelName:dn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(e,np(n))}}}},Hv={kernelName:vn,gradFunc:function(e){return{x:function(){return Fl(e)}}}},qv={kernelName:gn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1],i=hu(r.shape,a.shape);return{a:function(){var t=hc(e,cs(a,"float32")),n=fu(r.shape,i);return n.length>0?jc(Jl(t,n),r.shape):t},b:function(){var t=mc(e,cs(r,"float32")),n=fu(a.shape,i);n.length>0&&(t=jc(Jl(t,n),a.shape));var o=Ql(a);return su(hc(t,cs(o,"float32")))}}}},Kv={kernelName:yn,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=(0,m.Z)(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?Xl(1):u,l=fu(o.shape,i.shape),p=[];if(1===o.rank){for(var d=0;d<i.shape.length-1;++d)p.push(i.shape[d]);p.push(1)}var f=Rp(i,o),h=mc(e,c),v=Fd(dc(s,Xl(r))),g=mc(mc(mc(v,v),v),Xl(-.5));return{x:function(){return 1===o.rank?jc(mc(mc(e,ip(jc(v,[1,1,1,o.shape[0]]),p)),c),i.shape):jc(mc(mc(e,v),c),i.shape)},mean:function(){var e=mc(mc(v,Xl(-1)),h);return 1===o.rank&&(e=Jl(e,l)),jc(e,o.shape)},variance:function(){var e=mc(mc(g,f),h);return 1===o.rank&&(e=Jl(e,l)),jc(e,o.shape)},scale:function(){var t=mc(f,v),n=mc(e,t);return 1===o.rank&&(n=Jl(n,l)),jc(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=Jl(t,l)),jc(t,o.shape)}}}},Xv={kernelName:bn,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,2),a=r[0],i=r[1],o=n.axis,s=Ce(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,p=Yv(0,u),d=Yv(u+1,u+1+l),f=Qv([r,[n],c]),h=jc(e,f),m=jc(i,[n]),v=Qv([[u],p,d]),g=cu(h,v),y=pf(g,m,a.shape[s]),b=Gl(v);return y=cu(y,b)},indices:function(){return i}}}};function Yv(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Qv(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Jv={kernelName:wn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1];return{a:function(){return Fl(r)},b:function(){return Fl(a)}}}},$v={kernelName:Sn,gradFunc:function(e){return{x:function(){return cs(e,"float32")}}}},eg={kernelName:Tn,gradFunc:function(e){return{x:function(){return Fl(e)}}}},tg={kernelName:Cn,gradFunc:function(e){return{x:function(){return Fl(e)}}}},ng={kernelName:En,gradFunc:function(e){return{x:function(){return Fl(e)}}}},rg={kernelName:_n,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=n.alpha,i=lp(r,0);return{x:function(){return Rl(i,e,mc(e,a))}}}},ag={kernelName:Zn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return hc(e,dc(n,1))}}}},ig={kernelName:Dn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return hc(e,cs(n,"float32"))}}}},og={kernelName:Pn,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=n.axis;return{logits:function(){var t=np(r);return Rp(e,mc(Jl(e,a,!0),t))}}}};var sg=Yi({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5,s={x:e,y:t,dy:n},u={depthRadius:r,bias:a,alpha:i,beta:o};return Mi.runKernel(Vn,s,u)}}),ug={kernelName:Wn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,m.Z)(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return sg(a,i,e,o,s,u,c)}}}};function cg(e,t,n,r){return t.rank<n.rank&&(t=jc(t,Wl(t.shape,r))),e.rank<n.rank&&(e=jc(e,Wl(e.shape,r))),{x:function(){return mc(e,cs(Al(n,t),e.dtype))}}}var lg={kernelName:Un,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=cg(e,t[1],a,Ce(r,a.shape));return{x:function(){return i.x()}}}},pg={kernelName:Gn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1];return{a:function(){return mc(e,cs(pp(r,a),"float32"))},b:function(){return mc(e,cs(vp(r,a),"float32"))}}}};var dg=Yi({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=qi(e,"dy","maxPool3dGrad"),u=qi(t,"input","maxPool3dGrad"),c=qi(n,"output","maxPool3dGrad"),l=s,p=u,d=c,f=!1;4===u.rank&&(f=!0,l=jc(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),p=jc(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),d=jc(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),fe(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank ".concat(l.rank,".")})),fe(5===p.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank ".concat(p.rank,".")})),fe(5===d.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank ".concat(d.rank,".")})),Gc("maxPool3dGrad",i,o);var h={dy:l,input:p,output:d},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},v=Mi.runKernel(Kn,h,m);return f?jc(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),fg={kernelName:qn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,m.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return dg(e,a,i,o,s,u,c)}}}};var hg=Yi({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=qi(e,"dy","maxPoolGrad"),u=qi(t,"input","maxPoolGrad"),c=qi(n,"output","maxPoolGrad");fe(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy (").concat(s.rank,")")})),fe(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank ".concat(s.rank,".")})),fe(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank ".concat(u.rank,".")})),Gc("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},p={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return Mi.runKernel(Hn,l,p)}}),mg={kernelName:jn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,m.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return hg(e,a,i,o,s,u)}}}},vg={kernelName:Yn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=Ce(n.axis,r.shape),i=ge(Bl(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=jc(e,t);return hc(mc(n,qp(r.shape,"float32")),i)}}}},gg={kernelName:Qn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=(0,m.Z)(t,2),i=a[0],o=cg(e,a[1],i,Ce(r,i.shape));return{x:function(){return o.x()}}}},yg={kernelName:Jn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1];return{a:function(){return mc(e,cs(gp(r,a),"float32"))},b:function(){return mc(e,cs(lp(r,a),"float32"))}}}},bg={kernelName:$n,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Yc(e,a,r.shape)}}}},xg={kernelName:er,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1],i=hu(r.shape,a.shape);return{a:function(){var t=fu(r.shape,i);return t.length>0?jc(Jl(e,t),r.shape):e},b:function(){var t=mc(e,su(up(hc(r,a)))),n=fu(a.shape,i);return n.length>0?jc(Jl(t,n),a.shape):t}}}},kg={kernelName:nr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1],i=hu(r.shape,a.shape);return{a:function(){var t=mc(e,cs(a,"float32")),n=fu(r.shape,i);return n.length>0?jc(Jl(t,n),r.shape):t},b:function(){var t=mc(e,cs(r,"float32")),n=fu(a.shape,i);return n.length>0?jc(Jl(t,n),a.shape):t}}}},wg={kernelName:rr,gradFunc:function(e){return{x:function(){return su(e)}}}},Sg={kernelName:cr,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Hp(n.shape,"float32")}}}},Ig={kernelName:ur,gradFunc:function(e){return{x:function(){return Fl(e)}}}},Ng={kernelName:lr,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return df(e,r).map((function(e){return function(){return e}}))}},Tg={kernelName:pr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Yc(e,a,r.shape)}}}},Cg={kernelName:fr,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=(0,m.Z)(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=hu(o.shape,s.shape);return{a:function(){var t=cs(s,"float32"),n=mc(e,mc(t,Kl(o,Rp(t,Xl(1))))),r=fu(o.shape,u);return r.length>0&&(n=Jl(n,r)),jc(n,o.shape)},b:function(){var t=lp(o,0),n=Rl(t,xp(o),Fl(o)),r=mc(e,mc(i,n)),a=fu(s.shape,u);return a.length>0&&(r=Jl(r,a)),jc(r,s.shape)}}}},Eg={kernelName:hr,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1],i=lp(r,0);return{x:function(){return Rl(i,e,mc(e,a))},alpha:function(){var t=Rl(i,Fl(e),mc(e,r)),n=fu(a.shape,e.shape);return n.length>0&&(t=Jl(t,n)),jc(t,a.shape)}}}};function _g(e,t,n){var r=e.shape.length,a=r-n.length,i=sm.getAxesPermutation(n,r),o=e;null!=i&&(o=cu(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=jc(t,r),i=Sl(e,n,!0,!1),o=Sl(e,n,!0,!0),s=mc(i,o);return mc(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=sm.getUndoAxesPermutation(i);c=cu(c,l)}return c}var Ag={kernelName:mr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=n.axis,i=[];return i=null==a?r.shape.map((function(e,t){return t})):"number"==typeof a?[a]:a,{x:function(){return _g(r,e,i)}}}},Rg={kernelName:rn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1],i=hu(r.shape,a.shape);return{a:function(){var t=hc(e,cs(a,"float32")),n=fu(r.shape,i);return n.length>0?jc(Jl(t,n),r.shape):t},b:function(){var t=mc(e,cs(r,"float32")),n=fu(a.shape,i);n.length>0&&(t=jc(Jl(t,n),a.shape));var o=Ql(a);return su(hc(t,cs(o,"float32")))}}}},Fg={kernelName:yr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return hc(e,su(Ql(n)))}}}},Dg={kernelName:Nr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0],r=mc(gp(n,6),$d(n));return{x:function(){return mc(e,cs(r,"float32"))}}}},Zg={kernelName:br,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(e,cs($d(n),"float32"))}}}},Og={kernelName:xr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return jc(e,n.shape)}}}},Mg={kernelName:Sr,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,m.Z)(t,1)[0]};return{images:function(){return Mi.runKernel(Ir,r,n)}}}},zg={kernelName:kr,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,m.Z)(t,1)[0]};return{images:function(){return Mi.runKernel(wr,r,n)}}}},Lg={kernelName:Tr,gradFunc:function(e,t,n){var r=Ce(n.dims,e.shape);return{x:function(){return Td(e,r)}}}},Pg={kernelName:Cr,gradFunc:function(e){return{x:function(){return Fl(e)}}}},Bg={kernelName:Er,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return su(hc(e,mc(Kl(n,1.5),2)))}}}},Wg={kernelName:Rr,inputsToSave:["condition"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{condition:function(){return cs(Fl(n),"float32")},t:function(){return mc(e,cs(n,e.dtype))},e:function(){return mc(e,cs(Op(n),e.dtype))}}}},Vg={kernelName:Fr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){var t=lp(n,Xl(0)),r=Xl(ym),a=Xl(bm),i=mc(e,a),o=mc(mc(e,r),np(cs(n,"float32")));return Rl(t,i,o)}}}},Ug={kernelName:zr,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(e,mc(n,Rp(Xl(1),n)))}}}},Gg={kernelName:Mr,gradFunc:function(e){return{x:function(){return Fl(e)}}}},jg={kernelName:Zr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(kl(cs(n,"float32")),e)}}}},Hg={kernelName:Or,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(wl(cs(n,"float32")),e)}}}},qg={kernelName:Dr,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=(0,m.Z)(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=Hu(r,a,i),u=(0,m.Z)(s,2),c=u[0],l=u[1],p=[],d=0;d<e.rank;d++)p.push([c[d],o[d]-c[d]-l[d]]);return{x:function(){return ad(e,p)}}}},Kg={kernelName:Ur,outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=n.dim,i=mc(e,r);return{logits:function(){return Rp(i,mc(Jl(i,[a],true),r))}}}},Xg={kernelName:Lr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(e,Xc(n))}}}},Yg={kernelName:Wr,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return $c(e,r,a)}}}},Qg={kernelName:Vr,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Kc(e,r)}}}},Jg={kernelName:Pr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return hc(e,mc(Yl(cs(n,"float32")),2))}}}},$g={kernelName:Yr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(e,mc(cs(n,"float32"),2))}}}},ey={kernelName:Xr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1],i=Xl(2);return{a:function(){return mc(e,mc(i,Rp(r,a)))},b:function(){return mc(e,mc(i,Rp(a,r)))}}}},ty={kernelName:fa,gradFunc:function(e){return{x:function(){return Fl(e)}}}},ny={kernelName:ta,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,m.Z)(t,2),r=n[0],a=n[1],i=hu(r.shape,a.shape);return{a:function(){var t=e,n=fu(r.shape,i);return n.length>0&&(t=Jl(t,n)),jc(t,r.shape)},b:function(){var t=e,n=fu(a.shape,i);return n.length>0&&(t=Jl(t,n)),jc(su(t),a.shape)}}}},ry={kernelName:Br,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=r.shape.slice();Ce(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=jc(e,a),o=mc(i,qp(r.shape,"float32"));return{x:function(){return o}}}},ay={kernelName:na,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return hc(e,Ql(kl(n)))}}}},iy={kernelName:ra,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return mc(Rp(Xl(1),Ql(n)),e)}}}},oy={kernelName:aa,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,m.Z)(t,1)[0],a=n.reps;return{x:function(){var t=Fl(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=dc(t,Yc(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=dc(t,Yc(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=dc(t,Yc(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var p=0;p<a[1];++p)for(var d=0;d<a[2];++d)for(var f=0;f<a[3];++f)t=dc(t,Yc(e,[l*r.shape[0],p*r.shape[1],d*r.shape[2],f*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},sy={kernelName:sa,gradFunc:function(e,t,n){var r=Gl(n.perm);return{x:function(){return cu(e,r)}}}},uy={kernelName:ca,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return Jd(e,r)}}}},cy={kernelName:la,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=(0,m.Z)(t,1)[0];return{x:function(){return function(e,t){for(var n=Gp(t,Fl(t)),r=cp(e,n),a=pp(t,Xl(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=rp(a,o+1);a=Zp(a,qp(r.shape,"bool"));var s=Fl(r);return Rl(a,r,s)}(e,n)}}}};for(var ly={kernelName:da,gradFunc:function(e){return{x:function(){return Fl(e)}}}},py=0,dy=[uv,cv,lv,pv,dv,fv,hv,mv,vv,gv,yv,bv,kv,Sv,Iv,Nv,Tv,Cv,Ev,_v,Av,Rv,Dv,Fv,Ov,Mv,zv,Lv,Pv,Bv,Rg,Wv,Vv,Uv,Gv,jv,qv,Hv,Kv,Xv,Jv,$v,eg,tg,ng,rg,ag,ig,og,ug,lg,lg,pg,fg,mg,vg,gg,yg,bg,xg,kg,wg,Sg,Ig,Ng,Tg,Tg,Cg,Eg,Ag,Fg,Dg,Zg,Og,Mg,zg,Lg,Pg,Bg,Wg,Vg,Ug,Gg,jg,Hg,qg,Kg,Xg,Yg,Yg,Qg,Qg,Jg,ey,$g,ty,ny,ry,ay,iy,oy,sy,uy,cy,ly];py<dy.length;py++){Ca(dy[py])}mi().prototype.abs=function(){return this.throwIfDisposed(),vc(this)},mi().prototype.acos=function(){return this.throwIfDisposed(),gc(this)},mi().prototype.acosh=function(){return this.throwIfDisposed(),yc(this)},mi().prototype.add=function(e){return this.throwIfDisposed(),dc(this,e)},mi().prototype.all=function(e,t){return this.throwIfDisposed(),xc(this,e,t)},mi().prototype.any=function(e,t){return this.throwIfDisposed(),kc(this,e,t)},mi().prototype.argMax=function(e){return this.throwIfDisposed(),wc(this,e)},mi().prototype.argMin=function(e){return this.throwIfDisposed(),Sc(this,e)},mi().prototype.asScalar=function(){return this.throwIfDisposed(),fe(1===this.size,(function(){return"The array must have only 1 element."})),jc(this,[])},mi().prototype.asType=function(e){return this.throwIfDisposed(),cs(this,e)},mi().prototype.as1D=function(){return this.throwIfDisposed(),jc(this,[this.size])},mi().prototype.as2D=function(e,t){return this.throwIfDisposed(),jc(this,[e,t])},mi().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),jc(this,[e,t,n])},mi().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),jc(this,[e,t,n,r])},mi().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),jc(this,[e,t,n,r,a])},mi().prototype.asin=function(){return this.throwIfDisposed(),Ic(this)},mi().prototype.asinh=function(){return this.throwIfDisposed(),Nc(this)},mi().prototype.atan=function(){return this.throwIfDisposed(),Tc(this)},mi().prototype.atan2=function(e){return this.throwIfDisposed(),Cc(this,e)},mi().prototype.atanh=function(){return this.throwIfDisposed(),Ec(this)},mi().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Hc(this,e,t,n,r)},mi().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),$c(this,e,t)},mi().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),tl(this,e,t,n,r,a)},mi().prototype.broadcastTo=function(e){return this.throwIfDisposed(),sl(this,e)},mi().prototype.cast=function(e){return this.throwIfDisposed(),cs(this,e)},mi().prototype.ceil=function(){return this.throwIfDisposed(),ul(this)},mi().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),cl(this,e,t)},mi().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof hi&&(e=[e]),Kc([this].concat((0,h.Z)(e)),t)},mi().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),ml(this,e,t,n,r,a,i)},mi().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),gl(this,e,t,n,r,a)},mi().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),hl(this,e,t,n,r,a,i)},mi().prototype.cos=function(){return this.throwIfDisposed(),kl(this)},mi().prototype.cosh=function(){return this.throwIfDisposed(),wl(this)},mi().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Sl(this,e,t,n)},mi().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Il(this,e,t,n)},mi().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Tl(this,e,t)},mi().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Cl(this,e,t,n,r,a,i)},mi().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),_l(this,e,t,n,r,a)},mi().prototype.divNoNan=function(e){return this.throwIfDisposed(),Dl(this,e)},mi().prototype.div=function(e){return this.throwIfDisposed(),hc(this,e)},mi().prototype.dot=function(e){return this.throwIfDisposed(),Zl(this,e)},mi().prototype.elu=function(){return this.throwIfDisposed(),Ml(this)},mi().prototype.equal=function(e){return this.throwIfDisposed(),Al(this,e)},mi().prototype.erf=function(){return this.throwIfDisposed(),zl(this)},mi().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),tp(this,e,t)},mi().prototype.exp=function(){return this.throwIfDisposed(),np(this)},mi().prototype.expandDims=function(e){return this.throwIfDisposed(),rp(this,e)},mi().prototype.expm1=function(){return this.throwIfDisposed(),ap(this)},mi().prototype.fft=function(){return this.throwIfDisposed(),jd(this)},mi().prototype.flatten=function(){return this.throwIfDisposed(),jc(this,[this.size])},mi().prototype.floor=function(){return this.throwIfDisposed(),up(this)},mi().prototype.floorDiv=function(e){return this.throwIfDisposed(),fc(this,e)},mi().prototype.gather=function(e,t){return this.throwIfDisposed(),cp(this,e,t)},mi().prototype.greaterEqual=function(e){return this.throwIfDisposed(),pp(this,e)},mi().prototype.greater=function(e){return this.throwIfDisposed(),lp(this,e)},mi().prototype.ifft=function(){return this.throwIfDisposed(),Hd(this)},mi().prototype.irfft=function(){return this.throwIfDisposed(),qd(this)},mi().prototype.isFinite=function(){return this.throwIfDisposed(),dp(this)},mi().prototype.isInf=function(){return this.throwIfDisposed(),fp(this)},mi().prototype.isNaN=function(){return this.throwIfDisposed(),hp(this)},mi().prototype.leakyRelu=function(e){return this.throwIfDisposed(),mp(this,e)},mi().prototype.lessEqual=function(e){return this.throwIfDisposed(),gp(this,e)},mi().prototype.less=function(e){return this.throwIfDisposed(),vp(this,e)},mi().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),bp(this,e,t,n,r)},mi().prototype.logSigmoid=function(){return this.throwIfDisposed(),Ap(this)},mi().prototype.logSoftmax=function(e){return this.throwIfDisposed(),Fp(this,e)},mi().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Dp(this,e,t)},mi().prototype.log=function(){return this.throwIfDisposed(),xp(this)},mi().prototype.log1p=function(){return this.throwIfDisposed(),kp(this)},mi().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Zp(this,e)},mi().prototype.logicalNot=function(){return this.throwIfDisposed(),Op(this)},mi().prototype.logicalOr=function(e){return this.throwIfDisposed(),Mp(this,e)},mi().prototype.logicalXor=function(e){return this.throwIfDisposed(),zp(this,e)},mi().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),zs(this,e,t,n)},mi().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Wp(this,e,t,n,r)},mi().prototype.max=function(e,t){return this.throwIfDisposed(),Hl(this,e,t)},mi().prototype.maximum=function(e){return this.throwIfDisposed(),Gp(this,e)},mi().prototype.mean=function(e,t){return this.throwIfDisposed(),jp(this,e,t)},mi().prototype.min=function(e,t){return this.throwIfDisposed(),ql(this,e,t)},mi().prototype.minimum=function(e){return this.throwIfDisposed(),Xp(this,e)},mi().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Yp(this,e,t)},mi().prototype.mod=function(e){return this.throwIfDisposed(),Qp(this,e)},mi().prototype.mul=function(e){return this.throwIfDisposed(),mc(this,e)},mi().prototype.neg=function(){return this.throwIfDisposed(),su(this)},mi().prototype.norm=function(e,t,n){return this.throwIfDisposed(),ep(this,e,t,n)},mi().prototype.notEqual=function(e){return this.throwIfDisposed(),td(this,e)},mi().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Ls(this,e,t,n)},mi().prototype.onesLike=function(){return this.throwIfDisposed(),nd(this)},mi().prototype.pad=function(e,t){return this.throwIfDisposed(),ad(this,e,t)},mi().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),ld(this,e,t,n,r,a,i)},mi().prototype.pow=function(e){return this.throwIfDisposed(),Kl(this,e)},mi().prototype.prelu=function(e){return this.throwIfDisposed(),pd(this,e)},mi().prototype.prod=function(e,t){return this.throwIfDisposed(),dd(this,e,t)},mi().prototype.reciprocal=function(){return this.throwIfDisposed(),Sd(this)},mi().prototype.relu=function(){return this.throwIfDisposed(),Id(this)},mi().prototype.relu6=function(){return this.throwIfDisposed(),Nd(this)},mi().prototype.reshapeAs=function(e){return this.throwIfDisposed(),jc(this,e.shape)},mi().prototype.reshape=function(e){return this.throwIfDisposed(),jc(this,e)},mi().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),hh(this,e,t,n)},mi().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),mh(this,e,t,n)},mi().prototype.reverse=function(e){return this.throwIfDisposed(),Td(this,e)},mi().prototype.rfft=function(){return this.throwIfDisposed(),Xd(this)},mi().prototype.round=function(){return this.throwIfDisposed(),Rd(this)},mi().prototype.rsqrt=function(){return this.throwIfDisposed(),Fd(this)},mi().prototype.selu=function(){return this.throwIfDisposed(),Dd(this)},mi().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Zd(this,e,t,n,r,a,i)},mi().prototype.sigmoid=function(){return this.throwIfDisposed(),Xc(this)},mi().prototype.sign=function(){return this.throwIfDisposed(),zd(this)},mi().prototype.sin=function(){return this.throwIfDisposed(),Ld(this)},mi().prototype.sinh=function(){return this.throwIfDisposed(),Pd(this)},mi().prototype.slice=function(e,t){return this.throwIfDisposed(),Yc(this,e,t)},mi().prototype.softmax=function(e){return this.throwIfDisposed(),Gd(this,e)},mi().prototype.softplus=function(){return this.throwIfDisposed(),_p(this)},mi().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),cd(this,e,t)},mi().prototype.split=function(e,t){return this.throwIfDisposed(),Kd(this,e,t)},mi().prototype.sqrt=function(){return this.throwIfDisposed(),Yl(this)},mi().prototype.square=function(){return this.throwIfDisposed(),Ql(this)},mi().prototype.squaredDifference=function(e){return this.throwIfDisposed(),Yd(this,e)},mi().prototype.squeeze=function(e){return this.throwIfDisposed(),Qd(this,e)},mi().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof hi?[this,e]:[this].concat((0,h.Z)(e));return Jd(n,t)},mi().prototype.step=function(e){return this.throwIfDisposed(),$d(this,e)},mi().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),ef(this,e,t,n,r,a,i,o,s)},mi().prototype.sub=function(e){return this.throwIfDisposed(),Rp(this,e)},mi().prototype.sum=function(e,t){return this.throwIfDisposed(),Jl(this,e,t)},mi().prototype.tan=function(){return this.throwIfDisposed(),tf(this)},mi().prototype.tanh=function(){return this.throwIfDisposed(),Qc(this)},mi().prototype.tile=function(e){return this.throwIfDisposed(),ip(this,e)},mi().prototype.toBool=function(){return this.throwIfDisposed(),cs(this,"bool")},mi().prototype.toFloat=function(){return this.throwIfDisposed(),cs(this,"float32")},mi().prototype.toInt=function(){return this.throwIfDisposed(),cs(this,"int32")},mi().prototype.topk=function(e,t){return this.throwIfDisposed(),uf(this,e,t)},mi().prototype.transpose=function(e){return this.throwIfDisposed(),cu(this,e)},mi().prototype.unique=function(e){return this.throwIfDisposed(),lf(this,e)},mi().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),pf(this,e,t)},mi().prototype.unstack=function(e){return this.throwIfDisposed(),df(this,e)},mi().prototype.where=function(e,t){return this.throwIfDisposed(),Rl(e,this,t)},mi().prototype.zerosLike=function(){return this.throwIfDisposed(),Fl(this)};var fy=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,u.Z)(r),n.prototype),r}return(0,b.Z)(n)}((0,c.Z)(Error)),hy=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,u.Z)(r),n.prototype),r}return(0,b.Z)(n)}((0,c.Z)(Error)),my=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,u.Z)(r),n.prototype),r}return(0,b.Z)(n)}((0,c.Z)(Error)),vy=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,u.Z)(r),n.prototype),r}return(0,b.Z)(n)}((0,c.Z)(Error)),gy=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,u.Z)(r),n.prototype),r}return(0,b.Z)(n)}((0,c.Z)(Error)),yy=function(){function e(t){(0,y.Z)(this,e),this.maxEntries=t||100,this.cache=new Map}return(0,b.Z)(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}();function by(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function xy(e,t){if(!e)throw new gy(t)}function ky(e,t){var n,r=0,a=(0,x.Z)(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(i){a.e(i)}finally{a.f()}return r}function wy(e){return 1===e.length?e[0]:e}function Sy(e){return Array.isArray(e)?e:[e]}function Iy(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function Ny(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var Ty={};function Cy(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function Ey(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((function(e){return Ey(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?Ey(a):e[r]=a.value)}}function _y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var i,o=e;if(o in n)i=n[o];else if(o in Ty)i=Ty[o];else if(null==(i=t[o]))throw new my("Unknown ".concat(r,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return i}var s,u,c,l,p,d,f=e;if(null==f.className||null==f.config)throw new my("".concat(r,": Improper config format: ").concat(JSON.stringify(f),".\n'className' and 'config' must set."));var h,v,g=f.className;if(g in n?(s=n[g],h=(u=(0,m.Z)(s,2))[0],v=u[1]):g in Ty?(c=Ty.className,h=(l=(0,m.Z)(c,2))[0],v=l[1]):g in t&&(p=t[g],h=(d=(0,m.Z)(p,2))[0],v=d[1]),null==h)throw new my("Unknown ".concat(r,": ").concat(g,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=v){for(var y={},b=0,x=Object.keys(Ty);b<x.length;b++){var k=x[b];y[k]=Ty[k]}for(var w=0,S=Object.keys(n);w<S.length;w++){var I=S[w];y[I]=n[I]}var N=f.config;N.customObjects=y;for(var T=Object.assign({},Ty),C=0,E=Object.keys(n);C<E.length;C++){var _=E[C];Ty[_]=n[_]}Ey(f.config);var A=v(h,f.config,n,a);return Ty=Object.assign({},T),A}for(var R=Object.assign({},Ty),F=0,D=Object.keys(n);F<D.length;F++){var Z=D[F];Ty[Z]=n[Z]}var O=new h(f.config);return Ty=Object.assign({},R),O}function Ay(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function Ry(e){if(null==e)return e;var t,n=[],r=(0,x.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}function Fy(e){if(null==e)throw new my("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function Dy(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new my("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Zy(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return xy(n>=0),xy(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function Oy(e,t){Array.isArray(e)?(Fa.assert(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return Oy(e,"element ".concat(n+1," of ").concat(t))}))):Fa.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ").concat(My(e),".")}))}function My(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return My(e)})).join(",")+"]":"string"==typeof e?'"'.concat(e,'"'):"".concat(e)}function zy(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var Ly=0;function Py(){return Ly++}var By={};function Wy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in By||(By[e]=0),By[e]+=1,e+By[e].toString()}var Vy=["channelsFirst","channelsLast"],Uy=["nearest","bilinear"],Gy=["valid","same","causal"],jy=["max","avg"],Hy=["sum","mul","concat","ave"],qy=new Map;function Ky(e){Dy(Vy,"DataFormat",e)}function Xy(e){Dy(Gy,"PaddingMode",e)}function Yy(e){Dy(jy,"PoolMode",e)}var Qy=[];function Jy(e,t){Qy.push(e);try{var n=t();return Qy.pop(),n}catch(n){throw Qy.pop(),n}}function $y(e){if(!rb(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Qy.length?"":Qy.join("/")+"/")+e}function eb(e){if(!rb(e))throw new Error("Not a valid tensor name: '"+e+"'");qy.has(e)||qy.set(e,0);var t=qy.get(e);if(qy.set(e,qy.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return qy.set(n,1),n}return e}var tb,nb=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function rb(e){return!!e.match(nb)}function ab(e){return e===parseInt(e.toString(),10)}function ib(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function ob(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function sb(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function ub(e,t){if(t<e)throw new my("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function cb(){return null==tb&&(tb=au().epsilon()),tb}function lb(e,t){return cs(e,t)}function pb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),jc(e,n)}function db(e){var t=[ib(e.shape)];return jc(e,t)}function fb(e,t,n){return qs((function(){switch(e.rank){case 1:return Bd(e,t,n);case 2:return Wd(e,[t,0],[n,e.shape[1]]);case 3:return Vd(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Ud(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Yc(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Yc(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new my("sliceAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function hb(e,t,n){return qs((function(){switch(e.rank){case 1:return Bd(e,t,n);case 2:return Wd(e,[0,t],[e.shape[0],n]);case 3:return Vd(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Ud(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new my("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function mb(e,t,n,r){return qs((function(){switch(e.rank){case 1:return Bd(e,t,n);case 2:switch(r){case 1:return fb(e,t,n);case 2:return hb(e,t,n);default:throw new my("The axis is not within the rank of the tensor ".concat(r))}case 3:switch(r){case 1:return fb(e,t,n);case 2:return Vd(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return hb(e,t,n);default:throw new my("The axis is not within the rank of the tensor ".concat(r))}case 4:switch(r){case 1:return fb(e,t,n);case 2:return Ud(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Ud(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return hb(e,t,n);default:throw new my("The axis is not within the rank of the tensor ".concat(r))}default:throw new my("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function vb(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Kc(e,n)}function gb(e,t){switch(e.rank){case 1:return ll([e,t]);case 2:return pl([e,t],0);case 3:return dl([e,t],0);case 4:return fl([e,t],0);default:throw new my("concatAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}function yb(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new my("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return ip(e,t)}function bb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return bd(e,t,n,r,a)}function xb(e,t,n,r){if(e.rank<2||t.rank<2)throw new vy("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new vy("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ").concat(t.shape));if(2===e.rank&&2===t.rank)return Af.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?Sb(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),i=a.pop();e=jc(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat((0,h.Z)(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=jc(cu(t,l),[u,-1]);var p=[].concat((0,h.Z)(a),(0,h.Z)(c));return jc(Af.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?Sb(e.rank,r,"channelsLast"):null,activation:n}),p)}function kb(e,t,n){return qs((function(){return t=Array.isArray(t)?nf(t,"int32"):cs(t,"int32"),cp(e,t,n)}))}function wb(e){return mc(e,e)}function Sb(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new my("Unexpected bias dimensions: ".concat(t.rank,"; expected it to be 1 or ").concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?jc(t,[1,r[0],1,1,1]):jc(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?jc(t,[1,1,1,1,r[0]]):jc(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?jc(t,[1,r[0],1,1]):jc(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?jc(t,[1,1,1,r[0]]):jc(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?jc(t,[1,r[0],1]):jc(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?jc(t,[1,1,r[0]]):jc(t,[1].concat(r))}else if(e<3)return t;throw new my("Unsupported input rank by biasAdd: ".concat(t.rank))}function Ib(e,t,n){return qs((function(){return null==n&&(n="channelsLast"),Ky(n),dc(e,Sb(e.rank,t,n))}))}function Nb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new vy("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return Ml(e)}function Tb(e,t,n,r){return qs((function(){return Nf(e,t,n,r)}))}function Cb(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var Eb=["fanIn","fanOut","fanAvg"],_b=["normal","uniform","truncatedNormal"];var Ab=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(Xu.Serializable),Rb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e,t){return Hp(e,t)}}]),n}(Ab);Rb.className="Zeros",Xu.registerClass(Rb);var Fb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e,t){return qp(e,t)}}]),n}(Ab);Fb.className="Ones",Xu.registerClass(Fb);var Db=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),r=t.call(this),"object"!=typeof e)throw new my("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new my("config must have value set but got ".concat(e));return r.value=e.value,(0,l.Z)(r)}return(0,b.Z)(n,[{key:"apply",value:function(e,t){var n=this;return qs((function(){return mc(Xl(n.value),qp(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(Ab);Db.className="Constant",Xu.registerClass(Db);var Zb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return(0,b.Z)(n,[{key:"apply",value:function(e,t){return kd(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(Ab);Zb.className="RandomUniform",Xu.registerClass(Zb);var Ob=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return(0,b.Z)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new vy("randomNormal does not support dType ".concat(t,"."));return bb(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(Ab);Ob.className="RandomNormal",Xu.registerClass(Ob);var Mb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return(0,b.Z)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new vy("truncatedNormal does not support dType ".concat(t,"."));return cf(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(Ab);Mb.className="TruncatedNormal",Xu.registerClass(Mb);var zb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return(0,b.Z)(n,[{key:"apply",value:function(e,t){var n=this;return qs((function(){if(2!==e.length||e[0]!==e[1])throw new my("Identity matrix initializer can only be used for 2D square matrices.");return mc(n.gain,op(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(Ab);zb.className="Identity",Xu.registerClass(zb);var Lb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),r=t.call(this),e.scale<0)throw new my("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,function(e){Dy(Eb,"FanMode",e)}(r.mode),r.distribution=null==e.distribution?"normal":e.distribution,function(e){Dy(_b,"Distribution",e)}(r.distribution),r.seed=e.seed,(0,l.Z)(r)}return(0,b.Z)(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Ky(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=ib(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=ib(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=ib(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new vy("".concat(this.getClassName()," does not support dType ").concat(t,"."));return cf(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return kd(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(Ab);Lb.className="VarianceScaling",Xu.registerClass(Lb);var Pb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return(0,b.Z)(n,[{key:"getClassName",value:function(){return Lb.className}}]),n}(Lb);Pb.className="GlorotUniform",Xu.registerClass(Pb);var Bb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return(0,b.Z)(n,[{key:"getClassName",value:function(){return Lb.className}}]),n}(Lb);Bb.className="GlorotNormal",Xu.registerClass(Bb);var Wb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return(0,b.Z)(n,[{key:"getClassName",value:function(){return Lb.className}}]),n}(Lb);Wb.className="HeNormal",Xu.registerClass(Wb);var Vb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return(0,b.Z)(n,[{key:"getClassName",value:function(){return Lb.className}}]),n}(Lb);Vb.className="HeUniform",Xu.registerClass(Vb);var Ub=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return(0,b.Z)(n,[{key:"getClassName",value:function(){return Lb.className}}]),n}(Lb);Ub.className="LeCunNormal",Xu.registerClass(Ub);var Gb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return(0,b.Z)(n,[{key:"getClassName",value:function(){return Lb.className}}]),n}(Lb);Gb.className="LeCunNormal",Xu.registerClass(Gb);var jb=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new vy("Random seed is not implemented for Orthogonal Initializer yet.");return(0,l.Z)(r)}return(0,b.Z)(n,[{key:"apply",value:function(e,t){var n=this;return qs((function(){if(e.length<2)throw new vy("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 (".concat(e[0]*e[1],") elements: Slowness may result."));var t=bb(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=jh.gramSchmidt(t);return e[0]>e[1]&&(r=cu(r)),mc(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(Ab);jb.className="Orthogonal",Xu.registerClass(jb);var Hb={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function qb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _y(e,Xu.SerializationMap.getMap().classNameMap,t,"initializer")}function Kb(e){return Cy(e)}function Xb(e){if("string"==typeof e){var t=e in Hb?Hb[e]:e;if("GlorotNormal"===t)return new Bb;if("GlorotUniform"===t)return new Pb;if("HeNormal"===t)return new Wb;if("HeUniform"===t)return new Vb;if("LeCunNormal"===t)return new Ub;if("LeCunUniform"===t)return new Gb;var n={};return n.className=t,n.config={},qb(n)}return e instanceof Ab?e:qb(e)}function Yb(e){return Array.isArray(e)&&Array.isArray(e[0])}function Qb(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Jb(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new my("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function $b(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new my("Expected exactly 1 Shape; got ".concat(e.length))}return e}function ex(e){var t,n=0,r=(0,x.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(i){r.e(i)}finally{r.f()}return n}var tx="Variable",nx=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tx,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,y.Z)(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=Py(),r=null==r?tx:r,this.originalName=$y(r),this.name=eb(this.originalName),this.trainable_=a,this.constraint=i,this.val=hf(t,this.trainable_,this.name,this.dtype)}return(0,b.Z)(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function rx(e){return e.map((function(e){return e.read()}))}function ax(e){e.forEach((function(e){e[0].write(e[1])}))}var ix=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),ox=(0,b.Z)((function e(t,n,r,a,i,o,s){(0,y.Z)(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=Py(),null!=o&&(this.originalName=$y(o),this.name=eb(this.originalName)),this.rank=n.length})),sx=0,ux=function(){function e(t,n){(0,y.Z)(this,e),this.callArgs=n,this.id=sx++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=(0,x.Z)(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(o){a.e(o)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return(0,b.Z)(e,[{key:"getConfig",value:function(){var e,t=[],n=(0,x.Z)(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(a){n.e(a)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),cx=0,lx=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,y.Z)(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=cx++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=Iy(i)+"_"+Wy(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return(0,b.Z)(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new hy("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new my("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return wy(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return wy(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new fy("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.'));if(0===this.inboundNodes.length)throw new fy("Layer ".concat(this.name," is not connected, no input to return."));return wy(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new fy("Layer ".concat(this.name," has no inbound nodes."));if(this.inboundNodes.length>1)throw new fy("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.'));return wy(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=Sy(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=Sy(this.inputSpec);if(e.length!==t.length)throw new my("Layer ".concat(this.name," expects ").concat(t.length," inputs, but it received ").concat(e.length," input tensors. Input received: ").concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new my("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected ndim=").concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new my("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new my("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new my("Input ".concat(n," is incompatible with layer ").concat(this.name," : expected dtype=").concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new my("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected axis ").concat(u," of input shape to have value ").concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var p=0;p<a.shape.length;++p){var d=a.shape[p],f=r.shape[p];if(null!=d&&null!=f&&d!==f)throw new my("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected shape=").concat(a.shape,", found shape=").concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=Sy(e),i=!0,o=(0,x.Z)(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof ox)){i=!1;break}}}catch(l){o.e(l)}finally{o.f()}var s,u=!0,c=(0,x.Z)(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof ox){u=!1;break}}}catch(l){c.e(l)}finally{c.f()}if(i===u)throw new my("Arguments to apply() must be all SymbolicTensors or all Tensors");return Jy(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=(0,x.Z)(Sy(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(l){o.e(l)}finally{o.f()}n.build(wy(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,p=n.call(e,t),d=Sy(p),f=[],h=(0,x.Z)(d);try{for(h.s();!(c=h.n()).done;){var m=c.value;-1!==a.indexOf(m)&&(m=m.clone()),f.push(m)}}catch(l){h.e(l)}finally{h.f()}if(p=wy(f),null!=n.activityRegularizer)throw new vy("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}var v,g=function(e){e=Sy(e);var t,n=[],r=(0,x.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(l){r.e(l)}finally{r.f()}return wy(n)}(e),y=n.computeOutputShape(g),b="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?g[0]:g),v=null!=y&&y.length>0&&Array.isArray(y[0])?y.map((function(r,a){return new ox(b,r,n,Sy(e),t,n.name,a)})):new ox(b,y,n,Sy(e),t,n.name),n.addInboundNode(e,v,null,null,g,y,t),n._refCount++,null!=n.activityRegularizer)throw new vy("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: ".concat(JSON.stringify(e),") does not match that of the batchInputShape (").concat(JSON.stringify(this.batchInputShape),") of the layer ").concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ").concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new fy("The layer ".concat(this.name," has never been called and thus has no defined output shape."));var e,t=[],n=(0,x.Z)(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(o){n.e(o)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new fy("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}},{key:"countParams",value:function(){if(!this.built)throw new hy("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return ex(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return rx(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;qs((function(){var n=t.weights;if(n.length!==e.length)throw new my('You called setWeights(weights) on layer "'.concat(t.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(n.length," weights. Provided weights: ").concat(e,"..."));if(0!==n.length){for(var r=[],a=rx(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!Fa.arraysEqual(o.shape,u.shape))throw new my("Layer weight shape ".concat(o.shape," not compatible with provided weight shape ").concat(u.shape));r.push([s,u])}ax(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new my("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Xb("zeros"));var u=r.apply(t,n),c=new nx(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=Sy(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,(0,h.Z)(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, but was passed an inputMask."))}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=Sy(e);t=Sy(t),n=Sy(n),r=Sy(r),a=Qb(a),i=Qb(i);var u,c=[],l=[],p=[],d=(0,x.Z)(s);try{for(d.s();!(u=d.n()).done;){var f=u.value;c.push(f.sourceLayer),l.push(f.nodeIndex),p.push(f.tensorIndex)}}catch(m){d.e(m)}finally{d.f()}new ux({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:p,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(Xu.Serializable);function px(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=px(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]),u=(0,x.Z)(s);try{for(u.s();!(o=u.n()).done;){var c=o.value;-1===a.indexOf(c)&&a.push(c)}}catch(l){u.e(l)}finally{u.f()}}return a}var dx=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:Wy("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new my("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new my("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new my("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new ox(r.dtype,r.batchInputShape,(0,u.Z)(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new ux({outboundLayer:(0,u.Z)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),(0,l.Z)(r)}return(0,b.Z)(n,[{key:"apply",value:function(e,t){throw new my("Cannot pass any input to an InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(lx);function fx(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new my("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new dx({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}dx.className="InputLayer",Xu.registerClass(dx);var hx=function(){function e(t){if((0,y.Z)(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=(0,x.Z)(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(o){a.e(o)}finally{a.f()}}}return(0,b.Z)(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new my("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return cs(t,e.dtype)}catch(n){throw new my("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof ox){if(null==this.id2Value[e.id])throw new my("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new my("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof ox){if(null==this.id2Value[e.id])throw new my("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new my("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&Ks(this.id2Mask)}}]),e}(),mx=new yy,vx=new yy;function gx(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),p=(0,x.Z)(u);try{for(p.s();!(a=p.n()).done;){var d=a.value;-1!==l.indexOf(d)?c.push(t.getValue(d)):c.push(null)}}catch(L){p.e(L)}finally{p.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var f,h=u.join(",")+"|"+t.names().sort().join(","),m=mx.get(h);if(null==m){var v=function(e,t){Fa.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=bx(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=(0,x.Z)(e);try{for(s.s();!(i=s.n()).done;){var u,c=bx(i.value,t),l=c.sorted,p=c.recipientMap,d=(0,x.Z)(l);try{for(d.s();!(u=d.n()).done;){var f=u.value;o.has(f.name)||(n.push(f),o.add(f.name))}}catch(L){d.e(L)}finally{d.f()}var h=function(e){null==r[e]&&(r[e]=new Set),p[e].forEach((function(t){return r[e].add(t)}))};for(var m in p)h(m)}}catch(L){s.e(L)}finally{s.f()}}return{sorted:n,recipientCounts:yx(r)}}(s,t);m=v.sorted,f=v.recipientCounts,mx.put(h,m),vx.put(h,f)}f={},i||Object.assign(f,vx.get(h));for(var g=new hx(t),y=0;y<m.length;++y){if(null!=r){var b=js().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var k=m[y],w=k.sourceLayer;if(!(w instanceof dx)){var S,I=[],N=[],T=[],C=!1,E=(0,x.Z)(k.inputs);try{for(E.s();!(S=E.n()).done;){var _=S.value,A=g.getValue(_),R=g.getMask(_);I.push(A),N.push(R),null!=R&&(C=!0),i||(f[_.name]--,0===f[_.name]&&!t.hasKey(_)&&-1===u.indexOf(_.name)&&!A.isDisposed&&!0!==_.sourceLayer.stateful&&T.push(A))}}catch(L){E.e(L)}finally{E.f()}C&&((n=n||{}).mask=N[0]);var F=Sy(w.apply(I,n)),D=null;w.supportsMasking&&(D=w.computeMask(I,N));for(var Z=xx(k),O=Array.isArray(Z)?Z:[Z],M=0;M<O.length;++M){g.hasKey(O[M])||g.add(O[M],F[M],Array.isArray(D)?D[0]:D);var z=u.indexOf(O[M].name);-1!==z&&(c[z]=F[M])}i||Ks(T)}}return g.disposeMasks(),o?c:c[0]}function yx(e){var t={};for(var n in e)t[n]=e[n].size;return t}function bx(e,t){var n,r=new Set,a=[],i={},o=(0,x.Z)(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(m){o.e(m)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var p=c[c.length-1]===u.length-1;if(0===l.inputs.length||p)u.pop(),a.push(l),r.add(l.name),p&&c.pop();else{c.push(u.length-1);var d,f=(0,x.Z)(l.inputs);try{for(f.s();!(d=f.n()).done;){var h=d.value;null==i[h.name]&&(i[h.name]=new Set),i[h.name].add(l.name),!r.has(h.name)&&u.push(h)}}catch(m){f.e(m)}finally{f.f()}}}}return{sorted:a,recipientMap:i}}function xx(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=(0,x.Z)(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(o){i.e(o)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}rt().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=mx&&mx.setMaxEntries(e),null!=vx&&vx.setMaxEntries(e)}));var kx={};function wx(e,t){return qs((function(){return Yl(Jl(mc(e,e),t,!0))}))}D(kx,{maxNorm:function(){return Fx},minMaxNorm:function(){return Ox},nonNeg:function(){return Zx},unitNorm:function(){return Dx}});var Sx=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"getConfig",value:function(){return{}}}]),n}(Xu.Serializable),Ix=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,b.Z)(n,[{key:"apply",value:function(e){var t=this;return qs((function(){var n=wx(e,t.axis),r=cl(n,0,t.maxValue);return mc(e,hc(r,dc(cb(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(Sx);Ix.className="MaxNorm",Xu.registerClass(Ix);var Nx=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,b.Z)(n,[{key:"apply",value:function(e){var t=this;return qs((function(){return hc(e,dc(cb(),wx(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(Sx);Nx.className="UnitNorm",Xu.registerClass(Nx);var Tx=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return Id(e)}}]),n}(Sx);Tx.className="NonNeg",Xu.registerClass(Tx);var Cx=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,b.Z)(n,[{key:"apply",value:function(e){var t=this;return qs((function(){var n=wx(e,t.axis),r=dc(mc(t.rate,cl(n,t.minValue,t.maxValue)),mc(1-t.rate,n));return mc(e,hc(r,dc(cb(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(Sx);Cx.className="MinMaxNorm",Xu.registerClass(Cx);var Ex={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function _x(e){return Cy(e)}function Ax(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _y(e,Xu.SerializationMap.getMap().classNameMap,t,"constraint")}function Rx(e){return null==e?null:"string"==typeof e?Ax({className:e in Ex?Ex[e]:e,config:{}}):e instanceof Sx?e:Ax(e)}function Fx(e){return new Ix(e)}function Dx(e){return new Nx(e)}function Zx(){return new Tx}function Ox(e){return new Cx(e)}var Mx={};function zx(){return new Rb}function Lx(){return new Fb}function Px(e){return new Db(e)}function Bx(e){return new Zb(e)}function Wx(e){return new Ob(e)}function Vx(e){return new Mb(e)}function Ux(e){return new zb(e)}function Gx(e){return new Lb(e)}function jx(e){return new Pb(e)}function Hx(e){return new Bb(e)}function qx(e){return new Wb(e)}function Kx(e){return new Vb(e)}function Xx(e){return new Ub(e)}function Yx(e){return new Gb(e)}function Qx(e){return new jb(e)}D(Mx,{constant:function(){return Px},glorotNormal:function(){return Hx},glorotUniform:function(){return jx},heNormal:function(){return qx},heUniform:function(){return Kx},identity:function(){return Ux},leCunNormal:function(){return Xx},leCunUniform:function(){return Yx},ones:function(){return Lx},orthogonal:function(){return Qx},randomNormal:function(){return Wx},randomUniform:function(){return Bx},truncatedNormal:function(){return Vx},varianceScaling:function(){return Gx},zeros:function(){return zx}});var Jx,$x={};function ek(e){return tk.apply(this,arguments)}function tk(){return tk=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s,u,c;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];Ks(a);case 10:case"end":return e.stop()}}),e)}))),tk.apply(this,arguments)}function nk(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}D($x,{Layer:function(){return lx},RNN:function(){return ZS},RNNCell:function(){return OS},activation:function(){return rN},add:function(){return dN},alphaDropout:function(){return nT},average:function(){return fN},averagePooling1d:function(){return wN},averagePooling2d:function(){return NN},averagePooling3d:function(){return EN},avgPool1d:function(){return SN},avgPool2d:function(){return TN},avgPool3d:function(){return _N},avgPooling1d:function(){return IN},avgPooling2d:function(){return CN},avgPooling3d:function(){return AN},batchNormalization:function(){return bN},bidirectional:function(){return KN},concatenate:function(){return hN},conv1d:function(){return KI},conv2d:function(){return XI},conv2dTranspose:function(){return YI},conv3d:function(){return QI},conv3dTranspose:function(){return JI},convLstm2d:function(){return GN},convLstm2dCell:function(){return jN},cropping2D:function(){return eN},dense:function(){return aN},depthwiseConv2d:function(){return nN},dot:function(){return yN},dropout:function(){return iN},elu:function(){return VI},embedding:function(){return pN},flatten:function(){return sN},gaussianDropout:function(){return tT},gaussianNoise:function(){return eT},globalAveragePooling1d:function(){return RN},globalAveragePooling2d:function(){return FN},globalMaxPool1d:function(){return YN},globalMaxPool2d:function(){return QN},globalMaxPooling1d:function(){return DN},globalMaxPooling2d:function(){return ZN},gru:function(){return LN},gruCell:function(){return PN},input:function(){return Ow},inputLayer:function(){return WI},layerNormalization:function(){return xN},leakyReLU:function(){return GI},lstm:function(){return BN},lstmCell:function(){return WN},masking:function(){return rT},maxPool1d:function(){return JN},maxPool2d:function(){return $N},maxPooling1d:function(){return ON},maxPooling2d:function(){return MN},maxPooling3d:function(){return zN},maximum:function(){return mN},minimum:function(){return vN},multiply:function(){return gN},permute:function(){return lN},prelu:function(){return jI},reLU:function(){return UI},repeatVector:function(){return uN},reshape:function(){return cN},rnn:function(){return HN},separableConv2d:function(){return $I},simpleRNN:function(){return VN},simpleRNNCell:function(){return UN},softmax:function(){return HI},spatialDropout1d:function(){return oN},stackedRNNCells:function(){return qN},thresholdedReLU:function(){return qI},timeDistributed:function(){return XN},upSampling2d:function(){return tN},zeroPadding2d:function(){return kN}}),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(Jx||(Jx={}));var rk=function(){function e(){(0,y.Z)(this,e),this.validationData=null}return(0,b.Z)(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),ak=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,y.Z)(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return(0,b.Z)(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=(0,x.Z)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=(0,x.Z)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,x.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,x.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,x.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,x.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=(0,x.Z)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=(0,x.Z)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ik=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.call(this)}return(0,b.Z)(n,[{key:"onEpochBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=function(e){var t=n[e];if("number"==typeof t)o.totals.hasOwnProperty(e)||(o.totals[e]=0),o.totals[e]=o.totals[e]+t*r;else{var a;e in o.totals?a=o.totals[e]:o.totals[e]=0;var i=qs((function(){return dc(o.totals[e],mc(t,r))}));o.totals[e]=i,null!=a&&a.dispose()}},n)a(i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n){r=(0,x.Z)(this.params.metrics);try{for(i=function(){var e=a.value;null!=o.totals[e]&&("number"==typeof o.totals[e]?n[e]=o.totals[e]/o.seen:qs((function(){var t=mc(hc(1,o.seen),o.totals[e]);n[e]=t,o.totals[e].dispose(),Xs(n[e])})))},r.s();!(a=r.n()).done;)i()}catch(t){r.e(t)}finally{r.f()}}case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(rk),ok=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"onTrainBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o,s,u,c;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!=typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=4,Promise.all(t);case 4:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(rk),sk=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;if((0,y.Z)(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||om,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Fa.isNumber(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():Fa.now();return function(){var i=null!=n?n():Fa.now();return i-a<t||(a=i,r=e.apply(void 0,arguments)),r}}(a.maybeWait.bind((0,u.Z)(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,(0,l.Z)(a)}return(0,b.Z)(n,[{key:"maybeWait",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.yield,!e.t0){e.next=6;break}return e.next=5,ek(r);case 5:a.push(this.yield(t,n,r));case 6:return a.push(this.nextFrameFunc()),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,e.t0=null!=this.epochBegin,!e.t0){e.next=7;break}return e.next=5,ek(n);case 5:return e.next=7,this.epochBegin(t,n);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.epochEnd,!e.t0){e.next=6;break}return e.next=5,ek(n);case 5:r.push(this.epochEnd(t,n));case 6:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.batchBegin,!e.t0){e.next=6;break}return e.next=4,ek(n);case 4:return e.next=6,this.batchBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.batchEnd,!e.t0){e.next=6;break}return e.next=5,ek(n);case 5:r.push(this.batchEnd(t,n));case 6:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):Fa.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainBegin,!e.t0){e.next=6;break}return e.next=4,ek(t);case 4:return e.next=6,this.trainBegin(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainEnd,!e.t0){e.next=6;break}return e.next=4,ek(t);case 4:return e.next=6,this.trainEnd(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(rk);function uk(e,t){return null==e&&(e={}),e instanceof rk?[e]:Array.isArray(e)&&e[0]instanceof rk?e:Sy(e).map((function(e){return new sk(e,t)}))}var ck=function(){function e(){(0,y.Z)(this,e)}return(0,b.Z)(e,null,[{key:"registerCallbackConstructor",value:function(t,n){Fa.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new my("Duplicate callback constructor.")}))}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,(0,h.Z)(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function lk(e,t,n,r,a,i,o,s,u){var c=new ok,l=[new ik].concat((0,h.Z)(ck.createCallbacks(t)));null!=e&&l.push.apply(l,(0,h.Z)(e)),l.push(c);var p=new ak(l);return p.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:p,history:c}}function pk(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return _y(e,Xu.SerializationMap.getMap().classNameMap,t,"layer",n)}function dk(e,t){return qs((function(){"float32"!==e.dtype&&(e=cs(e,"float32"));var n=Jl(wb(e),t,!0),r=sp(n.shape,cb()),a=Yl(Gp(n,r));return hc(e,a)}))}function fk(e,t){return qs((function(){return jp(wb(Rp(t,e)),-1)}))}function hk(e,t){return qs((function(){return jp(vc(Rp(t,e)),-1)}))}function mk(e,t){return qs((function(){var n=Rp(e,t),r=cl(vc(e),cb(),Number.MAX_VALUE),a=vc(hc(n,r));return mc(100,jp(a,-1))}))}function vk(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return qs((function(){if(n)t=Gd(t);else{var r=Jl(t,t.shape.length-1,!0);t=hc(t,r)}return t=cl(t,cb(),1-cb()),su(Jl(mc(cs(e,"float32"),xp(t)),t.shape.length-1))}))}function gk(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return qs((function(){var r=cs(up(db(e)),"int32"),a=(t=cl(t,cb(),1-cb())).shape;return vk(jc(Ls(r,a[a.length-1]),a),t,n)}))}function yk(e,t){return qs((function(){var n;return n=cl(t,cb(),1-cb()),n=xp(hc(n,Rp(1,n))),jp(function(e,t){if(!Fa.arraysEqual(e.shape,t.shape))throw new my("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return qs((function(){var n=Id(t),r=su(vc(t));return dc(Rp(n,mc(t,e)),kp(np(r)))}))}(e,n),-1)}))}function bk(e,t){return qs((function(){var n=dk(e,-1),r=dk(t,-1),a=mc(n,r);return su(Jl(a,-1))}))}ck.constructors={};var xk={meanSquaredError:fk,meanAbsoluteError:hk,meanAbsolutePercentageError:mk,meanSquaredLogarithmicError:function(e,t){return qs((function(){var n=cl(t,cb(),Number.MAX_VALUE),r=xp(dc(1,n)),a=cl(e,cb(),Number.MAX_VALUE),i=xp(dc(1,a));return jp(wb(Rp(r,i)),-1)}))},squaredHinge:function(e,t){return qs((function(){var n=Gp(0,Rp(1,mc(e,t)));return jp(wb(n),-1)}))},hinge:function(e,t){return qs((function(){var n=Gp(0,Rp(1,mc(e,t)));return jp(n,-1)}))},categoricalHinge:function(e,t){return qs((function(){var n=Jl(mc(e,t),-1),r=Hl(mc(Rp(1,e),t),-1);return Gp(0,dc(1,Rp(r,n)))}))},logcosh:function(e,t){return qs((function(){var n=Math.log(2),r=Rp(t,e),a=Rp(dc(r,_p(mc(-2,r))),n);return jp(a,-1)}))},categoricalCrossentropy:vk,sparseCategoricalCrossentropy:gk,binaryCrossentropy:yk,kullbackLeiblerDivergence:function(e,t){return qs((function(){var n=cl(e,cb(),1),r=cl(t,cb(),1);return Jl(mc(e,xp(hc(n,r))),-1)}))},poisson:function(e,t){return qs((function(){var n=xp(dc(cb(),t));return jp(Rp(t,mc(e,n)),-1)}))},cosineProximity:bk};function kk(e){if("string"==typeof e){if(e in xk)return xk[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new my(t)}return e}function wk(e,t){return qs((function(){var n=mc(.5,nd(t)),r=lb(lp(t,n),e.dtype);return jp(Al(e,r),-1)}))}function Sk(e,t){return qs((function(){return lb(Al(wc(e,-1),wc(t,-1)),"float32")}))}function Ik(e,t){return qs((function(){return cs(Jl(Zp(Al(e,1),Al(t,1))),"float32")}))}function Nk(e,t){return qs((function(){var n=Ik(e,t),r=function(e,t){return qs((function(){return cs(Jl(Zp(Al(e,0),Al(t,1))),"float32")}))}(e,t),a=dc(n,r);return cs(Rl(lp(a,0),hc(n,a),0),"float32")}))}function Tk(e,t){return qs((function(){var n=Ik(e,t),r=function(e,t){return qs((function(){return cs(Jl(Zp(Al(e,1),Al(t,0))),"float32")}))}(e,t),a=dc(n,r);return cs(Rl(lp(a,0),hc(n,a),0),"float32")}))}function Ck(e,t){return yk(e,t)}function Ek(e,t){return e.rank===t.rank&&(e=Qd(e,[e.rank-1])),(t=wc(t,-1)).dtype!==e.dtype&&(t=cs(t,e.dtype)),cs(Al(e,t),"float32")}var _k=vk,Ak=gk,Rk={binaryAccuracy:wk,categoricalAccuracy:Sk,precision:Nk,categoricalCrossentropy:_k,sparseCategoricalCrossentropy:Ak,mse:fk,MSE:fk,mae:hk,MAE:hk,mape:mk,MAPE:mk,cosine:bk};function Fk(e){if("string"==typeof e&&e in Rk)return Rk[e];if("string"!=typeof e&&null!=e)return e;throw new my("Unknown metric ".concat(e))}function Dk(e){if(xy(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(xk);n<r.length;n++){var a=r[n];if(xk[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(Rk);i<o.length;i++){var s=o[i];if(Rk[s]===e){t=s;break}}return void 0!==t?t:e.name}function Zk(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!Ok(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(r.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ",1048576,"."))}}function Ok(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!=typeof r||!Ok(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=(0,x.Z)(e);try{for(i.s();!(a=i.n()).done;){if(!Ok(a.value))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function Mk(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=Lk(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,(0,h.Z)(e.nodesByDepth[s]))}a("_".repeat(t)),Pk(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?Bk(c[l],n,a):Wk(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var p=zk(e),d=ex(e.nonTrainableWeights);a("Total params: ".concat(p+d)),a("Trainable params: ".concat(p)),a("Non-trainable params: ".concat(d)),a("_".repeat(t))}function zk(e){return null!=e.collectedTrainableWeights?ex(e.collectedTrainableWeights):ex(e.trainableWeights)}function Lk(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,(0,h.Z)(s))}if(t){var u,c=(0,x.Z)(e.layers);try{for(c.s();!(u=c.n()).done;){var l,p=u.value,d=!1,f=(0,x.Z)(p.inboundNodes);try{for(f.s();!(l=f.n()).done;){var m=l.value;if(-1!==r.indexOf(m)){if(d){t=!1;break}d=!0}}}catch(v){f.e(v)}finally{f.f()}if(!t)break}}catch(v){c.e(v)}finally{c.f()}}return t}function Pk(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function Bk(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(s){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(s){r="multiple"}var i=e.name,o=e.getClassName();Pk(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function Wk(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(g){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(g){a="multiple"}var o,s=[],u=(0,x.Z)(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var p=c.inboundLayers[l].name,d=c.nodeIndices[l],f=c.tensorIndices[l];s.push("".concat(p,"[").concat(d,"][").concat(f,"]"))}}}catch(y){u.e(y)}finally{u.f()}var h=e.name,m=e.getClassName(),v=0===s.length?"":s[0];Pk(["".concat(h," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var g=1;g<s.length;++g)Pk(["","","","",s[g]],t,r)}function Vk(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function Uk(e,t){if(null===e)return null;if("string"==typeof e)return Ny(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];Vk(t,a,i)?n.push(i):n.push(Uk(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var p=Ny(c);o[p]=Uk(l,p)}}return o}function Gk(e,t){if(null==e)return null;if("string"==typeof e)return Iy(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];Vk(t,a,i)?n.push(i):n.push(Gk(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],p=Iy(c);o[p]="name"!==c&&"className"!==c||"string"!=typeof l?Gk(l,c):l}return o}var jk="3.19.0",Hk=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=Wy(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],Ry(r.inputs).length!==r.inputs.length)throw new my("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ".concat(r.inputs.map((function(e){return e.name}))));Ry(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=(0,x.Z)(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,c=s.sourceLayer,p=s.nodeIndex,d=s.tensorIndex;r.outputLayers.push(c),r.outputLayersNodeIndices.push(p),r.outputLayersTensorIndices.push(d)}}catch(Te){o.e(Te)}finally{o.f()}var f,h=(0,x.Z)(r.inputs);try{for(h.s();!(f=h.n()).done;){var m=f.value,v=m.sourceLayer,g=m.nodeIndex,b=m.tensorIndex;xy(0===g,"input layer has >1 nodes"),xy(0===b,"input layer has >1 tensors"),r.inputLayers.push(v),r.inputLayersNodeIndices.push(g),r.inputLayersTensorIndices.push(b)}}catch(Te){h.e(Te)}finally{h.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var k=0;k<r.inputLayers.length;k++){var w=r.inputLayers[k];if(!(w instanceof dx))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(k," (0-based) originates from layer type ").concat(w.getClassName(),"."));r.inputNames.push(w.name),r.feedInputShapes.push(w.batchInputShape),r.feedInputNames.push(w.name)}var S,I=(0,x.Z)(r.outputLayers);try{for(I.s();!(S=I.n()).done;){var N=S.value;r.outputNames.push(N.name)}}catch(Te){I.e(Te)}finally{I.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var T,C={},E={},_={},A={},R={},F=[],D=function e(t,a,i,o,s,u){(null==o||null==s||null==u)&&(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new hy("The tensor ".concat(t.name,' at layer "').concat(o.name,'" is part of a cycle.'));if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in R||(R[o.id]=Object.keys(R).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,p=0;p<l;p++){e(c.inputTensors[p],a,i,c.inboundLayers[p],c.nodeIndices[p],c.tensorIndices[p])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);F.push(c)}},Z=[],O=[],M=(0,x.Z)(r.outputs);try{for(M.s();!(T=M.n()).done;){D(T.value,Z,O)}}catch(Te){M.e(Te)}finally{M.f()}var z,L=F.slice().reverse(),P=(0,x.Z)(L);try{for(P.s();!(z=P.n()).done;){var B=z.value;E[B.id]=B,B.id in C||(C[B.id]=0);var W=C[B.id],V=null==_[B.outboundLayer.id]?0:_[B.outboundLayer.id];W=Math.max(W,V),_[B.outboundLayer.id]=W,A[B.outboundLayer.id]=B.outboundLayer,C[B.id]=W;for(var U=0;U<B.inboundLayers.length;U++){var G=B.inboundLayers[U],j=B.nodeIndices[U],H=G.inboundNodes[j],q=null==C[H.id]?0:C[H.id];C[H.id]=Math.max(W+1,q),E[H.id]=H}}}catch(Te){P.e(Te)}finally{P.f()}var K={};for(var X in C){var Y=C[X];Y in K||(K[Y]=[]),K[Y].push(E[X])}var Q={};for(var J in _){var $=_[J];$ in Q||(Q[$]=[]),Q[$].push(A[J])}var ee=Object.keys(Q).map((function(e){return parseInt(e,10)})).sort(Ay);r.layers=[];var te,ne=(0,x.Z)(ee);try{for(ne.s();!(te=ne.n()).done;){var re=Q[te.value];re.sort((function(e,t){var n=R[e.id],r=R[t.id];return n<r?-1:n>r?1:0}));var ae,ie=(0,x.Z)(re);try{for(ie.s();!(ae=ie.n()).done;){var oe=ae.value;oe instanceof n&&r.internalContainerRefs.push(oe),r.layers.push(oe)}}catch(Te){ie.e(Te)}finally{ie.f()}}}catch(Te){ne.e(Te)}finally{ne.f()}r.layersByDepth=Q,ee=Object.keys(K).map((function(e){return parseInt(e,10)})).sort(Ay);var se,ue=r.inputs.slice(),ce=[],le=(0,x.Z)(ee);try{for(le.s();!(se=le.n()).done;){var pe,de=se.value,fe=(0,x.Z)(K[de]);try{for(fe.s();!(pe=fe.n()).done;){var he=pe.value,me=he.outboundLayer;if(null!=me){var ve,ge=(0,x.Z)(he.inputTensors);try{for(ge.s();!(ve=ge.n()).done;){var ye=ve.value;if(-1===ue.indexOf(ye))throw new hy("Graph disconnected: cannot obtain value for tensor ".concat(ye,' at layer "').concat(me.name,'". The following previous layers were accessed without issue: ').concat(ce))}}catch(Te){ge.e(Te)}finally{ge.f()}var be,xe=(0,x.Z)(he.outputTensors);try{for(xe.s();!(be=xe.n()).done;){var ke=be.value;ue.push(ke)}}catch(Te){xe.e(Te)}finally{xe.f()}ce.push(me.name)}}}catch(Te){fe.e(Te)}finally{fe.f()}}}catch(Te){le.e(Te)}finally{le.f()}r.nodesByDepth=K;var we,Se=r.layers.map((function(e){return e.name})),Ie=(0,x.Z)(Se);try{var Ne=function(){var e=we.value,t=Se.filter((function(t){return t===e})).length;if(1!==t)throw new hy('The name "'.concat(e,'" is used ').concat(t," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(Se))};for(Ie.s();!(we=Ie.n()).done;)Ne()}catch(Te){Ie.e(Te)}finally{Ie.f()}return r.outboundNodes=[],r.inboundNodes=[],new ux({outboundLayer:(0,u.Z)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,(0,l.Z)(r)}return(0,b.Z)(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=(0,x.Z)(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(s){n.e(s)}finally{n.f()}var a,i=(0,x.Z)(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(s){i.e(s)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new my("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=(0,x.Z)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=(0,x.Z)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,h.Z)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=(0,x.Z)(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,h.Z)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=(0,x.Z)(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=(0,x.Z)(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new my("Duplicate weight name: ".concat(c.originalName));r[c.originalName]=c,a++}}catch(v){u.e(v)}finally{u.f()}}}catch(v){i.e(v)}finally{i.f()}var l=[];for(var p in e){var d=p;if(null==r[p]){var f=p.split("/");d=f.slice(0,-2).concat([f[f.length-1]]).join("/")}if(null!=r[d])l.push([r[d],e[p]]);else if(n)throw new my("Provided weight data has no target variable: ".concat(p));delete r[d]}if(n){var h=[];for(var m in r)h.push(m);if(h.length>0)throw new my("".concat(h.length," of ").concat(a," weights are not set: ").concat(h))}ax(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(jk),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Gk(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return qs((function(){e=Sy(e);for(var r=new hx,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return gx(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return qs((function(){var r;return e=Sy(e),r=null==t?by(null,e.length):Sy(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=Qb(e);if(t.length!==this.inputLayers.length)throw new my("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Ay);if(o.length>1){var s,u=(0,x.Z)(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,p=this.nodesByDepth[l],d=(0,x.Z)(p);try{for(d.s();!(c=d.n()).done;){var f=c.value,h=f.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(h.id)){for(var m=[],v=0;v<f.inboundLayers.length;v++){var g=f.inboundLayers[v],y=f.nodeIndices[v],b=f.tensorIndices[v],k=n["".concat(g.name,"_").concat(y,"_").concat(b)];m.push(k)}for(var w=Qb(h.computeOutputShape(wy(m))),S=h.inboundNodes.indexOf(f),I=0;I<w.length;I++){n["".concat(h.name,"_").concat(S,"_").concat(I)]=w[I]}}}}catch(Z){d.e(Z)}finally{d.f()}}}catch(Z){u.e(Z)}finally{u.f()}}for(var N=[],T=[],C=0;C<this.outputLayers.length;C++){var E=this.outputLayers[C],_=this.outputLayersNodeIndices[C],A=this.outputLayersTensorIndices[C],R="".concat(E.name,"_").concat(_,"_").concat(A);T.push(R)}for(var F=0;F<T.length;F++){var D=T[F];xy(D in n),N.push(n[D])}return wy(N)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=by(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Ay),c=(0,x.Z)(u);try{for(c.s();!(s=c.n()).done;){var l,p=s.value,d=this.nodesByDepth[p],f=(0,x.Z)(d);try{for(f.s();!(l=f.n()).done;){var h,v=l.value,g=v.outboundLayer,y=v.inputTensors,b=v.outputTensors,k=new Array,w=(0,x.Z)(y);try{for(w.s();!(h=w.n()).done;){var S=h.value;S.id in n&&k.push(n[S.id])}}catch(j){w.e(j)}finally{w.f()}if(k.length===y.length){var I={},N=void 0,T=void 0,C=void 0,E=void 0;if(null!=v.callArgs&&(I=v.callArgs),1===k.length){var _=(0,m.Z)(k[0],2),A=_[0],R=_[1];null==I.mask&&(I.mask=R),C=Sy(g.call(A,I)),E=Sy(g.computeMask(A,R)),N=[A],T=[R]}else N=k.map((function(e){return e[0]})),T=k.map((function(e){return e[1]})),null==I.mask&&(I.mask=T),C=Sy(g.call(N,I)),E=Sy(g.computeMask(N,T));if(g.activityRegularizer)throw new vy("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var F=0;F<b.length;++F){var D=b[F],Z=C[F],O=E[F];n[D.id]=[Z,O]}}}}catch(j){f.e(j)}finally{f.f()}}}catch(j){c.e(j)}finally{c.f()}var M,z=[],L=[],P=[],B=(0,x.Z)(this.outputs);try{for(B.s();!(M=B.n()).done;){var W=M.value;xy(W.id in n,"Could not compute output ".concat(W.name," : ").concat(W.id));var V=(0,m.Z)(n[W.id],2),U=V[0],G=V[1];P.push(U.shape),z.push(U),L.push(G)}}catch(j){B.e(j)}finally{B.f()}return[z,L,P]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=(0,x.Z)(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new my("Was asked to retrieve layer at index ".concat(t,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new my("Provide either a layer name or layer index");var n,r=(0,x.Z)(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(i){r.e(i)}finally{r.f()}throw new my("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return qs((function(){var t,r=[],a=(0,x.Z)(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,(0,h.Z)(i.calculateLosses()))}}catch(u){a.e(u)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=(0,x.Z)(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var p=o.inboundNodes[l],d=n.nodeKey(o,l),f={};if(this.containerNodes.has(d)){if(p.callArgs)try{JSON.stringify(p.callArgs),f=p.callArgs}catch(h){console.warn("Layer ".concat(o.name," was passed non-serializable keyword arguments: ").concat(p.callArgs,". They will not be included in the serialized model (and thus will be missing at deserialization time).")),f={}}if(p.inboundLayers.length>0){for(var h=[],m=0;m<p.inboundLayers.length;m++){var v=p.inboundLayers[m],g=p.nodeIndices[m],y=p.tensorIndices[m],b=r[n.nodeKey(v,g)];null==b&&(b=0),h.push([v.name,b,y,f])}c.push(h)}}}var k={};k.name=o.name,k.className=s,k.config=u,k.inboundNodes=c,a.push(k)}}catch(M){i.e(M)}finally{i.f()}t.layers=a;for(var w=[],S=0;S<this.inputLayers.length;S++){var I=this.inputLayers[S],N=this.inputLayersNodeIndices[S],T=n.nodeKey(I,N);if(this.containerNodes.has(T)){var C=r[T];null==C&&(C=0);var E=this.inputLayersTensorIndices[S];w.push([I.name,C,E])}}t.inputLayers=w;for(var _=[],A=0;A<this.outputLayers.length;A++){var R=this.outputLayers[A],F=this.outputLayersNodeIndices[A],D=n.nodeKey(R,F);if(this.containerNodes.has(D)){var Z=r[D];null==Z&&(Z=0);var O=this.outputLayersTensorIndices[A];_.push([R.name,Z,O])}}return t.outputLayers=_,t}},{key:"stateful",get:function(){if(this._stateful)throw new my("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=(0,x.Z)(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;qs((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=(0,x.Z)(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],p=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var d=r[c];if(d.inboundNodes.length<=l)return void i(e,t);var f=d.inboundNodes[l];o.push(f.outputTensors[p])}}catch(h){s.e(h)}finally{s.f()}o.length>0&&e.apply(wy(o),n)}function s(e){var a=e.name,o=pk(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new my("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,p=(0,x.Z)(l);try{for(p.s();!(u=p.n()).done;){var d=u.value;s(d)}}catch(B){p.e(B)}finally{p.f()}for(;!Fy(a);){var f,h=(0,x.Z)(l);try{for(h.s();!(f=h.n()).done;){var m=f.value,v=r[m.name];if(v.name in a){var g=a[v.name];delete a[v.name];var y,b=(0,x.Z)(g);try{for(b.s();!(y=b.n()).done;){var k=y.value;o(v,k)}}catch(B){b.e(B)}finally{b.f()}}}}catch(B){h.e(B)}finally{h.f()}}var w,S=[],I=[],N=t.inputLayers,T=(0,x.Z)(N);try{for(T.s();!(w=T.n()).done;){var C=w.value,E=C[0],_=C[1],A=C[2];xy(E in r);var R=r[E].inboundNodes[_].outputTensors;S.push(R[A])}}catch(B){T.e(B)}finally{T.f()}var F,D=t.outputLayers,Z=(0,x.Z)(D);try{for(Z.s();!(F=Z.n()).done;){var O=F.value,M=O[0],z=O[1],L=O[2];xy(M in r);var P=r[M].inboundNodes[z].outputTensors;I.push(P[L])}}catch(B){Z.e(B)}finally{Z.f()}return new e({inputs:S,outputs:I,name:c})}}]),n}(lx);function qk(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," element(s), but the model has ").concat(r," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, so ").concat(n," must be either an array with ").concat(r," elements or an object with ").concat(t," keys. Provided ").concat(n," not understood: ").concat(JSON.stringify(e)))}(e,t,"classWeight")}function Kk(e,t,n,r){return Xk.apply(this,arguments)}function Xk(){return Xk=(0,g.Z)((0,v.Z)().mark((function e(t,n,r,a){var i,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=14;break}return i=qs((function(){if(1===t.shape.length)return ls(t);if(2===t.shape.length){if(t.shape[1]>1)return wc(t,1);if(1===t.shape[1])return jc(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during handling of class weights. The rank is expected to be 1 or 2."))})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),Ks(i),s=[],e.abrupt("return",(o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));s.push(r[e])})),nf(s,"float32")));case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)}))),Xk.apply(this,arguments)}function Yk(e,t){return mc(e,t)}function Qk(e,t){var n,r,a=t;n=a.xs,r=a.ys,Fa.assert(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ".concat(t)}));var i=Jk("input",e.inputNames,n),o=Jk("output",e.outputNames,r),s=i[0].shape[0];Fa.assert(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(i.length," inputs.  (Expected input keys: ").concat(JSON.stringify(e.inputNames),")")})),Fa.assert(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(o.length," outputs.  (Expected output keys: ").concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){Fa.assert(i[t].shape[0]===s,(function(){return"Batch size mismatch: input ".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){Fa.assert(o[t].shape[0]===s,(function(){return"Batch size mismatch: output ".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},p=0;p<o.length;p++)l(p);return{xs:i,ys:o}}function Jk(e,t,n){if(n instanceof hi)return[n];if(Array.isArray(n))return Fa.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=(0,x.Z)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new my("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(s){i.e(s)}finally{i.f()}return a}function $k(e){if(3===e.length)throw new vy("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function ew(e,t,n){return tw.apply(this,arguments)}function tw(){return tw=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,f,h,m,g,y,b,x,k,w,S,I,N,T,C,E,_,A,R,F,D,Z,O,M,z;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,Fa.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),Fa.assert(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),Fa.assert(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got ".concat(r.epochs)})),Fa.assert(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ".concat(r.batchesPerEpoch)})),Fa.assert(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(i=null!=r.validationData)&&(rw(r.validationData)?Fa.assert(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ".concat(r.validationBatches)})):(u=$k(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),p=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),d=uk(r.callbacks,r.yieldEvery),f=null==r.verbose?1:r.verbose,h=lk(d,f,r.epochs,null,null,nw(n,r),null,i,p),m=h.callbackList,g=h.history,m.setModel(t),t.history=g,e.next=14,m.onTrainBegin();case 14:return t.stopTraining_=!1,y=null==r.initialEpoch?0:r.initialEpoch,e.next=18,n.iterator();case 18:b=e.sent;case 19:if(!(y<r.epochs)){e.next=88;break}return x={},e.next=23,m.onEpochBegin(y);case 23:if(k=0,w=0,e.t0=a,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:b=e.sent;case 29:if(a&&!(k<r.batchesPerEpoch)){e.next=81;break}return e.next=32,b.next();case 32:if(S=e.sent,!a||!S.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as ".concat(r.batchesPerEpoch,", but your dataset iterator ran out of data after ").concat(k," batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, ").concat(r.batchesPerEpoch*r.epochs," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("break",81);case 36:if(null==S.value){e.next=63;break}return I=Qk(t,S.value),N=I.xs,T=I.ys,(C={}).batch=w,C.size=N[0].shape[0],e.next=42,m.onBatchBegin(w,C);case 42:if(E=[],null==r.classWeight){e.next=55;break}_=qk(r.classWeight,t.outputNames),A=0;case 46:if(!(A<_.length)){e.next=55;break}return e.t1=E,e.next=50,Kk(T[A],null,_[A]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++A,e.next=46;break;case 55:for(R=N.concat(T).concat(E),F=c(R),Ks(R),D=0;D<l.length;++D)Z=l[D],O=F[D],C[Z]=O,Xs(O);return e.next=60,m.onBatchEnd(w,C);case 60:nk(C),w++,k++;case 63:if(!(a?k>=r.batchesPerEpoch:S.done)){e.next=77;break}if(!i){e.next=76;break}if(M=void 0,!rw(r.validationData)){e.next=74;break}return e.t3=Sy,e.next=70,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 70:e.t4=e.sent,M=(0,e.t3)(e.t4),e.next=75;break;case 74:M=Sy(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?32:r.validationBatchSize,verbose:0}));case 75:for(z=0;z<t.metricsNames.length;++z)x["val_".concat(t.metricsNames[z])]=M[z];case 76:return e.abrupt("break",81);case 77:if(!t.stopTraining_){e.next=79;break}return e.abrupt("break",81);case 79:e.next=29;break;case 81:return e.next=83,m.onEpochEnd(y,x);case 83:if(y++,!t.stopTraining_){e.next=86;break}return e.abrupt("break",88);case 86:e.next=19;break;case 88:return e.next=90,m.onTrainEnd();case 90:return e.next=92,t.history.syncData();case 92:return e.abrupt("return",t.history);case 93:return e.prev=93,t.isTraining=!1,e.finish(93);case 96:case"end":return e.stop()}}),e,null,[[4,,93,96]])}))),tw.apply(this,arguments)}function nw(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function rw(e){return"function"==typeof e.iterator}function aw(e){return"function"==typeof e.next}function iw(e,t,n){return ow.apply(this,arguments)}function ow(){return ow=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=4;break}throw new vy("Verbose mode is not implemented yet.");case 4:if(Fa.assert(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received ".concat(JSON.stringify(r.batches))})),!aw(n)){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,n.iterator();case 11:e.t0=e.sent;case 12:s=e.t0,u=0,c=0,l=(0,v.Z)().mark((function e(){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=qs((function(){return n.value&&function(){var e=Qk(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=qs((function(){return i(s)}));if(Ks(s),0===c)for(var p=0;p<l.length;++p)o.push(Xl(0));for(var d=s[0].shape[0],f=function(e){var t=l[e],n=o[e];o[e]=qs((function(){return dc(o[e],mc(d,t))})),c>0&&Ks(n)},h=0;h<l.length;++h)f(h);Ks(l),u+=d,++c}(),o})),!n.done){e.next=6;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(r.batches," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("return","break");case 6:case"end":return e.stop()}}),e)}));case 16:if(a&&!(c<r.batches)){e.next=23;break}return e.delegateYield(l(),"t1",18);case 18:if("break"!==e.t1){e.next=21;break}return e.abrupt("break",23);case 21:e.next=16;break;case 23:for(p=0;p<o.length;++p)d=o[p],o[p]=hc(o[p],u),Ks(d);return e.abrupt("return",wy(o));case 25:case"end":return e.stop()}}),e)}))),ow.apply(this,arguments)}function sw(e){Fa.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function uw(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return fb(e,t,n-t)})):fb(e,t,n-t)}function cw(e,t){return qs((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return cw(e,t)})):kb(e,"int32"===t.dtype?t:cs(t,"int32"))}))}function lw(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function pw(e,t,n,r,a,i,o,s,u,c,l,p,d,f,h){return dw.apply(this,arguments)}function dw(){return dw=(0,g.Z)((0,v.Z)().mark((function e(t,n,r,a,i,o,s,u,c,l,p,d,f,h,m){var g,y,b,x,k,w,S,I;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i&&(i=32),null==o&&(o=1),null==p&&(p=!0),null==f&&(f=0),g=!1,null!=c&&null!=l&&(g=!0),null==m||(g=!0,null!=h)){e.next=4;break}throw new my("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 4:return null!=(y=t.checkNumSamples(r,i,h,"steps_per_epoch"))&&(b=ub(0,y)),null==s&&(s=1),x=lk(u,s,o,f,y,h,i,g,d),k=x.callbackList,w=x.history,k.setModel(t),t.history=w,e.next=11,k.onTrainBegin();case 11:t.stopTraining_=!1,S=(0,v.Z)().mark((function e(o){var s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.onEpochBegin(o);case 2:if(s={},null==h){e.next=5;break}throw new vy("stepsPerEpoch mode is not implemented yet.");case 5:return e.delegateYield((0,v.Z)().mark((function e(){var o,u,d,f;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==p){e.next=2;break}throw new vy("batch shuffling is not implemneted yet");case 2:p&&Fa.shuffle(b),o=nf(b),u=lw(y,i),d=(0,v.Z)().mark((function e(p){var d;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d={},e.next=3,k.onBatchBegin(p,d);case 3:return qs((function(){var e=u[p][0],f=u[p][1],h=fb(o,e,f-e);d.batch=p,d.size=f-e;for(var m=cw(r,h),v=n(m),y=0;y<a.length;++y){var b=a[y],x=v[y];d[b]=x,Xs(x)}if(p===u.length-1&&g)for(var k=t.testLoop(c,l,i),w=0;w<a.length;++w){var S=a[w],I=k[w];Xs(I),s["val_"+S]=I}})),e.next=6,k.onBatchEnd(p,d);case 6:if(nk(d),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),f=0;case 6:if(!(f<u.length)){e.next=14;break}return e.delegateYield(d(f),"t0",8);case 8:if("break"!==e.t0){e.next=11;break}return e.abrupt("break",14);case 11:++f,e.next=6;break;case 14:o.dispose();case 15:case"end":return e.stop()}}),e)}))(),"t0",6);case 6:return e.next=8,k.onEpochEnd(o,s);case 8:if(!t.stopTraining_){e.next=10;break}return e.abrupt("return","break");case 10:case"end":return e.stop()}}),e)})),I=f;case 14:if(!(I<o)){e.next=22;break}return e.delegateYield(S(I),"t0",16);case 16:if("break"!==e.t0){e.next=19;break}return e.abrupt("break",22);case 19:++I,e.next=14;break;case 22:return e.next=24,k.onTrainEnd();case 24:return e.next=26,t.history.syncData();case 26:return e.abrupt("return",t.history);case 27:case"end":return e.stop()}}),e)}))),dw.apply(this,arguments)}function fw(e,t,n){return hw.apply(this,arguments)}function hw(){return hw=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,f,h,m,g,y,b,x,k,w,S,I,N,T,C,E,_,A=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=A.length>3&&void 0!==A[3]?A[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,sw(h=null==a.batchSize?32:a.batchSize),m=!1,e.next=10,t.standardizeUserData(n,r,a.sampleWeight,a.classWeight,m,h);case 10:if(g=e.sent,i=g[0],o=g[1],f=g[2],y=!1,!(null!=a.validationData&&a.validationData.length>0)){e.next=26;break}if(y=!0,2!==a.validationData.length){e.next=18;break}c=a.validationData[0],l=a.validationData[1],e.next=19;break;case 18:throw 3===a.validationData.length?new vy("validationData including sample weights is not supported yet."):new my("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ".concat(a.validationData," is invalid."));case 19:return x=!0,e.next=22,t.standardizeUserData(c,l,null,null,x,h);case 22:k=e.sent,p=k[0],d=k[1],b=p.concat(d),e.next=27;break;case 26:null!=a.validationSplit&&a.validationSplit>0&&a.validationSplit<1?(y=!0,w=Math.floor(i[0].shape[0]*(1-a.validationSplit)),S=i[0].shape[0],p=uw(i,w,S),s=i,i=uw(i,0,w),d=uw(o,w,S),u=o,o=uw(o,0,w),b=p.concat(d)):null!=a.validationSteps&&(y=!0);case 27:return I=i.concat(o).concat(f),t.checkTrainableWeightsConsistency(),N=t.makeTrainFunction(),T=t.getDedupedMetricsNames(),y?(t.makeTestFunction(),C=t.testFunction,E=T.slice().concat(T.map((function(e){return"val_"+e})))):(C=null,b=[],E=T.slice()),_=uk(a.callbacks,a.yieldEvery),e.next=34,pw(t,N,I,T,h,a.epochs,a.verbose,_,C,b,a.shuffle,E,a.initialEpoch,null,null);case 34:return e.abrupt("return",e.sent);case 35:return e.prev=35,t.isTraining=!1,vw(i,n),vw(o,r),vw(s,n),vw(u,r),vw(p,c),vw(d,l),null!=f&&Ks(f),e.finish(35);case 38:case"end":return e.stop()}}),e,null,[[4,,35,38]])}))),hw.apply(this,arguments)}function mw(e){var t=[];e instanceof hi&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(pb(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function vw(e,t){if(null!=e){var n=[];if(t instanceof hi)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof hi)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function gw(e){return Array.isArray(e)}function yw(e){return!function(e){return e instanceof hi}(e)&&!gw(e)}function bw(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(gw(e)&&e.length>0)o=!0;else if(yw(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new my("Error when checking model ".concat(i," expected no data, but got ").concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(yw(e)){r=[];var u,c=(0,x.Z)(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new my('No data provided for "'.concat(l,'". Need data for each key in: ').concat(t));r.push(e[l])}}catch(v){c.e(v)}finally{c.f()}}else if(gw(e)){if(e.length!==t.length)throw new my("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ").concat(e));r=e}else{if(t.length>1)throw new my("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ").concat(e.shape));r=[e]}if(r=mw(r),null!=n)for(var p=0;p<t.length;++p)if(null!=n[p]){var d=r[p];if(d.shape.length!==n[p].length)throw new my("Error when checking ".concat(i,": expected ").concat(t[p]," to have ").concat(n[p].length," dimension(s). but got array with shape ").concat(d.shape));for(var f=0;f<n[p].length;++f)if(0!==f||a){var h=d.shape[f],m=n[p][f];if(null!=m&&m>=0&&h!==m)throw new my("".concat(i," expected a batch of elements where each example has shape [").concat(n[p].slice(1,n[p].length),"] (i.e.,tensor shape [*,").concat(n[p].slice(1,n[p].length),"]) but the ").concat(i," received an input with ").concat(d.shape[0]," examples, each with shape [").concat(d.shape.slice(1,d.shape.length),"] (tensor shape [").concat(d.shape,"])"))}}return r}function xw(e,t,n){var r=Ry(e.map((function(e){return e.shape[0]})));r.sort();var a=Ry(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new my("All input Tensors (x) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new my("All target Tensors (y) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!Fa.arraysEqual(r,a))throw new my("Input Tensors should have the same number of samples as target Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target sample(s)."))}function kw(e,t,n){for(var r=[fk,yk,vk],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===vk&&1===i.shape[i.shape.length-1])throw new my("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var p=u[l],d=c[l];if(null!=d&&p!==d)throw new my("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}function ww(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new my("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new my("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ").concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new my("Error when checking ".concat(i,": expected ").concat(t[o]," to have ").concat(n[o].length," dimension(s), but got array with shape ").concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new my("Error when checking ".concat(i,": expected ").concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but got array with shape ").concat(JSON.stringify(s.shape),"."))}}}var Sw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).isTraining=!1,r}return(0,b.Z)(n,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new my("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Mk(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return am.adagrad(.01)},Adadelta:function(){return am.adadelta(1,.95,cb())},Adam:function(){return am.adam(.001,.9,.999,cb())},Adamax:function(){return am.adamax(.002,.9,.999,cb(),0)},RMSProp:function(){return am.rmsprop(.001,.9,0,cb())},SGD:function(){return am.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new my("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Xh))throw new my("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new my("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));n=e.loss.map((function(e){return kk(e)}))}else{var r=kk(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new my('Unknown entry in loss dictionary: "'.concat(a,'". Only expected the following keys: ').concat(this.outputNames));var i,o=(0,x.Z)(this.outputNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;null==e.loss[s]&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(s," during training")),n.push(kk(e.loss[s]))}}catch(h){o.e(h)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var c=this.internalOutputShapes[u],l=this.outputNames[u];this.feedOutputNames.push(l),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[u])}var p=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Jy("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===p.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var d=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=(0,x.Z)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(h){i.e(h)}finally{i.f()}return a}(e.metrics,this.outputNames),f=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};Jy("metric",(function(){for(var e=function(e){if(-1!==p.indexOf(e))return"continue";!function(n){var r,a,i,o,s=(0,x.Z)(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"==typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===yk?-1!==["accuracy","acc"].indexOf(u)?a=wk:-1!==["crossentropy","ce"].indexOf(u)&&(a=Ck):t.lossFunctions[e]===gk?-1!==["accuracy","acc"].indexOf(u)?a=Ek:-1!==["crossentropy","ce"].indexOf(u)&&(a=Ak):-1!==["accuracy","acc"].indexOf(u)?a=Sk:-1!==["crossentropy","ce"].indexOf(u)&&(a=_k);var l=void 0;-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else i=Fk(u),r=""+Dk(u);var p=void 0;Jy(r,(function(){p=i})),f(e,r,p)}}catch(h){s.e(h)}finally{s.f()}}(d[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;sw(r);var a=!0,i=this.standardizeUserDataXY(e,t,a,r);try{var o=i[0].concat(i[1]);this.makeTestFunction();var s=this.testFunction,u=this.testLoop(s,o,r,n.verbose,n.steps);return wy(u)}finally{vw(i[0],e),vw(i[1],t)}}},{key:"evaluateDataset",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.makeTestFunction(),iw(this,t,n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new my("If ".concat(a," is set, batchSize must be null or undefined.Got batchSize = ").concat(t))}else{if(null==e)throw new my("Either the input data should have a defined shape, or ".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new my("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new hx;if(e instanceof hi&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new my("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=(0,x.Z)(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new my("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch(d){u.e(d)}finally{u.f()}}var p=gx(a,i);return n?p:p[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=by(null,e.length),r=e.length,a=(0,x.Z)(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(p){a.e(p)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new my("Cannot find SymbolicTensors for output name(s): ".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return qs((function(){var a=t.checkNumSamples(e);if(r)throw new vy("Verbose predictLoop() is not implemented yet.");for(var i=lw(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){qs((function(){var r=i[n][0],a=i[n][1],o=uw(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new hx(s);return gx(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return wy(o.map((function(e){return Kc(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=mw(e);ww(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return sw(r),this.predictLoop(n,r)}finally{vw(n,e)}}},{key:"predictOnBatch",value:function(e){ww(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new hy("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===gk?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(xw(e=bw(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=bw(t,this.feedOutputNames,r,!1,"target")),kw(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new my("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,d,f,h=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(h.length>4&&void 0!==h[4])||h[4],o=h.length>5?h[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=(0,m.Z)(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(p=null,null==a){e.next=19;break}d=qk(a,this.outputNames),p=[],f=0;case 10:if(!(f<d.length)){e.next=19;break}return e.t0=p,e.next=14,Kk(l[f],null,d[f]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++f,e.next=10;break;case 19:return e.abrupt("return",[c,l,p]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return qs((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new vy("Verbose mode is not implemented yet.");if(null!=i)throw new vy("steps mode in testLoop() is not implemented yet");for(var u=lw(o,n),c=nf(ub(0,o)),l=0;l<u.length;++l){var p=u[l][0],d=u[l][1],f=fb(c,p,d-p),h=cw(t,f),m=e(h);if(0===l)for(var v=0;v<m.length;++v)s.push(Xl(0));for(var g=0;g<m.length;++g){var y=m[g];s[g]=dc(s[g],mc(d-p,y))}}for(var b=0;b<s.length;++b)s[b]=hc(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;ky(e,r)>1&&(a+="_".concat(ky(e.slice(0,n),r))),t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new hx(t),l=gx(e.outputs,c,{training:!0}),p=0;p<e.lossFunctions.length;++p){var d=(0,e.lossFunctions[p])(a[p],l[p]);null!=i[p]&&(d=Yk(d,i[p]));var f=jp(d);n.push(f),u=0===p?d:dc(u,d)}for(var h=0;h<e.metricsTensors.length;++h){var m=void 0;if(e.outputs.length>1&&h<e.outputs.length)m=n[h];else{var v=e.metricsTensors[h][0],g=e.metricsTensors[h][1];m=jp(v(a[g],l[g]))}Xs(m),o.push(m)}return u=jp(u),e.calculateLosses().forEach((function(e){u=dc(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return qs((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new hx(o),c=gx(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var p=e.lossFunctions[l],d=jp(p(i[l],c[l]));n=0===l?d:dc(n,d),r.push(n)}for(var f=0;f<e.metricsTensors.length;++f){var h=e.metricsTensors[f][0],m=e.metricsTensors[f][1],v=jp(h(i[m],c[m]));r.push(v)}return r}))}}},{key:"fit",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",fw(this,t,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ew(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction()(a.concat(i)),s=[],u=(0,x.Z)(o),e.prev=8,u.s();case 10:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=14,l.data();case 14:p=e.sent,s.push(p[0]);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",(Ks(o),vw(r[0],t),vw(r[1],n),wy(s)));case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=js().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-js().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=Iy(this.loss);else if(Array.isArray(this.loss)){var t,n=(0,x.Z)(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(u){n.e(u)}finally{n.f()}e=this.loss.map((function(e){return Iy(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!=typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=Iy(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[Iy(Dk(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return Iy(Dk(e))}));var e={};for(var t in this.metrics)e[t]=Iy(Dk(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=pk(Uk(e.optimizer_config));if("string"==typeof e.loss)t=Ny(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return Ny(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=Ny(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return Ny(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=Ny(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=ds.getSaveHandlers(t)).length){e.next=4;break}throw new my("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new my("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new my("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.next=11,ds.encodeWeights(this.getNamedWeights(n));case 11:if(a=e.sent,!1,null,i={modelTopology:this.toJSON(null,false),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(jk),convertedBy:null},null==n||!n.includeOptimizer||null==this.optimizer){e.next=29;break}return i.trainingConfig=this.getTrainingConfig(),s="optimizer",e.t0=ds,e.next=21,this.optimizer.getWeights();case 21:return e.t1=e.sent,e.t2=s,e.next=25,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 25:u=e.sent,c=u.data,l=u.specs,(o=a.specs).push.apply(o,(0,h.Z)(l)),a.data=ds.concatenateArrayBuffers([a.data,c]);case 29:return e.abrupt("return",(null!=this.userDefinedMetadata&&(Zk(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=a.data,i.weightSpecs=a.specs,t.save(i)));case 30:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){Zk(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),n}(Hk);Sw.className="Model",Xu.registerClass(Sw);var Iw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n)}(Sw);function Nw(e,t){return Tw.apply(this,arguments)}function Tw(){return Tw=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("modelTopology"in t||(t={modelTopology:t}),null!=(r=t.modelTopology).model_config&&(r=r.model_config),a=Uk(r),i=pk(a,n),null==t.weightsManifest){e.next=12;break}return e.next=7,ds.loadWeights(t.weightsManifest,t.pathPrefix,i.weights.map((function(e){return e.originalName})));case 7:o=e.sent,s={},u=(0,x.Z)(i.weights);try{for(u.s();!(c=u.n()).done;)l=c.value,s[l.originalName]=o[l.originalName]}catch(p){u.e(p)}finally{u.f()}i.loadWeights(s),Ks(o);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)}))),Tw.apply(this,arguments)}function Cw(){return Cw=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!=typeof t){e.next=9;break}if(0!==(r=ds.getLoadHandlers(t,n)).length){e.next=6;break}r.push(ds.browserHTTPRequest(t,n)),e.next=8;break;case 6:if(!(r.length>1)){e.next=8;break}throw new my("Found more than one (".concat(r.length,") load handlers for URL '").concat(t,"'"));case 8:t=r[0];case 9:return e.abrupt("return",Ew(t,void 0,n));case 10:case"end":return e.stop()}}),e)}))),Cw.apply(this,arguments)}function Ew(e,t,n){return _w.apply(this,arguments)}function _w(){return _w=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=2;break}throw new my("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,t.load();case 4:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,s=null!=a.weightData&&null!=a.weightSpecs&&o,u=pk(Uk(i),n,s),null!=(c=a.trainingConfig)&&u.loadTrainingConfig(c),null!=a.userDefinedMetadata&&u.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=19;break}if(null!=a.weightSpecs){e.next=11;break}throw new my("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 11:if(l=Aw(a.weightData,a.weightSpecs),p=l.modelWeights,d=l.optimizerWeights,u.loadWeights(p,o),e.t0=null!=u.optimizer&&d.length>0,!e.t0){e.next=17;break}return e.next=17,u.optimizer.setWeights(d);case 17:Ks(p),Ks(d.map((function(e){return e.tensor})));case 19:return e.abrupt("return",u);case 20:case"end":return e.stop()}}),e)}))),_w.apply(this,arguments)}function Aw(e,t){var n=ds.decodeWeights(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}Iw.className="Functional",Xu.registerClass(Iw);var Rw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:Wy("sequential_"),null!=e.layers){var a,i=(0,x.Z)(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(s){i.e(s)}finally{i.f()}}return(0,l.Z)(r)}return(0,b.Z)(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new my("Negative dimension size caused by adding layer ".concat(e.name," with input shape [").concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof Sw;if(r){if(1!==(t=e).outputs.length)throw new my("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new my("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new my("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=fx({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new my("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new my("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=px(this.outputs[0])}this.inboundNodes=[],new ux({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:by(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if($b(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Sw({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),(0,o.Z)((0,s.Z)(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),(0,o.Z)((0,s.Z)(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new hy("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new hy("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new hy("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new hy("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new my("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new my("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=(0,x.Z)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(i){n.e(i)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new my("Legacy serialization format not supported yet.");r=t}else Fa.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new vy("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=(0,x.Z)(r);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=pk(c,void 0,a);a&&l.setFastWeightInitDuringBuild(!0),o.add(l)}}catch(p){u.e(p)}finally{u.f()}return o}}]),n}(Sw);function Fw(e){return new Sw(e)}function Dw(e){return new Rw(e)}function Zw(e,t){return null==t&&(t={}),function(e,t){return Cw.apply(this,arguments)}(e,t)}function Ow(e){return fx(e)}function Mw(e,t){ck.registerCallbackConstructor(e,t)}Rw.className="Sequential",Xu.registerClass(Rw);var zw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"getConfig",value:function(){return{}}}]),n}(Xu.Serializable),Lw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Nb(e,t)}}]),n}(zw);Lw.className="elu",Xu.registerClass(Lw);var Pw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return Dd(e)}}]),n}(zw);Pw.className="selu",Xu.registerClass(Pw);var Bw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return Id(e)}}]),n}(zw);Bw.className="relu",Xu.registerClass(Bw);var Ww=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return qs((function(){return Xp(6,Id(e))}))}}]),n}(zw);Ww.className="relu6",Xu.registerClass(Ww);var Vw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return e}}]),n}(zw);Vw.className="linear",Xu.registerClass(Vw);var Uw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return Xc(e)}}]),n}(zw);Uw.className="sigmoid",Xu.registerClass(Uw);var Gw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return function(e){return qs((function(){var t=dc(.5,mc(.2,e));return cl(t,0,1)}))}(e)}}]),n}(zw);Gw.className="hardSigmoid",Xu.registerClass(Gw);var jw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return _p(e)}}]),n}(zw);jw.className="softplus",Xu.registerClass(jw);var Hw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return function(e){return qs((function(){return hc(e,dc(vc(e),1))}))}(e)}}]),n}(zw);Hw.className="softsign",Xu.registerClass(Hw);var qw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return Qc(e)}}]),n}(zw);qw.className="tanh",Xu.registerClass(qw);var Kw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Gd(e,t)}}]),n}(zw);Kw.className="softmax",Xu.registerClass(Kw);var Xw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Fp(e,t)}}]),n}(zw);Xw.className="logSoftmax",Xu.registerClass(Xw);var Yw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return qs((function(){return mc(Xc(mc(e,t)),e)}))}}]),n}(zw);Yw.className="swish",Xu.registerClass(Yw);var Qw=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e){return qs((function(){return mc(e,Qc(_p(e)))}))}}]),n}(zw);function Jw(e){return e.getClassName()}function $w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _y(e,Xu.SerializationMap.getMap().classNameMap,t,"activation")}function eS(e){if(null==e){var t={className:"linear",config:{}};return $w(t)}if("string"==typeof e){var n={};return n.className=e,n.config={},$w(n)}return e instanceof zw?e:$w(e)}function tS(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: ".concat(e))}Qw.className="mish",Xu.registerClass(Qw);var nS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n)}(Xu.Serializable),rS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this),tS(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return(0,b.Z)(n,[{key:"apply",value:function(e){var t=this;return qs((function(){var n=Hp([1]);return t.hasL1&&(n=dc(n,Jl(mc(t.l1,vc(e))))),t.hasL2&&(n=dc(n,Jl(mc(t.l2,wb(e))))),jc(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(nS);rS.className="L1L2",Xu.registerClass(rS);var aS={l1l2:"L1L2"};function iS(e){return Cy(e)}function oS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _y(e,Xu.SerializationMap.getMap().classNameMap,t,"regularizer")}function sS(e){return null==e?null:"string"==typeof e?oS({className:e in aS?aS[e]:e,config:{}}):e instanceof nS?e:oS(e)}var uS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return(0,b.Z)(n,[{key:"call",value:function(e,t){e=Jb(e);var n=Id(e);return null!=this.maxValue&&(n=cl(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);uS.className="ReLU",Xu.registerClass(uS);var cS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return(0,b.Z)(n,[{key:"call",value:function(e,t){var n=Jb(e);return mp(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);cS.className="LeakyReLU",Xu.registerClass(cS);var lS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Xb(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=sS(e.alphaRegularizer),r.alphaConstraint=Rx(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new my("Expected sharedAxes to be a number or an array of numbers, but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return(0,l.Z)(r)}return(0,b.Z)(n,[{key:"build",value:function(e){var t=(e=$b(e)).slice(1);if(null!=this.sharedAxes){var n,r=(0,x.Z)(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(o){r.e(o)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new ix({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=Jb(e),pd(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:Kb(this.alphaInitializer),alphaRegularizer:iS(this.alphaRegularizer),alphaConstraint:_x(this.alphaConstraint),sharedAxes:this.sharedAxes},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);lS.className="PReLU",Xu.registerClass(lS);var pS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new vy("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,(0,l.Z)(r)}return(0,b.Z)(n,[{key:"call",value:function(e,t){var n=Jb(e);return Ml(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);pS.className="ELU",Xu.registerClass(pS);var dS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return(0,b.Z)(n,[{key:"call",value:function(e,t){var n=Jb(e);return mc(n,cs(lp(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);dS.className="ThresholdedReLU",Xu.registerClass(dS);var fS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new Kw).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return(0,b.Z)(n,[{key:"call",value:function(e,t){var n=Jb(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);function hS(e,t,n){if("number"==typeof e)return by(e,t);if(e.length!==t)throw new my("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!ab(a))throw new my("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ").concat(a))}return e}function mS(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(null==e)return e;var i,o=t+(t-1)*(a-1);return i="same"===n?e:e-o+1,Math.floor((i+r-1)/r)}function vS(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+sb([n-t,0]);else{if("same"!==r)throw new my("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function gS(e,t){return qs((function(){return Ky(t),"channelsFirst"===t?cu(e,[0,2,3,1]):e}))}function yS(e,t){return qs((function(){return Ky(t),"channelsFirst"===t?cu(e,[0,2,3,4,1]):e}))}function bS(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return qs((function(){if(null==i&&(i="channelsLast"),Ky(i),3!==e.rank&&4!==e.rank)throw new my("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new my("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));var u=gS(e,i);if("causal"===a)throw new vy("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Af.conv2d({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=cu(u,[0,3,1,2])),u}))}fS.className="Softmax",Xu.registerClass(fS);var xS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;if((0,y.Z)(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,Oy(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new vy("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is not implemented yet."));if(a.kernelSize=hS(r.kernelSize,e,"kernelSize"),a.strides=hS(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,Xy(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Ky(a.dataFormat),a.activation=eS(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=Xb(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Rx(r.biasConstraint),a.biasRegularizer=sS(r.biasRegularizer),a.activityRegularizer=sS(r.activityRegularizer),a.dilationRate=hS(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new my("dilationRate must be a number or an array of a single number for 1D convolution, but received ".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new my("dilationRate must be a number or array of two numbers for 2D convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new my("dilationRate must be a number or array of three numbers for 3D convolution, but received ".concat(JSON.stringify(a.dilationRate)));return(0,l.Z)(a)}return(0,b.Z)(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Jw(this.activation),useBias:this.useBias,biasInitializer:Kb(this.biasInitializer),biasRegularizer:iS(this.biasRegularizer),activityRegularizer:iS(this.activityRegularizer),biasConstraint:_x(this.biasConstraint)},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(xy("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!Zy(e.kernelSize,"number",1,3))throw new my("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(lx),kS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,Oy(a.filters,"filters"),a.kernelInitializer=Xb(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Rx(r.kernelConstraint),a.kernelRegularizer=sS(r.kernelRegularizer),a}return(0,b.Z)(n,[{key:"build",value:function(e){e=$b(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new my("The channel dimension of the input should be defined. Found ".concat(e[t]));var n=e[t],a=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(0,r.Z)({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){e=Jb(e);var t,r=null==n.bias?null:n.bias.read(),a=zy(n.activation.getClassName());if(null!=a&&2===n.rank)t=bS(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return qs((function(){if(null==i&&(i="channelsLast"),Ky(i),3!==e.shape.length)throw new my("The input of a conv1dWithBias operation should be 3, but is ".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new my("The kernel for a conv1dWithBias operation should be 3, but is ".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new my("The bias for a conv1dWithBias operation should be 1, but is ".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=cu(e,[0,2,1])),"causal"===a)throw new vy("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=ml(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=Ib(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=bS(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new vy("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return qs((function(){if(null==i&&(i="channelsLast"),Ky(i),4!==e.rank&&5!==e.rank)throw new my("conv3dWithBias expects input to be of rank 4 or 5, but received ".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new my("conv3dWithBias expects kernel to be of rank 4 or 5, but received ".concat(e.rank,"."));var s=yS(e,i);if("causal"===a)throw new vy("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=yl(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=Ib(s,n)),"channelsFirst"===i&&(s=cu(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=$b(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=mS(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:Kb(this.kernelInitializer),kernelRegularizer:iS(this.kernelRegularizer),kernelConstraint:_x(this.kernelConstraint)},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new my("Convolution layer expected config.filters to be a 'number' > 0 but got ".concat(JSON.stringify(e.filters)))}}]),n}(xS),wS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return(0,b.Z)(n,[{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!Zy(e.kernelSize,"number",1,2))throw new my("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(kS);wS.className="Conv2D",Xu.registerClass(wS);var SS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return(0,b.Z)(n,[{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new my("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(kS);SS.className="Conv3D",Xu.registerClass(SS);var IS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this,e)).inputSpec=[new ix({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new my("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return(0,l.Z)(r)}return(0,b.Z)(n,[{key:"build",value:function(e){if(4!==(e=$b(e)).length)throw new my("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new my("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],a=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",a,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ix({ndim:4,axes:(0,r.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){var t=Jb(e);if(4!==t.shape.length)throw new my("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],p=n.strides[0],d=n.strides[1],f=[o,vS(s,p,c,n.padding),vS(u,d,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=cu(t,[0,2,3,1]));var h=gl(t,n.kernel.read(),f,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(h=cu(h,[0,3,1,2])),null!=n.bias&&(h=Ib(h,n.bias.read(),n.dataFormat)),null!=n.activation&&(h=n.activation.apply(h)),h}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=$b(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=vS(a[n],s,i,this.padding),a[r]=vS(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(wS);IS.className="Conv2DTranspose",Xu.registerClass(IS);var NS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this,e)).inputSpec=[new ix({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new my("Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return(0,l.Z)(r)}return(0,b.Z)(n,[{key:"build",value:function(e){if(5!==(e=$b(e)).length)throw new my("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new my("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],a=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",a,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new ix({ndim:5,axes:(0,r.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){var t=Jb(e);if(5!==t.shape.length)throw new my("Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],p=n.kernelSize[0],d=n.kernelSize[1],f=n.kernelSize[2],h=n.strides[0],m=n.strides[1],v=n.strides[2],g=[s,vS(u,h,p,n.padding),vS(c,m,d,n.padding),vS(l,v,f,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=cu(t,[0,2,3,4,1]));var y=xl(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=cu(y,[0,4,1,2,3])),null!==n.bias&&(y=Ib(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=$b(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],p=this.strides[2];return i[t]=this.filters,i[n]=vS(i[n],c,o,this.padding),i[r]=vS(i[r],l,s,this.padding),i[a]=vS(i[a],p,u,this.padding),i}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(SS);NS.className="Conv3DTranspose",Xu.registerClass(NS);var TS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;if((0,y.Z)(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new my("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new my("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new my("SeparableConv".concat(a.rank,"D supports only padding modes: 'same' and 'valid', but received ").concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=Xb(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=sS(r.depthwiseRegularizer),a.depthwiseConstraint=Rx(r.depthwiseConstraint),a.pointwiseInitializer=Xb(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=sS(r.pointwiseRegularizer),a.pointwiseConstraint=Rx(r.pointwiseConstraint),(0,l.Z)(a)}return(0,b.Z)(n,[{key:"build",value:function(e){if((e=$b(e)).length<this.rank+2)throw new my("Inputs to SeparableConv".concat(this.rank,"D should have rank ").concat(this.rank+2,", but received input shape: ").concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new my("The channel dimension of the inputs should be defined, but found ".concat(JSON.stringify(e[t])));for(var n=e[t],a=this.kernelSize.concat([n,this.depthMultiplier]),i=[],o=0;o<this.rank;++o)i.push(1);i.push(n*this.depthMultiplier,this.filters);var s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",a,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new ix({ndim:this.rank+2,axes:(0,r.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){var t;if(e=Jb(e),1===n.rank)throw new vy("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=cu(e,[0,2,3,1])),t=Zd(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=Ib(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=cu(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Kb(this.depthwiseInitializer),e.pointwiseInitializer=Kb(this.pointwiseInitializer),e.depthwiseRegularizer=iS(this.depthwiseRegularizer),e.pointwiseRegularizer=iS(this.pointwiseRegularizer),e.depthwiseConstraint=_x(this.depthwiseConstraint),e.pointwiseConstraint=_x(this.pointwiseConstraint),e}}]),n}(kS);TS.className="SeparableConv";var CS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,2,e)}return(0,b.Z)(n)}(TS);CS.className="SeparableConv2D",Xu.registerClass(CS);var ES=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return(0,b.Z)(n,[{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!Zy(e.kernelSize,"number",1,1))throw new my("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(kS);ES.className="Conv1D",Xu.registerClass(ES);var _S=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,e),"number"==typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return qs((function(){if(e=Jb(e),"channelsLast"===n.dataFormat){var t=mb(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return mb(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=mb(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return mb(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);_S.className="Cropping2D",Xu.registerClass(_S);var AS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ky(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){Dy(Uy,"InterpolationFormat",e)}(r.interpolation),r}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return qs((function(){var t=Jb(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=cu(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?Gh.resizeNearestNeighbor(t,[a,i]):Gh.resizeBilinear(t,[a,i]);return cu(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?Gh.resizeNearestNeighbor(t,[s,u]):Gh.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);AS.className="UpSampling2D",Xu.registerClass(AS);var RS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Xb(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=Rx(e.depthwiseConstraint),r.depthwiseRegularizer=sS(e.depthwiseRegularizer),r}return(0,b.Z)(n,[{key:"build",value:function(e){if((e=$b(e)).length<4)throw new my("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new my("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return qs((function(){null==a&&(a="channelsLast"),Ky(a);var o=gS(e,a);if(4!==e.rank)throw new my("Input for depthwiseConv2d is required to be 4-D, but is instead ".concat(e.rank,"-D"));if(4!==t.rank)throw new my("depthwiseKernel is required to be 4-D, but is instead ".concat(t.rank,"-D"));return o=Cl(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=cu(o,[0,3,1,2])),o}))}(e=Jb(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=Ib(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=$b(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=mS(t,this.kernelSize[0],this.padding,this.strides[0]),i=mS(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Kb(this.depthwiseInitializer),e.depthwiseRegularizer=iS(this.depthwiseRegularizer),e.depthwiseConstraint=_x(this.depthwiseRegularizer),e}}]),n}(xS);function FS(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new my("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function DS(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return qs((function(){var u=t.shape.length;if(u<3)throw new my("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(ub(2,u));if(t=cu(t,c),null!=i)throw new vy("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=cs(cs(a,"bool"),"float32")).rank===u-1&&(a=rp(a,-1)),a=cu(a,c)),r&&(t=Td(t,0),null!=a&&(a=Td(a,0)));var l,p,d=[],f=n,h=t.shape[0],m=df(t);null!=a&&(p=df(a));for(var v,g=function(t){var n=m[t],r=qs((function(){return e(n,f)}));if(null==a)l=r[0],f=r[1];else{var i=qs((function(){var e=p[t],n=Rp(nd(e),e);return{output:dc(mc(r[0],e),mc(f[0],n)),newStates:f.map((function(t,a){return dc(mc(r[1][a],e),mc(t,n))}))}}));l=i.output,f=i.newStates}s&&d.push(l)},y=0;y<h;++y)g(y);return s&&(v=Jd(d,1)),[l,v,f]}))}RS.className="DepthwiseConv2D",Xu.registerClass(RS);var ZS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,a;if((0,y.Z)(this,n),r=t.call(this,e),null==e.cell)throw new my("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new VS({cells:e.cell}):e.cell).stateSize)throw new my("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new ix({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return(0,b.Z)(n,[{key:"getStates",value:function(){return null==this.states_?ub(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){Yb(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=(0,x.Z)(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(u){o.e(u)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return qs((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new vy("Constants support is not implemented in RNN yet.");Yb(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new ix({shape:[t,null].concat((0,h.Z)(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Fa.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new my("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ").concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new ix({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];qs((function(){if(!t.stateful)throw new fy("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new my("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Hp([r,e])})):t.states_=[Hp([r,t.cell.stateSize])];else if(null==e)Ks(t.states_),null!=t.keptStates&&(Ks(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Hp([r,e])})):t.states_[0]=Hp([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new my("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));!0===n?t.keptStates.push(t.states_.slice()):Ks(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!Fa.arraysEqual(i.shape,s))throw new my("State ".concat(a," is incompatible with layer ").concat(t.name,": expected shape=").concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return Xs(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=FS(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var u=[],c=[];if(null!=r){t.initialState=r,u=u.concat(r),this.stateSpec=[];var l,p=(0,x.Z)(r);try{for(p.s();!(l=p.n()).done;){var d=l.value;this.stateSpec.push(new ix({shape:d.shape}))}}catch(g){p.e(g)}finally{p.f()}c=c.concat(this.stateSpec)}if(null!=a&&(t.constants=a,u=u.concat(a),this.numConstants=a.length),u[0]instanceof ox){var f=[e].concat(u),h=this.inputSpec.concat(c),m=this.inputSpec;this.inputSpec=h;var v=(0,o.Z)((0,s.Z)(n.prototype),"apply",this).call(this,f,t);return this.inputSpec=m,v}return(0,o.Z)((0,s.Z)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return qs((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=Jb(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new my("RNN Layer has ".concat(o," state(s) but was passed ").concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=DS((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],p=u[2];n.stateful&&n.resetStates(p,a);var d=n.returnSequences?l:c;return n.returnState?[d].concat(p):d}))}},{key:"getInitialState",value:function(e){var t=this;return qs((function(){var n=Hp(e.shape);return n=pb(n=Jl(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?yb(n,[1,e]):n})):t.cell.stateSize>1?[yb(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){(0,o.Z)((0,s.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.cell,a=pk(r,n);return new e(Object.assign(t,{cell:a}))}}]),n}(lx);ZS.className="RNN",Xu.registerClass(ZS);var OS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n)}(lx),MS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Oy(r.units,"units"),r.activation=eS(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Xb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Xb(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Xb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=sS(e.kernelRegularizer),r.recurrentRegularizer=sS(e.recurrentRegularizer),r.biasRegularizer=sS(e.biasRegularizer),r.kernelConstraint=Rx(e.kernelConstraint),r.recurrentConstraint=Rx(e.recurrentConstraint),r.biasConstraint=Rx(e.biasConstraint),r.dropout=ob([1,sb([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=ob([1,sb([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,b.Z)(n,[{key:"build",value:function(e){e=$b(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){if(2!==e.length)throw new my("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=US({ones:function(){return nd(e)},rate:n.dropout,training:a,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=US({ones:function(){return nd(r)},rate:n.recurrentDropout,training:a,dropoutFunc:n.dropoutFunc}));var i,o=n.dropoutMask,s=n.recurrentDropoutMask;i=xb(null!=o?mc(e,o):e,n.kernel.read()),null!=n.bias&&(i=Ib(i,n.bias.read())),null!=s&&(r=mc(r,s));var u=dc(i,xb(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Jw(this.activation),useBias:this.useBias,kernelInitializer:Kb(this.kernelInitializer),recurrentInitializer:Kb(this.recurrentInitializer),biasInitializer:Kb(this.biasInitializer),kernelRegularizer:iS(this.kernelRegularizer),recurrentRegularizer:iS(this.recurrentRegularizer),biasRegularizer:iS(this.biasRegularizer),activityRegularizer:iS(this.activityRegularizer),kernelConstraint:_x(this.kernelConstraint),recurrentConstraint:_x(this.recurrentConstraint),biasConstraint:_x(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}(OS);MS.className="SimpleRNNCell",Xu.registerClass(MS);var zS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),e.cell=new MS(e),t.call(this,e)}return(0,b.Z)(n,[{key:"call",value:function(e,t){var r=this;return qs((function(){null!=r.cell.dropoutMask&&(Ks(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ks(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,u=null==t?null:t.initialState;return(0,o.Z)((0,s.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:u})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(ZS);zS.className="SimpleRNN",Xu.registerClass(zS);var LS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new my("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,Oy(r.units,"units"),r.activation=eS(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=eS(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Xb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Xb(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Xb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=sS(e.kernelRegularizer),r.recurrentRegularizer=sS(e.recurrentRegularizer),r.biasRegularizer=sS(e.biasRegularizer),r.kernelConstraint=Rx(e.kernelConstraint),r.recurrentConstraint=Rx(e.recurrentConstraint),r.biasConstraint=Rx(e.biasConstraint),r.dropout=ob([1,sb([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=ob([1,sb([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,(0,l.Z)(r)}return(0,b.Z)(n,[{key:"build",value:function(e){var t=(e=$b(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){if(2!==e.length)throw new my("GRUCell expects 2 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=US({ones:function(){return nd(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=US({ones:function(){return nd(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=mc(e,u[0]));var l=xb(e,n.kernel.read());n.useBias&&(l=Ib(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=mc(a,c[0]));var p=n.recurrentKernel.read(),d=Kd(p,[2*n.units,n.units],p.rank-1),f=(0,m.Z)(d,2),h=f[0],v=f[1],g=xb(a,h),y=Kd(l,3,l.rank-1),b=(0,m.Z)(y,3),x=b[0],k=b[1],w=b[2],S=Kd(g,2,g.rank-1),I=(0,m.Z)(S,2),N=I[0],T=I[1];i=n.recurrentActivation.apply(dc(x,N)),o=n.recurrentActivation.apply(dc(k,T));var C=xb(mc(o,a),v);s=n.activation.apply(dc(w,C));var E=dc(mc(i,a),mc(dc(1,su(i)),s));return[E,E]}))}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Jw(this.activation),recurrentActivation:Jw(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Kb(this.kernelInitializer),recurrentInitializer:Kb(this.recurrentInitializer),biasInitializer:Kb(this.biasInitializer),kernelRegularizer:iS(this.kernelRegularizer),recurrentRegularizer:iS(this.recurrentRegularizer),biasRegularizer:iS(this.biasRegularizer),activityRegularizer:iS(this.activityRegularizer),kernelConstraint:_x(this.kernelConstraint),recurrentConstraint:_x(this.recurrentConstraint),biasConstraint:_x(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),n}(OS);LS.className="GRUCell",Xu.registerClass(LS);var PS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new LS(e),t.call(this,e)}return(0,b.Z)(n,[{key:"call",value:function(e,t){var r=this;return qs((function(){null!=r.cell.dropoutMask&&(Ks(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ks(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,u=null==t?null:t.initialState;return(0,o.Z)((0,s.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:u})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(ZS);PS.className="GRU",Xu.registerClass(PS);var BS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Oy(r.units,"units"),r.activation=eS(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=eS(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Xb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Xb(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Xb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=sS(e.kernelRegularizer),r.recurrentRegularizer=sS(e.recurrentRegularizer),r.biasRegularizer=sS(e.biasRegularizer),r.kernelConstraint=Rx(e.kernelConstraint),r.recurrentConstraint=Rx(e.recurrentConstraint),r.biasConstraint=Rx(e.biasConstraint),r.dropout=ob([1,sb([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=ob([1,sb([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,b.Z)(n,[{key:"build",value:function(e){var t,n,r=(e=$b(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new Fb).apply([i]),o=a.apply([2*i]);return gb(gb(n,r),o)}}]),n}(Ab),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new my("LSTMCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=US({ones:function(){return nd(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=US({ones:function(){return nd(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,c,l=n.dropoutMask,p=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=mc(e,l[0]));var d=xb(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=mc(a,p[0])),d=dc(d,xb(a,n.recurrentKernel.read())),n.useBias&&(d=Ib(d,n.bias.read()));var f=Kd(d,4,d.rank-1),h=(0,m.Z)(f,4),v=h[0],g=h[1],y=h[2],b=h[3];o=n.recurrentActivation.apply(v),s=n.recurrentActivation.apply(g),u=dc(mc(s,i),mc(o,n.activation.apply(y))),c=n.recurrentActivation.apply(b);var x=mc(c,n.activation.apply(u));return[x,x,u]}))}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Jw(this.activation),recurrentActivation:Jw(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Kb(this.kernelInitializer),recurrentInitializer:Kb(this.recurrentInitializer),biasInitializer:Kb(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:iS(this.kernelRegularizer),recurrentRegularizer:iS(this.recurrentRegularizer),biasRegularizer:iS(this.biasRegularizer),activityRegularizer:iS(this.activityRegularizer),kernelConstraint:_x(this.kernelConstraint),recurrentConstraint:_x(this.recurrentConstraint),biasConstraint:_x(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),n}(OS);BS.className="LSTMCell",Xu.registerClass(BS);var WS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new BS(e),t.call(this,e)}return(0,b.Z)(n,[{key:"call",value:function(e,t){var r=this;return qs((function(){null!=r.cell.dropoutMask&&(Ks(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ks(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,u=null==t?null:t.initialState;return(0,o.Z)((0,s.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:u})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(ZS);WS.className="LSTM",Xu.registerClass(WS);var VS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).cells=e.cells,r}return(0,b.Z)(n,[{key:"stateSize",get:function(){var e,t=[],n=(0,x.Z)(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,(0,h.Z)(r.stateSize)):t.push(r.stateSize)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return qs((function(){var r,a=e.slice(1),i=[],o=(0,x.Z)(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(g){o.e(g)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var p=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=p.call(u,t),c.push(u.slice(1))}a=[];var d,f=(0,x.Z)(c.slice().reverse());try{for(f.s();!(d=f.n()).done;){var m,v=d.value;(m=a).push.apply(m,(0,h.Z)(v))}}catch(g){f.e(g)}finally{f.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;Yb(e)&&(e=e[0]),this.cells.forEach((function(n,r){Jy("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign({},e,t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=(0,x.Z)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,h.Z)(r.trainableWeights))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=(0,x.Z)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,h.Z)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=(0,x.Z)(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,h.Z)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=(0,x.Z)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,h.Z)(r.weights))}}catch(a){n.e(a)}finally{n.f()}return rx(t)}},{key:"setWeights",value:function(e){var t,n=[],r=(0,x.Z)(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(u){r.e(u)}finally{r.f()}ax(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=(0,x.Z)(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(pk(o,r))}}catch(s){i.e(s)}finally{i.f()}return new e({cells:a})}}]),n}(OS);function US(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):Tb(t(),n)},c=function(){return Cb(u,t,a)};return!o||o<=1?Xs(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return Xs(e.clone())}))}VS.className="StackedRNNCells",Xu.registerClass(VS);var GS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),e.unroll)throw new vy("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new vy("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new ix({ndim:5})],r}return(0,b.Z)(n,[{key:"call",value:function(e,t){var r=this;return qs((function(){if(null!=r.cell.dropoutMask&&(Ks(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ks(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new my("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,u=null==t?null:t.initialState;return(0,o.Z)((0,s.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:u})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat((0,h.Z)(t.slice(2)))),this.returnState&&(t=[t].concat((0,h.Z)(Array(2).fill([e[0]].concat((0,h.Z)(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return qs((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=Hp([a[0]].concat((0,h.Z)(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];qs((function(){if(!t.stateful)throw new fy("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat((0,h.Z)(a.slice(2)));if(null==r[0])throw new my("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Hp(i)})):t.states_=[Hp(i)];else if(null==e)Ks(t.states_),null!=t.keptStates&&(Ks(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Hp(i)})):t.states_[0]=Hp(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new my("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));n?t.keptStates.push(t.states_.slice()):Ks(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!Fa.arraysEqual(s.shape,u))throw new my("State ".concat(o," is incompatible with layer ").concat(t.name,": expected shape=").concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return Xs(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],p=mS(c,a[0],i,o[0],s[0]),d=mS(l,a[1],i,o[1],s[1]);return[].concat((0,h.Z)(e.slice(0,2)),(0,h.Z)(u?[r,p,d]:[p,d,r]))}}]),n}(ZS);GS.className="ConvRNN2D";var jS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;(0,y.Z)(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign({},e,{units:a}))).filters=a,Oy(r.filters,"filters"),r.kernelSize=hS(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return Oy(e,"kernelSize")})),r.strides=hS(o||1,2,"strides"),r.strides.forEach((function(e){return Oy(e,"strides")})),r.padding=s||"valid",Xy(r.padding),r.dataFormat=u||"channelsLast",Ky(r.dataFormat),r.dilationRate=hS(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return Oy(e,"dilationRate")})),r}return(0,b.Z)(n,[{key:"build",value:function(e){var t;e=$b(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new my("The channel dimension of the input should be defined. Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"apply",value:function(e,t){return vb([s.apply([u]),qp([u]),s.apply([2*u])])}}]),n}(Ab),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){if(3!==e.length)throw new my("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=US({ones:function(){return nd(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?mc(t[n],e):e},c=u(a,s,0),l=u(a,s,1),p=u(a,s,2),d=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=US({ones:function(){return nd(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var f=n.recurrentDropoutMask,h=u(i,f,0),v=u(i,f,1),g=u(i,f,2),y=u(i,f,3),b=Kd(n.kernel.read(),4,3),x=(0,m.Z)(b,4),k=x[0],w=x[1],S=x[2],I=x[3],N=n.useBias?Kd(n.bias.read(),4):[null,null,null,null],T=(0,m.Z)(N,4),C=T[0],E=T[1],_=T[2],A=T[3];c=n.inputConv(c,k,C,n.padding),l=n.inputConv(l,w,E,n.padding),p=n.inputConv(p,S,_,n.padding),d=n.inputConv(d,I,A,n.padding);var R=Kd(n.recurrentKernel.read(),4,3),F=(0,m.Z)(R,4),D=F[0],Z=F[1],O=F[2],M=F[3];h=n.recurrentConv(h,D),v=n.recurrentConv(v,Z),g=n.recurrentConv(g,O),y=n.recurrentConv(y,M);var z=n.recurrentActivation.apply(dc(c,h)),L=n.recurrentActivation.apply(dc(l,v)),P=dc(mc(L,o),mc(z,n.activation.apply(dc(p,g)))),B=mc(n.recurrentActivation.apply(dc(d,y)),n.activation.apply(P));return[B,B,P]}))}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t=(e.units,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,r)}},{key:"inputConv",value:function(e,t,n,r){var a=hl(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?Ib(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return hl(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(BS);jS.className="ConvLSTM2DCell",Xu.registerClass(jS);var HS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){(0,y.Z)(this,n);var r=new jS(e);return t.call(this,Object.assign({},e,{cell:r}))}return(0,b.Z)(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(GS);HS.className="ConvLSTM2D",Xu.registerClass(HS);var qS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return(0,b.Z)(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t);var r=Jb(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return Cb((function(){return Tb(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return(0,o.Z)((0,s.Z)(n.prototype),"dispose",this).call(this)}}]),n}(lx);qS.className="Dropout",Xu.registerClass(qS);var KS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return(0,b.Z)(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(qS);KS.className="SpatialDropout1D",Xu.registerClass(KS);var XS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,Oy(r.units,"units"),r.activation=eS(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Xb(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Xb(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=Rx(e.kernelConstraint),r.biasConstraint=Rx(e.biasConstraint),r.kernelRegularizer=sS(e.kernelRegularizer),r.biasRegularizer=sS(e.biasRegularizer),r.activityRegularizer=sS(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],(0,l.Z)(r)}return(0,b.Z)(n,[{key:"build",value:function(e){var t=(e=$b(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(0,r.Z)({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=$b(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t);var r,a=Jb(e),i=zy(n.activation.getClassName());return null!=i?r=xb(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=xb(a,n.kernel.read()),null!=n.bias&&(r=Ib(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:Jw(this.activation),useBias:this.useBias,kernelInitializer:Kb(this.kernelInitializer),biasInitializer:Kb(this.biasInitializer),kernelRegularizer:iS(this.kernelRegularizer),biasRegularizer:iS(this.biasRegularizer),activityRegularizer:iS(this.activityRegularizer),kernelConstraint:_x(this.kernelConstraint),biasConstraint:_x(this.biasConstraint)},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);XS.className="Dense",Xu.registerClass(XS);var YS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){e=$b(e);var t,n=(0,x.Z)(e.slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new my('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'))}}catch(r){n.e(r)}finally{n.f()}return[e[0],ib(e,1)]}},{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t);var r=Jb(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=cu(r,a)}return function(e){if(e.rank<=1)throw new my("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],ib(e.shape,1)];return jc(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);YS.className="Flatten",Xu.registerClass(YS);var QS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=eS(e.activation),r}return(0,b.Z)(n,[{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t);var r=Jb(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:Jw(this.activation)},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);QS.className="Activation",Xu.registerClass(QS);var JS=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return qs((function(){return function(e,t){return qs((function(){if(2!==e.shape.length)throw new my("repeat() expects a rank-2 tensor, but received a rank-".concat(e.shape.length," tensor."));return yb(pb(e,1),[1,t,1])}))}(e=Jb(e),n.n)}))}},{key:"getConfig",value:function(){var e={n:this.n},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);JS.className="RepeatVector",Xu.registerClass(JS);var $S=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;(0,y.Z)(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return(0,b.Z)(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new my("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=ib(e);if(null!==i){if(0===a||u%a!==0)throw new my(n);r[i]=u/a}else if(u!==a)throw new my(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t);var r=Jb(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return jc(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);$S.className="Reshape",Xu.registerClass($S);var eI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received ".concat(e.dims," instead."));var a=ub(1,e.dims.length+1);if(!Fa.arraysEqual(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new ix({ndim:r.dims.length+1})],(0,l.Z)(r)}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){var t=(e=$b(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return cu(Jb(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);eI.className="Permute",Xu.registerClass(eI);var tI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=Jb(e);return kc(td(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t);var r=Jb(e),a=kc(td(r,n.maskValue),-1,!0);return mc(r,cs(a,r.dtype))}))}}]),n}(lx);tI.className="Masking",Xu.registerClass(tI);var nI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(Sy(e.inputLength))}return r.inputDim=e.inputDim,Oy(r.inputDim,"inputDim"),r.outputDim=e.outputDim,Oy(r.outputDim,"outputDim"),r.embeddingsInitializer=Xb(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=sS(e.embeddingsRegularizer),r.activityRegularizer=sS(e.activityRegularizer),r.embeddingsConstraint=Rx(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,(0,l.Z)(r)}return(0,b.Z)(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return qs((function(){return n.maskZero?(e=Jb(e),td(e,Fl(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=$b(e),null==this.inputLength)return[].concat((0,h.Z)(e),[this.outputDim]);var t=Sy(this.inputLength);if(t.length!==e.length-1)throw new my('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new my('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat((0,h.Z)(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t);var r=Jb(e);"int32"!==r.dtype&&(r=lb(r,"int32"));var a=kb(n.embeddings.read(),jc(r,[r.size]));return jc(a,$b(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Kb(this.embeddingsInitializer),embeddingsRegularizer:iS(this.embeddingsRegularizer),activityRegularizer:iS(this.activityRegularizer),embeddingsConstraint:_x(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);nI.className="Embedding",Xu.registerClass(nI);var rI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return(0,b.Z)(n,[{key:"mergeFunction",value:function(e){throw new vy}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new my("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[$b(e)]),e.length<2)throw new my("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));var t,n=[],r=(0,x.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(c){r.e(c)}finally{r.f()}if((n=Ry(n)).length>1)throw new my("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===Ry(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=sb(r),o=(0,x.Z)(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=pb(s,1);t.push(s)}}catch(C){o.e(C)}finally{o.f()}return n.mergeFunction(t)}var l,p=!1,d=(0,x.Z)(e);try{for(d.s();!(l=d.n()).done;){var f=l.value,h=f.rank;if(null==h){var m=f.shape,v=m[0],g=m.slice(1).concat([v]),y=jc(f,[v].concat(ib(m.slice(1))));y=cu(y,[1,0]),y=jc(y,g),t.push(y),p=!0}else if(h>1){var b=ub(1,h).concat([0]);t.push(cu(f,b)),p=!0}else t.push(f)}}catch(C){d.e(C)}finally{d.f()}var k=n.mergeFunction(t),w=k.rank;if(p)if(null==w){var S=k.shape,I=S[S.length-1],N=[I].concat(S.slice(0,S.length-1));k=jc(cu(jc(k,[-1,I]),[1,0]),N)}else if(w>1){var T=[w-1].concat(ub(0,w-1));k=cu(k,T)}return k}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=(0,x.Z)(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(u){o.e(u)}finally{o.f()}return t=1===(i=Ry(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return qs((function(){if(null==t)return null;if(!Array.isArray(t))throw new my("`mask` should be an Array");if(!Array.isArray(e))throw new my("`inputs` should be an Array");if(t.length!==e.length)throw new my("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;t=t.map((function(e){return null==e?e:rp(e,0)}));for(var n=t[0],r=1;r<t.length-1;++r)n=Zp(n,t[r]);return n}))}}]),n}(lx),aI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"mergeFunction",value:function(e){return qs((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=dc(t,e[n]);return t}))}}]),n}(rI);aI.className="Add",Xu.registerClass(aI);var iI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"mergeFunction",value:function(e){return qs((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=mc(t,e[n]);return t}))}}]),n}(rI);iI.className="Multiply",Xu.registerClass(iI);var oI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"mergeFunction",value:function(e){return qs((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=dc(t,e[n]);return mc(1/e.length,t)}))}}]),n}(rI);oI.className="Average",Xu.registerClass(oI);var sI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"mergeFunction",value:function(e){return qs((function(){for(var t=e[0],n=1;n<e.length;++n)t=Gp(t,e[n]);return t}))}}]),n}(rI);sI.className="Maximum",Xu.registerClass(sI);var uI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"mergeFunction",value:function(e){return qs((function(){for(var t=e[0],n=1;n<e.length;++n)t=Xp(t,e[n]);return t}))}}]),n}(rI);uI.className="Minimum",Xu.registerClass(uI);var cI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return(0,b.Z)(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new my("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=(0,x.Z)(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(p){r.e(p)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=(0,x.Z)(a);try{for(c.s();!(s=c.n()).done;){var l=s.value;if(Fa.arraysEqual(l,o)){u=!0;break}}}catch(p){c.e(p)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new my("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return qs((function(){return vb(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new my("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=(0,x.Z)(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new my("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new my("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new my("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return qs((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(cs(nd(e[i]),"bool")):t[i].rank<e[i].rank?a.push(rp(t[i],-1)):a.push(t[i]);var o=Kc(a,n.axis);return xc(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(rI);function lI(e,t){for(;e<0;)e+=t;return e}cI.className="Concatenate",Xu.registerClass(cI);var pI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return(0,b.Z)(n,[{key:"build",value:function(e){Fa.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new vy("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new my("Dimension incompatibility: ".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new my("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return lI(t,e[n].shape.length)})):[lI(this.axes,n.shape.length),lI(this.axes,r.shape.length)],this.normalize&&(n=dk(n,t[0]),r=dk(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new vy("batchDot is not implemented for tensors of 4D or higher rank yet");if(Fa.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got ".concat(e.shape.length)})),Fa.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got ".concat(t.shape.length)})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new vy("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return qs((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=jc(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=jc(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?Jl(mc(e,t),i[0]):Jl(mc(cu(e,[1,0]),t),i[1]);else{var p=i[0]!==e.shape.length-1,d=i[1]===t.shape.length-1;o=zs(e,t,p,d)}if(n>0){for(var f,h=[],m=f=r>a?r+a-3:r-1;m<f+n;++m)h.push(m);o=Qd(o,h)}return 1===o.shape.length&&(o=rp(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[lI(this.axes,e.length),lI(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){Fa.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new vy("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(rI);pI.className="Dot",Xu.registerClass(pI);var dI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t);var r=Jb(e);return Cb((function(){return dc(bb(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(lx);dI.className="GaussianNoise",Xu.registerClass(dI);var fI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t);var r=Jb(e);return n.rate>0&&n.rate<1?Cb((function(){var e=Math.sqrt(n.rate/(1-n.rate));return mc(r,bb(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))}}]),n}(lx);fI.className="GaussianDropout",Xu.registerClass(fI);var hI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return(0,b.Z)(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||Jb(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return qs((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return Cb((function(){var t=Jb(e),a=-1.7580993408473766,i=pp(kd(r),n.rate);i=lb(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=dc(mc(t,i),mc(dc(i,-1),a));return dc(mc(u,o),s)}),(function(){return Jb(e)}),t.training||!1)}return e}))}}]),n}(lx);function mI(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=nl(e,t,n,r,a,o);else if(3===e.rank)i=rl(e,t,n,r,a,o);else{if(4!==e.rank)throw new vy("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=al(e,t,n,r,a,o)}return i}function vI(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return qs((function(){var i=Jp(e,r),o=i.mean,s=i.variance;return[mI(e,o,s,n,t,a),o,s]}))}function gI(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return qs((function(){var i,o=Jp(e,r),s=o.mean,u=o.variance,c=[],l=(0,x.Z)(ub(0,e.rank));try{for(l.s();!(i=l.n()).done;){var p=i.value;-1!==r.indexOf(p)?c.push(1):c.push(e.shape[p])}}catch(v){l.e(v)}finally{l.f()}var d=jc(s,c),f=jc(u,c),h=null==t?null:jc(t,c),m=null==n?null:jc(n,c);return[mI(e,d,f,m,h,a),s,u]}))}hI.className="AlphaDropout",Xu.registerClass(hI);var yI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Xb(e.betaInitializer||"zeros"),r.gammaInitializer=Xb(e.gammaInitializer||"ones"),r.movingMeanInitializer=Xb(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Xb(e.movingVarianceInitializer||"ones"),r.betaConstraint=Rx(e.betaConstraint),r.gammaConstraint=Rx(e.gammaConstraint),r.betaRegularizer=sS(e.betaRegularizer),r.gammaRegularizer=sS(e.gammaRegularizer),r}return(0,b.Z)(n,[{key:"build",value:function(e){e=$b(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new my("Axis ".concat(t," of input tensor should have a defined dimension but the layer received an input with shape ").concat(JSON.stringify(e),"."));this.inputSpec=[new ix({ndim:e.length,axes:(0,r.Z)({},t,n)})];var a=[n];this.scale&&(this.gamma=this.addWeight("gamma",a,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",a,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",a,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",a,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return qs((function(){var r=null!=t.training&&t.training,a=Jb(e),i=a.shape,o=i.length,s=ub(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=by(1,o);c[u]=i[u];var l=s.slice();l.sort();var p=!Fa.arraysEqual(l,ub(0,o).slice(0,o-1));if(!r)return function(){if(p){var e=jc(n.movingMean.read(),c),t=jc(n.movingVariance.read(),c),r=n.center?jc(n.beta.read(),c):null,i=n.scale?jc(n.gamma.read(),c):null;return mI(a,e,t,r,i,n.epsilon)}return mI(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var d=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Fa.arraysEqual(r.slice().sort(),ub(0,e.rank-1))?vI(e,t,n,r,a):gI(e,t,n,r,a)}(a,n.gamma.read(),n.beta.read(),s,n.epsilon),f=(0,m.Z)(d,3),h=f[0],v=f[1],g=f[2],y=function(e,t,n){qs((function(){var r=1-n,a=e.read(),i=mc(Rp(a,t),r);e.write(Rp(a,i))}))};return y(n.movingMean,v,n.momentum),y(n.movingVariance,g,n.momentum),h}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Kb(this.betaInitializer),gammaInitializer:Kb(this.gammaInitializer),movingMeanInitializer:Kb(this.movingMeanInitializer),movingVarianceInitializer:Kb(this.movingVarianceInitializer),betaRegularizer:iS(this.betaRegularizer),gammaRegularizer:iS(this.gammaRegularizer),betaConstraint:_x(this.betaConstraint),gammaConstraint:_x(this.gammaConstraint)},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);yI.className="BatchNormalization",Xu.registerClass(yI);var bI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received ".concat(JSON.stringify(r.axis)));var a,i=(0,x.Z)(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received ".concat(JSON.stringify(r.axis)))}}catch(s){i.e(s)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Xb(e.betaInitializer||"zeros"),r.gammaInitializer=Xb(e.gammaInitializer||"ones"),r.betaRegularizer=sS(e.betaRegularizer),r.gammaRegularizer=sS(e.gammaRegularizer),r.supportsMasking=!0,(0,l.Z)(r)}return(0,b.Z)(n,[{key:"build",value:function(e){var t=(e=$b(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=(0,x.Z)(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(s){a.e(s)}finally{a.f()}if(this.axis.length!==Ry(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=Jb(e),a=r.shape,i=a.length;return qs((function(){var e,t=Jp(r,n.axis,!0),o=t.mean,s=t.variance,u=by(1,i),c=(0,x.Z)(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(g){c.e(g)}finally{c.f()}for(var p=function(e){return null!=e&&e.shape.length!==i?jc(e,u):e},d=n.scale?p(n.gamma.read()):null,f=n.center?p(n.beta.read()):null,h=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(h.push(a[v]),m.push(1)):(h.push(1),m.push(a[v]));return o=ip(o,h),s=ip(s,h),null!=d&&(d=ip(d,m)),null!=f&&(f=ip(f,m)),mI(r,o,s,f,d,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Kb(this.betaInitializer),gammaInitializer:Kb(this.gammaInitializer),betaRegularizer:iS(this.betaRegularizer),gammaRegularizer:iS(this.gammaRegularizer)},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);bI.className="LayerNormalization",Xu.registerClass(bI);var xI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new my("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new my("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new my("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new ix({ndim:4})],(0,l.Z)(r)}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=$b(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return qs((function(){return function(e,t,n){return qs((function(){if(4!==e.rank)throw new my("temporalPadding expects input tensor to be 4-D, but received a ".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new my("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new my("Unknown data format: ".concat(n,". Supported data formats are 'channelsLast' and 'channelsFirst."));var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],ad(e,r)}))}(Jb(e),n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx);function kI(e,t,n,r,a,i){return qs((function(){Ky(a),Yy(i),Xy(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=gS(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?Wp(e,t,n,s):Hc(e,t,n,s),"channelsFirst"===a&&(o=cu(o,[0,3,1,2])),o}))}function wI(e,t,n,r,a,i){return qs((function(){Ky(a),Yy(i),Xy(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=yS(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?Vp(e,t,n,s):qc(e,t,n,s),"channelsFirst"===a&&(o=cu(o,[0,4,1,2,3])),o}))}xI.className="ZeroPadding2D",Xu.registerClass(xI);var SI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new my("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(Oy(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new my("strides for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.strides)));r.strides=e.strides}return Oy(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Xy(r.padding),r.inputSpec=[new ix({ndim:3})],(0,l.Z)(r)}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){var t=mS((e=$b(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return qs((function(){n.invokeCallHook(e,t),e=pb(Jb(e),2);var r=n.poolingFunction(Jb(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return Qd(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx),II=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ky(a),Xy(r),kI(e,t,n,r,a,"max")}}]),n}(SI);II.className="MaxPooling1D",Xu.registerClass(II);var NI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ky(a),Xy(r),kI(e,t,n,r,a,"avg")}}]),n}(SI);NI.className="AveragePooling1D",Xu.registerClass(NI);var TI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new my("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return Oy(r.poolSize,"poolSize"),Oy(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ky(r.dataFormat),Xy(r.padding),r.inputSpec=[new ix({ndim:4})],(0,l.Z)(r)}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){e=$b(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=mS(t,this.poolSize[0],this.padding,this.strides[0]),n=mS(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return qs((function(){return n.invokeCallHook(e,t),n.poolingFunction(Jb(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx),CI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ky(a),Xy(r),kI(e,t,n,r,a,"max")}}]),n}(TI);CI.className="MaxPooling2D",Xu.registerClass(CI);var EI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ky(a),Xy(r),kI(e,t,n,r,a,"avg")}}]),n}(TI);EI.className="AveragePooling2D",Xu.registerClass(EI);var _I=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new my("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return Oy(r.poolSize,"poolSize"),Oy(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ky(r.dataFormat),Xy(r.padding),r.inputSpec=[new ix({ndim:5})],(0,l.Z)(r)}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){e=$b(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=mS(t,this.poolSize[0],this.padding,this.strides[0]),n=mS(n,this.poolSize[1],this.padding,this.strides[1]),r=mS(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return qs((function(){return n.invokeCallHook(e,t),n.poolingFunction(Jb(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx),AI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ky(a),Xy(r),wI(e,t,n,r,a,"max")}}]),n}(_I);AI.className="MaxPooling3D",Xu.registerClass(AI);var RI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e)}return(0,b.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ky(a),Xy(r),wI(e,t,n,r,a,"avg")}}]),n}(_I);RI.className="AveragePooling3D",Xu.registerClass(RI);var FI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).inputSpec=[new ix({ndim:3})],r}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new vy}}]),n}(lx),DI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e||{})}return(0,b.Z)(n,[{key:"call",value:function(e,t){return qs((function(){var t=Jb(e);return jp(t,1)}))}}]),n}(FI);DI.className="GlobalAveragePooling1D",Xu.registerClass(DI);var ZI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,y.Z)(this,n),t.call(this,e||{})}return(0,b.Z)(n,[{key:"call",value:function(e,t){return qs((function(){var t=Jb(e);return Hl(t,1)}))}}]),n}(FI);ZI.className="GlobalMaxPooling1D",Xu.registerClass(ZI);var OI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ky(r.dataFormat),r.inputSpec=[new ix({ndim:4})],r}return(0,b.Z)(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new vy}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lx),MI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"call",value:function(e,t){var n=this;return qs((function(){var t=Jb(e);return"channelsLast"===n.dataFormat?jp(t,[1,2]):jp(t,[2,3])}))}}]),n}(OI);MI.className="GlobalAveragePooling2D",Xu.registerClass(MI);var zI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"call",value:function(e,t){var n=this;return qs((function(){var t=Jb(e);return"channelsLast"===n.dataFormat?Hl(t,[1,2]):Hl(t,[2,3])}))}}]),n}(OI);zI.className="GlobalMaxPooling2D",Xu.registerClass(zI);var LI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).layer=e.layer,r}return(0,b.Z)(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){(0,o.Z)((0,s.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.layer,a=pk(r,n);delete t.layer;var i={layer:a};return Object.assign(i,t),new e(i)}}]),n}(lx),PI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return(0,b.Z)(n,[{key:"build",value:function(e){if((e=$b(e)).length<3)throw new my("TimeDistributed layer expects an input shape >= 3D, but received input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),(0,o.Z)((0,s.Z)(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=$b(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return qs((function(){return DS((function(e,r){return[Jb(n.layer.call(e,t)),[]]}),e=Jb(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(LI);PI.className="TimeDistributed",Xu.registerClass(PI);var BI=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;(0,y.Z)(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=pk(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=pk(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,function(e){Dy(Hy,"BidirectionalMergeMode",e)}(r.mergeMode),e.weights)throw new vy("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return(0,b.Z)(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState&&(r=a.slice(1)),t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):wy(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=FS(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return(0,o.Z)((0,s.Z)(n.prototype),"apply",this).call(this,e,t);var u=[],c=[];if(null!=r){var l=r.length;if(l%2>0)throw new my("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,u.push.apply(u,(0,h.Z)(r));var p=r.map((function(e){return new ix({shape:e.shape})}));this.forwardLayer.stateSpec=p.slice(0,l/2),this.backwardLayer.stateSpec=p.slice(l/2),c.push.apply(c,(0,h.Z)(p))}if(null!=a)throw new vy("Support for constants in Bidirectional layers is not implemented yet.");for(var d=u[0]instanceof ox,f=0,m=u;f<m.length;f++){if(m[f]instanceof ox!==d)throw new my("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(d){var v=[e].concat(u),g=this.inputSpec.concat(c),y=this.inputSpec;this.inputSpec=g;var b=(0,o.Z)((0,s.Z)(n.prototype),"apply",this).call(this,v,t);return this.inputSpec=y,b}return(0,o.Z)((0,s.Z)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return qs((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=Td(a,1)),"concat"===n.mergeMode?o=vb([r,a]):"sum"===n.mergeMode?o=dc(r,a):"ave"===n.mergeMode?o=mc(.5,dc(r,a)):"mul"===n.mergeMode?o=mc(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;Jy(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),Jy(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){(0,o.Z)((0,s.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=(0,o.Z)((0,s.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=pk(t.layer);if(delete t.layer,null!=t.numConstants)throw new vy("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(LI);function WI(e){return new dx(e)}function VI(e){return new pS(e)}function UI(e){return new uS(e)}function GI(e){return new cS(e)}function jI(e){return new lS(e)}function HI(e){return new fS(e)}function qI(e){return new dS(e)}function KI(e){return new ES(e)}function XI(e){return new wS(e)}function YI(e){return new IS(e)}function QI(e){return new SS(e)}function JI(e){return new NS(e)}function $I(e){return new CS(e)}function eN(e){return new _S(e)}function tN(e){return new AS(e)}function nN(e){return new RS(e)}function rN(e){return new QS(e)}function aN(e){return new XS(e)}function iN(e){return new qS(e)}function oN(e){return new KS(e)}function sN(e){return new YS(e)}function uN(e){return new JS(e)}function cN(e){return new $S(e)}function lN(e){return new eI(e)}function pN(e){return new nI(e)}function dN(e){return new aI(e)}function fN(e){return new oI(e)}function hN(e){return new cI(e)}function mN(e){return new sI(e)}function vN(e){return new uI(e)}function gN(e){return new iI(e)}function yN(e){return new pI(e)}function bN(e){return new yI(e)}function xN(e){return new bI(e)}function kN(e){return new xI(e)}function wN(e){return new NI(e)}function SN(e){return wN(e)}function IN(e){return wN(e)}function NN(e){return new EI(e)}function TN(e){return NN(e)}function CN(e){return NN(e)}function EN(e){return new RI(e)}function _N(e){return EN(e)}function AN(e){return EN(e)}function RN(e){return new DI(e)}function FN(e){return new MI(e)}function DN(e){return new ZI(e)}function ZN(e){return new zI(e)}function ON(e){return new II(e)}function MN(e){return new CI(e)}function zN(e){return new AI(e)}function LN(e){return new PS(e)}function PN(e){return new LS(e)}function BN(e){return new WS(e)}function WN(e){return new BS(e)}function VN(e){return new zS(e)}function UN(e){return new MS(e)}function GN(e){return new HS(e)}function jN(e){return new jS(e)}function HN(e){return new ZS(e)}function qN(e){return new VS(e)}function KN(e){return new BI(e)}function XN(e){return new PI(e)}BI.className="Bidirectional",Xu.registerClass(BI);var YN=DN,QN=ZN,JN=ON,$N=MN;function eT(e){return new dI(e)}function tT(e){return new fI(e)}function nT(e){return new hI(e)}function rT(e){return new tI(e)}var aT={};function iT(e,t){return wk(e,t)}function oT(e,t){return Ck(e,t)}function sT(e,t){return Ek(e,t)}function uT(e,t){return Sk(e,t)}function cT(e,t){return _k(e,t)}function lT(e,t){return Nk(e,t)}function pT(e,t){return Tk(e,t)}function dT(e,t){return bk(e,t)}function fT(e,t){return hk(e,t)}function hT(e,t){return mk(e,t)}function mT(e,t){return mk(e,t)}function vT(e,t){return mk(e,t)}function gT(e,t){return fk(e,t)}function yT(e,t){return fk(e,t)}function bT(e,t){return fk(e,t)}D(aT,{MAPE:function(){return mT},MSE:function(){return yT},binaryAccuracy:function(){return iT},binaryCrossentropy:function(){return oT},categoricalAccuracy:function(){return uT},categoricalCrossentropy:function(){return cT},cosineProximity:function(){return dT},mape:function(){return vT},meanAbsoluteError:function(){return fT},meanAbsolutePercentageError:function(){return hT},meanSquaredError:function(){return gT},mse:function(){return bT},precision:function(){return lT},recall:function(){return pT},sparseCategoricalAccuracy:function(){return sT}});var xT={};D(xT,{modelFromJSON:function(){return Nw}});var kT={};function wT(e){return new rS(e)}function ST(e){return function(e){return tS(e),new rS({l1:null!=e?e.l1:null,l2:0})}(e)}function IT(e){return function(e){return tS(e),new rS({l2:null!=e?e.l2:null,l1:0})}(e)}D(kT,{l1:function(){return ST},l1l2:function(){return wT},l2:function(){return IT}});var NT=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,y.Z)(this,n),(e=t.apply(this,arguments)).model=null,e}return(0,b.Z)(n,[{key:"setModel",value:function(e){if(!(e instanceof Sw))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}]),n}(rk);function TT(e,t){return e<t}function CT(e,t){return e>t}var ET=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),r=t.call(this),null==e&&(e={}),e.restoreBestWeights)throw new vy("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=e.monitor||"val_loss",r.minDelta=Math.abs(e.minDelta||0),r.patience=e.patience||0,r.verbose=e.verbose||0,r.mode=e.mode||"auto",r.baseline=e.baseline,-1===["auto","min","max"].indexOf(r.mode)&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. Falling back to mode 'auto'.")),r.mode="auto"),"min"===r.mode?r.monitorFunc=TT:"max"===r.mode||-1!==r.monitor.indexOf("acc")?r.monitorFunc=CT:r.monitorFunc=TT,r.monitorFunc===TT&&(r.minDelta*=-1),(0,l.Z)(r)}return(0,b.Z)(n,[{key:"onTrainBegin",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===TT?1/0:-1/0;case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ek(n);case 2:null!=(r=this.getMonitorValue(n))&&(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMonitorValue",value:function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. Available metrics are: ").concat(Object.keys(e))),t}}]),n}(NT);var _T,AT,RT={earlyStopping:function(e){return new ET(e)}};rt().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(_T||(_T={})),function(e){var t;(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(AT||(AT={}));var FT={};function DT(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};FT[e]=n}function ZT(e){return FT[e]}function OT(e){delete FT[e]}function MT(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd;if("tensor"===i.type)return zT(t.inputNames[i.inputIndexStart],n,r,a);if("tensors"===i.type)return t.inputNames.slice(o,s).map((function(e){return zT(e,n,r,a)}));var u=zT(t.inputNames.slice(o)[0],n,r,a),c=u.dataSync();return"number"===i.type?c[0]:Fa.toNestedArray(u.shape,c)}var l=t.attrParams[e];return l&&l.value}function zT(e,t,n,r){var a=BT(e),i=(0,m.Z)(a,2),o=i[0],s=i[1];if(null!=r){var u=r.getHashTableHandleByName(o);if(null!=u)return u}var c=n.currentContextIds.find((function(e){return!!t[PT(o,e)]}));return void 0!==c?t[PT(o,c)][s]:void 0}function LT(e,t){var n=BT(e),r=(0,m.Z)(n,3),a=r[0],i=r[1],o=r[2];return[PT(a,t&&t.currentContextId),i,o]}function PT(e,t){return t?"".concat(e,"-").concat(t):e}function BT(e){var t=e.split(":");if(1===t.length)return[e,0,void 0];var n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function WT(e,t,n){var r=MT("pad",e,t,n);if("explicit"===r){r=MT("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function VT(e){return e.kept?e:ls(e)}var UT={};D(UT,{json:function(){return GT}});var GT=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],jT={};D(jT,{json:function(){return HT}});var HT=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],qT={};D(qT,{json:function(){return KT}});var KT=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],XT={};D(XT,{json:function(){return YT}});var YT=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],QT={};D(QT,{json:function(){return JT}});var JT=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],$T={};D($T,{json:function(){return eC}});var eC=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],tC={};D(tC,{json:function(){return nC}});var nC=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],rC={};D(rC,{json:function(){return aC}});var aC=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],iC={};D(iC,{json:function(){return oC}});var oC=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],sC={};D(sC,{json:function(){return uC}});var uC=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],cC={};D(cC,{json:function(){return lC}});var lC=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],pC={};D(pC,{json:function(){return dC}});var dC=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],fC={};D(fC,{json:function(){return hC}});var hC=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],mC={};D(mC,{json:function(){return vC}});var vC=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],gC={};D(gC,{json:function(){return yC}});var yC=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],bC={};D(bC,{json:function(){return xC}});var xC=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],kC={};D(kC,{json:function(){return wC}});var wC=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],SC={};D(SC,{json:function(){return IC}});var IC=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],NC={};D(NC,{json:function(){return TC}});var TC=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],CC=function(){function e(){var t;(0,y.Z)(this,e);var n=[UT,jT,qT,XT,QT,$T,tC,rC,iC,sC,cC,pC,fC,mC,gC,bC,kC,SC,NC],r=(t=[]).concat.apply(t,(0,h.Z)(n.map((function(e){return e.json}))));this.opMappers=r.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return(0,b.Z)(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],i=[],o=[],s=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):(null==n.input||0===n.input.length)&&o.push(e[n.name]),e}),{}),u=[],c=[],l={},p={};null!=n&&(l=this.mapSignatureEntries(n.inputs),p=this.mapSignatureEntries(n.outputs));var d=Object.keys(s);d.forEach((function(e){var t=s[e];t.inputNames.forEach((function(e,n){var r=LT(e),a=(0,m.Z)(r,3),i=a[0],o=a[2],u=s[i];if(null!=u.outputs){var c=u.outputs.indexOf(o);if(-1!==c){var l="".concat(i,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))})),0===Object.keys(p).length?d.forEach((function(e){var t=s[e];0===t.children.length&&c.push(t)})):Object.keys(p).forEach((function(e){var t=LT(e),n=(0,m.Z)(t,1)[0],r=s[n];null!=r&&(r.signatureKey=p[e],c.push(r))})),Object.keys(l).length>0?Object.keys(l).forEach((function(e){var t=LT(e),n=(0,m.Z)(t,1)[0],r=s[n];r&&(r.signatureKey=l[e],u.push(r))})):u=a;var f={};null!=e.library&&null!=e.library.function&&(f=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var h={nodes:s,inputs:u,outputs:c,weights:i,placeholders:a,signature:n,functions:f};return o.length>0&&(h.initNodes=o),h}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=ZT(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r,a=n.type;switch(n.type){case"string":void 0===(r=_C(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=_C(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(r=PC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=PC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(r=RC(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(r=RC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(r=LC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=LC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(r=AC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=AC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(r=WC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=WC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(r=zC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=zC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(r=BC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=BC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(r=ZC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=ZC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(r=OC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=OC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(r=DC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=DC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:r,type:a},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=LT(e.name),n=(0,m.Z)(t,1)[0],r={name:n,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:FC(e.type),type:"dtype"}},children:[]};r.signatureKey=e.name,i.push(r),a[n]=r})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=LT(e),i=(0,m.Z)(r,3),o=i[0],s=i[2],u=a[o];if(null!=u.outputs){var c=u.outputs.indexOf(s);if(-1!==c){var l="".concat(o,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=LT(s[e.name]),n=(0,m.Z)(t,2),r=n[0],i=n[1],u=a[r];null!=u&&(u.defaultOutput=i,o.push(u))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function EC(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=rt().global;if("undefined"!=typeof t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function _C(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?EC(a.s,r):n}function AC(e,t,n){var r=e[t];return r?r.b:n}function RC(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function FC(e){switch("string"==typeof e&&(e=_T[e]),e){case _T.DT_FLOAT:case _T.DT_HALF:return"float32";case _T.DT_INT32:case _T.DT_INT64:case _T.DT_INT8:case _T.DT_UINT8:return"int32";case _T.DT_BOOL:return"bool";case _T.DT_DOUBLE:return"float32";case _T.DT_STRING:return"string";default:return null}}function DC(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function ZC(e,t,n){var r=e[t];return r&&r.type?FC(r.type):n}function OC(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return FC(e)})):n}function MC(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function zC(e,t,n){var r=e[t];return r&&r.shape?MC(r.shape):n}function LC(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function PC(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return EC(e,r)})):n}function BC(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return MC(e)})):n}function WC(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var VC=function(){function e(t,n,r){var a=this;(0,y.Z)(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return(0,b.Z)(e,[{key:"getInput",value:function(e){return zT(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return zT(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return RC(this.node.rawAttrs,e,t);if(null!=n.s)return _C(this.node.rawAttrs,e,t);if(null!=n.b)return AC(this.node.rawAttrs,e,t);if(null!=n.shape)return zC(this.node.rawAttrs,e,t);if(null!=n.type)return ZC(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return LC(this.node.rawAttrs,e,t);if(null!=n.list.s)return PC(this.node.rawAttrs,e,t);if(null!=n.list.shape)return BC(this.node.rawAttrs,e,t);if(null!=n.list.b)return WC(this.node.rawAttrs,e,t);if(null!=n.list.type)return OC(this.node.rawAttrs,e,t)}return t}}]),e}(),UC={};D(UC,{OP_SCOPE_SUFFIX:function(){return Xi},abs:function(){return vc},acos:function(){return gc},acosh:function(){return yc},add:function(){return dc},addN:function(){return bc},all:function(){return xc},any:function(){return kc},argMax:function(){return wc},argMin:function(){return Sc},asin:function(){return Ic},asinh:function(){return Nc},atan:function(){return Tc},atan2:function(){return Cc},atanh:function(){return Ec},avgPool:function(){return Hc},avgPool3d:function(){return qc},basicLSTMCell:function(){return Jc},batchNorm:function(){return tl},batchNorm2d:function(){return nl},batchNorm3d:function(){return rl},batchNorm4d:function(){return al},batchToSpaceND:function(){return $c},bincount:function(){return il},booleanMaskAsync:function(){return bf},broadcastArgs:function(){return ol},broadcastTo:function(){return sl},buffer:function(){return us},cast:function(){return cs},ceil:function(){return ul},clipByValue:function(){return cl},clone:function(){return ls},complex:function(){return Qi},concat:function(){return Kc},concat1d:function(){return ll},concat2d:function(){return pl},concat3d:function(){return dl},concat4d:function(){return fl},conv1d:function(){return ml},conv2d:function(){return hl},conv2dTranspose:function(){return gl},conv3d:function(){return yl},conv3dTranspose:function(){return xl},cos:function(){return kl},cosh:function(){return wl},cosineWindow:function(){return Cf},cumprod:function(){return Sl},cumsum:function(){return Il},denseBincount:function(){return Nl},depthToSpace:function(){return Tl},depthwiseConv2d:function(){return Cl},diag:function(){return El},dilation2d:function(){return _l},div:function(){return hc},divNoNan:function(){return Dl},dot:function(){return Zl},dropout:function(){return Nf},einsum:function(){return Ol},elu:function(){return Ml},enclosingPowerOfTwo:function(){return Tf},equal:function(){return Al},erf:function(){return zl},euclideanNorm:function(){return tp},exp:function(){return np},expandDims:function(){return rp},expm1:function(){return ap},eye:function(){return op},fft:function(){return jd},fill:function(){return sp},floor:function(){return up},floorDiv:function(){return fc},fused:function(){return Af},gather:function(){return cp},gatherND:function(){return If},greater:function(){return lp},greaterEqual:function(){return pp},ifft:function(){return Hd},imag:function(){return ou},image:function(){return Gh},inTopKAsync:function(){return _f},irfft:function(){return qd},isFinite:function(){return dp},isInf:function(){return fp},isNaN:function(){return hp},leakyRelu:function(){return mp},less:function(){return vp},lessEqual:function(){return gp},linalg:function(){return jh},linspace:function(){return yp},localResponseNormalization:function(){return bp},log:function(){return xp},log1p:function(){return kp},logSigmoid:function(){return Ap},logSoftmax:function(){return Fp},logSumExp:function(){return Dp},logicalAnd:function(){return Zp},logicalNot:function(){return Op},logicalOr:function(){return Mp},logicalXor:function(){return zp},losses:function(){return Hh},lowerBound:function(){return Bp},matMul:function(){return zs},max:function(){return Hl},maxPool:function(){return Wp},maxPool3d:function(){return Vp},maxPoolWithArgmax:function(){return Up},maximum:function(){return Gp},mean:function(){return jp},meshgrid:function(){return Kp},min:function(){return ql},minimum:function(){return Xp},mirrorPad:function(){return Yp},mod:function(){return Qp},moments:function(){return Jp},movingAverage:function(){return xf},mul:function(){return mc},multiRNNCell:function(){return $p},multinomial:function(){return ed},neg:function(){return su},norm:function(){return ep},notEqual:function(){return td},oneHot:function(){return Ls},ones:function(){return qp},onesLike:function(){return nd},op:function(){return Yi},outerProduct:function(){return rd},pad:function(){return ad},pad1d:function(){return id},pad2d:function(){return od},pad3d:function(){return sd},pad4d:function(){return ud},pool:function(){return ld},pow:function(){return Kl},prelu:function(){return pd},print:function(){return ps},prod:function(){return dd},rand:function(){return fd},randomGamma:function(){return yd},randomNormal:function(){return bd},randomStandardNormal:function(){return xd},randomUniform:function(){return kd},range:function(){return wd},real:function(){return uu},reciprocal:function(){return Sd},relu:function(){return Id},relu6:function(){return Nd},reshape:function(){return jc},reverse:function(){return Td},reverse1d:function(){return Cd},reverse2d:function(){return Ed},reverse3d:function(){return _d},reverse4d:function(){return Ad},rfft:function(){return Xd},round:function(){return Rd},rsqrt:function(){return Fd},scalar:function(){return Xl},scatterND:function(){return kf},searchSorted:function(){return Pp},selu:function(){return Dd},separableConv2d:function(){return Zd},setdiff1dAsync:function(){return Md},sigmoid:function(){return Xc},sign:function(){return zd},signal:function(){return Uh},sin:function(){return Ld},sinh:function(){return Pd},slice:function(){return Yc},slice1d:function(){return Bd},slice2d:function(){return Wd},slice3d:function(){return Vd},slice4d:function(){return Ud},softmax:function(){return Gd},softplus:function(){return _p},spaceToBatchND:function(){return cd},sparse:function(){return qh},sparseToDense:function(){return Sf},spectral:function(){return Vh},split:function(){return Kd},sqrt:function(){return Yl},square:function(){return Ql},squaredDifference:function(){return Yd},squeeze:function(){return Qd},stack:function(){return Jd},step:function(){return $d},stridedSlice:function(){return ef},string:function(){return Kh},sub:function(){return Rp},sum:function(){return Jl},tan:function(){return tf},tanh:function(){return Qc},tensor:function(){return $i},tensor1d:function(){return nf},tensor2d:function(){return rf},tensor3d:function(){return gu},tensor4d:function(){return af},tensor5d:function(){return of},tensor6d:function(){return sf},tile:function(){return ip},topk:function(){return uf},transpose:function(){return cu},truncatedNormal:function(){return cf},unique:function(){return lf},unsortedSegmentSum:function(){return pf},unstack:function(){return df},upperBound:function(){return ff},variable:function(){return hf},where:function(){return Rl},whereAsync:function(){return gf},zeros:function(){return Hp},zerosLike:function(){return Fl}});var GC=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(MT("a",e,t,n),MT("b",e,t,n))];case"AddN":return[r.addN(MT("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(MT("a",e,t,n),MT("b",e,t,n))];case"Mul":return[r.mul(MT("a",e,t,n),MT("b",e,t,n))];case"RealDiv":case"Div":return[r.div(MT("a",e,t,n),MT("b",e,t,n))];case"DivNoNan":return[r.divNoNan(MT("a",e,t,n),MT("b",e,t,n))];case"FloorDiv":return[r.floorDiv(MT("a",e,t,n),MT("b",e,t,n))];case"Sub":return[r.sub(MT("a",e,t,n),MT("b",e,t,n))];case"Minimum":return[r.minimum(MT("a",e,t,n),MT("b",e,t,n))];case"Maximum":return[r.maximum(MT("a",e,t,n),MT("b",e,t,n))];case"Pow":return[r.pow(MT("a",e,t,n),MT("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(MT("a",e,t,n),MT("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},jC=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(MT("x",e,t,n))];case"Acos":return[r.acos(MT("x",e,t,n))];case"Acosh":return[r.acosh(MT("x",e,t,n))];case"Asin":return[r.asin(MT("x",e,t,n))];case"Asinh":return[r.asinh(MT("x",e,t,n))];case"Atan":return[r.atan(MT("x",e,t,n))];case"Atan2":return[r.atan2(MT("x",e,t,n),MT("y",e,t,n))];case"Atanh":return[r.atanh(MT("x",e,t,n))];case"Ceil":return[r.ceil(MT("x",e,t,n))];case"Complex":return[r.complex(MT("real",e,t,n),MT("imag",e,t,n))];case"Cos":return[r.cos(MT("x",e,t,n))];case"Cosh":return[r.cosh(MT("x",e,t,n))];case"Elu":return[r.elu(MT("x",e,t,n))];case"Erf":return[r.erf(MT("x",e,t,n))];case"Exp":return[r.exp(MT("x",e,t,n))];case"Expm1":return[r.expm1(MT("x",e,t,n))];case"Floor":return[r.floor(MT("x",e,t,n))];case"Log":return[r.log(MT("x",e,t,n))];case"Log1p":return[r.log1p(MT("x",e,t,n))];case"Imag":return[r.imag(MT("x",e,t,n))];case"Neg":return[r.neg(MT("x",e,t,n))];case"Reciprocal":return[r.reciprocal(MT("x",e,t,n))];case"Real":return[r.real(MT("x",e,t,n))];case"Relu":return[r.relu(MT("x",e,t,n))];case"Round":return[r.round(MT("x",e,t,n))];case"Selu":return[r.selu(MT("x",e,t,n))];case"Sigmoid":return[r.sigmoid(MT("x",e,t,n))];case"Sin":return[r.sin(MT("x",e,t,n))];case"Sign":return[r.sign(MT("x",e,t,n))];case"Sinh":return[r.sinh(MT("x",e,t,n))];case"Softplus":return[r.softplus(MT("x",e,t,n))];case"Sqrt":return[r.sqrt(MT("x",e,t,n))];case"Square":return[r.square(MT("x",e,t,n))];case"Tanh":return[r.tanh(MT("x",e,t,n))];case"Tan":return[r.tan(MT("x",e,t,n))];case"ClipByValue":return[r.clipByValue(MT("x",e,t,n),MT("clipValueMin",e,t,n),MT("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(MT("x",e,t,n))];case"Rsqrt":return[r.rsqrt(zT(e.inputNames[0],t,n))];case"Prod":return[r.prod(MT("x",e,t,n),MT("axes",e,t,n))];case"LeakyRelu":return[r.leakyRelu(MT("x",e,t,n),MT("alpha",e,t,n))];case"Prelu":return[r.prelu(MT("x",e,t,n),MT("alpha",e,t,n))];case"IsNan":return[r.isNaN(zT(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function HC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){Fa.assert(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],i=t[r];Fa.assert(a<0||i<0||a===i,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function qC(e){return!("number"==typeof e||e.some((function(e){return e<0})))}function KC(e,t,n){var r=XC(e,n),a=!qC(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=XC(e.shape,r)})),!qC(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function XC(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var YC=function(){function e(t,n,r,a,i,o,s){(0,y.Z)(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Xl(0),Xs(this.idTensor)}return(0,b.Z)(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.tensor.id))&&t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0===this.size()&&(null==this.elementShape||0===this.elementShape.length)&&(this.elementShape=t.shape),HC(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Xs(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return $i([],[0].concat(this.elementShape));var r=this.readMany(e);return HC(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),Jd(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return $i([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return HC(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),Kc(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,(0,h.Z)(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,df(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var i=0===r?0:t.size/r,o=[];qs((function(){t=jc(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=jc(Yc(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),QC=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;(0,y.Z)(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));HC(n,e.shape,"TensorList shape mismatch: "),Xs(e)})),this.idTensor=Xl(0),this.maxNumElements=a,Xs(this.idTensor)}return(0,b.Z)(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e((0,h.Z)(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.id))&&t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));HC(e,this.elementShape,"TensorList shape mismatch: ");var a=KC(this.elementShape,this.tensors,e);return qs((function(){var e=n.tensors.map((function(e){return jc(e,a)}));return Jd(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=KC(this.elementShape,this.tensors,e),r=this.tensors.pop();return HC(r.shape,e,"TensorList shape mismatch: "),jc(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(HC(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Xs(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));HC(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=KC(this.elementShape,this.tensors,t);return jc(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));HC(this.elementShape,t.shape,"TensorList shape mismatch: "),Xs(t),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));HC(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=KC(this.elementShape,this.tensors,n);return 0===e.length?$i([],[0].concat(a)):qs((function(){var t=e.map((function(e){return jc(r.tensors[e],a)}));return Jd(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));HC(this.elementShape,t,"TensorList shape mismatch: ");var r=KC(this.elementShape,this.tensors,t);return 0===this.size()?$i([],[0].concat(r)):qs((function(){var e=n.tensors.map((function(e){return jc(e,r)}));return Kc(e,0)}))}}]),e}();function JC(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));HC(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=df(e);return new QC(a,t,r)}function $C(e,t,n,r){return new QC([],e,t,r)}function eE(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,(0,h.Z)(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new QC([],n,e.dtype,r),o=df(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function tE(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=XC(e.shape.slice(1),n),o=0===r?0:e.size/r,s=qs((function(){var n=[];e=jc(e,[1,r,o]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],o];n[s]=jc(Yc(e,u,c),i)}return e.dispose(),n})),u=new QC([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}var nE=function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,f,h,m,g,y,b,x,k,w,S,I,N,T,C,E,_,A,R,F,D,Z,O,M,z,L,P,B,W,V,U,G,j,H,q,K,X,Y,Q,J,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,pe,de,fe,he,me,ve,ge,ye,be,xe,ke,we,Se,Ie,Ne,Te,Ce,Ee,_e,Ae,Re,Fe,De,Ze,Oe,Me,ze,Le,Pe,Be,We,Ve,Ue,Ge,je,He;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?16:"Switch"===e.t0?18:"Merge"===e.t0?28:"Enter"===e.t0?33:"Exit"===e.t0?35:"NextIteration"===e.t0?37:"TensorArrayV3"===e.t0?39:"TensorArrayWriteV3"===e.t0?41:"TensorArrayReadV3"===e.t0?43:"TensorArrayGatherV3"===e.t0?45:"TensorArrayScatterV3"===e.t0?47:"TensorArrayConcatV3"===e.t0?49:"TensorArraySplitV3"===e.t0?51:"TensorArraySizeV3"===e.t0?53:"TensorArrayCloseV3"===e.t0?55:"TensorListSetItem"===e.t0?57:"TensorListGetItem"===e.t0?59:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?61:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?63:"TensorListGather"===e.t0?67:"TensorListStack"===e.t0?69:"TensorListFromTensor"===e.t0?71:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?73:"TensorListPushBack"===e.t0?75:"TensorListPopBack"===e.t0?77:"TensorListSplit"===e.t0?79:"TensorListLength"===e.t0?81:"TensorListResize"===e.t0?83:85;break;case 3:return a=MT("thenBranch",t,n,r),i=MT("elseBranch",t,n,r),o=MT("cond",t,n,r),s=MT("args",t,n,r),e.next=6,o.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return e.delegateYield((0,v.Z)().mark((function e(){var a,i,o,s,u,c,l,p;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=MT("body",t,n,r),i=MT("cond",t,n,r),o=MT("args",t,n,r),e.next=5,r.functionMap[i].executeFunctionAsync(o,r.tensorArrayMap,r.tensorListMap);case 5:return s=e.sent,u=o.map((function(e){return e.id})),e.next=9,s[0].data();case 9:c=e.sent,s.forEach((function(e){!e.kept&&-1===u.indexOf(e.id)&&e.dispose()})),l=o,p=(0,v.Z)().mark((function e(){var t,n,o;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l,e.next=3,r.functionMap[a].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 3:return l=e.sent,n=l.map((function(e){return e.id})),t.forEach((function(e){!e.kept&&-1===u.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()})),e.next=8,r.functionMap[i].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 8:return o=e.sent,e.next=11,o[0].data();case 11:c=e.sent,o.forEach((function(e){!e.kept&&-1===u.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 13:if(!c[0]){e.next=17;break}return e.delegateYield(p(),"t0",15);case 15:e.next=13;break;case 17:return e.abrupt("return",{v:l});case 18:case"end":return e.stop()}}),e)}))(),"t2",13);case 13:if("object"!==typeof(u=e.t2)){e.next=16;break}return e.abrupt("return",u.v);case 16:return c=MT("pred",t,n,r),e.abrupt("return",[VT(c)]);case 18:return l=MT("pred",t,n,r),(p=MT("data",t,n,r)).kept||(p=VT(p)),e.next=22,l.data();case 22:if(!e.sent[0]){e.next=26;break}e.t3=[void 0,p],e.next=27;break;case 26:e.t3=[p,void 0];case 27:return e.abrupt("return",e.t3);case 28:if(d=t.inputNames.find((function(e){return void 0!==zT(e,n,r)})),!d){e.next=32;break}return f=zT(d,n,r),e.abrupt("return",[VT(f)]);case 32:return e.abrupt("return");case 33:return h=MT("frameName",t,n,r),m=MT("tensor",t,n,r),e.abrupt("return",(r.enterFrame(h),[VT(m)]));case 35:return g=MT("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[VT(g)]));case 37:return y=MT("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[VT(y)]));case 39:return b=MT("size",t,n,r),x=MT("dtype",t,n,r),k=MT("elementShape",t,n,r),w=MT("dynamicSize",t,n,r),S=MT("clearAfterRead",t,n,r),I=MT("identicalElementShapes",t,n,r),N=MT("name",t,n,r),T=new YC(N,x,b,k,I,w,S),e.abrupt("return",(r.addTensorArray(T),[T.idTensor,Xl(1)]));case 41:return C=MT("tensorArrayId",t,n,r),E=MT("index",t,n,r),_=MT("tensor",t,n,r),A=r.getTensorArray(C.id),e.abrupt("return",(A.write(E,_),[A.idTensor]));case 43:return R=MT("tensorArrayId",t,n,r),F=MT("index",t,n,r),e.abrupt("return",[r.getTensorArray(R.id).read(F)]);case 45:return D=MT("tensorArrayId",t,n,r),Z=MT("indices",t,n,r),O=MT("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(D.id).gather(Z,O)]);case 47:return M=MT("tensorArrayId",t,n,r),z=MT("indices",t,n,r),L=MT("tensor",t,n,r),P=r.getTensorArray(M.id),e.abrupt("return",(P.scatter(z,L),[P.idTensor]));case 49:return B=MT("tensorArrayId",t,n,r),W=r.getTensorArray(B.id),V=MT("dtype",t,n,r),e.abrupt("return",[W.concat(V)]);case 51:return U=MT("tensorArrayId",t,n,r),G=MT("tensor",t,n,r),j=MT("lengths",t,n,r),H=r.getTensorArray(U.id),e.abrupt("return",(H.split(j,G),[H.idTensor]));case 53:return q=MT("tensorArrayId",t,n,r),K=r.getTensorArray(q.id),e.abrupt("return",[Xl(K.size(),"int32")]);case 55:return X=MT("tensorArrayId",t,n,r),Y=r.getTensorArray(X.id),e.abrupt("return",(Y.clearAndClose(),[Y.idTensor]));case 57:return Q=MT("tensorListId",t,n,r),J=MT("index",t,n,r),$=MT("tensor",t,n,r),ee=r.getTensorList(Q.id),e.abrupt("return",(ee.setItem(J,$),[ee.idTensor]));case 59:return te=MT("tensorListId",t,n,r),ne=MT("index",t,n,r),re=MT("elementShape",t,n,r),ae=MT("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(te.id).getItem(ne,re,ae)]);case 61:return ie=MT("indices",t,n,r),oe=MT("tensor",t,n,r),se=MT("elementShape",t,n,r),ue=MT("numElements",t,n,r),ce=eE(oe,ie,se,ue),e.abrupt("return",(r.addTensorList(ce),[ce.idTensor]));case 63:return le=MT("elementShape",t,n,r),pe=MT("elementDType",t,n,r),de="TensorListReserve"===t.op?"numElements":"maxNumElements",fe=MT(de,t,n,r),he="TensorListReserve"===t.op?-1:fe,me=$C(le,pe,0,he),e.abrupt("return",(r.addTensorList(me),[me.idTensor]));case 67:return ve=MT("tensorListId",t,n,r),ge=MT("indices",t,n,r),ye=MT("elementShape",t,n,r),be=MT("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ve.id).gather(ge,be,ye)]);case 69:return xe=MT("tensorListId",t,n,r),ke=MT("elementShape",t,n,r),we=MT("elementDType",t,n,r),Se=MT("numElements",t,n,r),e.abrupt("return",[r.getTensorList(xe.id).stack(ke,we,Se)]);case 71:return Ie=MT("tensor",t,n,r),Ne=MT("elementShape",t,n,r),Te=MT("elementDType",t,n,r),Ce=JC(Ie,Ne,Te),e.abrupt("return",(r.addTensorList(Ce),[Ce.idTensor]));case 73:return Ee=MT("tensorListId",t,n,r),_e=r.getTensorList(Ee.id),Ae=MT("dtype",t,n,r),Re=MT("elementShape",t,n,r),e.abrupt("return",[_e.concat(Ae,Re)]);case 75:return Fe=MT("tensorListId",t,n,r),De=MT("tensor",t,n,r),Ze=r.getTensorList(Fe.id),e.abrupt("return",(Ze.pushBack(De),[Ze.idTensor]));case 77:return Oe=MT("tensorListId",t,n,r),Me=MT("elementShape",t,n,r),ze=MT("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Oe.id).popBack(Me,ze)]);case 79:return Le=MT("tensor",t,n,r),Pe=MT("elementShape",t,n,r),Be=MT("lengths",t,n,r),We=tE(Le,Be,Pe),e.abrupt("return",(r.addTensorList(We),[We.idTensor]));case 81:return Ve=MT("tensorListId",t,n,r),Ue=r.getTensorList(Ve.id),e.abrupt("return",[Xl(Ue.size(),"int32")]);case 83:return Ge=MT("tensorListId",t,n,r),je=MT("size",t,n,r),He=r.getTensorList(Ge.id).resize(je),e.abrupt("return",(r.addTensorList(He),[He.idTensor]));case 85:throw TypeError("Node type ".concat(t.op," is not implemented"));case 86:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function rE(e,t,n){var r=MT("fusedOps",e,t,n),a=(0,m.Z)(r,2),i=a[0],o=a[1],s="biasadd"===i,u=!s,c="prelu"===o,l="fusedbatchnorm"===i,p=MT("numArgs",e,t,n);if(s){if(c&&2!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&s&&1!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var d=MT("strides",e,t,n),f=WT(e,t,n),h=MT("dataFormat",e,t,n).toUpperCase(),v=MT("dilations",e,t,n),g=MT("args",e,t,n),y=(0,m.Z)(g,2),b=y[0],x=y[1];return u&&(x=b,b=void 0),{stride:d,pad:f,dataFormat:h,dilations:v,biasArg:b,preluArg:x,activationFunc:o,leakyreluAlpha:MT("leakyreluAlpha",e,t,n)}}var aE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"Conv1D":var a=MT("stride",e,t,n),i=MT("pad",e,t,n),o=MT("dataFormat",e,t,n).toUpperCase(),s=MT("dilation",e,t,n);return[r.conv1d(MT("x",e,t,n),MT("filter",e,t,n),a,i,o,s)];case"Conv2D":var u=MT("strides",e,t,n),c=WT(e,t,n),l=MT("dataFormat",e,t,n).toUpperCase(),p=MT("dilations",e,t,n);return[r.conv2d(MT("x",e,t,n),MT("filter",e,t,n),[u[1],u[2]],c,l,[p[1],p[2]])];case"_FusedConv2D":var d=rE(e,t,n),f=d.stride,h=d.pad,m=d.dataFormat,v=d.dilations,g=d.biasArg,y=d.preluArg,b=d.activationFunc,x=d.leakyreluAlpha;return[r.fused.conv2d({x:MT("x",e,t,n),filter:MT("filter",e,t,n),strides:[f[1],f[2]],pad:h,dataFormat:m,dilations:[v[1],v[2]],bias:g,activation:b,preluActivationWeights:y,leakyreluAlpha:x})];case"FusedDepthwiseConv2dNative":var k=rE(e,t,n),w=k.stride,S=k.pad,I=k.dataFormat,N=k.dilations,T=k.biasArg,C=k.preluArg,E=k.activationFunc,_=k.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:MT("x",e,t,n),filter:MT("filter",e,t,n),strides:[w[1],w[2]],pad:S,dataFormat:I,dilations:[N[1],N[2]],bias:T,activation:E,preluActivationWeights:C,leakyreluAlpha:_})];case"Conv2DBackpropInput":case"Conv2dTranspose":var A=MT("outputShape",e,t,n),R=MT("strides",e,t,n),F=WT(e,t,n);return[r.conv2dTranspose(MT("x",e,t,n),MT("filter",e,t,n),A,[R[1],R[2]],F)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var D=MT("strides",e,t,n),Z=WT(e,t,n),O=MT("dilations",e,t,n),M=MT("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(MT("input",e,t,n),MT("filter",e,t,n),[D[1],D[2]],Z,M,[O[1],O[2]])];case"Conv3D":var z=MT("strides",e,t,n),L=MT("pad",e,t,n),P=MT("dataFormat",e,t,n).toUpperCase(),B=MT("dilations",e,t,n);return[r.conv3d(MT("x",e,t,n),MT("filter",e,t,n),[z[1],z[2],z[3]],L,P,[B[1],B[2],B[3]])];case"AvgPool":var W=MT("strides",e,t,n),V=MT("pad",e,t,n),U=MT("kernelSize",e,t,n);return[r.avgPool(MT("x",e,t,n),[U[1],U[2]],[W[1],W[2]],V)];case"MaxPool":var G=MT("strides",e,t,n),j=MT("pad",e,t,n),H=MT("kernelSize",e,t,n);return[r.maxPool(MT("x",e,t,n),[H[1],H[2]],[G[1],G[2]],j)];case"MaxPoolWithArgmax":var q=MT("strides",e,t,n),K=MT("pad",e,t,n),X=MT("kernelSize",e,t,n),Y=MT("includeBatchInIndex",e,t,n),Q=r.maxPoolWithArgmax(MT("x",e,t,n),[X[1],X[2]],[q[1],q[2]],K,Y),J=Q.result,$=Q.indexes;return[J,$];case"AvgPool3D":var ee=MT("strides",e,t,n),te=MT("pad",e,t,n),ne=MT("kernelSize",e,t,n);return[r.avgPool3d(MT("x",e,t,n),[ne[1],ne[2],ne[3]],[ee[1],ee[2],ee[3]],te)];case"MaxPool3D":var re=MT("strides",e,t,n),ae=MT("pad",e,t,n),ie=MT("kernelSize",e,t,n);return[r.maxPool3d(MT("x",e,t,n),[ie[1],ie[2],ie[3]],[re[1],re[2],re[3]],ae)];case"Dilation2D":var oe=MT("strides",e,t,n),se=MT("pad",e,t,n),ue=MT("dilations",e,t,n),ce=oe[1],le=oe[2],pe=ue[1],de=ue[2];return[r.dilation2d(MT("x",e,t,n),MT("filter",e,t,n),[ce,le],se,[pe,de],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},iE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"Fill":var a=MT("shape",e,t,n),i=MT("dtype",e,t,n),o=MT("value",e,t,n);return[r.fill(a,o,i)];case"LinSpace":var s=MT("start",e,t,n),u=MT("stop",e,t,n),c=MT("num",e,t,n);return[r.linspace(s,u,c)];case"Multinomial":var l=MT("logits",e,t,n),p=MT("numSamples",e,t,n),d=MT("seed",e,t,n);return[r.multinomial(l,p,d)];case"OneHot":var f=MT("indices",e,t,n),h=MT("depth",e,t,n),m=MT("onValue",e,t,n),v=MT("offValue",e,t,n);return[r.oneHot(f,h,m,v)];case"Ones":return[r.ones(MT("shape",e,t,n),MT("dtype",e,t,n))];case"OnesLike":return[r.onesLike(MT("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(MT("shape",e,t,n),MT("dtype",e,t,n),MT("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(MT("shape",e,t,n),MT("minval",e,t,n),MT("maxval",e,t,n),MT("dtype",e,t,n))];case"Range":var g=MT("start",e,t,n),y=MT("stop",e,t,n),b=MT("step",e,t,n);return[r.range(g,y,b,MT("dtype",e,t,n))];case"TruncatedNormal":var x=MT("shape",e,t,n),k=MT("mean",e,t,n),w=MT("stdDev",e,t,n),S=MT("seed",e,t,n);return[r.truncatedNormal(x,k,w,MT("dtype",e,t,n),S)];case"Zeros":return[r.zeros(MT("shape",e,t,n),MT("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(MT("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function oE(e,t,n){return{boxes:MT("boxes",e,t,n),scores:MT("scores",e,t,n),maxOutputSize:MT("maxOutputSize",e,t,n),iouThreshold:MT("iouThreshold",e,t,n),scoreThreshold:MT("scoreThreshold",e,t,n),softNmsSigma:MT("softNmsSigma",e,t,n)}}var sE=function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,d,f,h,m,g,y,b,x,k,w,S,I,N,T,C,E,_,A,R=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=R.length>4&&void 0!==R[4]?R[4]:UC,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?15:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?26:"Where"===e.t0?31:"ListDiff"===e.t0?37:38;break;case 4:return o=oE(t,n,r),s=o.boxes,u=o.scores,c=o.maxOutputSize,l=o.iouThreshold,p=o.scoreThreshold,d=o.softNmsSigma,e.next=13,i.image.nonMaxSuppressionWithScoreAsync(s,u,c,l,p,d);case 13:return f=e.sent,e.abrupt("return",[f.selectedIndices,f.selectedScores]);case 15:return h=oE(t,n,r),m=h.boxes,g=h.scores,y=h.maxOutputSize,b=h.iouThreshold,x=h.scoreThreshold,k=MT("padToMaxOutputSize",t,n,r),e.next=24,i.image.nonMaxSuppressionPaddedAsync(m,g,y,b,x,k);case 24:return w=e.sent,e.abrupt("return",[w.selectedIndices,w.validOutputs]);case 26:return S=oE(t,n,r),I=S.boxes,N=S.scores,T=S.maxOutputSize,C=S.iouThreshold,E=S.scoreThreshold,e.next=29,i.image.nonMaxSuppressionAsync(I,N,T,C,E);case 29:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 31:return _=i.cast(MT("condition",t,n,r),"bool"),e.next=34,i.whereAsync(_);case 34:return e.t2=e.sent,A=[e.t2],e.abrupt("return",(_.dispose(),A));case 37:return e.abrupt("return",i.setdiff1dAsync(MT("x",t,n,r),MT("y",t,n,r)));case 38:throw TypeError("Node type ".concat(t.op," is not implemented"));case 39:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),uE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"LowerBound":var a=MT("sortedSequence",e,t,n),i=MT("values",e,t,n);return[r.lowerBound(a,i)];case"TopKV2":var o=MT("x",e,t,n),s=MT("k",e,t,n),u=MT("sorted",e,t,n),c=r.topk(o,s,u);return[c.values,c.indices];case"UpperBound":var l=MT("sortedSequence",e,t,n),p=MT("values",e,t,n);return[r.upperBound(l,p)];case"Unique":var d=MT("x",e,t,n),f=r.unique(d);return[f.values,f.indices];case"UniqueV2":var h=MT("x",e,t,n),m=MT("axis",e,t,n),v=r.unique(h,m);return[v.values,v.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},cE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var a=MT("default",e,t,n);return[zT(e.name,t,n)||a];case"Placeholder":return[zT(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":var i=MT("x",e,t,n);return[VT(i)];case"IdentityN":return MT("x",e,t,n).map((function(e){return VT(e)}));case"Snapshot":var o=MT("x",e,t,n);return[VT(o)];case"Shape":return[r.tensor1d(MT("x",e,t,n).shape,"int32")];case"ShapeN":return MT("x",e,t,n).map((function(e){return r.tensor1d(e.shape)}));case"Size":return[r.scalar(MT("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(MT("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var s=MT("x",e,t,n),u=MT("data",e,t,n),c=MT("message",e,t,n),l=MT("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var p=0;p<u.length;p++)console.log(Array.prototype.slice.call(u[p].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},lE=function(){function e(t,n){(0,y.Z)(this,e),this.keyDType=t,this.valueDType=n,this.handle=Xl(0),this.tensorMap=new Map,Xs(this.handle)}return(0,b.Z)(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return Xl(this.size(),"int32")}},{key:"import",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),qs((function(){var e=df(n),t=r.length,i=e.length;Fa.assert(t===i,(function(){return"The number of elements doesn't match, keys has ".concat(t," elements, the values has ").concat(i," elements.")}));for(var o=0;o<t;o++){var s=r[o],u=e[o];Xs(u),a.tensorMap.set(s,u)}return a.handle}))));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",qs((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return Jd(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}}]),e}(),pE=function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,d,f,h;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?5:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?10:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?15:17;break;case 3:return i=MT("keyDType",t,n,r),o=MT("valueDType",t,n,r),s=new lE(i,o),e.abrupt("return",(a.addHashTable(t.name,s),[s.handle]));case 5:return u=MT("tableHandle",t,n,r,a),c=MT("keys",t,n,r),l=MT("values",t,n,r),e.next=8,a.getHashTableById(u.id).import(c,l);case 8:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 10:return p=MT("tableHandle",t,n,r,a),d=MT("keys",t,n,r),f=MT("defaultValue",t,n,r),e.next=13,a.getHashTableById(p.id).find(d,f);case 13:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 15:return h=MT("tableHandle",t,n,r,a),e.abrupt("return",[a.getHashTableById(h.id).tensorSize()]);case 17:throw TypeError("Node type ".concat(t.op," is not implemented"));case 18:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),dE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"ResizeBilinear":var a=MT("images",e,t,n),i=MT("size",e,t,n),o=MT("alignCorners",e,t,n),s=MT("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)];case"ResizeNearestNeighbor":var u=MT("images",e,t,n),c=MT("size",e,t,n),l=MT("alignCorners",e,t,n),p=MT("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(u,[c[0],c[1]],l,p)];case"CropAndResize":var d=MT("image",e,t,n),f=MT("boxes",e,t,n),h=MT("boxInd",e,t,n),m=MT("cropSize",e,t,n),v=MT("method",e,t,n),g=MT("extrapolationValue",e,t,n);return[r.image.cropAndResize(d,f,h,m,v,g)];case"ImageProjectiveTransformV3":var y=MT("images",e,t,n),b=MT("transforms",e,t,n),x=MT("outputShape",e,t,n),k=MT("fillValue",e,t,n),w=MT("interpolation",e,t,n),S=MT("fillMode",e,t,n);return[r.image.transform(y,b,w.toLowerCase(),S.toLowerCase(),k,x)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},fE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"Equal":return[r.equal(MT("a",e,t,n),MT("b",e,t,n))];case"NotEqual":return[r.notEqual(MT("a",e,t,n),MT("b",e,t,n))];case"Greater":return[r.greater(MT("a",e,t,n),MT("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(MT("a",e,t,n),MT("b",e,t,n))];case"Less":return[r.less(MT("a",e,t,n),MT("b",e,t,n))];case"LessEqual":return[r.lessEqual(MT("a",e,t,n),MT("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(MT("a",e,t,n),MT("b",e,t,n))];case"LogicalNot":return[r.logicalNot(MT("a",e,t,n))];case"LogicalOr":return[r.logicalOr(MT("a",e,t,n),MT("b",e,t,n))];case"Select":case"SelectV2":return[r.where(MT("condition",e,t,n),MT("a",e,t,n),MT("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},hE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(MT("a",e,t,n),MT("b",e,t,n),MT("transposeA",e,t,n),MT("transposeB",e,t,n))];case"Einsum":return[r.einsum.apply(r,[MT("equation",e,t,n)].concat((0,h.Z)(MT("tensors",e,t,n))))];case"Transpose":return[r.transpose(MT("x",e,t,n),MT("perm",e,t,n))];case"_FusedMatMul":var a=MT("fusedOps",e,t,n),i=(0,m.Z)(a,2),o=i[0],s=i[1],u="biasadd"===o,c="prelu"===s,l=MT("numArgs",e,t,n),p=MT("leakyreluAlpha",e,t,n);if(u){if(c&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var d=MT("args",e,t,n),f=(0,m.Z)(d,2),v=f[0],g=f[1];return[r.fused.matMul({a:MT("a",e,t,n),b:MT("b",e,t,n),transposeA:MT("transposeA",e,t,n),transposeB:MT("transposeB",e,t,n),bias:v,activation:s,preluActivationWeights:g,leakyreluAlpha:p})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},mE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(MT("x",e,t,n),MT("axis",e,t,n),MT("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(MT("x",e,t,n),MT("mean",e,t,n),MT("variance",e,t,n),MT("offset",e,t,n),MT("scale",e,t,n),MT("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(MT("x",e,t,n),MT("radius",e,t,n),MT("bias",e,t,n),MT("alpha",e,t,n),MT("beta",e,t,n))];case"Softmax":return[r.softmax(MT("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(MT("x",e,t,n))];case"SparseToDense":return[r.sparseToDense(MT("sparseIndices",e,t,n),MT("outputShape",e,t,n),MT("sparseValues",e,t,n),MT("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},vE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"Max":var a=MT("axis",e,t,n),i=MT("keepDims",e,t,n);return[r.max(MT("x",e,t,n),a,i)];case"Mean":var o=MT("axis",e,t,n),s=MT("keepDims",e,t,n);return[r.mean(MT("x",e,t,n),o,s)];case"Min":var u=MT("axis",e,t,n),c=MT("keepDims",e,t,n);return[r.min(MT("x",e,t,n),u,c)];case"Sum":var l=MT("axis",e,t,n),p=MT("keepDims",e,t,n);return[r.sum(MT("x",e,t,n),l,p)];case"All":var d=MT("axis",e,t,n),f=MT("keepDims",e,t,n);return[r.all(MT("x",e,t,n),d,f)];case"Any":var h=MT("axis",e,t,n),m=MT("keepDims",e,t,n);return[r.any(MT("x",e,t,n),h,m)];case"ArgMax":var v=MT("axis",e,t,n);return[r.argMax(MT("x",e,t,n),v)];case"ArgMin":var g=MT("axis",e,t,n);return[r.argMin(MT("x",e,t,n),g)];case"Prod":var y=MT("axis",e,t,n),b=MT("keepDims",e,t,n);return[r.prod(MT("x",e,t,n),y,b)];case"Cumprod":var x=MT("axis",e,t,n),k=MT("exclusive",e,t,n),w=MT("reverse",e,t,n);return[r.cumprod(MT("x",e,t,n),x,k,w)];case"Cumsum":var S=MT("axis",e,t,n),I=MT("exclusive",e,t,n),N=MT("reverse",e,t,n);return[r.cumsum(MT("x",e,t,n),S,I,N)];case"Bincount":var T=MT("x",e,t,n),C=MT("weights",e,t,n),E=MT("size",e,t,n);return[r.bincount(T,C,E)];case"DenseBincount":var _=MT("x",e,t,n),A=MT("weights",e,t,n),R=MT("size",e,t,n),F=MT("binaryOutput",e,t,n);return[r.denseBincount(_,A,R,F)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},gE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"ConcatV2":case"Concat":var a=MT("n",e,t,n),i=MT("axis",e,t,n),o=MT("tensors",e,t,n);return o=o.slice(0,a),[r.concat(o,i)];case"Gather":var s=MT("x",e,t,n),u=MT("indices",e,t,n);return[r.gather(s,r.cast(u,"int32"),0)];case"GatherV2":var c=MT("axis",e,t,n),l=MT("batchDims",e,t,n),p=MT("x",e,t,n),d=MT("indices",e,t,n);return[r.gather(p,r.cast(d,"int32"),c,l)];case"Reverse":for(var f=MT("dims",e,t,n),h=[],m=0;m<f.length;m++)f[m]&&h.push(m);var v=MT("x",e,t,n);return[r.reverse(v,h)];case"ReverseV2":var g=MT("axis",e,t,n),y=MT("x",e,t,n);return[r.reverse(y,g)];case"Slice":var b=MT("begin",e,t,n),x=MT("size",e,t,n);return[r.slice(MT("x",e,t,n),b,x)];case"StridedSlice":var k=MT("begin",e,t,n),w=MT("end",e,t,n),S=MT("strides",e,t,n),I=MT("beginMask",e,t,n),N=MT("endMask",e,t,n),T=MT("ellipsisMask",e,t,n),C=MT("newAxisMask",e,t,n),E=MT("shrinkAxisMask",e,t,n),_=MT("x",e,t,n);return[r.stridedSlice(_,k,w,S,I,N,T,C,E)];case"Pack":return qs((function(){var a=MT("axis",e,t,n),i=MT("tensors",e,t,n),o=i[0].shape,s=r.squeeze(i[0]).shape,u=i.map((function(e){var t=Fa.arraysEqual(e.shape,o);if(!t&&!Fa.arraysEqual(r.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,o)}));return[r.stack(u,a)]}));case"Unpack":var A=MT("axis",e,t,n),R=MT("tensor",e,t,n);return r.unstack(R,A);case"Tile":var F=MT("reps",e,t,n);return[r.tile(MT("x",e,t,n),F)];case"Split":case"SplitV":var D=MT("axis",e,t,n),Z=MT("numOrSizeSplits",e,t,n),O=MT("x",e,t,n);return r.split(O,Z,D);case"ScatterNd":var M=MT("indices",e,t,n),z=MT("values",e,t,n),L=MT("shape",e,t,n);return[r.scatterND(M,z,L)];case"GatherNd":var P=MT("x",e,t,n),B=MT("indices",e,t,n);return[r.gatherND(P,B)];case"SparseToDense":var W=MT("sparseIndices",e,t,n),V=MT("outputShape",e,t,n),U=MT("sparseValues",e,t,n),G=MT("defaultValue",e,t,n);return[r.sparseToDense(W,U,V,U.dtype===G.dtype?G:r.cast(G,U.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},yE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"SparseFillEmptyRows":var a=r.sparse.sparseFillEmptyRows(MT("indices",e,t,n),MT("values",e,t,n),MT("denseShape",e,t,n),MT("defaultValue",e,t,n)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u];case"SparseReshape":var c=r.sparse.sparseReshape(MT("inputIndices",e,t,n),MT("inputShape",e,t,n),MT("newShape",e,t,n)),l=c.outputIndices,p=c.outputShape;return[l,p];case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(MT("data",e,t,n),MT("indices",e,t,n),MT("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(MT("data",e,t,n),MT("indices",e,t,n),MT("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},bE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"FFT":return[r.fft(MT("x",e,t,n))];case"IFFT":return[r.ifft(MT("x",e,t,n))];case"RFFT":return[r.rfft(MT("x",e,t,n))];case"IRFFT":return[r.irfft(MT("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},xE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"StringNGrams":var a=r.string.stringNGrams(MT("data",e,t,n),MT("dataSplits",e,t,n),MT("separator",e,t,n),MT("nGramWidths",e,t,n),MT("leftPad",e,t,n),MT("rightPad",e,t,n),MT("padWidth",e,t,n),MT("preserveShortSequences",e,t,n)),i=a.nGrams,o=a.nGramsSplits;return[i,o];case"StringSplit":var s=r.string.stringSplit(MT("input",e,t,n),MT("delimiter",e,t,n),MT("skipEmpty",e,t,n)),u=s.indices,c=s.values,l=s.shape;return[u,c,l];case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(MT("input",e,t,n),MT("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},kE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:UC;switch(e.op){case"Cast":return[r.cast(MT("x",e,t,n),MT("dtype",e,t,n))];case"ExpandDims":var a=MT("axis",e,t,n);return[r.expandDims(MT("x",e,t,n),a)];case"Squeeze":var i=MT("axis",e,t,n);return[r.squeeze(MT("x",e,t,n),i)];case"Reshape":return[r.reshape(MT("x",e,t,n),MT("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(MT("x",e,t,n),MT("padding",e,t,n),MT("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(MT("x",e,t,n),MT("padding",e,t,n),MT("constantValue",e,t,n))];case"SpaceToBatchND":var o=MT("blockShape",e,t,n),s=MT("paddings",e,t,n);return[r.spaceToBatchND(MT("x",e,t,n),o,s)];case"BatchToSpaceND":var u=MT("blockShape",e,t,n),c=MT("crops",e,t,n);return[r.batchToSpaceND(MT("x",e,t,n),u,c)];case"DepthToSpace":var l=MT("blockSize",e,t,n),p=MT("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(MT("x",e,t,n),l,p)];case"BroadcastTo":return[r.broadcastTo(MT("x",e,t,n),MT("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(MT("s0",e,t,n),MT("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function wE(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qs,i=function(e,t,n){switch(e.category){case"arithmetic":return a((function(){return GC(e,t,n)}));case"basic_math":return a((function(){return jC(e,t,n)}));case"control":return nE(e,t,n);case"convolution":return a((function(){return aE(e,t,n)}));case"creation":return a((function(){return iE(e,t,n)}));case"dynamic":return sE(e,t,n);case"evaluation":return a((function(){return uE(e,t,n)}));case"image":return a((function(){return dE(e,t,n)}));case"graph":return a((function(){return cE(e,t,n)}));case"logical":return a((function(){return fE(e,t,n)}));case"matrices":return a((function(){return hE(e,t,n)}));case"normalization":return a((function(){return mE(e,t,n)}));case"reduction":return a((function(){return vE(e,t,n)}));case"slice_join":return a((function(){return gE(e,t,n)}));case"sparse":return a((function(){return yE(e,t,n)}));case"spectral":return a((function(){return bE(e,t,n)}));case"string":return a((function(){return xE(e,t,n)}));case"transformation":return a((function(){return kE(e,t,n)}));case"hash_table":return pE(e,t,n,r);case"custom":var i=ZT(e.op);if(i&&i.customExecutor)return i.customExecutor(new VC(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}}(e,t,n);return Fa.isPromise(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var SE=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,y.Z)(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return(0,b.Z)(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function IE(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return BT(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return BT(e.name)[0]})));for(var p=(0,h.Z)(t);p.length>0;){var d=p.pop();if((EE(d)||_E(d)||AE(d))&&null==o&&(s=(o=d).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(d.name),null==n[d.name]&&-1===c.indexOf(d.name)&&-1===l.indexOf(d.name)){if(0===d.inputs.length){i.push(d.name);continue}d.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),p.push(e))}))}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var NE=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],TE=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],CE=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function EE(e){return NE.indexOf(e.op)>=0}function _E(e){return TE.indexOf(e.op)>=0}function AE(e){return CE.indexOf(e.op)>=0}var RE=function(){function e(t,n){var r=this;(0,y.Z)(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return(0,b.Z)(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,(0,h.Z)(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=IE(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return BT(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[BT(e)[0]]})),i=t.map((function(e){return BT(e)[0]})),o=i.map((function(e){return n.graph.nodes[e]}));this.resetIntermediateTensors(),0===o.length&&(o=this._outputs);var s=this.getCompilationKey(a,o),u=this.compiledMap.get(s);null==u&&(u=this.compile(e,o),this.compiledMap.set(s,u));var c={},l={};return qs((function(){var r=new SE(n.weightMap,c,l,n.functionExecutorMap),a=Object.assign({},n.weightMap);Object.keys(e).forEach((function(t){var n=BT(t),r=(0,m.Z)(n,2),i=r[0],o=[];o[r[1]]=e[t],a[i]=o}));for(var o=n.getFrozenTensorIds(a),s={},p=0;p<u.length;p++){var d=u[p];if(!a[d.name]){var f=wE(d,a,r,n._resourceManager);if(Fa.isPromise(f))throw new Error("The execution of the op '".concat(d.op,"' returned a promise. Please use model.executeAsync() instead."));a[d.name]=f,n.checkTensorForDisposal(d.name,d,a,r,o,i,s)}}return null==n.parent&&r.dispose(o),t.map((function(e){return zT(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){var s=this;"control"===t.category||-1!==i.indexOf(e)||(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var i=function(e,t,n){return t[PT(e,n.currentContextId)]}(e.name,n,r);null!=i&&i.forEach((function(e){if(e&&!e.kept&&!a.has(e.id)){var n=o[e.id];if(1===n){if(s.keepTensorForDebug){var i=LT(t.name,r),u=(0,m.Z)(i,2),c=u[0],l=u[1];s.intermediateTensors[c]||(s.intermediateTensors[c]=[]),s.intermediateTensors[c][l]=e}else e.dispose();delete o[e.id]}else null!=n&&o[e.id]--}}))}})))}},{key:"executeAsync",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){var e=this;!this.intermediateTensors||(Object.keys(this.intermediateTensors).forEach((function(t){return e.intermediateTensors[t].forEach((function(e){return e.dispose()}))})),this.disposeTensorsMap())}},{key:"disposeTensorsMap",value:function(){var e=this;!this.tensorsMap||Object.keys(this.tensorsMap).forEach((function(t){e.tensorsMap[t].forEach((function(t){t&&!t.kept&&!t.isDisposed&&!e.keepIds.has(t.id)&&t.dispose()}))}))}},{key:"getIntermediateTensors",value:function(){return this.tensorsMap}},{key:"resetIntermediateTensors",value:function(){for(var e in this.intermediateTensors)this.intermediateTensors[e].forEach((function(e){return e.dispose()})),delete this.intermediateTensors[e]}},{key:"_executeAsync",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l=this,p=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p.length>2&&void 0!==p[2]&&p[2],a=p.length>3&&void 0!==p[3]?p[3]:{},i=p.length>4&&void 0!==p[4]?p[4]:{},r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=rt().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){console.warn(d.message)}return this.resetIntermediateTensors(),o=new SE(this.weightMap,a,i,this.functionExecutorMap),e.next=9,this.executeWithControlFlow(t,o,n,r);case 9:return this.tensorsMap=e.sent,s=n.map((function(e){return zT(e,l.tensorsMap,o)})),u=s.map((function(e){return e.id})),c=Object.keys(t).map((function(e){return t[e].id})),e.abrupt("return",(this.keepIds=new Set([].concat((0,h.Z)(u),(0,h.Z)(c),(0,h.Z)(this.weightIds))),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&o.dispose(this.keepIds),s));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,i=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,d,f,g,y,b,x,k,w,S,I,N=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return N.graph.nodes[BT(e)[0]]})),s=r.map((function(e){return BT(e)[0]})),u=s.map((function(e){return N.graph.nodes[e]})),0===u.length&&(u=this._outputs),c=IE(t,u,this.weightMap,this._initNodes),l=c.usedNodes,p=c.missingInputs,d=c.dynamicNode,f=c.syncInputs,g=[].concat((0,h.Z)(o),(0,h.Z)(this.graph.weights),(0,h.Z)(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),y=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=BT(e),r=(0,m.Z)(n,2),a=r[0],i=[];i[r[1]]=t[e],y[a]=i})),b={},x=this.getFrozenTensorIds(y),k={};case 5:if(!(g.length>0)){e.next=11;break}return w=this.processStack(o,g,n,y,k,x,s,b,l),e.next=9,Promise.all(w);case 9:e.next=5;break;case 11:if(null==d&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),S=u.filter((function(e){return!EE(e)&&!zT(e.name,y,n)})).map((function(e){return e.name})),!(S.length>0)){e.next=16;break}throw I="",null!=d&&(I="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(f,"]")),new Error("Cannot compute the outputs [".concat(S,"] from the provided inputs [").concat(i,"]. Consider providing the following inputs: [").concat(p,"]. ").concat(I));case 16:return e.abrupt("return",y);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,i,o,s,u){for(var c=this,l=[],p=function(){var e,p,d=t.pop();n.currentContext=d.contexts;var f="";if("Enter"===d.node.op&&MT("isConstant",d.node,r,n)&&(e=LT(d.node.name,n),p=(0,m.Z)(e,1),f=p[0]),null==r[d.node.name]){var h,v,g=wE(d.node,r,n,c._resourceManager);f||(h=LT(d.node.name,n),v=(0,m.Z)(h,1),f=v[0]);var y=n.currentContext;Fa.isPromise(g)?l.push(g.then((function(e){return r[f]=e,n.currentContext=y,c.checkTensorForDisposal(f,d.node,r,n,i,o,s),c.processChildNodes(d.node,t,n,r,a,u),e}))):(r[f]=g,c.checkTensorForDisposal(f,d.node,r,n,i,o,s),c.processChildNodes(d.node,t,n,r,a,u))}else c.processChildNodes(d.node,t,n,r,a,u)};t.length>0;)p();return l}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=LT(e.name,n),s=(0,m.Z)(o,1)[0];a[s]||!i.has(e.name)||("Merge"===e.op?e.inputNames.some((function(e){return!!zT(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!zT(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=BT(n),i=(0,m.Z)(a,1)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value,u=s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e}));Fa.assert(u,(function(){return"The shape of dict['".concat(o.name,"'] provided in model.execute(dict) must be [").concat(s,"], but was [").concat(r.shape,"]")}))}o.attrParams.dtype&&o.attrParams.dtype.value&&Fa.assert(r.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(o.name,"'] provided in model.execute(dict) must be ").concat(o.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t={};for(var n in e){if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n])t[this._signature.inputs[n].name]=e[n];else t[n]=e[n]}return t}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=BT(e),r=(0,m.Z)(n,1)[0];return null==t.graph.nodes[r]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=BT(e),r=(0,m.Z)(n,1)[0];if(!t.graph.nodes[r])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),FE=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,y.Z)(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return(0,b.Z)(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),DE=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ds;(0,y.Z)(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new FE}return(0,b.Z)(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}},{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Fa.isPromise(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new RE(CC.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var i=CC.Instance.transformGraph(e.modelInitializer);this.initializer=new RE(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.abrupt("return",t.save(this.artifacts));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e,t){var n=this,r=this.execute(e,this.outputNodes);if(this.structuredOutputKeys){var a={};return(r instanceof hi?[r]:r).forEach((function(e,t){return a[n.structuredOutputKeys[t]]=e})),a}return r}},{key:"normalizeInputs",value:function(e){if(!(e instanceof hi)&&!Array.isArray(e))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has ".concat(this.inputNodes.length," placeholders, while there are ").concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=3,this.executor.executeAsync(t,n);case 3:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}]),e}();function ZE(e){return OE.apply(this,arguments)}function OE(){return OE=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:ds,null!=t){e.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==n&&(n={}),n.fromTFHub&&"string"==typeof t&&(t=zE(t)),a=new DE(t,n,r),e.next=8,a.load();case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)}))),OE.apply(this,arguments)}function ME(e){if(null==e)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide a url or an IOHandler that loads the model");if(!e.load)throw new Error("modelUrl IO Handler ".concat(e," has no load function"));var t=new DE(e);return t.load(),t}function zE(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat("model.json").concat("?tfjs-format=file")}var LE="3.19.0",PE={};D(PE,{CSVDataset:function(){return Z_},Dataset:function(){return k_},FileDataSource:function(){return X_},TextLineDataset:function(){return C_},URLDataSource:function(){return Y_},array:function(){return S_},csv:function(){return Q_},func:function(){return J_},generator:function(){return $_},microphone:function(){return nA},version_data:function(){return aA},webcam:function(){return eA},zip:function(){return I_}});var BE=Z(H()),WE=Z(H());function VE(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(KE(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=e[o],u=VE(s,t,n,r);i[o]=u}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function UE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jE;return GE(e,t)}function GE(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(KE(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=GE(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function jE(e){return null===e?null:KE(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function HE(e,t){return qE.apply(this,arguments)}function qE(){return qE=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Map,VE(t,n,r),a=0,i=Array.from(r.keys());case 3:if(!(a<i.length)){e.next=14;break}if(o=i[a],s=r.get(o),!Fa.isPromise(s)){e.next=11;break}return e.next=9,s;case 9:u=e.sent,r.set(o,u);case 11:a++,e.next=3;break;case 14:return e.abrupt("return",VE(t,n,r));case 15:case"end":return e.stop()}}),e)}))),qE.apply(this,arguments)}function KE(e){var t=!1;rt().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof q().StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof hi)&&!(e instanceof Promise)&&!t)}function XE(e){return function(e,t){return VE(e,t)}(e,YE)}function YE(e){return e instanceof hi?{value:e.clone(),recurse:!1}:KE(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var QE=function(){function e(t){if((0,y.Z)(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return(0,b.Z)(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=(0,x.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),JE=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.call(this,n.INITIAL_CAPACITY)}return(0,b.Z)(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){(0,o.Z)((0,s.Z)(n.prototype),"isFull",this).call(this)&&this.expand(),(0,o.Z)((0,s.Z)(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){(0,o.Z)((0,s.Z)(n.prototype),"isFull",this).call(this)&&this.expand(),(0,o.Z)((0,s.Z)(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(QE);function $E(e){return new i_(e)}function e_(e){return new o_(e)}function t_(e,t){return new g_(e,t)}function n_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r_.FAIL;return new y_(e,t)}JE.INITIAL_CAPACITY=32;var r_,a_=function(){function e(){(0,y.Z)(this,e)}return(0,b.Z)(e,[{key:"toArray",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent;case 10:e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent;case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value);case 9:e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new f_(this,e)}},{key:"filter",value:function(e){return new p_(this,e)}},{key:"map",value:function(e){return new d_(this,e)}},{key:"mapAsync",value:function(e){return new h_(this,e)}},{key:"serialMapAsync",value:function(e){return new h_(this,e).serial()}},{key:"flatmap",value:function(e){return new v_(this,e)}},{key:"forEachAsync",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new l_(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jE;return this.rowMajorBatch(e,t).map((function(e){return UE(e,n)}))}},{key:"concatenate",value:function(e,t){return new g_($E([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new c_(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new u_(this,e)}},{key:"prefetch",value:function(e){return new b_(this,e)}},{key:"shuffle",value:function(e,t){return new x_(this,e,t)}},{key:"serial",value:function(){return new s_(this)}}]),e}(),i_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).items=e,r.trav=0,r}return(0,b.Z)(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],e.abrupt("return",(this.trav++,{value:XE(t),done:!1}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),o_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).nextFn=e,r}return(0,b.Z)(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),s_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),u_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:Ks(t.value);case 7:e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),c_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),l_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=10;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=7;break}return e.abrupt("return",this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0});case 7:t.push(n.value);case 8:e.next=1;break;case 10:return e.abrupt("return",{value:t,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),p_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=5;break}return e.abrupt("return",t);case 5:Ks(t.value);case 6:e.next=0;break;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),d_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=wi.getTensorsInContainer(t.value),r=this.transform(t.value),a=wi.getTensorsInContainer(r),i=(0,x.Z)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,wi.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),f_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upstream.next();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),this.handler(e.t0)){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),h_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=wi.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=wi.getTensorsInContainer(r),i=(0,x.Z)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,wi.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),m_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,y.Z)(this,n),(e=t.call(this)).outputQueue=new JE,e.lastRead=Promise.resolve({value:null,done:!1}),e}return(0,b.Z)(n,[{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),v_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=wi.getTensorsInContainer(t.value),r=this.transform(t.value),a=wi.getTensorsInContainer(r),this.outputQueue.pushAll(r),i=(0,x.Z)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,wi.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(m_),g_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return(0,b.Z)(n,[{key:"summary",value:function(){return"TODO: fill in upstream of chained summaries -> Chained"}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.readFromChain(this.lastRead),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=9;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 9:return e.next=11,this.iterator.next();case 11:return r=e.sent,e.abrupt("return",r.done?(this.iterator=null,this.readFromChain(t)):r);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(a_);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(r_||(r_={}));var y_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r_.FAIL;return(0,y.Z)(this,n),(r=t.call(this)).iterators=e,r.mismatchMode=a,r.count=0,r.currentPromise=null,r}return(0,b.Z)(n,[{key:"summary",value:function(){return"{TODO: fill in upstream of zip summaries} -> Zip"}},{key:"nextState",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e instanceof a_?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}},e.next=3,t;case 3:return n=0,r=0,e.next=6,HE(this.iterators,a);case 6:if(i=e.sent,n!==r){e.next=9;break}return e.abrupt("return",{value:null,done:!0});case 9:if(!(r>0)){e.next=15;break}e.t0=this.mismatchMode,e.next=e.t0===r_.FAIL?13:e.t0===r_.SHORTEST?14:(e.t0,r_.LONGEST,15);break;case 13:throw new Error("Zipped streams should have the same length. Mismatched at element ".concat(this.count,"."));case 14:return e.abrupt("return",{value:null,done:!0});case 15:return e.abrupt("return",(this.count++,{value:i,done:!1}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.currentPromise=this.nextState(this.currentPromise),this.currentPromise));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),b_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new QE(r),a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(a_),x_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a){var i;return(0,y.Z)(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=WE.alea(a||Fa.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return(0,b.Z)(n,[{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=13;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=11;break;case 10:return e.abrupt("return",(this.refill(),n));case 11:e.next=1;break;case 13:return e.abrupt("return",{value:null,done:!0});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(b_),k_=function(){function e(){(0,y.Z)(this,e),this.size=null}return(0,b.Z)(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return Fa.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),w_((0,g.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,N_));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,w_((0,g.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,w_((0,g.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return qs((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return w_((0,g.Z)((0,v.Z)().mark((function n(){return(0,v.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return qs((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return w_((0,g.Z)((0,v.Z)().mark((function n(){return(0,v.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return w_((0,g.Z)((0,v.Z)().mark((function n(){return(0,v.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,w_((0,g.Z)((0,v.Z)().mark((function t(){var r;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e_((0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 5:case"end":return e.stop()}}),e)})))),t.abrupt("return",t_(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,w_((0,g.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=BE.alea(t||Fa.now().toString());return w_((0,g.Z)((0,v.Z)().mark((function t(){var i;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,w_((0,g.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function w_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){(0,d.Z)(a,n);var r=(0,f.Z)(a);function a(){var e;return(0,y.Z)(this,a),(e=r.apply(this,arguments)).size=t,e}return(0,b.Z)(a,[{key:"iterator",value:function(){var t=(0,g.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(k_))}function S_(e){return w_((0,g.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",$E(e));case 1:case"end":return t.stop()}}),t)}))),e.length)}function I_(e){if(!KE(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return w_((0,g.Z)((0,v.Z)().mark((function t(){var n;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,HE(e,(function(e){if(e instanceof k_)return{value:e.iterator(),recurse:!1};if(KE(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 2:return n=t.sent,t.abrupt("return",n_(n,r_.SHORTEST));case 4:case"end":return t.stop()}}),t)}))),t)}function N_(e){return null===e?null:function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof hi||Fa.isTypedArray(e)}(e[0])?{value:T_(e),recurse:!1}:{value:null,recurse:!0}}function T_(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof hi?Jd(e):$i(e)}k_.MAX_BUFFER_SIZE=1e4;var C_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).input=e,r}return(0,b.Z)(n,[{key:"iterator",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return e.abrupt("return",e.sent.decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(k_),E_='"',__=Symbol("out"),A_=Symbol("field"),R_=Symbol("quote"),F_=Symbol("quoteafterquote"),D_=Symbol("quoteinquote"),Z_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).input=e,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new C_(e),r||(r={}),a.hasHeader=!1!==r.hasHeader,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(Fa.assert(null==r.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return(0,b.Z)(n,[{key:"columnNames",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setColumnNames",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o,s=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=5;break}throw new Error("Column names must be provided if there is no header line.");case 5:if(this.fullColumnNames&&t&&Fa.assert(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),r=Object.keys(n).filter((function(e){return n[e]>1})),Fa.assert(0===r.length,(function(){return"Duplicate column names found: "+r.toString()})),!this.columnConfigs){e.next=16;break}a=0,i=Object.keys(this.columnConfigs);case 9:if(!(a<i.length)){e.next=16;break}if(o=i[a],-1!==this.fullColumnNames.indexOf(o)){e.next=13;break}throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 13:a++,e.next=9;break;case 16:this.columnNamesValidated=!0;case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"maybeReadHeaderLine",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=12;break}return e.next=3,this.base.iterator();case 3:return e.next=5,e.sent.next();case 5:if(!(t=e.sent).done){e.next=8;break}throw new Error("No data was found for CSV parsing.");case 8:return n=t.value,e.abrupt("return",this.parseRow(n,!1));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"iterator",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.next=6,this.base.iterator();case 6:return t=e.sent,e.abrupt("return",(this.hasHeader&&(t=t.skip(1)),t.map((function(e){return n.makeDataElement(e)}))));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":default:u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s)}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=__,o=0;o<a;o++)switch(i){case __:switch(e.charAt(o)){case E_:r=o+1,i=R_;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=__;break;default:i=A_,r=o}break;case A_:if(e.charAt(o)===this.delimiter)n.push(e.substring(r,o)),i=__,r=o+1;break;case R_:if(e.charAt(o)===E_)i=F_;break;case F_:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=__,r=o+1;break;case E_:i=R_;break;default:i=D_}break;case D_:if(e.charAt(o)===E_)i=R_}if(i===F_?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),n}(k_),O_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;(0,y.Z)(this,n),(r=t.call(this)).microphoneConfig=e,r.isClosed=!1,r.fftSize=e.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=e.numFramesPerSpectrogram||43,r.sampleRateHz=e.sampleRateHz,r.columnTruncateLength=e.columnTruncateLength||r.fftSize,r.audioTrackConstraints=e.audioTrackConstraints,r.smoothingTimeConstant=e.smoothingTimeConstant||0,r.includeSpectrogram=!1!==e.includeSpectrogram,r.includeWaveform=!0===e.includeWaveform,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return(0,b.Z)(n,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: ".concat(e.t0.message));case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,this.sampleRateHz){e.next=16;break}this.sampleRateHz=this.audioContext.sampleRate,e.next=18;break;case 16:if(this.audioContext.sampleRate===this.sampleRateHz){e.next=18;break}throw new Error("Mismatch in sampling rate: Expected: ".concat(this.sampleRateHz,"; Actual: ").concat(this.audioContext.sampleRate));case 18:n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize);case 20:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"capture",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAudioData",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(Fa.sizeFromShape(t));return n.set(e,n.length-e.length),$i(n,t)}}],[{key:"create",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,r,a=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},rt().get("IS_BROWSER")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return r=new n(t),e.next=6,r.start();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(a_),M_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;if((0,y.Z)(this,n),(a=t.call(this)).webcamVideoElement=e,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=nf([0],"int32"),a.webcamConfig.centerCrop){var i=1*a.webcamConfig.resizeWidth/a.webcamVideoElement.width,o=1*a.webcamConfig.resizeHeight/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,p=o+u;a.cropBox=rf([u,s,p,c],[1,4])}else a.cropBox=rf([0,0,1,1],[1,4]);return(0,l.Z)(a)}return(0,b.Z)(n,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&Fa.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". Please provide 'user' or 'environment'")})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: ".concat(e.t0.message),e.t0;case 10:if(this.stream){e.next=12;break}throw new Error("Could not obtain video from webcam.");case 12:try{this.webcamVideoElement.srcObject=this.stream}catch(X0){console.log(X0),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return e.abrupt("return",(this.webcamVideoElement.play(),this.isClosed=!1,new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}}))));case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=vu.fromPixels(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(e.t0)));case 9:if(!this.resize){e.next=22;break}return e.prev=10,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 14:throw e.prev=14,e.t1=e.catch(10),new Error("Error thrown cropping the video: ".concat(e.t1.message));case 17:return e.prev=17,t.dispose(),e.finish(17);case 20:e.next=23;break;case 22:return e.abrupt("return",{value:t,done:!1});case 23:case"end":return e.stop()}}),e,this,[[2,6],[10,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return qs((function(){var n,r=rp(cs(e,"float32"),0),a=(n=Gh.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return jc(n,a.slice(1))}))}},{key:"capture",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(X0){console.log(X0),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var r,a,i=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},rt().get("IS_BROWSER")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=7;break}if(t=document.createElement("video"),r.resizeWidth&&r.resizeHeight){e.next=6;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 6:t.width=r.resizeWidth,t.height=r.resizeHeight;case 7:return a=new n(t,r),e.next=10,a.start();case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(a_),z_=(0,b.Z)((function e(){(0,y.Z)(this,e)})),L_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"split",value:function(e){return new P_(this,e)}}]),n}(a_),P_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.impl=new B_(e,r),a}return(0,b.Z)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(L_),B_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).upstream=e,a.separator=r,a.carryover="",a}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0));case 5:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=(0,x.Z)(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch(o){r.e(o)}finally{r.f()}return e.abrupt("return",(this.carryover=n[n.length-1],!0));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(m_),W_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"decodeUTF8",value:function(){return new V_(this)}}]),n}(a_),V_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).upstream=e,r.impl=new U_(e),r}return(0,b.Z)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(L_),U_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;if((0,y.Z)(this,n),(r=t.call(this)).upstream=e,rt().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=q().StringDecoder;r.decoder=new a("utf8")}return(0,l.Z)(r)}return(0,b.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Utf8")}},{key:"pump",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.value,e.abrupt("return",(r=rt().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(r),!0));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(m_),G_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,y.Z)(this,n),(r=t.call(this)).file=e,r.options=a,Fa.assert(e instanceof Uint8Array||!!rt().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=a.offset||0,r.chunkSize=a.chunkSize||1048576,r}return(0,b.Z)(n,[{key:"summary",value:function(){return"FileChunks ".concat(this.file)}},{key:"next",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=4;break}e.t0={value:null,done:!0},e.next=9;break;case 4:return e.next=6,new Promise((function(e,n){var r=t.offset+t.chunkSize;if(t.file instanceof Uint8Array)e(new Uint8Array(t.file.slice(t.offset,r)));else{var a=new FileReader;a.onload=function(t){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return n(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return n(new Error("Aborted"))},a.onerror=function(e){return n(new Error(e.type))};var i=t.file.slice(t.offset,r);a.readAsArrayBuffer(i)}t.offset=r}));case 6:e.t1=e.sent,e.t2=!1,e.t0={value:e.t1,done:e.t2};case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(W_);function j_(e){return H_.apply(this,arguments)}function H_(){return H_=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s,u=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2?u[2]:void 0,"string"==typeof t?a=t:(a=t.url,i=q_(t)),e.next=5,(r||Fa.fetch)(a,i);case 5:if(!(o=e.sent).ok){e.next=15;break}return e.t0=Uint8Array,e.next=10,o.arrayBuffer();case 10:return e.t1=e.sent,s=new e.t0(e.t1),e.abrupt("return",new G_(s,n));case 15:throw new Error(o.statusText);case 16:case"end":return e.stop()}}),e)}))),H_.apply(this,arguments)}var q_=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function K_(e){return"string"==typeof e&&"file://"===e.slice(0,7)}var X_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,y.Z)(this,n),(r=t.call(this)).input=e,r.options=a,r}return(0,b.Z)(n,[{key:"iterator",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K_(this.input)&&rt().get("IS_NODE")&&(t=K(),this.input=t.readFileSync(this.input.slice(7))),e.abrupt("return",new G_(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(z_),Y_=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,y.Z)(this,n),(r=t.call(this)).url=e,r.fileOptions=a,r}return(0,b.Z)(n,[{key:"iterator",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K_(this.url)?new X_(this.url,this.fileOptions).iterator():j_(this.url,this.fileOptions));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(z_);function Q_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Z_(new Y_(e),t)}function J_(e){var t=e_(e);return w_((0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}function $_(e){return w_((0,g.Z)((0,v.Z)().mark((function t(){var n;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",e_((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))}function eA(e,t){return tA.apply(this,arguments)}function tA(){return tA=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",M_.create(t,n));case 1:case"end":return e.stop()}}),e)}))),tA.apply(this,arguments)}function nA(e){return rA.apply(this,arguments)}function rA(){return rA=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",O_.create(t));case 1:case"end":return e.stop()}}),e)}))),rA.apply(this,arguments)}var aA="3.19.0";function iA(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Fa.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var oA=sv.whereImpl,sA=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,y.Z)(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new ne((0,u.Z)(e),Gs()),e}return(0,b.Z)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,rt().get("IS_NODE")&&sm.warn("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Fa.isString(n[0])){var a=n.map((function(e){return Fa.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;if("complex64"===n){var a=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return sm.mergeRealAndImagArrays(a,i)}return this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Fa.decodeString(e)}));return us(e.shape,e.dtype,n)}catch(HJ){throw new Error("Failed to decode encoded string bytes into utf-8")}return us(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return Gs().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e),r=n.complexTensorInfos;null!=r&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Fa.now(),e.abrupt("return",(t(),{kernelMs:Fa.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){iA([e],"where");var t=this.readSync(e.dataId);return oA(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return(0,o.Z)((0,s.Z)(n.prototype),"epsilon",this).call(this)}}]),n}(re);sA.nextDataId=0;var uA={};function cA(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}D(uA,{addImpl:function(){return SA},bincountImpl:function(){return CA},bincountReduceImpl:function(){return EA},ceilImpl:function(){return FA},concatImpl:function(){return OA},equalImpl:function(){return MA},expImpl:function(){return PA},expm1Impl:function(){return VA},floorImpl:function(){return jA},gatherNdImpl:function(){return KA},gatherV2Impl:function(){return XA},greaterEqualImpl:function(){return $A},greaterImpl:function(){return YA},lessEqualImpl:function(){return iR},lessImpl:function(){return nR},linSpaceImpl:function(){return uR},logImpl:function(){return cR},maxImpl:function(){return dR},maximumImpl:function(){return fR},minimumImpl:function(){return vR},multiplyImpl:function(){return bR},negImpl:function(){return SR},notEqualImpl:function(){return NR},prodImpl:function(){return RR},rangeImpl:function(){return DR},rsqrtImpl:function(){return ZR},scatterImpl:function(){return zR},sigmoidImpl:function(){return LR},simpleAbsImpl:function(){return cA},sliceImpl:function(){return WR},sparseFillEmptyRowsImpl:function(){return GR},sparseReshapeImpl:function(){return jR},sparseSegmentReductionImpl:function(){return HR},sqrtImpl:function(){return qR},squaredDifferenceImpl:function(){return YR},stridedSliceImpl:function(){return $R},stringNGramsImpl:function(){return tF},stringSplitImpl:function(){return rF},stringToHashBucketFastImpl:function(){return aF},subImpl:function(){return iF},tileImpl:function(){return cF},topKImpl:function(){return dF},transposeImpl:function(){return ER},uniqueImpl:function(){return fF}});var lA={kernelName:ut,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;iA(t,"abs");var r=new Float32Array(Fa.sizeFromShape(t.shape));return r=cA(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}};function pA(e){return function(t,n,r,a,i){var o=sm.assertAndGetBroadcastShape(t,n),s=o.length,u=Fa.computeStrides(o),c=Fa.sizeFromShape(o),l=Fa.getTypedArrayFromDType(i,c),p=t.length,d=n.length,f=Fa.computeStrides(t),h=Fa.computeStrides(n),m=sm.getBroadcastDims(t,o),v=sm.getBroadcastDims(n,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=e(r[g%r.length],a[g%a.length]);else for(var y=function(t){var n=Fa.indexToLoc(t,s,u),i=n.slice(-p);m.forEach((function(e){return i[e]=0}));var o=Fa.locToIndex(i,p,f),c=n.slice(-d);v.forEach((function(e){return c[e]=0}));var g=Fa.locToIndex(c,d,h);l[t]=e(r[o],a[g])},b=0;b<l.length;++b)y(b);return[l,o]}}function dA(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var fA={kernelName:Zt,backendName:"cpu",kernelFunc:dA};function hA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){var r=hA(e,t,"float32"),a=hA(e,t,"float32");return dA({inputs:{real:r,imag:a},backend:e})}var i=Fa.makeZerosTypedArray(Fa.sizeFromShape(t),n);return e.makeTensorInfo(t,n,i)}function mA(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var vA={kernelName:Sn,backendName:"cpu",kernelFunc:mA};function gA(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var yA={kernelName:gr,backendName:"cpu",kernelFunc:gA};function bA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return mA({inputs:{x:a},backend:n});var o=hA(n,a.shape,a.dtype),s=bA({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=dA({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=gA({inputs:{input:a},backend:n}),l=bA({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),l}if(!Fa.hasEncodingLoss(a.dtype,i)){var p=mA({inputs:{x:a},backend:n});return{dataId:p.dataId,shape:p.shape,dtype:i}}if("int32"===i){var d=n.data.get(a.dataId).values,f=Int32Array.from(d);return n.makeTensorInfo(a.shape,"int32",f)}if("bool"===i){var h=n.data.get(a.dataId).values,v=Fa.toTypedArray([0],a.dtype),g=pA((function(e,t){return e!==t?1:0}))(a.shape,[],h,v,"bool"),y=(0,m.Z)(g,2),b=y[0],x=y[1];return n.makeTensorInfo(x,"bool",b)}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var xA={kernelName:Rt,backendName:"cpu",kernelFunc:bA};function kA(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;iA([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,p="string"===o.dtype?sm.fromUint8ToStringArray(c):c,d="string"===o.dtype?sm.fromUint8ToStringArray(l):l,f=r||o.dtype,h=t(o.shape,s.shape,p,d,f),v=(0,m.Z)(h,2),g=v[0],y=v[1];return u.makeTensorInfo(y,f,g)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=bA({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),p=l.complexTensorInfos.real,d=l.complexTensorInfos.imag,f=u.data.get(p.dataId).values,h=u.data.get(d.dataId).values,v=bA({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),g=u.data.get(v.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,x=u.data.get(y.dataId).values,k=u.data.get(b.dataId).values,w=n(o.shape,s.shape,f,h,x,k),S=(0,m.Z)(w,3),I=S[0],N=S[1],T=S[2],C=u.makeTensorInfo(T,"float32",I),E=u.makeTensorInfo(T,"float32",N),_=dA({inputs:{real:C,imag:E},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(v),u.disposeIntermediateTensorInfo(C),u.disposeIntermediateTensorInfo(E),_}var A=u.data.get(o.dataId).values,R=u.data.get(s.dataId).values,F=r||o.dtype,D=t(o.shape,s.shape,A,R,F),Z=(0,m.Z)(D,2),O=Z[0],M=Z[1];return u.makeTensorInfo(M,F,O)}}function wA(e){return function(t,n,r,a,i,o){var s=sm.assertAndGetBroadcastShape(t,n),u=Fa.sizeFromShape(s),c=s.length,l=Fa.computeStrides(s),p=Fa.getTypedArrayFromDType("float32",u),d=Fa.getTypedArrayFromDType("float32",u),f=sm.getBroadcastDims(t,s),h=sm.getBroadcastDims(n,s),m=sm.mergeRealAndImagArrays(r,a),v=sm.mergeRealAndImagArrays(i,o),g=t.length,y=Fa.computeStrides(t),b=n.length,x=Fa.computeStrides(n);if(f.length+h.length===0)for(var k=0;k<p.length;k++){var w=k%m.length,S=k%v.length,I=e(m[2*w],m[2*w+1],v[2*S],v[2*S+1]);p[k]=I.real,d[k]=I.imag}else for(var N=function(t){var n=Fa.indexToLoc(t,c,l),r=n.slice(-g);f.forEach((function(e){return r[e]=0}));var a=Fa.locToIndex(r,g,y),i=n.slice(-b);h.forEach((function(e){return i[e]=0}));var o=Fa.locToIndex(i,b,x),s=e(m[2*a],m[2*a+1],v[2*o],v[2*o+1]);p[t]=s.real,d[t]=s.imag},T=0;T<p.length;T++)N(T);return[p,d,s]}}var SA=pA((function(e,t){return e+t})),IA=wA((function(e,t,n,r){return{real:e+n,imag:t+r}})),NA=kA(pt,SA,IA),TA={kernelName:pt,backendName:"cpu",kernelFunc:NA};function CA(e,t,n,r,a){for(var i=Fa.sizeFromShape(r),o=Fa.makeZerosTypedArray(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function EA(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=us([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}function _A(e){return function(t,n,r){for(var a=Fa.getTypedArrayFromDType(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function AA(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(iA(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=Fa.sizeFromShape(s.shape),p=n||s.dtype,d=Fa.getArrayFromDType(p,l),f=0;f<l;++f)d[f]=t(c[f],i);return u.makeTensorInfo(s.shape,p,d)}}function RA(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(iA(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,p=t(c,l,i);return u.makeTensorInfo(s.shape,l,p)}}var FA=_A((function(e){return Math.ceil(e)})),DA=RA(Ft,FA),ZA={kernelName:Ft,backendName:"cpu",kernelFunc:DA};function OA(e,t,n,r){var a=Fa.getArrayFromDType(n,Fa.sizeFromShape(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=Fa.sizeFromShape(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?sm.fromUint8ToStringArray(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}var MA=pA((function(e,t){return e===t?1:0})),zA=kA(cn,MA,null,"bool"),LA={kernelName:cn,backendName:"cpu",kernelFunc:zA},PA=_A((function(e){return Math.exp(e)})),BA=RA(ln,PA,"float32"),WA={kernelName:ln,backendName:"cpu",kernelFunc:BA},VA=_A((function(e){return Math.expm1(e)})),UA=RA(dn,VA),GA={kernelName:dn,backendName:"cpu",kernelFunc:UA},jA=_A((function(e){return Math.floor(e)})),HA=RA(vn,jA),qA={kernelName:vn,backendName:"cpu",kernelFunc:HA};function KA(e,t,n,r,a,i,o,s,u){for(var c=us([r,i],n),l=0;l<r;l++){for(var p=[],d=0,f=0;f<a;f++){var m=e[l*a+f];d+=m*o[f],p.push(m)}if(d<0||d>=u/i)throw new Error("Invalid indices: ".concat(p," does not index into ").concat(s));for(var v=0;v<i;v++)c.values[l*i+v]=t.get.apply(t,(0,h.Z)(t.indexToLoc(d*i+v)))}return c}function XA(e,t,n){for(var r=us(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var YA=pA((function(e,t){return e>t?1:0})),QA=kA(kn,YA,null,"bool"),JA={kernelName:kn,backendName:"cpu",kernelFunc:QA},$A=pA((function(e,t){return e>=t?1:0})),eR=kA(wn,$A,null,"bool"),tR={kernelName:wn,backendName:"cpu",kernelFunc:eR},nR=pA((function(e,t){return e<t?1:0})),rR=kA(An,nR,null,"bool"),aR={kernelName:An,backendName:"cpu",kernelFunc:rR},iR=pA((function(e,t){return e<=t?1:0})),oR=kA(Rn,iR,null,"bool"),sR={kernelName:Rn,backendName:"cpu",kernelFunc:oR};function uR(e,t,n){var r=(t-e)/(n-1),a=Fa.makeZerosTypedArray(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var cR=_A((function(e){return Math.log(e)})),lR=RA(Dn,cR),pR={kernelName:Dn,backendName:"cpu",kernelFunc:lR};function dR(e,t,n,r){for(var a=Fa.getTypedArrayFromDType(r,Fa.sizeFromShape(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var fR=pA((function(e,t){return Math.max(e,t)})),hR=kA(Gn,fR),mR={kernelName:Gn,backendName:"cpu",kernelFunc:hR},vR=pA((function(e,t){return Math.min(e,t)})),gR=kA(Jn,vR),yR={kernelName:Jn,backendName:"cpu",kernelFunc:gR},bR=pA((function(e,t){return e*t})),xR=wA((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),kR=kA(nr,bR,xR),wR={kernelName:nr,backendName:"cpu",kernelFunc:kR};function SR(e,t,n){var r=Fa.createScalarValue(-1,n);return bR([],t,r,e,n)}var IR={kernelName:rr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;iA(r,"neg");var a=SR(n.data.get(r.dataId).values,r.shape,r.dtype),i=(0,m.Z)(a,2),o=i[0],s=i[1];return n.makeTensorInfo(s,r.dtype,o)}},NR=pA((function(e,t){return e!==t?1:0})),TR=kA(ar,NR,null,"bool"),CR={kernelName:ar,backendName:"cpu",kernelFunc:TR};function ER(e,t,n,r,a){for(var i=t.length,o=Fa.sizeFromShape(t),s=Fa.computeStrides(t),u=Fa.computeStrides(a),c=Fa.getTypedArrayFromDType(n,Fa.sizeFromShape(a)),l=0;l<o;++l){for(var p=Fa.indexToLoc(l,i,s),d=new Array(p.length),f=0;f<d.length;f++)d[f]=p[r[f]];c[Fa.locToIndex(d,i,u)]=e[l]}return c}function _R(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;iA(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=ER(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var AR={kernelName:sa,backendName:"cpu",kernelFunc:_R};function RR(e,t,n,r){for(var a=sm.computeOutAndReduceShapes(e,r),i=(0,m.Z)(a,2),o=i[0],s=i[1],u=Ii(t,"int32"),c=Fa.makeZerosTypedArray(Fa.sizeFromShape(o),u),l=Fa.sizeFromShape(s),p=0;p<c.length;++p){for(var d=p*l,f=1,h=0;h<l;++h)f*=n[d+h];c[p]=f}return{outVals:c,outShape:o,outDtype:u}}var FR={kernelName:mr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;iA(a,"prod");var s=a.shape.length,u=Fa.parseAxisParam(i,a.shape),c=sm.getAxesPermutation(u,s),l=u,p=a,d=[];null!=c&&(p=_R({inputs:{x:a},backend:n,attrs:{perm:c}}),d.push(p),l=sm.getInnerMostAxes(l.length,s));var f=n.data.get(p.dataId).values,h=RR(p.shape,p.dtype,f,l),m=h.outVals,v=h.outShape,g=h.outDtype,y=v;return o&&(y=sm.expandShapeToKeepDim(v,u)),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,m)}};function DR(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Fa.makeZerosTypedArray(0,r);var a=Math.abs(Math.ceil((t-e)/n)),i=Fa.makeZerosTypedArray(a,r);t<e&&1===n&&(n=-1),i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return i}var ZR=_A((function(e){return 1/Math.sqrt(e)})),OR=RA(Er,ZR),MR={kernelName:Er,backendName:"cpu",kernelFunc:OR};function zR(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],p=e.values,d=t.values;if(0===r)return us(n,t.dtype);var f=us(l,t.dtype);"string"==typeof u||"number"==typeof u?f.values.fill(u):"boolean"==typeof u&&f.values.fill(+u);for(var h=0;h<i;h++){for(var m=[],v=0,g=0;g<o;g++){var y=p[h*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?f.values[v*a+b]+=d[h*a+b]:f.values[v*a+b]=0===t.rank?d[0]:d[h*a+b]}return f}var LR=_A((function(e){return 1/(1+Math.exp(-e))})),PR=AA(zr,(function(e){return 1/(1+Math.exp(-e))})),BR={kernelName:zr,backendName:"cpu",kernelFunc:PR};function WR(e,t,n,r,a){var i=Ru.isSliceContinous(r,t,n),o=Fa.sizeFromShape(n),s=Fa.computeStrides(r);if(i){var u=Ru.computeFlatOffset(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=us(r,a,"string"===a?sm.fromUint8ToStringArray(e):e),l=us(n,a),p=0;p<l.size;++p){var d=l.indexToLoc(p),f=d.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,(0,h.Z)(f))].concat((0,h.Z)(d)))}return"string"===a?sm.fromStringArrayToUint8(l.values):l.values}function VR(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;iA(a,"slice");var s=Ru.parseSliceParams(a,i,o),u=(0,m.Z)(s,2),c=u[0],l=u[1];Ru.assertParamsValid(a,c,l);var p=WR(n.data.get(a.dataId).values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,p)}var UR={kernelName:Dr,backendName:"cpu",kernelFunc:VR};function GR(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),p=t[1];if(0===u){if(0!==s)throw new Error(sm.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));return[Fa.getArrayFromDType(n,0),[0,p],Fa.getArrayFromDType(a,0),c,l]}for(var d=!0,f=0,h=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*p];if(v<0)throw new Error(sm.getSparseFillEmptyRowsNegativeIndexErrorMessage(m,v));if(v>=u)throw new Error(sm.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(m,v,u));++h[v],d=d&&v>=f,f=v}for(var g=!0,y=0;y<u;++y){var b=0===h[y];c[y]=b,g=g&&!b,h[y]=Math.max(h[y],1),y>0&&(h[y]+=h[y-1])}if(g&&d){for(var x=e,k=r,w=0;w<s;++w)l[w]=w;return[x,[s,p],k,c,l]}for(var S=h[u-1],I=Fa.getArrayFromDType(n,S*p),N=Fa.getArrayFromDType(a,S),T=new Array(u).fill(0),C=0;C<s;++C){var E=e[C*p],_=T[E],A=(0===E?0:h[E-1])+_;T[E]++;for(var R=0;R<p;++R)I[A*p+R]=e[C*p+R];N[A]=r[C],l[C]=A}for(var F=0;F<u;++F)if(0===T[F]){var D=0===F?0:h[F-1];I[D*p+0]=F;for(var Z=1;Z<p;++Z)I[D*p+Z]=0;N[D]=o}return[I,[S,p],N,c,l]}function jR(e,t,n,r,a){for(var i=Fa.sizeFromShape(r),o=t[0],s=a.length,u=[],c=1,l=-1,p=0;p<s;++p){var d=a[p];if(-1===d){if(-1!==l)throw new Error(sm.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,p));l=p,u.push(1)}else{if(d<0)throw new Error(sm.getSparseReshapeNegativeOutputDimErrorMessage(p,d));c*=d,u.push(d)}}if(-1!==l){if(c<=0)throw new Error(sm.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var f=Math.trunc(i/c);if(c*f!==i)throw new Error(sm.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=f}if(Fa.sizeFromShape(u)!==i)throw new Error(sm.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var h=r.length,m=[];if(h>0){m[h-1]=1;for(var v=h-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var g=[];if(s>0){g[s-1]=1;for(var y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}for(var b=Fa.getArrayFromDType(n,o*s),x=0;x<o;++x){for(var k=0,w=0;w<h;++w)k+=e[x*h+w]*m[w];for(var S=0;S<s;++S)b[x*s+S]=Math.trunc(k/g[S]),k%=g[S]}return[b,[o,s],u]}function HR(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error(sm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var p=t.slice();p[0]=l;var d=p.reduce((function(e,t){return e*t}),1),f=Fa.getArrayFromDType(n,d);if(0===s)return l>0&&f.fill(o),[f,p];if(l<=0)throw new Error(sm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var h=0,m=1,v=0,g=a[h];;){var y=0;if(m<s){if(g===(y=a[m])){++m;continue}if(g>=y)throw new Error(sm.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(g<0||g>=l)throw new Error(sm.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(g,l));g>v&&f.fill(o,v*c,g*c);for(var b=h;b<m;++b){var x=r[b];if(x<0||x>=u[0])throw new Error(sm.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,r[b],u[0]));for(var k=0;k<c;k++)f[g*c+k]+=e[x*c+k]}if(i)for(var w=0;w<c;w++)f[g*c+w]/=m-h;if(h=m,v=g+1,g=y,++m>s)break}return v<l&&f.fill(o,v*c,l*c),[f,p]}var qR=_A((function(e){return Math.sqrt(e)})),KR=AA(Pr,(function(e){return Math.sqrt(e)})),XR={kernelName:Pr,backendName:"cpu",kernelFunc:KR},YR=pA((function(e,t){var n=e-t;return n*n})),QR=kA(Xr,YR),JR={kernelName:Xr,backendName:"cpu",kernelFunc:QR};function $R(e,t,n,r){for(var a=us(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat((0,h.Z)(o)))}return a}var eF=function(){function e(t,n,r,a,i,o){(0,y.Z)(this,e),this.separator=Fa.encodeString(t),this.nGramWidths=n,this.leftPad=Fa.encodeString(r),this.rightPad=Fa.encodeString(a),this.padWidth=i,this.preserveShort=o}return(0,b.Z)(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(s){var u=o.getPadWidth(i),c=Math.max(0,u-s),l=Math.max(0,u-(a-(s+1))),p=i-(c+l),d=t+(c>0?0:s-u),f=0;f+=c*o.leftPad.length;for(var h=0;h<p;++h)f+=e[d+h].length;f+=l*o.rightPad.length,f+=(c+l+p-1)*o.separator.length,n[r+s]=new Uint8Array(f);for(var m=n[r+s],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<p-1;++b)g(e[d+b]),g(o.separator);if(p>0){g(e[d+p-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var k=0;k<l-1;++k)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s(u)}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=Fa.getArrayFromDType("int32",a);if(0===r||0===a){for(var l=new Array(r),p=0;p<=u;++p)c[p]=0;return[l,c]}c[0]=0;for(var d=function(e){var r=t[e]-t[e-1],a=0;n.nGramWidths.forEach((function(e){a+=n.getNumNGrams(r,e)})),n.preserveShort&&r>0&&0===a&&(a=1),c[e]=c[e-1]+a},f=1;f<=u;++f)d(f);for(var h=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,h,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,h,i,1,s)}},v=0;v<u;++v)m(v);return[h,c]}}]),e}();function tF(e,t,n,r,a,i,o,s){return new eF(n,r,a,i,o,s).compute(e,t)}function nF(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);(!n||0!==o.length)&&r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);(!n||0!==c.length)&&r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}(!n||0!==e.length)&&r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function rF(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;nF(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var p=Fa.getArrayFromDType("int32",2*i),d=new Array(i),f=[r,o],h=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)p[2*h]=m,p[2*h+1]=v,d[h]=a[h],++h;return[p,d,f]}function aF(e,t){for(var n=Fa.getArrayFromDType("int32",e.length),r=0;r<e.length;++r)n[r]=Fa.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var iF=pA((function(e,t){return e-t})),oF=wA((function(e,t,n,r){return{real:e-n,imag:t-r}})),sF=kA(ta,iF,oF),uF={kernelName:ta,backendName:"cpu",kernelFunc:sF};function cF(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=us(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var lF=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function pF(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(n,Math.floor(t-i*s/a+u)),l=Math.min(r,Math.floor(t+(a-i)*s/a+u));pF(e,t,c,l)}var p=e[t],d=n,f=r;for(Fa.swap(e,n,t),lF(e[r],p)>0&&Fa.swap(e,n,r);d<f;){for(Fa.swap(e,d,f),d++,f--;lF(e[d],p)<0;)d+=1;for(;lF(e[f],p)>0;)f-=1}0===lF(e[n],p)?Fa.swap(e,n,f):(f+=1,Fa.swap(e,f,r)),f<=t&&(n=f+1),t<=f&&(r=f-1)}}function dF(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=Fa.getTypedArrayFromDType(n,o*r),c=Fa.getTypedArrayFromDType("int32",o*r),l=function(t){var n=t*s,i=e.subarray(n,n+s),o=new Array(i.length);i.forEach((function(e,t){return o[t]={value:e,index:t}})),r<o.length&&(pF(o,r),o=o.slice(0,r)),a&&o.sort(lF);for(var l=t*r,p=u.subarray(l,l+r),d=c.subarray(l,l+r),f=0;f<r;f++)p[f]=o[f].value,d[f]=o[f].index},p=0;p<o;p++)l(p);var d=t.slice();return d[d.length-1]=r,[us(d,n,u),us(d,"int32",c)]}function fF(e,t,n,r){for(var a=Fa.parseAxisParam(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new pi(i,r,e),p=[],d=1===i[0]&&1===i[2],f=0;f<n[a];f++){var h=void 0;if(d)h=e[f].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,f,g));h=m.join(",")}if(void 0!==u[h])c[f]=u[h];else{var y=Object.keys(u).length;u[h]=y,c[f]=y,p.push(f)}}var b=i.slice();b[1]=Object.keys(u).length;var x=new pi(b,r);p.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)x.set(l.get(n,e,r),n,t,r)}));var k=n.slice();return k[a]=b[1],{outputValues:x.values,outputShape:k,indices:c}}ru("cpu",(function(){return new sA}),1);var hF=AA(on,(function(e){return e>=0?e:Math.exp(e)-1})),mF={kernelName:on,backendName:"cpu",kernelFunc:hF};function vF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;iA([a],"leakyRelu");for(var o=Fa.sizeFromShape(a.shape),s=n.data.get(a.dataId).values,u=Fa.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var gF={kernelName:_n,backendName:"cpu",kernelFunc:vF},yF=pA((function(e,t){return e<0?t*e:e}));function bF(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;iA([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=yF(r.shape,a.shape,i,o,"float32"),u=(0,m.Z)(s,2),c=u[0],l=u[1];return n.makeTensorInfo(l,"float32",c)}var xF={kernelName:hr,backendName:"cpu",kernelFunc:bF},kF=AA(br,(function(e){return Math.max(0,e)})),wF={kernelName:br,backendName:"cpu",kernelFunc:kF},SF=AA(Nr,(function(e){return Math.min(Math.max(0,e),6)})),IF={kernelName:Nr,backendName:"cpu",kernelFunc:SF};function NF(e,t,n,r,a){if("linear"===n)return mA({inputs:{x:t},backend:e});if("relu"===n)return kF({inputs:{x:t},backend:e});if("elu"===n)return hF({inputs:{x:t},backend:e});if("relu6"===n)return SF({inputs:{x:t},backend:e});if("prelu"===n)return bF({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return vF({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return PR({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function TF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=Fa.sizeFromShape(a.shape),s=Fa.inferFromImplicitShape(i,o),u=Fa.sizeFromShape(s);Fa.assert(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old shape (").concat(a.shape,") has ").concat(o," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,p=c.complexTensorInfos.imag;l.shape=s,p.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var CF={kernelName:xr,backendName:"cpu",kernelFunc:TF};function EF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;iA([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],p=s?i.shape[c-1]:i.shape[c-2],d=o?a.shape[u-1]:a.shape[u-2],f=s?i.shape[c-2]:i.shape[c-1],h=a.shape.slice(0,-2),v=i.shape.slice(0,-2),g=Fa.sizeFromShape(h),y=Fa.sizeFromShape(v),b=pu.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);Fa.assert(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(p,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(o," and transposeB=").concat(s," must match.")}));for(var x=s?[y,f,p]:[y,p,f],k=TF({inputs:{x:a},backend:n,attrs:{shape:o?[g,l,d]:[g,d,l]}}),w=TF({inputs:{x:i},backend:n,attrs:{shape:x}}),S=o?k.shape[1]:k.shape[2],I=o?k.shape[2]:k.shape[1],N=s?w.shape[1]:w.shape[2],T=Math.max(g,y),C=n.data.get(k.dataId).values,E=n.data.get(w.dataId).values,_=Fa.computeStrides(k.shape),A=Fa.computeStrides(w.shape),R=o?[_[0],1,_[1]]:[_[0],_[1],1],F=(0,m.Z)(R,3),D=F[0],Z=F[1],O=F[2],M=s?[1,A[1],A[0]]:[A[1],1,A[0]],z=(0,m.Z)(M,3),L=z[0],P=z[1],B=z[2],W=I*N,V=us([T,I,N],k.dtype),U=V.values,G=n.blockSize,j=0;j<T;j++)for(var H=0;H<I;H+=G)for(var q=0;q<N;q+=G)for(var K=0;K<S;K+=G)for(var X=Math.min(H+G,I),Y=Math.min(q+G,N),Q=Math.min(K+G,S),J=H;J<X;J++)for(var $=q;$<Y;$++){for(var ee=0,te=K;te<Q;te++){var ne=Math.min(j,g-1)*D,re=Math.min(j,y-1)*B;ee+=C[ne+J*Z+te*O]*E[te*L+$*P+re]}U[j*W+(J*N+$)]+=ee}return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(b,V.dtype,V.values)}var _F={kernelName:Tt,backendName:"cpu",kernelFunc:EF};var AF={kernelName:va,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,p=o.transposeA,d=o.transposeB,f=o.activation,h=o.leakyreluAlpha,m=[];t=EF({inputs:{a:s,b:u},attrs:{transposeA:p,transposeB:d},backend:i}),c&&(n=NA({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),f&&(r=NF(i,t,f,l,h),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}},RF=AA(ct,(function(e){return Math.acos(e)})),FF={kernelName:ct,backendName:"cpu",kernelFunc:RF},DF=AA(lt,(function(e){return Math.acosh(e)})),ZF={kernelName:lt,backendName:"cpu",kernelFunc:DF};var OF={kernelName:dt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;iA(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=us(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};var MF={kernelName:ft,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;iA(a,"all");var s=Fa.parseAxisParam(i,a.shape),u=s,c=sm.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=_R({inputs:{x:a},backend:n,attrs:{perm:c}}),u=sm.getInnerMostAxes(u.length,a.shape.length)),sm.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var p=sm.computeOutAndReduceShapes(l.shape,u),d=(0,m.Z)(p,2),f=d[0],h=d[1],v=Fa.sizeFromShape(h),g=Fa.makeZerosTypedArray(Fa.sizeFromShape(f),l.dtype),y=n.data.get(l.dataId).values,b=0;b<g.length;++b){for(var x=b*v,k=y[x],w=0;w<v;++w){var S=y[x+w];k=k&&S}g[b]=k}null!=c&&n.disposeIntermediateTensorInfo(l);var I=n.makeTensorInfo(f,l.dtype,g);if(o){var N=TF({inputs:{x:I},backend:n,attrs:{shape:sm.expandShapeToKeepDim(f,s)}});return n.disposeIntermediateTensorInfo(I),N}return I}};var zF={kernelName:ht,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;iA(a,"any");var s=Fa.parseAxisParam(i,a.shape),u=s,c=sm.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=_R({inputs:{x:a},backend:n,attrs:{perm:c}}),u=sm.getInnerMostAxes(u.length,a.shape.length)),sm.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var p=sm.computeOutAndReduceShapes(l.shape,u),d=(0,m.Z)(p,2),f=d[0],h=d[1],v=Fa.sizeFromShape(h),g=Fa.makeZerosTypedArray(Fa.sizeFromShape(f),l.dtype),y=n.data.get(l.dataId).values,b=0;b<g.length;++b){for(var x=b*v,k=y[x],w=0;w<v;++w){var S=y[x+w];k=k||S}g[b]=k}null!=c&&n.disposeIntermediateTensorInfo(l);var I=n.makeTensorInfo(f,l.dtype,g);if(o){var N=TF({inputs:{x:I},backend:n,attrs:{shape:sm.expandShapeToKeepDim(f,s)}});return n.disposeIntermediateTensorInfo(I),N}return I}};var LF={kernelName:mt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;iA(a,"argMax");var o=Fa.parseAxisParam(i,a.shape),s=sm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=_R({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=sm.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],sm.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=sm.computeOutAndReduceShapes(u.shape,o),p=(0,m.Z)(l,2),d=p[0],f=p[1],h=Fa.sizeFromShape(d),v=Fa.makeZerosTypedArray(h,"int32"),g=Fa.sizeFromShape(f),y=n.data.get(u.dataId).values,b=0;b<v.length;++b){for(var x=b*g,k=y[x],w=0,S=0;S<g;++S){var I=y[x+S];I>k&&(k=I,w=S)}v[b]=w}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d,"int32",v)}};var PF={kernelName:vt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;iA(a,"argMin");var o=Fa.parseAxisParam(i,a.shape),s=sm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=_R({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=sm.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],sm.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=sm.computeOutAndReduceShapes(u.shape,o),p=(0,m.Z)(l,2),d=p[0],f=p[1],h=Fa.sizeFromShape(d),v=Fa.makeZerosTypedArray(h,"int32"),g=Fa.sizeFromShape(f),y=n.data.get(u.dataId).values,b=0;b<v.length;++b){for(var x=b*g,k=y[x],w=0,S=0;S<g;++S){var I=y[x+S];I<k&&(k=I,w=S)}v[b]=w}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d,"int32",v)}},BF=AA(gt,(function(e){return Math.asin(e)})),WF={kernelName:gt,backendName:"cpu",kernelFunc:BF},VF=AA(yt,(function(e){return Math.asinh(e)})),UF={kernelName:yt,backendName:"cpu",kernelFunc:VF},GF=AA(bt,(function(e){return Math.atan(e)})),jF={kernelName:bt,backendName:"cpu",kernelFunc:GF},HF=pA((function(e,t){return Math.atan2(e,t)})),qF=kA(kt,HF),KF={kernelName:kt,backendName:"cpu",kernelFunc:qF},XF=AA(xt,(function(e){return Math.atanh(e)})),YF={kernelName:xt,backendName:"cpu",kernelFunc:XF};function QF(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,p=a.effectiveFilterWidth,d=a.padInfo.top,f=a.padInfo.left,h="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=us(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var k=x*g,w=x*r[0],S=0;S<a.inChannels;++S)for(var I=0;I<a.outHeight;++I)for(var N=I*o-d,T=Math.max(0,N),C=Math.min(a.inHeight,l+N),E=k+I*y,_=0;_<a.outWidth;++_){for(var A=_*s-f,R=Math.max(0,A),F=Math.min(a.inWidth,p+A),D=h,Z=0,O=0,M=T;M<C;M+=u){for(var z=w+M*r[1],L=R;L<F;L+=c){var P=e[z+L*r[2]+S];"max"===i&&P>D?D=P:"avg"===i&&(Z+=P,O++)}if(isNaN(D))break}v[E+_*b+S]="avg"===i?Z/O:D}return m}function JF(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=us(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,p=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,h=r.padInfo.left,m=us(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-f,x=b;x<0;)x+=c;for(var k=Math.min(r.inHeight,p+b),w=0;w<r.outWidth;++w){for(var S=w*u-h,I=S;I<0;)I+=l;for(var N=Math.min(r.inWidth,d+S),T=Number.NEGATIVE_INFINITY,C=-1,E=x;E<k;E+=c)for(var _=E-b,A=I;A<N;A+=l){var R=A-S,F=m.get(v,E,A,g);F>T&&(T=F,C=a?i?((v*r.inHeight+E)*r.inWidth+A)*r.inChannels+g:(E*r.inWidth+A)*r.inChannels+g:_*d+R)}o.set(C,v,y,w,g)}}return o}function $F(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,p=a.dilationWidth,d=a.effectiveFilterDepth,f=a.effectiveFilterHeight,h=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=us(a.outShape,n),x=b.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[3]*a.outShape[4],I=a.outShape[4],N=0;N<a.batchSize;++N)for(var T=N*k,C=N*r[0],E=0;E<a.inChannels;++E)for(var _=0;_<a.outDepth;++_){for(var A=_*o-m,R=A;R<0;)R+=c;for(var F=Math.min(a.inDepth,d+A),D=T+_*w,Z=0;Z<a.outHeight;++Z){for(var O=Z*s-v,M=O;M<0;)M+=l;for(var z=Math.min(a.inHeight,f+O),L=D+Z*S,P=0;P<a.outWidth;++P){for(var B=P*u-g,W=B;W<0;)W+=p;for(var V=Math.min(a.inWidth,h+B),U=L+P*I,G=y,j=0,H=0,q=R;q<F;q+=c){for(var K=C+q*r[1],X=M;X<z;X+=l){for(var Y=K+X*r[2],Q=W;Q<V;Q+=p){var J=e[Y+Q*r[3]+E];if("max"===i&&J>G?G=J:"avg"===i&&(j+=J,H++),isNaN(G))break}if(isNaN(G))break}if(isNaN(G))break}x[U+E]="avg"===i?j/H:G}}}return b}var eD={kernelName:wt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;iA(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Fa.assert(sm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=sm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Fa.arraysEqual(l.inShape,l.outShape))c=mA({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,d=Fa.computeStrides(a.shape),f=QF(p,a.shape,a.dtype,d,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,f.values)}return c}};var tD={kernelName:It,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;iA(a,"avgPool3d");var l=sm.computePool3DInfo(a.shape,i,o,1,s,u,c),p=$F(n.data.get(a.dataId).values,a.shape,a.dtype,Fa.computeStrides(a.shape),l,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}};var nD={kernelName:Nt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;iA([a,i],"avgPool3DGrad");for(var l=sm.computePool3DInfo(i.shape,o,s,1,u,c),p=l.strideDepth,d=l.strideHeight,f=l.strideWidth,h=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,x=l.effectiveFilterDepth,k=l.effectiveFilterHeight,w=l.effectiveFilterWidth,S=x-1-l.padInfo.front,I=w-1-l.padInfo.left,N=k-1-l.padInfo.top,T=us(i.shape,"float32"),C=1/(h*m*v),E=n.bufferSync(a),_=0;_<l.batchSize;++_)for(var A=0;A<l.inChannels;++A)for(var R=0;R<l.inDepth;++R)for(var F=0;F<l.inHeight;++F)for(var D=0;D<l.inWidth;++D){for(var Z=R-S,O=F-N,M=D-I,z=0,L=0;L<x;L+=g){var P=(Z+L)/p;if(!(P<0||P>=l.outDepth||Math.floor(P)!==P))for(var B=0;B<k;B+=y){var W=(O+B)/d;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var V=0;V<w;V+=b){var U=(M+V)/f;U<0||U>=l.outWidth||Math.floor(U)!==U||(z+=E.get(_,P,W,U,A))}}}T.set(z*C,_,R,F,D,A)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};var rD={kernelName:St,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;iA([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=sm.computePool2DInfo(o.shape,s,u,1,c),p=l.strideHeight,d=l.strideWidth,f=l.filterHeight,h=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,x=g-1-l.padInfo.top,k=us(o.shape,"float32"),w=1/(f*h),S=n.data.get(a.dataId).values,I=us(a.shape,"float32",S),N=0;N<l.batchSize;++N)for(var T=0;T<l.inChannels;++T)for(var C=0;C<l.inHeight;++C)for(var E=0;E<l.inWidth;++E){for(var _=C-x,A=E-b,R=0,F=0;F<g;F+=m){var D=(_+F)/p;if(!(D<0||D>=l.outHeight||Math.floor(D)!==D))for(var Z=0;Z<y;Z+=v){var O=(A+Z)/d;O<0||O>=l.outWidth||Math.floor(O)!==O||(R+=I.get(N,D,O,T))}}k.set(R*w,N,C,E,T)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var aD={kernelName:yn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;Fa.assert(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Fa.assert(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Fa.assert(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),iA([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,p=n.data.get(s.dataId).values,d=n.data.get(u.dataId).values,f=i?n.data.get(i.dataId).values:new Float32Array([1]),h=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=h.length,g=f.length,y=d.length,b=p.length,x=0,k=0,w=0,S=0,I=0;I<l.length;++I)m[I]=h[x++]+(l[I]-p[k++])*f[w++]/Math.sqrt(d[S++]+c),x>=v&&(x=0),k>=b&&(k=0),w>=g&&(w=0),S>=y&&(S=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};var iD={kernelName:Ct,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;iA([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=sm.getReshaped(a.shape,i,s),c=sm.getPermuted(u.length,i.length),l=sm.getReshapedPermuted(a.shape,i,s),p=sm.getSliceBeginCoords(o,i.length),d=sm.getSliceSize(l,o,i.length),f=TF({inputs:{x:a},backend:n,attrs:{shape:u}}),h=_R({inputs:{x:f},backend:n,attrs:{perm:c}}),m=TF({inputs:{x:h},backend:n,attrs:{shape:l}}),v=VR({inputs:{x:m},backend:n,attrs:{begin:p,size:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),v}};var oD={kernelName:Et,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=CA(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var sD={kernelName:At,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=sm.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},uD=AA(Dt,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),cD={kernelName:Dt,backendName:"cpu",kernelFunc:uD},lD={kernelName:Ot,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(Fa.sizeFromShape(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],p=u[c];r[c]=Math.hypot(l,p)}return n.makeOutput(r,t.shape,"float32")}};function pD(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var dD={kernelName:Nn,backendName:"cpu",kernelFunc:pD};function fD(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Fa.parseAxisParam(r,t[0].shape)[0],i=sm.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Fa.sizeFromShape(i))return n.makeTensorInfo(i,t[0].dtype,[]);var o=t.filter((function(e){return Fa.sizeFromShape(e.shape)>0}));if(1===o.length)return mA({inputs:{x:o[0]},backend:n});var s=o.map((function(e){return e.shape}));if(sm.assertParamsConsistent(s,a),"complex64"===o[0].dtype){var u=o.map((function(e){return gA({inputs:{input:e},backend:n})})),c=o.map((function(e){return pD({inputs:{input:e},backend:n})})),l=fD({inputs:u,backend:n,attrs:{axis:a}}),p=fD({inputs:c,backend:n,attrs:{axis:a}}),d=dA({inputs:{real:l,imag:p},backend:n});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),d}var f=o.map((function(e){var t=Fa.sizeFromShape(e.shape.slice(a));return TF({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),h=f.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));i=sm.computeOutShape(f.map((function(e){return e.shape})),1);var m=1===f[0].shape[0],v=OA(h,i,t[0].dtype,m),g=sm.computeOutShape(o.map((function(e){return e.shape})),a),y=n.makeTensorInfo(g,t[0].dtype,v);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}var hD={kernelName:Mt,backendName:"cpu",kernelFunc:fD};function mD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;iA([a,i],"conv2d");for(var p=sm.convertConv2DDataFormat(u),d=sm.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,p),f=d.filterHeight,h=d.filterWidth,m=d.dilationHeight,v=d.dilationWidth,g=d.padInfo.left,y=d.padInfo.top,b="channelsLast"===d.dataFormat,x=new pi(d.outShape,a.dtype),k=Fa.computeStrides(a.shape),w=Fa.computeStrides(i.shape),S=k[0],I=b?k[1]:k[2],N=b?k[2]:1,T=b?1:k[1],C=x.strides[0],E=b?x.strides[1]:x.strides[2],_=b?x.strides[2]:1,A=b?1:x.strides[1],R=n.data.get(a.dataId).values,F=n.data.get(i.dataId).values,D=x.values,Z=0;Z<d.batchSize;++Z)for(var O=Z*S,M=Z*C,z=0;z<d.outHeight;++z)for(var L=M+z*E,P=z*d.strideHeight-y,B=0;B<f;++B){var W=P+B*m;if(!(W<0||W>=d.inHeight))for(var V=B*w[0],U=O+W*I,G=0;G<d.outWidth;++G)for(var j=L+G*_,H=G*d.strideWidth-g,q=0;q<h;++q){var K=H+q*v;if(!(K<0||K>=d.inWidth))for(var X=U+K*N,Y=V+q*w[1],Q=0;Q<d.inChannels;++Q){for(var J=R[X+Q*T],$=0;$<d.outChannels;++$)D[j+$*A]+=J*F[Y+$];Y+=d.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,D)}var vD={kernelName:zt,backendName:"cpu",kernelFunc:mD};var gD={kernelName:Lt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;iA([a,i],"conv2dBackpropFilter");for(var p=sm.convertConv2DDataFormat(u),d=sm.computeConv2DInfo(a.shape,l,o,1,s,c,!1,p),f=d.strideHeight,h=d.strideWidth,m=d.filterHeight,v=d.filterWidth,g="channelsLast"===d.dataFormat,y=new pi(d.filterShape,"float32"),b=d.padInfo.left,x=d.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,S=new pi(a.shape,a.dtype,k),I=new pi(i.shape,i.dtype,w),N=0;N<m;++N)for(var T=Math.max(0,Math.ceil((x-N)/f)),C=Math.min(d.outHeight,(d.inHeight+x-N)/f),E=0;E<v;++E)for(var _=Math.max(0,Math.ceil((b-E)/h)),A=Math.min(d.outWidth,(d.inWidth+b-E)/h),R=0;R<d.inChannels;++R)for(var F=0;F<d.outChannels;++F){for(var D=0,Z=0;Z<d.batchSize;++Z)for(var O=T;O<C;++O)for(var M=N+O*f-x,z=_;z<A;++z){var L=E+z*h-b;D+=g?S.get(Z,M,L,R)*I.get(Z,O,z,F):S.get(Z,R,M,L)*I.get(Z,F,O,z)}y.set(D,N,E,R,F)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var yD={kernelName:Pt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;iA([a,i],"conv2dBackpropInput");var p=Fa.computeStrides(i.shape),d=Fa.computeStrides(a.shape),f=sm.convertConv2DDataFormat(c),h=sm.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f),v=new pi(h.inShape,"float32"),g=v.values,y=n.data.get(a.dataId).values,b=n.data.get(i.dataId).values,x=(0,m.Z)(p,3),k=x[0],w=x[1],S=x[2],I=h.batchSize,N=h.filterHeight,T=h.filterWidth,C=h.inChannels,E=h.inHeight,_=h.inWidth,A=h.outChannels,R=h.outHeight,F=h.outWidth,D=h.strideHeight,Z=h.strideWidth;f=h.dataFormat;for(var O=N-1-h.padInfo.top,M=T-1-h.padInfo.left,z="channelsLast"===f,L=v.strides[0],P=z?v.strides[1]:v.strides[2],B=z?v.strides[2]:1,W=z?1:v.strides[1],V=d[0],U=z?d[1]:d[2],G=z?d[2]:1,j=z?1:d[1],H=0;H<I;++H)for(var q=0;q<C;++q)for(var K=0;K<E;++K)for(var X=K-O,Y=Math.max(0,Math.ceil(X/D)),Q=Math.min(R,(N+X)/D),J=0;J<_;++J){for(var $=J-M,ee=Math.max(0,Math.ceil($/Z)),te=Math.min(F,(T+$)/Z),ne=0,re=Y;re<Q;++re)for(var ae=re*D-X,ie=ee;ie<te;++ie)for(var oe=V*H+U*re+G*ie,se=k*(N-1-ae)+w*(T-1-(ie*Z-$))+S*q,ue=0;ue<A;++ue){ne+=y[oe+j*ue]*b[se+ue]}g[L*H+P*K+B*J+W*q]=ne}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var bD={kernelName:Bt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;iA([a,i],"conv3d");for(var c=sm.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,p=c.filterHeight,d=c.filterWidth,f=c.dilationDepth,h=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,b=v.top,x=new pi(c.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,S=x.values,I=Fa.computeStrides(a.shape),N=Fa.computeStrides(i.shape),T=0;T<c.batchSize;++T)for(var C=T*I[0],E=T*x.strides[0],_=0;_<c.outDepth;++_)for(var A=E+_*x.strides[1],R=_*c.strideDepth-g,F=0;F<l;++F){var D=R+F*f;if(!(D<0||D>=c.inDepth))for(var Z=F*N[0],O=C+D*I[1],M=0;M<c.outHeight;++M)for(var z=A+M*x.strides[2],L=M*c.strideHeight-b,P=0;P<p;++P){var B=L+P*h;if(!(B<0||B>=c.inHeight))for(var W=Z+P*N[1],V=O+B*I[2],U=0;U<c.outWidth;++U)for(var G=z+U*c.outChannels,j=U*c.strideWidth-y,H=0;H<d;++H){var q=j+H*m;if(!(q<0||q>=c.inWidth))for(var K=W+H*N[2],X=V+q*c.inChannels,Y=K,Q=0;Q<c.inChannels;++Q){for(var J=k[X+Q],$=0;$<c.outChannels;++$)S[G+$]+=J*w[Y+$];Y+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var xD={kernelName:Wt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;iA([a,i],"conv3dBackpropFilterV2");for(var c=Fa.computeStrides(a.shape),l=Fa.computeStrides(i.shape),p=sm.computeConv3DInfo(a.shape,u,o,1,s),d=p.strideDepth,f=p.strideHeight,h=p.strideWidth,v=p.filterDepth,g=p.filterHeight,y=p.filterWidth,b=new pi(p.filterShape,"float32"),x=b.values,k=(0,m.Z)(b.strides,4),w=k[0],S=k[1],I=k[2],N=k[3],T=n.data.get(i.dataId).values,C=(0,m.Z)(l,4),E=C[0],_=C[1],A=C[2],R=C[3],F=n.data.get(a.dataId).values,D=(0,m.Z)(c,4),Z=D[0],O=D[1],M=D[2],z=D[3],L=p.padInfo.front,P=p.padInfo.left,B=p.padInfo.top,W=0;W<v;++W)for(var V=Math.max(0,Math.ceil((L-W)/d)),U=Math.min(p.outDepth,(p.inDepth+L-W)/d),G=W*w,j=0;j<g;++j)for(var H=Math.max(0,Math.ceil((B-j)/f)),q=Math.min(p.outHeight,(p.inHeight+B-j)/f),K=j*S+G,X=0;X<y;++X)for(var Y=Math.max(0,Math.ceil((P-X)/h)),Q=Math.min(p.outWidth,(p.inWidth+P-X)/h),J=X*I+K,$=0;$<p.inChannels;++$)for(var ee=$*N+J,te=0;te<p.outChannels;++te){for(var ne=0,re=0;re<p.batchSize;++re)for(var ae=re*Z,ie=re*E,oe=V;oe<U;++oe)for(var se=(W+oe*d-L)*O+ae,ue=oe*_+ie,ce=H;ce<q;++ce)for(var le=(j+ce*f-B)*M+se,pe=ce*A+ue,de=Y;de<Q;++de){var fe=de*R+pe;ne+=F[(X+de*h-P)*z+le+$]*T[fe+te]}x[ee+te]=ne}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var kD={kernelName:Vt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;iA([a],"conv3dBackpropInputV2");for(var c=Fa.computeStrides(a.shape),l=Fa.computeStrides(i.shape),p=sm.computeConv3DInfo(u,i.shape,s,1,o),d=new pi(p.inShape,"float32"),f=d.values,h=(0,m.Z)(d.strides,4),v=h[0],g=h[1],y=h[2],b=h[3],x=n.data.get(a.dataId).values,k=(0,m.Z)(c,4),w=k[0],S=k[1],I=k[2],N=k[3],T=n.data.get(i.dataId).values,C=(0,m.Z)(l,4),E=C[0],_=C[1],A=C[2],R=C[3],F=p.batchSize,D=p.filterDepth,Z=p.filterHeight,O=p.filterWidth,M=p.inChannels,z=p.inDepth,L=p.inHeight,P=p.inWidth,B=p.outChannels,W=p.outDepth,V=p.outHeight,U=p.outWidth,G=p.strideDepth,j=p.strideHeight,H=p.strideWidth,q=D-1-p.padInfo.front,K=Z-1-p.padInfo.top,X=O-1-p.padInfo.left,Y=0;Y<F;++Y)for(var Q=0;Q<M;++Q)for(var J=0;J<z;++J)for(var $=J-q,ee=Math.max(0,Math.ceil($/G)),te=Math.min(W,(D+$)/G),ne=0;ne<L;++ne)for(var re=ne-K,ae=Math.max(0,Math.ceil(re/j)),ie=Math.min(V,(Z+re)/j),oe=0;oe<P;++oe){for(var se=oe-X,ue=Math.max(0,Math.ceil(se/H)),ce=Math.min(U,(O+se)/H),le=0,pe=ee;pe<te;++pe)for(var de=pe*G-$,fe=ae;fe<ie;++fe)for(var he=fe*j-re,me=ue;me<ce;++me)for(var ve=w*Y+S*pe+I*fe+N*me,ge=E*(D-1-de)+_*(Z-1-he)+A*(O-1-(me*H-se))+R*Q,ye=0;ye<B;++ye){le+=x[ve+ye]*T[ge+ye]}f[v*Y+g*J+y*ne+b*oe+Q]=le}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},wD=AA(Ut,(function(e){return Math.cos(e)})),SD={kernelName:Ut,backendName:"cpu",kernelFunc:wD},ID=AA(Gt,(function(e){return Math.cosh(e)})),ND={kernelName:Gt,backendName:"cpu",kernelFunc:ID};var TD={kernelName:qt,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=(0,m.Z)(a.shape,4),p=l[0],d=l[1],f=l[2],h=l[3],v=i.shape[0],g=(0,m.Z)(s,2),y=g[0],b=g[1],x=us([v,y,b,h],"float32"),k=n.data.get(i.dataId).values,w=n.data.get(o.dataId).values,S=n.data.get(a.dataId).values,I=Fa.computeStrides(a.shape),N=Fa.computeStrides(x.shape),T=0;T<v;T++){var C=4*T,E=k[C],_=k[C+1],A=k[C+2],R=k[C+3],F=w[T];if(!(F>=p))for(var D=y>1?(A-E)*(d-1)/(y-1):0,Z=b>1?(R-_)*(f-1)/(b-1):0,O=0;O<y;O++){var M=y>1?E*(d-1)+O*D:.5*(E+A)*(d-1);if(M<0||M>d-1)for(var z=0;z<b;z++)for(var L=0;L<h;L++){var P=L+z*N[2]+O*N[1]+T*N[0];x.values[P]=c}else if("bilinear"===u)for(var B=Math.floor(M),W=Math.ceil(M),V=M-B,U=0;U<b;U++){var G=b>1?_*(f-1)+U*Z:.5*(_+R)*(f-1);if(G<0||G>f-1)for(var j=0;j<h;j++){var H=j+U*N[2]+O*N[1]+T*N[0];x.values[H]=c}else for(var q=Math.floor(G),K=Math.ceil(G),X=G-q,Y=0;Y<h;Y++){var Q=Y+q*I[2]+B*I[1]+F*I[0],J=S[Q],$=S[Q=Y+K*I[2]+B*I[1]+F*I[0]],ee=S[Q=Y+q*I[2]+W*I[1]+F*I[0]],te=J+($-J)*X,ne=ee+(S[Q=Y+K*I[2]+W*I[1]+F*I[0]]-ee)*X;Q=Y+U*N[2]+O*N[1]+T*N[0],x.values[Q]=te+(ne-te)*V}}else for(var re=0;re<b;++re){var ae=b>1?_*(f-1)+re*Z:.5*(_+R)*(f-1);if(ae<0||ae>f-1)for(var ie=0;ie<h;ie++){var oe=ie+re*N[2]+O*N[1]+T*N[0];x.values[oe]=c}else for(var se=Math.round(ae),ue=Math.round(M),ce=0;ce<h;ce++){var le=ce+se*I[2]+ue*I[1]+F*I[0],pe=ce+re*N[2]+O*N[1]+T*N[0];x.values[pe]=S[le]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var CD={kernelName:jt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;iA(a,"cumprod");var u=sm.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=_R({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=sm.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=Ii(c.dtype,"int32"),d=Fa.makeOnesTypedArray(Fa.sizeFromShape(c.shape),p),f=n.data.get(c.dataId).values,h=c.shape[c.shape.length-1],m=s?function(e,t){return e+h-t-1}:function(e,t){return e+t},v=0;v<f.length;v+=h)for(var g=0;g<h;g++){var y=m(v,g);if(0===g)d[y]=o?1:f[y];else{var b=m(v,g-1);d[y]=o?f[b]*d[b]:f[y]*d[b]}}var x=n.makeTensorInfo(c.shape,p,d);if(null!=u){var k=_R({inputs:{x:x},backend:n,attrs:{perm:sm.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var ED={kernelName:Ht,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;iA(a,"cumsum");var u=sm.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=_R({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=sm.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=Ii(c.dtype,"int32"),d=Fa.makeZerosTypedArray(Fa.sizeFromShape(c.shape),p),f=n.data.get(c.dataId).values,h=c.shape[c.shape.length-1],m=s?function(e,t){return e+h-t-1}:function(e,t){return e+t},v=0;v<f.length;v+=h)for(var g=0;g<h;g++){var y=m(v,g);if(0===g)d[y]=o?0:f[y];else{var b=m(v,g-1);d[y]=o?f[b]+d[b]:f[y]+d[b]}}var x=n.makeTensorInfo(c.shape,p,d);if(null!=u){var k=_R({inputs:{x:x},backend:n,attrs:{perm:sm.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var _D={kernelName:Kt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=CA(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=EA(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}};var AD={kernelName:Xt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;Fa.assert("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],p=u*i,d=c*i,f=l/(i*i),h=n.data.get(a.dataId).values,m=new Float32Array(s*p*d*f),v=0,g=0;g<s;++g)for(var y=0;y<p;++y)for(var b=Math.floor(y/i),x=y%i,k=0;k<d;++k)for(var w=Math.floor(k/i),S=(x*i+k%i)*f,I=0;I<f;++I){var N=I+S+l*(w+c*(b+u*g));m[v++]=h[N]}return n.makeTensorInfo([s,p,d,f],a.dtype,m)}};function RD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;iA([a,i],"depthwiseConv2DNative");var l=Fa.computeStrides(a.shape),p=Fa.computeStrides(i.shape),d=u;null==d&&(d=[1,1]),Fa.assert(sm.eitherStridesOrDilationsAreOne(o,d),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(d,"'")}));for(var f=sm.computeConv2DInfo(a.shape,i.shape,o,d,s,c,!0),h=f.filterHeight,m=f.filterWidth,v=f.dilationHeight,g=f.dilationWidth,y=f.padInfo,b=y.left,x=y.top,k=f.outChannels/f.inChannels,w=new pi(f.outShape,a.dtype),S=n.data.get(a.dataId).values,I=n.data.get(i.dataId).values,N=w.values,T=0;T<f.batchSize;++T)for(var C=T*l[0],E=T*w.strides[0],_=0;_<f.outHeight;++_)for(var A=E+_*w.strides[1],R=_*f.strideHeight-x,F=0;F<h;++F){var D=R+F*v;if(!(D<0||D>=f.inHeight))for(var Z=F*p[0],O=C+D*l[1],M=0;M<f.outWidth;++M)for(var z=A+M*w.strides[2],L=M*f.strideWidth-b,P=0;P<m;++P){var B=L+P*g;if(!(B<0||B>=f.inWidth))for(var W=Z+P*p[1],V=O+B*f.inChannels,U=z,G=W,j=0;j<f.inChannels;++j){for(var H=S[V+j],q=0;q<k;++q)N[U+q]+=H*I[G+q];U+=k,G+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var FD={kernelName:Yt,backendName:"cpu",kernelFunc:RD};var DD={kernelName:Qt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;iA([a,i],"depthwiseConv2dNativeBackpropFilter");for(var p=sm.computeConv2DInfo(a.shape,l,o,s,u,c,!0),d=p.strideHeight,f=p.strideWidth,h=p.filterHeight,m=p.filterWidth,v=new pi(p.filterShape,"float32"),g=p.padInfo.left,y=p.padInfo.top,b=p.outChannels/p.inChannels,x=n.data.get(a.dataId).values,k=new pi(a.shape,a.dtype,x),w=n.data.get(i.dataId).values,S=new pi(i.shape,i.dtype,w),I=0;I<h;++I)for(var N=Math.max(0,Math.ceil((y-I)/d)),T=Math.min(p.outHeight,(p.inHeight+y-I)/d),C=0;C<m;++C)for(var E=Math.max(0,Math.ceil((g-C)/f)),_=Math.min(p.outWidth,(p.inWidth+g-C)/f),A=0;A<p.outChannels;++A){for(var R=Math.trunc(A/b),F=A%b,D=0,Z=0;Z<p.batchSize;++Z)for(var O=N;O<T;++O)for(var M=I+O*d-y,z=E;z<_;++z){var L=C+z*f-g;D+=k.get(Z,M,L,R)*S.get(Z,O,z,A)}v.set(D,I,C,R,F)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var ZD={kernelName:Jt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;iA([a,i],"depthwiseConv2DNativeBackpropInput");for(var p=Fa.computeStrides(a.shape),d=Fa.computeStrides(i.shape),f=sm.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new pi(f.inShape,"float32"),v=h.values,g=(0,m.Z)(h.strides,3),y=g[0],b=g[1],x=g[2],k=n.data.get(a.dataId).values,w=(0,m.Z)(p,3),S=w[0],I=w[1],N=w[2],T=n.data.get(i.dataId).values,C=(0,m.Z)(d,3),E=C[0],_=C[1],A=C[2],R=f.batchSize,F=f.filterHeight,D=f.filterWidth,Z=f.inChannels,O=f.inHeight,M=f.inWidth,z=f.outChannels,L=f.outHeight,P=f.outWidth,B=f.strideHeight,W=f.strideWidth,V=F-1-f.padInfo.top,U=D-1-f.padInfo.left,G=z/Z,j=0;j<R;++j)for(var H=0;H<Z;++H)for(var q=0;q<O;++q)for(var K=q-V,X=Math.max(0,Math.ceil(K/B)),Y=Math.min(L,(F+K)/B),Q=0;Q<M;++Q){for(var J=Q-U,$=Math.max(0,Math.ceil(J/W)),ee=Math.min(P,(D+J)/W),te=0,ne=X;ne<Y;++ne)for(var re=ne*B-K,ae=$;ae<ee;++ae)for(var ie=S*j+I*ne+N*ae,oe=E*(F-1-re)+_*(D-1-(ae*W-J))+A*H,se=0;se<G;++se){te+=k[ie+(H*G+se)]*T[oe+se]}v[y*j+b*q+x*Q+H]=te}return n.makeTensorInfo(h.shape,h.dtype,h.values)}};var OD={kernelName:$t,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=Fa.sizeFromShape(r.shape),i=n.data.get(r.dataId).values,o=us([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat((0,h.Z)(r.shape),(0,h.Z)(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},MD={kernelName:en,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,p=a.shape.length,d=c.data.get(i.dataId).values,f=i.shape.length,h=sm.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=h.batchSize,v=h.inHeight,g=h.inWidth,y=h.inChannels,b=h.outHeight,x=h.outWidth,k=h.padInfo,w=h.strideHeight,S=h.strideWidth,I=h.filterHeight,N=h.filterWidth,T=h.dilationHeight,C=h.dilationWidth,E=h.outShape,_=Fa.sizeFromShape(E),A=E.length,R=Fa.getArrayFromDType(a.dtype,_),F=0;F<m;++F)for(var D=0;D<b;++D)for(var Z=D*w-k.top,O=0;O<x;++O)for(var M=O*S-k.left,z=0;z<y;++z){for(var L=Number.MIN_SAFE_INTEGER,P=0;P<I;++P){var B=Z+P*T;if(B>=0&&B<v)for(var W=0;W<N;++W){var V=M+W*C;if(V>=0&&V<g){var U=Fa.locToIndex([F,B,V,z],p,Fa.computeStrides(a.shape)),G=Fa.locToIndex([P,W,z],f,Fa.computeStrides(i.shape)),j=l[U]+d[G];j>L&&(L=j)}}}R[Fa.locToIndex([F,D,O,z],A,Fa.computeStrides(E))]=L}return{dataId:c.write(Fa.toTypedArray(R,a.dtype),E,a.dtype),shape:E,dtype:a.dtype}}},zD={kernelName:nn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=Fa.toNestedArray(a.shape,l.data.get(a.dataId).values),d=Fa.toNestedArray(i.shape,l.data.get(i.dataId).values),f=sm.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),h=f.batchSize,m=f.inHeight,v=f.inWidth,g=f.inChannels,y=f.outHeight,b=f.outWidth,x=f.padInfo,k=f.strideHeight,w=f.strideWidth,S=f.filterHeight,I=f.filterWidth,N=f.dilationHeight,T=f.dilationWidth,C=f.outShape;Fa.assert(o.rank===C.length,(function(){return"Error in ".concat(nn,", dy must have the same rank as output ").concat(C.length,", but got ").concat(o.rank)}));for(var E=Fa.toNestedArray(C,l.data.get(o.dataId).values),_=Fa.makeZerosNestedTypedArray(i.shape,i.dtype),A=0;A<h;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,D=0;D<b;++D)for(var Z=D*w-x.left,O=0;O<g;++O){for(var M=Number.MIN_SAFE_INTEGER,z=0,L=0,P=0;P<S;++P){var B=F+P*N;if(B>=0&&B<m)for(var W=0;W<I;++W){var V=Z+W*T;if(V>=0&&V<v){var U=p[A][B][V][O]+d[P][W][O];U>M&&(M=U,z=P,L=W)}}}_[z][L][O]+=E[A][R][D][O]}return{dataId:l.write(Fa.toTypedArray(_,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},LD={kernelName:tn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=Fa.toNestedArray(a.shape,l.data.get(a.dataId).values),d=Fa.toNestedArray(i.shape,l.data.get(i.dataId).values),f=sm.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),h=f.batchSize,m=f.inHeight,v=f.inWidth,g=f.inChannels,y=f.outHeight,b=f.outWidth,x=f.padInfo,k=f.strideHeight,w=f.strideWidth,S=f.filterHeight,I=f.filterWidth,N=f.dilationHeight,T=f.dilationWidth,C=f.outShape;Fa.assert(o.rank===C.length,(function(){return"Error in ".concat(tn,", dy must have the same rank as output ").concat(C.length,", but got ").concat(o.rank)}));for(var E=Fa.toNestedArray(C,l.data.get(o.dataId).values),_=Fa.makeZerosNestedTypedArray(a.shape,a.dtype),A=0;A<h;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,D=0;D<b;++D)for(var Z=D*w-x.left,O=0;O<g;++O){for(var M=Number.MIN_SAFE_INTEGER,z=F<0?0:F,L=Z<0?0:Z,P=0;P<S;++P){var B=F+P*N;if(B>=0&&B<m)for(var W=0;W<I;++W){var V=Z+W*T;if(V>=0&&V<v){var U=p[A][B][V][O]+d[P][W][O];U>M&&(M=U,z=B,L=V)}}}_[A][z][L][O]+=E[A][R][D][O]}return{dataId:l.write(Fa.toTypedArray(_,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};function PD(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;iA(i,"sum");var u=(t="bool"===i.dtype?bA({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):mA({inputs:{x:i},backend:r})).shape.length,c=Fa.parseAxisParam(o,t.shape),l=sm.getAxesPermutation(c,u),p=c,d=t;null!=l&&(d=_R({inputs:{x:t},backend:r,attrs:{perm:l}}),p=sm.getInnerMostAxes(p.length,u)),sm.assertAxesAreInnerMostDims("sum",p,d.shape.length);for(var f=sm.computeOutAndReduceShapes(d.shape,p),h=(0,m.Z)(f,2),v=h[0],g=h[1],y=hA(r,v,sm.upcastType(d.dtype,"int32")),b=Fa.sizeFromShape(g),x=r.data.get(y.dataId).values,k=r.data.get(d.dataId).values,w=0;w<x.length;++w){for(var S=w*b,I=0,N=0;N<b;++N)I+=k[S+N];x[w]=I}if(s){var T=y;y=TF({inputs:{x:y},backend:r,attrs:{shape:sm.expandShapeToKeepDim(y.shape,c)}}),r.disposeIntermediateTensorInfo(T)}return r.disposeIntermediateTensorInfo(t),null!=l&&r.disposeIntermediateTensorInfo(d),y}var BD={kernelName:Br,backendName:"cpu",kernelFunc:PD};var WD={kernelName:an,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=sm.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;sm.checkEinsumDimSizes(o.length,u,a);for(var c=sm.getEinsumComputePath(s,u),l=c.path,p=c.steps,d=p.length,f=null,h=o.length,m=[],v=0;v<d;++v){var g,y=(0,x.Z)(p[v]);try{for(y.s();!(g=y.n()).done;){var b=g.value,k=sm.getEinsumPermutation(h,u[b]),w=k.permutationIndices,S=k.expandDims,I=void 0;sm.isIdentityPermutation(w)?I=a[b]:(I=_R({inputs:{x:a[b]},backend:n,attrs:{perm:w}}),m.push(I));for(var N=I.shape.slice(),T=0;T<S.length;++T)N.splice(S[T],0,1);Fa.arraysEqual(I.shape,N)||(I=TF({inputs:{x:I},backend:n,attrs:{shape:N}}),m.push(I)),null===f?f=I:(f=kR({inputs:{a:I,b:f},backend:n}),m.push(f))}}catch(A){y.e(A)}finally{y.f()}v<d-1&&(l[v]>=0&&(f=PD({inputs:{x:f},backend:n,attrs:{axis:l[v]-(o.length-h),keepDims:!1}}),m.push(f)),h--)}for(var C=0,E=m;C<E.length;C++){var _=E[C];_!==f&&n.disposeIntermediateTensorInfo(_)}return f}};var VD={kernelName:sn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;iA([r,a],"eluGrad");for(var i=new Float32Array(Fa.sizeFromShape(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},UD=sm.ERF_P,GD=sm.ERF_A1,jD=sm.ERF_A2,HD=sm.ERF_A3,qD=sm.ERF_A4,KD=sm.ERF_A5,XD=AA(un,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+UD*n);return t*(1-((((KD*r+qD)*r+HD)*r+jD)*r+GD)*r*Math.exp(-n*n))})),YD={kernelName:un,backendName:"cpu",kernelFunc:XD};function QD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Fa.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),TF({inputs:{x:a},backend:n,attrs:{shape:s}})}var JD={kernelName:pn,backendName:"cpu",kernelFunc:QD},$D=pA((function(e,t){return e/t})),eZ=kA(rn,$D),tZ={kernelName:rn,backendName:"cpu",kernelFunc:eZ};function nZ(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=Fa.sizeFromShape(c),p=Fa.getTypedArrayFromDType("float32",l),d=Fa.getTypedArrayFromDType("float32",l),f=0;f<a;f++){for(var h=VR({inputs:{x:s},backend:n,attrs:{begin:[f,0],size:[1,i]}}),m=VR({inputs:{x:u},backend:n,attrs:{begin:[f,0],size:[1,i]}}),v=dA({inputs:{real:h,imag:m},backend:n}),g=rZ(v,t,n),y=g.real,b=g.imag,x=sm.mergeRealAndImagArrays(y,b),k=0;k<i;k++){var w=sm.getComplexWithIndex(x,k);p[f*i+k]=w.real,d[f*i+k]=w.imag}n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v)}var S=n.makeTensorInfo(c,"float32",p),I=n.makeTensorInfo(c,"float32",d),N=dA({inputs:{real:S,imag:I},backend:n});return n.disposeIntermediateTensorInfo(S),n.disposeIntermediateTensorInfo(I),N}function rZ(e,t,n){var r=Fa.sizeFromShape(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(function(e){return 0===(e&e-1)}(r)){var s=aZ(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),p=n.makeTensorInfo([],"float32",Fa.createScalarValue(r,"float32")),d=mA({inputs:{x:p},backend:n}),f=tZ.kernelFunc({inputs:{a:c,b:p},backend:n}),h=tZ.kernelFunc({inputs:{a:l,b:d},backend:n}),m=n.data.get(f.dataId).values,v=n.data.get(h.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),{real:m,imag:v}}return s}var g=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=sm.exponent(a*s,t,n),c=sm.getComplexWithIndex(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),sm.assignToTypedArray(r,i,o,a)}return r}(sm.mergeRealAndImagArrays(i,o),r,t);return sm.splitRealAndImagArrays(g)}function aZ(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=sm.mergeRealAndImagArrays(e,t),o=n/2,s=sm.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],p=a.makeTensorInfo(l,"float32",u),d=a.makeTensorInfo(l,"float32",c),f=dA({inputs:{real:p,imag:d},backend:a}),h=sm.complexWithOddIndex(i),m=h.real,v=h.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),b=a.makeTensorInfo(g,"float32",v),x=dA({inputs:{real:y,imag:b},backend:a}),k=aZ(u,c,o,r,a),w=k.real,S=k.imag,I=[w.length],N=a.makeTensorInfo(I,"float32",w),T=a.makeTensorInfo(I,"float32",S),C=dA({inputs:{real:N,imag:T},backend:a}),E=aZ(m,v,o,r,a),_=E.real,A=E.imag,R=[_.length],F=a.makeTensorInfo(R,"float32",_),D=a.makeTensorInfo(R,"float32",A),Z=dA({inputs:{real:F,imag:D},backend:a}),O=sm.exponents(n,r),M=[O.real.length],z=a.makeTensorInfo(M,"float32",O.real),L=a.makeTensorInfo(M,"float32",O.imag),P=dA({inputs:{real:z,imag:L},backend:a}),B=kR({inputs:{a:P,b:Z},backend:a}),W=NA({inputs:{a:C,b:B},backend:a}),V=sF({inputs:{a:C,b:B},backend:a}),U=gA({inputs:{input:W},backend:a}),G=gA({inputs:{input:V},backend:a}),j=pD({inputs:{input:W},backend:a}),H=pD({inputs:{input:V},backend:a}),q=fD({inputs:[U,G],backend:a,attrs:{axis:0}}),K=fD({inputs:[j,H],backend:a,attrs:{axis:0}}),X=a.data.get(q.dataId).values,Y=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(N),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(Z),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),{real:X,imag:Y}}var iZ={kernelName:fn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Fa.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=TF({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=nZ(o,!1,n),u=TF({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function oZ(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||Fa.inferDtype(a),o=Fa.getArrayFromDType(i,Fa.sizeFromShape(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var sZ={kernelName:hn,backendName:"cpu",kernelFunc:oZ};var uZ={kernelName:mn,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=Fa.getTypedArrayFromDType(r.dtype,Fa.sizeFromShape(r.shape)),o=(0,m.Z)(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],p=a.data.get(r.dataId).values,d=0;d<s;d++)for(var f=d*c*u*l,h=0;h<u;h++)for(var v=h*(c*l),g=0;g<c;g++)for(var y=g*l,b=0;b<l;b++){var x=Math.round(c-g-1),k=f+v+y+b,w=p[k];if(x>=0&&x<c)w=p[f+v+x*l+b];i[k]=w}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},cZ=pA((function(e,t){return Math.floor(e/t)})),lZ=kA(gn,cZ,null,"int32"),pZ={kernelName:gn,backendName:"cpu",kernelFunc:lZ};var dZ={kernelName:ga,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,d=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=mD({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:d}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var g=TF({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=NA({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=NA({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(f){var y=m;if("NCHW"===l&&"prelu"===f&&1===s.shape.length&&1!==s.shape[0]){var b=TF({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=NF(n,m,f,b,h),n.disposeIntermediateTensorInfo(b)}else m=NF(n,m,f,s,h);n.disposeIntermediateTensorInfo(y)}return m}};var fZ={kernelName:ya,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,d=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=RD({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:d}});if(o){var v=m;m=NA({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(f){var g=m;m=NF(n,m,f,s,h),n.disposeIntermediateTensorInfo(g)}return m}};var hZ={kernelName:xn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=Fa.sizeFromShape(r.shape),o=a.shape,s=o[o.length-1],u=sm.prepareAndValidate(r,a),c=(0,m.Z)(u,4),l=c[0],p=c[1],d=c[2],f=c[3];if(0===p)return n.makeTensorInfo(l,r.dtype,[]);var h=KA(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,p,s,d,f,r.shape,i);return n.makeTensorInfo(l,r.dtype,h.values)}};var mZ={kernelName:bn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;iA([a,i],"gatherV2");for(var u=Fa.parseAxisParam(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],p=function(e){var t=c[e];Fa.assert(t<=l-1&&t>=0,(function(){return"GatherV2: the index value ".concat(t," is not in [0, ").concat(l-1,"]")}))},d=0;d<c.length;++d)p(d);var f=s;null==s&&(f=0);var h=Fa.sizeFromShape(i.shape),m=sm.segment_util.collectGatherOpShapeInfo(a,i,u,f),v=TF({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=TF({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,h/m.batchSize]}}),y=[m.batchSize,m.outerSize,h/m.batchSize,m.sliceSize],b=n.bufferSync(g),x=XA(n.bufferSync(v),b,y);return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}};var vZ={kernelName:In,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Fa.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=TF({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=nZ(o,!0,n),u=TF({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},gZ=AA(Tn,(function(e){return Number.isFinite(e)?1:0}),"bool"),yZ={kernelName:Tn,backendName:"cpu",kernelFunc:gZ},bZ=AA(Cn,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),xZ={kernelName:Cn,backendName:"cpu",kernelFunc:bZ},kZ=AA(En,(function(e){return Number.isNaN(e)?1:0}),"bool"),wZ={kernelName:En,backendName:"cpu",kernelFunc:kZ};var SZ={kernelName:Fn,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=uR(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},IZ=AA(Zn,(function(e){return Math.log1p(e)})),NZ={kernelName:Zn,backendName:"cpu",kernelFunc:IZ},TZ=pA((function(e,t){return e&&t})),CZ=kA(On,TZ,null,"bool"),EZ={kernelName:On,backendName:"cpu",kernelFunc:CZ},_Z=AA(Mn,(function(e){return e?0:1}),"bool"),AZ={kernelName:Mn,backendName:"cpu",kernelFunc:_Z},RZ=pA((function(e,t){return e||t})),FZ=kA(zn,RZ,null,"bool"),DZ={kernelName:zn,backendName:"cpu",kernelFunc:FZ};var ZZ={kernelName:Wn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;iA(a,"LRN");var c=a.shape[3],l=c-1,p=n.data.get(a.dataId).values,d=Fa.sizeFromShape(a.shape),f=new Float32Array(d);function h(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=p[n];a+=o*o}return a}for(var m=0;m<d;m++){var v=h(m),g=p[m]*Math.pow(o+s*v,-u);f[m]=g}return n.makeTensorInfo(a.shape,a.dtype,f)}};var OZ={kernelName:Vn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;iA(o,"LRNGrad");for(var p=Fa.sizeFromShape(o.shape),d=o.shape[3],f=n.data.get(o.dataId).values,h=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(p),g=p,y=0;y<g;y++){for(var b=y%d,x=y-b+Math.max(0,b-s),k=y-b+Math.min(d,b+s+1),w=0,S=x;S<k;S++)w+=Math.pow(h[S],2);w=c*w+u;for(var I=x;I<k;I++){var N=-2*c*l*h[I]*m[y]/w;y===I&&(N+=Math.pow(w,-l)),N*=f[y],v[I]+=N}}return n.makeTensorInfo(o.shape,a.dtype,v)}};function MZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,l=Fa.parseAxisParam(i,u),p=l,d=sm.getAxesPermutation(p,c),f=s.data.get(a.dataId).values;if(null!=d){for(var h=new Array(c),v=0;v<h.length;v++)h[v]=u[d[v]];f=ER(f,u,a.dtype,d,h),p=sm.getInnerMostAxes(p.length,c),u=h}iA(a,"max"),sm.assertAxesAreInnerMostDims("max",p,c);var g=sm.computeOutAndReduceShapes(u,p),y=(0,m.Z)(g,2),b=y[0],x=y[1],k=dR(f,Fa.sizeFromShape(x),b,a.dtype),w=s.write(k,b,a.dtype),S=b;return o&&(S=sm.expandShapeToKeepDim(b,l)),{dataId:w,shape:S,dtype:a.dtype}}var zZ={kernelName:Un,backendName:"cpu",kernelFunc:MZ};var LZ={kernelName:jn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;iA(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Fa.assert(sm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=sm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Fa.arraysEqual(l.inShape,l.outShape))c=mA({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,d=Fa.computeStrides(a.shape),f=QF(p,a.shape,a.dtype,d,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,f.values)}return c}};var PZ={kernelName:qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;iA(a,"maxPool3d");var l=sm.computePool3DInfo(a.shape,i,o,1,s,u,c),p=$F(n.data.get(a.dataId).values,a.shape,a.dtype,Fa.computeStrides(a.shape),l,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}};var BZ={kernelName:Kn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;iA([a,i],"maxPool3DGrad");for(var l=sm.computePool3DInfo(i.shape,o,s,1,u,c),p=function(e,t){for(var n=us(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,p=t.effectiveFilterWidth,d=t.padInfo.front,f=t.padInfo.top,h=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var g=0;g<t.outDepth;++g){for(var y=g*r-d,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,c+y),k=0;k<t.outHeight;++k){for(var w=k*a-f,S=w;S<0;)S+=s;for(var I=Math.min(t.inHeight,l+w),N=0;N<t.outWidth;++N){for(var T=N*i-h,C=T;C<0;)C+=u;for(var E=Math.min(t.inWidth,p+T),_=Number.NEGATIVE_INFINITY,A=-1,R=b;R<x;R+=o)for(var F=R-y,D=S;D<I;D+=s)for(var Z=D-w,O=C;O<E;O+=u){var M=O-T,z=e.get(m,R,D,O,v);z>=_&&(_=z,A=F*l*p+Z*l+M)}n.set(A,m,g,k,N,v)}}}return n}(n.bufferSync(i),l),d=l.strideDepth,f=l.strideHeight,h=l.strideWidth,m=l.dilationDepth,v=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,k=y-1-l.padInfo.front,w=x-1-l.padInfo.left,S=b-1-l.padInfo.top,I=us(i.shape,"float32"),N=n.bufferSync(a),T=0;T<l.batchSize;++T)for(var C=0;C<l.inChannels;++C)for(var E=0;E<l.inDepth;++E)for(var _=0;_<l.inHeight;++_)for(var A=0;A<l.inWidth;++A){for(var R=E-k,F=_-S,D=A-w,Z=0,O=0;O<y;O+=m){var M=(R+O)/d;if(!(M<0||M>=l.outDepth||Math.floor(M)!==M))for(var z=0;z<b;z+=v){var L=(F+z)/f;if(!(L<0||L>=l.outHeight||Math.floor(L)!==L))for(var P=0;P<x;P+=g){var B=(D+P)/h;if(!(B<0||B>=l.outWidth||Math.floor(B)!==B)){var W=y*b*x-1-p.get(T,M,L,B,C)===O*b*x+z*x+P?1:0;0!==W&&(Z+=N.get(T,M,L,B,C)*W)}}}}I.set(Z,T,E,_,A,C)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};var WZ={kernelName:Hn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;iA([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=sm.computePool2DInfo(o.shape,s,u,1,c,l),d=n.data.get(o.dataId).values,f=us(p.outShape,o.dtype,JF(d,o.shape,o.dtype,p).values),h=p.strideHeight,m=p.strideWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.effectiveFilterHeight,b=p.effectiveFilterWidth,x=b-1-p.padInfo.left,k=y-1-p.padInfo.top,w=us(o.shape,"float32"),S=n.data.get(a.dataId).values,I=us(a.shape,"float32",S),N=0;N<p.batchSize;++N)for(var T=0;T<p.inChannels;++T)for(var C=0;C<p.inHeight;++C)for(var E=0;E<p.inWidth;++E){for(var _=C-k,A=E-x,R=0,F=0;F<y;F+=v){var D=(_+F)/h;if(!(D<0||D>=p.outHeight||Math.floor(D)!==D))for(var Z=0;Z<b;Z+=g){var O=(A+Z)/m;if(!(O<0||O>=p.outWidth||Math.floor(O)!==O)){var M=y*b-1-f.get(N,D,O,T)===F*b+Z?1:0;0!==M&&(R+=I.get(N,D,O,T)*M)}}}w.set(R,N,C,E,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var VZ={kernelName:Xn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;iA(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,p=sm.computePool2DInfo(a.shape,i,o,[1,1],s),d=function(e,t,n,r,a){var i=QF(e,0,n,Fa.computeStrides(t),a,"max"),o=JF(e,t,n,a,!0,r);return[i.values,o.values]}(l,a.shape,a.dtype,u,p),f=(0,m.Z)(d,2),h=f[0],v=f[1],g=c.write(h,p.outShape,a.dtype),y=c.write(v,p.outShape,a.dtype);return[{dataId:g,shape:p.outShape,dtype:a.dtype},{dataId:y,shape:p.outShape,dtype:"int32"}]}};var UZ={kernelName:Yn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=Fa.parseAxisParam(i,a.shape),u=sm.computeOutAndReduceShapes(a.shape,s)[1],c=Fa.sizeFromShape(u),l=[],p=n.makeTensorInfo([],"float32",new Float32Array([c]));l.push(p);var d=bA({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});l.push(d);var f=eZ({inputs:{a:d,b:p},backend:n});l.push(f);var h=PD({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:o}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),h}};var GZ={kernelName:Qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;iA(a,"min");var s=Fa.parseAxisParam(i,a.shape),u=s,c=sm.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=_R({inputs:{x:a},backend:n,attrs:{perm:c}}),u=sm.getInnerMostAxes(u.length,a.shape.length)),sm.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var p=sm.computeOutAndReduceShapes(l.shape,u),d=(0,m.Z)(p,2),f=d[0],h=d[1],v=Fa.sizeFromShape(h),g=Fa.makeZerosTypedArray(Fa.sizeFromShape(f),l.dtype),y=n.data.get(l.dataId).values,b=0;b<g.length;++b){for(var x=b*v,k=y[x],w=0;w<v;++w){var S=y[x+w];(Number.isNaN(S)||S<k)&&(k=S)}g[b]=k}null!=c&&n.disposeIntermediateTensorInfo(l);var I=n.makeTensorInfo(f,l.dtype,g);if(o){var N=TF({inputs:{x:I},backend:n,attrs:{shape:sm.expandShapeToKeepDim(f,s)}});return n.disposeIntermediateTensorInfo(I),N}return I}};var jZ={kernelName:$n,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;iA(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,p=n.data.get(a.dataId).values,d=a.shape.length,f=Fa.computeStrides(a.shape),h=Fa.sizeFromShape(s),m=s.length,v=Fa.computeStrides(s),g=Fa.getTypedArrayFromDType(a.dtype,h),y=0;y<h;y++){for(var b=Fa.indexToLoc(y,m,v),x=0;x<m;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-l:b[x]>=c[x]&&(b[x]=2*(c[x]-1)-b[x]+l);b=b.map((function(e,t){return e-u[t]}));var k=Fa.locToIndex(b,d,f);g[y]=p[k]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},HZ=pA((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),qZ=kA(er,HZ),KZ={kernelName:er,backendName:"cpu",kernelFunc:qZ},XZ=Z(H());function YZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(o," and dim was ").concat(s));var u=Fa.parseAxisParam([s],a.shape),c=MZ({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=sm.expandShapeToKeepDim(c.shape,u),p=TF({inputs:{x:c},backend:n,attrs:{shape:l}}),d=sF({inputs:{a:a,b:p},backend:n}),f=BA({inputs:{x:d},backend:n}),h=PD({inputs:{x:f},backend:n,attrs:{axis:u,keepDims:!1}}),m=TF({inputs:{x:h},backend:n,attrs:{shape:l}}),v=eZ({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),v}var QZ={kernelName:Ur,backendName:"cpu",kernelFunc:YZ};var JZ={kernelName:tr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;iA(a,"multinomial");for(var u=s?a:YZ({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],p=n.data.get(u.dataId).values,d=[c,i],f=Fa.makeZerosTypedArray(Fa.sizeFromShape(d),"int32"),h=0;h<c;++h){var m=h*l,v=new Float32Array(l-1);v[0]=p[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+p[m+g];for(var y=XZ.alea(o.toString()),b=h*i,x=0;x<i;++x){var k=y();f[b+x]=v.length;for(var w=0;w<v.length;w++)if(k<v[w]){f[b+x]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(d,"int32",f)}},$Z=sv.nonMaxSuppressionV3Impl;var eO={kernelName:ir,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;iA(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=$Z(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},tO=sv.nonMaxSuppressionV4Impl;var nO={kernelName:or,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;iA(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,d=tO(l,p,o,s,u,c),f=d.selectedIndices,h=d.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},rO=sv.nonMaxSuppressionV5Impl;var aO={kernelName:sr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;iA(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,d=rO(l,p,o,s,u,c),f=d.selectedIndices,h=d.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}};var iO={kernelName:cr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue;iA(a,"oneHot");var u=Fa.sizeFromShape(a.shape),c=new Float32Array(u*i);c.fill(s);for(var l=n.data.get(a.dataId).values,p=0;p<u;++p)l[p]>=0&&l[p]<i&&(c[p*i+l[p]]=o);return n.makeTensorInfo([].concat((0,h.Z)(a.shape),[i]),"int32",c)}};function oO(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=gA({inputs:{input:r},backend:n}),i=oO({inputs:{x:a},backend:n}),o=pD({inputs:{input:r},backend:n}),s=oO({inputs:{x:o},backend:n}),u=dA({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return oZ({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var sO={kernelName:da,backendName:"cpu",kernelFunc:oO};var uO={kernelName:ur,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=gA({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=pD({inputs:{input:a},backend:r}),u=oO({inputs:{x:s},backend:r}),c=dA({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return oZ({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function cO(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return QD({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Fa.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Fa.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=fD({inputs:t.map((function(e){var t=QD({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}var lO={kernelName:lr,backendName:"cpu",kernelFunc:cO};var pO={kernelName:pr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;iA(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=Fa.sizeFromShape(a.shape),p=a.shape.length,d=Fa.computeStrides(a.shape),f=Fa.sizeFromShape(s),h=s.length,m=Fa.computeStrides(s),v=Fa.getTypedArrayFromDType(a.dtype,f);0!==o&&v.fill(o);for(var g=0;g<l;g++){var y=Fa.indexToLoc(g,p,d).map((function(e,t){return e+u[t]}));v[Fa.locToIndex(y,h,m)]=c[g]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},dO=pA((function(e,t){return Math.pow(e,t)})),fO=kA(fr,dO),hO={kernelName:fr,backendName:"cpu",kernelFunc:fO};var mO={kernelName:vr,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=DR(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},vO=AA(yr,(function(e){return 1/e})),gO={kernelName:yr,backendName:"cpu",kernelFunc:vO};var yO={kernelName:Sr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;iA(a,"resizeBilinear");for(var u=Fa.computeStrides(a.shape),c=(0,m.Z)(s,2),l=c[0],p=c[1],d=(0,m.Z)(a.shape,4),f=d[0],h=d[1],v=d[2],g=d[3],y=n.data.get(a.dataId).values,b=new Float32Array(Fa.sizeFromShape([f,l,p,g])),x=[i&&l>1?h-1:h,i&&p>1?v-1:v],k=[i&&l>1?l-1:l,i&&p>1?p-1:p],w=0,S=x[0]/k[0],I=x[1]/k[1],N=0;N<f;N++)for(var T=0;T<l;T++){var C=void 0;C=o?S*(T+.5)-.5:S*T;for(var E=Math.max(0,Math.floor(C)),_=C-E,A=Math.min(h-1,Math.ceil(C)),R=N*u[0]+E*u[1],F=N*u[0]+A*u[1],D=0;D<p;D++){var Z=void 0;Z=o?I*(D+.5)-.5:I*D;for(var O=Math.max(0,Math.floor(Z)),M=Z-O,z=Math.min(v-1,Math.ceil(Z)),L=R+O*u[2],P=F+O*u[2],B=R+z*u[2],W=F+z*u[2],V=0;V<g;V++){var U=y[L+V],G=y[P+V],j=U+(y[B+V]-U)*M,H=j+(G+(y[W+V]-G)*M-j)*_;b[w++]=H}}}return n.makeTensorInfo([f,l,p,g],"float32",b)}};var bO={kernelName:Ir,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;iA([i,a],"resizeBilinearGrad");for(var s=Fa.computeStrides(a.shape),u=(0,m.Z)(a.shape,4),c=u[0],l=u[1],p=u[2],d=u[3],f=(0,m.Z)(i.shape,3),h=f[1],v=f[2],g=new Float32Array(c*l*p*d),y=[o&&h>1?l-1:l,o&&v>1?p-1:p],b=[o&&h>1?h-1:h,o&&v>1?v-1:v],x=y[0]/b[0],k=y[1]/b[1],w=n.data.get(i.dataId).values,S=0,I=0;I<c;I++)for(var N=I*s[0],T=0;T<h;T++)for(var C=T*x,E=Math.floor(C),_=Math.min(Math.ceil(C),l-1),A=N+E*s[1],R=N+_*s[1],F=C-E,D=1-F,Z=0;Z<v;Z++)for(var O=Z*k,M=Math.floor(O),z=Math.min(Math.ceil(O),p-1),L=O-M,P=1-L,B=A+M*s[2],W=A+z*s[2],V=R+M*s[2],U=R+z*s[2],G=D*P,j=D*L,H=F*P,q=F*L,K=0;K<d;K++){var X=w[S++];g[B+K]+=X*G,g[W+K]+=X*j,g[V+K]+=X*H,g[U+K]+=X*q}return n.makeTensorInfo([c,p,l,d],"float32",g)}};var xO={kernelName:kr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;iA(a,"resizeNearestNeighbor");for(var u=Fa.computeStrides(a.shape),c=(0,m.Z)(s,2),l=c[0],p=c[1],d=(0,m.Z)(a.shape,4),f=d[0],h=d[1],v=d[2],g=d[3],y=n.data.get(a.dataId).values,b=new Float32Array(f*l*p*g),x=[i&&l>1?h-1:h,i&&p>1?v-1:v],k=[i&&l>1?l-1:l,i&&p>1?p-1:p],w=x[0]/k[0],S=x[1]/k[1],I=0,N=0;N<f;N++)for(var T=N*u[0],C=0;C<l;C++){var E=o?w*(C+.5):w*C,_=Math.min(h-1,i?Math.round(E):Math.floor(E));o&&(_=Math.max(0,_));for(var A=T+_*u[1],R=0;R<p;R++){var F=o?S*(R+.5):S*R,D=Math.min(v-1,i?Math.round(F):Math.floor(F));o&&(D=Math.max(0,D));for(var Z=A+D*u[2],O=0;O<g;O++){var M=y[Z+O];b[I++]=M}}}return n.makeTensorInfo([f,l,p,g],a.dtype,b)}};var kO={kernelName:wr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;iA([i,a],"resizeNearestNeighborGrad");for(var s=Fa.computeStrides(a.shape),u=Fa.computeStrides(i.shape),c=(0,m.Z)(a.shape,4),l=c[0],p=c[1],d=c[2],f=c[3],h=(0,m.Z)(i.shape,3),v=h[1],g=h[2],y=new Float32Array(l*p*d*f),b=n.data.get(i.dataId).values,x=[o&&v>1?p-1:p,o&&g>1?d-1:d],k=[o&&v>1?v-1:v,o&&g>1?g-1:g],w=x[0]/k[0],S=x[1]/k[1],I=1/w,N=1/S,T=2*Math.ceil(I)+2,C=2*Math.ceil(N)+2,E=0;E<l;E++)for(var _=E*s[0],A=0;A<p;A++)for(var R=_+A*s[1],F=Math.floor(A*I),D=Math.floor(F-T/2),Z=0;Z<d;Z++)for(var O=R+Z*s[2],M=Math.floor(Z*N),z=Math.floor(M-C/2),L=0;L<f;L++){for(var P=0,B=0;B<T;B++){var W=B+D;if(!(W<0||W>=v)){var V=_+W*u[1],U=W*w;if(A===Math.min(p-1,o?Math.round(U):Math.floor(U)))for(var G=0;G<C;G++){var j=G+z;if(!(j<0||j>=g)){var H=V+j*u[2],q=j*S;Z===Math.min(d-1,o?Math.round(q):Math.floor(q))&&(P+=b[H+L])}}}}y[O+L]=P}return n.makeTensorInfo(a.shape,a.dtype,y)}};var wO={kernelName:Tr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;iA(a,"reverse");var o=a.shape.length,s=Fa.parseAxisParam(i,a.shape);if(0===o)return mA({inputs:{x:a},backend:n});for(var u=new pi(a.shape,a.dtype),c=n.bufferSync(a),l=function(e){var t=u.indexToLoc(e),n=t.slice();s.forEach((function(e){return n[e]=a.shape[e]-1-n[e]})),u.set.apply(u,[c.get.apply(c,(0,h.Z)(n))].concat((0,h.Z)(t)))},p=0;p<u.size;p++)l(p);return n.makeTensorInfo(u.shape,u.dtype,u.values)}},SO={kernelName:ma,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=Fa.getTypedArrayFromDType(a.dtype,Fa.sizeFromShape(a.shape)),l=(0,m.Z)(a.shape,4),p=l[0],d=l[1],f=l[2],h=l[3],v=sm.getImageCenter(s,d,f),g=(0,m.Z)(v,2),y=g[0],b=g[1],x=Math.sin(i),k=Math.cos(i),w=u.data.get(a.dataId).values,S=0;S<p;S++)for(var I=S*f*d*h,N=0;N<d;N++)for(var T=N*(f*h),C=0;C<f;C++)for(var E=C*h,_=0;_<h;_++){var A=[p,N,C,_],R=A[2],F=A[1],D=(R-y)*k-(F-b)*x,Z=(R-y)*x+(F-b)*k;D=Math.round(D+y),Z=Math.round(Z+b);var O=o;if("number"!=typeof o&&(O=3===_?255:o[_]),D>=0&&D<f&&Z>=0&&Z<d)O=w[I+Z*(f*h)+D*h+_];c[I+T+E+_]=O}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},IO=AA(Cr,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),NO={kernelName:Cr,backendName:"cpu",kernelFunc:IO};var TO={kernelName:_r,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=sm.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,d=s.outputSize,f=zR(n.bufferSync(a),n.bufferSync(i),o,d,l,c,u,p,0,!0);return n.makeTensorInfo(o,f.dtype,f.values)}};function CO(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function EO(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var _O={kernelName:Ar,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=Fa.getArrayFromDType("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]="left"===i?CO(u,t[l+c]):EO(u,t[l+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var AO={kernelName:Rr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;iA([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=Ii(a.dtype,i.dtype),p=Fa.makeZerosTypedArray(Fa.sizeFromShape(a.shape),l),d=0,f=0===o||o>1||1===a.shape.length?1:Fa.sizeFromShape(a.shape.slice(1)),h=0;h<s.length;h++)for(var m=0;m<f;m++)1===s[h]?p[d++]=u[h]:p[d++]=c[h];return n.makeTensorInfo(a.shape,l,p)}},RO=sm.SELU_SCALEALPHA,FO=sm.SELU_SCALE,DO=AA(Fr,(function(e){return e>=0?FO*e:RO*(Math.exp(e)-1)})),ZO={kernelName:Fr,backendName:"cpu",kernelFunc:DO},OO=AA(Mr,(function(e){return e<0?-1:e>0?1:0})),MO={kernelName:Mr,backendName:"cpu",kernelFunc:OO},zO=AA(Zr,(function(e){return Math.sin(e)})),LO={kernelName:Zr,backendName:"cpu",kernelFunc:zO},PO=AA(Or,(function(e){return Math.sinh(e)})),BO={kernelName:Or,backendName:"cpu",kernelFunc:PO},WO=Math.log(1.1920928955078125e-7)+2,VO=AA(Lr,(function(e){var t=e>-WO,n=e<WO,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),UO={kernelName:Lr,backendName:"cpu",kernelFunc:VO};var GO={kernelName:Wr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;iA([a],"spaceToBatchND");var s=Fa.sizeFromShape(i),u=[[0,0]];u.push.apply(u,(0,h.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=pO.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=sm.getReshaped(l.shape,i,s,!1),d=sm.getPermuted(p.length,i.length,!1),f=sm.getReshapedPermuted(l.shape,i,s,!1),m=TF({inputs:{x:l},backend:n,attrs:{shape:p}}),v=_R({inputs:{x:m},backend:n,attrs:{perm:d}}),g=TF({inputs:{x:v},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),g}};var jO={kernelName:Gr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],p=GR(s,r.shape,r.dtype,u,a.dtype,c,l),d=(0,m.Z)(p,5),f=d[0],h=d[1],v=d[2],g=d[3],y=d[4];return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],a.dtype,v),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}};var HO={kernelName:jr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),c=jR(s,r.shape,r.dtype,o,u),l=(0,m.Z)(c,3),p=l[0],d=l[1],f=l[2];return[n.makeTensorInfo(d,r.dtype,p),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};var qO={kernelName:Hr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=HR(o,r.shape,r.dtype,s,u,!0),l=(0,m.Z)(c,2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var KO={kernelName:qr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=HR(o,r.shape,r.dtype,s,u),l=(0,m.Z)(c,2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var XO={kernelName:Kr,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=sm.calculateShapes(o,i,u),l=c.sliceRank,p=c.numUpdates,d=c.sliceSize,f=c.strides,h=c.outputSize,m=!1,v=r.bufferSync(i);switch(o.dtype){case"bool":t=zR(v,r.bufferSync(o),u,h,d,p,l,f,Boolean(r.data.get(s.dataId).values[0]),m);break;case"float32":t=zR(v,r.bufferSync(o),u,h,d,p,l,f,r.data.get(s.dataId).values[0],m);break;case"int32":t=zR(v,r.bufferSync(o),u,h,d,p,l,f,r.data.get(s.dataId).values[0],m);break;case"string":t=zR(v,r.bufferSync(o),u,h,d,p,l,f,Fa.decodeString(r.data.get(s.dataId).values[0]),m);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var YO={kernelName:Vr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Fa.parseAxisParam(o,a.shape)[0],u=sm.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=(0,h.Z)(l);t[s]=e;var r=VR({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[s]+=e,r}))}},QO={kernelName:Yr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;iA(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},JO=AA(fa,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),$O={kernelName:fa,backendName:"cpu",kernelFunc:JO};var eM={kernelName:Qr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,p=r.newAxisMask,d=r.shrinkAxisMask;iA(a,"stridedSlice");var f,h=Ru.sliceInfo(a.shape,i,o,s,u,c,l,p,d),m=h.finalShapeSparse,v=h.finalShape,g=h.isIdentity,y=h.sliceDim0,b=h.isSimpleSlice,x=h.begin,k=h.end,w=h.strides;if(g)f=TF({inputs:{x:a},backend:n,attrs:{shape:v}});else if(y||b){Fa.assert(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var S=Ru.computeOutShape(x,k,w),I=VR({inputs:{x:a},backend:n,attrs:{begin:x,size:S}});f=TF({inputs:{x:I},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(I)}else{var N=$R(m,n.bufferSync(a),w,x);f=n.makeTensorInfo(v,N.dtype,N.values)}return f}};var tM={kernelName:Jr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,d=tF(n.data.get(l.dataId).values,n.data.get(p.dataId).values,a,i,o,s,u,c),f=(0,m.Z)(d,2),h=f[0],v=f[1];return[n.makeTensorInfo([h.length],"string",h),n.makeTensorInfo(p.shape,"int32",v)]}};var nM={kernelName:$r,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=rF(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),s=(0,m.Z)(o,3),u=s[0],c=s[1],l=s[2],p=c.length;return[n.makeTensorInfo([p,2],"int32",u),n.makeTensorInfo([p],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(l))]}};var rM={kernelName:ea,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=aF(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},aM=AA(na,(function(e){return Math.tan(e)})),iM={kernelName:na,backendName:"cpu",kernelFunc:aM},oM=AA(ra,(function(e){return Math.tanh(e)}));var sM={kernelName:aa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;iA(a,"tile");var o=cF(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}};var uM={kernelName:ia,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;iA(a,"topk");var s=dF(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),u=(0,m.Z)(s,2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var cM={kernelName:oa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=(0,m.Z)(a.shape,4),p=l[0],d=l[1],f=l[2],h=l[3],v=null!=c?c:[d,f],g=(0,m.Z)(v,2),y=g[0],b=g[1],x=[p,y,b,h],k=Fa.computeStrides(a.shape),w=k[0],S=k[1],I=k[2],N=Fa.getTypedArrayFromDType(a.dtype,Fa.sizeFromShape(x));N.fill(u);for(var T=r.data.get(a.dataId).values,C=r.data.get(i.dataId).values,E=0;E<p;++E){for(var _=1===i.shape[0]?C:C.subarray(8*E,8*E+8),A=0;A<y;++A)for(var R=0;R<b;++R)for(var F=0;F<h;++F){var D=void 0,Z=_[6]*R+_[7]*A+1;if(0!==Z){var O=(_[0]*R+_[1]*A+_[2])/Z,M=(_[3]*R+_[4]*A+_[5])/Z,z=lM(O,f,s),L=lM(M,d,s);switch(o){case"nearest":D=dM(T,d,f,w,S,I,E,L,z,F,u);break;case"bilinear":D=fM(T,d,f,w,S,I,E,L,z,F,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(o))}N[E*w+A*S+R*I+F]=D}}return r.makeTensorInfo(x,a.dtype,N)}return{dataId:r.write(N,x,a.dtype),shape:a.shape,dtype:a.dtype}}};function lM(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return Fa.clamp(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return Fa.clamp(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Fa.clamp(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function pM(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function dM(e,t,n,r,a,i,o,s,u,c,l){return pM(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function fM(e,t,n,r,a,i,o,s,u,c,l){var p=Math.floor(s),d=Math.floor(u),f=p+1,h=d+1;return(f-s)*((h-u)*pM(e,t,n,r,a,i,o,p,d,c,l)+(u-d)*pM(e,t,n,r,a,i,o,p,h,c,l))+(s-p)*((h-u)*pM(e,t,n,r,a,i,o,f,d,c,l)+(u-d)*pM(e,t,n,r,a,i,o,f,h,c,l))}var hM={kernelName:ua,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;iA(i,"unique");var o=fF(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var mM={kernelName:ca,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o).fill(0),d=a.shape.slice();d[i]=1;for(var f=new Array(s),h=0;h<f.length;h++){p[i]=h;var m=VR({inputs:{x:a},backend:n,attrs:{begin:p,size:d}});f[h]=TF({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return f}};for(var vM={kernelName:la,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;iA(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,p=0;p<c;++p){var d=QD({inputs:{input:l},backend:n,attrs:{dim:p+1}});l=d,u.push(d)}for(var f=0;f<o;++f){var h=Fa.createScalarValue(f,"int32"),m=n.makeTensorInfo([],"int32",h),v=zA({inputs:{a:m,b:l},backend:n}),g=bA({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),y=kR({inputs:{a:g,b:a},backend:n}),b=PD({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(m),u.push(v),u.push(g),u.push(y),u.push(b)}var x=cO({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},gM=0,yM=[AF,lA,FF,ZF,TA,OF,MF,zF,LF,PF,WF,UF,jF,KF,YF,eD,tD,nD,rD,_F,aD,iD,oD,sD,xA,ZA,cD,fA,lD,hD,vD,gD,yD,bD,xD,kD,SD,ND,TD,CD,ED,_D,AD,FD,DD,ZD,OD,MD,zD,LD,WD,mF,VD,LA,YD,WA,JD,GA,iZ,sZ,uZ,qA,pZ,dZ,fZ,hZ,mZ,JA,tR,vA,vZ,dD,yZ,xZ,wZ,gF,aR,sR,SZ,pR,NZ,EZ,AZ,DZ,ZZ,OZ,zZ,mR,LZ,PZ,BZ,WZ,VZ,UZ,GZ,yR,jZ,KZ,JZ,wR,IR,eO,nO,aO,CR,iO,uO,lO,pO,hO,xF,FR,mO,yA,tZ,gO,wF,IF,CF,yO,bO,xO,kO,wO,SO,NO,MR,TO,_O,AO,ZO,BR,MO,LO,BO,UR,QZ,UO,GO,jO,HO,qO,KO,XO,YO,XR,QO,JR,$O,eM,tM,nM,rM,uF,BD,iM,{kernelName:ra,backendName:"cpu",kernelFunc:oM},sM,uM,cM,AR,hM,mM,vM,sO];gM<yM.length;gM++){Ta(yM[gM])}var bM={};D(bM,{assertNotComplex:function(){return Tz},bindCanvasToFramebuffer:function(){return nz},bindColorTextureToFramebuffer:function(){return rz},bindTextureToProgramUniformSampler:function(){return tz},bindTextureUnit:function(){return QM},bindVertexBufferToProgramAttribute:function(){return YM},callAndCheck:function(){return RM},canBeRepresented:function(){return FM},createFragmentShader:function(){return MM},createFramebuffer:function(){return XM},createProgram:function(){return WM},createStaticIndexBuffer:function(){return jM},createStaticVertexBuffer:function(){return GM},createTexture:function(){return qM},createVertexShader:function(){return OM},getBatchDim:function(){return cz},getExtensionOrThrow:function(){return ZM},getFramebufferErrorMessage:function(){return oz},getMaxTexturesInShader:function(){return yz},getNumChannels:function(){return HM},getProgramUniformLocation:function(){return ez},getProgramUniformLocationOrThrow:function(){return $M},getRowsCols:function(){return lz},getShapeAs3D:function(){return pz},getTextureShapeFromLogicalShape:function(){return dz},getWebGLDisjointQueryTimerVersion:function(){return bz},getWebGLErrorMessage:function(){return DM},getWebGLMaxTextureSize:function(){return mz},hasExtension:function(){return xz},isCapableOfRenderingToFloatTexture:function(){return wz},isDownloadFloatTextureEnabled:function(){return Sz},isReshapeFree:function(){return hz},isWebGLFenceEnabled:function(){return Nz},isWebGLVersionEnabled:function(){return kz},linkProgram:function(){return VM},logShaderSourceAndInfoLog:function(){return BM},resetMaxTextureSize:function(){return vz},resetMaxTexturesInShader:function(){return gz},unbindColorTextureFromFramebuffer:function(){return az},unbindTextureUnit:function(){return JM},validateFramebuffer:function(){return iz},validateProgram:function(){return UM},validateTextureSize:function(){return KM}});var xM,kM,wM,SM={},IM={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function NM(e,t){SM[e]=t}function TM(e,t){if(!(e in SM)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete SM[e]}),!1),1===e?n.getContext("webgl",IM)||n.getContext("experimental-webgl",IM):n.getContext("webgl2",IM)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;SM[e]=n}var r=SM[e];return null==r||r.isContextLost()?(delete SM[e],TM(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),SM[e])}function CM(e,t){return[t,e]}function EM(e){var t=Fa.sizeFromShape(e),n=Math.ceil(t/4);return Fa.sizeToSquarishShape(n)}function _M(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function AM(e,t){var n,r,a,i,o,s,u,c,l,p,d=e;return 2===rt().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,a=d.RGBA16F,i=d.RGBA32F,o=d.RED,u=4,c=1,l=d.HALF_FLOAT,p=d.FLOAT,s=d.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=d.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:p}}function RM(e,t){var n=t();return rt().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+DM(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(xM||(xM={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(kM||(kM={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(wM||(wM={}));function FM(e){return!!(rt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function DM(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}function ZM(e,t){return sz(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function OM(e,t){var n=sz(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(RM(e,(function(){return e.shaderSource(n,t)})),RM(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function MM(e,t){var n=sz(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(RM(e,(function(){return e.shaderSource(n,t)})),RM(e,(function(){return e.compileShader(n)})),rt().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw BM(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var zM,LM,PM=/ERROR: [0-9]+:([0-9]+):/g;function BM(e,t){var n=PM.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return Fa.rightPad((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),p=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(Fa.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function WM(e){return sz(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function VM(e,t){if(RM(e,(function(){return e.linkProgram(t)})),!rt().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function UM(e,t){if(RM(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function GM(e,t){var n=sz(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return RM(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),RM(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function jM(e,t){var n=sz(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return RM(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),RM(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function HM(){return 2===rt().getNumber("WEBGL_VERSION")?1:4}function qM(e){return sz(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function KM(e,t){var n=rt().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}function XM(e){return sz(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function YM(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(RM(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),RM(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),RM(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function QM(e,t,n){uz(e,n),RM(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),RM(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function JM(e,t){uz(e,t),RM(e,(function(){return e.activeTexture(e.TEXTURE0+t)})),RM(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function $M(e,t,n){return sz(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function ez(e,t,n){return e.getUniformLocation(t,n)}function tz(e,t,n,r){RM(e,(function(){return QM(e,t,r)})),RM(e,(function(){return e.uniform1i(n,r)}))}function nz(e){RM(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),RM(e,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),RM(e,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))}function rz(e,t,n){RM(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),RM(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function az(e,t){RM(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),RM(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function iz(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+oz(e,t))}function oz(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}function sz(e,t,n){var r=RM(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function uz(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function cz(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Fa.sizeFromShape(e.slice(0,e.length-t))}function lz(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function pz(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[cz(e)].concat((0,h.Z)(lz(e)))),t}function dz(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=rt().getNumber("WEBGL_MAX_TEXTURE_SIZE");t&&(n*=2,e=e.map((function(t,n){return n>=e.length-2?Fa.nearestLargerEven(e[n]):e[n]})),1===e.length&&(e=[2,e[0]])),2!==e.length&&(e=Fa.squeezeShape(e).newShape);var r=Fa.sizeFromShape(e);if(e.length<=1&&r<=n)return[1,r];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var a,i,o=cz(e),s=2,u=2;return e.length&&(a=lz(e),s=(i=(0,m.Z)(a,2))[0],u=i[1]),r=o*(s/2)*(u/2),Fa.sizeToSquarishShape(r).map((function(e){return 2*e}))}return Fa.sizeToSquarishShape(r)}function fz(e){return e%2===0}function hz(e,t){if(e=e.slice(-2),t=t.slice(-2),Fa.arraysEqual(e,t)||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||fz(n)&&fz(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&fz(e[0])&&fz(t[0])}function mz(e){if(null==zM){var t=TM(e);zM=t.getParameter(t.MAX_TEXTURE_SIZE)}return zM}function vz(){zM=null}function gz(){LM=null}function yz(e){if(null==LM){var t=TM(e);LM=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,LM)}function bz(e){if(0===e)return 0;var t=TM(e);return xz(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:xz(t,"EXT_disjoint_timer_query")?1:0}function xz(e,t){return null!=e.getExtension(t)}function kz(e){try{if(null!=TM(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function wz(e){if(0===e)return!1;var t=TM(e);if(1===e){if(!xz(t,"OES_texture_float"))return!1}else if(!xz(t,"EXT_color_buffer_float"))return!1;return Iz(t)}function Sz(e){if(0===e)return!1;var t=TM(e);if(1!==e){if(xz(t,"EXT_color_buffer_float"))return Iz(t);var n="EXT_color_buffer_half_float";if(xz(t,n)){var r=t.getExtension(n);return function(e,t){var n=AM(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!(!xz(t,"OES_texture_float")||!xz(t,"WEBGL_color_buffer_float"))&&Iz(t)}function Iz(e){var t=AM(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function Nz(e){return 2===e&&null!=TM(e).fenceSync}function Tz(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Fa.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")}))}))}var Cz=rt();function Ez(){var e,t,n,r,a,i,o,s,u,c;return 2===rt().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function _z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Fa.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function Az(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Fa.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function Rz(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}function Fz(e){var t=Fa.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}Cz.registerFlag("HAS_WEBGL",(function(){return Cz.getNumber("WEBGL_VERSION")>0})),Cz.registerFlag("WEBGL_VERSION",(function(){return kz(2)?2:kz(1)?1:0})),Cz.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),Cz.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Cz.get("WEBGL_VERSION")})),Cz.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Cz.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Cz.registerFlag("WEBGL_PACK",(function(){return Cz.getBool("HAS_WEBGL")})),Cz.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_PACK_CLIP",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_PACK_REDUCE",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_CONV_IM2COL",(function(){return Cz.getBool("WEBGL_PACK")})),Cz.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return mz(Cz.getNumber("WEBGL_VERSION"))})),Cz.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return yz(Cz.getNumber("WEBGL_VERSION"))})),Cz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Cz.getNumber("WEBGL_VERSION");return 0===e?0:bz(e)})),Cz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Cz.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Pi.isMobile()})),Cz.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return wz(Cz.getNumber("WEBGL_VERSION"))})),Cz.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Cz.getBool("WEBGL_FORCE_F16_TEXTURES")&&Cz.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Cz.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Sz(Cz.getNumber("WEBGL_VERSION"))})),Cz.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Nz(Cz.getNumber("WEBGL_VERSION"))})),Cz.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Cz.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),Cz.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),Cz.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return Pi.isMobile()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))})),Cz.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),Cz.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),Cz.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),Cz.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128}));var Dz="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",Zz=sm.getBroadcastDims;function Oz(e,t,n){var r=[];if(e.forEach((function(e){var t=Fa.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(eL(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?zz(e,r):Mz(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;return i.length<=o.length&&(a+=n?Qz(e,t):Jz(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=Ez(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(Lz,"\n    ").concat(Pz,"\n    ").concat(Bz,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    "):1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Fa.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){return Fa.arraysEqual(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(Az(["r","c","d"],e),"\n    return ivec3(r, c, d);\n  }\n");var r=_z(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(Az(["r","c","d","d2"],e),"\n      return ivec4(r, c, d, d2);\n    }\n  ");var r=_z(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=_z(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=_z(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(p+=Wz),[p,l,i,o,a,s,n.userCode].join("\n")}function Mz(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return Uz(e,t);case 1:return Gz(e,t);case 2:return jz(e,t);case 3:return Hz(e,t);case 4:return qz(e,t);case 5:return Kz(e);case 6:return Xz(e);default:throw new Error("".concat(n.length,"-D input sampling is not yet supported"))}}function zz(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Ez();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=Ez();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=Ez();if(null!=i&&Fa.arraysEqual(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=tL(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(zz(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(nL(c,s),");\n        }\n      ")}var l=Ez();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var p=o[0],d=o[1],f=Math.ceil(n[2]/2),h=f*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(p,", ").concat(d,", ").concat(h,", ").concat(f,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Ez();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],p=Math.ceil(i[o-1]/2),d=p*Math.ceil(i[o-2]/2),f="int b, int row, int col",h="b * ".concat(d," + (row / 2) * ").concat(p," + (col / 2)"),m=2;m<o-1;m++)f="int b".concat(m,", ")+f,d*=i[o-m-1],h="b".concat(m," * ").concat(d," + ")+h;return"\n    vec4 ".concat(r,"(").concat(f,") {\n      int index = ").concat(h,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var Lz="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Pz="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Bz="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Wz="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Vz(e){return"offset".concat(e)}function Uz(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=(0,m.Z)(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Vz(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=(0,m.Z)(e.shapeInfo.texShape,2),c=u[0],l=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(c,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function Gz(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(Yz(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Vz(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function jz(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Fa.arraysEqual(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=Fa.squeezeShape(n),c=u.newShape,l=u.keptDims,p=c;if(p.length<n.length){o=tL(e,p),s=["row","col"];return"\n      ".concat(Mz(o,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(nL(s,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(Yz(e),"\n      }\n    ");var d=i[0],f=i[1],h=Vz(r);return 1===f?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(d,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===d?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(f,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(h,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(h,";\n    vec2 uv = uvFromFlat(").concat(d,", ").concat(f,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}function Hz(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=Fa.squeezeShape(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var p=tL(e,l);return"\n        ".concat(Mz(p,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(nL(["row","col","depth"],c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(Yz(e),"\n      }\n    ");var d=e.shapeInfo.texShape,f=d[0],h=d[1],m=e.shapeInfo.flatOffset;if(h===i&&null==m)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(h,".0, ").concat(f,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(h===o&&null==m)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(h,".0, ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var v=Vz(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(v,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(f,", ").concat(h,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}function qz(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=Fa.squeezeShape(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var p=tL(e,c);return"\n      ".concat(Mz(p,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(nL(["row","col","depth","depth2"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(Yz(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],m=f[1],v="int stride2 = ".concat(r,"Shape[3];"),g="int stride1 = ".concat(r,"Shape[2] * stride2;"),y="int stride0 = ".concat(r,"Shape[1] * stride1;");if(m===s&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(v,"\n        ").concat(g,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(h,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(m===i&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(h,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var b=Vz(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(v,"\n      ").concat(g,"\n      ").concat(y,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(b,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index + ").concat(b,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}function Kz(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=Fa.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var p=tL(e,c);return"\n      ".concat(Mz(p),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(nL(["row","col","depth","depth2","depth3"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(Yz(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],m=f[1];if(m===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(m===a&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var v=Vz(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(v,";\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function Xz(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Fa.squeezeShape(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=tL(e,i);return"\n      ".concat(Mz(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(nL(["row","col","depth","depth2","depth3","depth4"],o),");\n      }\n    ")}var u=t[5],c=t[4]*u,l=t[3]*c,p=t[2]*l,d=t[1]*p;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(d,", ").concat(p,", ").concat(l,", ").concat(c,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(u,", 1)));\n        ").concat(Yz(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,m=h[0],v=h[1];if(v===d&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(p,", ").concat(l,", ").concat(c,", ").concat(u,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===u&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=Vz(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(d," + col * ").concat(p," + depth * ").concat(l," +\n          depth2 * ").concat(c," + depth3 * ").concat(u," + depth4 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function Yz(e){var t=e.name,n=Fa.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Qz(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=Zz(e.shapeInfo.logicalShape,t.logicalShape),c=$z(s),l=s-o,p=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(p[e+l]," = 0;")})).join("\n");var d="";d=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(p[t+l])})).join(", ");var f="return outputValue;",h=1===Fa.sizeFromShape(e.shapeInfo.logicalShape),m=1===Fa.sizeFromShape(t.logicalShape);if(1!==o||h||m){if(h&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var v=o-2,g=o-1;u.indexOf(v)>-1&&u.indexOf(g)>-1?f="return vec4(outputValue.x);":u.indexOf(v)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(d,");\n      ").concat(f,"\n    }\n  ")}function Jz(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Fa.arraysEqual(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=$z(u),p=Zz(e.shapeInfo.logicalShape,t.logicalShape),d=u-s,f=["x","y","z","w","u","v"];c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords.".concat(f[e+d]," = 0;")})).join("\n");var h="";return h=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(f[t+d])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(h,");\n    }\n  ")}function $z(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function eL(e,t,n){var r=Fa.squeezeShape(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!Fa.arraysEqual(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function tL(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function nL(e,t){return t.map((function(t){return e[t]})).join(", ")}function rL(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=Oz(a,o,t),u=MM(e.gl,s),c=e.createProgram(u);return rt().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},aL(e,t,c))}function aL(e,t,n){var r,a,i,o,s={},u={},c={},l=[],p=null;o=e.getUniformLocation(n,"NAN",!1),1===rt().getNumber("WEBGL_VERSION")&&(p=e.getUniformLocation(n,"INFINITY",!1));for(var d=!1,f=0;f<t.variableNames.length;f++){var h=t.variableNames[f];s[h]=e.getUniformLocation(n,h,d),s["offset".concat(h)]=e.getUniformLocation(n,"offset".concat(h),d),t.enableShapeUniforms&&(u["".concat(h,"Shape")]=e.getUniformLocation(n,"".concat(h,"Shape"),d),c["".concat(h,"TexShape")]=e.getUniformLocation(n,"".concat(h,"TexShape"),d))}return t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",d),i=e.getUniformLocation(n,"outShapeStrides",d),a=e.getUniformLocation(n,"outTexShape",d)),t.customUniforms&&t.customUniforms.forEach((function(t,r){l[r]=e.getUniformLocation(n,t.name,d)})),{uniformLocations:s,customUniformLocations:l,infLoc:p,nanLoc:o,inShapesLocations:u,inTexShapesLocations:c,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function iL(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!Fa.arraysEqual(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Fa.arraysEqual(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function oL(e,t,n,r,a){t.program.enableShapeUniforms||(iL(t.inShapeInfos,n),iL([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),1===rt().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)],s=t.inShapesLocations["".concat(a,"Shape")],u=t.inTexShapesLocations["".concat(a,"TexShape")];if(s){var c=eL(t.program.packedInputs,n.shape,n.texData.texShape).uniformShape;switch(c.length){case 1:e.gl.uniform1iv(s,new Int32Array(c));break;case 2:e.gl.uniform2iv(s,new Int32Array(c));break;case 3:e.gl.uniform3iv(s,new Int32Array(c));break;case 4:e.gl.uniform4iv(s,new Int32Array(c))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=i){if(n.isUniform){if(Fa.sizeFromShape(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var l=n.uniformValues;l instanceof Float32Array||(l=new Float32Array(l)),e.gl.uniform1fv(i,l)}return}null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,i,r)}}));var s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var u=Fa.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach((function(n,r){var i=t.customUniformLocations[r],o=a[r];if("float"===n.type)e.gl.uniform1fv(i,o);else if("vec2"===n.type)e.gl.uniform2fv(i,o);else if("vec3"===n.type)e.gl.uniform3fv(i,o);else if("vec4"===n.type)e.gl.uniform4fv(i,o);else if("int"===n.type)e.gl.uniform1iv(i,o);else if("ivec2"===n.type)e.gl.uniform2iv(i,o);else if("ivec3"===n.type)e.gl.uniform3iv(i,o);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(i,o)}})),e.executeProgram()}function sL(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=eL(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",p="",d="";if(1===u.length&&e.packedInputs){var f=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(f[0]>1,"_").concat(f[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var h=Fa.computeStrides(u);d="".concat(h[0]===i[1],"_").concat(h[h.length-1]===i[1])}}else p="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,v=2===u.length&&Fa.arraysEqual(t.shape,i),g=1===Fa.sizeFromShape(t.shape),y=sm.getBroadcastDims(t.shape,n.shape),b=!e.packedInputs&&m===n.shape.length&&Fa.arraysEqual(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(m,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(v,"_").concat(l,"_").concat(p,"_").concat(d,"_").concat(x,"_").concat(a)}else{var k=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(k,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+="_"+r+"_"+a+"".concat(rt().getNumber("WEBGL_VERSION"))}function uL(e){return rt().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var cL=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=xM.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Ez();this.outputShape=t,this.enableShapeUniforms=uL(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Az(["r","c","d"],t):_z(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),lL=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=xM.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Ez();this.outputShape=t,this.enableShapeUniforms=uL(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Az(["r","c","d"],t):_z(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),pL=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["A"],this.outTexUsage=kM.DOWNLOAD;var n=Ez();this.outputShape=t,this.userCode="\n      ".concat(Dz,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),dL=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=kM.DOWNLOAD;var n=Ez();this.outputShape=t,this.userCode="\n      ".concat(Dz,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),fL=(0,b.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,y.Z)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=Ez();this.outputShape=t,this.enableShapeUniforms=uL(this.outputShape.length);var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Fz(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")})),hL=(0,b.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=Ez();this.outputShape=t,this.enableShapeUniforms=uL(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Fz(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")})),mL={};function vL(e){var t=Ez();return OM(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function gL(e){return GM(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function yL(e){return jM(e,new Uint16Array([0,1,2,2,1,3]))}function bL(e,t,n,r,a,i){KM(t,n);var o=qM(e),s=e.TEXTURE_2D;return RM(e,(function(){return e.bindTexture(s,o)})),RM(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),RM(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),RM(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),RM(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===rt().getNumber("WEBGL_VERSION")?RM(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):RM(e,(function(){return e.texStorage2D(s,1,r,t,n)})),RM(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function xL(e){return e.internalFormatFloat}function kL(e,t,n,r){var a=CM(t,n),i=(0,m.Z)(a,2);return bL(e,i[0],i[1],xL(r),r.textureFormatFloat,e.FLOAT)}function wL(e){return e.internalFormatHalfFloat}function SL(e,t,n,r){var a=CM(t,n),i=(0,m.Z)(a,2);return bL(e,i[0],i[1],wL(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function IL(e){return e.downloadTextureFormat}function NL(e,t,n,r){var a=CM(t,n),i=(0,m.Z)(a,2);return bL(e,i[0],i[1],IL(r),e.RGBA,e.UNSIGNED_BYTE)}function TL(e){return e.internalFormatPackedFloat}function CL(e,t,n,r){var a=_M(t,n),i=(0,m.Z)(a,2);return bL(e,i[0],i[1],TL(r),e.RGBA,e.FLOAT)}function EL(e){return e.internalFormatPackedHalfFloat}function _L(e,t,n,r){var a=_M(t,n),i=(0,m.Z)(a,2);return bL(e,i[0],i[1],EL(r),e.RGBA,r.textureTypeHalfFloat)}function AL(e,t,n){return RM(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),YM(e,t,"clipSpacePos",n,3,20,0)&&YM(e,t,"uv",n,2,20,12)}function RL(e,t,n,r,a,i){var o,s,u;RM(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===rt().getNumber("WEBGL_VERSION")?RM(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):RM(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),RM(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function FL(e,t,n){RM(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===rt().getNumber("WEBGL_VERSION")?RM(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):RM(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===rt().getNumber("WEBGL_VERSION")?RM(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):RM(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),RM(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function DL(e,t,n,r){var a=e.createBuffer();RM(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return RM(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),RM(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),RM(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function ZL(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function OL(e,t,n,r){var a=CM(t,n),i=(0,m.Z)(a,2),o=i[0],s=i[1],u=new Uint8Array(function(e,t){return e*t}(t*n,4));return RM(e,(function(){return e.readPixels(0,0,o,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function ML(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=_M(e,t),r=(0,m.Z)(n,2);return r[0]*r[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function zL(e,t,n){var r=new Float32Array(t*n*4);return RM(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}D(mL,{bindVertexProgramAttributeStreams:function(){return AL},createBufferFromOutputTexture:function(){return DL},createFloat16MatrixTexture:function(){return SL},createFloat16PackedMatrixTexture:function(){return _L},createFloat32MatrixTexture:function(){return kL},createIndexBuffer:function(){return yL},createPackedMatrixTexture:function(){return CL},createUnsignedBytesMatrixTexture:function(){return NL},createVertexBuffer:function(){return gL},createVertexShader:function(){return vL},downloadByteEncodedFloatMatrixFromOutputTexture:function(){return OL},downloadFloat32MatrixFromBuffer:function(){return ZL},downloadMatrixFromPackedOutputTexture:function(){return zL},downloadPackedMatrixFromBuffer:function(){return ML},getInternalFormatForFloat16MatrixTexture:function(){return wL},getInternalFormatForFloat16PackedMatrixTexture:function(){return EL},getInternalFormatForFloat32MatrixTexture:function(){return xL},getInternalFormatForPackedMatrixTexture:function(){return TL},getInternalFormatForUnsignedBytesMatrixTexture:function(){return IL},uploadDenseMatrixToTexture:function(){return RL},uploadPixelDataToTexture:function(){return FL}});var LL=function(){function e(t){(0,y.Z)(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=rt().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,NM(n,t)):this.gl=TM(n);var r="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===rt().getNumber("WEBGL_VERSION")){var i="OES_texture_half_float";if(this.textureFloatExtension=ZM(this.gl,"OES_texture_float"),xz(this.gl,i))this.textureHalfFloatExtension=ZM(this.gl,i);else if(rt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),xz(this.gl,a))this.colorBufferHalfFloatExtension=ZM(this.gl,a);else if(rt().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",xz(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!xz(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=gL(this.gl),this.indexBuffer=yL(this.gl),this.framebuffer=XM(this.gl),this.textureConfig=AM(this.gl,this.textureHalfFloatExtension)}return(0,b.Z)(e,[{key:"debug",get:function(){return rt().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;RM(t,(function(){return t.finish()})),RM(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),RM(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),RM(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),RM(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),RM(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),kL(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),SL(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),NL(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),FL(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),RL(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),_L(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),CL(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(az(this.gl,this.framebuffer),this.outputTexture=null),RM(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return OL(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return ML(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return ZL(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=DL(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(rt().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return zL(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=vL(n));var r=WM(n);return RM(n,(function(){return n.attachShader(r,t.vertexShader)})),RM(n,(function(){return n.attachShader(r,e)})),VM(n,r),this.debug&&UM(n,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=AL(n,this.program,this.vertexBuffer)),r}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&RM(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&UM(this.gl,this.program),RM(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?$M(this.gl,e,t):ez(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),RM(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),tz(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=_M(t,n),a=(0,m.Z)(r,2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&UM(this.gl,this.program),iz(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),RM(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),RM(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=ZM(this.gl,2===rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fa.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)&&Fa.repeatedTry((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),rz(this.gl,e,this.framebuffer),this.debug&&iz(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(rz(this.gl,this.outputTexture,this.framebuffer),this.debug&&iz(this.gl)):az(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;rz(r,e,this.framebuffer),this.debug&&iz(r),this.outputTexture=e,RM(r,(function(){return r.viewport(0,0,t,n)})),RM(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),RM(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var PL=uA.addImpl,BL=uA.bincountImpl,WL=uA.bincountReduceImpl,VL=uA.ceilImpl,UL=uA.concatImpl,GL=uA.equalImpl,jL=uA.expImpl,HL=uA.expm1Impl,qL=uA.floorImpl,KL=uA.gatherNdImpl,XL=uA.gatherV2Impl,YL=uA.greaterImpl,QL=uA.greaterEqualImpl,JL=uA.lessImpl,$L=uA.lessEqualImpl,eP=uA.linSpaceImpl,tP=uA.logImpl,nP=uA.maxImpl,rP=uA.maximumImpl,aP=uA.minimumImpl,iP=uA.multiplyImpl,oP=uA.negImpl,sP=uA.notEqualImpl,uP=uA.prodImpl,cP=uA.rangeImpl,lP=uA.rsqrtImpl,pP=uA.scatterImpl,dP=uA.sigmoidImpl,fP=uA.simpleAbsImpl,hP=uA.sliceImpl,mP=uA.sparseFillEmptyRowsImpl,vP=uA.sparseReshapeImpl,gP=uA.sparseSegmentReductionImpl,yP=uA.sqrtImpl,bP=uA.stridedSliceImpl,xP=uA.stringNGramsImpl,kP=uA.stringSplitImpl,wP=uA.stringToHashBucketFastImpl,SP=uA.subImpl,IP=uA.tileImpl,NP=uA.topKImpl,TP=uA.transposeImpl,CP=uA.uniqueImpl;function EP(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function _P(e,t){return 1===t?[e]:EP(e,t)}var AP=function(){function e(t){if((0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=uL(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=_P("rc",this.rank),r=$z(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return(0,b.Z)(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);return 1===this.rank?"getA(rc), (rc + 1 >= ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]," ? 0. : getA(rc + 1)), 0, 0"):"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),RP=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=uL(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Rz(e.map((function(e,t){return t})),t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(r[a]),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(r[a]):"index -= ".concat(e[a]," * ").concat(r[a]);return"".concat(i,"; ").concat(o,";")})).join("")}(["r","c","d"],"inputShape"):_z(["r","c","d"],e),"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Fz(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var FP=function(){function e(t){(0,y.Z)(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return(0,b.Z)(e,[{key:"acquireTexture",value:function(e,t,n){var r=ZP(t,n),a=OP(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=DP(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===wM.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===wM.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===wM.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===wM.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===wM.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=ZP(n,r),i=OP(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=DP(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=rt().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function DP(e,t,n,r,a){var i,o=function(e,t){switch(e){case wM.PACKED_2X2_FLOAT32:return TL(t);case wM.PACKED_2X2_FLOAT16:return EL(t);case wM.UNPACKED_FLOAT32:return xL(t);case wM.UNPACKED_FLOAT16:return wL(t);case wM.PACKED_4X1_UNSIGNED_BYTE:return IL(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=_M(e[0],e[1]),u=(0,m.Z)(s,2);i=u[0]*u[1]}else{var c=CM(e[0],e[1]),l=(0,m.Z)(c,2);i=l[0]*l[1]}var p=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F||t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*p}function ZP(e,t){if(e===kM.UPLOAD)return wM.PACKED_2X2_FLOAT32;if(e===kM.RENDER||null==e)return function(e){return rt().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?wM.PACKED_2X2_FLOAT32:wM.UNPACKED_FLOAT32:e?wM.PACKED_2X2_FLOAT16:wM.UNPACKED_FLOAT16}(t);if(e===kM.DOWNLOAD||e===kM.PIXELS)return wM.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function OP(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var MP=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=uL(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),zP="if (isnan(x)) return x;",LP="return x;",PP="return abs(x);",BP="return (x >= 0.0) ? x : (exp(x) - 1.0);",WP=zP+"\n  return (x < 0.0) ? 0.0 : x;\n",VP=zP+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",UP="return x;",GP="return 1.0 / (1.0 + exp(-1.0 * x));",jP="return x;",HP="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",qP="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",KP="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",XP="return 1.0 / (1.0 + exp(-1.0 * x));",YP=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=uL(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),QP=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=uL(this.outputShape.length);var n=t.length,r=_P("rc",n),a=$z(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),JP=sv.whereImpl,$P={};var eB=rt().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var tB=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,a;if((0,y.Z)(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!rt().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof LL)a=e;else{var i=TM(rt().getNumber("WEBGL_VERSION"),e);a=new LL(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var o=TM(rt().getNumber("WEBGL_VERSION"));a=new LL(o),r.binaryCache=function(e){return e in $P||($P[e]={}),$P[e]}(rt().getNumber("WEBGL_VERSION")),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new FP(r.gpgpu),r.numMBBeforeWarning=null==rt().global.screen?1024:rt().global.screen.height*rt().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new ne((0,u.Z)(r),Gs()),(0,l.Z)(r)}return(0,b.Z)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((rt().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||rt().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:kM.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(rt().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:kM.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new YP(o,UP):new MP(o,UP);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var p,d,f=null!=this.activeTimers;if(f&&(p=Fa.now()),"complex64"===r){var h=this.readSync(a.real.dataId),m=this.readSync(a.imag.dataId);d=sm.mergeRealAndImagArrays(h,m)}else d=this.getValuesFromTexture(e);return f&&(this.downloadWaitMs+=Fa.now()-p),this.convertAndCacheOnCPU(e,d)}},{key:"read",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,d,f,m,g,y,b,x,k,w,S,I,N;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=8;break}return n=c?new YP(i,UP):new MP(i,UP),l=this.runWebGLProgram(n,[{dataId:t,shape:i,dtype:s}],s),p=this.read(l.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(l),p));case 8:if(null==a){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(!rt().getBool("DEBUG")||rt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==rt().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(d=null,"complex64"!==s&&rt().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(t),g=this.texData.get(f.dataId),d=(m=this.gpgpu).createBufferFromTexture.apply(m,[g.texture.texture].concat((0,h.Z)(EM(i))))),this.pendingRead.set(t,[]),e.t0="complex64"!==s,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==s){e.next=28;break}return e.next=22,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 22:b=e.sent,x=b[0],k=b[1],y=sm.mergeRealAndImagArrays(x,k),e.next=29;break;case 28:null==d?y=this.getValuesFromTexture(t):(w=Fa.sizeFromShape(i),y=this.gpgpu.downloadFloat32MatrixFromBuffer(d,w));case 29:return null!=f&&this.disposeIntermediateTensorInfo(f),null!=d&&RM(S=this.gpgpu.gl,(function(){return S.deleteBuffer(d)})),I=this.convertAndCacheOnCPU(t,y),N=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),N.forEach((function(e){return e(I)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Gs().removeDataId(t,this),this.pendingDeletes--),I));case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new YP(a,UP):new MP(a,UP);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),p=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),p}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(e,t.customTexShape),f=Gs().makeTensorFromTensorInfo(d),h=this.texData.get(d.dataId);return Object.assign({tensorRef:f},h.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Fa.decodeString(e)}));return us(e.shape,e.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return us(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!FM(n))throw rt().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'")):Error("The value ".concat(n," cannot be represented on this device."))}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=Fa.sizeFromShape(n);if(rt().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat((0,h.Z)(EM(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=rt().getBool("WEBGL_PACK")&&!0===a,p=l?pz(n):n,d=l?new dL(p):new pL(p),f=this.runWebGLProgram(d,[{shape:p,dtype:r,dataId:e}],"float32"),m=this.texData.get(f.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(f),v}},{key:"timerAvailable",value:function(){return rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=Fa.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=Fa.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(0,g.Z)((0,v.Z)().mark((function e(){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=7;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=Fa.sum(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=8;break;case 7:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 8:return e.abrupt("return",(t.uploadWaitMs=0,t.downloadWaitMs=0,s));case 9:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Fa.now(),endMs:null}}},{key:"endTimer",value:function(e){return rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Fa.now(),e)}},{key:"getQueryTime",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(rt().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e),r=n.complexTensorInfos;return null!=r&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eB;return rt().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&Fa.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){sm.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return JP(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new YP(e.shape,t),a=this.compileAndRun(r,[e],n);return Gs().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=fP(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(rt().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,PP,e.dtype);var n=new MP(e.shape,PP),r=this.compileAndRun(n,[e]);return Gs().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Fa.isString(n[0])){var a=n.map((function(e){return Fa.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return Gs().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new QP(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new AP(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[cz(e.shape)].concat((0,h.Z)(lz(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[cz(t)].concat((0,h.Z)(lz(t))),i=new RP(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;if(null!=t){var o=Fa.sizeFromShape(a),s=t[0]*t[1]*4;Fa.assert(o<=s,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}))}var u,c=pz(a);u=r?new lL(c):new cL(c);var l=[null!=t?t:EM(c)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(u,[{shape:c,dtype:i,dataId:e}],i,l,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===xM.DENSE){var c=null!=o?o:EM(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===Fa.sizeFromShape(s.shape))return u.values=Fa.getTypedArrayFromDType(s.dtype,0),s;var l=[],p=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Fa.sizeFromShape(t.shape)<=rt().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!hz(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var d,f={shape:s.shape,texData:u,isUniform:!1},h=sL(e,p,f),m=this.getAndSaveBinary(h,(function(){return rL(a.gpgpu,e,p,f)})),v=null!=this.activeTimers;v&&(d=this.startTimer()),rt().get("ENGINE_COMPILE_ONLY")||oL(this.gpgpu,m,p,f,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)}));var g=rt().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=Fa.now();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!rt().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(rt().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=qs((function(){if(!rt().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=rt().getBool("DEBUG");rt().set("DEBUG",!1);var n=e.abs(Xl(1e-8)).dataSync()[0];if(rt().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=Fa.now());var l=t.texShape;if(null==l&&(l=dz(n,s),t.texShape=l),null!=a){var p,d,f,h=pz(n),v=l[1],g=l[0],y=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(s||!y)&&(p=_M(l[0],l[1]),v=(d=(0,m.Z)(p,2))[0],g=d[1]),f=s?new hL(h,y):new fL(h,y);var b=y?[g,v]:l,x=this.makeTensorInfo(b,r),k=this.texData.get(x.dataId);k.usage=y?kM.PIXELS:kM.UPLOAD,k.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),v,g,a);var w=[[g,v]],S=this.runWebGLProgram(f,[x],r,w,!0),I=this.texData.get(S.dataId);t.texShape=I.texShape,t.isPacked=I.isPacked,t.usage=I.usage,rt().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(t.texture=I.texture,t.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(x),c&&(this.uploadWaitMs+=Fa.now()-u)}else{var N=this.acquireTexture(l,o,r,s);t.texture=N}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*Fa.bytesPerElement(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,m.Z)(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i,o,s,u,c=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=(0,m.Z)(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:for(o=function(){var e=(0,m.Z)(u[s],2)[1],n=new Promise((function(t){try{c.checkCompletion_(e),t(!0)}catch(NQ){throw NQ}}));t.push(n)},s=0,u=Object.entries(this.binaryCache);s<u.length;s++)o();return e.abrupt("return",Promise.all(t));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}e.t0=this.checkCompletion_(t),e.next=7;break;case 4:return e.next=6,om();case 6:e.t0=this.checkCompletionAsync_(t);case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS))throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)?(BM(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,m.Z)(t[e],2)[1],r=aL(this.gpgpu,n.program,n.webGLProgram),a=r.uniformLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.inShapesLocations,c=r.inTexShapesLocations,l=r.outShapeLocation,p=r.outShapeStridesLocation,d=r.outTexShapeLocation;n.uniformLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.inShapesLocations=u,n.inTexShapesLocations=c,n.outShapeLocation=l,n.outShapeStridesLocation=p,n.outTexShapeLocation=d}}}]),n}(re);tB.nextDataId=0;var nB="3.19.0";function rB(){rt().set("WEBGL_FORCE_F16_TEXTURES",!0)}Pi.isBrowser()&&ru("webgl",(function(){return new tB}),2);var aB={forceHalfFloat:rB},iB=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["A","B"],this.outputShape=sm.assertAndGetBroadcastShape(n,r),this.enableShapeUniforms=uL(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),oB=(0,b.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,y.Z)(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=sm.assertAndGetBroadcastShape(n,r);var i=this.outputShape.length;this.enableShapeUniforms=uL(i);var o="";if(a)if(0===i||1===Fa.sizeFromShape(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat($z(i)," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var s=_P("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function sB(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var uB={kernelName:Sn,backendName:"webgl",kernelFunc:sB};function cB(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=sB({inputs:{x:r},backend:n}),u=sB({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var lB={kernelName:Zt,backendName:"webgl",kernelFunc:cB},pB="return (a < 0.) ? b * a : a;",dB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var fB={kernelName:_n,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",Fa.createScalarValue(i,"float32")),s=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oB(dB,a.shape,o.shape):new iB(pB,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},hB="return (a < 0.) ? b * a : a;",mB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var vB={kernelName:hr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oB(mB,r.shape,a.shape):new iB(hB,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}};function gB(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var p=c.texData.get(u.dataId),d=r(p.values,l);return c.makeTensorInfo(u.shape,l,d)}return i=rt().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new YP(u.shape,n):new MP(u.shape,t),c.runWebGLProgram(i,[u],l)}}function yB(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,p=i;if(o&&"complex64"===c.dtype){var d=p.texData.get(c.dataId),f=p.texData.get(l.dataId),h=[[d.complexTensorInfos.real,f.complexTensorInfos.real],[d.complexTensorInfos.imag,f.complexTensorInfos.imag]].map((function(e){var n=(0,m.Z)(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new iB(t,c.shape,l.shape);return p.runWebGLProgram(s,[i,o],Ii(r.dtype,a.dtype))})),v=(0,m.Z)(h,2),g=v[0],y=v[1],b=cB({inputs:{real:g,imag:y},backend:p});return p.disposeIntermediateTensorInfo(g),p.disposeIntermediateTensorInfo(y),b}var x,k=u||Ii(c.dtype,l.dtype);if(("string"===c.dtype||"string"===l.dtype||p.shouldExecuteOnCPU([c,l]))&&null!=s){var w=p.texData.get(c.dataId).values,S=p.texData.get(l.dataId).values,I="string"===c.dtype?sm.fromUint8ToStringArray(w):w,N="string"===c.dtype?sm.fromUint8ToStringArray(S):S,T=s(c.shape,l.shape,I,N,k),C=(0,m.Z)(T,2),E=C[0],_=C[1],A=p.makeTensorInfo(_,k);return p.texData.get(A.dataId).values=E,A}return x=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new oB(n,c.shape,l.shape,a):new iB(t,c.shape,l.shape),p.runWebGLProgram(x,[c,l],k)}}function bB(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?jP:LP;if("relu"===e)return t?qP:WP;if("elu"===e)return t?HP:BP;if("relu6"===e)return t?KP:VP;if("prelu"===e)return t?mB:hB;if("leakyrelu"===e)return t?dB:pB;if("sigmoid"===e)return t?XP:GP;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var xB=(0,b.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];(0,y.Z)(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=uL(this.outputShape.length);var l=a?t[1]:t[2],p=Math.ceil(l/2),d=a?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",h=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var x="rc.x",k="rc.x";t[0]<n[0]?x="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(k="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(p,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(p,"; i++) {\n          int batchA = ").concat(x,";\n          int batchB = ").concat(k,";\n          vec4 a = getMatrixA(batchA, ").concat(d,");\n          vec4 b = getMatrixB(batchB, ").concat(f,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(h[0]," * ").concat(m[0],");\n          result += (").concat(h[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(b,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),kB="return areal * breal - aimag * bimag;",wB="return areal * bimag + aimag * breal;",SB=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=sm.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),IB="return a * b;";function NB(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=sm.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new SB(kB,a.shape,i.shape),l=new SB(wB,a.shape,i.shape),p=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],d=r.runWebGLProgram(c,p,"float32"),f=r.runWebGLProgram(l,p,"float32"),h=cB({inputs:{real:d,imag:f},backend:r});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(f),h}if(r.shouldExecuteOnCPU([a,i])){var v=r.texData.get(a.dataId),g=r.texData.get(i.dataId),y=iP(a.shape,i.shape,v.values,g.values,o),b=(0,m.Z)(y,2),x=b[0],k=b[1],w=r.makeTensorInfo(k,o);return r.texData.get(w.dataId).values=x,w}return t=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oB(IB,a.shape,i.shape):new iB(IB,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var TB={kernelName:nr,backendName:"webgl",kernelFunc:NB};function CB(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=Fa.sizeFromShape(a.shape),u=Fa.inferFromImplicitShape(i,s),c=Fa.sizeFromShape(u);Fa.assert(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old shape (").concat(a.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")}));var l=o.texData.get(a.dataId);return!l.isPacked||hz(a.shape,u)||null!==l.texture&&hz(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[cz(e.shape)].concat((0,h.Z)(lz(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[cz(t)].concat((0,h.Z)(lz(t))),o=new RP(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var EB={kernelName:xr,backendName:"webgl",kernelFunc:CB},_B=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(Fa.isInt(l)?l.toPrecision(2):l,", ones);")}var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),AB=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),p=r%4,d="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),f="vec4";"all"===n?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(d,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===p,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(2===p,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(3===p,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(d,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function RB(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=sm.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,p=u.outSize,d=void 0;d="mean"===n?0===o?new _B({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},c):new _B({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p}):new AB({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},n),s=i,i=r.runWebGLProgram(d,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var FB=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=$z(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var DB=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=$z(this.rank),o=EP("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),p="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(p,";\n      if(").concat(l,") {\n        result[1] = ").concat(p,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(p,";\n        if(").concat(l,") {\n          result[3] = ").concat(p,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function ZB(e,t,n){var r=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new DB(e.shape,t):new FB(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function OB(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=Fa.parseAxisParam(a,e.shape),s=o,u=sm.getAxesPermutation(s,i),c=null!=u,l=e;c&&(l=ZB(e,u,r),s=sm.getInnerMostAxes(s.length,i)),sm.assertAxesAreInnerMostDims("sum",s,i);var p=sm.computeOutAndReduceShapes(l.shape,s),d=(0,m.Z)(p,2),f=d[0],h=d[1],v=f;n&&(v=sm.expandShapeToKeepDim(f,o));var g=Fa.sizeFromShape(h),y=CB({inputs:{x:l},attrs:{shape:[Fa.sizeFromShape(e.shape)/g,g]},backend:r}),b=RB(y,Ni(e.dtype),"sum",r),x=CB({inputs:{x:b},attrs:{shape:v},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(b),c&&r.disposeIntermediateTensorInfo(l),x}(t.x,r.axis,r.keepDims,n)}var MB={kernelName:Br,backendName:"webgl",kernelFunc:OB};function zB(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var p=s.texData.get(i.dataId).values,d=TP(p,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=d}else t=ZB(i,o,s);return t}var LB={kernelName:sa,backendName:"webgl",kernelFunc:zB};function PB(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,d=e.activation,f=void 0===d?null:d,h=t.shape.length,m=n.shape.length,v=r?t.shape[h-2]:t.shape[h-1],g=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[h-1]:t.shape[h-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=Fa.sizeFromShape(x),S=Fa.sizeFromShape(k),I=pu.assertAndGetBroadcastShape(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);Fa.assert(v===g,(function(){return"Error in matMul: inner shapes (".concat(v,") and (").concat(g,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var N,T=r?[w,v,y]:[w,y,v],C=a?[S,b,g]:[S,g,b],E=CB({inputs:{x:t},backend:i,attrs:{shape:T}}),_=CB({inputs:{x:n},backend:i,attrs:{shape:C}}),A=[E,_],R=Math.max(w,S),F=r?E.shape[1]:E.shape[2],D=null!=s,Z=null!=c,O="leakyrelu"===f,M=null!=f?bB(f,!0):null;if((1===y||1===b)&&F>1e3&&!1===(D||Z||O||null!=M)){var z=E,L=_;r&&(z=zB({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),A.push(z)),a&&(L=zB({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),A.push(L));var P=1===b,B=z;1!==b&&(B=CB({inputs:{x:z},backend:i,attrs:{shape:[R,F,1]}}),A.push(B));var W=1===b?2:1,V=L;P&&(V=CB({inputs:{x:L},backend:i,attrs:{shape:[R,1,F]}}),A.push(V));var U=NB({inputs:{a:B,b:V},backend:i});N=OB({inputs:{x:U},backend:i,attrs:{axis:W,keepDims:!0}}),A.push(U)}else{var G=Ii(t.dtype,n.dtype),j=new xB(T,C,[R,y,b],r,a,D,M,Z,O),H=[E,_];if(null!=s&&H.push(s),Z&&H.push(c),O){var q=i.makeTensorInfo([],"float32",Fa.createScalarValue(p,"float32"));H.push(q),A.push(q)}N=i.runWebGLProgram(j,H,G)}var K=CB({inputs:{x:N},backend:i,attrs:{shape:I}});A.push(N);for(var X=0,Y=A;X<Y.length;X++){var Q=Y[X];i.disposeIntermediateTensorInfo(Q)}return K}var BB={kernelName:va,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return PB({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},WB="return abs(x);";var VB={kernelName:ut,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=fP(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=rt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new YP(a.shape,WB):new MP(a.shape,WB),r.runWebGLProgram(t,[a],a.dtype)}},UB=gB({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),GB={kernelName:ct,backendName:"webgl",kernelFunc:UB},jB=gB({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),HB={kernelName:lt,backendName:"webgl",kernelFunc:jB},qB="return a + b;",KB=yB({opSnippet:qB,packedOpSnippet:qB,supportsComplex:!0,cpuKernelImpl:PL}),XB={kernelName:pt,backendName:"webgl",kernelFunc:KB},YB=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),QB=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var JB={kernelName:dt,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return sB({inputs:{x:a[0]},backend:r});if(a.length>rt().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return Ii(e,t)})),c=a.map((function(e){return e.shape})),l=rt().getBool("WEBGL_PACK")?new QB(a[0].shape,c):new YB(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var $B={kernelName:ft,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Fa.parseAxisParam(i,a.shape),c=u,l=sm.getAxesPermutation(c,s),p=a;null!=l&&(p=zB({inputs:{x:a},backend:n,attrs:{perm:l}}),c=sm.getInnerMostAxes(c.length,s)),sm.assertAxesAreInnerMostDims("all",c,s);var d,f=sm.computeOutAndReduceShapes(p.shape,c),h=(0,m.Z)(f,2),v=h[0],g=h[1],y=CB({inputs:{x:p},backend:n,attrs:{shape:[-1,Fa.sizeFromShape(g)]}}),b=RB(y,y.dtype,"all",n);return d=CB(o?{inputs:{x:b},backend:n,attrs:{shape:sm.expandShapeToKeepDim(v,u)}}:{inputs:{x:b},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),null!=l&&n.disposeIntermediateTensorInfo(p),d}};var eW={kernelName:ht,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Fa.parseAxisParam(i,a.shape),c=u,l=sm.getAxesPermutation(c,s),p=a;null!=l&&(p=zB({inputs:{x:a},backend:n,attrs:{perm:l}}),c=sm.getInnerMostAxes(c.length,s)),sm.assertAxesAreInnerMostDims("any",c,s);var d,f=sm.computeOutAndReduceShapes(p.shape,c),h=(0,m.Z)(f,2),v=h[0],g=h[1],y=CB({inputs:{x:p},backend:n,attrs:{shape:[-1,Fa.sizeFromShape(g)]}}),b=RB(y,y.dtype,"any",n);return d=CB(o?{inputs:{x:b},backend:n,attrs:{shape:sm.expandShapeToKeepDim(v,u)}}:{inputs:{x:b},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),null!=l&&n.disposeIntermediateTensorInfo(p),d}},tW=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),nW=(0,b.Z)((function e(t,n,r,a){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Fa.assert(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,p=$z(l),d=_P("coords",l);if(1===o){var f=$z(u=l+1);s="\n        ".concat(f," sourceLocR = ").concat(f,"(").concat(d.join(),", 0);\n        ++").concat(d[l-1],";\n        ").concat(f," sourceLocG = ").concat(f,"(").concat(d.join(),", 0);\n        ++").concat(d[l-2],";\n        ").concat(f," sourceLocA = ").concat(f,"(").concat(d.join(),", 0);\n        --").concat(d[l-1],";\n        ").concat(f," sourceLocB = ").concat(f,"(").concat(d.join(),", 0);\n        --").concat(d[l-2],";")}else u=l,s="\n        ".concat(p," sourceLocR = coords;\n        ++").concat(d[l-1],";\n        ").concat(p," sourceLocG = coords;\n        ++").concat(d[l-2],";\n        ").concat(p," sourceLocA = coords;\n        --").concat(d[l-1],";\n        ").concat(p," sourceLocB = coords;\n        --").concat(d[l-2],";");var h=["x","y","z","w","u","v"].slice(0,u),m="."+h[u-1],v=h.map((function(e){return"int "+e})),g=_P("sourceLocR",u-1).concat("inIdx.r"),b=_P("sourceLocG",u-1).concat("inIdx.g"),x=_P("sourceLocB",u-1).concat("inIdx.b"),k=_P("sourceLocA",u-1).concat("inIdx.a"),w="max"===r?"greaterThan":"lessThan",S=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),"),\n                             getBestIndicesAChannel(").concat(k.join(),")));"),I="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(x.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(k.join(),") : 0.)"),N=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(h.join(),"),\n                                          vec2(").concat(h.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(h.join(),"),\n                               vec2(").concat(h.slice(-2).join(),"));\n      }\n      ").concat(N,"\n      void main() {\n        ").concat(p," coords = getOutputCoords();\n        bool hasNextCol = ").concat(d[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(d[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(I,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(S,"\n          vec4 candidate = ").concat(I,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(w,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function rW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=sm.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new tW(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var p=rW(e,t,n,l);return e.disposeIntermediateTensorInfo(l),p}function aW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=a[a.length-1],o=sm.computeOptimalWindowSize(i),s=new nW(a,o,n,null==r),u=null==r?[t]:[t,r],c=e.runWebGLProgram(s,u,"int32");if(c.shape.length===t.shape.length){var l=aW(e,t,n,c);return e.disposeIntermediateTensorInfo(c),l}return c}function iW(e,t,n,r){var a=[n];if(sm.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!rt().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=sm.computeOutAndReduceShapes(s.shape,a),c=(0,m.Z)(u,2),l=c[0],p=c[1],d=Fa.sizeFromShape(p),f=CB({inputs:{x:s},backend:e,attrs:{shape:[-1,d]}});i.push(f);var h=rW(e,f,r);i.push(h);var v=CB({inputs:{x:h},backend:e,attrs:{shape:l}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),v}return aW(e,t,r)}var oW={kernelName:mt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Fa.parseAxisParam(i,a.shape),s=sm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=zB({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=sm.getInnerMostAxes(o.length,u.shape.length)),sm.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=iW(n,u,o[0],"max");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}};var sW={kernelName:vt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Fa.parseAxisParam(i,a.shape),s=sm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=zB({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=sm.getInnerMostAxes(o.length,u.shape.length)),sm.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=iW(n,u,o[0],"min");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}},uW=gB({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),cW={kernelName:gt,backendName:"webgl",kernelFunc:uW},lW=gB({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),pW={kernelName:yt,backendName:"webgl",kernelFunc:lW},dW=gB({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),fW={kernelName:bt,backendName:"webgl",kernelFunc:dW},hW=yB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),mW={kernelName:kt,backendName:"webgl",kernelFunc:hW},vW=gB({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),gW={kernelName:xt,backendName:"webgl",kernelFunc:vW},yW=(0,b.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,y.Z)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),b="0.0";if(m||(b="-1.0 / 1e-20"),r){var x=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(f,", ").concat(h,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(x," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?v:g:"wR * ".concat(d," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var k="max",w="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(w="avgValue / count");var S=4*Math.floor(o/4),I=o%4,N="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(k,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(f,", ").concat(h,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(S,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(N,"\n          }\n\n          int xC = xCCorner + ").concat(S,";\n          if (").concat(1===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(N,"\n          } else if (").concat(2===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(N,"\n          } else if (").concat(3===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(N,"\n          }\n        }\n        setOutput(").concat(w,");\n      }\n    ")}})),bW=(0,b.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,y.Z)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,p=t.dilationHeight,d=t.dilationWidth,f=t.effectiveFilterDepth,h=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;var x="avg"===n,k="0.0";if(x||(k="-1.0 / 1e-20"),r){var w=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(b,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(f,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(h,";\n                wR += ").concat(p,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(d,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(w," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(h," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var S="max",I="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(I="avgValue / count");var N=4*Math.floor(o/4),T=o%4,C="\n      if (".concat(x,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(S,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(b,");\n      const float initializationValue = ").concat(k,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(k,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(f,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(p,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(N,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(d,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(d,", ch)\n              );\n\n              ").concat(C,"\n            }\n\n            int xC = xCCorner + ").concat(N,";\n            if (").concat(1===T,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(2===T,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(3===T,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                initializationValue\n              );\n\n              ").concat(C,"\n            }\n          }\n          setOutput(").concat(I,");\n        }\n      }\n    ")}}));var xW={kernelName:wt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Tz(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Fa.assert(sm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=sm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Fa.arraysEqual(c.inShape,c.outShape))return sB({inputs:{x:a},backend:n});var l=new yW(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var kW={kernelName:It,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=sm.computePool3DInfo(a.shape,i,o,[1,1,1],s,u,c),p=new bW(l,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}},wW=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,p=c-1-t.padInfo.left,d=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(p,");\n      const float avgMultiplier = float(").concat(d,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),SW=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=p-1-t.padInfo.front,m=d-1-t.padInfo.top,v=f-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(m,", ").concat(v,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var IW={kernelName:Nt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=sm.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),p=new SW(l);return n.runWebGLProgram(p,[a],i.dtype)}};var NW={kernelName:St,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Tz([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=sm.computePool2DInfo(o.shape,s,u,1,c),p=new wW(l);return n.runWebGLProgram(p,[a],o.dtype)}};var TW={kernelName:Tt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return PB({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},CW=(0,b.Z)((function e(t,n,r,a,i,o){(0,y.Z)(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],sm.assertAndGetBroadcastShape(t,n),sm.assertAndGetBroadcastShape(t,r);var s="0.0";null!=a&&(sm.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(sm.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),EW=(0,b.Z)((function e(t,n,r,a,i,o){(0,y.Z)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],sm.assertAndGetBroadcastShape(t,n),sm.assertAndGetBroadcastShape(t,r);var s="vec4(0.0)";null!=a&&(sm.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(sm.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),_W={kernelName:yn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;Fa.assert(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Fa.assert(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Fa.assert(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],p=null;null!=s&&(p=s.shape,l.push(s));var d=null;null!=u&&(d=u.shape,l.push(u));var f=rt().getBool("WEBGL_PACK_NORMALIZATION")?new EW(a.shape,i.shape,o.shape,p,d,c):new CW(a.shape,i.shape,o.shape,p,d,c);return n.runWebGLProgram(f,l,l[0].dtype)}},AW=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=$z(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return RW.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(RW[t]," = start[").concat(t,"] + coords.").concat(RW[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),RW=["x","y","z","w","u","v"];var FW=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=$z(this.rank),r=_P("coords",this.rank),a=_P("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function DW(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size,s=Ru.parseSliceParams(a,i,o),u=(0,m.Z)(s,2),c=u[0],l=u[1];if(Ru.assertParamsValid(a,c,l),0===Fa.sizeFromShape(l))return n.makeTensorInfo(l,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var p=n.texData.get(a.dataId),d=hP(p.values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,d)}var f=n.texData.get(a.dataId).isPacked,h=Ru.isSliceContinous(a.shape,c,l);if(f||!h){p=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new FW(l):new AW(l),d=[c];return n.runWebGLProgram(p,[a],a.dtype,d)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=Ru.computeFlatOffset(t,Fa.computeStrides(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,c,l,n)}var ZW={kernelName:Dr,backendName:"webgl",kernelFunc:DW},OW={kernelName:Ct,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;Fa.assert(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=sm.getReshaped(a.shape,i,s),c=sm.getPermuted(u.length,i.length),l=sm.getReshapedPermuted(a.shape,i,s),p=sm.getSliceBeginCoords(o,i.length),d=sm.getSliceSize(l,o,i.length),f=[],h=CB({inputs:{x:a},backend:n,attrs:{shape:u}}),m=zB({inputs:{x:h},backend:n,attrs:{perm:c}}),v=CB({inputs:{x:m},backend:n,attrs:{shape:l}}),g=DW({inputs:{x:v},backend:n,attrs:{begin:p,size:d}});return f.push(h),f.push(m),f.push(v),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var MW={kernelName:Et,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=BL(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var zW={kernelName:At,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=sm.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},LW=yB({opSnippet:"return float(a != b);",cpuKernelImpl:sP,dtype:"bool"}),PW={kernelName:ar,backendName:"webgl",kernelFunc:LW};function BW(e){var t=e.inputs,n=e.backend,r=t.input;return sB({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var WW={kernelName:gr,backendName:"webgl",kernelFunc:BW};var VW={kernelName:Rt,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return sB({inputs:{x:i},backend:r});var s=Hp(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=cB({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=BW({inputs:{input:i},backend:r}),p=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),p}if(!Fa.hasEncodingLoss(i.dtype,o)){var d=sB({inputs:{x:i},backend:r});return{dataId:d.dataId,shape:d.shape,dtype:o}}if("int32"===o)return function(e,t){var n=new MP(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var f=r.makeTensorInfo([],"bool",Fa.getTypedArrayFromDType("bool",1)),h=LW({inputs:{a:i,b:f},backend:r});return r.disposeIntermediateTensorInfo(f),h}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},UW="return ceil(x);",GW=gB({opSnippet:UW,packedOpSnippet:UW,cpuKernelImpl:VL}),jW={kernelName:Ft,backendName:"webgl",kernelFunc:GW},HW=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),qW=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var KW={kernelName:Dt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=rt().getBool("WEBGL_PACK_CLIP")?new qW(i.shape):new HW(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},XW=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function YW(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var QW={kernelName:Ot,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new XW(r.shape),o=[YW(r,a.complexTensorInfos.real),YW(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},JW=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.outputShape=[],this.outputShape=sm.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),$W=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=sm.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=$z(a),o=_P("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],p=s.slice(-2),d=s.join(),f="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(d,"), vec2(").concat(p.join(),"));\n        }"),h=1;h<u.length;h++){var m=u[h-1];f+="\n        if (".concat(l," < ").concat(u[h],"  && ").concat(l," >= ").concat(u[h-1],") {\n          return getChannel(\n            getT").concat(h,"(").concat(eV(s,l,m),"),\n            vec2(").concat(eV(p,l,m),"));\n        }")}var v=u.length,g=u[u.length-1];f+="\n        return getChannel(\n          getT".concat(v,"(").concat(eV(s,l,g),"),\n          vec2(").concat(eV(p,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(f,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function eV(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function tV(e){var t=e.inputs,n=e.backend,r=t.input;return sB({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var nV={kernelName:Nn,backendName:"webgl",kernelFunc:tV};function rV(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return BW({inputs:{input:e},backend:n})})),i=e.map((function(e){return tV({inputs:{input:e},backend:n})})),o=rV(a,t,n),s=rV(i,t,n),u=cB({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=Fa.sizeFromShape(e.shape.slice(t));return CB({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),p=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),d=sm.computeOutShape(l.map((function(e){return e.shape})),1),f=1===l[0].shape[0],h=UL(p,d,r,f),m=sm.computeOutShape(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,h);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var g=rt().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(e.length>g){for(var y=[],b=0;b<e.length;b+=g){var x=e.slice(b,b+g);y.push(rV(x,t,n))}for(var k=rV(y,t,n),w=0,S=y;w<S.length;w++){var I=S[w];n.disposeIntermediateTensorInfo(I)}return k}if(rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var N=new $W(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(N,e,r)}var T=function(e,t,n){var r=sm.computeOutShape(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return CB({inputs:{x:e},attrs:{shape:[-1,Fa.sizeFromShape(e.shape.slice(t))]},backend:n})})),outShape:r}}(e,t,n),C=T.tensors2D,E=T.outShape,_=new JW(C.map((function(e){return e.shape}))),A=n.runWebGLProgram(_,C,r);C.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var R=CB({inputs:{x:A},attrs:{shape:E},backend:n});return n.disposeIntermediateTensorInfo(A),R}function aV(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Fa.parseAxisParam(r,t[0].shape)[0],i=sm.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Fa.sizeFromShape(i))return n.makeTensorInfo(i,t[0].dtype,[]);var o=t.filter((function(e){return Fa.sizeFromShape(e.shape)>0}));if(1===o.length)return sB({inputs:{x:o[0]},backend:n});var s=o.map((function(e){return e.shape}));return sm.assertParamsConsistent(s,a),rV(o,a,n)}var iV={kernelName:Mt,backendName:"webgl",kernelFunc:aV},oV=(0,b.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,y.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,p=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,g=v?1:2,b=v?2:3,x=v?3:1,k="",w="";r&&(k=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),w="result = activation(result);");var S=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(k,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(x,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(b,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(h,") *\n                    getW(wR, wC, ").concat(h,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(h,", xR, xC) *\n                    getW(wR, wC, ").concat(h,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(h,", d2),\n                getW(wR, wC, ").concat(h," + 1, d2),\n                getW(wR, wC, ").concat(h," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(h,"),\n                  getX(batch, xR, xC, ").concat(h," + 1),\n                  getX(batch, xR, xC, ").concat(h," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(h,", xR, xC),\n                  getX(batch, ").concat(h," + 1, xR, xC),\n                  getX(batch, ").concat(h," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(S,"\n        ").concat(w,"\n        setOutput(result);\n      }\n    ")})),sV=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.filterDepth,d=t.filterHeight,f=t.filterWidth,h=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(p,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(d,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(h,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(h,") *\n                  getW(wF, wR, wC, ").concat(h,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(h,"),\n                  getX(batch, xF, xR, xC, ").concat(h," + 1),\n                  getX(batch, xF, xR, xC, ").concat(h," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(h,", d2),\n                  getW(wF, wR, wC, ").concat(h," + 1, d2),\n                  getW(wF, wR, wC, ").concat(h," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),uV=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=uL(this.outputShape.length);for(var r=n.dataFormat,a=Ez(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var p=0;p<=1;p++)c+="\n          blockIndex = rc.z + ".concat(p,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function cV(e,t){var n=e.length;return n>=3?[].concat((0,h.Z)(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function lV(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,d=e.activation,f=void 0===d?null:d,h=n.shape,m=i.texData.get(n.dataId),v=a.inChannels,g=h[0]*h[1]*h[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(null!=c){var k=cV(c.shape,b);null!=k&&(c=CB({inputs:{x:c},backend:i,attrs:{shape:k}}),x.push(c))}if(null!=s){var w=cV(s.shape,b);null!=w&&(s=CB({inputs:{x:s},backend:i,attrs:{shape:w}}),x.push(s))}if((1!==g&&1!==y||!(v>1e3))&&m.isPacked&&b&&null!=m.texture&&h[2]%2!==0&&Fa.arraysEqual(m.shape.slice(-3),h.slice(-3))){var S=h[0]*h[1]*(h[2]+1),I={dataId:n.dataId,shape:[1,S,a.inChannels],dtype:n.dtype},N=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,Fa.assert(hz(m.shape,I.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(I.shape," isn't free")}));var T=CB({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(T);var C=PB({a:I,b:T,backend:i,transposeA:!1,transposeB:false,bias:s,activation:f,preluActivationWeights:c,leakyreluAlpha:p}),E=i.texData.get(C.dataId);Fa.assert(E.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=N,E.shape=a.outShape,(t=sB({inputs:{x:C},backend:i})).shape=a.outShape,x.push(C)}else{var _=a.outHeight*a.outWidth,A=CB({inputs:{x:n},backend:i,attrs:{shape:b?[a.batchSize,_,a.inChannels]:[a.batchSize,a.inChannels,_]}}),R=CB({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),F=PB({a:b?A:R,b:b?R:A,transposeA:!b,transposeB:false,backend:i,bias:s,activation:f,preluActivationWeights:c,leakyreluAlpha:p});t=CB({inputs:{x:F},backend:i,attrs:{shape:a.outShape}}),x.push(A),x.push(R),x.push(F)}for(var D=0,Z=x;D<Z.length;D++){var O=Z[D];i.disposeIntermediateTensorInfo(O)}return t}function pV(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,p=e.activation,d=void 0===p?null:p,f=r.filterWidth,h=r.filterHeight,m=r.inChannels,v=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=f*h*m,x=g*v,k=[r.batchSize,b,x],w=[];if(null!=u){var S=cV(u.shape,y);null!=S&&(u=CB({inputs:{x:u},backend:a,attrs:{shape:S}}),w.push(u))}if(null!=o){var I=cV(o.shape,y);null!=I&&(o=CB({inputs:{x:o},backend:a,attrs:{shape:I}}),w.push(o))}var N=CB({inputs:{x:n},backend:a,attrs:{shape:[1,b,Fa.sizeFromShape(n.shape)/b]}});w.push(N);var T=new uV(k,r),C=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],E=a.runWebGLProgram(T,[t],"float32",C),_=CB({inputs:{x:E},backend:a,attrs:{shape:k}});w.push(E),w.push(_);var A=null!=o,R=null!=u,F="leakyrelu"===d,D=d?bB(d,!0):null,Z=new xB(y?_.shape:N.shape,y?N.shape:_.shape,y?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,A,D,R,F),O=y?[_,N]:[N,_];if(o&&O.push(o),R&&O.push(u),F){var M=a.makeTensorInfo([],"float32",Fa.createScalarValue(l,"float32"));O.push(M),w.push(M)}var z=a.runWebGLProgram(Z,O,"float32"),L=CB({inputs:{x:z},backend:a,attrs:{shape:r.outShape}});w.push(z);for(var P=0,B=w;P<B.length;P++){var W=B[P];a.disposeIntermediateTensorInfo(W)}return L}var dV={kernelName:zt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,p=a.dimRoundingMode,d=sm.convertConv2DDataFormat(c),f=sm.computeConv2DInfo(i.shape,o.shape,s,l,u,p,!1,d);if(1!==f.filterHeight||1!==f.filterWidth||1!==f.dilationHeight||1!==f.dilationWidth||1!==f.strideHeight||1!==f.strideWidth||"SAME"!==f.padInfo.type&&"VALID"!==f.padInfo.type)if(rt().getBool("WEBGL_CONV_IM2COL"))t=pV({x:i,filter:o,convInfo:f,backend:r});else{var h=new oV(f);t=r.runWebGLProgram(h,[i,o],"float32")}else t=lV({x:i,filter:o,convInfo:f,backend:r});var m=CB({inputs:{x:t},backend:r,attrs:{shape:f.outShape}});return r.disposeIntermediateTensorInfo(t),m}},fV=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),hV=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,p=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(p,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),mV=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),vV=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var gV={kernelName:Lt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,p=sm.convertConv2DDataFormat(u),d=sm.computeConv2DInfo(a.shape,l,o,1,s,c,!1,p),f=new fV(d);return n.runWebGLProgram(f,[a,i],"float32")}};var yV={kernelName:Pt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,p=sm.convertConv2DDataFormat(c),d=sm.computeConv2DInfo(o,i.shape,s,1,u,l,!1,p),f=new hV(d);return n.runWebGLProgram(f,[a,i],"float32")}};var bV={kernelName:Bt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=sm.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new sV(c);return n.runWebGLProgram(l,[a,i],"float32")}};var xV={kernelName:Wt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=sm.computeConv3DInfo(a.shape,u,o,1,s),l=new mV(c);return n.runWebGLProgram(l,[a,i],"float32")}};var kV,wV={kernelName:Vt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape,c=sm.computeConv3DInfo(u,i.shape,s,1,o),l=new vV(c);return n.runWebGLProgram(l,[a,i],"float32")}},SV=gB({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),IV={kernelName:Ut,backendName:"webgl",kernelFunc:SV},NV=gB({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),TV={kernelName:Gt,backendName:"webgl",kernelFunc:NV},CV=(0,b.Z)((function e(t,n,r,a,i){(0,y.Z)(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=(0,m.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3],p=(0,m.Z)(n,1)[0],d=(0,m.Z)(r,2),f=d[0],h=d[1];this.outputShape=[p,f,h,l];var v="bilinear"===a?1:0,g="".concat(u-1,".0"),b="".concat(c-1,".0"),x=f>1?["".concat((u-1)/(f-1)),"(y2-y1) * height_ratio","y1*".concat(g," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(g)],k=(0,m.Z)(x,3),w=k[0],S=k[1],I=k[2],N=h>1?["".concat((c-1)/(h-1)),"(x2-x1) * width_ratio","x1*".concat(b," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(b)],T=(0,m.Z)(N,3),C=T[0],E=T[1],_=T[2];this.userCode="\n      const float height_ratio = float(".concat(w,");\n      const float width_ratio = float(").concat(C,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(S,";\n        float width_scale = ").concat(E,";\n\n        float in_y = ").concat(I,";\n        if( in_y < 0.0 || in_y > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(_,";\n        if( in_x < 0.0 || in_x > ").concat(b," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(v," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),EV={kernelName:qt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new CV(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(kV||(kV={}));var _V=(0,b.Z)((function e(t,n,r,a){(0,y.Z)(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===kV.Prod?"1.0":"0.0",s=r?o:"getX(".concat(AV(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat($z(i)," coords = getOutputCoords();\n        int end = ").concat(RV(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(RV(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(AV(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function AV(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function RV(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function FV(e,t,n,r,a,i){var o=t.shape.length,s=sm.getAxesPermutation([r],o),u=t;null!=s&&(u=zB({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=sm.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," but got axis=").concat(r));for(var l=u.shape[c],p=sB({inputs:{x:u},backend:n}),d=0;d<=Math.ceil(Math.log2(l))-1;d++){var f=new _V(e,u.shape,!1,i),h=[[d]],m=p;p=n.runWebGLProgram(f,[p],p.dtype,h),n.disposeIntermediateTensorInfo(m)}if(a){var v=new _V(e,u.shape,a,i),g=p;p=n.runWebGLProgram(v,[p],p.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=s){var y=zB({inputs:{x:p},backend:n,attrs:{perm:sm.getUndoAxesPermutation(s)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(u),y}return p}var DV={kernelName:jt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return FV(kV.Prod,a,n,i,o,s)}};var ZV={kernelName:Ht,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return FV(kV.Sum,a,n,i,o,s)}};var OV={kernelName:Kt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=BL(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var p=n.bufferSync(a),d=n.bufferSync(i),f=WL(p,d,o,s);return n.makeTensorInfo(f.shape,i.dtype,f.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},MV=function(){function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return(0,b.Z)(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var zV={kernelName:Xt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p=new MV("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(p,[a],a.dtype)}},LV=(0,b.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,y.Z)(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=uL(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var p=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(p,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),PV=(0,b.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,y.Z)(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=uL(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,p=t.filterWidth,d=p,f="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",h=0;h<p;h++)f+="\n          vec4 xTexelC".concat(2*h,";\n          int xTexelC").concat(2*h,"Ready;\n          vec4 xTexelC").concat(2*h+1,";\n          int xTexelC").concat(2*h+1,"Ready;\n          vec4 xC").concat(h,";");f+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var m=0;m<p;m++)f+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");f+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var v=0;v<(d+1)/2;v++){var g=2*v;if(f+="\n          xC = xCCorner + ".concat(g*c,";\n          "),1===u){if(g<p&&(s%2===1?(f+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n              "),f+=1===c&&g>0?"\n                xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                  } else {\n                    xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                  }\n                  ")):f+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xC").concat(g," = xTexelC").concat(g,";\n                "),g+1<p)){var b=s%2===0?Fa.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(f+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(b,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                    xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(g+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(g+1,"Ready = 1;\n                  }\n                  "),c>1&&(f+="\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                      xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                      xTexelC").concat(g,"Ready = 1;\n                    }\n                    ")),f+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                  ")):f+=1===b?"\n                    xC".concat(g+1," = xTexelC").concat(g,";\n                    "):"\n                    xCOffset = xC + ".concat(b,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                      xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(g+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(g+1,"Ready = 1;\n                    }\n\n                    xC").concat(g+1," = xTexelC").concat(g+1,";\n                    ")}}else g<p&&(s%2===1?(f+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n              "),g+1<p&&(f+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                "))):(f+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(\n                  xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n              "),g+1<p&&(f+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                "))));g<p&&(f+="\n            wTexel = getW(r, ".concat(g,", d1, q);\n            dotProd += xC").concat(g," * vec4(wTexel.xz, wTexel.xz);\n          "),g+1<p&&(f+="\n              wTexel = getW(r, ".concat(g+1,", d1, q);\n              dotProd += xC").concat(g+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}f+="\n    }\n  ",f+="\n      }\n    ";var x="",k="";r&&(x=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(f,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")}));var BV={kernelName:Yt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),Fa.assert(sm.eitherStridesOrDilationsAreOne(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var p,d=sm.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0);p=rt().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?new PV(d):new LV(d);var f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(p,[a,i],"float32",f)}},WV=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),VV=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var UV={kernelName:Qt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,p=sm.computeConv2DInfo(a.shape,l,o,s,u,c,!0),d=new WV(p);return n.runWebGLProgram(d,[a,i],"float32")}};var GV={kernelName:Jt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape,p=sm.computeConv2DInfo(l,i.shape,o,s,u,c,!0),d=new VV(p);return n.runWebGLProgram(d,[a,i],"float32")}},jV=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var HV={kernelName:$t,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat((0,h.Z)(r.shape),(0,h.Z)(r.shape)),i=Fa.sizeFromShape(r.shape),o=CB({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new jV(i),u=n.runWebGLProgram(s,[o],o.dtype),c=CB({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},qV=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,p=a.top,d=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(d,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var KV={kernelName:en,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=sm.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),p=new qV(l),d=CB({inputs:{x:t=r.runWebGLProgram(p,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),d}};var XV={kernelName:an,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=sm.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;sm.checkEinsumDimSizes(o.length,u,a);for(var c=sm.getEinsumComputePath(s,u),l=c.path,p=c.steps,d=p.length,f=null,h=o.length,m=[],v=0;v<d;++v){var g,y=(0,x.Z)(p[v]);try{for(y.s();!(g=y.n()).done;){var b=g.value,k=sm.getEinsumPermutation(h,u[b]),w=k.permutationIndices,S=k.expandDims,I=void 0;sm.isIdentityPermutation(w)?I=a[b]:(I=zB({inputs:{x:a[b]},backend:n,attrs:{perm:w}}),m.push(I));for(var N=I.shape.slice(),T=0;T<S.length;++T)N.splice(S[T],0,1);Fa.arraysEqual(I.shape,N)||(I=CB({inputs:{x:I},backend:n,attrs:{shape:N}}),m.push(I)),null===f?f=I:(f=NB({inputs:{a:I,b:f},backend:n}),m.push(f))}}catch(A){y.e(A)}finally{y.f()}v<d-1&&(l[v]>=0&&(f=OB({inputs:{x:f},backend:n,attrs:{axis:l[v]-(o.length-h),keepDims:!1}}),m.push(f)),h--)}for(var C=0,E=m;C<E.length;C++){var _=E[C];_!==f&&n.disposeIntermediateTensorInfo(_)}return f}},YV=gB({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),QV={kernelName:on,backendName:"webgl",kernelFunc:YV},JV={kernelName:sn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=rt().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new oB("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new iB("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},$V=yB({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:GL}),eU={kernelName:cn,backendName:"webgl",kernelFunc:$V},tU=gB({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(sm.ERF_P,";\n  float a1 = ").concat(sm.ERF_A1,";\n  float a2 = ").concat(sm.ERF_A2,";\n  float a3 = ").concat(sm.ERF_A3,";\n  float a4 = ").concat(sm.ERF_A4,";\n  float a5 = ").concat(sm.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),nU={kernelName:un,backendName:"webgl",kernelFunc:tU},rU=gB({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:jL,dtype:"float32"}),aU={kernelName:ln,backendName:"webgl",kernelFunc:rU};function iU(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(Fa.assert(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),CB({inputs:{x:i},backend:r,attrs:{shape:s}})}var oU={kernelName:pn,backendName:"webgl",kernelFunc:iU},sU="return exp(x) - 1.0;",uU=gB({opSnippet:sU,packedOpSnippet:sU,cpuKernelImpl:HL}),cU={kernelName:dn,backendName:"webgl",kernelFunc:uU},lU=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function pU(e,t,n){var r=n.texData.get(e.dataId),a=Fa.sizeFromShape(e.shape),i=e.shape[e.shape.length-1],o=CB({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new lU("real",s,t),c=new lU("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],p=n.runWebGLProgram(u,l,"float32"),d=n.runWebGLProgram(c,l,"float32"),f=cB({inputs:{real:p,imag:d},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d);var h=CB({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(f),h}var dU={kernelName:fn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return pU(t.input,!1,n)}},fU=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function hU(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Fa.inferDtype(a))){var o=Fa.getArrayFromDType(i,Fa.sizeFromShape(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new fU(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var mU,vU={kernelName:hn,backendName:"webgl",kernelFunc:hU},gU=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),yU={kernelName:mn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new gU(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},bU="return floor(x);",xU=gB({opSnippet:bU,packedOpSnippet:bU,cpuKernelImpl:qL}),kU={kernelName:vn,backendName:"webgl",kernelFunc:xU},wU=yB({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),SU={kernelName:gn,backendName:"webgl",kernelFunc:wU},IU=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["A"];var n=Ez(),r=(0,m.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),NU=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Ez(),r=(0,m.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),TU={kernelName:ha,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=(0,m.Z)(u,2),l=c[0],p=c[1],d=[p,l],f=[p,l,i];(s||o)&&(null==mU&&(mU=document.createElement("canvas").getContext("2d")),mU.canvas.width=l,mU.canvas.height=p,mU.drawImage(a,0,0,l,p),a=mU.canvas);var h=n.makeTensorInfo(d,"int32");n.texData.get(h.dataId).usage=kM.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),a);var v=rt().getBool("WEBGL_PACK")?new NU(f):new IU(f),g=n.runWebGLProgram(v,[h],"int32");return n.disposeData(h.dataId),g}};var CU={kernelName:ga,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,p=a.dataFormat,d=a.dilations,f=a.dimRoundingMode,h=a.activation,m=a.leakyreluAlpha,v=sm.convertConv2DDataFormat(p),g=sm.computeConv2DInfo(i.shape,o.shape,c,d,l,f,!1,v),y=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(rt().getBool("WEBGL_CONV_IM2COL"))t=pV({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:h,preluActivationWeights:u,leakyreluAlpha:m});else{var b=null!=s,x=null!=u,k="leakyrelu"===h,w=h?bB(h,!1):null,S=new oV(g,b,w,x,k),I=[i,o],N=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=CB({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&I.push(N(s,p)),x&&I.push(N(u,p)),k){var T=r.makeTensorInfo([],"float32",Fa.createScalarValue(m,"float32"));I.push(T),y.push(T)}t=r.runWebGLProgram(S,I,"float32")}else t=lV({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:h,preluActivationWeights:u,leakyreluAlpha:m});var C=CB({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),C}};var EU={kernelName:ya,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,p=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,h=[],m=l;null==m&&(m=[1,1]),Fa.assert(sm.eitherStridesOrDilationsAreOne(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var v,g=sm.computeConv2DInfo(a.shape,i.shape,u,m,c,p,!0),y=rt().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=d?bB(d,y):null,x=[a,i],k=null!=o,w=null!=s,S="leakyrelu"===d;if(k&&x.push(o),w&&x.push(s),S){var I=n.makeTensorInfo([],"float32",Fa.createScalarValue(f,"float32"));x.push(I),h.push(I)}v=y?new PV(g,k,b,w,S):new LV(g,k,b,w,S);var N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=n.runWebGLProgram(v,x,"float32",N);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),T}},_U=(0,b.Z)((function e(t,n,r,a){(0,y.Z)(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;var i=$z(n.length),o=$z(r.length),s=this.sliceDim>1?"strides[j]":"strides",u=$z(a.length),c=a.length>1?"paramsShape[j]":"paramsShape";this.userCode="\n        ".concat(i," strides = ").concat(i,"(").concat(this.strides,");\n        ").concat(u," paramsShape = ").concat(u,"(").concat(this.paramsShape,");\n         void main() {\n          ").concat(o," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            out_of_bounds = out_of_bounds || index < 0;\n            out_of_bounds = out_of_bounds || index >= ").concat(c,";\n            flattenIndex += index * ").concat(s,";\n          }\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var AU={kernelName:xn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=Fa.sizeFromShape(r.shape),u=sm.prepareAndValidate(r,a),c=(0,m.Z)(u,4),l=c[0],p=c[1],d=c[2],f=c[3],h=CB({inputs:{x:a},backend:n,attrs:{shape:[p,o]}}),v=CB({inputs:{x:r},backend:n,attrs:{shape:[Fa.sizeFromShape(r.shape)/d,d]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var g=n.readSync(a.dataId),y=n.bufferSync(r),b=KL(g,y,r.dtype,p,o,d,f,r.shape,s);return n.makeTensorInfo(l,r.dtype,b.values)}var x=new _U(o,f,[p,d],r.shape),k=n.runWebGLProgram(x,[v,h],v.dtype),w=CB({inputs:{x:k},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(k),w}},RU=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=$z(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function FU(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=Fa.parseAxisParam(o,a.shape)[0];rt().get("DEBUG")&&function(){for(var e=n.readSync(i.dataId),t=a.shape[u],r=function(n){var r=e[n];Fa.assert(r<=t-1&&r>=0,(function(){return"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]")}))},o=0;o<e.length;++o)r(o)}();var c=sm.segment_util.collectGatherOpShapeInfo(a,i,u,s),l=Fa.sizeFromShape(i.shape),p=[],d=CB({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=CB({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}});p.push(d),p.push(f);var h=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var m=n.bufferSync(f),v=n.bufferSync(d),g=XL(v,m,h);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(c.outputShape,g.dtype,g.values)}var y=new RU(d.shape,h),b=n.runWebGLProgram(y,[d,f],d.dtype);p.push(b);var x=CB({inputs:{x:b},backend:n,attrs:{shape:c.outputShape}});return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}var DU={kernelName:bn,backendName:"webgl",kernelFunc:FU},ZU=yB({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:YL,dtype:"bool"}),OU={kernelName:kn,backendName:"webgl",kernelFunc:ZU},MU=yB({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:QL}),zU={kernelName:wn,backendName:"webgl",kernelFunc:MU};var LU={kernelName:In,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return pU(t.input,!0,n)}},PU=gB({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),BU={kernelName:Tn,backendName:"webgl",kernelFunc:PU},WU=gB({opSnippet:"return float(isinf(x));",dtype:"bool"}),VU={kernelName:Cn,backendName:"webgl",kernelFunc:WU},UU=gB({opSnippet:"return float(isnan(x));",dtype:"bool"}),GU={kernelName:En,backendName:"webgl",kernelFunc:UU},jU=yB({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:JL,dtype:"bool"}),HU={kernelName:An,backendName:"webgl",kernelFunc:jU},qU=yB({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:$L,dtype:"bool"}),KU={kernelName:Rn,backendName:"webgl",kernelFunc:qU};var XU={kernelName:Fn,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=eP(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},YU=gB({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:tP}),QU={kernelName:Dn,backendName:"webgl",kernelFunc:YU},JU=gB({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"}),$U={kernelName:Zn,backendName:"webgl",kernelFunc:JU},eG=yB({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),tG={kernelName:On,backendName:"webgl",kernelFunc:eG},nG=gB({opSnippet:"return float(!(x >= 1.0));"}),rG={kernelName:Mn,backendName:"webgl",kernelFunc:nG},aG=yB({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),iG={kernelName:zn,backendName:"webgl",kernelFunc:aG},oG=(0,b.Z)((function e(t,n,r,a,i){(0,y.Z)(this,e),this.variableNames=["x"],this.outputShape=[];var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(o,"; j <= ").concat(o,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(u,";\n        setOutput(val);\n      }\n    ")})),sG=(0,b.Z)((function e(t,n,r,a,i){(0,y.Z)(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(o,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(o,"; j <= ").concat(o,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(u,";\n        setOutput(result);\n      }\n    ")})),uG={kernelName:Wn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=rt().getBool("WEBGL_PACK_NORMALIZATION")?new sG(a.shape,i,o,s,u):new oG(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},cG=(0,b.Z)((function e(t,n,r,a,i){(0,y.Z)(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),lG={kernelName:Vn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,p=new cG(a.shape,s,u,c,l);return n.runWebGLProgram(p,[a,i,o],a.dtype)}};function pG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=Fa.parseAxisParam(i,a.shape),c=u,l=sm.getAxesPermutation(c,s),p=null!=l,d=n.shouldExecuteOnCPU([a]),f=a;if(p){if(d){for(var h=n.texData.get(f.dataId).values,v=new Array(s),g=0;g<v.length;g++)v[g]=a.shape[l[g]];var y=TP(h,a.shape,a.dtype,l,v);f=n.makeTensorInfo(v,a.dtype),n.texData.get(f.dataId).values=y}else f=ZB(a,l,n);c=sm.getInnerMostAxes(c.length,s)}sm.assertAxesAreInnerMostDims("max",c,s);var b,x=sm.computeOutAndReduceShapes(f.shape,c),k=(0,m.Z)(x,2),w=k[0],S=k[1],I=w;if(o&&(I=sm.expandShapeToKeepDim(w,u)),d){h=n.texData.get(f.dataId).values,v=nP(h,Fa.sizeFromShape(S),I,a.dtype);b=n.makeTensorInfo(I,a.dtype),(y=n.texData.get(b.dataId)).values=v}else b=function(e,t,n,r){var a=Fa.sizeFromShape(t),i=CB({inputs:{x:e},attrs:{shape:[Fa.sizeFromShape(e.shape)/a,a]},backend:r}),o=RB(i,e.dtype,"max",r),s=CB({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(f,S,I,n);return p&&n.disposeIntermediateTensorInfo(f),b}var dG={kernelName:Un,backendName:"webgl",kernelFunc:pG},fG=yB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:rP}),hG={kernelName:Gn,backendName:"webgl",kernelFunc:fG};var mG={kernelName:jn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Tz(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Fa.assert(sm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=sm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Fa.arraysEqual(c.inShape,c.outShape))return sB({inputs:{x:a},backend:n});var l=new yW(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var vG={kernelName:qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=sm.computePool3DInfo(a.shape,i,o,[1,1,1],s,c,u),p=new bW(l,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}},gG=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),yG=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,p=u-1-t.padInfo.front,d=c-1-t.padInfo.top,f=l-1-t.padInfo.left,h=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(d,", ").concat(f,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(h," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var bG={kernelName:Kn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=sm.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),p=new bW(l,"max",!0),d=n.runWebGLProgram(p,[i],i.dtype),f=new yG(l),h=n.runWebGLProgram(f,[a,d],i.dtype);return n.disposeIntermediateTensorInfo(d),h}};var xG={kernelName:Hn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Tz([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=sm.computePool2DInfo(o.shape,s,u,1,c,l),d=new yW(p,"max",!0),f=n.runWebGLProgram(d,[o],o.dtype),h=new gG(p),m=n.runWebGLProgram(h,[a,f],o.dtype);return n.disposeIntermediateTensorInfo(f),m}};var kG={kernelName:Xn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;Fa.assert(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var l=[1,1];Fa.assert(sm.eitherStridesOrDilationsAreOne(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var p=sm.computePool2DInfo(a.shape,i,o,l,s),d=function(e,t,n,r){var a=new yW(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new yW(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,p,c),f=(0,m.Z)(d,2);return[f[0],f[1]]}};var wG={kernelName:Yn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=Fa.parseAxisParam(o,a.shape),l=c,p=sm.getAxesPermutation(l,u),d=null!=p,f=s.shouldExecuteOnCPU([a]),h=[],v=a;if(d){if(f){for(var g=s.texData.get(v.dataId).values,y=new Array(u),b=0;b<y.length;b++)y[b]=a.shape[p[b]];var x=TP(g,a.shape,a.dtype,p,y);v=s.makeTensorInfo(y,a.dtype),s.texData.get(v.dataId).values=x}else v=ZB(a,p,s);h.push(v),l=sm.getInnerMostAxes(l.length,u)}sm.assertAxesAreInnerMostDims("sum",l,u);var k=sm.computeOutAndReduceShapes(v.shape,l),w=(0,m.Z)(k,2),S=w[0],I=w[1],N=S;i&&(N=sm.expandShapeToKeepDim(S,c));for(var T=function(e,t,n,r){var a=Fa.sizeFromShape(t),i=CB({inputs:{x:e},attrs:{shape:[Fa.sizeFromShape(e.shape)/a,a]},backend:r}),o=RB(i,"float32","mean",r),s=CB({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(v,I,N,s),C=0,E=h;C<E.length;C++){g=E[C];s.disposeIntermediateTensorInfo(g)}return T}};var SG={kernelName:Qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Fa.parseAxisParam(i,a.shape),c=u,l=sm.getAxesPermutation(c,s),p=a;null!=l&&(p=zB({inputs:{x:a},backend:n,attrs:{perm:l}}),c=sm.getInnerMostAxes(c.length,a.shape.length)),sm.assertAxesAreInnerMostDims("min",c,s);var d,f=sm.computeOutAndReduceShapes(p.shape,c),h=(0,m.Z)(f,2),v=h[0],g=h[1],y=CB({inputs:{x:p},backend:n,attrs:{shape:[-1,Fa.sizeFromShape(g)]}}),b=RB(y,y.dtype,"min",n);return d=CB(o?{inputs:{x:b},backend:n,attrs:{shape:sm.expandShapeToKeepDim(v,u)}}:{inputs:{x:b},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),null!=l&&n.disposeIntermediateTensorInfo(p),d}},IG=yB({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:aP}),NG={kernelName:Jn,backendName:"webgl",kernelFunc:IG},TG=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=$z(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),CG=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=$z(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=_P("rc",a),c=_P("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),d="reflect"===r?0:1,f="";if(1===a){var h="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(d,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(d,";\n        }\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(h,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(h,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(d,") +\n                gte * ((end - 1) * 2 - source + ").concat(d,");\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),EG={kernelName:$n,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new CG(a.shape,i,o):new TG(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},_G=yB({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),AG={kernelName:er,backendName:"webgl",kernelFunc:_G},RG=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),FG=yB({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),DG={kernelName:rn,backendName:"webgl",kernelFunc:FG},ZG="return a - b;",OG=yB({opSnippet:ZG,packedOpSnippet:ZG,supportsComplex:!0,cpuKernelImpl:SP}),MG={kernelName:ta,backendName:"webgl",kernelFunc:OG};function zG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=Fa.parseAxisParam([i],a.shape),s=pG({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=sm.expandShapeToKeepDim(s.shape,o),c=CB({inputs:{x:s},backend:n,attrs:{shape:u}}),l=OG({inputs:{a:a,b:c},backend:n}),p=rU({inputs:{x:l},backend:n}),d=OB({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:!1}}),f=CB({inputs:{x:d},backend:n,attrs:{shape:u}}),h=FG({inputs:{a:p,b:f},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),h}var LG={kernelName:Ur,backendName:"webgl",kernelFunc:zG};var PG={kernelName:tr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:zG({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],p=new RG(c,l,i),d=[[o]],f=n.runWebGLProgram(p,[u],"int32",d);return s||n.disposeIntermediateTensorInfo(u),f}};var BG={kernelName:rr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=oP(i.values,a.shape,a.dtype),s=(0,m.Z)(o,2),u=s[0],c=s[1];return r.makeTensorInfo(c,a.dtype,u)}return t=rt().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new YP(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new MP(a.shape,"if (isnan(x)) return x;\n  return -x;\n"),r.runWebGLProgram(t,[a],a.dtype)}},WG=sv.nonMaxSuppressionV3Impl;var VG={kernelName:ir,backendName:"webgl",kernelFunc:function(e){sm.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=WG(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},UG=sv.nonMaxSuppressionV4Impl;var GG={kernelName:or,backendName:"webgl",kernelFunc:function(e){sm.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),p=n.readSync(i.dataId),d=UG(l,p,o,s,u,c),f=d.selectedIndices,h=d.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},jG=sv.nonMaxSuppressionV5Impl;var HG={kernelName:sr,backendName:"webgl",kernelFunc:function(e){sm.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),p=n.readSync(i.dataId),d=jG(l,p,o,s,u,c),f=d.selectedIndices,h=d.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}},qG=(0,b.Z)((function e(t,n,r,a){(0,y.Z)(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),KG={kernelName:cr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue,u=Fa.sizeFromShape(a.shape),c=new qG(u,i,o,s),l=CB({inputs:{x:a},backend:n,attrs:{shape:[u]}}),p=n.runWebGLProgram(c,[l],a.dtype);n.disposeIntermediateTensorInfo(l);var d=CB({inputs:{x:p},backend:n,attrs:{shape:[].concat((0,h.Z)(a.shape),[i])}});return n.disposeIntermediateTensorInfo(p),d}};function XG(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=BW({inputs:{input:r},backend:n}),i=XG({inputs:{x:a},backend:n}),o=tV({inputs:{input:r},backend:n}),s=XG({inputs:{x:o},backend:n}),u=cB({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return hU({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var YG={kernelName:da,backendName:"webgl",kernelFunc:XG};var QG={kernelName:ur,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=BW({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=tV({inputs:{input:a},backend:r}),u=XG({inputs:{x:s},backend:r}),c=cB({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return hU({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var JG={kernelName:lr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return iU({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Fa.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Fa.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=aV({inputs:t.map((function(e){var t=iU({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},$G=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=$z(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),ej=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=$z(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=_P("rc",a),c=_P("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),d=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],f=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",m=0,v=1===a?2:4;m<v;m++)h+="\n        ".concat(d[m],"\n        if (").concat(f,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ");h+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(h,"\n        setOutput(result);\n      }\n    ")})),tj=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===Fa.sizeFromShape(a.shape))return hU({backend:n,attrs:{shape:i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),value:o,dtype:a.dtype}});var s=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ej(a.shape,i,o):new $G(a.shape,i,o),u=[[o]];return n.runWebGLProgram(s,[a],a.dtype,u)},nj={kernelName:pr,backendName:"webgl",kernelFunc:tj},rj=yB({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),aj={kernelName:fr,backendName:"webgl",kernelFunc:rj};var ij={kernelName:mr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],l=Fa.parseAxisParam(o,i.shape),p=l,d=sm.getAxesPermutation(p,u),f=i;if(null!=d&&(f=zB({inputs:{x:i},backend:r,attrs:{perm:d}}),p=sm.getInnerMostAxes(p.length,u),c.push(f)),sm.assertAxesAreInnerMostDims("prod",p,u),r.shouldExecuteOnCPU([f])){var h=r.texData.get(f.dataId).values,v=uP(f.shape,f.dtype,h,p),g=v.outVals,y=v.outShape,b=v.outDtype;t=r.makeTensorInfo(y,b,g)}else{var x=sm.computeOutAndReduceShapes(f.shape,p),k=(0,m.Z)(x,2),w=k[0],S=k[1],I=Fa.sizeFromShape(S),N=CB({inputs:{x:f},backend:r,attrs:{shape:[-1,I]}}),T=RB(N,Ni(i.dtype),"prod",r);t=CB({inputs:{x:T},backend:r,attrs:{shape:w}}),c.push(N),c.push(T)}if(s){c.push(t);var C=sm.expandShapeToKeepDim(t.shape,l);t=CB({inputs:{x:t},backend:r,attrs:{shape:C}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}},oj=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=cP(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},sj={kernelName:vr,backendName:"webgl",kernelFunc:oj},uj=gB({opSnippet:"return 1.0 / x;"}),cj={kernelName:yr,backendName:"webgl",kernelFunc:uj},lj=gB({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),pj={kernelName:br,backendName:"webgl",kernelFunc:lj},dj=gB({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),fj={kernelName:Nr,backendName:"webgl",kernelFunc:dj},hj=(0,b.Z)((function e(t,n,r,a,i){(0,y.Z)(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,m.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),mj=(0,b.Z)((function e(t,n,r,a,i){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,m.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],",\n          ").concat(d[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var vj={kernelName:Sr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,m.Z)(s,2),c=u[0],l=u[1],p=rt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new mj(a.shape,c,l,i,o):new hj(a.shape,c,l,i,o);return n.runWebGLProgram(p,[a],"float32")}},gj=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,m.Z)(n,3),i=a[1],o=a[2],s=(0,m.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],d=l[0]/p[0],f=l[1]/p[1],h=1/d,v=1/f,g=2*Math.ceil(h)+2,b=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var yj={kernelName:Ir,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new gj(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},bj=(0,b.Z)((function e(t,n,r,a,i){(0,y.Z)(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,m.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],h=a?"0.5":"0.0";p=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),xj=(0,b.Z)((function e(t,n,r,a,i){(0,y.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,m.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],h=a?"0.5":"0.0";p=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],",\n          ").concat(d[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(h,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var kj={kernelName:kr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,m.Z)(s,2),c=u[0],l=u[1],p=rt().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new xj(a.shape,c,l,i,o):new bj(a.shape,c,l,i,o);return n.runWebGLProgram(p,[a],a.dtype)}},wj=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,m.Z)(n,3),i=a[1],o=a[2],s=(0,m.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],d=l[0]/p[0],f=l[1]/p[1],h=1/d,v=1/f,g=2*Math.ceil(h)+2,b=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(h,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(p[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(p[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var Sj={kernelName:wr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new wj(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},Ij=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=$z(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),Nj=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a,i=_P("rc",r),o="".concat(i[r-1]," + 1 < ").concat(this.outputShape[r-1]),s="".concat(i[r-2]," + 1 < ").concat(this.outputShape[r-2]),u=$z(r);function c(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(o,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(u," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat((a=i.slice(),c(a)),";\n          if(").concat(o,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",c(e)}(i.slice()),";\n          }\n          if(").concat(s,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            if(").concat(o,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var Tj={kernelName:Tr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=Fa.parseAxisParam(i,a.shape);if(0===o)return sB({inputs:{x:a},backend:n});var u=rt().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Nj(a.shape,s):new Ij(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},Cj=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"==typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),Ej={kernelName:ma,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new Cj(a.shape,o),l=sm.getImageCenter(s,a.shape[1],a.shape[2]),p=(0,m.Z)(l,2),d=[[p[0],p[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(c,[a],a.dtype,d)}},_j=gB({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),Aj={kernelName:Cr,backendName:"webgl",kernelFunc:_j},Rj=gB({opSnippet:"return inversesqrt(x);",cpuKernelImpl:lP}),Fj={kernelName:Er,backendName:"webgl",kernelFunc:Rj},Dj=(0,b.Z)((function e(t,n,r,a,i,o){(0,y.Z)(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=$z(i.length),u=$z(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),p="";1===a?p="i":2===a&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),f=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(f,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}));var Zj={kernelName:_r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=sm.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,d=s.outputSize,f=[d/l,l];if(0===d)return n.makeTensorInfo(o,a.dtype);var h=CB({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),m=CB({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),v=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new Dj(c,u,h.shape.length,m.shape.length,p,f),y=n.runWebGLProgram(g,[m,h,v],m.dtype),b=CB({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),b}},Oj=(0,b.Z)((function e(t,n,r,a){(0,y.Z)(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===rt().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var Mj={kernelName:Ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new Oj(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},zj=(0,b.Z)((function e(t,n,r){var a,i;if((0,y.Z)(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=$z(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var Lj={kernelName:Rr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new zj(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],Ii(a.dtype,i.dtype))}},Pj=gB({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(sm.SELU_SCALEALPHA,";\n  float scale = ").concat(sm.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),Bj={kernelName:Fr,backendName:"webgl",kernelFunc:Pj},Wj=gB({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:dP}),Vj={kernelName:zr,backendName:"webgl",kernelFunc:Wj},Uj=gB({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),Gj={kernelName:Mr,backendName:"webgl",kernelFunc:Uj},jj=gB({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),Hj={kernelName:Zr,backendName:"webgl",kernelFunc:jj},qj=gB({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),Kj={kernelName:Or,backendName:"webgl",kernelFunc:qj},Xj=gB({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),Yj={kernelName:Lr,backendName:"webgl",kernelFunc:Xj},Qj={kernelName:Wr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;Fa.assert(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,(0,h.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],p=tj({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=sm.getReshaped(p.shape,i,s,!1),f=sm.getPermuted(d.length,i.length,!1),m=sm.getReshapedPermuted(p.shape,i,s,!1),v=CB({inputs:{x:p},backend:n,attrs:{shape:d}}),g=zB({inputs:{x:v},backend:n,attrs:{perm:f}}),y=CB({inputs:{x:g},backend:n,attrs:{shape:m}});return l.push(p),l.push(v),l.push(g),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}};var Jj={kernelName:Gr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],p=mP(s,r.shape,r.dtype,u,a.dtype,c,l),d=(0,m.Z)(p,5),f=d[0],h=d[1],v=d[2],g=d[3],y=d[4];return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],a.dtype,v),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}};var $j={kernelName:jr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),c=vP(s,r.shape,r.dtype,o,u),l=(0,m.Z)(c,3),p=l[0],d=l[1],f=l[2];return[n.makeTensorInfo(d,r.dtype,p),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};var eH={kernelName:Hr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=gP(o,r.shape,r.dtype,s,u,!0),l=(0,m.Z)(c,2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var tH={kernelName:qr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=gP(o,r.shape,r.dtype,s,u),l=(0,m.Z)(c,2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var nH={kernelName:Kr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=sm.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,d=u.strides,f=u.outputSize;if("string"===i.dtype){var h=n.bufferSync(a),m=n.bufferSync(i),v=Fa.decodeString(n.readSync(o.dataId)[0]),g=pP(h,m,s,f,p,l,c,d,v,false);return n.makeTensorInfo(s,g.dtype,g.values)}var y=new Dj(l,c,a.shape.length,i.shape.length,d,[f,1],false),b=n.runWebGLProgram(y,[i,a,o],i.dtype),x=CB({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),x}};var rH={kernelName:Vr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Fa.parseAxisParam(o,a.shape)[0],u=sm.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),p=a.shape.slice();return u.map((function(e){var t=(0,h.Z)(p);t[s]=e;var r=DW({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[s]+=e,r}))}},aH="return sqrt(x);",iH=gB({opSnippet:aH,packedOpSnippet:aH,cpuKernelImpl:yP}),oH={kernelName:Pr,backendName:"webgl",kernelFunc:iH},sH=gB({opSnippet:"return x * x;"}),uH={kernelName:Yr,backendName:"webgl",kernelFunc:sH},cH="return (a - b) * (a - b);",lH=yB({opSnippet:cH,packedOpSnippet:cH}),pH={kernelName:Xr,backendName:"webgl",kernelFunc:lH};var dH={kernelName:fa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=zP+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new MP(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},fH=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=$z(r.length),o=$z(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var hH={kernelName:Qr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,d=a.newAxisMask,f=a.shrinkAxisMask,h=Ru.sliceInfo(i.shape,o,s,u,c,l,p,d,f),m=h.finalShapeSparse,v=h.finalShape,g=h.isIdentity,y=h.sliceDim0,b=h.isSimpleSlice,x=h.begin,k=h.end,w=h.strides;if(g)t=CB({inputs:{x:i},backend:r,attrs:{shape:v}});else if(y||b){Fa.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var S=Ru.computeOutShape(x,k,w),I=DW({inputs:{x:i},backend:r,attrs:{begin:x,size:S}});t=CB({inputs:{x:I},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(I)}else if(r.shouldExecuteOnCPU([i])){var N=r.readSync(i.dataId),T=us(i.shape,i.dtype,N),C=bP(m,T,w,x);t=r.makeTensorInfo(v,i.dtype,C.values)}else{var E=new fH(x,w,m);t=r.runWebGLProgram(E,[i],i.dtype)}var _=CB({inputs:{x:t},backend:r,attrs:{shape:v}});return r.disposeIntermediateTensorInfo(t),_}};var mH={kernelName:Jr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,d=n.readSync(l.dataId),f=n.readSync(p.dataId),h=xP(d,f,a,i,o,s,u,c),v=(0,m.Z)(h,2),g=v[0],y=v[1];return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(p.shape,"int32",y)]}};var vH={kernelName:$r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=kP(o,s,r),c=(0,m.Z)(u,3),l=c[0],p=c[1],d=c[2],f=p.length;return[n.makeTensorInfo([f,2],"int32",l),n.makeTensorInfo([f],"string",p),n.makeTensorInfo([2],"int32",new Int32Array(d))]}};var gH={kernelName:ea,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=wP(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},yH=gB({opSnippet:"return tan(x);"}),bH={kernelName:na,backendName:"webgl",kernelFunc:yH},xH=gB({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),kH={kernelName:ra,backendName:"webgl",kernelFunc:xH},wH=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=$z(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function SH(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return Fa.decodeString(e)})):o,u=us(a.shape,a.dtype,s),c=IP(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new wH(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var IH={kernelName:aa,backendName:"webgl",kernelFunc:SH},NH=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),TH=(0,b.Z)((function e(t){(0,y.Z)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function CH(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function EH(e){for(var t=1;t<e;)t*=2;return t}var _H={kernelName:ia,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=rt().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=rt().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([a])||l<s||i>u){var p=n.readSync(a.dataId),d=NP(p,c,a.dtype,i,o),f=(0,m.Z)(d,2),h=f[0],v=f[1];return[n.makeTensorInfo(h.shape,h.dtype,h.values),n.makeTensorInfo(v.shape,v.dtype,v.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===l)return[a,hU({attrs:{shape:c,dtype:"int32",value:0},backend:n})];var g=n.texData.get(a.dataId),y=null!==g&&g.isPacked,b=y?n.unpackTensor(a):a,x=Fa.sizeFromShape(c)/l,k=CB({inputs:{x:b},attrs:{shape:[x,l]},backend:n});y&&CH(n,b);for(var w=EH(i),S=EH(l),I=null,N=function(){return null===I?[k,k]:[k,I]},T=function(e,t,r){var a=N(),i=new NH(r),o=[[l],[null===I?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=I;I=n.runWebGLProgram(i,a,"int32",o),CH(n,s)},C=1;C<w;C*=2)for(var E=2*C,_=C;_>=1;_/=2)T(E,_,[x,S]);for(var A=S;A>w;A/=2){var R=N(),F=new TH([x,A/2]),D=[[l],[null===I?1:0],[w]],Z=I;I=n.runWebGLProgram(F,R,"int32",D),CH(n,Z);for(var O=w/2,M=2*O,z=O;z>=1;z/=2)T(M,z,I.shape)}var L=I;I=DW({inputs:{x:I},backend:n,attrs:{begin:0,size:[x,i]}}),CH(n,L);var P=FU({inputs:{x:k,indices:I},backend:n,attrs:{axis:1,batchDims:1}});CH(n,k);var B=c.slice(0,-1);B.push(i),L=I,I=CB({inputs:{x:I},attrs:{shape:B},backend:n}),CH(n,L);var W=P;return P=CB({inputs:{x:P},attrs:{shape:B},backend:n}),CH(n,W),[P,I]}},AH=(0,b.Z)((function e(t,n,r,a,i,o){(0,y.Z)(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var RH={kernelName:oa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=(0,m.Z)(a.shape,4),p=l[0],d=l[1],f=l[2],h=l[3],v=null!=c?c:[d,f],g=(0,m.Z)(v,2),y=g[0],b=g[1],x=new AH(d,f,o,s,u,[p,y,b,h]);return n.runWebGLProgram(x,[a,i],"float32")}};var FH={kernelName:ua,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;Tz(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=CP(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var DH={kernelName:ca,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,p=0;p<s;p++)p!==i&&(c[l++]=o.shape[p]);var d=[],f=new Array(s).fill(0),h=o.shape.slice();h[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){f[i]=v;var g=DW({inputs:{x:o},backend:n,attrs:{begin:f,size:h}}),y=CB({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,d.push(g)}return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},ZH=(0,b.Z)((function e(t,n){(0,y.Z)(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(d,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var OH,MH,zH,LH={kernelName:la,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=sm.getAxesPermutation([c],s),p=a;null!=l&&(p=zB({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(p),c=sm.getInnerMostAxes(1,s)[0]);var d=sm.segment_util.computeOutShape(p.shape,c,o),f=Fa.sizeFromShape([p.shape[c]]),h=CB({inputs:{x:p},backend:n,attrs:{shape:[-1,f]}});u.push(h);var m=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=sm.segment_util.segOpComputeOptimalWindowSize(c,o),p=new ZH({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),d=n.compileAndRun(p,[t,a],i);if(u.push(d),d.shape[1]===o)return d;var f=oj({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),h=SH({inputs:{x:f},backend:n,attrs:{reps:[c/l]}});return u.push(f),u.push(h),e(d,r,h,i,o)}(h,"unsortedSegmentSum",i,Ni(a.dtype),o),v=CB({inputs:{x:m},backend:n,attrs:{shape:d}}),g=v;if(null!=l){u.push(v);var y=sm.getUndoAxesPermutation(l);g=zB({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},PH=0,BH=[BB,VB,GB,HB,XB,JB,$B,eW,oW,sW,cW,pW,fW,mW,gW,xW,kW,IW,NW,TW,_W,OW,MW,zW,VW,jW,KW,lB,QW,iV,dV,gV,yV,bV,xV,wV,IV,TV,EV,DV,ZV,OV,zV,BV,UV,GV,HV,KV,XV,QV,JV,eU,nU,aU,oU,cU,dU,vU,yU,kU,SU,TU,CU,EU,AU,DU,OU,zU,uB,LU,nV,BU,VU,GU,fB,HU,KU,XU,QU,$U,tG,rG,iG,uG,lG,dG,hG,mG,vG,bG,xG,kG,wG,SG,NG,EG,AG,PG,TB,BG,VG,GG,HG,PW,KG,QG,JG,nj,aj,vB,ij,sj,WW,DG,cj,pj,fj,EB,vj,yj,kj,Sj,Tj,Ej,Aj,Fj,Zj,Mj,Lj,Bj,Vj,Gj,Hj,Kj,ZW,LG,Yj,Qj,Jj,$j,eH,tH,nH,rH,oH,uH,pH,dH,hH,mH,vH,gH,MG,MB,bH,kH,IH,_H,RH,LB,FH,DH,LH,YG];PH<BH.length;PH++){Ta(BH[PH])}!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(OH||(OH={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"}(MH||(MH={}));var WH={kernelName:va,backendName:"wasm",setupFunc:function(e){zH=e.wasm.cwrap(va,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");var u=r.transposeA,c=r.transposeB,l=r.activation,p=r.leakyreluAlpha,d=n.dataIdMap.get(a.dataId).id,f=n.dataIdMap.get(i.dataId).id,m=0;if(null!=o){var v=n.dataIdMap.get(o.dataId);if(1!==v.shape.length)throw new Error("_FusedMatMul only supports rank-1 bias but got rank ".concat(v.shape.length,"."));m=v.id}var g=null==s?0:n.dataIdMap.get(s.dataId).id,y=MH[l];if(null==y)throw new Error("".concat(l," activation not yet supported for FusedConv2D in the wasm backend."));var b=u?a.shape[2]:a.shape[1],x=c?i.shape[1]:i.shape[2],k=pu.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),w=n.makeOutput([].concat((0,h.Z)(k),[b,x]),a.dtype),S=n.dataIdMap.get(w.dataId).id,I=new Uint8Array(new Int32Array(a.shape).buffer),N=new Uint8Array(new Int32Array(i.shape).buffer);return zH(d,I,a.shape.length,f,N,i.shape.length,u,c,y,m,g,p||0,S),w}};function VH(e,t){var n;return{kernelName:e,backendName:"wasm",setupFunc:function(t){n=t.wasm.cwrap(e,null,["number","number","number"])},kernelFunc:function(e){var r=e.backend,a=e.inputs.x,i=r.dataIdMap.get(a.dataId).id,o=r.makeOutput(a.shape,t||a.dtype),s=r.dataIdMap.get(o.dataId).id;return 0===Fa.sizeFromShape(o.shape)||n(i,OH[a.dtype],s),o}}}var UH=VH(ut);function GH(e,t,n){var r;return{kernelName:e,backendName:"wasm",setupFunc:function(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(e){var t=e.backend,a=e.inputs,i=a.a,o=a.b,s=t.dataIdMap.get(i.dataId).id,u=t.dataIdMap.get(o.dataId).id,c=null!=n?n:i.dtype,l=sm.assertAndGetBroadcastShape(i.shape,o.shape),p=t.makeOutput(l,c);if(0===Fa.sizeFromShape(l))return p;var d=new Uint8Array(new Int32Array(i.shape).buffer),f=new Uint8Array(new Int32Array(o.shape).buffer),h=t.dataIdMap.get(p.dataId).id;return r(s,d,i.shape.length,u,f,o.shape.length,OH[i.dtype],h),p}}}var jH,HH=GH(pt);var qH={kernelName:dt,backendName:"wasm",setupFunc:function(e){jH=e.wasm.cwrap(dt,null,["array","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===Fa.sizeFromShape(r.shape))return r;var a=t.map((function(e){return n.dataIdMap.get(e.dataId).id})),i=new Uint8Array(new Int32Array(a).buffer),o=n.dataIdMap.get(r.dataId).id;return jH(i,a.length,OH[r.dtype],o),r}};function KH(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var XH,YH={kernelName:Sn,backendName:"wasm",kernelFunc:KH};function QH(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=function(e,t){for(var n=[],r=[],a=0;a<e.length;++a)1!==e[a]&&n.push(e[a]),1!==e[t[a]]&&r.push(t[a]);for(var i=0;i<r.length;++i){for(var o=-1,s=0;s<r.length;++s)r[s]>=i&&(-1===o||r[o]>r[s])&&(o=s);r[o]=i}return[n,r]}(t.x.shape,r.perm),i=(0,m.Z)(a,2),o=i[0],s=i[1],u=!0,c=0;c<s.length;c++)s[c]!==c&&(u=!1);var l=function(e,t){for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),p={dataId:t.x.dataId,shape:o,dtype:t.x.dtype};if(u){var d=KH({inputs:t,backend:n});return d.shape=l,d}var f=n.makeOutput(l,p.dtype),h=n.dataIdMap.get(p.dataId).id,v=n.dataIdMap.get(f.dataId).id,g=new Uint8Array(new Int32Array(s).buffer),y=new Uint8Array(new Int32Array(p.shape).buffer);return XH(h,y,p.shape.length,OH[p.dtype],v,g,s.length),f}var JH,$H={kernelName:sa,backendName:"wasm",kernelFunc:QH,setupFunc:function(e){XH=e.wasm.cwrap(sa,null,["number","array","number","number","number","array","number"])}};function eq(e,t,n){var r=e.shape,a=e.shape.length,i=Fa.parseAxisParam(t,r),o=i,s=sm.getAxesPermutation(o,a),u=null,c=!1;if(null!=s){for(var l=new Array(a),p=0;p<l.length;p++)l[p]=r[s[p]];o=sm.getInnerMostAxes(o.length,a),u=QH({inputs:{x:e},attrs:{perm:s},backend:n});var d=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==d&&(c=!0)}return{transposed:u,originalAxes:i,axes:o,inputWasTransposed:c}}var tq,nq={kernelName:ft,backendName:"wasm",setupFunc:function(e){JH=e.wasm.cwrap(ft,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=eq(o,a,t),l=c.transposed,p=c.axes,d=c.originalAxes,f=c.inputWasTransposed;f&&(u=l,s=w=t.dataIdMap.get(l.dataId).id);var h=u.shape.length;sm.assertAxesAreInnerMostDims("all",p,h);var v=sm.computeOutAndReduceShapes(u.shape,p),g=(0,m.Z)(v,2),y=g[0],b=g[1],x=Fa.sizeFromShape(b),k=t.makeOutput(y,o.dtype);if(0!==Fa.sizeFromShape(u.shape)){var w=t.dataIdMap.get(k.dataId).id;JH(s,x,w)}if(f&&t.disposeData(l.dataId),i){var S=sm.expandShapeToKeepDim(k.shape,d);k.shape=S}return k}};var rq,aq={kernelName:ht,backendName:"wasm",setupFunc:function(e){tq=e.wasm.cwrap(ht,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=eq(o,a,t),l=c.transposed,p=c.axes,d=c.originalAxes,f=c.inputWasTransposed;f&&(u=l,s=w=t.dataIdMap.get(l.dataId).id);var h=u.shape.length;sm.assertAxesAreInnerMostDims("any",p,h);var v=sm.computeOutAndReduceShapes(u.shape,p),g=(0,m.Z)(v,2),y=g[0],b=g[1],x=Fa.sizeFromShape(b),k=t.makeOutput(y,o.dtype);if(0!==Fa.sizeFromShape(u.shape)){var w=t.dataIdMap.get(k.dataId).id;tq(s,x,w)}if(f&&t.disposeData(l.dataId),i){var S=sm.expandShapeToKeepDim(k.shape,d);k.shape=S}return k}};var iq,oq={kernelName:mt,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.axis,a=n.x,i=t.dataIdMap.get(a.dataId).id,o=i,s=a,u=eq(a,r,t),c=u.transposed,l=u.axes,p=u.inputWasTransposed;if(p){var d=t.dataIdMap.get(c.dataId).id;d!==i&&(s=c,o=d)}var f=s.shape.slice(0,-1),h=t.makeOutput(f,"int32"),m=t.dataIdMap.get(h.dataId).id,v=Fa.sizeFromShape(h.shape),g=s.shape[l[0]];return rq(o,OH[s.dtype],v,g,m),p&&t.disposeData(c.dataId),h},setupFunc:function(e){rq=e.wasm.cwrap(mt,null,["number","number","number","number","number"])}};var sq={kernelName:wt,backendName:"wasm",setupFunc:function(e){iq=e.wasm.cwrap(wt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=sm.computePool2DInfo(a.shape,o,s,1,u,c),p=l.filterHeight,d=l.filterWidth,f=l.padInfo.top,h=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,g=l.strideHeight,y=l.strideWidth,b=l.inChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));if(1!==l.dilationWidth||1!==l.dilationHeight)throw new Error("was backend only supports average pooling with dilation = [1, 1], got [".concat(l.dilationHeight,", ").concat(l.dilationWidth,"]."));var x=r.makeOutput(l.outShape,"float32"),k=r.dataIdMap.get(x.dataId).id;return iq(i,a.shape[0],a.shape[1],a.shape[2],p,d,f,h,m,v,g,y,b,k),x}};function uq(e){var t=e.inputs,n=e.attrs,r=t.x,a=n.shape,i=Fa.sizeFromShape(r.shape),o=Fa.inferFromImplicitShape(a,i);return Fa.assert(i===Fa.sizeFromShape(o),(function(){return"new shape: ".concat(o,", old shape: ").concat(r.shape,". New shape and old shape must have the same number of elements.")})),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:o,dtype:r.dtype}}var cq,lq={kernelName:xr,backendName:"wasm",kernelFunc:uq};var pq={kernelName:Tt,backendName:"wasm",setupFunc:function(e){cq=e.wasm.cwrap(Tt,null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],p=s?i.shape[c-1]:i.shape[c-2],d=o?a.shape[u-1]:a.shape[u-2],f=s?i.shape[c-2]:i.shape[c-1],h=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=Fa.sizeFromShape(h),g=Fa.sizeFromShape(m),y=pu.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);Fa.assert(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(p,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(o," and transposeB=").concat(s," must match.")}));var b=s?[g,f,p]:[g,p,f],x=uq({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,d]:[v,d,l]}}),k=uq({inputs:{x:i},backend:n,attrs:{shape:b}}),w=n.dataIdMap.get(x.dataId).id,S=n.dataIdMap.get(k.dataId).id,I=o?x.shape[2]:x.shape[1],N=s?k.shape[1]:k.shape[2],T=Math.max(v,g),C=n.makeOutput([T,I,N],x.dtype),E=n.dataIdMap.get(C.dataId).id,_=new Uint8Array(new Int32Array(x.shape).buffer),A=new Uint8Array(new Int32Array(k.shape).buffer);return cq(w,_,x.shape.length,S,A,k.shape.length,o,s,E),n.disposeData(x.dataId),n.disposeData(k.dataId),C.shape=y,C}};function dq(e){var t=e.inputs.x,n=e.attrs,r=n.begin,a=n.size,i=e.backend,o=Ru.parseSliceParams(t,r,a),s=(0,m.Z)(o,2),u=s[0],c=s[1],l=Ru.isSliceContinous(t.shape,u,c),p=i.readSync(t.dataId),d=i.makeOutput(c,t.dtype),f=Fa.computeStrides(t.shape),h=i.dataIdMap.get(d.dataId);if(l){var v=Ru.computeFlatOffset(u,f);return"string"===t.dtype?h.stringBytes=p.slice(v,v+Fa.sizeFromShape(c)):i.typedArrayFromHeap(d).set(p.subarray(v,v+Fa.sizeFromShape(c))),d}if("string"===t.dtype){var g=WR(p,u,c,t.shape,t.dtype);return h.stringBytes=g,d}var y=i.typedArrayFromHeap(d),b=t.shape.length;if(2===b)!function(e,t,n,r,a){for(var i=0,o=r[0],s=r[1],u=o+a[0],c=o;c<u;c++){var l=c*t+s;n.set(e.subarray(l,l+a[1]),i),i+=a[1]}}(p,f[0],y,u,c);else if(3===b)!function(e,t,n,r,a,i){for(var o=0,s=a[0],u=a[1],c=a[2],l=s+i[0],p=u+i[1],d=s;d<l;d++)for(var f=u;f<p;f++){var h=d*t+f*n+c;r.set(e.subarray(h,h+i[2]),o),o+=i[2]}}(p,f[0],f[1],y,u,c);else if(4===b)!function(e,t,n,r,a,i,o){for(var s=0,u=i[0],c=i[1],l=i[2],p=u+o[0],d=c+o[1],f=l+o[2],h=i[3],m=u;m<p;m++)for(var v=c;v<d;v++)for(var g=l;g<f;g++){var y=m*t+v*n+g*r+h;a.set(e.subarray(y,y+o[3]),s),s+=o[3]}}(p,f[0],f[1],f[2],y,u,c);else{var x=WR(p,u,c,t.shape,t.dtype);y.set(x)}return d}var fq={kernelName:Dr,backendName:"wasm",kernelFunc:dq};var hq={kernelName:Ct,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops,s=i.reduce((function(e,t){return e*t})),u=sm.getReshaped(a.shape,i,s),c=sm.getPermuted(u.length,i.length),l=sm.getReshapedPermuted(a.shape,i,s),p=sm.getSliceBeginCoords(o,i.length),d=sm.getSliceSize(l,o,i.length),f=uq({inputs:{x:a},backend:n,attrs:{shape:u}}),h=QH({inputs:{x:f},backend:n,attrs:{perm:c}}),m=dq({inputs:{x:uq({inputs:{x:h},backend:n,attrs:{shape:l}})},backend:n,attrs:{begin:p,size:d}});return n.disposeData(f.dataId),n.disposeData(h.dataId),n.disposeData(f.dataId),m}};function mq(e){var t=e.inputs.x,n=e.attrs.dtype,r=e.backend,a=r.makeOutput(t.shape,n),i=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(i),a}var vq,gq={kernelName:Rt,backendName:"wasm",kernelFunc:mq},yq=VH(Ft);var bq={kernelName:Dt,backendName:"wasm",setupFunc:function(e){vq=e.wasm.cwrap(Dt,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.clipValueMin,o=r.clipValueMax,s=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(u.dataId).id;return vq(s,i,o,c),u}};function xq(e){var t=e.inputs,n=e.backend,r=Fa.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=sm.computeOutShape(t.map((function(e){return e.shape})),r),i=t.filter((function(e){return Fa.sizeFromShape(e.shape)>0}));if(1===i.length)return KH({inputs:{x:i[0]},backend:n});var o=n.makeOutput(a,t[0].dtype);if(0===Fa.sizeFromShape(a))return o;var s=i.map((function(e){return e.shape}));if(sm.assertParamsConsistent(s,r),"string"===i[0].dtype){var u=i.map((function(e){var t=Fa.sizeFromShape(e.shape.slice(r));return uq({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),c=u.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}}));a=sm.computeOutShape(u.map((function(e){return e.shape})),1);var l=1===u[0].shape[0],p=OA(c,a,t[0].dtype,l),d=sm.computeOutShape(i.map((function(e){return e.shape})),r);return o.shape=d,n.dataIdMap.get(o.dataId).stringBytes=sm.fromStringArrayToUint8(p),u.forEach((function(e){return n.disposeData(e.dataId)})),o}for(var f=Fa.sizeFromShape(i[0].shape.slice(0,r)),h=0,m=i.map((function(e){var t=Fa.sizeFromShape(e.shape.slice(r));return h+=t,t})),v=i.map((function(e){return n.typedArrayFromHeap(e)})),g=n.typedArrayFromHeap(o),y=0;y<f;y++)for(var b=y*h,x=0;x<v.length;x++){var k=m[x],w=y*k,S=v[x].subarray(w,w+k);g.set(S,b),b+=k}return o}var kq,wq={kernelName:Mt,backendName:"wasm",kernelFunc:xq};var Sq,Iq={kernelName:zt,backendName:"wasm",setupFunc:function(e){kq=e.wasm.cwrap(zt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,d=n.dataFormat,f=sm.convertConv2DDataFormat(d),h=sm.computeConv2DInfo(a.shape,i.shape,u,c,l,p,!1,f),m=h.filterHeight,v=h.filterWidth,g=h.padInfo.top,y=h.padInfo.right,b=h.padInfo.bottom,x=h.padInfo.left,k=h.dilationHeight,w=h.dilationWidth,S=h.strideHeight,I=h.strideWidth,N=h.inChannels,T=h.outChannels,C="SAME"===h.padInfo.type?1:0;if("channelsLast"!==h.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'".concat(h.dataFormat,"'. Please use 'channelsLast'."));var E=r.makeOutput(h.outShape,"float32"),_=r.dataIdMap.get(E.dataId).id;return kq(o,a.shape[0],a.shape[1],a.shape[2],s,m,v,g,y,b,x,C,k,w,S,I,N,T,_),E}};var Nq,Tq,Cq={kernelName:Pt,backendName:"wasm",setupFunc:function(e){Sq=e.wasm.cwrap(Pt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.dy,i=n.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.inputShape,p=sm.convertConv2DDataFormat(u),d=sm.computeConv2DInfo(l,i.shape,o,1,s,c,!1,p),f=d.batchSize,h=d.filterHeight,v=d.filterWidth,g=d.inChannels,y=d.inHeight,b=d.inWidth,x=d.outChannels,k=d.outHeight,w=d.outWidth,S=d.strideHeight,I=d.strideWidth,N=h-1-d.padInfo.top,T=v-1-d.padInfo.left,C="channelsLast"===d.dataFormat,E=Fa.computeStrides(d.inShape),_=Fa.computeStrides(a.shape),A=Fa.computeStrides(i.shape),R=(0,m.Z)(A,3),F=R[0],D=R[1],Z=R[2],O=E[0],M=C?E[1]:E[2],z=C?E[2]:1,L=C?1:E[1],P=_[0],B=C?_[1]:_[2],W=C?_[2]:1,V=C?1:_[1],U=t.makeOutput(d.inShape,"float32"),G=t.dataIdMap.get(U.dataId).id,j=t.dataIdMap.get(a.dataId).id,H=t.dataIdMap.get(i.dataId).id;return Sq(j,H,f,h,v,y,b,g,k,w,x,S,I,N,T,F,D,Z,O,M,z,L,P,B,W,V,G),U}},Eq=VH(Ut),_q=VH(Gt);!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(Nq||(Nq={}));var Aq,Rq={kernelName:qt,backendName:"wasm",setupFunc:function(e){Tq=e.wasm.cwrap(qt,null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=a.method,o=a.extrapolationValue,s=a.cropSize,u=r.image,c=r.boxes,l=r.boxInd,p=c.shape[0],d=(0,m.Z)(s,2),f=d[0],h=d[1],v=[p,f,h,u.shape[3]],g=n.dataIdMap.get(u.dataId);"float32"!==u.dtype&&(t=mq({backend:n,inputs:{x:u},attrs:{dtype:"float32"}}),g=n.dataIdMap.get(t.dataId));var y=g.id,b=n.dataIdMap.get(c.dataId).id,x=n.dataIdMap.get(l.dataId).id,k=n.makeOutput(v,"float32"),w=n.dataIdMap.get(k.dataId).id,S=new Uint8Array(new Int32Array(u.shape).buffer);return Tq(y,b,x,p,S,f,h,Nq[i],o,w),null!=t&&n.disposeData(t.dataId),k}};var Fq,Dq={kernelName:jt,backendName:"wasm",setupFunc:function(e){Aq=e.wasm.cwrap(jt,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Fa.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumprod does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=sm.getAxesPermutation([i],u),l=a;null!==c&&(l=QH({inputs:{x:a},attrs:{perm:c},backend:n}));var p=sm.getInnerMostAxes(1,u)[0];sm.assertAxesAreInnerMostDims("cumprod",[p],u);var d=n.makeOutput(l.shape,l.dtype),f=l.shape[p],h=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(d.dataId).id;Aq(h,o?1:0,s?1:0,f,m,OH[a.dtype]);var v=d;return null!==c&&(v=QH({inputs:{x:d},attrs:{perm:sm.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(d.dataId)),v}};var Zq,Oq={kernelName:Ht,backendName:"wasm",setupFunc:function(e){Fq=e.wasm.cwrap(Ht,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Fa.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumsum does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=sm.getAxesPermutation([i],u),l=a;null!==c&&(l=QH({inputs:{x:a},attrs:{perm:c},backend:n}));var p=sm.getInnerMostAxes(1,u)[0];sm.assertAxesAreInnerMostDims("cumsum",[p],u);var d=n.makeOutput(l.shape,l.dtype),f=l.shape[p],h=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(d.dataId).id;Fq(h,o?1:0,s?1:0,f,m,OH[a.dtype]);var v=d;return null!==c&&(v=QH({inputs:{x:d},attrs:{perm:sm.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(d.dataId)),v}};var Mq,zq={kernelName:Xt,backendName:"wasm",setupFunc:function(e){Zq=e.wasm.cwrap(Xt,null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p="NHWC"===o?[s,u,c,l]:[s,l,u,c],d=t.makeOutput(p,"float32"),f=t.dataIdMap.get(a.dataId).id,h=new Uint8Array(new Int32Array(Fa.computeStrides(a.shape)).buffer),m=new Uint8Array(new Int32Array(p).buffer),v=new Uint8Array(new Int32Array(Fa.computeStrides(p)).buffer),g=t.dataIdMap.get(d.dataId).id;return Zq(f,i,"NHWC"===o?1:0,h,a.shape.length-1,m,v,p.length,g),d}};var Lq={kernelName:Yt,backendName:"wasm",setupFunc:function(e){Mq=e.wasm.cwrap(Yt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,d=null==c?[1,1]:c,f=sm.computeConv2DInfo(a.shape,i.shape,u,d,l,p,!0),h=f.filterHeight,m=f.filterWidth,v=f.padInfo.top,g=f.padInfo.right,y=f.padInfo.bottom,b=f.padInfo.left,x=f.dilationHeight,k=f.dilationWidth,w=f.strideHeight,S=f.strideWidth,I=f.inChannels,N=f.outChannels,T="SAME"===f.padInfo.type?1:0;if("channelsLast"!==f.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'".concat(f.dataFormat,"'. Please use 'channelsLast'."));var C=r.makeOutput(f.outShape,"float32"),E=r.dataIdMap.get(C.dataId).id;return Mq(o,a.shape[0],a.shape[1],a.shape[2],s,h,m,v,g,y,b,T,x,k,w,S,I,N,E),C}},Pq=VH(on),Bq=GH(cn,0,"bool"),Wq=VH(ln,"float32");function Vq(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Fa.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),uq({inputs:{x:a},backend:r,attrs:{shape:s}})}var Uq={kernelName:pn,backendName:"wasm",kernelFunc:Vq};function Gq(e){var t=e.attrs,n=t.shape,r=t.value,a=t.dtype,i=e.backend,o=i.makeOutput(n,a);return i.typedArrayFromHeap(o).fill(r),o}var jq,Hq={kernelName:hn,backendName:"wasm",kernelFunc:Gq};var qq,Kq={kernelName:mn,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n.makeOutput(r.shape,r.dtype),i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,s=(0,m.Z)(r.shape,4),u=s[0],c=s[1],l=s[2],p=s[3];return jq(i,u,c,l,p,o),a},setupFunc:function(e){jq=e.wasm.cwrap(mn,null,["number","number","number","number","number","number"])}},Xq=VH(vn),Yq=GH(gn);var Qq,Jq={kernelName:yn,backendName:"wasm",setupFunc:function(e){qq=e.wasm.cwrap(yn,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.varianceEpsilon,a=n.x,i=n.mean,o=n.variance,s=n.offset,u=n.scale,c=t.dataIdMap.get(a.dataId).id,l=t.dataIdMap.get(i.dataId).id,p=t.dataIdMap.get(o.dataId).id,d=null!=s?t.dataIdMap.get(s.dataId).id:0,f=null!=u?t.dataIdMap.get(u.dataId).id:0,h=t.makeOutput(a.shape,a.dtype);if(0===Fa.sizeFromShape(a.shape))return h;var m=t.dataIdMap.get(h.dataId).id;return qq(c,l,p,d,f,r,m),h}};var $q,eK={kernelName:ga,backendName:"wasm",setupFunc:function(e){Qq=e.wasm.cwrap(ga,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,d=n.dimRoundingMode,f=n.activation,h=n.leakyreluAlpha,m=sm.computeConv2DInfo(a.shape,i.shape,u,l,c,d),v=MH[f];if(null==v)throw new Error("".concat(f," activation not yet supported for FusedConv2D in the wasm backend."));var g=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(i.dataId).id,b=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==b)throw new Error("FusedConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(b,")"));x=k.id}var w=m.filterHeight,S=m.filterWidth,I=m.padInfo.top,N=m.padInfo.right,T=m.padInfo.bottom,C=m.padInfo.left,E=m.dilationHeight,_=m.dilationWidth,A=m.strideHeight,R=m.strideWidth,F=m.inChannels,D="SAME"===m.padInfo.type?1:0,Z=m.batchSize,O=m.inHeight,M=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var z=r.makeOutput(m.outShape,"float32"),L=r.dataIdMap.get(z.dataId).id,P=null==s?0:r.dataIdMap.get(s.dataId).id;return Qq(g,Z,O,M,y,w,S,x,I,N,T,C,D,E,_,A,R,F,b,v,P,h||0,L),z}};var tK,nK={kernelName:ya,backendName:"wasm",setupFunc:function(e){$q=e.wasm.cwrap(ya,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,d=n.dimRoundingMode,f=n.activation,h=n.leakyreluAlpha,m=sm.computeConv2DInfo(a.shape,i.shape,u,l,c,d,!0),v=MH[f];if(null==v)throw new Error("".concat(f," activation not yet supported for FusedDepthwiseConv2D in the wasm backend."));var g=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(i.dataId).id,b=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedDepthwiseConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==b)throw new Error("FusedDepthwiseConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(b,")"));x=k.id}var w=m.filterHeight,S=m.filterWidth,I=m.padInfo.top,N=m.padInfo.right,T=m.padInfo.bottom,C=m.padInfo.left,E=m.dilationHeight,_=m.dilationWidth,A=m.strideHeight,R=m.strideWidth,F=m.inChannels,D="SAME"===m.padInfo.type?1:0,Z=m.batchSize,O=m.inHeight,M=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var z=r.makeOutput(m.outShape,"float32"),L=r.dataIdMap.get(z.dataId).id,P=null==s?0:r.dataIdMap.get(s.dataId).id;return $q(g,Z,O,M,y,w,S,x,I,N,T,C,D,E,_,A,R,F,b,v,P,h||0,L),z}};var rK,aK={kernelName:xn,backendName:"wasm",setupFunc:function(e){tK=e.wasm.cwrap(xn,null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.params,a=n.indices,i=Nu.prepareAndValidate(r,a),o=(0,m.Z)(i,4),s=o[0],u=o[1],c=o[2],l=o[3],p=t.makeOutput(s,r.dtype);if(0===u)return p;var d=a.shape,f=d[d.length-1],h=t.dataIdMap.get(r.dataId).id,v=t.dataIdMap.get(a.dataId).id,g=new Uint8Array(new Int32Array(l).buffer),y=t.dataIdMap.get(p.dataId).id;return tK(h,OH[r.dtype],v,u,f,c,g,y),p}};var iK,oK={kernelName:bn,backendName:"wasm",setupFunc:function(e){rK=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(e){for(var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=n.indices,o=r.axis,s=r.batchDims,u=Fa.parseAxisParam(o,a.shape)[0],c=t.readSync(i.dataId),l=a.shape[u],p=function(e){var t=c[e];Fa.assert(t<=l-1&&t>=0,(function(){return"GatherV2: the index value ".concat(t," is not in [0, ").concat(l-1,"]")}))},d=0;d<c.length;++d)p(d);var f=sm.segment_util.collectGatherOpShapeInfo(a,i,u,s),h=uq({inputs:{x:a},attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]},backend:t}),m=Fa.sizeFromShape(i.shape),v=uq({inputs:{x:i},attrs:{shape:[f.batchSize,m/f.batchSize]},backend:t}),g=[f.batchSize,f.outerSize,m/f.batchSize,f.sliceSize],y=t.makeOutput(g,a.dtype);if(0===Fa.sizeFromShape(a.shape))return y;var b=h.shape.length-1,x=t.dataIdMap.get(h.dataId).id,k=t.dataIdMap.get(v.dataId).id,w=t.dataIdMap.get(y.dataId).id,S=new Uint8Array(new Int32Array(Fa.computeStrides(h.shape)).buffer),I=new Uint8Array(new Int32Array(Fa.computeStrides(g)).buffer);return rK(x,OH[a.dtype],S,b,k,f.batchSize,I,w),t.disposeData(h.dataId),t.disposeData(v.dataId),y.shape=f.outputShape,y}},sK=GH(kn,0,"bool"),uK=GH(wn,0,"bool");var cK,lK={kernelName:_n,backendName:"wasm",setupFunc:function(e){iK=e.wasm.cwrap(_n,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs.x,n=e.attrs.alpha,r=e.backend,a=r.dataIdMap.get(t.dataId).id,i=r.makeOutput(t.shape,"float32");if(0!==Fa.sizeFromShape(t.shape)){var o=r.dataIdMap.get(i.dataId).id;iK(a,OH[t.dtype],n,o)}return i}},pK=GH(An,0,"bool"),dK=GH(Rn,0,"bool"),fK=VH(Dn),hK=GH(On,0,"bool"),mK=VH(Mn),vK=GH(zn,0,"bool"),gK=GH(Ln,0,"bool");var yK,bK={kernelName:Un,backendName:"wasm",setupFunc:function(e){cK=e.wasm.cwrap(Un,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.reductionIndices,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=eq(o,a,t),l=c.transposed,p=c.axes,d=c.originalAxes,f=c.inputWasTransposed;f&&(u=l,s=w=t.dataIdMap.get(l.dataId).id);var h=u.shape.length;sm.assertAxesAreInnerMostDims("max",p,h);var v=sm.computeOutAndReduceShapes(u.shape,p),g=(0,m.Z)(v,2),y=g[0],b=g[1],x=Fa.sizeFromShape(b),k=t.makeOutput(y,o.dtype);if(0!==Fa.sizeFromShape(u.shape)){var w=t.dataIdMap.get(k.dataId).id;cK(s,OH[o.dtype],x,w)}if(f&&t.disposeData(l.dataId),i){var S=sm.expandShapeToKeepDim(k.shape,d);k.shape=S}return k}},xK=GH(Gn);var kK,wK={kernelName:jn,backendName:"wasm",setupFunc:function(e){yK=e.wasm.cwrap(jn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id;Fa.assert("float32"===a.dtype,(function(){return"Error in MaxPool: only float32 input is supported. Got ".concat(a.dtype,".")}));var o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=sm.computePool2DInfo(a.shape,o,s,1,u,c),p=l.filterHeight,d=l.filterWidth,f=l.padInfo.top,h=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,g=l.dilationHeight,y=l.dilationWidth,b=l.strideHeight,x=l.strideWidth,k=l.inChannels,w=l.outChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));var S=r.makeOutput(l.outShape,"float32"),I=r.dataIdMap.get(S.dataId).id;return yK(i,a.shape[0],a.shape[1],a.shape[2],p,d,f,h,m,v,g,y,b,x,k,w,I),S}};var SK,IK={kernelName:Yn,backendName:"wasm",setupFunc:function(e){kK=e.wasm.cwrap(Yn,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=eq(o,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,h=l.inputWasTransposed,v=d;h&&(I=t.dataIdMap.get(p.dataId).id)!==s&&(c=p,u=I,v=sm.getInnerMostAxes(v.length,c.shape.length)),sm.assertAxesAreInnerMostDims("mean",v,c.shape.length);var g=sm.computeOutAndReduceShapes(c.shape,v),y=(0,m.Z)(g,2),b=y[0],x=y[1],k=Fa.sizeFromShape(x),w=c;"float32"!==c.dtype&&(w=mq({backend:t,inputs:{x:c},attrs:{dtype:"float32"}}),u=t.dataIdMap.get(w.dataId).id);var S=t.makeOutput(b,"float32");if(0!==Fa.sizeFromShape(c.shape)){var I=t.dataIdMap.get(S.dataId).id;kK(u,k,I)}if(h&&t.disposeData(p.dataId),i){var N=sm.expandShapeToKeepDim(S.shape,f);S.shape=N}return"float32"!==c.dtype&&t.disposeData(w.dataId),S}};var NK,TK,CK={kernelName:Qn,backendName:"wasm",setupFunc:function(e){SK=e.wasm.cwrap(Qn,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=eq(o,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,h=l.inputWasTransposed;h&&(S=t.dataIdMap.get(p.dataId).id)!==s&&(c=p,u=S);var v=c.shape.length;sm.assertAxesAreInnerMostDims("min",d,v);var g=sm.computeOutAndReduceShapes(c.shape,d),y=(0,m.Z)(g,2),b=y[0],x=y[1],k=Fa.sizeFromShape(x),w=t.makeOutput(b,c.dtype);if(0!==Fa.sizeFromShape(c.shape)){var S=t.dataIdMap.get(w.dataId).id;SK(u,OH[o.dtype],k,S)}if(h&&t.disposeData(p.dataId),i){var I=sm.expandShapeToKeepDim(w.shape,f);w.shape=I}return w}},EK=GH(Jn);!function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"}(NK||(NK={}));var _K,AK={kernelName:$n,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.mode,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]})),s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),d=a.map((function(e){return e[1]})),f=new Uint8Array(new Int32Array(p).buffer),h=new Uint8Array(new Int32Array(d).buffer);return TK(s,l,t.shape.length,OH[t.dtype],f,h,NK[i],c),u},setupFunc:function(e){TK=e.wasm.cwrap($n,null,["number","array","number","number","array","array","number","number"])}},RK=GH(nr),FK=VH(rr);function DK(e,t){var n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],i=n[2],o=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:i,pValidOutputs:o}}var ZK,OK={kernelName:ir,backendName:"wasm",setupFunc:function(e){_K=e.wasm.cwrap(ir,"number",["number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=n.boxes,u=n.scores,c=t.dataIdMap.get(s.dataId).id,l=t.dataIdMap.get(u.dataId).id,p=DK(t,_K(c,l,i,a,o)),d=p.pSelectedIndices,f=p.selectedSize,h=p.pSelectedScores,m=p.pValidOutputs;return t.wasm._free(h),t.wasm._free(m),t.makeOutput([f],"int32",d)}};var MK,zK={kernelName:or,backendName:"wasm",setupFunc:function(e){ZK=e.wasm.cwrap(or,"number",["number","number","number","number","number","bool"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.padToMaxOutputSize,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,d=DK(t,ZK(l,p,i,a,o,s)),f=d.pSelectedIndices,h=d.selectedSize,m=d.pSelectedScores,v=d.pValidOutputs;return t.wasm._free(m),[t.makeOutput([h],"int32",f),t.makeOutput([],"int32",v)]}};var LK,PK={kernelName:sr,backendName:"wasm",setupFunc:function(e){MK=e.wasm.cwrap(sr,"number",["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.softNmsSigma,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,d=DK(t,MK(l,p,i,a,o,s)),f=d.pSelectedIndices,h=d.selectedSize,m=d.pSelectedScores,v=d.pValidOutputs;return t.wasm._free(v),[t.makeOutput([h],"int32",f),t.makeOutput([h],"float32",m)]}},BK=GH(ar,0,"bool");var WK={kernelName:cr,backendName:"wasm",setupFunc:function(e){LK=e.wasm.cwrap(cr,null,["number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue,u=n.makeOutput([].concat((0,h.Z)(a.shape),[i]),"int32"),c=n.dataIdMap.get(u.dataId).id,l=n.dataIdMap.get(a.dataId).id;return LK(l,i,o,s,c),u}};var VK={kernelName:ur,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}};var UK,GK={kernelName:lr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return Vq({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Fa.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Fa.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=xq({inputs:t.map((function(e){var t=Vq({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeData(e.dataId)})),s}};var jK,HK={kernelName:pr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.constantValue,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]}));if(0===Fa.sizeFromShape(t.shape))return Gq({backend:n,attrs:{shape:o,value:i,dtype:t.dtype}});var s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),d=a.map((function(e){return e[1]})),f=new Uint8Array(new Int32Array(p).buffer),h=new Uint8Array(new Int32Array(d).buffer);return UK(s,l,t.shape.length,OH[t.dtype],f,h,i,c),u},setupFunc:function(e){UK=e.wasm.cwrap(pr,null,["number","array","number","number","array","array","number","number"])}},qK=GH(fr);var KK,XK={kernelName:hr,backendName:"wasm",setupFunc:function(e){jK=e.wasm.cwrap(hr,null,["number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,s=i,u=r,c=u;"float32"!==u.dtype&&(c=mq({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),s=n.dataIdMap.get(c.dataId).id);var l=n.makeOutput(r.shape,"float32"),p=n.dataIdMap.get(l.dataId).id;return jK(s,o,p),"float32"!==u.dtype&&n.disposeData(c.dataId),l}};var YK,QK={kernelName:mr,backendName:"wasm",setupFunc:function(e){KK=e.wasm.cwrap(mr,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=eq(o,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,h=l.inputWasTransposed,v=d;h&&(S=t.dataIdMap.get(p.dataId).id)!==s&&(c=p,u=S,v=sm.getInnerMostAxes(v.length,c.shape.length)),sm.assertAxesAreInnerMostDims("prod",v,c.shape.length);var g=sm.computeOutAndReduceShapes(c.shape,v),y=(0,m.Z)(g,2),b=y[0],x=y[1],k=Fa.sizeFromShape(x),w=t.makeOutput(b,c.dtype);if(0!==Fa.sizeFromShape(c.shape)){var S=t.dataIdMap.get(w.dataId).id;KK(u,k,OH[w.dtype],S)}if(h&&t.disposeData(p.dataId),i){var I=sm.expandShapeToKeepDim(w.shape,f);w.shape=I}return w}},JK={kernelName:vr,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=DR(r,a,i,o),u=t.makeOutput([s.length],o);return t.typedArrayFromHeap(u).set(s),u}},$K=GH(rn),eX=VH(br),tX=VH(Nr);var nX,rX={kernelName:Sr,backendName:"wasm",setupFunc:function(e){YK=e.wasm.cwrap(Sr,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.images,o=a.alignCorners,s=a.halfPixelCenters,u=a.size,c=(0,m.Z)(u,2),l=c[0],p=c[1],d=(0,m.Z)(i.shape,4),f=d[0],h=d[1],v=d[2],g=d[3],y=[f,l,p,g],b=n.dataIdMap.get(i.dataId);"float32"!==b.dtype&&(t=mq({backend:n,inputs:{x:i},attrs:{dtype:"float32"}}),b=n.dataIdMap.get(t.dataId));var x=b.id,k=n.makeOutput(y,"float32");if(0===Fa.sizeFromShape(i.shape))return k;var w=n.dataIdMap.get(k.dataId).id;return YK(x,f,h,v,g,l,p,o?1:0,s?1:0,w),null!=t&&n.disposeData(t.dataId),k}};var aX,iX={kernelName:kr,backendName:"wasm",setupFunc:function(e){nX=e.wasm.cwrap(kr,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,m.Z)(s,2),c=u[0],l=u[1],p=(0,m.Z)(a.shape,4),d=p[0],f=p[1],h=p[2],v=p[3],g=[d,c,l,v],y=t.makeOutput(g,"float32");if(0===Fa.sizeFromShape(a.shape))return y;var b,x=t.dataIdMap.get(a.dataId);"float32"!==x.dtype&&(b=mq({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),x=t.dataIdMap.get(b.dataId));var k=x.id,w=t.dataIdMap.get(y.dataId).id;return nX(k,d,f,h,v,c,l,i?1:0,o?1:0,w),null!=b&&t.disposeData(b.dataId),y}};var oX,sX={kernelName:Tr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=Fa.parseAxisParam(i,a.shape);if(0===a.shape.length)return KH({inputs:{x:a},backend:n});var s=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(s.dataId).id,l=new Uint8Array(new Int32Array(o).buffer),p=new Uint8Array(new Int32Array(a.shape).buffer);aX(u,l,o.length,p,a.shape.length,c);var d=uq({inputs:{x:s},attrs:{shape:a.shape},backend:n});return n.disposeData(s.dataId),d},setupFunc:function(e){aX=e.wasm.cwrap(Tr,null,["number","array","number","array","number","number"])}};var uX,cX={kernelName:ma,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=r.radians,o=r.fillValue,s=r.center,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(a.dataId).id,l=n.dataIdMap.get(u.dataId).id,p=(0,m.Z)(a.shape,4),d=p[0],f=p[1],v=p[2],g=p[3],y=sm.getImageCenter(s,f,v),b=(0,m.Z)(y,2),x=b[0],k=b[1],w="number"==typeof o?[o,o,o,0===o?0:255]:[].concat((0,h.Z)(o),[255]),S=new Uint8Array(new Int32Array(w).buffer);return oX(c,d,f,v,g,i,x,k,S,w.length,l),u},setupFunc:function(e){oX=e.wasm.cwrap(ma,null,["number","number","number","number","number","number","number","number","array","number","number"])}},lX=VH(Cr),pX=VH(Er);var dX,fX={kernelName:_r,backendName:"wasm",setupFunc:function(e){uX=e.wasm.cwrap(_r,null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.indices,i=n.updates,o=r.shape,s=t.makeOutput(o,i.dtype);if(0===Fa.sizeFromShape(o))return s;var u=Cu.calculateShapes(i,a,o),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,d=u.strides,f=u.outputSize,h=t.dataIdMap.get(a.dataId).id,m=t.dataIdMap.get(i.dataId).id,v=new Uint8Array(new Int32Array(d).buffer),g=t.dataIdMap.get(s.dataId).id;return uX(h,m,OH[i.dtype],c,l,p,v,f,g),s}};var hX,mX={kernelName:Rr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(i.dataId).id,c=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(c.dataId).id,p=r.shape.length,d=a.shape.length,f=0===p||p>1||1===d?1:Fa.sizeFromShape(a.shape.slice(1));return dX(o,s,u,f,l),c},setupFunc:function(e){dX=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}};var vX,gX={kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(e){hX=e.wasm.cwrap(zr,null,["number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.x,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),i=t.dataIdMap.get(a.dataId).id;return 0===Fa.sizeFromShape(a.shape)||hX(r,i),a}},yX=VH(Zr);var bX={kernelName:Ur,backendName:"wasm",setupFunc:function(e){vX=e.wasm.cwrap(Ur,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.logits,r=e.attrs.dim,a=t.dataIdMap.get(n.dataId).id,i=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(i.dataId).id,s=n.shape[r],u=Fa.sizeFromShape(n.shape)/s;return 0===Fa.sizeFromShape(i.shape)||vX(a,o,s,u),i}};var xX,kX={kernelName:Wr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings,s=Fa.sizeFromShape(i),u=[[0,0]];u.push.apply(u,(0,h.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=HK.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=sm.getReshaped(l.shape,i,s,!1),d=sm.getPermuted(p.length,i.length,!1),f=sm.getReshapedPermuted(l.shape,i,s,!1),m=uq({inputs:{x:l},backend:n,attrs:{shape:p}}),v=QH({inputs:{x:m},backend:n,attrs:{perm:d}}),g=uq({inputs:{x:v},backend:n,attrs:{shape:f}});return n.disposeData(l.dataId),n.disposeData(m.dataId),n.disposeData(v.dataId),g}};var wX,SX={kernelName:Gr,backendName:"wasm",setupFunc:function(e){xX=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=r.indices,i=r.values,o=r.denseShape,s=r.defaultValue,u=a.shape[0],c=a.shape[1],l=n.readSync(o.dataId)[0],p=[u+l,c],d=n.dataIdMap.get(a.dataId).id,f=n.dataIdMap.get(i.dataId).id,h=n.dataIdMap.get(s.dataId).id,m=n.makeOutput(p,a.dtype),v=n.dataIdMap.get(m.dataId).id,g=n.makeOutput(p.slice(0,1),i.dtype),y=n.dataIdMap.get(g.dataId).id,b=n.makeOutput([l],"bool"),x=n.dataIdMap.get(b.dataId).id,k=n.makeOutput([u],a.dtype),w=n.dataIdMap.get(k.dataId).id,S=n.makeOutput([4],"int32"),I=n.dataIdMap.get(S.dataId).id,N=xX(d,f,OH[i.dtype],u,l,c,h,v,y,x,w,I),T=n.readSync(S.dataId);switch(T[0]){case 1:t=sm.getSparseFillEmptyRowsIndicesDenseShapeMismatch(T[1]);break;case 2:t=sm.getSparseFillEmptyRowsNegativeIndexErrorMessage(T[1],T[2]);break;case 3:t=sm.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(T[1],T[2],T[3]);break;default:t=""}if(n.disposeData(S.dataId),t)throw n.disposeData(m.dataId),n.disposeData(g.dataId),n.disposeData(b.dataId),n.disposeData(k.dataId),new Error(t);var C=m,E=g;return N!==p[0]&&(C=dq({inputs:{x:m},attrs:{begin:0,size:[N,c]},backend:n}),E=dq({inputs:{x:g},attrs:{begin:0,size:N},backend:n}),n.disposeData(m.dataId),n.disposeData(g.dataId)),[C,E,b,k]}};var IX,NX={kernelName:jr,backendName:"wasm",setupFunc:function(e){wX=e.wasm.cwrap(jr,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.inputIndices,a=n.inputShape,i=n.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=t.dataIdMap.get(r.dataId).id,s=t.dataIdMap.get(a.dataId).id,u=t.dataIdMap.get(i.dataId).id,c=r.shape[0],l=Fa.sizeFromShape(i.shape),p=t.makeOutput([c,l],r.dtype),d=t.dataIdMap.get(p.dataId).id,f=t.makeOutput([l],i.dtype),h=t.dataIdMap.get(f.dataId).id,m=t.makeOutput([3],"int32"),v=t.dataIdMap.get(m.dataId).id;wX(o,s,u,c,d,h,v);var g,y=t.readSync(m.dataId);switch(y[0]){case 0:g=sm.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(y[1],y[2]);break;case 1:g=sm.getSparseReshapeNegativeOutputDimErrorMessage(y[1],y[2]);break;case 2:g=sm.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage();break;case 3:var b=Array.from(t.readSync(a.dataId)),x=Array.from(t.readSync(f.dataId));g=sm.getSparseReshapeInputOutputMultipleErrorMessage(b,x);break;case 4:var k=Array.from(t.readSync(a.dataId)),w=Array.from(t.readSync(f.dataId));g=sm.getSparseReshapeInputOutputMismatchErrorMessage(k,w);break;default:g=""}if(t.disposeData(m.dataId),g)throw t.disposeData(p.dataId),t.disposeData(f.dataId),new Error(g);return[p,f]}};function TX(e){IX=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function CX(e,t){var n=e.backend,r=e.inputs,a=r.data,i=r.indices,o=r.segmentIds,s=i.shape[0],u=n.readSync(o.dataId,s-1,s)[0],c=s>0?u+1:0;if(c<0)throw new Error(sm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var l=a.shape.slice();l[0]=c;var p=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(i.dataId).id,f=n.dataIdMap.get(o.dataId).id,h=n.makeOutput(l,a.dtype),m=n.dataIdMap.get(h.dataId).id,v=n.makeOutput([4],"int32"),g=n.dataIdMap.get(v.dataId).id;IX(p,OH[a.dtype],a.shape[0],d,f,m,g,t,0);var y,b=n.readSync(v.dataId);switch(b[0]){case 0:y=sm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage();break;case 1:y=sm.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage();break;case 2:y=sm.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(b[1],b[2]);break;case 3:y=sm.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b[1],b[2],b[3]);break;default:y=""}if(n.disposeData(v.dataId),y)throw n.disposeData(h.dataId),new Error(y);return h}var EX={kernelName:Hr,backendName:"wasm",setupFunc:TX,kernelFunc:function(e){return CX(e,!0)}};var _X={kernelName:qr,backendName:"wasm",setupFunc:TX,kernelFunc:function(e){return CX(e,!1)}};var AX,RX={kernelName:Vr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.numOrSizeSplits,o=n.axis,s=Fa.parseAxisParam(o,a.shape)[0],u=sm.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=(0,h.Z)(l);t[s]=e;var n=dq({inputs:{x:a},attrs:{begin:c,size:t},backend:r});return c[s]+=e,n}))}},FX=VH(Pr),DX=VH(Yr),ZX=GH(Xr);var OX,MX={kernelName:fa,backendName:"wasm",setupFunc:function(e){AX=e.wasm.cwrap(fa,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.alpha,a=n.x,i=t.dataIdMap.get(a.dataId).id,o=t.makeOutput(a.shape,a.dtype),s=t.dataIdMap.get(o.dataId).id;return AX(i,r,OH[a.dtype],s),o}};var zX={kernelName:Qr,backendName:"wasm",setupFunc:function(e){OX=e.wasm.cwrap(Qr,null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,d=a.newAxisMask,f=a.shrinkAxisMask,h=Ru.sliceInfo(i.shape,o,s,u,c,l,p,d,f),m=h.finalShapeSparse,v=h.finalShape,g=h.isIdentity,y=h.sliceDim0,b=h.isSimpleSlice,x=h.begin,k=h.end,w=h.strides;if(g)t=uq({inputs:{x:i},backend:n,attrs:{shape:v}});else if(y||b){Fa.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var S=Ru.computeOutShape(x,k,w),I=dq({inputs:{x:i},backend:n,attrs:{begin:x,size:S}});t=uq({inputs:{x:I},backend:n,attrs:{shape:v}}),n.disposeData(I.dataId)}else{var N=n.makeOutput(m,"float32"),T=n.dataIdMap.get(i.dataId).id,C=new Uint8Array(new Int32Array(Fa.computeStrides(i.shape)).buffer),E=new Uint8Array(new Int32Array(x).buffer),_=new Uint8Array(new Int32Array(k).buffer),A=new Uint8Array(new Int32Array(w).buffer),R=new Uint8Array(new Int32Array(m).buffer),F=new Uint8Array(new Int32Array(Fa.computeStrides(m)).buffer),D=n.dataIdMap.get(N.dataId).id;OX(T,C,i.shape.length,E,_,A,R,F,m.length,D),t=uq({inputs:{x:N},backend:n,attrs:{shape:v}}),n.disposeData(N.dataId)}return t}};var LX={kernelName:Jr,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.data,i=n.dataSplits,o=r.separator,s=r.nGramWidths,u=r.leftPad,c=r.rightPad,l=r.padWidth,p=r.preserveShortSequences,d=tF(t.readSync(a.dataId),t.readSync(i.dataId),o,s,u,c,l,p),f=(0,m.Z)(d,2),h=f[0],v=f[1],g=t.makeOutput([h.length],"string");t.dataIdMap.get(g.dataId).stringBytes=h;var y=t.makeOutput(i.shape,"int32");return t.typedArrayFromHeap(y).set(v),[g,y]}};var PX={kernelName:$r,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=n.delimiter,o=r.skipEmpty,s=rF(t.readSync(a.dataId),t.readSync(i.dataId)[0],o),u=(0,m.Z)(s,3),c=u[0],l=u[1],p=u[2],d=l.length,f=t.makeOutput([d,2],"int32");t.typedArrayFromHeap(f).set(c);var h=t.makeOutput([d],"string");t.dataIdMap.get(h.dataId).stringBytes=l;var v=t.makeOutput([2],"int32");return t.typedArrayFromHeap(v).set(p),[f,h,v]}};var BX,WX={kernelName:ea,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=r.numBuckets,o=aF(t.readSync(a.dataId),i),s=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(s).set(o),s}},VX=GH(ta);var UX,GX={kernelName:Br,backendName:"wasm",setupFunc:function(e){BX=e.wasm.cwrap(Br,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=eq(o,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,h=l.inputWasTransposed,v=d;h&&(S=t.dataIdMap.get(p.dataId).id)!==s&&(c=p,u=S,v=sm.getInnerMostAxes(v.length,c.shape.length)),sm.assertAxesAreInnerMostDims("sum",v,c.shape.length);var g=sm.computeOutAndReduceShapes(c.shape,v),y=(0,m.Z)(g,2),b=y[0],x=y[1],k=Fa.sizeFromShape(x),w=t.makeOutput(b,c.dtype);if(0!==Fa.sizeFromShape(c.shape)){var S=t.dataIdMap.get(w.dataId).id;BX(u,k,OH[w.dtype],S)}if(h&&t.disposeData(p.dataId),i){var I=sm.expandShapeToKeepDim(w.shape,f);w.shape=I}return w}},jX=VH(na),HX=VH(ra);var qX,KX={kernelName:aa,backendName:"wasm",setupFunc:function(e){UX=e.wasm.cwrap(aa,null,["number","array","number","array","number","number"])},kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=n.dataIdMap.get(a.dataId).id,o=r.reps,s=new Array(a.shape.length),u=0;u<s.length;u++)s[u]=a.shape[u]*o[u];var c=new Uint8Array(new Int32Array(a.shape).buffer),l=new Uint8Array(new Int32Array(s).buffer),p=n.makeOutput(s,a.dtype),d=n.dataIdMap.get(p.dataId).id;return UX(i,c,a.shape.length,l,s.length,OH[p.dtype],d),p}};var XX,YX={kernelName:ia,backendName:"wasm",setupFunc:function(e){qX=e.wasm.cwrap(ia,null,["number","array","number","number","number","bool","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=n.dataIdMap.get(a.dataId).id,u=new Uint8Array(new Int32Array(a.shape).buffer),c=a.shape.slice();c[c.length-1]=i;var l=n.makeOutput(c,a.dtype),p=n.dataIdMap.get(l.dataId).id,d=n.makeOutput(c,"int32"),f=n.dataIdMap.get(d.dataId).id;return qX(s,u,a.shape.length,OH[a.dtype],i,o,p,f),[l,d]}};var QX={kernelName:oa,backendName:"wasm",setupFunc:function(e){XX=e.wasm.cwrap(oa,null,["number","number","bool","number","number","number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.image,o=r.transforms,s=a.interpolation,u=a.fillMode,c=a.fillValue,l=a.outputShape,p=(0,m.Z)(i.shape,4),d=p[0],f=p[1],h=p[2],v=p[3],g=null!=l?l:[f,h],y=(0,m.Z)(g,2),b=y[0],x=y[1],k=[d,b,x,v],w=new Uint8Array(new Int32Array(Fa.computeStrides(i.shape)).buffer),S=n.makeOutput(k,i.dtype),I=n.dataIdMap.get(S.dataId).id,N=n.dataIdMap.get(i.dataId).id,T=n.dataIdMap.get(o.dataId).id,C="nearest"===s?1:2;switch(u){case"constant":default:t=1;break;case"reflect":t=2;break;case"wrap":t=3;break;case"nearest":t=4}return XX(N,T,o.shape[0]>1,d,b,x,v,h,f,w,i.shape.length-1,C,t,c,I),S}};var JX={kernelName:ca,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape[i],s=a.shape.length,u=new Array(s-1),c=0,l=0;l<s;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o),d=new Array(s).fill(0),f=a.shape.slice();f[i]=1;for(var h=0;h<p.length;h++)d[i]=h,p[h]=dq({inputs:{x:a},attrs:{begin:d,size:f},backend:n});return p.map((function(e){return{dataId:e.dataId,dtype:e.dtype,shape:u}}))}};for(var $X={kernelName:da,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}},eY=0,tY=[WH,UH,HH,qH,nq,aq,oq,sq,pq,hq,gq,yq,bq,wq,Iq,Cq,Eq,_q,Rq,Dq,Oq,zq,Lq,Pq,Bq,Wq,Uq,Hq,Kq,Xq,Yq,Jq,eK,nK,aK,oK,sK,uK,YH,lK,pK,dK,fK,hK,mK,vK,gK,bK,xK,wK,IK,CK,EK,AK,RK,FK,OK,zK,PK,BK,WK,VK,GK,HK,qK,XK,QK,JK,$K,eX,tX,lq,rX,iX,sX,cX,lX,pX,fX,mX,gX,yX,fq,bX,kX,SX,NX,EX,_X,RX,FX,DX,ZX,MX,zX,LX,PX,WX,VX,GX,jX,HX,KX,YX,QX,$H,JX,$X];eY<tY.length;eY++){Ta(tY[eY])}var nY=rt();nY.registerFlag("WASM_HAS_SIMD_SUPPORT",(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 1:case"end":return e.stop()}}),e)})))),nY.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!nY.get("IS_NODE")){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))));case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[2,6]])}))));var rY=Z($()),aY=Z(ee()),iY=Z(te()),oY=rY.default||rY,sY=iY.default||iY,uY=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this)).wasm=e,r.dataIdNextNumber=1,r.wasm.tfjs.initWithThreadsCount(kY),wY=r.wasm.tfjs.getThreadsCount(),r.dataIdMap=new ne((0,u.Z)(r),Gs()),r}return(0,b.Z)(n,[{key:"write",value:function(e,t,n){var r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}},{key:"numDataIds",value:function(){return this.dataIdMap.numDataIds()}},{key:"time",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Fa.now(),e.abrupt("return",(t(),{kernelMs:Fa.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"move",value:function(e,t,n,r,a){var i=this.dataIdNextNumber++;if("string"!==r){var o=Fa.sizeFromShape(n),s=o*Fa.bytesPerElement(r),u=this.wasm._malloc(s);this.dataIdMap.set(e,{id:i,memoryOffset:u,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(i,o,u),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,s),u)}else{var c=t;this.dataIdMap.set(e,{id:i,stringBytes:c,shape:n,dtype:r,memoryOffset:null,refCount:a})}}},{key:"read",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e,t,n){var r=this.dataIdMap.get(e),a=r.memoryOffset,i=r.dtype,o=r.shape,s=r.stringBytes;if("string"===i)return null!=t&&0!==t||!(null==n||n>=s.length)?s.slice(t,n):s;t=t||0,n=n||Fa.sizeFromShape(o);var u=Fa.bytesPerElement(i);return function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype ".concat(t))}}(this.wasm.HEAPU8.slice(a+t*u,a+n*u).buffer,i)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dataIdMap.has(e)){var n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}},{key:"refCount",value:function(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}},{key:"incRef",value:function(e){var t=this.dataIdMap.get(e);null!=t&&t.refCount++}},{key:"floatPrecision",value:function(){return 32}},{key:"getMemoryOffset",value:function(e){return this.dataIdMap.get(e).memoryOffset}},{key:"dispose",value:function(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}},{key:"memory",value:function(){return{unreliable:!1}}},{key:"makeOutput",value:function(e,t,n){var r;if(null==n)r=this.write(null,e,t);else{var a=this.dataIdNextNumber++;r={id:a},this.dataIdMap.set(r,{id:a,memoryOffset:n,shape:e,dtype:t,refCount:1});var i=Fa.sizeFromShape(e);this.wasm.tfjs.registerTensor(a,i,n)}return{dataId:r,shape:e,dtype:t}}},{key:"typedArrayFromHeap",value:function(e){var t=e.shape,n=e.dtype,r=e.dataId,a=this.wasm.HEAPU8.buffer,i=this.dataIdMap.get(r).memoryOffset,o=Fa.sizeFromShape(t);switch(n){case"float32":return new Float32Array(a,i,o);case"int32":return new Int32Array(a,i,o);case"bool":return new Uint8Array(a,i,o);default:throw new Error("Unknown dtype ".concat(n))}}}]),n}(re);function cY(e){return function(t,n){return Fa.fetch(e,{credentials:"same-origin"}).then((function(r){r.ok||t.env.a("failed to load wasm binary file at '".concat(e,"'")),r.arrayBuffer().then((function(e){WebAssembly.instantiate(e,t).then((function(e){n(e.instance,e.module)}))}))})),{}}}function lY(e,t,n){if(null!=hY)return hY;var r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=vY&&null!=vY[r]?vY[r]:n+r}function pY(){return dY.apply(this,arguments)}function dY(){return dY=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([rt().getAsync("WASM_HAS_SIMD_SUPPORT"),rt().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);case 2:return t=e.sent,n=(0,m.Z)(t,2),r=n[0],a=n[1],e.abrupt("return",new Promise((function(e,t){var n={locateFile:function(e,t){if(e.endsWith(".worker.js")){var n=aY.wasmWorkerContents.replace(/\n/g,"\\n"),i=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(i)}return e.endsWith(".wasm")?lY(r,a,null!=mY?mY:t):t+e}};yY&&(n.instantiateWasm=cY(lY(r,a,null!=mY?mY:"")));var i,o=!1;n.onAbort=function(){o||gY||(gY=!0,t({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))},a&&r&&null==hY?(n.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+oY.toString()],{type:"text/javascript"}),i=oY(n)):i=sY(n),i.then((function(t){o=!0,gY=!1;t.tfjs={init:t.cwrap("init",null,[]),initWithThreadsCount:t.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:t.cwrap("get_threads_count","number",[]),registerTensor:t.cwrap("register_tensor",null,["number","number","number"]),disposeData:t.cwrap("dispose_data",null,["number"]),dispose:t.cwrap("dispose",null,[])},e({wasm:t})})).catch(t)})));case 7:case"end":return e.stop()}}),e)}))),dY.apply(this,arguments)}var fY=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],hY=null,mY=null,vY={},gY=!1,yY=!1;function bY(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Vs("setWasmPath has been deprecated in favor of setWasmPaths and will be removed in a future release."),gY)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");hY=e,yY=t}function xY(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(gY)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)mY=e;else{vY=e;var n=fY.filter((function(e){return null==vY[e]}));if(n.length>0)throw new Error("There were no entries found for the following binaries: ".concat(n.join(","),". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found."))}yY=t}var kY=-1,wY=-1;function SY(e){kY=e}function IY(){if(-1===wY)throw new Error("WASM backend not initialized.");return wY}var NY="3.19.0";ru("wasm",(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pY();case 2:return t=e.sent,n=t.wasm,e.abrupt("return",new uY(n));case 5:case"end":return e.stop()}}),e)}))),2);var TY={tfjs:"3.19.0","tfjs-core":"3.19.0","tfjs-data":"3.19.0","tfjs-layers":"3.19.0","tfjs-converter":"3.19.0","tfjs-backend-cpu":"3.19.0","tfjs-backend-webgl":"3.19.0","tfjs-backend-wasm":"3.19.0"},CY={};function EY(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.beginPath(),t.slice(1).forEach((function(n,r){var a=n.x,i=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(a,i)})),n){var r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}I(CY,{AnchorPosition:function(){return TQ},DrawBox:function(){return AQ},DrawBoxOptions:function(){return _Q},DrawFaceLandmarks:function(){return PJ},DrawFaceLandmarksOptions:function(){return LJ},DrawTextField:function(){return EQ},DrawTextFieldOptions:function(){return CQ},drawContour:function(){return EY},drawDetections:function(){return RQ},drawFaceExpressions:function(){return OJ},drawFaceLandmarks:function(){return BJ}});var _Y={};I(_Y,{computeReshapedDimensions:function(){return BY},getCenterPoint:function(){return WY},isDimensions:function(){return PY},isEven:function(){return zY},isFloat:function(){return MY},isTensor:function(){return RY},isTensor1D:function(){return FY},isTensor2D:function(){return DY},isTensor3D:function(){return ZY},isTensor4D:function(){return OY},isValidNumber:function(){return UY},isValidProbablitiy:function(){return GY},range:function(){return VY},round:function(){return LY}});var AY=function(){function e(t,n){if((0,y.Z)(this,e),!UY(t)||!UY(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have ".concat(JSON.stringify({width:t,height:n})));this._width=t,this._height=n}return(0,b.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"reverse",value:function(){return new e(1/this.width,1/this.height)}}]),e}();function RY(e,t){return e instanceof hi&&e.shape.length===t}function FY(e){return RY(e,1)}function DY(e){return RY(e,2)}function ZY(e){return RY(e,3)}function OY(e){return RY(e,4)}function MY(e){return e%1!==0}function zY(e){return e%2===0}function LY(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=Math.pow(10,t);return Math.floor(e*n)/n}function PY(e){return e&&e.width&&e.height}function BY(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new AY(Math.round(n*a),Math.round(r*a))}function WY(e){return e.reduce((function(e,t){return e.add(t)}),new jY(0,0)).div(new jY(e.length,e.length))}function VY(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function UY(e){return!!e&&e!==1/0&&e!==-1/0&&!Number.isNaN(e)||0===e}function GY(e){return UY(e)&&e>=0&&e<=1}var jY=function(){function e(t,n){(0,y.Z)(this,e),this._x=t,this._y=n}return(0,b.Z)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"sub",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"mul",value:function(t){return new e(this.x*t.x,this.y*t.y)}},{key:"div",value:function(t){return new e(this.x/t.x,this.y/t.y)}},{key:"abs",value:function(){return new e(Math.abs(this.x),Math.abs(this.y))}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"floor",value:function(){return new e(Math.floor(this.x),Math.floor(this.y))}}]),e}(),HY=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,y.Z)(this,e);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(UY),i=[r.x,r.y,r.width,r.height].every(UY);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have ".concat(JSON.stringify(r)));var o=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=(0,m.Z)(o,4),u=s[0],c=s[1],l=s[2],p=s[3];e.assertIsValidBox({x:u,y:c,width:l,height:p},"Box.constructor",n),this._x=u,this._y=c,this._width=l,this._height=p}return(0,b.Z)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"left",get:function(){return this.x}},{key:"top",get:function(){return this.y}},{key:"right",get:function(){return this.x+this.width}},{key:"bottom",get:function(){return this.y+this.height}},{key:"area",get:function(){return this.width*this.height}},{key:"topLeft",get:function(){return new jY(this.left,this.top)}},{key:"topRight",get:function(){return new jY(this.right,this.top)}},{key:"bottomLeft",get:function(){return new jY(this.left,this.bottom)}},{key:"bottomRight",get:function(){return new jY(this.right,this.bottom)}},{key:"round",value:function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)})),n=(0,m.Z)(t,4);return new e({x:n[0],y:n[1],width:n[2],height:n[3]})}},{key:"floor",value:function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)})),n=(0,m.Z)(t,4);return new e({x:n[0],y:n[1],width:n[2],height:n[3]})}},{key:"toSquare",value:function(){var t=this.x,n=this.y,r=this.width,a=this.height,i=Math.abs(r-a);return r<a&&(t-=i/2,r+=i),a<r&&(n-=i/2,a+=i),new e({x:t,y:n,width:r,height:a})}},{key:"rescale",value:function(t){var n=PY(t)?t.width:t,r=PY(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})}},{key:"pad",value:function(t,n){return new e({x:this.x-t/2,y:this.y-n/2,width:this.width+t,height:this.height+n})}},{key:"clipAtImageBorders",value:function(t,n){var r=this.x,a=this.y,i=this.right,o=this.bottom,s=Math.max(r,0),u=Math.max(a,0),c=i-s,l=o-u;return new e({x:s,y:u,width:Math.min(c,t-s),height:Math.min(l,n-u)}).floor()}},{key:"shift",value:function(t,n){var r=this.width,a=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:a})}},{key:"padAtBorders",value:function(e,t){var n=this.width+1,r=this.height+1,a=n,i=r,o=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(a=-u+t+n,u=t),c>e&&(i=-c+e+r,c=e),o<1&&(i=2-o,o=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:a,y:s,ey:c,x:o,ex:u,w:n,h:r}}},{key:"calibrate",value:function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()}}],[{key:"isRect",value:function(e){return!!e&&[e.x,e.y,e.width,e.height].every(UY)}},{key:"assertIsValidBox",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e.isRect(t))throw new Error("".concat(n," - invalid box: ").concat(JSON.stringify(t),", expected object with properties x, y, width, height"));if(!r&&(t.width<0||t.height<0))throw new Error("".concat(n," - width (").concat(t.width,") and height (").concat(t.height,") must be positive numbers"))}}]),e}(),qY=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,y.Z)(this,n),t.call(this,{left:e,top:r,right:a,bottom:i},o)}return(0,b.Z)(n)}(HY),KY=function(){function e(t,n,r,a,i){(0,y.Z)(this,e),this._imageDims=new AY(i.width,i.height),this._score=t,this._classScore=n,this._className=r,this._box=new HY(a).rescale(this._imageDims)}return(0,b.Z)(e,[{key:"score",get:function(){return this._score}},{key:"classScore",get:function(){return this._classScore}},{key:"className",get:function(){return this._className}},{key:"box",get:function(){return this._box}},{key:"imageDims",get:function(){return this._imageDims}},{key:"imageWidth",get:function(){return this.imageDims.width}},{key:"imageHeight",get:function(){return this.imageDims.height}},{key:"relativeBox",get:function(){return new HY(this._box).rescale(this.imageDims.reverse())}},{key:"forSize",value:function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})}}]),e}(),XY=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a){return(0,y.Z)(this,n),t.call(this,e,e,"",r,a)}return(0,b.Z)(n,[{key:"forSize",value:function(e,t){var r=(0,o.Z)((0,s.Z)(n.prototype),"forSize",this).call(this,e,t);return new n(r.score,r.relativeBox,r.imageDims)}}]),n}(KY);function YY(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),i=r*a;return n?i/(e.area+t.area-i):i/Math.min(e.area,t.area)}function QY(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),a=n.reduce((function(e,t){return t<e?t:e}),1/0),i=t.reduce((function(e,t){return e<t?t:e}),0),o=n.reduce((function(e,t){return e<t?t:e}),0);return new qY(r,a,i,o)}function JY(e,t,n){for(var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),i=[],o=function(){var t=a.pop();i.push(t);for(var o=a,s=[],u=0;u<o.length;u++){var c=o[u],l=e[t],p=e[c];s.push(YY(l,p,r))}a=a.filter((function(e,t){return s[t]<=n}))};a.length>0;)o();return i}function $Y(e,t){return qs((function(){var n=(0,m.Z)(t,3),r=n[0],a=n[1],i=n[2],o=sp([].concat((0,h.Z)(e.shape.slice(0,3)),[1]),r,"float32"),s=sp([].concat((0,h.Z)(e.shape.slice(0,3)),[1]),a,"float32"),u=sp([].concat((0,h.Z)(e.shape.slice(0,3)),[1]),i,"float32"),c=Kc([o,s,u],3);return Rp(e,c)}))}function eQ(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return qs((function(){var n=e.shape.slice(1),r=(0,m.Z)(n,2),a=r[0],i=r[1];if(a===i)return e;var o=Math.abs(a-i),s=Math.round(o*(t?.5:1)),u=a>i?2:1,c=function(t){var n=e.shape.slice();return n[u]=t,sp(n,0,"float32")},l=c(s),p=o-l.shape[u],d=[t&&p?c(p):null,e,l].filter((function(e){return!!e})).map((function(e){return cs(e,"float32")}));return Kc(d,u)}))}function tQ(e){for(var t=e.slice(),n=t.length-1;n>0;n--){var r=Math.floor(Math.random()*(n+1)),a=t[n];t[n]=t[r],t[r]=a}return t}function nQ(e){return 1/(1+Math.exp(-e))}function rQ(e){return Math.log(e/(1-e))}var aQ,iQ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,y.Z)(this,n),t.call(this,{x:e,y:r,width:a,height:i},o)}return(0,b.Z)(n)}(HY),oQ=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new jY(0,0);(0,y.Z)(this,e);var a=n.width,i=n.height;this._imgDims=new AY(a,i),this._shift=r,this._positions=t.map((function(e){return e.mul(new jY(a,i)).add(r)}))}return(0,b.Z)(e,[{key:"shift",get:function(){return new jY(this._shift.x,this._shift.y)}},{key:"imageWidth",get:function(){return this._imgDims.width}},{key:"imageHeight",get:function(){return this._imgDims.height}},{key:"positions",get:function(){return this._positions}},{key:"relativePositions",get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new jY(e.imageWidth,e.imageHeight))}))}},{key:"forSize",value:function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})}},{key:"shiftBy",value:function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new jY(e,t))}},{key:"shiftByPoint",value:function(e){return this.shiftBy(e.x,e.y)}},{key:"align",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){var n=e instanceof XY?e.box.floor():new HY(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=i({useDlibAlignment:!1,minBoxPadding:.2},t),a=r.useDlibAlignment,o=r.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(o)}},{key:"alignDlib",value:function(){var e=this.getRefPointsForAlignment(),t=(0,m.Z)(e,3),n=t[0],r=t[1],a=t[2],i=function(e){return a.sub(e).magnitude()},o=(i(n)+i(r))/2,s=Math.floor(o/.45),u=WY(e),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new iQ(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))}},{key:"alignMinBbox",value:function(e){var t=QY(this.positions);return t.pad(t.width*e,t.height*e)}},{key:"getRefPointsForAlignment",value:function(){throw new Error("getRefPointsForAlignment not implemented by base class")}}]),e}(),sQ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"getRefPointsForAlignment",value:function(){var e=this.positions;return[e[0],e[1],WY([e[3],e[4]])]}}]),n}(oQ),uQ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"getJawOutline",value:function(){return this.positions.slice(0,17)}},{key:"getLeftEyeBrow",value:function(){return this.positions.slice(17,22)}},{key:"getRightEyeBrow",value:function(){return this.positions.slice(22,27)}},{key:"getNose",value:function(){return this.positions.slice(27,36)}},{key:"getLeftEye",value:function(){return this.positions.slice(36,42)}},{key:"getRightEye",value:function(){return this.positions.slice(42,48)}},{key:"getMouth",value:function(){return this.positions.slice(48,68)}},{key:"getRefPointsForAlignment",value:function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(WY)}}]),n}(oQ),cQ=function(){function e(t,n){(0,y.Z)(this,e),this._label=t,this._distance=n}return(0,b.Z)(e,[{key:"label",get:function(){return this._label}},{key:"distance",get:function(){return this._distance}},{key:"toString",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return"".concat(this.label).concat(e?" (".concat(LY(this.distance),")"):"")}}]),e}(),lQ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this,e))._label=r,a}return(0,b.Z)(n,[{key:"label",get:function(){return this._label}}],[{key:"assertIsValidLabeledBox",value:function(e,t){if(HY.assertIsValidBox(e,t),!UY(e.label))throw new Error("".concat(t," - expected property label (").concat(e.label,") to be a number"))}}]),n}(HY),pQ=function(){function e(t,n){if((0,y.Z)(this,e),"string"!=typeof t)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some((function(e){return!(e instanceof Float32Array)})))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=n}return(0,b.Z)(e,[{key:"label",get:function(){return this._label}},{key:"descriptors",get:function(){return this._descriptors}},{key:"toJSON",value:function(){return{label:this.label,descriptors:this.descriptors.map((function(e){return Array.from(e)}))}}}],[{key:"fromJSON",value:function(t){var n=t.descriptors.map((function(e){return new Float32Array(e)}));return new e(t.label,n)}}]),e}(),dQ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a,i){var o;return(0,y.Z)(this,n),(o=t.call(this,e,r))._score=a,o._classScore=i,o}return(0,b.Z)(n,[{key:"score",get:function(){return this._score}},{key:"classScore",get:function(){return this._classScore}}],[{key:"assertIsValidPredictedBox",value:function(e,t){if(lQ.assertIsValidLabeledBox(e,t),!GY(e.score)||!GY(e.classScore))throw new Error("".concat(t," - expected properties score (").concat(e.score,") and (").concat(e.classScore,") to be a number between [0, 1]"))}}]),n}(lQ);function fQ(e){return e.detection instanceof XY}function hQ(e,t){return i(i({},e),{detection:t})}function mQ(){var e=window.fetch;if(!e)throw new Error("fetch - missing fetch implementation for browser environment");return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},createVideoElement:function(){return document.createElement("video")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function vQ(){return"object"==typeof n.g&&"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node}function gQ(e){var t="";if(!e&&vQ())try{e=S("fs")}catch(n){t=n.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: ".concat(t))}}}function yQ(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.Video||n.g.HTMLVideoElement,a=n.g.fetch,o=gQ();return i({Canvas:e||function(){return(0,b.Z)((function e(){(0,y.Z)(this,e)}))}(),CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){return(0,b.Z)((function e(){(0,y.Z)(this,e)}))}(),Image:t||function(){return(0,b.Z)((function e(){(0,y.Z)(this,e)}))}(),ImageData:n.g.ImageData||function(){return(0,b.Z)((function e(){(0,y.Z)(this,e)}))}(),Video:n.g.HTMLVideoElement||function(){return(0,b.Z)((function e(){(0,y.Z)(this,e)}))}(),createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},createVideoElement:function(){if(r)return new r;throw new Error("createVideoElement - missing Video implementation for nodejs environment")},fetch:a},o)}function bQ(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function xQ(e){aQ=e}function kQ(){return bQ()?xQ(mQ()):vQ()?xQ(yQ()):null}var wQ={getEnv:function(){if(!aQ)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return aQ},setEnv:xQ,initialize:kQ,createBrowserEnv:mQ,createFileSystem:gQ,createNodejsEnv:yQ,monkeyPatch:function(e){if(aQ||kQ(),!aQ)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?aQ.Canvas:t,r=e.Image,a=void 0===r?aQ.Image:r;aQ.Canvas=n,aQ.Image=a,aQ.createCanvasElement=e.createCanvasElement||function(){return new n},aQ.createImageElement=e.createImageElement||function(){return new a},aQ.ImageData=e.ImageData||aQ.ImageData,aQ.Video=e.Video||aQ.Video,aQ.fetch=e.fetch||aQ.fetch,aQ.readFile=e.readFile||aQ.readFile},isBrowser:bQ,isNodejs:vQ};function SQ(e){return wQ.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function IQ(e){var t=wQ.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=SQ(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=r.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}kQ();var NQ,TQ=((NQ=TQ||{}).TOP_LEFT="TOP_LEFT",NQ.TOP_RIGHT="TOP_RIGHT",NQ.BOTTOM_LEFT="BOTTOM_LEFT",NQ.BOTTOM_RIGHT="BOTTOM_RIGHT",NQ),CQ=(0,b.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,y.Z)(this,e);var n=t.anchorPosition,r=t.backgroundColor,a=t.fontColor,i=t.fontSize,o=t.fontStyle,s=t.padding;this.anchorPosition=n||"TOP_LEFT",this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=o||"Georgia",this.padding=s||4})),EQ=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,y.Z)(this,e),this.text="string"==typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new CQ(r)}return(0,b.Z)(e,[{key:"measureWidth",value:function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t}},{key:"measureHeight",value:function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n}},{key:"getUpperLeft",value:function(e,t){var n=this.options.anchorPosition,r="BOTTOM_RIGHT"===n||"TOP_RIGHT"===n,a="BOTTOM_LEFT"===n||"BOTTOM_RIGHT"===n,i=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,u=a?this.anchor.y-o:this.anchor.y;if(t){var c=t.width,l=t.height;return{x:Math.max(Math.min(s,c-i),0),y:Math.max(Math.min(u,l-o),0)}}return{x:s,y:u}}},{key:"draw",value:function(e){var t=SQ(e),n=IQ(t),r=this.options,a=r.backgroundColor,i=r.fontColor,o=r.fontSize,s=r.fontStyle,u=r.padding;n.font="".concat(o,"px ").concat(s);var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=a;var p=this.getUpperLeft(n,t);n.fillRect(p.x,p.y,c,l),n.fillStyle=i,this.text.forEach((function(e,t){var r=u+p.x,a=u+p.y+(t+1)*o;n.fillText(e,r,a)}))}}]),e}(),_Q=(0,b.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,y.Z)(this,e);var n=t.boxColor,r=t.lineWidth,a=t.label,o=t.drawLabelOptions;this.boxColor=n||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=a;var s={anchorPosition:"BOTTOM_LEFT",backgroundColor:this.boxColor};this.drawLabelOptions=new CQ(i(i({},s),o))})),AQ=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,y.Z)(this,e),this.box=new HY(t),this.options=new _Q(n)}return(0,b.Z)(e,[{key:"draw",value:function(e){var t=IQ(e),n=this.options,r=n.boxColor,a=n.lineWidth,i=this.box,o=i.x,s=i.y,u=i.width,c=i.height;t.strokeStyle=r,t.lineWidth=a,t.strokeRect(o,s,u,c);var l=this.options.label;l&&new EQ([l],{x:o-a/2,y:s},this.options.drawLabelOptions).draw(e)}}]),e}();function RQ(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof XY?t.score:fQ(t)?t.detection.score:void 0,r=t instanceof XY?t.box:fQ(t)?t.detection.box:new HY(t),a=n?"".concat(LY(n)):void 0;new AQ(r,{label:a}).draw(e)}))}function FQ(e){var t=wQ.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function DQ(e){return new Promise((function(t,n){function r(e){!e.currentTarget||(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),n(e))}function a(e){!e.currentTarget||(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),t(e))}(e instanceof wQ.getEnv().Canvas||FQ(e))&&t(null),e.addEventListener("load",a),e.addEventListener("error",r)}))}function ZQ(e){return new Promise((function(t,n){e instanceof Blob||n(new Error("bufferToImage - expected buf to be of type: Blob"));var r=new FileReader;r.onload=function(){"string"!=typeof r.result&&n(new Error("bufferToImage - expected reader.result to be a string, in onload"));var e=wQ.getEnv().createImageElement();e.onload=function(){return t(e)},e.onerror=n,e.src=r.result},r.onerror=n,r.readAsDataURL(e)}))}function OQ(e){var t=wQ.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new AY(e.naturalWidth,e.naturalHeight):e instanceof r?new AY(e.videoWidth,e.videoHeight):new AY(e.width,e.height)}function MQ(e){var t=e.width,n=e.height,r=(0,wQ.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function zQ(e,t){var n=wQ.getEnv().ImageData;if(!(e instanceof n)&&!FQ(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||OQ(e),a=r.width,i=r.height,o=MQ({width:a,height:i});return e instanceof n?IQ(o).putImageData(e,0,0):IQ(o).drawImage(e,0,0,a,i),o}function LQ(e,t){return PQ.apply(this,arguments)}function PQ(){return PQ=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u,c;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||wQ.getEnv().createCanvasElement(),a=t.shape.slice(OY(t)?1:0),i=(0,m.Z)(a,3),o=i[0],s=i[1],u=i[2],c=qs((function(){return t.as3D(o,s,u).toInt()})),e.next=3,vu.toPixels(c,r);case 3:return c.dispose(),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)}))),PQ.apply(this,arguments)}function BQ(e){var t=wQ.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}function WQ(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=wQ.getEnv(),a=r.Image,i=r.Canvas;if(!(e instanceof a||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");if(t<=0)return MQ({width:1,height:1});var o=OQ(e),s=t/Math.max(o.height,o.width),u=s*o.width,c=s*o.height,l=MQ({width:t,height:t}),p=e instanceof i?e:zQ(e),d=Math.abs(u-c)/2,f=n&&u<c?d:0,h=n&&c<u?d:0;return p.width>0&&p.height>0&&IQ(l).drawImage(p,f,h,u,c),l}var VQ=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((0,y.Z)(this,e),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],this._inputSize=0,!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have ".concat(t));this._treatAsBatchInput=r,this._batchSize=t.length,t.forEach((function(e,t){if(ZY(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(OY(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize ".concat(r," passed, but not supported in input array"));return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var a=e instanceof wQ.getEnv().Canvas?e:zQ(e);n._canvases[t]=a,n._inputDimensions[t]=[a.height,a.width,3]}))}return(0,b.Z)(e,[{key:"imageTensors",get:function(){return this._imageTensors}},{key:"canvases",get:function(){return this._canvases}},{key:"isBatchInput",get:function(){return this.batchSize>1||this._treatAsBatchInput}},{key:"batchSize",get:function(){return this._batchSize}},{key:"inputDimensions",get:function(){return this._inputDimensions}},{key:"inputSize",get:function(){return this._inputSize}},{key:"reshapedInputDimensions",get:function(){var e=this;return VY(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))}},{key:"getInput",value:function(e){return this.canvases[e]||this.imageTensors[e]}},{key:"getInputDimensions",value:function(e){return this._inputDimensions[e]}},{key:"getInputHeight",value:function(e){return this._inputDimensions[e][0]}},{key:"getInputWidth",value:function(e){return this._inputDimensions[e][1]}},{key:"getReshapedInputDimensions",value:function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return BY({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)}},{key:"toBatchTensor",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._inputSize=e,qs((function(){var r=VY(t.batchSize,0,1).map((function(r){var a=t.getInput(r);if(a instanceof hi){var i=OY(a)?a:rp(a);return((i=eQ(i,n)).shape[1]!==e||i.shape[2]!==e)&&(i=Gh.resizeBilinear(i,[e,e],!1,!1)),i.as3D(e,e,3)}if(a instanceof wQ.getEnv().Canvas)return vu.fromPixels(WQ(a,e,n));throw new Error("toBatchTensor - at batchIdx ".concat(r,", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have ").concat(a))}));return Jd(r.map((function(e){return cs(e,"float32")}))).as4D(t.batchSize,e,e,3)}))}}]),e}();function UQ(e){return GQ.apply(this,arguments)}function GQ(){return GQ=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof VQ)){e.next=2;break}return e.abrupt("return",t);case 2:if((n=Array.isArray(t)?t:[t]).length){e.next=5;break}throw new Error("toNetInput - empty array passed as input");case 5:return r=function(e){return Array.isArray(t)?" at input index ".concat(e,":"):""},(a=n.map(SQ)).forEach((function(e,t){if(!BQ(e)&&!ZY(e)&&!OY(e))throw"string"==typeof n[t]?new Error("toNetInput -".concat(r(t)," string passed, but could not resolve HTMLElement for element id ").concat(n[t])):new Error("toNetInput -".concat(r(t)," expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id"));if(OY(e)){var a=e.shape[0];if(1!==a)throw new Error("toNetInput -".concat(r(t)," tf.Tensor4D with batchSize ").concat(a," passed, but not supported in input array"))}})),e.next=9,Promise.all(a.map((function(e){return BQ(e)&&DQ(e)})));case 9:return e.abrupt("return",new VQ(a,Array.isArray(t)));case 10:case"end":return e.stop()}}),e)}))),GQ.apply(this,arguments)}function jQ(e,t){return HQ.apply(this,arguments)}function HQ(){return HQ=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o,s,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=wQ.getEnv(),a=r.Canvas,i=t,t instanceof a){e.next=16;break}return e.next=4,UQ(t);case 4:if(!((o=e.sent).batchSize>1)){e.next=7;break}throw new Error("extractFaces - batchSize > 1 not supported");case 7:if(!((s=o.getInput(0))instanceof a)){e.next=12;break}e.t0=s,e.next=15;break;case 12:return e.next=14,LQ(s);case 14:e.t0=e.sent;case 15:i=e.t0;case 16:return u=IQ(i),e.abrupt("return",n.map((function(e){return e instanceof XY?e.forSize(i.width,i.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(i.width,i.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=MQ({width:r,height:a});return r>0&&a>0&&IQ(i).putImageData(u.getImageData(t,n,r,a),0,0),i})));case 18:case"end":return e.stop()}}),e)}))),HQ.apply(this,arguments)}function qQ(e,t){return KQ.apply(this,arguments)}function KQ(){return KQ=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ZY(t)||OY(t)){e.next=2;break}throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");case 2:if(!(OY(t)&&t.shape[0]>1)){e.next=4;break}throw new Error("extractFaceTensors - batchSize > 1 not supported");case 4:return e.abrupt("return",qs((function(){var e=t.shape.slice(OY(t)?1:0),r=(0,m.Z)(e,3),a=r[0],i=r[1],o=r[2];return n.map((function(e){return e instanceof XY?e.forSize(i,a).box:e})).map((function(e){return e.clipAtImageBorders(i,a)})).filter((function(e){return e.width>0&&e.height>0})).map((function(e){var n=e.x,r=e.y,s=e.width,u=e.height;return Vd(t.as3D(a,i,o),[r,n,0],[u,s,o])}))})));case 5:case"end":return e.stop()}}),e)}))),KQ.apply(this,arguments)}function XQ(e,t){return YQ.apply(this,arguments)}function YQ(){return YQ=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=wQ.getEnv(),a=r.fetch,e.next=4,a(t,n);case 4:if((i=e.sent).status<400){e.next=7;break}throw new Error("failed to fetch: (".concat(i.status,") ").concat(i.statusText,", from url: ").concat(i.url));case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)}))),YQ.apply(this,arguments)}function QQ(e){return JQ.apply(this,arguments)}function JQ(){return JQ=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,XQ(t);case 2:return n=e.sent,e.next=5,n.blob();case 5:if((r=e.sent).type.startsWith("image/")){e.next=8;break}throw new Error("fetchImage - expected blob type to be of type image/*, instead have: ".concat(r.type,", for url: ").concat(n.url));case 8:return e.abrupt("return",ZQ(r));case 9:case"end":return e.stop()}}),e)}))),JQ.apply(this,arguments)}function $Q(e){return eJ.apply(this,arguments)}function eJ(){return eJ=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,XQ(t);case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e)}))),eJ.apply(this,arguments)}function tJ(e){return nJ.apply(this,arguments)}function nJ(){return nJ=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Float32Array,e.next=3,XQ(t);case 3:return e.next=5,e.sent.arrayBuffer();case 5:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 7:case"end":return e.stop()}}),e)}))),nJ.apply(this,arguments)}function rJ(e){return new Promise((function(t,n){e instanceof Blob||n(new Error("bufferToVideo - expected buf to be of type: Blob"));var r=wQ.getEnv().createVideoElement();r.oncanplay=function(){return t(r)},r.onerror=n,r.playsInline=!0,r.muted=!0,r.src=URL.createObjectURL(e),r.play()}))}function aJ(e){return iJ.apply(this,arguments)}function iJ(){return iJ=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,XQ(t);case 2:return n=e.sent,e.next=5,n.blob();case 5:if((r=e.sent).type.startsWith("video/")){e.next=8;break}throw new Error("fetchVideo - expected blob type to be of type video/*, instead have: ".concat(r.type,", for url: ").concat(n.url));case 8:return e.abrupt("return",rJ(r));case 9:case"end":return e.stop()}}),e)}))),iJ.apply(this,arguments)}function oJ(e,t){var n="".concat(t,"-weights_manifest.json");if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/".concat(n)};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",a=(e=e.replace(r,"")).split("/").filter((function(e){return e})),i=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return{modelBaseUri:o=e.startsWith("/")?"/".concat(o):o,manifestUri:"/"===o?"/".concat(i):"".concat(o,"/").concat(i)}}function sJ(e,t){return uJ.apply(this,arguments)}function uJ(){return uJ=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=oJ(t,n),a=r.manifestUri,i=r.modelBaseUri,e.next=5,$Q(a);case 5:return o=e.sent,e.abrupt("return",ds.loadWeights(o,i));case 7:case"end":return e.stop()}}),e)}))),uJ.apply(this,arguments)}function cJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=n?OQ(t):t,a=r.width,i=r.height;return e.width=a,e.height=i,{width:a,height:i}}var lJ=function(){function e(t){(0,y.Z)(this,e),this._params=void 0,this._paramMappings=[],this._name=t}return(0,b.Z)(e,[{key:"params",get:function(){return this._params}},{key:"paramMappings",get:function(){return this._paramMappings}},{key:"isLoaded",get:function(){return!!this.params}},{key:"getParamFromPath",value:function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]}},{key:"reassignParamFromPath",value:function(e,t){var n=this.traversePropertyPath(e),r=n.obj,a=n.objProp;r[a].dispose(),r[a]=t}},{key:"getParamList",value:function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))}},{key:"getTrainableParams",value:function(){return this.getParamList().filter((function(e){return e.tensor instanceof vi}))}},{key:"getFrozenParams",value:function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof vi)}))}},{key:"variable",value:function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))}},{key:"freeze",value:function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,a=$i(r.dataSync());r.dispose(),e.reassignParamFromPath(n,a)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path ".concat(t.path));t.tensor.dispose()})),this._params=void 0}},{key:"serializeParams",value:function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))}},{key:"load",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof Float32Array)){e.next=3;break}return this.extractWeights(t),e.abrupt("return");case 3:return e.next=5,this.loadFromUri(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromUri",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromUri - expected model uri"));case 2:return e.next=4,sJ(t,this.getDefaultModelName());case 4:n=e.sent,this.loadFromWeightMap(n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromDisk",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromDisk - expected model file path"));case 2:return n=wQ.getEnv(),r=n.readFile,a=oJ(t,this.getDefaultModelName()),i=a.manifestUri,o=a.modelBaseUri,s=function(e){return Promise.all(e.map((function(e){return r(e).then((function(e){return e.buffer}))})))},u=ds.weightsLoaderFactory(s),e.t0=JSON,e.next=12,r(i);case 12:return e.t1=e.sent.toString(),c=e.t0.parse.call(e.t0,e.t1),e.next=16,u(c,o);case 16:l=e.sent,this.loadFromWeightMap(l);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromWeightMap",value:function(e){var t=this.extractParamsFromWeightMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"extractWeights",value:function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"traversePropertyPath",value:function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property ".concat(n,", for path ").concat(e));return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof hi))throw new Error("traversePropertyPath - parameter is not a tensor, for path ".concat(e));return{obj:n,objProp:r}}}]),e}();function pJ(e,t,n){return qs((function(){var r=Zd(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=dc(r,t.bias)}))}function dJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return qs((function(){var r=Id(n?dc(hl(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):pJ(e,t.conv0,[2,2])),a=pJ(r,t.conv1,[1,1]),i=pJ(Id(dc(r,a)),t.conv2,[1,1]);return Id(dc(r,dc(a,i)))}))}function fJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return qs((function(){var a=Id(n?dc(hl(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):pJ(e,t.conv0,r?[2,2]:[1,1])),i=pJ(a,t.conv1,[1,1]),o=pJ(Id(dc(a,i)),t.conv2,[1,1]),s=pJ(Id(dc(a,dc(i,o))),t.conv3,[1,1]);return Id(dc(a,dc(i,dc(o,s))))}))}function hJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"same",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return qs((function(){var a=dc(hl(e,t.filters,[1,1],n),t.bias);return r?Id(a):a}))}function mJ(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function vJ(e,t){return function(n,r,a,i){var o=af(e(n*r*a*a),[a,a,n,r]),s=nf(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}}function gJ(e,t){return function(n,r,a){var i=rf(e(n*r),[n,r]),o=nf(e(r));return t.push({paramPath:"".concat(a,"/weights")},{paramPath:"".concat(a,"/bias")}),{weights:i,bias:o}}}var yJ=(0,b.Z)((function e(t,n,r){(0,y.Z)(this,e),this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}));function bJ(e,t){return function(n,r,a){var i=af(e(9*n),[3,3,n,1]),o=af(e(n*r),[1,1,n,r]),s=nf(e(r));return t.push({paramPath:"".concat(a,"/depthwise_filter")},{paramPath:"".concat(a,"/pointwise_filter")},{paramPath:"".concat(a,"/bias")}),new yJ(i,o,s)}}function xJ(e){return function(t){var n=e("".concat(t,"/depthwise_filter"),4),r=e("".concat(t,"/pointwise_filter"),4),a=e("".concat(t,"/bias"),1);return new yJ(n,r,a)}}function kJ(e,t){return function(n,r,a){var i=e[n];if(!RY(i,r))throw new Error("expected weightMap[".concat(n,"] to be a Tensor").concat(r,"D, instead have ").concat(i));return t.push({originalPath:n,paramPath:a||n}),i}}function wJ(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function SJ(e,t){var n=vJ(e,t),r=bJ(e,t);function a(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=i?n(e,t,3,"".concat(a,"/conv0")):r(e,t,"".concat(a,"/conv0")),s=r(t,t,"".concat(a,"/conv1")),u=r(t,t,"".concat(a,"/conv2"));return{conv0:o,conv1:s,conv2:u}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=a(e,t,n,i),s=o.conv0,u=o.conv1,c=o.conv2,l=r(t,t,"".concat(n,"/conv3"));return{conv0:s,conv1:u,conv2:c,conv3:l}}}}function IJ(e){return function(t){return{filters:e("".concat(t,"/filters"),4),bias:e("".concat(t,"/bias"),1)}}}function NJ(e,t){var n=kJ(e,t),r=IJ(n),a=xJ(n);return{extractDenseBlock3Params:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),i=a("".concat(e,"/conv1")),o=a("".concat(e,"/conv2"));return{conv0:n,conv1:i,conv2:o}},extractDenseBlock4Params:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),i=a("".concat(e,"/conv1")),o=a("".concat(e,"/conv2")),s=a("".concat(e,"/conv3"));return{conv0:n,conv1:i,conv2:o,conv3:s}}}}var TJ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.call(this,"FaceFeatureExtractor")}return(0,b.Z)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return qs((function(){var n=fJ($Y(cs(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=fJ(n,t.dense1),n=fJ(n,t.dense2),n=fJ(n,t.dense3),n=Hc(n,[7,7],[2,2],"valid")}))}},{key:"forward",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,UQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=NJ(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return mJ(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=wJ(e),r=n.extractWeights,a=n.getRemainingWeights,i=SJ(r,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u,dense3:c}}}(e)}}]),n}(lJ);function CJ(e,t){return qs((function(){return dc(zs(e,t.weights),t.bias)}))}function EJ(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var _J=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this,e))._faceFeatureExtractor=r,a}return(0,b.Z)(n,[{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}},{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return qs((function(){var r=e instanceof VQ?t.faceFeatureExtractor.forwardInput(e):e;return CJ(r.as2D(r.shape[0],-1),n.fc)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),(0,o.Z)((0,s.Z)(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e,t,n){var r=[],a=wJ(e),i=a.extractWeights,o=a.getRemainingWeights,s=gJ(i,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: ".concat(o().length));return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())}},{key:"extractParamsFromWeightMap",value:function(e){var t=EJ(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=kJ(e,n),a={fc:(t="fc",{weights:r("".concat(t,"/weights"),2),bias:r("".concat(t,"/bias"),1)})};return mJ(e,n),{params:a,paramMappings:n}}(r)}},{key:"extractParams",value:function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)}}]),n}(lJ),AJ=["neutral","happy","sad","angry","fearful","disgusted","surprised"],RJ=function(){function e(t){var n=this;if((0,y.Z)(this,e),this.neutral=0,this.happy=0,this.sad=0,this.angry=0,this.fearful=0,this.disgusted=0,this.surprised=0,7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: ".concat(t.length));AJ.forEach((function(e,r){n[e]=t[r]}))}return(0,b.Z)(e,[{key:"asSortedArray",value:function(){var e=this;return AJ.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))}}]),e}(),FJ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new TJ;return(0,y.Z)(this,n),t.call(this,"FaceExpressionNet",e)}return(0,b.Z)(n,[{key:"forwardInput",value:function(e){var t=this;return qs((function(){return Gd(t.runNet(e))}))}},{key:"forward",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,UQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictExpressions",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,UQ(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,e.next=8,Promise.all(df(r).map(function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dataSync(),e.abrupt("return",(t.dispose(),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return a=e.sent,r.dispose(),i=a.map((function(e){return new RJ(e)})),e.abrupt("return",n.isBatchInput?i:i[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_expression_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}},{key:"getClassifierChannelsOut",value:function(){return 7}}]),n}(_J);function DJ(e){return e.expressions instanceof RJ}function ZJ(e,t){return i(i({},e),{expressions:t})}function OJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3?arguments[3]:void 0;(Array.isArray(t)?t:[t]).forEach((function(t){var a=t instanceof RJ?t:DJ(t)?t.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=a.asSortedArray().filter((function(e){return e.probability>n})),o=fQ(t)?t.detection.box.bottomLeft:r||new jY(0,0);new EQ(i.map((function(e){return"".concat(e.expression," (").concat(LY(e.probability),")")})),o).draw(e)}))}function MJ(e){return fQ(e)&&e.landmarks instanceof oQ&&e.unshiftedLandmarks instanceof oQ&&e.alignedRect instanceof XY}function zJ(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),o=e.detection.imageDims,s=new XY(e.detection.score,a.rescale(o.reverse()),o),u=function(e){var t=function(e,t,n,r){return Math.atan2(r-t,n-e)%Math.PI},n={roll:void 0,pitch:void 0,yaw:void 0};if(!e||!e._positions||68!==e._positions.length)return n;var r=e._positions;n.roll=-t(r[36]._x,r[36]._y,r[45]._x,r[45]._y),n.pitch=t(0,Math.abs(r[0]._x-r[30]._x)/r[30]._x,Math.PI,Math.abs(r[16]._x-r[30]._x)/r[30]._x);var a=r.reduce((function(e,t){return e<t._y?e:t._y}),1/0),i=r.reduce((function(e,t){return e>t._y?e:t._y}),-1/0);return n.yaw=Math.PI*(e._imgDims._height/(i-a)/1.4-1),n}(t);return i(i({},e),{landmarks:r,unshiftedLandmarks:t,alignedRect:s,angle:u})}var LJ=(0,b.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,y.Z)(this,e);var n=t.drawLines,r=void 0===n||n,a=t.drawPoints,i=void 0===a||a,o=t.lineWidth,s=t.lineColor,u=t.pointSize,c=t.pointColor;this.drawLines=r,this.drawPoints=i,this.lineWidth=o||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"})),PJ=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,y.Z)(this,e),this.faceLandmarks=t,this.options=new LJ(n)}return(0,b.Z)(e,[{key:"draw",value:function(e){var t=IQ(e),n=this.options,r=n.drawLines,a=n.drawPoints,i=n.lineWidth,o=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof uQ&&(t.strokeStyle=o,t.lineWidth=i,EY(t,this.faceLandmarks.getJawOutline()),EY(t,this.faceLandmarks.getLeftEyeBrow()),EY(t,this.faceLandmarks.getRightEyeBrow()),EY(t,this.faceLandmarks.getNose()),EY(t,this.faceLandmarks.getLeftEye(),!0),EY(t,this.faceLandmarks.getRightEye(),!0),EY(t,this.faceLandmarks.getMouth(),!0)),a){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()}))}}}]),e}();function BJ(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof oQ?t:MJ(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new PJ(n).draw(e)}))}function WJ(e,t){var n=[],r=wJ(e),a=r.extractWeights,i=r.getRemainingWeights,o=function(e,t){var n=vJ(e,t),r=bJ(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,a){return{separable_conv0:r(e,t,"".concat(a,"/separable_conv0")),separable_conv1:r(t,t,"".concat(a,"/separable_conv1")),expansion_conv:n(e,t,1,"".concat(a,"/expansion_conv"))}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,"".concat(t,"/separable_conv0")),separable_conv1:r(e,e,"".concat(t,"/separable_conv1")),separable_conv2:r(e,e,"".concat(t,"/separable_conv2"))}}}}(a,n),s=o.extractConvParams,u=o.extractSeparableConvParams,c=o.extractReductionBlockParams,l=o.extractMainBlockParams,p={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},d={};VY(t,0,1).forEach((function(e){d["main_block_".concat(e)]=l(128,"middle_flow/main_block_".concat(e))}));var f={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: ".concat(i().length));return{paramMappings:n,params:{entry_flow:p,middle_flow:d,exit_flow:f}}}function VJ(e,t){var n=[],r=function(e,t){var n=kJ(e,t),r=IJ(n),a=xJ(n);return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),expansion_conv:r("".concat(e,"/expansion_conv"))}},extractMainBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),separable_conv2:a("".concat(e,"/separable_conv2"))}}}}(e,n),a=r.extractConvParams,i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:a("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},c={};VY(t,0,1).forEach((function(e){c["main_block_".concat(e)]=s("middle_flow/main_block_".concat(e))}));var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return mJ(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function UJ(e,t,n){return dc(hl(e,t.filters,n,"same"),t.bias)}function GJ(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=n?Id(e):e;return r=pJ(r,t.separable_conv0,[1,1]),r=pJ(Id(r),t.separable_conv1,[1,1]),r=Wp(r,[3,3],[2,2],"same"),r=dc(r,UJ(e,t.expansion_conv,[2,2]))}var jJ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),(r=t.call(this,"TinyXception"))._numMainBlocks=e,r}return(0,b.Z)(n,[{key:"forwardInput",value:function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return qs((function(){var r=$Y(cs(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),a=Id(UJ(r,n.entry_flow.conv_in,[2,2]));return a=GJ(a,n.entry_flow.reduction_block_0,!1),a=GJ(a,n.entry_flow.reduction_block_1),VY(t._numMainBlocks,0,1).forEach((function(e){a=function(e,t){var n=pJ(Id(e),t.separable_conv0,[1,1]);return n=pJ(Id(n),t.separable_conv1,[1,1]),n=pJ(Id(n),t.separable_conv2,[1,1]),dc(n,e)}(a,n.middle_flow["main_block_".concat(e)])})),a=GJ(a,n.exit_flow.reduction_block),a=Id(pJ(a,n.exit_flow.separable_conv,[1,1]))}))}},{key:"forward",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,UQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_xception_model"}},{key:"extractParamsFromWeightMap",value:function(e){return VJ(e,this._numMainBlocks)}},{key:"extractParams",value:function(e){return WJ(e,this._numMainBlocks)}}]),n}(lJ);var HJ,qJ=((HJ=qJ||{}).FEMALE="female",HJ.MALE="male",HJ),KJ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jJ(2);return(0,y.Z)(this,n),(e=t.call(this,"AgeGenderNet"))._faceFeatureExtractor=r,e}return(0,b.Z)(n,[{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}},{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return qs((function(){var r=e instanceof VQ?t.faceFeatureExtractor.forwardInput(e):e,a=Hc(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:CJ(a,n.fc.age).as1D(),gender:CJ(a,n.fc.gender)}}))}},{key:"forwardInput",value:function(e){var t=this;return qs((function(){var n=t.runNet(e),r=n.age,a=n.gender;return{age:r,gender:Gd(a)}}))}},{key:"forward",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,UQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictAgeAndGender",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,UQ(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,a=df(r.age),i=df(r.gender),o=a.map((function(e,t){return{ageTensor:e,genderTensor:i[t]}})),e.next=11,Promise.all(o.map(function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ageTensor,r=t.genderTensor,a=n.dataSync()[0],i=r.dataSync()[0],s=(o=i>.5)?"male":"female",u=o?i:1-i,e.abrupt("return",(n.dispose(),r.dispose(),{age:a,gender:s,genderProbability:u}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return s=e.sent,e.abrupt("return",(r.age.dispose(),r.gender.dispose(),n.isBatchInput?s:s[0]));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"age_gender_model"}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),(0,o.Z)((0,s.Z)(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e){var t=[],n=wJ(e),r=n.extractWeights,a=n.getRemainingWeights,i=gJ(r,t),o=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)}},{key:"extractParamsFromWeightMap",value:function(e){var t=EJ(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=kJ(e,t);function r(e){return{weights:n("".concat(e,"/weights"),2),bias:n("".concat(e,"/bias"),1)}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return mJ(e,t),{params:a,paramMappings:t}}(r)}},{key:"extractParams",value:function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)}}]),n}(lJ),XJ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"postProcess",value:function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,a=t/Math.max(r,n);return{width:n*a,height:r*a}})),a=r.length;return qs((function(){var n=function(e,t){return Jd([sp([68],e,"float32"),sp([68],t,"float32")],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],a=n.width,i=n.height;return t(a,i)?Math.abs(a-i)/2:0};return e.mul(sp([a,136],t,"float32")).sub(Jd(Array.from(Array(a),(function(e,t){return n(function(e){return i(e,(function(e,t){return e<t}))}(t),function(e){return i(e,(function(e,t){return t<e}))}(t))})))).div(Jd(Array.from(Array(a),(function(e,t){return n(r[t].width,r[t].height)}))))}))}},{key:"forwardInput",value:function(e){var t=this;return qs((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){var t=(0,m.Z)(e,2);return{height:t[0],width:t[1]}})))}))}},{key:"forward",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,UQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"detectLandmarks",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,UQ(t);case 2:return n=e.sent,r=qs((function(){return df(i.forwardInput(n))})),e.next=6,Promise.all(r.map(function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,r){var a,i,o;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.from(t.dataSync()),i=a.filter((function(e,t){return zY(t)})),o=a.filter((function(e,t){return!zY(t)})),e.abrupt("return",new uQ(Array(68).fill(0).map((function(e,t){return new jY(i[t],o[t])})),{height:n.getInputHeight(r),width:n.getInputWidth(r)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 6:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e.dispose()})),n.isBatchInput?a:a[0]));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getClassifierChannelsOut",value:function(){return 136}}]),n}(_J),YJ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new TJ;return(0,y.Z)(this,n),t.call(this,"FaceLandmark68Net",e)}return(0,b.Z)(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}}]),n}(XJ);var QJ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.call(this,"TinyFaceFeatureExtractor")}return(0,b.Z)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return qs((function(){var n=dJ($Y(cs(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=dJ(n,t.dense1),n=dJ(n,t.dense2),n=Hc(n,[14,14],[2,2],"valid")}))}},{key:"forward",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,UQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_tiny_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=NJ(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return mJ(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=wJ(e),r=n.extractWeights,a=n.getRemainingWeights,i=SJ(r,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u}}}(e)}}]),n}(lJ),JJ=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new QJ;return(0,y.Z)(this,n),t.call(this,"FaceLandmark68TinyNet",e)}return(0,b.Z)(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_tiny_model"}},{key:"getClassifierChannelsIn",value:function(){return 128}}]),n}(XJ),$J=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n)}(YJ);function e$(e,t){return dc(mc(e,t.weights),t.biases)}function t$(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"same",i=t.conv,o=i.filters,s=i.bias,u=hl(e,o,n,a);return u=e$(u=dc(u,s),t.scale),r?Id(u):u}function n$(e,t){return t$(e,t,[1,1],!1)}function r$(e,t){return t$(e,t,[2,2],!0,"valid")}function a$(e,t){function n(n,r,a,i){var o=function(t,n,r){var a=e(t),i=a.length/(n*r*r);if(MY(i))throw new Error("depth has to be an integer: ".concat(i,", weights.length: ").concat(a.length,", numFilters: ").concat(n,", filterSize: ").concat(r));return qs((function(){return cu(af(a,[n,i,r,r]),[2,3,1,0])}))}(n,r,a),s=nf(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}function r(r,a,i,o){var s=n(r,a,i,"".concat(o,"/conv")),u=function(n,r){var a=nf(e(n)),i=nf(e(n));return t.push({paramPath:"".concat(r,"/weights")},{paramPath:"".concat(r,"/biases")}),{weights:a,biases:i}}(a,"".concat(o,"/scale"));return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=r((i?.5:1)*e,t,n,"".concat(a,"/conv1")),s=r(e,t,n,"".concat(a,"/conv2"));return{conv1:o,conv2:s}}}}function i$(e,t){var n=kJ(e,t);function r(e){var t=n("".concat(e,"/conv/filters"),4),r=n("".concat(e,"/conv/bias"),1),a=function(e){return{weights:n("".concat(e,"/scale/weights"),1),biases:n("".concat(e,"/scale/biases"),1)}}(e);return{conv:{filters:t,bias:r},scale:a}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r("".concat(e,"/conv1")),conv2:r("".concat(e,"/conv2"))}}}}function o$(e,t){var n=function(e,t){return t$(e,t,[1,1],!0)}(e,t.conv1);return n=n$(n,t.conv2),n=dc(n,e),n=Id(n)}function s$(e,t){var n=r$(e,t.conv1);n=n$(n,t.conv2);var r=Hc(e,2,2,"valid"),a=Hp(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=(0,h.Z)(n.shape);o[1]=1;var s=Hp(o);n=Kc([n,s],1);var u=(0,h.Z)(n.shape);u[2]=1;var c=Hp(u);n=Kc([n,c],2)}return r=i?Kc([r,a],3):r,n=dc(r,n),n=Id(n)}var u$=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.call(this,"FaceRecognitionNet")}return(0,b.Z)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return qs((function(){var n=r$($Y(cs(e.toBatchTensor(150,!0),"float32"),[122.782,117.001,104.298]).div(255),t.conv32_down);n=o$(n=Wp(n,3,2,"valid"),t.conv32_1),n=o$(n,t.conv32_2),n=o$(n,t.conv32_3),n=o$(n=s$(n,t.conv64_down),t.conv64_1),n=o$(n,t.conv64_2),n=o$(n,t.conv64_3),n=o$(n=s$(n,t.conv128_down),t.conv128_1),n=o$(n,t.conv128_2),n=o$(n=s$(n,t.conv256_down),t.conv256_1);var r=(n=s$(n=o$(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return zs(r,t.fc)}))}},{key:"forward",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,UQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeFaceDescriptor",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=null==t?void 0:t.shape)||!n.some((function(e){return e<=0}))){e.next=2;break}return e.abrupt("return",new Float32Array(128));case 2:return e.next=4,UQ(t);case 4:return r=e.sent,a=qs((function(){return df(o.forwardInput(r))})),e.next=8,Promise.all(a.map((function(e){return e.data()})));case 8:return i=e.sent,e.abrupt("return",(a.forEach((function(e){return e.dispose()})),r.isBatchInput?i:i[0]));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_recognition_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=i$(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,i=r("conv32_down"),o=a("conv32_1"),s=a("conv32_2"),u=a("conv32_3"),c=a("conv64_down"),l=a("conv64_1"),p=a("conv64_2"),d=a("conv64_3"),f=a("conv128_down"),h=a("conv128_1"),m=a("conv128_2"),v=a("conv256_down"),g=a("conv256_1"),y=a("conv256_2"),b=a("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!DY(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have ".concat(x));var k={conv32_down:i,conv32_1:o,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:p,conv64_3:d,conv128_down:f,conv128_1:h,conv128_2:m,conv256_down:v,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return mJ(e,t),{params:k,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=wJ(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=a$(n,a),o=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),p=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),h=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),S=qs((function(){return cu(rf(n(32768),[128,256]),[1,0])}));if(a.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: ".concat(r().length));return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:p,conv64_down:d,conv64_1:f,conv64_2:h,conv64_3:m,conv128_down:v,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:k,conv256_down_out:w,fc:S},paramMappings:a}}(e)}}]),n}(lJ);function c$(e){var t=new u$;return t.extractWeights(e),t}function l$(e,t){return i(i({},e),{descriptor:t})}function p$(e){return"number"==typeof e.age}function d$(e,t){return i(i({},e),{age:t})}function f$(e){return("male"===e.gender||"female"===e.gender)&&GY(e.genderProbability)}function h$(e,t,n){return i(i({},e),{gender:t,genderProbability:n})}function m$(e,t){function n(n,r,a,i,o){var s=af(e(n*r*a*a),[a,a,n,r]),u=nf(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/").concat(o?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,a){var i=n(e,t,r,a,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function a(n,a,i){var o=function(n,r){var a=af(e(9*n),[3,3,n,1]),i=nf(e(n)),o=nf(e(n)),s=nf(e(n)),u=nf(e(n));return t.push({paramPath:"".concat(r,"/filters")},{paramPath:"".concat(r,"/batch_norm_scale")},{paramPath:"".concat(r,"/batch_norm_offset")},{paramPath:"".concat(r,"/batch_norm_mean")},{paramPath:"".concat(r,"/batch_norm_variance")}),{filters:a,batch_norm_scale:i,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:u}}(n,"".concat(i,"/depthwise_conv"));return{depthwise_conv:o,pointwise_conv:r(n,a,1,"".concat(i,"/pointwise_conv"))}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function v$(e){var t=[],n=function(e,t){var n=kJ(e,t);function r(e,t,r){return{filters:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/weights"),4,"".concat(r,"/filters")),batch_norm_offset:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/convolution_bn_offset"),1,"".concat(r,"/batch_norm_offset"))}}function a(e){var t="mobilenetv1/conv_".concat(e),a="MobilenetV1/Conv2d_".concat(e,"_depthwise"),i="".concat(t,"/depthwise_conv"),o="".concat(t,"/pointwise_conv");return{depthwise_conv:{filters:n("".concat(a,"/depthwise_weights"),4,"".concat(i,"/filters")),batch_norm_scale:n("".concat(a,"/BatchNorm/gamma"),1,"".concat(i,"/batch_norm_scale")),batch_norm_offset:n("".concat(a,"/BatchNorm/beta"),1,"".concat(i,"/batch_norm_offset")),batch_norm_mean:n("".concat(a,"/BatchNorm/moving_mean"),1,"".concat(i,"/batch_norm_mean")),batch_norm_variance:n("".concat(a,"/BatchNorm/moving_variance"),1,"".concat(i,"/batch_norm_variance"))},pointwise_conv:r("MobilenetV1",e,o)}}function i(e,t){return{filters:n("".concat(e,"/weights"),4,"".concat(t,"/filters")),bias:n("".concat(e,"/biases"),1,"".concat(t,"/bias"))}}function o(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_".concat(e,"/BoxEncodingPredictor"),"prediction_layer/box_predictor_".concat(e,"/box_encoding_predictor")),class_predictor:i("Prediction/BoxPredictor_".concat(e,"/ClassPredictor"),"prediction_layer/box_predictor_".concat(e,"/class_predictor"))}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!ZY(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have ".concat(i));var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:i}};return mJ(e,t),{params:o,paramMappings:t}}function g$(e,t,n){return qs((function(){var r=hl(e,t.filters,n,"same");return r=dc(r,t.batch_norm_offset),cl(r,0,6)}))}function y$(e,t){return qs((function(){var n,r=g$(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var a=t+1,i=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(a);r=function(e,t,n){return qs((function(){var r=Cl(e,t.filters,n,"same");return r=tl(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),cl(r,0,6)}))}(r,e.depthwise_conv,i),r=g$(r,e.pointwise_conv,[1,1]),11===a&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function b$(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),p=Math.max(r[n][1],r[n][3]),d=(o-a)*(s-i),f=(l-u)*(p-c);if(d<=0||f<=0)return 0;var h=Math.max(a,u),m=Math.max(i,c),v=Math.min(o,l),g=Math.min(s,p),y=Math.max(v-h,0)*Math.max(g-m,0);return y/(d+f-y)}function x$(e,t,n,r,a){var i=e.shape[0],o=Math.min(n,i),s=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>a})).sort((function(e,t){return t.score-e.score})),u=function(e){return e<=r?1:0},c=[];return s.forEach((function(t){if(!(c.length>=o)){for(var n=t.score,r=c.length-1;r>=0;--r){var i=b$(e,t.boxIndex,c[r]);if(0!==i&&(t.score*=u(i),t.score<=a))break}n===t.score&&c.push(t.boxIndex)}})),c}function k$(e,t){var n=function(e){var t=df(cu(e,[1,0])),n=[Rp(t[2],t[0]),Rp(t[3],t[1])];return{sizes:n,centers:[dc(t[0],hc(n[0],2)),dc(t[1],hc(n[1],2))]}}(e),r=n.sizes,a=n.centers,i=df(cu(t,[1,0])),o=hc(mc(np(hc(i[2],5)),r[0]),2),s=dc(mc(hc(i[0],10),r[0]),a[0]),u=hc(mc(np(hc(i[3],5)),r[1]),2),c=dc(mc(hc(i[1],10),r[1]),a[1]);return cu(Jd([Rp(s,o),Rp(c,u),dc(s,o),dc(c,u)]),[1,0])}function w$(e,t){return qs((function(){var n=e.shape[0];return{boxPredictionEncoding:jc(hJ(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:jc(hJ(e,t.class_predictor),[n,-1,3])}}))}var S$=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.minConfidence,r=t.maxResults;if((0,y.Z)(this,e),this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error("".concat(this._name," - expected minConfidence to be a number between 0 and 1"));if("number"!=typeof this._maxResults)throw new Error("".concat(this._name," - expected maxResults to be a number"))}return(0,b.Z)(e,[{key:"minConfidence",get:function(){return this._minConfidence}},{key:"maxResults",get:function(){return this._maxResults}}]),e}(),I$=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.call(this,"SsdMobilenetv1")}return(0,b.Z)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return qs((function(){var n=cs(e.toBatchTensor(512,!1),"float32"),r=y$(Rp(hc(n,127.5),1),t.mobilenetv1),a=function(e,t,n){return qs((function(){var r=g$(e,n.conv_0,[1,1]),a=g$(r,n.conv_1,[2,2]),i=g$(a,n.conv_2,[1,1]),o=g$(i,n.conv_3,[2,2]),s=g$(o,n.conv_4,[1,1]),u=g$(s,n.conv_5,[2,2]),c=g$(u,n.conv_6,[1,1]),l=g$(c,n.conv_7,[2,2]),p=w$(t,n.box_predictor_0),d=w$(e,n.box_predictor_1),f=w$(a,n.box_predictor_2),h=w$(o,n.box_predictor_3),m=w$(u,n.box_predictor_4),v=w$(l,n.box_predictor_5);return{boxPredictions:Kc([p.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:Kc([p.classPrediction,d.classPrediction,f.classPrediction,h.classPrediction,m.classPrediction,v.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return qs((function(){var r=e.shape[0],a=k$(jc(ip(n.extra_dim,[r,1,1]),[-1,4]),jc(e,[-1,4]));a=jc(a,[r,a.shape[0]/r,4]);var i=Xc(Yc(t,[0,0,1],[-1,-1,-1])),o=Yc(i,[0,0,0],[-1,-1,1]);return o=jc(o,[r,o.shape[1]]),{boxes:df(a),scores:df(o)}}))}(a.boxPredictions,a.classPredictions,t.output_layer)}))}},{key:"forward",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,UQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"locateFaces",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,d,f,h,g,y,b,x,k,w,S=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=S.length>1&&void 0!==S[1]?S[1]:{},r=new S$(n),a=r.maxResults,i=r.minConfidence,e.next=6,UQ(t);case 6:for(o=e.sent,s=this.forwardInput(o),u=s.boxes,c=s.scores,l=u[0],p=c[0],d=1;d<u.length;d++)u[d].dispose(),c[d].dispose();return f=Array.from(p.dataSync()),h=x$(l,f,a,.5,i),g=o.getReshapedInputDimensions(0),y=o.inputSize,b=y/g.width,x=y/g.height,k=l.arraySync(),w=h.map((function(e){var t=[Math.max(0,k[e][0]),Math.min(1,k[e][2])].map((function(e){return e*x})),n=(0,m.Z)(t,2),r=n[0],a=n[1],i=[Math.max(0,k[e][1]),Math.min(1,k[e][3])].map((function(e){return e*b})),s=(0,m.Z)(i,2),u=s[0],c=s[1];return new XY(f[e],new iQ(u,r,c-u,a-r),{height:o.getInputHeight(0),width:o.getInputWidth(0)})})),e.abrupt("return",(l.dispose(),p.dispose(),w));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"ssd_mobilenetv1_model"}},{key:"extractParamsFromWeightMap",value:function(e){return v$(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=wJ(e),r=n.extractWeights,a=n.getRemainingWeights,i=m$(r,t),o=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=o(),c=s(),l={extra_dim:gu(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)}}]),n}(lJ);function N$(e){var t=new I$;return t.extractWeights(e),t}function T$(e){return N$(e)}var C$=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n)}(I$),E$=[new jY(.738768,.874946),new jY(2.42204,2.65704),new jY(4.30971,7.04493),new jY(10.246,4.59428),new jY(12.6868,11.8741)],_$=[new jY(1.603231,2.094468),new jY(6.041143,7.080126),new jY(2.882459,3.518061),new jY(4.266906,5.178857),new jY(9.041765,10.66308)],A$=[117.001,114.697,97.404],R$=function(e){return"number"==typeof e};function F$(e){if(!e)throw new Error("invalid config: ".concat(e));if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: ".concat(e.withSeparableConvs));if(!R$(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: ".concat(e.iouThreshold));if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: ".concat(JSON.stringify(e.classes)));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return R$(e.x)&&R$(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: ".concat(JSON.stringify(e.anchors)));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(R$)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: ".concat(JSON.stringify(e.meanRgb)))}function D$(e){return qs((function(){var t=mc(e,Xl(.10000000149011612));return dc(Id(Rp(e,t)),t)}))}function Z$(e,t){return qs((function(){var n=ad(e,[[0,0],[1,1],[1,1],[0,0]]);return n=hl(n,t.conv.filters,[1,1],"valid"),n=Rp(n,t.bn.sub),n=mc(n,t.bn.truediv),D$(n=dc(n,t.conv.bias))}))}function O$(e,t){return qs((function(){var n=ad(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Zd(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),D$(n=dc(n,t.bias))}))}function M$(e,t){var n=vJ(e,t);var r=bJ(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,a,i){var o=n(r,a,3,"".concat(i,"/conv")),s=function(n,r){var a=nf(e(n)),i=nf(e(n));return t.push({paramPath:"".concat(r,"/sub")},{paramPath:"".concat(r,"/truediv")}),{sub:a,truediv:i}}(a,"".concat(i,"/bn"));return{conv:o,bn:s}},extractSeparableConvParams:r}}function z$(e,t){var n=kJ(e,t);function r(e){return{filters:n("".concat(e,"/filters"),4),bias:n("".concat(e,"/bias"),1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r("".concat(e,"/conv")),a=function(e){return{sub:n("".concat(e,"/sub"),1),truediv:n("".concat(e,"/truediv"),1)}}("".concat(e,"/bn"));return{conv:t,bn:a}},extractSeparableConvParams:xJ(n)}}var L$=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.inputSize,r=t.scoreThreshold;if((0,y.Z)(this,e),this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!==0)throw new Error("".concat(this._name," - expected inputSize to be a number divisible by 32"));if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error("".concat(this._name," - expected scoreThreshold to be a number between 0 and 1"))}return(0,b.Z)(e,[{key:"inputSize",get:function(){return this._inputSize}},{key:"scoreThreshold",get:function(){return this._scoreThreshold}}]),e}(),P$=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,y.Z)(this,n),r=t.call(this,"TinyYolov2"),F$(e),r._config=e,r}return(0,b.Z)(n,[{key:"config",get:function(){return this._config}},{key:"withClassScores",get:function(){return this.config.withClassScores||this.config.classes.length>1}},{key:"boxEncodingSize",get:function(){return 5+(this.withClassScores?this.config.classes.length:0)}},{key:"runTinyYolov2",value:function(e,t){var n=Z$(e,t.conv0);return n=Z$(n=Wp(n,[2,2],[2,2],"same"),t.conv1),n=Z$(n=Wp(n,[2,2],[2,2],"same"),t.conv2),n=Z$(n=Wp(n,[2,2],[2,2],"same"),t.conv3),n=Z$(n=Wp(n,[2,2],[2,2],"same"),t.conv4),n=Z$(n=Wp(n,[2,2],[2,2],"same"),t.conv5),n=Z$(n=Wp(n,[2,2],[1,1],"same"),t.conv6),hJ(n=Z$(n,t.conv7),t.conv8,"valid",!1)}},{key:"runMobilenet",value:function(e,t){var n=this.config.isFirstLayerConv2d?D$(hJ(e,t.conv0,"valid",!1)):O$(e,t.conv0);return n=O$(n=Wp(n,[2,2],[2,2],"same"),t.conv1),n=O$(n=Wp(n,[2,2],[2,2],"same"),t.conv2),n=O$(n=Wp(n,[2,2],[2,2],"same"),t.conv3),n=O$(n=Wp(n,[2,2],[2,2],"same"),t.conv4),n=O$(n=Wp(n,[2,2],[2,2],"same"),t.conv5),n=Wp(n,[2,2],[1,1],"same"),n=t.conv6?O$(n,t.conv6):n,hJ(n=t.conv7?O$(n,t.conv7):n,t.conv8,"valid",!1)}},{key:"forwardInput",value:function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return qs((function(){var a=cs(e.toBatchTensor(t,!1),"float32");return a=(a=n.config.meanRgb?$Y(a,n.config.meanRgb):a).div(255),n.config.withSeparableConvs?n.runMobilenet(a,r):n.runTinyYolov2(a,r)}))}},{key:"forward",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,UQ(t);case 3:return e.t1=e.sent,e.t2=n,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,d,f,h,m=this,g=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=g.length>1&&void 0!==g[1]?g[1]:{},r=new L$(n),a=r.inputSize,i=r.scoreThreshold,e.next=6,UQ(t);case 6:return o=e.sent,e.next=9,this.forwardInput(o,a);case 9:return s=e.sent,u=qs((function(){return df(s)[0].expandDims()})),c={width:o.getInputWidth(0),height:o.getInputHeight(0)},e.next=14,this.extractBoxes(u,o.getReshapedInputDimensions(0),i);case 14:return l=e.sent,s.dispose(),u.dispose(),p=l.map((function(e){return e.box})),d=l.map((function(e){return e.score})),f=l.map((function(e){return e.classScore})),h=l.map((function(e){return m.config.classes[e.label]})),e.abrupt("return",JY(p.map((function(e){return e.rescale(a)})),d,this.config.iouThreshold,!0).map((function(e){return new KY(d[e],f[e],h[e],p[e],c)})));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return""}},{key:"extractParamsFromWeightMap",value:function(e){return function(e,t){var n,r=[],a=z$(e,r),i=a.extractConvParams,o=a.extractConvWithBatchNormParams,s=a.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return mJ(e,r),{params:n,paramMappings:r}}(e,this.config)}},{key:"extractParams",value:function(e){var t=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,r=t?t.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found ".concat(r," filterSizes in config"));return function(e,t,n,r){var a,i=wJ(e),o=i.extractWeights,s=i.getRemainingWeights,u=[],c=M$(o,u),l=c.extractConvParams,p=c.extractConvWithBatchNormParams,d=c.extractSeparableConvParams;if(t.withSeparableConvs){var f=(0,m.Z)(r,9),h=f[0],v=f[1],g=f[2],y=f[3],b=f[4],x=f[5],k=f[6],w=f[7],S=f[8];a={conv0:t.isFirstLayerConv2d?l(h,v,3,"conv0"):d(h,v,"conv0"),conv1:d(v,g,"conv1"),conv2:d(g,y,"conv2"),conv3:d(y,b,"conv3"),conv4:d(b,x,"conv4"),conv5:d(x,k,"conv5"),conv6:w?d(k,w,"conv6"):void 0,conv7:S?d(w,S,"conv7"):void 0,conv8:l(S||w||k,5*n,1,"conv8")}}else{var I=(0,m.Z)(r,9),N=I[0],T=I[1],C=I[2],E=I[3],_=I[4],A=I[5],R=I[6],F=I[7],D=I[8];a={conv0:p(N,T,"conv0"),conv1:p(T,C,"conv1"),conv2:p(C,E,"conv2"),conv3:p(E,_,"conv3"),conv4:p(_,A,"conv4"),conv5:p(A,R,"conv5"),conv6:p(R,F,"conv6"),conv7:p(F,D,"conv7"),conv8:l(D,5*n,1,"conv8")}}if(0!==s().length)throw new Error("weights remaing after extract: ".concat(s().length));return{params:a,paramMappings:u}}(e,this.config,this.boxEncodingSize,t)}},{key:"extractBoxes",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n,r){var a,o,s,u,c,l,p,d,f,h,g,y,b,x,k,w,S,I,N,T,C,E,_,A,R,F,D,Z,O,M=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.width,o=n.height,s=Math.max(a,o),u=s/a,c=s/o,l=t.shape[1],p=this.config.anchors.length,d=qs((function(){var e=t.reshape([l,l,p,M.boxEncodingSize]);return[e.slice([0,0,0,0],[l,l,p,4]),e.slice([0,0,0,4],[l,l,p,1]),M.withClassScores?Gd(e.slice([0,0,0,5],[l,l,p,M.config.classes.length]),3):Xl(0)]})),f=(0,m.Z)(d,3),h=f[0],g=f[1],y=f[2],b=[],e.next=15,g.array();case 15:return x=e.sent,e.next=18,h.array();case 18:k=e.sent,w=0;case 20:if(!(w<l)){e.next=54;break}S=0;case 22:if(!(S<l)){e.next=51;break}I=0;case 24:if(!(I<p)){e.next=48;break}if(N=nQ(x[w][S][I][0]),r&&!(N>r)){e.next=45;break}if(T=(S+nQ(k[w][S][I][0]))/l*u,C=(w+nQ(k[w][S][I][1]))/l*c,E=Math.exp(k[w][S][I][2])*this.config.anchors[I].x/l*u,_=Math.exp(k[w][S][I][3])*this.config.anchors[I].y/l*c,A=T-E/2,R=C-_/2,F={row:w,col:S,anchor:I},!this.withClassScores){e.next=40;break}return e.next=37,this.extractPredictedClass(y,F);case 37:e.t0=e.sent,e.next=41;break;case 40:e.t0={classScore:1,label:0};case 41:D=e.t0,Z=D.classScore,O=D.label,b.push(i({box:new qY(A,R,A+E,R+_),score:N,classScore:N*Z,label:O},F));case 45:I++,e.next=24;break;case 48:S++,e.next=22;break;case 51:w++,e.next=20;break;case 54:return e.abrupt("return",(h.dispose(),g.dispose(),y.dispose(),b));case 55:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"extractPredictedClass",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){var r,a,i,o;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.row,a=n.col,i=n.anchor,e.next=5,t.array();case 5:return o=e.sent,e.abrupt("return",Array(this.config.classes.length).fill(0).map((function(e,t){return o[r][a][i][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(lJ),B$=P$;B$.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024];var W$=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,y.Z)(this,n);var r=i({withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:_$,meanRgb:A$}:{anchors:E$,withClassScores:!0});return t.call(this,r)}return(0,b.Z)(n,[{key:"withSeparableConvs",get:function(){return this.config.withSeparableConvs}},{key:"anchors",get:function(){return this.config.anchors}},{key:"locateFaces",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new XY(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"}},{key:"extractParamsFromWeightMap",value:function(e){return(0,o.Z)((0,s.Z)(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}}]),n}(B$);function V$(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new W$(t);return n.extractWeights(e),n}var U$=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,y.Z)(this,n),(e=t.apply(this,arguments))._name="TinyFaceDetectorOptions",e}return(0,b.Z)(n)}(L$),G$=function(){function e(){(0,y.Z)(this,e)}return(0,b.Z)(e,[{key:"then",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,this.run();case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("ComposableTask - run is not implemented");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();function j$(e,t,n,r){return H$.apply(this,arguments)}function H$(){return H$=(0,g.Z)((0,v.Z)().mark((function e(t,n,r,a){var i,o,s,u,c=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=c.length>4&&void 0!==c[4]?c[4]:function(e){return e.alignedRect},o=t.map((function(e){return MJ(e)?i(e):e.detection})),e.t0=a,e.t0){e.next=14;break}if(!(n instanceof hi)){e.next=10;break}return e.next=7,qQ(n,o);case 7:e.t1=e.sent,e.next=13;break;case 10:return e.next=12,jQ(n,o);case 12:e.t1=e.sent;case 13:e.t0=e.t1;case 14:return s=e.t0,e.next=17,r(s);case 17:return u=e.sent,e.abrupt("return",(s.forEach((function(e){return e instanceof hi&&e.dispose()})),u));case 19:case"end":return e.stop()}}),e)}))),H$.apply(this,arguments)}function q$(e,t,n,r,a){return K$.apply(this,arguments)}function K$(){return K$=(0,g.Z)((0,v.Z)().mark((function e(t,n,r,a,i){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",j$([t],n,function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r(t[0]));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a,i));case 1:case"end":return e.stop()}}),e)}))),K$.apply(this,arguments)}var X$=[new jY(1.603231,2.094468),new jY(6.041143,7.080126),new jY(2.882459,3.518061),new jY(4.266906,5.178857),new jY(9.041765,10.66308)],Y$=[117.001,114.697,97.404],Q$=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){(0,y.Z)(this,n);var e={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:X$,meanRgb:Y$,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)}return(0,b.Z)(n,[{key:"anchors",get:function(){return this.config.anchors}},{key:"locateFaces",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new XY(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_face_detector_model"}},{key:"extractParamsFromWeightMap",value:function(e){return(0,o.Z)((0,s.Z)(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}}]),n}(B$),J$={ssdMobilenetv1:new I$,tinyFaceDetector:new Q$,tinyYolov2:new W$,faceLandmark68Net:new YJ,faceLandmark68TinyNet:new JJ,faceRecognitionNet:new u$,faceExpressionNet:new FJ,ageGenderNet:new KJ},$$=function(e,t){return J$.ssdMobilenetv1.locateFaces(e,t)},e0=function(e,t){return J$.tinyFaceDetector.locateFaces(e,t)},t0=function(e,t){return J$.tinyYolov2.locateFaces(e,t)},n0=function(e){return J$.faceLandmark68Net.detectLandmarks(e)},r0=function(e){return J$.faceLandmark68TinyNet.detectLandmarks(e)},a0=function(e){return J$.faceRecognitionNet.computeFaceDescriptor(e)},i0=function(e){return J$.faceExpressionNet.predictExpressions(e)},o0=function(e){return J$.ageGenderNet.predictAgeAndGender(e)},s0=function(e){return J$.ssdMobilenetv1.load(e)},u0=function(e){return J$.tinyFaceDetector.load(e)},c0=function(e){return J$.tinyYolov2.load(e)},l0=function(e){return J$.faceLandmark68Net.load(e)},p0=function(e){return J$.faceLandmark68TinyNet.load(e)},d0=function(e){return J$.faceRecognitionNet.load(e)},f0=function(e){return J$.faceExpressionNet.load(e)},h0=function(e){return J$.ageGenderNet.load(e)},m0=s0,v0=$$,g0=n0,y0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a){var i;return(0,y.Z)(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return(0,b.Z)(n)}(G$),b0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,j$(t,this.input,function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return J$.faceExpressionNet.predictExpressions(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){return ZJ(e,n[t])})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withAgeAndGender",value:function(){return new I0(this,this.input)}}]),n}(y0),x0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,q$(t,this.input,(function(e){return J$.faceExpressionNet.predictExpressions(e)}),this.extractedFaces);case 7:return n=e.sent,e.abrupt("return",ZJ(t,n));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withAgeAndGender",value:function(){return new N0(this,this.input)}}]),n}(y0),k0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"withAgeAndGender",value:function(){return new T0(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new _0(this,this.input)}}]),n}(b0),w0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"withAgeAndGender",value:function(){return new C0(this,this.input)}},{key:"withFaceDescriptor",value:function(){return new A0(this,this.input)}}]),n}(x0),S0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a){var i;return(0,y.Z)(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return(0,b.Z)(n)}(G$),I0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,j$(t,this.input,function(){var e=(0,g.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return J$.ageGenderNet.predictAgeAndGender(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){var r=n[t],a=r.age;return d$(h$(e,r.gender,r.genderProbability),a)})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new b0(this,this.input)}}]),n}(S0),N0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,q$(t,this.input,(function(e){return J$.ageGenderNet.predictAgeAndGender(e)}),this.extractedFaces);case 7:return n=e.sent,r=n.age,a=n.gender,i=n.genderProbability,e.abrupt("return",d$(h$(t,a,i),r));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new x0(this,this.input)}}]),n}(S0),T0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"withFaceExpressions",value:function(){return new k0(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new _0(this,this.input)}}]),n}(I0),C0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"withFaceExpressions",value:function(){return new w0(this,this.input)}},{key:"withFaceDescriptor",value:function(){return new A0(this,this.input)}}]),n}(N0),E0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var a;return(0,y.Z)(this,n),(a=t.call(this)).parentTask=e,a.input=r,a}return(0,b.Z)(n)}(G$),_0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,j$(t,this.input,(function(e){return Promise.all(e.map((function(e){return J$.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}));case 5:return e.abrupt("return",e.sent.map((function(e,n){return l$(t[n],e)})));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new k0(this,this.input)}},{key:"withAgeAndGender",value:function(){return new T0(this,this.input)}}]),n}(E0),A0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,q$(t,this.input,(function(e){return J$.faceRecognitionNet.computeFaceDescriptor(e)}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}));case 7:return n=e.sent,e.abrupt("return",l$(t,n));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new w0(this,this.input)}},{key:"withAgeAndGender",value:function(){return new C0(this,this.input)}}]),n}(E0),R0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,a){var i;return(0,y.Z)(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.useTinyLandmarkNet=a,i}return(0,b.Z)(n,[{key:"landmarkNet",get:function(){return this.useTinyLandmarkNet?J$.faceLandmark68TinyNet:J$.faceLandmark68Net}}]),n}(G$),F0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a,i=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent,n=t.map((function(e){return e.detection})),!(this.input instanceof hi)){e.next=10;break}return e.next=7,qQ(this.input,n);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,jQ(this.input,n);case 12:e.t0=e.sent;case 13:return r=e.t0,e.next=16,Promise.all(r.map((function(e){return i.landmarkNet.detectLandmarks(e)})));case 16:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e instanceof hi&&e.dispose()})),t.filter((function(e,t){return a[t]})).map((function(e,t){return zJ(e,a[t])}))));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new k0(this,this.input)}},{key:"withAgeAndGender",value:function(){return new T0(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new _0(this,this.input)}}]),n}(R0),D0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(n=t.detection,!(this.input instanceof hi)){e.next=12;break}return e.next=9,qQ(this.input,[n]);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,jQ(this.input,[n]);case 14:e.t0=e.sent;case 15:return r=e.t0,e.next=18,this.landmarkNet.detectLandmarks(r[0]);case 18:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e instanceof hi&&e.dispose()})),zJ(t,a)));case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new w0(this,this.input)}},{key:"withAgeAndGender",value:function(){return new C0(this,this.input)}},{key:"withFaceDescriptor",value:function(){return new A0(this,this.input)}}]),n}(R0),Z0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S$;return(0,y.Z)(this,n),(r=t.call(this)).input=e,r.options=a,r}return(0,b.Z)(n)}(G$),O0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.input,!((n=this.options)instanceof U$)){e.next=5;break}r=J$.tinyFaceDetector.locateFaces(t,n),e.next=14;break;case 5:if(!(n instanceof S$)){e.next=9;break}r=J$.ssdMobilenetv1.locateFaces(t,n),e.next=14;break;case 9:if(!(n instanceof L$)){e.next=13;break}r=J$.tinyYolov2.locateFaces(t,n),e.next=14;break;case 13:throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | TinyYolov2Options");case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runAndExtendWithFaceDetections",value:function(){var e=this;return new Promise((function(t,n){e.run().then((function(e){return t(e.map((function(e){return hQ({},e)})))})).catch((function(e){return n(e)}))}))}},{key:"withFaceLandmarks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new F0(this.runAndExtendWithFaceDetections(),this.input,e)}},{key:"withFaceExpressions",value:function(){return new b0(this.runAndExtendWithFaceDetections(),this.input)}},{key:"withAgeAndGender",value:function(){return new I0(this.runAndExtendWithFaceDetections(),this.input)}}]),n}(Z0),M0=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,y.Z)(this,n),t.apply(this,arguments)}return(0,b.Z)(n,[{key:"run",value:function(){var e=(0,g.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new O0(this.input,this.options);case 2:return t=e.sent,n=t[0],e.abrupt("return",(t.forEach((function(e){e.score>n.score&&(n=e)})),n));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runAndExtendWithFaceDetection",value:function(){var e=this;return new Promise(function(){var t=(0,g.Z)((0,v.Z)().mark((function t(n){var r;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.run();case 2:r=t.sent,n(r?hQ({},r):void 0);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"withFaceLandmarks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new D0(this.runAndExtendWithFaceDetection(),this.input,e)}},{key:"withFaceExpressions",value:function(){return new x0(this.runAndExtendWithFaceDetection(),this.input)}},{key:"withAgeAndGender",value:function(){return new N0(this.runAndExtendWithFaceDetection(),this.input)}}]),n}(Z0);function z0(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S$;return new M0(e,t)}function L0(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new S$;return new O0(e,t)}function P0(e,t){return B0.apply(this,arguments)}function B0(){return B0=(0,g.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",L0(t,new S$(n?{minConfidence:n}:{})).withFaceLandmarks().withFaceDescriptors());case 1:case"end":return e.stop()}}),e)}))),B0.apply(this,arguments)}function W0(e){return V0.apply(this,arguments)}function V0(){return V0=(0,g.Z)((0,v.Z)().mark((function e(t){var n,r=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",L0(t,new L$(n)).withFaceLandmarks().withFaceDescriptors());case 2:case"end":return e.stop()}}),e)}))),V0.apply(this,arguments)}var U0=P0;function G0(e,t){if(e.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(e),r=Array.from(t);return Math.sqrt(n.map((function(e,t){return e-r[t]})).reduce((function(e,t){return e+Math.pow(t,2)}),0))}var j0=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.6;(0,y.Z)(this,e),this._distanceThreshold=n;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,i=function(){return"person ".concat(a++)};this._labeledDescriptors=r.map((function(e){if(e instanceof pQ)return e;if(e instanceof Float32Array)return new pQ(i(),[e]);if(e.descriptor&&e.descriptor instanceof Float32Array)return new pQ(i(),[e.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")}))}return(0,b.Z)(e,[{key:"labeledDescriptors",get:function(){return this._labeledDescriptors}},{key:"distanceThreshold",get:function(){return this._distanceThreshold}},{key:"computeMeanDistance",value:function(e,t){return t.map((function(t){return G0(t,e)})).reduce((function(e,t){return e+t}),0)/(t.length||1)}},{key:"matchDescriptor",value:function(e){var t=this;return this.labeledDescriptors.map((function(n){var r=n.descriptors,a=n.label;return new cQ(a,t.computeMeanDistance(e,r))})).reduce((function(e,t){return e.distance<t.distance?e:t}))}},{key:"findBestMatch",value:function(e){var t=this.matchDescriptor(e);return t.distance<this._distanceThreshold?t:new cQ("unknown",t.distance)}},{key:"toJSON",value:function(){return{distanceThreshold:this._distanceThreshold,labeledDescriptors:this._labeledDescriptors.map((function(e){return e.toJSON()}))}}}],[{key:"fromJSON",value:function(t){return new e(t.labeledDescriptors.map((function(e){return pQ.fromJSON(e)})),t.distanceThreshold)}}]),e}();function H0(e){var t=new Q$;return t.extractWeights(e),t}function q0(e,t){var n=new AY(t.width,t.height),r=n.width,a=n.height;if(r<=0||a<=0)throw new Error("resizeResults - invalid dimensions: ".concat(JSON.stringify({width:r,height:a})));if(Array.isArray(e))return e.map((function(e){return q0(e,{width:r,height:a})}));if(MJ(e)){var i=e.detection.forSize(r,a),o=e.unshiftedLandmarks.forSize(i.box.width,i.box.height);return zJ(hQ(e,i),o)}return fQ(e)?hQ(e,e.detection.forSize(r,a)):e instanceof oQ||e instanceof XY?e.forSize(r,a):e}var K0="1.7.1"},221:function(e,t,n){"use strict";function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t,n){var a=n.value;if("function"!==typeof a)throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(r(a)));var i=!1;return{configurable:!0,get:function(){if(i||this===e.prototype||this.hasOwnProperty(t)||"function"!==typeof a)return a;var n=a.bind(this);return i=!0,Object.defineProperty(this,t,{configurable:!0,get:function(){return n},set:function(e){a=e,delete this[t]}}),i=!1,n},set:function(e){a=e}}}function i(e){var t;return"undefined"!==typeof Reflect&&"function"===typeof Reflect.ownKeys?t=Reflect.ownKeys(e.prototype):(t=Object.getOwnPropertyNames(e.prototype),"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(e.prototype)))),t.forEach((function(t){if("constructor"!==t){var n=Object.getOwnPropertyDescriptor(e.prototype,t);"function"===typeof n.value&&Object.defineProperty(e.prototype,t,a(e,t,n))}})),e}function o(){return 1===arguments.length?i.apply(void 0,arguments):a.apply(void 0,arguments)}n.r(t),n.d(t,{boundClass:function(){return i},boundMethod:function(){return a},default:function(){return o}})},4569:function(e,t,n){e.exports=n(8036)},3381:function(e,t,n){"use strict";var r=n(3589),a=n(7297),i=n(9301),o=n(9774),s=n(1804),u=n(9145),c=n(5411),l=n(6789),p=n(4531),d=n(6569),f=n(6261);e.exports=function(e){return new Promise((function(t,n){var h,m=e.data,v=e.headers,g=e.responseType;function y(){e.cancelToken&&e.cancelToken.unsubscribe(h),e.signal&&e.signal.removeEventListener("abort",h)}r.isFormData(m)&&r.isStandardBrowserEnv()&&delete v["Content-Type"];var b=new XMLHttpRequest;if(e.auth){var x=e.auth.username||"",k=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";v.Authorization="Basic "+btoa(x+":"+k)}var w=s(e.baseURL,e.url);function S(){if(b){var r="getAllResponseHeaders"in b?u(b.getAllResponseHeaders()):null,i={data:g&&"text"!==g&&"json"!==g?b.response:b.responseText,status:b.status,statusText:b.statusText,headers:r,config:e,request:b};a((function(e){t(e),y()}),(function(e){n(e),y()}),i),b=null}}if(b.open(e.method.toUpperCase(),o(w,e.params,e.paramsSerializer),!0),b.timeout=e.timeout,"onloadend"in b?b.onloadend=S:b.onreadystatechange=function(){b&&4===b.readyState&&(0!==b.status||b.responseURL&&0===b.responseURL.indexOf("file:"))&&setTimeout(S)},b.onabort=function(){b&&(n(new p("Request aborted",p.ECONNABORTED,e,b)),b=null)},b.onerror=function(){n(new p("Network Error",p.ERR_NETWORK,e,b,b)),b=null},b.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||l;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new p(t,r.clarifyTimeoutError?p.ETIMEDOUT:p.ECONNABORTED,e,b)),b=null},r.isStandardBrowserEnv()){var I=(e.withCredentials||c(w))&&e.xsrfCookieName?i.read(e.xsrfCookieName):void 0;I&&(v[e.xsrfHeaderName]=I)}"setRequestHeader"in b&&r.forEach(v,(function(e,t){"undefined"===typeof m&&"content-type"===t.toLowerCase()?delete v[t]:b.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(b.withCredentials=!!e.withCredentials),g&&"json"!==g&&(b.responseType=e.responseType),"function"===typeof e.onDownloadProgress&&b.addEventListener("progress",e.onDownloadProgress),"function"===typeof e.onUploadProgress&&b.upload&&b.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(h=function(e){b&&(n(!e||e&&e.type?new d:e),b.abort(),b=null)},e.cancelToken&&e.cancelToken.subscribe(h),e.signal&&(e.signal.aborted?h():e.signal.addEventListener("abort",h))),m||(m=null);var N=f(w);N&&-1===["http","https","file"].indexOf(N)?n(new p("Unsupported protocol "+N+":",p.ERR_BAD_REQUEST,e)):b.send(m)}))}},8036:function(e,t,n){"use strict";var r=n(3589),a=n(4049),i=n(3773),o=n(777);var s=function e(t){var n=new i(t),s=a(i.prototype.request,n);return r.extend(s,i.prototype,n),r.extend(s,n),s.create=function(n){return e(o(t,n))},s}(n(1709));s.Axios=i,s.CanceledError=n(6569),s.CancelToken=n(6857),s.isCancel=n(5517),s.VERSION=n(7600).version,s.toFormData=n(1397),s.AxiosError=n(4531),s.Cancel=s.CanceledError,s.all=function(e){return Promise.all(e)},s.spread=n(8089),s.isAxiosError=n(9580),e.exports=s,e.exports.default=s},6857:function(e,t,n){"use strict";var r=n(6569);function a(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}a.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},a.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},a.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},a.source=function(){var e;return{token:new a((function(t){e=t})),cancel:e}},e.exports=a},6569:function(e,t,n){"use strict";var r=n(4531);function a(e){r.call(this,null==e?"canceled":e,r.ERR_CANCELED),this.name="CanceledError"}n(3589).inherits(a,r,{__CANCEL__:!0}),e.exports=a},5517:function(e){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},3773:function(e,t,n){"use strict";var r=n(3589),a=n(9774),i=n(7470),o=n(2733),s=n(777),u=n(1804),c=n(7835),l=c.validators;function p(e){this.defaults=e,this.interceptors={request:new i,response:new i}}p.prototype.request=function(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},(t=s(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&c.assertOptions(n,{silentJSONParsing:l.transitional(l.boolean),forcedJSONParsing:l.transitional(l.boolean),clarifyTimeoutError:l.transitional(l.boolean)},!1);var r=[],a=!0;this.interceptors.request.forEach((function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var i,u=[];if(this.interceptors.response.forEach((function(e){u.push(e.fulfilled,e.rejected)})),!a){var p=[o,void 0];for(Array.prototype.unshift.apply(p,r),p=p.concat(u),i=Promise.resolve(t);p.length;)i=i.then(p.shift(),p.shift());return i}for(var d=t;r.length;){var f=r.shift(),h=r.shift();try{d=f(d)}catch(m){h(m);break}}try{i=o(d)}catch(m){return Promise.reject(m)}for(;u.length;)i=i.then(u.shift(),u.shift());return i},p.prototype.getUri=function(e){e=s(this.defaults,e);var t=u(e.baseURL,e.url);return a(t,e.params,e.paramsSerializer)},r.forEach(["delete","get","head","options"],(function(e){p.prototype[e]=function(t,n){return this.request(s(n||{},{method:e,url:t,data:(n||{}).data}))}})),r.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,a){return this.request(s(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}p.prototype[e]=t(),p.prototype[e+"Form"]=t(!0)})),e.exports=p},4531:function(e,t,n){"use strict";var r=n(3589);function a(e,t,n,r,a){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a)}r.inherits(a,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var i=a.prototype,o={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){o[e]={value:e}})),Object.defineProperties(a,o),Object.defineProperty(i,"isAxiosError",{value:!0}),a.from=function(e,t,n,o,s,u){var c=Object.create(i);return r.toFlatObject(e,c,(function(e){return e!==Error.prototype})),a.call(c,e.message,t,n,o,s),c.name=e.name,u&&Object.assign(c,u),c},e.exports=a},7470:function(e,t,n){"use strict";var r=n(3589);function a(){this.handlers=[]}a.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},a.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},a.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=a},1804:function(e,t,n){"use strict";var r=n(4044),a=n(9549);e.exports=function(e,t){return e&&!r(t)?a(e,t):t}},2733:function(e,t,n){"use strict";var r=n(3589),a=n(2693),i=n(5517),o=n(1709),s=n(6569);function u(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new s}e.exports=function(e){return u(e),e.headers=e.headers||{},e.data=a.call(e,e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return u(e),t.data=a.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return i(t)||(u(e),t&&t.response&&(t.response.data=a.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},777:function(e,t,n){"use strict";var r=n(3589);e.exports=function(e,t){t=t||{};var n={};function a(e,t){return r.isPlainObject(e)&&r.isPlainObject(t)?r.merge(e,t):r.isPlainObject(t)?r.merge({},t):r.isArray(t)?t.slice():t}function i(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:a(void 0,e[n]):a(e[n],t[n])}function o(e){if(!r.isUndefined(t[e]))return a(void 0,t[e])}function s(n){return r.isUndefined(t[n])?r.isUndefined(e[n])?void 0:a(void 0,e[n]):a(void 0,t[n])}function u(n){return n in t?a(e[n],t[n]):n in e?a(void 0,e[n]):void 0}var c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:u};return r.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,a=t(e);r.isUndefined(a)&&t!==u||(n[e]=a)})),n}},7297:function(e,t,n){"use strict";var r=n(4531);e.exports=function(e,t,n){var a=n.config.validateStatus;n.status&&a&&!a(n.status)?t(new r("Request failed with status code "+n.status,[r.ERR_BAD_REQUEST,r.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}},2693:function(e,t,n){"use strict";var r=n(3589),a=n(1709);e.exports=function(e,t,n){var i=this||a;return r.forEach(n,(function(n){e=n.call(i,e,t)})),e}},1709:function(e,t,n){"use strict";var r=n(3589),a=n(4341),i=n(4531),o=n(6789),s=n(1397),u={"Content-Type":"application/x-www-form-urlencoded"};function c(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var l={transitional:o,adapter:function(){var e;return("undefined"!==typeof XMLHttpRequest||"undefined"!==typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(e=n(3381)),e}(),transformRequest:[function(e,t){if(a(t,"Accept"),a(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e))return e;if(r.isArrayBufferView(e))return e.buffer;if(r.isURLSearchParams(e))return c(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,i=r.isObject(e),o=t&&t["Content-Type"];if((n=r.isFileList(e))||i&&"multipart/form-data"===o){var u=this.env&&this.env.FormData;return s(n?{"files[]":e}:e,u&&new u)}return i||"application/json"===o?(c(t,"application/json"),function(e,t,n){if(r.isString(e))try{return(t||JSON.parse)(e),r.trim(e)}catch(a){if("SyntaxError"!==a.name)throw a}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||l.transitional,n=t&&t.silentJSONParsing,a=t&&t.forcedJSONParsing,o=!n&&"json"===this.responseType;if(o||a&&r.isString(e)&&e.length)try{return JSON.parse(e)}catch(s){if(o){if("SyntaxError"===s.name)throw i.from(s,i.ERR_BAD_RESPONSE,this,null,this.response);throw s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:n(3035)},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){l.headers[e]=r.merge(u)})),e.exports=l},6789:function(e){"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},7600:function(e){e.exports={version:"0.27.2"}},4049:function(e){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},9774:function(e,t,n){"use strict";var r=n(3589);function a(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var i;if(n)i=n(t);else if(r.isURLSearchParams(t))i=t.toString();else{var o=[];r.forEach(t,(function(e,t){null!==e&&"undefined"!==typeof e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),o.push(a(t)+"="+a(e))})))})),i=o.join("&")}if(i){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}},9549:function(e){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},9301:function(e,t,n){"use strict";var r=n(3589);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,a,i,o){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(a)&&s.push("path="+a),r.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},4044:function(e){"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},9580:function(e,t,n){"use strict";var r=n(3589);e.exports=function(e){return r.isObject(e)&&!0===e.isAxiosError}},5411:function(e,t,n){"use strict";var r=n(3589);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function a(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=a(window.location.href),function(t){var n=r.isString(t)?a(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},4341:function(e,t,n){"use strict";var r=n(3589);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},3035:function(e){e.exports=null},9145:function(e,t,n){"use strict";var r=n(3589),a=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,i,o={};return e?(r.forEach(e.split("\n"),(function(e){if(i=e.indexOf(":"),t=r.trim(e.substr(0,i)).toLowerCase(),n=r.trim(e.substr(i+1)),t){if(o[t]&&a.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}})),o):o}},6261:function(e){"use strict";e.exports=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}},8089:function(e){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},1397:function(e,t,n){"use strict";var r=n(3589);e.exports=function(e,t){t=t||new FormData;var n=[];function a(e){return null===e?"":r.isDate(e)?e.toISOString():r.isArrayBuffer(e)||r.isTypedArray(e)?"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(i,o){if(r.isPlainObject(i)||r.isArray(i)){if(-1!==n.indexOf(i))throw Error("Circular reference detected in "+o);n.push(i),r.forEach(i,(function(n,i){if(!r.isUndefined(n)){var s,u=o?o+"."+i:i;if(n&&!o&&"object"===typeof n)if(r.endsWith(i,"{}"))n=JSON.stringify(n);else if(r.endsWith(i,"[]")&&(s=r.toArray(n)))return void s.forEach((function(e){!r.isUndefined(e)&&t.append(u,a(e))}));e(n,u)}})),n.pop()}else t.append(o,a(i))}(e),t}},7835:function(e,t,n){"use strict";var r=n(7600).version,a=n(4531),i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var o={};i.transitional=function(e,t,n){function i(e,t){return"[Axios v"+r+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,r,s){if(!1===e)throw new a(i(r," has been removed"+(t?" in "+t:"")),a.ERR_DEPRECATED);return t&&!o[r]&&(o[r]=!0,console.warn(i(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,r,s)}},e.exports={assertOptions:function(e,t,n){if("object"!==typeof e)throw new a("options must be an object",a.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],s=t[o];if(s){var u=e[o],c=void 0===u||s(u,o,e);if(!0!==c)throw new a("option "+o+" must be "+c,a.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new a("Unknown option "+o,a.ERR_BAD_OPTION)}},validators:i}},3589:function(e,t,n){"use strict";var r,a=n(4049),i=Object.prototype.toString,o=(r=Object.create(null),function(e){var t=i.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())});function s(e){return e=e.toLowerCase(),function(t){return o(t)===e}}function u(e){return Array.isArray(e)}function c(e){return"undefined"===typeof e}var l=s("ArrayBuffer");function p(e){return null!==e&&"object"===typeof e}function d(e){if("object"!==o(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var f=s("Date"),h=s("File"),m=s("Blob"),v=s("FileList");function g(e){return"[object Function]"===i.call(e)}var y=s("URLSearchParams");function b(e,t){if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),u(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}var x,k=(x="undefined"!==typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return x&&e instanceof x});e.exports={isArray:u,isArrayBuffer:l,isBuffer:function(e){return null!==e&&!c(e)&&null!==e.constructor&&!c(e.constructor)&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"===typeof FormData&&e instanceof FormData||i.call(e)===t||g(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&l(e.buffer)},isString:function(e){return"string"===typeof e},isNumber:function(e){return"number"===typeof e},isObject:p,isPlainObject:d,isUndefined:c,isDate:f,isFile:h,isBlob:m,isFunction:g,isStream:function(e){return p(e)&&g(e.pipe)},isURLSearchParams:y,isStandardBrowserEnv:function(){return("undefined"===typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!==typeof window&&"undefined"!==typeof document)},forEach:b,merge:function e(){var t={};function n(n,r){d(t[r])&&d(n)?t[r]=e(t[r],n):d(n)?t[r]=e({},n):u(n)?t[r]=n.slice():t[r]=n}for(var r=0,a=arguments.length;r<a;r++)b(arguments[r],n);return t},extend:function(e,t,n){return b(t,(function(t,r){e[r]=n&&"function"===typeof t?a(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,a,i,o={};t=t||{};do{for(a=(r=Object.getOwnPropertyNames(e)).length;a-- >0;)o[i=r[a]]||(t[i]=e[i],o[i]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:o,kindOfTest:s,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(c(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:k,isFileList:v}},2110:function(e,t,n){"use strict";var r=n(8309),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function u(e){return r.isMemo(e)?o:s[e.$$typeof]||a}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=o;var c=Object.defineProperty,l=Object.getOwnPropertyNames,p=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,f=Object.getPrototypeOf,h=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(h){var a=f(n);a&&a!==h&&e(t,a,r)}var o=l(n);p&&(o=o.concat(p(n)));for(var s=u(t),m=u(n),v=0;v<o.length;++v){var g=o[v];if(!i[g]&&(!r||!r[g])&&(!m||!m[g])&&(!s||!s[g])){var y=d(n,g);try{c(t,g,y)}catch(b){}}}}return t}},746:function(e,t){"use strict";var n="function"===typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,p=n?Symbol.for("react.concurrent_mode"):60111,d=n?Symbol.for("react.forward_ref"):60112,f=n?Symbol.for("react.suspense"):60113,h=n?Symbol.for("react.suspense_list"):60120,m=n?Symbol.for("react.memo"):60115,v=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,x=n?Symbol.for("react.scope"):60119;function k(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case l:case p:case i:case s:case o:case f:return e;default:switch(e=e&&e.$$typeof){case c:case d:case v:case m:case u:return e;default:return t}}case a:return t}}}function w(e){return k(e)===p}t.AsyncMode=l,t.ConcurrentMode=p,t.ContextConsumer=c,t.ContextProvider=u,t.Element=r,t.ForwardRef=d,t.Fragment=i,t.Lazy=v,t.Memo=m,t.Portal=a,t.Profiler=s,t.StrictMode=o,t.Suspense=f,t.isAsyncMode=function(e){return w(e)||k(e)===l},t.isConcurrentMode=w,t.isContextConsumer=function(e){return k(e)===c},t.isContextProvider=function(e){return k(e)===u},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return k(e)===d},t.isFragment=function(e){return k(e)===i},t.isLazy=function(e){return k(e)===v},t.isMemo=function(e){return k(e)===m},t.isPortal=function(e){return k(e)===a},t.isProfiler=function(e){return k(e)===s},t.isStrictMode=function(e){return k(e)===o},t.isSuspense=function(e){return k(e)===f},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===i||e===p||e===s||e===o||e===f||e===h||"object"===typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===m||e.$$typeof===u||e.$$typeof===c||e.$$typeof===d||e.$$typeof===y||e.$$typeof===b||e.$$typeof===x||e.$$typeof===g)},t.typeOf=k},8309:function(e,t,n){"use strict";e.exports=n(746)},8987:function(e){e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(N){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function o(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=u(e,(0|e)<0?-1:0,!0),o&&(i[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=u(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function s(e,t){if(isNaN(e))return t?g:v;if(t){if(e<0)return g;if(e>=f)return w}else{if(e<=-h)return S;if(e+1>=h)return k}return e<0?s(-e,t).neg():u(e%d|0,e/d|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=s,n.fromBits=u;var c=Math.pow;function l(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return v;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,n).neg();for(var a=s(c(n,8)),i=v,o=0;o<e.length;o+=8){var u=Math.min(8,e.length-o),p=parseInt(e.substring(o,o+u),n);if(u<8){var d=s(c(n,u));i=i.mul(d).add(s(p))}else i=(i=i.mul(a)).add(s(p))}return i.unsigned=t,i}function p(e,t){return"number"===typeof e?s(e,t):"string"===typeof e?l(e,t):u(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=l,n.fromValue=p;var d=4294967296,f=d*d,h=f/2,m=o(1<<24),v=o(0);n.ZERO=v;var g=o(0,!0);n.UZERO=g;var y=o(1);n.ONE=y;var b=o(1,!0);n.UONE=b;var x=o(-1);n.NEG_ONE=x;var k=u(-1,2147483647,!1);n.MAX_VALUE=k;var w=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var S=u(0,-2147483648,!1);n.MIN_VALUE=S;var I=n.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=s(c(e,6),this.unsigned),i=this,o="";;){var u=i.div(a),l=(i.sub(u.mul(a)).toInt()>>>0).toString(e);if((i=u).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1===(1&this.low)},I.isEven=function(){return 0===(1&this.low)},I.equals=function(e){return r(e)||(e=p(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return this.comp(e)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return this.comp(e)<=0},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(r(e)||(e=p(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(y)},I.neg=I.negate,I.add=function(e){r(e)||(e=p(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,c=e.low>>>16,l=0,d=0,f=0,h=0;return f+=(h+=i+(65535&e.low))>>>16,d+=(f+=a+c)>>>16,l+=(d+=n+s)>>>16,l+=t+o,u((f&=65535)<<16|(h&=65535),(l&=65535)<<16|(d&=65535),this.unsigned)},I.subtract=function(e){return r(e)||(e=p(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return v;if(r(e)||(e=p(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return v;if(this.eq(S))return e.isOdd()?S:v;if(e.eq(S))return this.isOdd()?S:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,o=65535&this.low,c=e.high>>>16,l=65535&e.high,d=e.low>>>16,f=65535&e.low,h=0,g=0,y=0,b=0;return y+=(b+=o*f)>>>16,g+=(y+=i*f)>>>16,y&=65535,g+=(y+=o*d)>>>16,h+=(g+=a*f)>>>16,g&=65535,h+=(g+=i*d)>>>16,g&=65535,h+=(g+=o*l)>>>16,h+=n*f+a*d+i*l+o*c,u((y&=65535)<<16|(b&=65535),(h&=65535)<<16|(g&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(r(e)||(e=p(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:v;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return b;i=g}else{if(this.eq(S))return e.eq(y)||e.eq(x)?S:e.eq(S)?y:(n=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?y:x:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(S))return this.unsigned?g:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=v}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),l=o<=48?1:c(2,o-48),d=s(n),f=d.mul(e);f.isNegative()||f.gt(a);)f=(d=s(n-=l,this.unsigned)).mul(e);d.isZero()&&(d=y),i=i.add(d),a=a.sub(f)}return i},I.div=I.divide,I.modulo=function(e){return r(e)||(e=p(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return u(~this.low,~this.high,this.unsigned)},I.and=function(e){return r(e)||(e=p(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return r(e)||(e=p(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return r(e)||(e=p(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},4463:function(e,t,n){"use strict";var r=n(2791),a=n(5296);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),p=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},h={};function m(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var a=v.hasOwnProperty(t)?v[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!p.call(h,e)||!p.call(f,e)&&(d.test(e)?h[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),C=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),F=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var Z=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=Z&&e[Z]||e["@@iterator"])?e:null}var M,z=Object.assign;function L(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var P=!1;function B(e,t){if(!e||P)return"";P=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var u="\n"+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{P=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?L(e):""}function W(e){switch(e.tag){case 5:return L(e.type);case 16:return L("Lazy");case 13:return L("Suspense");case 19:return L("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case N:return"Profiler";case I:return"StrictMode";case _:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case F:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function U(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===I?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function j(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=j(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=j(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=G(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Q(e,t);var n=G(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+G(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:G(n)}}function ie(e,t){var n=G(t.value),r=G(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,pe=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},he=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(fe).forEach((function(e){he.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ge=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Ie=null;function Ne(e){if(e=ba(e)){if("function"!==typeof we)throw Error(i(280));var t=e.stateNode;t&&(t=ka(t),we(e.stateNode,e.type,t))}}function Te(e){Se?Ie?Ie.push(e):Ie=[e]:Se=e}function Ce(){if(Se){var e=Se,t=Ie;if(Ie=Se=null,Ne(e),t)for(e=0;e<t.length;e++)Ne(t[e])}}function Ee(e,t){return e(t)}function _e(){}var Ae=!1;function Re(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Ee(e,t,n)}finally{Ae=!1,(null!==Se||null!==Ie)&&(_e(),Ce())}}function Fe(e,t){var n=e.stateNode;if(null===n)return null;var r=ka(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var De=!1;if(l)try{var Ze={};Object.defineProperty(Ze,"passive",{get:function(){De=!0}}),window.addEventListener("test",Ze,Ze),window.removeEventListener("test",Ze,Ze)}catch(le){De=!1}function Oe(e,t,n,r,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Me=!1,ze=null,Le=!1,Pe=null,Be={onError:function(e){Me=!0,ze=e}};function We(e,t,n,r,a,i,o,s,u){Me=!1,ze=null,Oe.apply(Be,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ue(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ge(e){if(Ve(e)!==e)throw Error(i(188))}function je(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return Ge(a),e;if(o===r)return Ge(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=o;break}if(u===r){s=!0,r=a,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=a;break}if(u===r){s=!0,r=o,n=a;break}u=u.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var qe=a.unstable_scheduleCallback,Ke=a.unstable_cancelCallback,Xe=a.unstable_shouldYield,Ye=a.unstable_requestPaint,Qe=a.unstable_now,Je=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var ot=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function pt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=pt(s):0!==(i&=o)&&(r=pt(i))}else 0!==(o=n&~a)?r=pt(o):0!==i&&(r=pt(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-ot(t)),r|=e[n],t&=~a;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ht(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var kt,wt,St,It,Nt,Tt=!1,Ct=[],Et=null,_t=null,At=null,Rt=new Map,Ft=new Map,Dt=[],Zt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":_t=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ft.delete(t.pointerId)}}function Mt(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=ba(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function zt(e){var t=ya(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ue(n)))return e.blockedOn=t,void Nt(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Lt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ba(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Pt(e,t,n){Lt(e)&&n.delete(t)}function Bt(){Tt=!1,null!==Et&&Lt(Et)&&(Et=null),null!==_t&&Lt(_t)&&(_t=null),null!==At&&Lt(At)&&(At=null),Rt.forEach(Pt),Ft.forEach(Pt)}function Wt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Bt)))}function Vt(e){function t(t){return Wt(t,e)}if(0<Ct.length){Wt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Et&&Wt(Et,e),null!==_t&&Wt(_t,e),null!==At&&Wt(At,e),Rt.forEach(t),Ft.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)zt(n),null===n.blockedOn&&Dt.shift()}var Ut=x.ReactCurrentBatchConfig,Gt=!0;function jt(e,t,n,r){var a=bt,i=Ut.transition;Ut.transition=null;try{bt=1,qt(e,t,n,r)}finally{bt=a,Ut.transition=i}}function Ht(e,t,n,r){var a=bt,i=Ut.transition;Ut.transition=null;try{bt=4,qt(e,t,n,r)}finally{bt=a,Ut.transition=i}}function qt(e,t,n,r){if(Gt){var a=Xt(e,t,n,r);if(null===a)Gr(e,t,r,Kt,n),Ot(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Et=Mt(Et,e,t,n,r,a),!0;case"dragenter":return _t=Mt(_t,e,t,n,r,a),!0;case"mouseover":return At=Mt(At,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Rt.set(i,Mt(Rt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Ft.set(i,Mt(Ft.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Zt.indexOf(e)){for(;null!==a;){var i=ba(a);if(null!==i&&kt(i),null===(i=Xt(e,t,n,r))&&Gr(e,t,r,Kt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Gr(e,t,r,null,n)}}var Kt=null;function Xt(e,t,n,r){if(Kt=null,null!==(e=ya(e=ke(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ue(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Qt=null,Jt=null,$t=null;function en(){if($t)return $t;var e,t,n=Jt,r=n.length,a="value"in Qt?Qt.value:Qt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(cn),pn=z({},cn,{view:0,detail:0}),dn=an(pn),fn=z({},pn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),hn=an(fn),mn=an(z({},fn,{dataTransfer:0})),vn=an(z({},pn,{relatedTarget:0})),gn=an(z({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=z({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),xn=an(z({},cn,{data:0})),kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function In(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function Nn(){return In}var Tn=z({},pn,{key:function(e){if(e.key){var t=kn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=an(Tn),En=an(z({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),_n=an(z({},pn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nn})),An=an(z({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=z({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Fn=an(Rn),Dn=[9,13,27,32],Zn=l&&"CompositionEvent"in window,On=null;l&&"documentMode"in document&&(On=document.documentMode);var Mn=l&&"TextEvent"in window&&!On,zn=l&&(!Zn||On&&8<On&&11>=On),Ln=String.fromCharCode(32),Pn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Un={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Un[e.type]:"textarea"===t}function jn(e,t,n,r){Te(r),0<(t=Hr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,qn=null;function Kn(e){Lr(e,0)}function Xn(e){if(q(xa(e)))return e}function Yn(e,t){if("change"===e)return t}var Qn=!1;if(l){var Jn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Jn=$n}else Jn=!1;Qn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Hn&&(Hn.detachEvent("onpropertychange",nr),qn=Hn=null)}function nr(e){if("value"===e.propertyName&&Xn(qn)){var t=[];jn(t,qn,e,ke(e)),Re(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),qn=n,(Hn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(qn)}function ir(e,t){if("click"===e)return Xn(t)}function or(e,t){if("input"===e||"change"===e)return Xn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!p.call(t,a)||!sr(e[a],t[a]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function pr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function hr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&pr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=lr(n,i);var o=lr(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=l&&"documentMode"in document&&11>=document.documentMode,vr=null,gr=null,yr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==vr||vr!==K(r)||("selectionStart"in(r=vr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=Hr(gr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=vr)))}function kr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:kr("Animation","AnimationEnd"),animationiteration:kr("Animation","AnimationIteration"),animationstart:kr("Animation","AnimationStart"),transitionend:kr("Transition","TransitionEnd")},Sr={},Ir={};function Nr(e){if(Sr[e])return Sr[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ir)return Sr[e]=n[t];return e}l&&(Ir=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Tr=Nr("animationend"),Cr=Nr("animationiteration"),Er=Nr("animationstart"),_r=Nr("transitionend"),Ar=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fr(e,t){Ar.set(e,t),u(t,[e])}for(var Dr=0;Dr<Rr.length;Dr++){var Zr=Rr[Dr];Fr(Zr.toLowerCase(),"on"+(Zr[0].toUpperCase()+Zr.slice(1)))}Fr(Tr,"onAnimationEnd"),Fr(Cr,"onAnimationIteration"),Fr(Er,"onAnimationStart"),Fr("dblclick","onDoubleClick"),Fr("focusin","onFocus"),Fr("focusout","onBlur"),Fr(_r,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function zr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,u,c){if(We.apply(this,arguments),Me){if(!Me)throw Error(i(198));var l=ze;Me=!1,ze=null,Le||(Le=!0,Pe=l)}}(r,t,void 0,e),e.currentTarget=null}function Lr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;zr(a,s,c),i=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,c=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;zr(a,s,c),i=u}}}if(Le)throw e=Pe,Le=!1,Pe=null,e}function Pr(e,t){var n=t[ma];void 0===n&&(n=t[ma]=new Set);var r=e+"__bubble";n.has(r)||(Ur(t,e,2,!1),n.add(r))}function Br(e,t,n){var r=0;t&&(r|=4),Ur(n,e,r,t)}var Wr="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[Wr]){e[Wr]=!0,o.forEach((function(t){"selectionchange"!==t&&(Mr.has(t)||Br(t,!1,e),Br(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Wr]||(t[Wr]=!0,Br("selectionchange",!1,t))}}function Ur(e,t,n,r){switch(Yt(t)){case 1:var a=jt;break;case 4:a=Ht;break;default:a=qt}n=a.bind(null,t,n,e),a=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Gr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===a||8===u.nodeType&&u.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ya(s)))return;if(5===(u=o.tag)||6===u){r=i=o;continue e}s=s.parentNode}}r=r.return}Re((function(){var r=i,a=ke(n),o=[];e:{var s=Ar.get(e);if(void 0!==s){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=Cn;break;case"focusin":c="focus",u=vn;break;case"focusout":c="blur",u=vn;break;case"beforeblur":case"afterblur":u=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=hn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=_n;break;case Tr:case Cr:case Er:u=gn;break;case _r:u=An;break;case"scroll":u=dn;break;case"wheel":u=Fn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=En}var l=0!==(4&t),p=!l&&"scroll"===e,d=l?null!==s?s+"Capture":null:s;l=[];for(var f,h=r;null!==h;){var m=(f=h).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==d&&(null!=(m=Fe(h,d))&&l.push(jr(h,m,f)))),p)break;h=h.return}0<l.length&&(s=new u(s,c,null,n,a),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!ya(c)&&!c[ha])&&(u||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?ya(c):null)&&(c!==(p=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=hn,m="onMouseLeave",d="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(l=En,m="onPointerLeave",d="onPointerEnter",h="pointer"),p=null==u?s:xa(u),f=null==c?s:xa(c),(s=new l(m,h+"leave",u,n,a)).target=p,s.relatedTarget=f,m=null,ya(a)===r&&((l=new l(d,h+"enter",c,n,a)).target=f,l.relatedTarget=p,m=l),p=m,u&&c)e:{for(d=c,h=0,f=l=u;f;f=qr(f))h++;for(f=0,m=d;m;m=qr(m))f++;for(;0<h-f;)l=qr(l),h--;for(;0<f-h;)d=qr(d),f--;for(;h--;){if(l===d||null!==d&&l===d.alternate)break e;l=qr(l),d=qr(d)}l=null}else l=null;null!==u&&Kr(o,s,u,l,!1),null!==c&&null!==p&&Kr(o,p,c,l,!0)}if("select"===(u=(s=r?xa(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var v=Yn;else if(Gn(s))if(Qn)v=or;else{v=ar;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=ir);switch(v&&(v=v(e,r))?jn(o,v,n,a):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?xa(r):window,e){case"focusin":(Gn(g)||"true"===g.contentEditable)&&(vr=g,gr=r,yr=null);break;case"focusout":yr=gr=vr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(o,n,a);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":xr(o,n,a)}var y;if(Zn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vn?Bn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(zn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(y=en()):(Jt="value"in(Qt=a)?Qt.value:Qt.textContent,Vn=!0)),0<(g=Hr(r,b)).length&&(b=new xn(b,e,null,n,a),o.push({event:b,listeners:g}),y?b.data=y:null!==(y=Wn(n))&&(b.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Wn(t);case"keypress":return 32!==t.which?null:(Pn=!0,Ln);case"textInput":return(e=t.data)===Ln&&Pn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Zn&&Bn(e,t)?(e=en(),$t=Jt=Qt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Hr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=y))}Lr(o,t)}))}function jr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Fe(e,n))&&r.unshift(jr(e,i,a)),null!=(i=Fe(e,t))&&r.push(jr(e,i,a))),e=e.return}return r}function qr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,a?null!=(u=Fe(n,i))&&o.unshift(jr(n,u,s)):a||null!=(u=Fe(n,i))&&o.push(jr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Xr=/\r\n?/g,Yr=/\u0000|\uFFFD/g;function Qr(e){return("string"===typeof e?e:""+e).replace(Xr,"\n").replace(Yr,"")}function Jr(e,t,n){if(t=Qr(t),Qr(e)!==t&&n)throw Error(i(425))}function $r(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,oa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(sa)}:ra;function sa(e){setTimeout((function(){throw e}))}function ua(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Vt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Vt(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function la(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var pa=Math.random().toString(36).slice(2),da="__reactFiber$"+pa,fa="__reactProps$"+pa,ha="__reactContainer$"+pa,ma="__reactEvents$"+pa,va="__reactListeners$"+pa,ga="__reactHandles$"+pa;function ya(e){var t=e[da];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ha]||n[da]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=la(e);null!==e;){if(n=e[da])return n;e=la(e)}return t}n=(e=n).parentNode}return null}function ba(e){return!(e=e[da]||e[ha])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function ka(e){return e[fa]||null}var wa=[],Sa=-1;function Ia(e){return{current:e}}function Na(e){0>Sa||(e.current=wa[Sa],wa[Sa]=null,Sa--)}function Ta(e,t){Sa++,wa[Sa]=e.current,e.current=t}var Ca={},Ea=Ia(Ca),_a=Ia(!1),Aa=Ca;function Ra(e,t){var n=e.type.contextTypes;if(!n)return Ca;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Fa(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Da(){Na(_a),Na(Ea)}function Za(e,t,n){if(Ea.current!==Ca)throw Error(i(168));Ta(Ea,t),Ta(_a,n)}function Oa(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,U(e)||"Unknown",a));return z({},n,r)}function Ma(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ca,Aa=Ea.current,Ta(Ea,e),Ta(_a,_a.current),!0}function za(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Oa(e,t,Aa),r.__reactInternalMemoizedMergedChildContext=e,Na(_a),Na(Ea),Ta(Ea,e)):Na(_a),Ta(_a,n)}var La=null,Pa=!1,Ba=!1;function Wa(e){null===La?La=[e]:La.push(e)}function Va(){if(!Ba&&null!==La){Ba=!0;var e=0,t=bt;try{var n=La;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}La=null,Pa=!1}catch(a){throw null!==La&&(La=La.slice(e+1)),qe($e,Va),a}finally{bt=t,Ba=!1}}return null}var Ua=[],Ga=0,ja=null,Ha=0,qa=[],Ka=0,Xa=null,Ya=1,Qa="";function Ja(e,t){Ua[Ga++]=Ha,Ua[Ga++]=ja,ja=e,Ha=t}function $a(e,t,n){qa[Ka++]=Ya,qa[Ka++]=Qa,qa[Ka++]=Xa,Xa=e;var r=Ya;e=Qa;var a=32-ot(r)-1;r&=~(1<<a),n+=1;var i=32-ot(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Ya=1<<32-ot(t)+a|n<<a|r,Qa=i+e}else Ya=1<<i|n<<a|r,Qa=e}function ei(e){null!==e.return&&(Ja(e,1),$a(e,1,0))}function ti(e){for(;e===ja;)ja=Ua[--Ga],Ua[Ga]=null,Ha=Ua[--Ga],Ua[Ga]=null;for(;e===Xa;)Xa=qa[--Ka],qa[Ka]=null,Qa=qa[--Ka],qa[Ka]=null,Ya=qa[--Ka],qa[Ka]=null}var ni=null,ri=null,ai=!1,ii=null;function oi(e,t){var n=Rc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function si(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xa?{id:Ya,overflow:Qa}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Rc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function ui(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(ai){var t=ri;if(t){var n=t;if(!si(e,t)){if(ui(e))throw Error(i(418));t=ca(n.nextSibling);var r=ni;t&&si(e,t)?oi(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(ui(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function li(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function pi(e){if(e!==ni)return!1;if(!ai)return li(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(ui(e))throw di(),Error(i(418));for(;t;)oi(e,t),t=ca(t.nextSibling)}if(li(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=ca(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?ca(e.stateNode.nextSibling):null;return!0}function di(){for(var e=ri;e;)e=ca(e.nextSibling)}function fi(){ri=ni=null,ai=!1}function hi(e){null===ii?ii=[e]:ii.push(e)}var mi=x.ReactCurrentBatchConfig;function vi(e,t){if(e&&e.defaultProps){for(var n in t=z({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var gi=Ia(null),yi=null,bi=null,xi=null;function ki(){xi=bi=yi=null}function wi(e){var t=gi.current;Na(gi),e._currentValue=t}function Si(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ii(e,t){yi=e,xi=bi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Ni(e){var t=e._currentValue;if(xi!==e)if(e={context:e,memoizedValue:t,next:null},null===bi){if(null===yi)throw Error(i(308));bi=e,yi.dependencies={lanes:0,firstContext:e}}else bi=bi.next=e;return t}var Ti=null;function Ci(e){null===Ti?Ti=[e]:Ti.push(e)}function Ei(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Ci(t)):(n.next=a.next,a.next=n),t.interleaved=n,_i(e,r)}function _i(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ai=!1;function Ri(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Di(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Zi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Eu)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,_i(e,n)}return null===(a=r.interleaved)?(t.next=t,Ci(r)):(t.next=a.next,a.next=t),r.interleaved=t,_i(e,n)}function Oi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Mi(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function zi(e,t,n,r){var a=e.updateQueue;Ai=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var u=s,c=u.next;u.next=null,null===o?i=c:o.next=c,o=u;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==o&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==i){var p=a.baseState;for(o=0,l=c=u=null,s=i;;){var d=s.lane,f=s.eventTime;if((r&d)===d){null!==l&&(l=l.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,m=s;switch(d=t,f=n,m.tag){case 1:if("function"===typeof(h=m.payload)){p=h.call(f,p,d);break e}p=h;break e;case 3:h.flags=-65537&h.flags|128;case 0:if(null===(d="function"===typeof(h=m.payload)?h.call(f,p,d):h)||void 0===d)break e;p=z({},p,d);break e;case 2:Ai=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=a.effects)?a.effects=[s]:d.push(s))}else f={eventTime:f,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=f,u=p):l=l.next=f,o|=d;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(d=s).next,d.next=null,a.lastBaseUpdate=d,a.shared.pending=null}}if(null===l&&(u=p),a.baseState=u,a.firstBaseUpdate=c,a.lastBaseUpdate=l,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);Mu|=o,e.lanes=o,e.memoizedState=p}}function Li(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Pi=(new r.Component).refs;function Bi(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:z({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Wi={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),a=tc(e),i=Di(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Zi(e,i,a))&&(nc(t,e,a,r),Oi(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),a=tc(e),i=Di(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Zi(e,i,a))&&(nc(t,e,a,r),Oi(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),a=Di(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Zi(e,a,r))&&(nc(t,e,r,n),Oi(t,e,r))}};function Vi(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(a,i))}function Ui(e,t,n){var r=!1,a=Ca,i=t.contextType;return"object"===typeof i&&null!==i?i=Ni(i):(a=Fa(t)?Aa:Ea.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ra(e,a):Ca),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Wi,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Gi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Wi.enqueueReplaceState(t,t.state,null)}function ji(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=Pi,Ri(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=Ni(i):(i=Fa(t)?Aa:Ea.current,a.context=Ra(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Bi(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Wi.enqueueReplaceState(a,a.state,null),zi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function Hi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;t===Pi&&(t=a.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function qi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ki(e){return(0,e._init)(e._payload)}function Xi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Dc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=zc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===S?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===F&&Ki(i)===t.type)?((r=a(t,n.props)).ref=Hi(e,t,n),r.return=e,r):((r=Zc(n.type,n.key,n.props,null,e.mode,r)).ref=Hi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Lc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function p(e,t,n,r,i){return null===t||7!==t.tag?((t=Oc(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=zc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case k:return(n=Zc(t.type,t.key,t.props,null,e.mode,n)).ref=Hi(e,null,t),n.return=e,n;case w:return(t=Lc(t,e.mode,n)).return=e,t;case F:return d(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Oc(t,e.mode,n,null)).return=e,t;qi(e,t)}return null}function f(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case k:return n.key===a?c(e,t,n,r):null;case w:return n.key===a?l(e,t,n,r):null;case F:return f(e,t,(a=n._init)(n._payload),r)}if(te(n)||O(n))return null!==a?null:p(e,t,n,r,null);qi(e,n)}return null}function h(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case k:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a);case F:return h(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||O(r))return p(t,e=e.get(n)||null,r,a,null);qi(t,r)}return null}function m(a,i,s,u){for(var c=null,l=null,p=i,m=i=0,v=null;null!==p&&m<s.length;m++){p.index>m?(v=p,p=null):v=p.sibling;var g=f(a,p,s[m],u);if(null===g){null===p&&(p=v);break}e&&p&&null===g.alternate&&t(a,p),i=o(g,i,m),null===l?c=g:l.sibling=g,l=g,p=v}if(m===s.length)return n(a,p),ai&&Ja(a,m),c;if(null===p){for(;m<s.length;m++)null!==(p=d(a,s[m],u))&&(i=o(p,i,m),null===l?c=p:l.sibling=p,l=p);return ai&&Ja(a,m),c}for(p=r(a,p);m<s.length;m++)null!==(v=h(p,a,m,s[m],u))&&(e&&null!==v.alternate&&p.delete(null===v.key?m:v.key),i=o(v,i,m),null===l?c=v:l.sibling=v,l=v);return e&&p.forEach((function(e){return t(a,e)})),ai&&Ja(a,m),c}function v(a,s,u,c){var l=O(u);if("function"!==typeof l)throw Error(i(150));if(null==(u=l.call(u)))throw Error(i(151));for(var p=l=null,m=s,v=s=0,g=null,y=u.next();null!==m&&!y.done;v++,y=u.next()){m.index>v?(g=m,m=null):g=m.sibling;var b=f(a,m,y.value,c);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(a,m),s=o(b,s,v),null===p?l=b:p.sibling=b,p=b,m=g}if(y.done)return n(a,m),ai&&Ja(a,v),l;if(null===m){for(;!y.done;v++,y=u.next())null!==(y=d(a,y.value,c))&&(s=o(y,s,v),null===p?l=y:p.sibling=y,p=y);return ai&&Ja(a,v),l}for(m=r(a,m);!y.done;v++,y=u.next())null!==(y=h(m,a,v,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),s=o(y,s,v),null===p?l=y:p.sibling=y,p=y);return e&&m.forEach((function(e){return t(a,e)})),ai&&Ja(a,v),l}return function e(r,i,o,u){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case k:e:{for(var c=o.key,l=i;null!==l;){if(l.key===c){if((c=o.type)===S){if(7===l.tag){n(r,l.sibling),(i=a(l,o.props.children)).return=r,r=i;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===F&&Ki(c)===l.type){n(r,l.sibling),(i=a(l,o.props)).ref=Hi(r,l,o),i.return=r,r=i;break e}n(r,l);break}t(r,l),l=l.sibling}o.type===S?((i=Oc(o.props.children,r.mode,u,o.key)).return=r,r=i):((u=Zc(o.type,o.key,o.props,null,r.mode,u)).ref=Hi(r,i,o),u.return=r,r=u)}return s(r);case w:e:{for(l=o.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Lc(o,r.mode,u)).return=r,r=i}return s(r);case F:return e(r,i,(l=o._init)(o._payload),u)}if(te(o))return m(r,i,o,u);if(O(o))return v(r,i,o,u);qi(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=zc(o,r.mode,u)).return=r,r=i),s(r)):n(r,i)}}var Yi=Xi(!0),Qi=Xi(!1),Ji={},$i=Ia(Ji),eo=Ia(Ji),to=Ia(Ji);function no(e){if(e===Ji)throw Error(i(174));return e}function ro(e,t){switch(Ta(to,t),Ta(eo,e),Ta($i,Ji),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Na($i),Ta($i,t)}function ao(){Na($i),Na(eo),Na(to)}function io(e){no(to.current);var t=no($i.current),n=ue(t,e.type);t!==n&&(Ta(eo,e),Ta($i,n))}function oo(e){eo.current===e&&(Na($i),Na(eo))}var so=Ia(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var co=[];function lo(){for(var e=0;e<co.length;e++)co[e]._workInProgressVersionPrimary=null;co.length=0}var po=x.ReactCurrentDispatcher,fo=x.ReactCurrentBatchConfig,ho=0,mo=null,vo=null,go=null,yo=!1,bo=!1,xo=0,ko=0;function wo(){throw Error(i(321))}function So(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function Io(e,t,n,r,a,o){if(ho=o,mo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,po.current=null===e||null===e.memoizedState?ss:us,e=n(r,a),bo){o=0;do{if(bo=!1,xo=0,25<=o)throw Error(i(301));o+=1,go=vo=null,t.updateQueue=null,po.current=cs,e=n(r,a)}while(bo)}if(po.current=os,t=null!==vo&&null!==vo.next,ho=0,go=vo=mo=null,yo=!1,t)throw Error(i(300));return e}function No(){var e=0!==xo;return xo=0,e}function To(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?mo.memoizedState=go=e:go=go.next=e,go}function Co(){if(null===vo){var e=mo.alternate;e=null!==e?e.memoizedState:null}else e=vo.next;var t=null===go?mo.memoizedState:go.next;if(null!==t)go=t,vo=e;else{if(null===e)throw Error(i(310));e={memoizedState:(vo=e).memoizedState,baseState:vo.baseState,baseQueue:vo.baseQueue,queue:vo.queue,next:null},null===go?mo.memoizedState=go=e:go=go.next=e}return go}function Eo(e,t){return"function"===typeof t?t(e):t}function _o(e){var t=Co(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=vo,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var u=s=null,c=null,l=o;do{var p=l.lane;if((ho&p)===p)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var d={lane:p,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=d,s=r):c=c.next=d,mo.lanes|=p,Mu|=p}l=l.next}while(null!==l&&l!==o);null===c?s=r:c.next=u,sr(r,t.memoizedState)||(xs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,mo.lanes|=o,Mu|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ao(e){var t=Co(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);sr(o,t.memoizedState)||(xs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ro(){}function Fo(e,t){var n=mo,r=Co(),a=t(),o=!sr(r.memoizedState,a);if(o&&(r.memoizedState=a,xs=!0),r=r.queue,Go(Oo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Po(9,Zo.bind(null,n,r,a,t),void 0,null),null===_u)throw Error(i(349));0!==(30&ho)||Do(n,t,a)}return a}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Zo(e,t,n,r){t.value=n,t.getSnapshot=r,Mo(t)&&zo(e)}function Oo(e,t,n){return n((function(){Mo(t)&&zo(e)}))}function Mo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function zo(e){var t=_i(e,1);null!==t&&nc(t,e,1,-1)}function Lo(e){var t=To();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eo,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,mo,e),[t.memoizedState,e]}function Po(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Bo(){return Co().memoizedState}function Wo(e,t,n,r){var a=To();mo.flags|=e,a.memoizedState=Po(1|t,n,void 0,void 0===r?null:r)}function Vo(e,t,n,r){var a=Co();r=void 0===r?null:r;var i=void 0;if(null!==vo){var o=vo.memoizedState;if(i=o.destroy,null!==r&&So(r,o.deps))return void(a.memoizedState=Po(t,n,i,r))}mo.flags|=e,a.memoizedState=Po(1|t,n,i,r)}function Uo(e,t){return Wo(8390656,8,e,t)}function Go(e,t){return Vo(2048,8,e,t)}function jo(e,t){return Vo(4,2,e,t)}function Ho(e,t){return Vo(4,4,e,t)}function qo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ko(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Vo(4,4,qo.bind(null,t,e),n)}function Xo(){}function Yo(e,t){var n=Co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Qo(e,t){var n=Co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Jo(e,t,n){return 0===(21&ho)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),mo.lanes|=n,Mu|=n,e.baseState=!0),t)}function $o(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=fo.transition;fo.transition={};try{e(!1),t()}finally{bt=n,fo.transition=r}}function es(){return Co().memoizedState}function ts(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))as(t,n);else if(null!==(n=Ei(e,t,n,r))){nc(n,e,r,ec()),is(n,t,r)}}function ns(e,t,n){var r=tc(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))as(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,sr(s,o)){var u=t.interleaved;return null===u?(a.next=a,Ci(t)):(a.next=u.next,u.next=a),void(t.interleaved=a)}}catch(c){}null!==(n=Ei(e,t,a,r))&&(nc(n,e,r,a=ec()),is(n,t,r))}}function rs(e){var t=e.alternate;return e===mo||null!==t&&t===mo}function as(e,t){bo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function is(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var os={readContext:Ni,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},ss={readContext:Ni,useCallback:function(e,t){return To().memoizedState=[e,void 0===t?null:t],e},useContext:Ni,useEffect:Uo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Wo(4194308,4,qo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Wo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Wo(4,2,e,t)},useMemo:function(e,t){var n=To();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=To();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,mo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},To().memoizedState=e},useState:Lo,useDebugValue:Xo,useDeferredValue:function(e){return To().memoizedState=e},useTransition:function(){var e=Lo(!1),t=e[0];return e=$o.bind(null,e[1]),To().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=mo,a=To();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===_u)throw Error(i(349));0!==(30&ho)||Do(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Uo(Oo.bind(null,r,o,e),[e]),r.flags|=2048,Po(9,Zo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=To(),t=_u.identifierPrefix;if(ai){var n=Qa;t=":"+t+"R"+(n=(Ya&~(1<<32-ot(Ya)-1)).toString(32)+n),0<(n=xo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ko++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:Ni,useCallback:Yo,useContext:Ni,useEffect:Go,useImperativeHandle:Ko,useInsertionEffect:jo,useLayoutEffect:Ho,useMemo:Qo,useReducer:_o,useRef:Bo,useState:function(){return _o(Eo)},useDebugValue:Xo,useDeferredValue:function(e){return Jo(Co(),vo.memoizedState,e)},useTransition:function(){return[_o(Eo)[0],Co().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Fo,useId:es,unstable_isNewReconciler:!1},cs={readContext:Ni,useCallback:Yo,useContext:Ni,useEffect:Go,useImperativeHandle:Ko,useInsertionEffect:jo,useLayoutEffect:Ho,useMemo:Qo,useReducer:Ao,useRef:Bo,useState:function(){return Ao(Eo)},useDebugValue:Xo,useDeferredValue:function(e){var t=Co();return null===vo?t.memoizedState=e:Jo(t,vo.memoizedState,e)},useTransition:function(){return[Ao(Eo)[0],Co().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Fo,useId:es,unstable_isNewReconciler:!1};function ls(e,t){try{var n="",r=t;do{n+=W(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function ps(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=Di(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Gu||(Gu=!0,ju=r),ds(0,t)},n}function ms(e,t,n){(n=Di(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){ds(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof r&&(null===Hu?Hu=new Set([this]):Hu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function vs(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fs;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Nc.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Di(-1,1)).tag=2,Zi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=x.ReactCurrentOwner,xs=!1;function ks(e,t,n,r){t.child=null===e?Qi(t,null,n,r):Yi(t,e.child,n,r)}function ws(e,t,n,r,a){n=n.render;var i=t.ref;return Ii(t,a),r=Io(e,t,n,r,i,a),n=No(),null===e||xs?(ai&&n&&ei(t),t.flags|=1,ks(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Gs(e,t,a))}function Ss(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Fc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Zc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Is(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return Gs(e,t,a)}return t.flags|=1,(e=Dc(i,r)).ref=t.ref,e.return=t,t.child=e}function Is(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(ur(i,r)&&e.ref===t.ref){if(xs=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,Gs(e,t,a);0!==(131072&e.flags)&&(xs=!0)}}return Cs(e,t,n,r,a)}function Ns(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ta(Du,Fu),Fu|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ta(Du,Fu),Fu|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ta(Du,Fu),Fu|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ta(Du,Fu),Fu|=r;return ks(e,t,a,n),t.child}function Ts(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Cs(e,t,n,r,a){var i=Fa(n)?Aa:Ea.current;return i=Ra(t,i),Ii(t,a),n=Io(e,t,n,r,i,a),r=No(),null===e||xs?(ai&&r&&ei(t),t.flags|=1,ks(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Gs(e,t,a))}function Es(e,t,n,r,a){if(Fa(n)){var i=!0;Ma(t)}else i=!1;if(Ii(t,a),null===t.stateNode)Us(e,t),Ui(t,n,r),ji(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ni(c):c=Ra(t,c=Fa(n)?Aa:Ea.current);var l=n.getDerivedStateFromProps,p="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;p||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&Gi(t,o,r,c),Ai=!1;var d=t.memoizedState;o.state=d,zi(t,r,o,a),u=t.memoizedState,s!==r||d!==u||_a.current||Ai?("function"===typeof l&&(Bi(t,n,l,r),u=t.memoizedState),(s=Ai||Vi(t,n,s,r,d,u,c))?(p||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Fi(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:vi(t.type,s),o.props=c,p=t.pendingProps,d=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=Ni(u):u=Ra(t,u=Fa(n)?Aa:Ea.current);var f=n.getDerivedStateFromProps;(l="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==p||d!==u)&&Gi(t,o,r,u),Ai=!1,d=t.memoizedState,o.state=d,zi(t,r,o,a);var h=t.memoizedState;s!==p||d!==h||_a.current||Ai?("function"===typeof f&&(Bi(t,n,f,r),h=t.memoizedState),(c=Ai||Vi(t,n,c,r,d,h,u)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,h,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,h,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=h),o.props=r,o.state=h,o.context=u,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return _s(e,t,n,r,i,a)}function _s(e,t,n,r,a,i){Ts(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&za(t,n,!1),Gs(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Yi(t,e.child,null,i),t.child=Yi(t,null,s,i)):ks(e,t,s,i),t.memoizedState=r.state,a&&za(t,n,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?Za(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Za(0,t.context,!1),ro(e,t.containerInfo)}function Rs(e,t,n,r,a){return fi(),hi(a),t.flags|=256,ks(e,t,n,r),t.child}var Fs,Ds,Zs,Os={dehydrated:null,treeContext:null,retryLane:0};function Ms(e){return{baseLanes:e,cachePool:null,transitions:null}}function zs(e,t,n){var r,a=t.pendingProps,o=so.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ta(so,1&o),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=a.children,e=a.fallback,s?(a=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Mc(u,a,0,null),e=Oc(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ms(n),t.memoizedState=Os,e):Ls(t,u));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,Ps(e,t,s,r=ps(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Mc({mode:"visible",children:r.children},a,0,null),(o=Oc(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Yi(t,e.child,null,s),t.child.memoizedState=Ms(s),t.memoizedState=Os,o);if(0===(1&t.mode))return Ps(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var u=r.dgst;return r=u,Ps(e,t,s,r=ps(o=Error(i(419)),r,void 0))}if(u=0!==(s&e.childLanes),xs||u){if(null!==(r=_u)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,_i(e,a),nc(r,e,a,-1))}return mc(),Ps(e,t,s,r=ps(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Cc.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ri=ca(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(qa[Ka++]=Ya,qa[Ka++]=Qa,qa[Ka++]=Xa,Ya=e.id,Qa=e.overflow,Xa=t),(t=Ls(t,r.children)).flags|=4096,t)}(e,t,u,a,r,o,n);if(s){s=a.fallback,u=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&u)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Dc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Dc(r,s):(s=Oc(s,u,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,u=null===(u=e.child.memoizedState)?Ms(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Os,a}return e=(s=e.child).sibling,a=Dc(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Ls(e,t){return(t=Mc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ps(e,t,n,r){return null!==r&&hi(r),Yi(t,e.child,null,n),(e=Ls(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Si(e.return,t,n)}function Ws(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Vs(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(ks(e,t,r.children,n),0!==(2&(r=so.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bs(e,n,t);else if(19===e.tag)Bs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ta(so,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Ws(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===uo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Ws(t,!0,n,null,i);break;case"together":Ws(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Us(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Gs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Mu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Dc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function js(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Hs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function qs(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(t),null;case 1:case 17:return Fa(t.type)&&Da(),Hs(t),null;case 3:return r=t.stateNode,ao(),Na(_a),Na(Ea),lo(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(pi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(oc(ii),ii=null))),Hs(t),null;case 5:oo(t);var a=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ds(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Hs(t),null}if(e=no($i.current),pi(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[da]=t,r[fa]=o,e=0!==(1&t.mode),n){case"dialog":Pr("cancel",r),Pr("close",r);break;case"iframe":case"object":case"embed":Pr("load",r);break;case"video":case"audio":for(a=0;a<Or.length;a++)Pr(Or[a],r);break;case"source":Pr("error",r);break;case"img":case"image":case"link":Pr("error",r),Pr("load",r);break;case"details":Pr("toggle",r);break;case"input":Y(r,o),Pr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Pr("invalid",r);break;case"textarea":ae(r,o),Pr("invalid",r)}for(var u in ye(n,o),a=null,o)if(o.hasOwnProperty(u)){var c=o[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Pr("scroll",r)}switch(n){case"input":H(r),$(r,o,!0);break;case"textarea":H(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[da]=t,e[fa]=r,Fs(e,t),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Pr("cancel",e),Pr("close",e),a=r;break;case"iframe":case"object":case"embed":Pr("load",e),a=r;break;case"video":case"audio":for(a=0;a<Or.length;a++)Pr(Or[a],e);a=r;break;case"source":Pr("error",e),a=r;break;case"img":case"image":case"link":Pr("error",e),Pr("load",e),a=r;break;case"details":Pr("toggle",e),a=r;break;case"input":Y(e,r),a=X(e,r),Pr("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=z({},r,{value:void 0}),Pr("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),Pr("invalid",e)}for(o in ye(n,a),c=a)if(c.hasOwnProperty(o)){var l=c[o];"style"===o?ve(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&pe(e,l):"children"===o?"string"===typeof l?("textarea"!==n||""!==l)&&de(e,l):"number"===typeof l&&de(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=l&&"onScroll"===o&&Pr("scroll",e):null!=l&&b(e,o,l,u))}switch(n){case"input":H(e),$(e,r,!1);break;case"textarea":H(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+G(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hs(t),null;case 6:if(e&&null!=t.stateNode)Zs(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=no(to.current),no($i.current),pi(t)){if(r=t.stateNode,n=t.memoizedProps,r[da]=t,(o=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[da]=t,t.stateNode=r}return Hs(t),null;case 13:if(Na(so),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))di(),fi(),t.flags|=98560,o=!1;else if(o=pi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[da]=t}else fi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hs(t),o=!1}else null!==ii&&(oc(ii),ii=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Zu&&(Zu=3):mc())),null!==t.updateQueue&&(t.flags|=4),Hs(t),null);case 4:return ao(),null===e&&Vr(t.stateNode.containerInfo),Hs(t),null;case 10:return wi(t.type._context),Hs(t),null;case 19:if(Na(so),null===(o=t.memoizedState))return Hs(t),null;if(r=0!==(128&t.flags),null===(u=o.rendering))if(r)js(o,!1);else{if(0!==Zu||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=uo(e))){for(t.flags|=128,js(o,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ta(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Qe()>Vu&&(t.flags|=128,r=!0,js(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=uo(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),js(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ai)return Hs(t),null}else 2*Qe()-o.renderingStartTime>Vu&&1073741824!==n&&(t.flags|=128,r=!0,js(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Qe(),t.sibling=null,n=so.current,Ta(so,r?1&n|2:1&n),t):(Hs(t),null);case 22:case 23:return pc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Fu)&&(Hs(t),6&t.subtreeFlags&&(t.flags|=8192)):Hs(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Ks(e,t){switch(ti(t),t.tag){case 1:return Fa(t.type)&&Da(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ao(),Na(_a),Na(Ea),lo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Na(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));fi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Na(so),null;case 4:return ao(),null;case 10:return wi(t.type._context),null;case 22:case 23:return pc(),null;default:return null}}Fs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,no($i.current);var i,o=null;switch(n){case"input":a=X(e,a),r=X(e,r),o=[];break;case"select":a=z({},a,{value:void 0}),r=z({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in ye(n,r),n=null,a)if(!r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&null!=a[l])if("style"===l){var u=a[l];for(i in u)u.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=a?a[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(i in u)!u.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&u[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(o||(o=[]),o.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(o=o||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Pr("scroll",e),o||u===c||(o=[])):(o=o||[]).push(l,c))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}},Zs=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xs=!1,Ys=!1,Qs="function"===typeof WeakSet?WeakSet:Set,Js=null;function $s(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Ic(e,t,r)}else n.current=null}function eu(e,t,n){try{n()}catch(r){Ic(e,t,r)}}var tu=!1;function nu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&eu(t,n,i)}a=a.next}while(a!==r)}}function ru(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function au(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function iu(e){var t=e.alternate;null!==t&&(e.alternate=null,iu(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[da],delete t[fa],delete t[ma],delete t[va],delete t[ga])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ou(e){return 5===e.tag||3===e.tag||4===e.tag}function su(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ou(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}var lu=null,pu=!1;function du(e,t,n){for(n=n.child;null!==n;)fu(e,t,n),n=n.sibling}function fu(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(s){}switch(n.tag){case 5:Ys||$s(n,t);case 6:var r=lu,a=pu;lu=null,du(e,t,n),pu=a,null!==(lu=r)&&(pu?(e=lu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lu.removeChild(n.stateNode));break;case 18:null!==lu&&(pu?(e=lu,n=n.stateNode,8===e.nodeType?ua(e.parentNode,n):1===e.nodeType&&ua(e,n),Vt(e)):ua(lu,n.stateNode));break;case 4:r=lu,a=pu,lu=n.stateNode.containerInfo,pu=!0,du(e,t,n),lu=r,pu=a;break;case 0:case 11:case 14:case 15:if(!Ys&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&eu(n,t,o),a=a.next}while(a!==r)}du(e,t,n);break;case 1:if(!Ys&&($s(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Ic(n,t,s)}du(e,t,n);break;case 21:du(e,t,n);break;case 22:1&n.mode?(Ys=(r=Ys)||null!==n.memoizedState,du(e,t,n),Ys=r):du(e,t,n);break;default:du(e,t,n)}}function hu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qs),t.forEach((function(t){var r=Ec.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function mu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:lu=u.stateNode,pu=!1;break e;case 3:case 4:lu=u.stateNode.containerInfo,pu=!0;break e}u=u.return}if(null===lu)throw Error(i(160));fu(o,s,a),lu=null,pu=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(l){Ic(a,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vu(t,e),t=t.sibling}function vu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mu(t,e),gu(e),4&r){try{nu(3,e,e.return),ru(3,e)}catch(v){Ic(e,e.return,v)}try{nu(5,e,e.return)}catch(v){Ic(e,e.return,v)}}break;case 1:mu(t,e),gu(e),512&r&&null!==n&&$s(n,n.return);break;case 5:if(mu(t,e),gu(e),512&r&&null!==n&&$s(n,n.return),32&e.flags){var a=e.stateNode;try{de(a,"")}catch(v){Ic(e,e.return,v)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===o.type&&null!=o.name&&Q(a,o),be(u,s);var l=be(u,o);for(s=0;s<c.length;s+=2){var p=c[s],d=c[s+1];"style"===p?ve(a,d):"dangerouslySetInnerHTML"===p?pe(a,d):"children"===p?de(a,d):b(a,p,d,l)}switch(u){case"input":J(a,o);break;case"textarea":ie(a,o);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var h=o.value;null!=h?ne(a,!!o.multiple,h,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[fa]=o}catch(v){Ic(e,e.return,v)}}break;case 6:if(mu(t,e),gu(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(v){Ic(e,e.return,v)}}break;case 3:if(mu(t,e),gu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(v){Ic(e,e.return,v)}break;case 4:default:mu(t,e),gu(e);break;case 13:mu(t,e),gu(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Wu=Qe())),4&r&&hu(e);break;case 22:if(p=null!==n&&null!==n.memoizedState,1&e.mode?(Ys=(l=Ys)||p,mu(t,e),Ys=l):mu(t,e),gu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!p&&0!==(1&e.mode))for(Js=e,p=e.child;null!==p;){for(d=Js=p;null!==Js;){switch(h=(f=Js).child,f.tag){case 0:case 11:case 14:case 15:nu(4,f,f.return);break;case 1:$s(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(v){Ic(r,n,v)}}break;case 5:$s(f,f.return);break;case 22:if(null!==f.memoizedState){ku(d);continue}}null!==h?(h.return=f,Js=h):ku(d)}p=p.sibling}e:for(p=null,d=e;;){if(5===d.tag){if(null===p){p=d;try{a=d.stateNode,l?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=me("display",s))}catch(v){Ic(e,e.return,v)}}}else if(6===d.tag){if(null===p)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(v){Ic(e,e.return,v)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;p===d&&(p=null),d=d.return}p===d&&(p=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:mu(t,e),gu(e),4&r&&hu(e);case 21:}}function gu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ou(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(de(a,""),r.flags&=-33),cu(e,su(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;uu(e,su(e),o);break;default:throw Error(i(161))}}catch(s){Ic(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yu(e,t,n){Js=e,bu(e,t,n)}function bu(e,t,n){for(var r=0!==(1&e.mode);null!==Js;){var a=Js,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Xs;if(!o){var s=a.alternate,u=null!==s&&null!==s.memoizedState||Ys;s=Xs;var c=Ys;if(Xs=o,(Ys=u)&&!c)for(Js=a;null!==Js;)u=(o=Js).child,22===o.tag&&null!==o.memoizedState?wu(a):null!==u?(u.return=o,Js=u):wu(a);for(;null!==i;)Js=i,bu(i,t,n),i=i.sibling;Js=a,Xs=s,Ys=c}xu(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,Js=i):xu(e)}}function xu(e){for(;null!==Js;){var t=Js;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ys||ru(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ys)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:vi(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Li(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Li(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var p=l.memoizedState;if(null!==p){var d=p.dehydrated;null!==d&&Vt(d)}}}break;default:throw Error(i(163))}Ys||512&t.flags&&au(t)}catch(f){Ic(t,t.return,f)}}if(t===e){Js=null;break}if(null!==(n=t.sibling)){n.return=t.return,Js=n;break}Js=t.return}}function ku(e){for(;null!==Js;){var t=Js;if(t===e){Js=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Js=n;break}Js=t.return}}function wu(e){for(;null!==Js;){var t=Js;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ru(4,t)}catch(u){Ic(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(u){Ic(t,a,u)}}var i=t.return;try{au(t)}catch(u){Ic(t,i,u)}break;case 5:var o=t.return;try{au(t)}catch(u){Ic(t,o,u)}}}catch(u){Ic(t,t.return,u)}if(t===e){Js=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Js=s;break}Js=t.return}}var Su,Iu=Math.ceil,Nu=x.ReactCurrentDispatcher,Tu=x.ReactCurrentOwner,Cu=x.ReactCurrentBatchConfig,Eu=0,_u=null,Au=null,Ru=0,Fu=0,Du=Ia(0),Zu=0,Ou=null,Mu=0,zu=0,Lu=0,Pu=null,Bu=null,Wu=0,Vu=1/0,Uu=null,Gu=!1,ju=null,Hu=null,qu=!1,Ku=null,Xu=0,Yu=0,Qu=null,Ju=-1,$u=0;function ec(){return 0!==(6&Eu)?Qe():-1!==Ju?Ju:Ju=Qe()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Eu)&&0!==Ru?Ru&-Ru:null!==mi.transition?(0===$u&&($u=mt()),$u):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function nc(e,t,n,r){if(50<Yu)throw Yu=0,Qu=null,Error(i(185));gt(e,n,r),0!==(2&Eu)&&e===_u||(e===_u&&(0===(2&Eu)&&(zu|=n),4===Zu&&sc(e,Ru)),rc(e,r),1===n&&0===Eu&&0===(1&t.mode)&&(Vu=Qe()+500,Pa&&Va()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ot(i),s=1<<o,u=a[o];-1===u?0!==(s&n)&&0===(s&r)||(a[o]=ft(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=dt(e,e===_u?Ru:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Pa=!0,Wa(e)}(uc.bind(null,e)):Wa(uc.bind(null,e)),oa((function(){0===(6&Eu)&&Va()})),n=null;else{switch(xt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=_c(n,ac.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ac(e,t){if(Ju=-1,$u=0,0!==(6&Eu))throw Error(i(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var r=dt(e,e===_u?Ru:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=vc(e,r);else{t=r;var a=Eu;Eu|=2;var o=hc();for(_u===e&&Ru===t||(Uu=null,Vu=Qe()+500,dc(e,t));;)try{yc();break}catch(u){fc(e,u)}ki(),Nu.current=o,Eu=a,null!==Au?t=0:(_u=null,Ru=0,t=Zu)}if(0!==t){if(2===t&&(0!==(a=ht(e))&&(r=a,t=ic(e,a))),1===t)throw n=Ou,dc(e,0),sc(e,r),rc(e,Qe()),n;if(6===t)sc(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!sr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=vc(e,r))&&(0!==(o=ht(e))&&(r=o,t=ic(e,o))),1===t))throw n=Ou,dc(e,0),sc(e,r),rc(e,Qe()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:kc(e,Bu,Uu);break;case 3:if(sc(e,r),(130023424&r)===r&&10<(t=Wu+500-Qe())){if(0!==dt(e,0))break;if(((a=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(kc.bind(null,e,Bu,Uu),t);break}kc(e,Bu,Uu);break;case 4:if(sc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Iu(r/1960))-r)){e.timeoutHandle=ra(kc.bind(null,e,Bu,Uu),r);break}kc(e,Bu,Uu);break;default:throw Error(i(329))}}}return rc(e,Qe()),e.callbackNode===n?ac.bind(null,e):null}function ic(e,t){var n=Pu;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=vc(e,t))&&(t=Bu,Bu=n,null!==t&&oc(t)),e}function oc(e){null===Bu?Bu=e:Bu.push.apply(Bu,e)}function sc(e,t){for(t&=~Lu,t&=~zu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function uc(e){if(0!==(6&Eu))throw Error(i(327));wc();var t=dt(e,0);if(0===(1&t))return rc(e,Qe()),null;var n=vc(e,t);if(0!==e.tag&&2===n){var r=ht(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Ou,dc(e,0),sc(e,t),rc(e,Qe()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,kc(e,Bu,Uu),rc(e,Qe()),null}function cc(e,t){var n=Eu;Eu|=1;try{return e(t)}finally{0===(Eu=n)&&(Vu=Qe()+500,Pa&&Va())}}function lc(e){null!==Ku&&0===Ku.tag&&0===(6&Eu)&&wc();var t=Eu;Eu|=1;var n=Cu.transition,r=bt;try{if(Cu.transition=null,bt=1,e)return e()}finally{bt=r,Cu.transition=n,0===(6&(Eu=t))&&Va()}}function pc(){Fu=Du.current,Na(Du)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Au)for(n=Au.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Da();break;case 3:ao(),Na(_a),Na(Ea),lo();break;case 5:oo(r);break;case 4:ao();break;case 13:case 19:Na(so);break;case 10:wi(r.type._context);break;case 22:case 23:pc()}n=n.return}if(_u=e,Au=e=Dc(e.current,null),Ru=Fu=t,Zu=0,Ou=null,Lu=zu=Mu=0,Bu=Pu=null,null!==Ti){for(t=0;t<Ti.length;t++)if(null!==(r=(n=Ti[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Ti=null}return e}function fc(e,t){for(;;){var n=Au;try{if(ki(),po.current=os,yo){for(var r=mo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}yo=!1}if(ho=0,go=vo=mo=null,bo=!1,xo=0,Tu.current=null,null===n||null===n.return){Zu=1,Ou=t,Au=null;break}e:{var o=e,s=n.return,u=n,c=t;if(t=Ru,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,p=u,d=p.tag;if(0===(1&p.mode)&&(0===d||11===d||15===d)){var f=p.alternate;f?(p.updateQueue=f.updateQueue,p.memoizedState=f.memoizedState,p.lanes=f.lanes):(p.updateQueue=null,p.memoizedState=null)}var h=gs(s);if(null!==h){h.flags&=-257,ys(h,s,u,0,t),1&h.mode&&vs(o,l,t),c=l;var m=(t=h).updateQueue;if(null===m){var v=new Set;v.add(c),t.updateQueue=v}else m.add(c);break e}if(0===(1&t)){vs(o,l,t),mc();break e}c=Error(i(426))}else if(ai&&1&u.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,u,0,t),hi(ls(c,u));break e}}o=c=ls(c,u),4!==Zu&&(Zu=2),null===Pu?Pu=[o]:Pu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Mi(o,hs(0,c,t));break e;case 1:u=c;var y=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Hu||!Hu.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Mi(o,ms(o,u,t));break e}}o=o.return}while(null!==o)}xc(n)}catch(x){t=x,Au===n&&null!==n&&(Au=n=n.return);continue}break}}function hc(){var e=Nu.current;return Nu.current=os,null===e?os:e}function mc(){0!==Zu&&3!==Zu&&2!==Zu||(Zu=4),null===_u||0===(268435455&Mu)&&0===(268435455&zu)||sc(_u,Ru)}function vc(e,t){var n=Eu;Eu|=2;var r=hc();for(_u===e&&Ru===t||(Uu=null,dc(e,t));;)try{gc();break}catch(a){fc(e,a)}if(ki(),Eu=n,Nu.current=r,null!==Au)throw Error(i(261));return _u=null,Ru=0,Zu}function gc(){for(;null!==Au;)bc(Au)}function yc(){for(;null!==Au&&!Xe();)bc(Au)}function bc(e){var t=Su(e.alternate,e,Fu);e.memoizedProps=e.pendingProps,null===t?xc(e):Au=t,Tu.current=null}function xc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qs(n,t,Fu)))return void(Au=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Au=n);if(null===e)return Zu=6,void(Au=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Au=t);Au=t=e}while(null!==t);0===Zu&&(Zu=5)}function kc(e,t,n){var r=bt,a=Cu.transition;try{Cu.transition=null,bt=1,function(e,t,n,r){do{wc()}while(null!==Ku);if(0!==(6&Eu))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ot(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===_u&&(Au=_u=null,Ru=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||qu||(qu=!0,_c(tt,(function(){return wc(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Cu.transition,Cu.transition=null;var s=bt;bt=1;var u=Eu;Eu|=4,Tu.current=null,function(e,t){if(ea=Gt,fr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(k){n=null;break e}var s=0,u=-1,c=-1,l=0,p=0,d=e,f=null;t:for(;;){for(var h;d!==n||0!==a&&3!==d.nodeType||(u=s+a),d!==o||0!==r&&3!==d.nodeType||(c=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(h=d.firstChild);)f=d,d=h;for(;;){if(d===e)break t;if(f===n&&++l===a&&(u=s),f===o&&++p===r&&(c=s),null!==(h=d.nextSibling))break;f=(d=f).parentNode}d=h}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Gt=!1,Js=t;null!==Js;)if(e=(t=Js).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Js=e;else for(;null!==Js;){t=Js;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var v=m.memoizedProps,g=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?v:vi(t.type,v),g);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(i(163))}}catch(k){Ic(t,t.return,k)}if(null!==(e=t.sibling)){e.return=t.return,Js=e;break}Js=t.return}m=tu,tu=!1}(e,n),vu(n,e),hr(ta),Gt=!!ea,ta=ea=null,e.current=n,yu(n,e,a),Ye(),Eu=u,bt=s,Cu.transition=o}else e.current=n;if(qu&&(qu=!1,Ku=e,Xu=a),0===(o=e.pendingLanes)&&(Hu=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((a=t[n]).value,{componentStack:a.stack,digest:a.digest});if(Gu)throw Gu=!1,e=ju,ju=null,e;0!==(1&Xu)&&0!==e.tag&&wc(),0!==(1&(o=e.pendingLanes))?e===Qu?Yu++:(Yu=0,Qu=e):Yu=0,Va()}(e,t,n,r)}finally{Cu.transition=a,bt=r}return null}function wc(){if(null!==Ku){var e=xt(Xu),t=Cu.transition,n=bt;try{if(Cu.transition=null,bt=16>e?16:e,null===Ku)var r=!1;else{if(e=Ku,Ku=null,Xu=0,0!==(6&Eu))throw Error(i(331));var a=Eu;for(Eu|=4,Js=e.current;null!==Js;){var o=Js,s=o.child;if(0!==(16&Js.flags)){var u=o.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for(Js=l;null!==Js;){var p=Js;switch(p.tag){case 0:case 11:case 15:nu(8,p,o)}var d=p.child;if(null!==d)d.return=p,Js=d;else for(;null!==Js;){var f=(p=Js).sibling,h=p.return;if(iu(p),p===l){Js=null;break}if(null!==f){f.return=h,Js=f;break}Js=h}}}var m=o.alternate;if(null!==m){var v=m.child;if(null!==v){m.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(null!==v)}}Js=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Js=s;else e:for(;null!==Js;){if(0!==(2048&(o=Js).flags))switch(o.tag){case 0:case 11:case 15:nu(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Js=y;break e}Js=o.return}}var b=e.current;for(Js=b;null!==Js;){var x=(s=Js).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,Js=x;else e:for(s=b;null!==Js;){if(0!==(2048&(u=Js).flags))try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(w){Ic(u,u.return,w)}if(u===s){Js=null;break e}var k=u.sibling;if(null!==k){k.return=u.return,Js=k;break e}Js=u.return}}if(Eu=a,Va(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(w){}r=!0}return r}finally{bt=n,Cu.transition=t}}return!1}function Sc(e,t,n){e=Zi(e,t=hs(0,t=ls(n,t),1),1),t=ec(),null!==e&&(gt(e,1,t),rc(e,t))}function Ic(e,t,n){if(3===e.tag)Sc(e,e,n);else for(;null!==t;){if(3===t.tag){Sc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hu||!Hu.has(r))){t=Zi(t,e=ms(t,e=ls(n,e),1),1),e=ec(),null!==t&&(gt(t,1,e),rc(t,e));break}}t=t.return}}function Nc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,_u===e&&(Ru&n)===n&&(4===Zu||3===Zu&&(130023424&Ru)===Ru&&500>Qe()-Wu?dc(e,0):Lu|=n),rc(e,t)}function Tc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=ec();null!==(e=_i(e,t))&&(gt(e,t,n),rc(e,n))}function Cc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tc(e,n)}function Ec(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Tc(e,n)}function _c(e,t){return qe(e,t)}function Ac(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,n,r){return new Ac(e,t,n,r)}function Fc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dc(e,t){var n=e.alternate;return null===n?((n=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Zc(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)Fc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Oc(n.children,a,o,t);case I:s=8,a|=8;break;case N:return(e=Rc(12,n,t,2|a)).elementType=N,e.lanes=o,e;case _:return(e=Rc(13,n,t,a)).elementType=_,e.lanes=o,e;case A:return(e=Rc(19,n,t,a)).elementType=A,e.lanes=o,e;case D:return Mc(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:s=10;break e;case C:s=9;break e;case E:s=11;break e;case R:s=14;break e;case F:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Rc(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Oc(e,t,n,r){return(e=Rc(7,e,r,t)).lanes=n,e}function Mc(e,t,n,r){return(e=Rc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function zc(e,t,n){return(e=Rc(6,e,null,t)).lanes=n,e}function Lc(e,t,n){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Pc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Bc(e,t,n,r,a,i,o,s,u){return e=new Pc(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Rc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ri(i),e}function Wc(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Vc(e){if(!e)return Ca;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Fa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Fa(n))return Oa(e,n,t)}return t}function Uc(e,t,n,r,a,i,o,s,u){return(e=Bc(n,r,!0,e,0,i,0,s,u)).context=Vc(null),n=e.current,(i=Di(r=ec(),a=tc(n))).callback=void 0!==t&&null!==t?t:null,Zi(n,i,a),e.current.lanes=a,gt(e,a,r),rc(e,r),e}function Gc(e,t,n,r){var a=t.current,i=ec(),o=tc(a);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Di(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Zi(a,t,o))&&(nc(e,a,o,i),Oi(e,a,o)),o}function jc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function qc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}Su=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||_a.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:As(t),fi();break;case 5:io(t);break;case 1:Fa(t.type)&&Ma(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ta(gi,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ta(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?zs(e,t,n):(Ta(so,1&so.current),null!==(e=Gs(e,t,n))?e.sibling:null);Ta(so,1&so.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Vs(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ta(so,so.current),r)break;return null;case 22:case 23:return t.lanes=0,Ns(e,t,n)}return Gs(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,ai&&0!==(1048576&t.flags)&&$a(t,Ha,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Us(e,t),e=t.pendingProps;var a=Ra(t,Ea.current);Ii(t,n),a=Io(null,t,r,e,a,n);var o=No();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Fa(r)?(o=!0,Ma(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ri(t),a.updater=Wi,t.stateNode=a,a._reactInternals=t,ji(t,r,e,n),t=_s(null,t,r,!0,o,n)):(t.tag=0,ai&&o&&ei(t),ks(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Us(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Fc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===R)return 14}return 2}(r),e=vi(r,e),a){case 0:t=Cs(null,t,r,e,n);break e;case 1:t=Es(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=Ss(null,t,r,vi(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Cs(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 1:return r=t.type,a=t.pendingProps,Es(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 3:e:{if(As(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,Fi(e,t),zi(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Rs(e,t,r,n,a=ls(Error(i(423)),t));break e}if(r!==a){t=Rs(e,t,r,n,a=ls(Error(i(424)),t));break e}for(ri=ca(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=Qi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fi(),r===a){t=Gs(e,t,n);break e}ks(e,t,r,n)}t=t.child}return t;case 5:return io(t),null===e&&ci(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,na(r,a)?s=null:null!==o&&na(r,o)&&(t.flags|=32),Ts(e,t),ks(e,t,s,n),t.child;case 6:return null===e&&ci(t),null;case 13:return zs(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Yi(t,null,r,n):ks(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,ws(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 7:return ks(e,t,t.pendingProps,n),t.child;case 8:case 12:return ks(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Ta(gi,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===a.children&&!_a.current){t=Gs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Di(-1,n&-n)).tag=2;var l=o.updateQueue;if(null!==l){var p=(l=l.shared).pending;null===p?c.next=c:(c.next=p.next,p.next=c),l.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Si(o.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Si(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ks(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ii(t,n),r=r(a=Ni(a)),t.flags|=1,ks(e,t,r,n),t.child;case 14:return a=vi(r=t.type,t.pendingProps),Ss(e,t,r,a=vi(r.type,a),n);case 15:return Is(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:vi(r,a),Us(e,t),t.tag=1,Fa(r)?(e=!0,Ma(t)):e=!1,Ii(t,n),Ui(t,r,a),ji(t,r,a,n),_s(null,t,r,!0,e,n);case 19:return Vs(e,t,n);case 22:return Ns(e,t,n)}throw Error(i(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function Xc(e){this._internalRoot=e}function Yc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function el(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=jc(o);s.call(e)}}Gc(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=jc(o);i.call(e)}}var o=Uc(t,r,e,0,null,!1,0,"",$c);return e._reactRootContainer=o,e[ha]=o.current,Vr(8===e.nodeType?e.parentNode:e),lc(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=jc(u);s.call(e)}}var u=Bc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=u,e[ha]=u.current,Vr(8===e.nodeType?e.parentNode:e),lc((function(){Gc(t,u,n,r)})),u}(n,t,e,a,r);return jc(o)}Yc.prototype.render=Xc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Gc(e,t,null,null)},Yc.prototype.unmount=Xc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lc((function(){Gc(null,e,null,null)})),t[ha]=null}},Yc.prototype.unstable_scheduleHydration=function(e){if(e){var t=It();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&zt(e)}},kt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=pt(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Qe()),0===(6&Eu)&&(Vu=Qe()+500,Va()))}break;case 13:lc((function(){var t=_i(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),qc(e,1)}},wt=function(e){if(13===e.tag){var t=_i(e,134217728);if(null!==t)nc(t,e,134217728,ec());qc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),n=_i(e,t);if(null!==n)nc(n,e,t,ec());qc(e,t)}},It=function(){return bt},Nt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=ka(r);if(!a)throw Error(i(90));q(r),J(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=cc,_e=lc;var tl={usingClientEntryPoint:!1,Events:[ba,xa,ka,Te,Ce,cc]},nl={findFiberByHostInstance:ya,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=je(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var al=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!al.isDisabled&&al.supportsFiber)try{at=al.inject(rl),it=al}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(i(200));return Wc(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(i(299));var n=!1,r="",a=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Bc(e,1,!1,null,0,n,0,r,a),e[ha]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Xc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=je(t))?null:e.stateNode},t.flushSync=function(e){return lc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(i(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=Kc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Uc(t,null,e,1,null!=n?n:null,a,0,o,s),e[ha]=t.current,Vr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Yc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(i(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(i(40));return!!e._reactRootContainer&&(lc((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[ha]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},1250:function(e,t,n){"use strict";var r=n(4164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4463)},6374:function(e,t,n){"use strict";var r=n(2791),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:l,props:i,_owner:s.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},9117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function g(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||h}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||h}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=b.prototype=new y;x.constructor=b,m(x,g.prototype),x.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,a)&&!I.hasOwnProperty(a)&&(i[a]=t[a]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(a in u=e.defaultProps)void 0===i[a]&&(i[a]=u[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:S.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function _(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return o=o(u=e),e=""===i?"."+E(u,0):i,k(o)?(a="",null!=e&&(a=e.replace(C,"$&/")+"/"),_(o,t,a,"",(function(e){return e}))):null!=o&&(T(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(u=0,i=""===i?".":i+":",k(e))for(var c=0;c<e.length;c++){var l=i+E(s=e[c],c);u+=_(s,t,a,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=_(s=s.value,t,a,l=i+E(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function A(e,t,n){if(null==e)return e;var r=[],a=0;return _(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var F={current:null},D={transition:null},Z={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:D,ReactCurrentOwner:S};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=a,t.Profiler=o,t.PureComponent=b,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=m({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)w.call(t,c)&&!I.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];a.children=u}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=N,t.createFactory=function(e){var t=N.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:p,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return F.current.useCallback(e,t)},t.useContext=function(e){return F.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return F.current.useDeferredValue(e)},t.useEffect=function(e,t){return F.current.useEffect(e,t)},t.useId=function(){return F.current.useId()},t.useImperativeHandle=function(e,t,n){return F.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return F.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return F.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return F.current.useMemo(e,t)},t.useReducer=function(e,t,n){return F.current.useReducer(e,t,n)},t.useRef=function(e){return F.current.useRef(e)},t.useState=function(e){return F.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return F.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return F.current.useTransition()},t.version="18.2.0"},2791:function(e,t,n){"use strict";e.exports=n(9117)},184:function(e,t,n){"use strict";e.exports=n(6374)},6813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>i(u,n))c<a&&0>i(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<a&&0>i(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],p=1,d=null,f=3,h=!1,m=!1,v=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(l);null!==t;){if(null===t.callback)a(l);else{if(!(t.startTime<=e))break;a(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function k(e){if(v=!1,x(e),!m)if(null!==r(c))m=!0,D(w);else{var t=r(l);null!==t&&Z(k,t.startTime-e)}}function w(e,n){m=!1,v&&(v=!1,y(T),T=-1),h=!0;var i=f;try{for(x(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!_());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(c)&&a(c),x(n)}else a(c);d=r(c)}if(null!==d)var u=!0;else{var p=r(l);null!==p&&Z(k,p.startTime-n),u=!1}return u}finally{d=null,f=i,h=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,I=!1,N=null,T=-1,C=5,E=-1;function _(){return!(t.unstable_now()-E<C)}function A(){if(null!==N){var e=t.unstable_now();E=e;var n=!0;try{n=N(!0,e)}finally{n?S():(I=!1,N=null)}}else I=!1}if("function"===typeof b)S=function(){b(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,F=R.port2;R.port1.onmessage=A,S=function(){F.postMessage(null)}}else S=function(){g(A,0)};function D(e){N=e,I||(I=!0,S())}function Z(e,n){T=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||h||(m=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:p++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(l,e),null===r(c)&&e===r(l)&&(v?(y(T),T=-1):v=!0,Z(k,i-o))):(e.sortIndex=s,n(c,e),m||h||(m=!0,D(w))),e},t.unstable_shouldYield=_,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},5296:function(e,t,n){"use strict";e.exports=n(6813)},6699:function(e,t,n){var r=n(2501),a=n(9112),i=n(2132),o=n(890),s=n(4113),u=n(1725),c=n(3411);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},2501:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197;return function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},1725:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},9112:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},4113:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},890:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},2132:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},3411:function(e,t,n){var r;!function(a,i,o){var s,u=256,c=o.pow(u,6),l=o.pow(2,52),p=2*l,d=255;function f(e,t,n){var r=[],d=g(v((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(u):(e=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,y(i)]}}():e,3),r),f=new h(r),b=function(){for(var e=f.g(6),t=c,n=0;e<l;)e=(e+n)*u,t*=u,n=f.g(1);for(;e>=p;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|f.g(4)},b.quick=function(){return f.g(4)/4294967296},b.double=b,g(y(f.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&m(r,f),e.state=function(){return m(f,{})}),n?(o.random=e,t):e})(b,d,"global"in t?t.global:this==o,t.state)}function h(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<u;)o[a]=a++;for(a=0;a<u;a++)o[a]=o[i=d&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=d&a+1],n=n*u+o[d&(o[a]=o[i=d&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(u)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(v(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[d&a]=d&(n^=19*t[d&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(o.random(),i),e.exports){e.exports=f;try{s=n(5042)}catch(b){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},5410:function(){},8628:function(){},1601:function(){},7792:function(){},4977:function(){},5042:function(){},907:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},3878:function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,{Z:function(){return r}})},7326:function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,{Z:function(){return r}})},5861:function(e,t,n){"use strict";function r(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var o=e.apply(t,n);function s(e){r(o,a,i,s,u,"next",e)}function u(e){r(o,a,i,s,u,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return a}})},5671:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,{Z:function(){return r}})},3144:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}n.d(t,{Z:function(){return a}})},7762:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(181);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,r.Z)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}},9388:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(1120),a=n(8814),i=n(2963);function o(e){var t=(0,a.Z)();return function(){var n,a=(0,r.Z)(e);if(t){var o=(0,r.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,i.Z)(this,n)}}},4942:function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{Z:function(){return r}})},1752:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(1120);function a(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,r.Z)(e)););return e}function i(){return i="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=a(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},i.apply(this,arguments)}},1120:function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,{Z:function(){return r}})},136:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(9611);function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,r.Z)(e,t)}},8814:function(e,t,n){"use strict";function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}n.d(t,{Z:function(){return r}})},9199:function(e,t,n){"use strict";function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,{Z:function(){return r}})},5267:function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,{Z:function(){return r}})},2963:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(1002),a=n(7326);function i(e,t){if(t&&("object"===(0,r.Z)(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,a.Z)(e)}},4165:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(1002);function a(){a=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(E){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var a=t&&t.prototype instanceof f?t:f,i=Object.create(a.prototype),o=new N(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return C()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(E){return{type:"throw",arg:E}}}e.wrap=l;var d={};function f(){}function h(){}function m(){}var v={};c(v,o,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(T([])));y&&y!==t&&n.call(y,o)&&(v=y);var b=m.prototype=f.prototype=Object.create(v);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function a(i,o,s,u){var c=p(e[i],e,o);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==(0,r.Z)(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,s,u)}),(function(e){a("throw",e,s,u)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return a("throw",e,s,u)}))}u(c.arg)}var i;this._invoke=function(e,n){function r(){return new t((function(t,r){a(e,n,t,r)}))}return i=i?i.then(r,r):r()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=p(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function T(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:C}}function C(){return{value:void 0,done:!0}}return h.prototype=m,c(b,"constructor",m),c(m,"constructor",h),h.displayName=c(m,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,u,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},x(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new k(l(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},x(b),c(b,u,"Generator"),c(b,o,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=T,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;I(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}},9611:function(e,t,n){"use strict";function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}n.d(t,{Z:function(){return r}})},9439:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(3878);var a=n(181),i=n(5267);function o(e,t){return(0,r.Z)(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(u){s=!0,a=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||(0,a.Z)(e,t)||(0,i.Z)()}},4506:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(3878),a=n(9199),i=n(181),o=n(5267);function s(e){return(0,r.Z)(e)||(0,a.Z)(e)||(0,i.Z)(e)||(0,o.Z)()}},3433:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(907);var a=n(9199),i=n(181);function o(e){return function(e){if(Array.isArray(e))return(0,r.Z)(e)}(e)||(0,a.Z)(e)||(0,i.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},1002:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{Z:function(){return r}})},181:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(907);function a(e,t){if(e){if("string"===typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}},8737:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(1120),a=n(9611);var i=n(8814);function o(e,t,n){return o=(0,i.Z)()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&(0,a.Z)(i,n.prototype),i},o.apply(null,arguments)}function s(e){var t="function"===typeof Map?new Map:void 0;return s=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return o(e,arguments,(0,r.Z)(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),(0,a.Z)(i,e)},s(e)}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(r,a){if(1&a&&(r=this(r)),8&a)return r;if("object"===typeof r&&r){if(4&a&&r.__esModule)return r;if(16&a&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&a&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((function(e){o[e]=function(){return r[e]}}));return o.default=function(){return r},n.d(i,o),i}}(),n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".ebedc19c.chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="com_pjt:";n.l=function(r,a,i,o){if(e[r])e[r].push(a);else{var s,u;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var p=c[l];if(p.getAttribute("src")==r||p.getAttribute("data-webpack")==t+i){s=p;break}}s||(u=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+i),s.src=r),e[r]=[a];var d=function(t,n){s.onerror=s.onload=null,clearTimeout(f);var a=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),a&&a.forEach((function(e){return e(n)})),t)return t(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.p="/",function(){var e={179:0};n.f.j=function(t,r){var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var i=new Promise((function(n,r){a=e[t]=[n,r]}));r.push(a[2]=i);var o=n.p+n.u(t),s=new Error;n.l(o,(function(r){if(n.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,a[1](s)}}),"chunk-"+t,t)}};var t=function(t,r){var a,i,o=r[0],s=r[1],u=r[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(u)u(n)}for(t&&t(r);c<o.length;c++)i=o[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkcom_pjt=self.webpackChunkcom_pjt||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}(),function(){"use strict";var e,t=n(2791),r=n.t(t,2),a=n(1250),i=n(9439);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));var s=function(e){return e};var u="beforeunload",c="popstate";function l(e){e.preventDefault(),e.returnValue=""}function p(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function d(){return Math.random().toString(36).substr(2,8)}function f(e){var t=e.pathname,n=void 0===t?"/":t,r=e.search,a=void 0===r?"":r,i=e.hash,o=void 0===i?"":i;return a&&"?"!==a&&(n+="?"===a.charAt(0)?a:"?"+a),o&&"#"!==o&&(n+="#"===o.charAt(0)?o:"#"+o),n}function h(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}var m=(0,t.createContext)(null);var v=(0,t.createContext)(null);var g=(0,t.createContext)({outlet:null,matches:[]});function y(e,t){if(!e)throw new Error(t)}function b(e,t,n){void 0===n&&(n="/");var r=C(("string"===typeof t?h(t):t).pathname||"/",n);if(null==r)return null;var a=x(e);!function(e){e.sort((function(e,t){return e.score!==t.score?t.score-e.score:function(e,t){var n=e.length===t.length&&e.slice(0,-1).every((function(e,n){return e===t[n]}));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((function(e){return e.childrenIndex})),t.routesMeta.map((function(e){return e.childrenIndex})))}))}(a);for(var i=null,o=0;null==i&&o<a.length;++o)i=I(a[o],r);return i}function x(e,t,n,r){return void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r=""),e.forEach((function(e,a){var i={relativePath:e.path||"",caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};i.relativePath.startsWith("/")&&(i.relativePath.startsWith(r)||y(!1),i.relativePath=i.relativePath.slice(r.length));var o=E([r,i.relativePath]),s=n.concat(i);e.children&&e.children.length>0&&(!0===e.index&&y(!1),x(e.children,t,s,o)),(null!=e.path||e.index)&&t.push({path:o,score:S(o,e.index),routesMeta:s})})),t}var k=/^:\w+$/,w=function(e){return"*"===e};function S(e,t){var n=e.split("/"),r=n.length;return n.some(w)&&(r+=-2),t&&(r+=2),n.filter((function(e){return!w(e)})).reduce((function(e,t){return e+(k.test(t)?3:""===t?1:10)}),r)}function I(e,t){for(var n=e.routesMeta,r={},a="/",i=[],o=0;o<n.length;++o){var s=n[o],u=o===n.length-1,c="/"===a?t:t.slice(a.length)||"/",l=N({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},c);if(!l)return null;Object.assign(r,l.params);var p=s.route;i.push({params:r,pathname:E([a,l.pathname]),pathnameBase:_(E([a,l.pathnameBase])),route:p}),"/"!==l.pathnameBase&&(a=E([a,l.pathnameBase]))}return i}function N(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});var n=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);var r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,(function(e,t){return r.push(t),"([^\\/]+)"}));e.endsWith("*")?(r.push("*"),a+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):a+=n?"\\/*$":"(?:(?=[.~-]|%[0-9A-F]{2})|\\b|\\/|$)";return[new RegExp(a,t?void 0:"i"),r]}(e.path,e.caseSensitive,e.end),r=(0,i.Z)(n,2),a=r[0],o=r[1],s=t.match(a);if(!s)return null;var u=s[0],c=u.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:o.reduce((function(e,t,n){if("*"===t){var r=l[n]||"";c=u.slice(0,u.length-r.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(n){return e}}(l[n]||""),e}),{}),pathname:u,pathnameBase:c,pattern:e}}function T(e,t,n){var r,a="string"===typeof e?h(e):e,i=""===e||""===a.pathname?"/":a.pathname;if(null==i)r=n;else{var o=t.length-1;if(i.startsWith("..")){for(var s=i.split("/");".."===s[0];)s.shift(),o-=1;a.pathname=s.join("/")}r=o>=0?t[o]:"/"}var u=function(e,t){void 0===t&&(t="/");var n="string"===typeof e?h(e):e,r=n.pathname,a=n.search,i=void 0===a?"":a,o=n.hash,s=void 0===o?"":o,u=r?r.startsWith("/")?r:function(e,t){var n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((function(e){".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(r,t):t;return{pathname:u,search:A(i),hash:R(s)}}(a,r);return i&&"/"!==i&&i.endsWith("/")&&!u.pathname.endsWith("/")&&(u.pathname+="/"),u}function C(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;var n=e.charAt(t.length);return n&&"/"!==n?null:e.slice(t.length)||"/"}var E=function(e){return e.join("/").replace(/\/\/+/g,"/")},_=function(e){return e.replace(/\/+$/,"").replace(/^\/*/,"/")},A=function(e){return e&&"?"!==e?e.startsWith("?")?e:"?"+e:""},R=function(e){return e&&"#"!==e?e.startsWith("#")?e:"#"+e:""};function F(e){D()||y(!1);var n=(0,t.useContext)(m),r=n.basename,a=n.navigator,i=M(e),o=i.hash,s=i.pathname,u=i.search,c=s;if("/"!==r){var l=function(e){return""===e||""===e.pathname?"/":"string"===typeof e?h(e).pathname:e.pathname}(e),p=null!=l&&l.endsWith("/");c="/"===s?r+(p?"/":""):E([r,s])}return a.createHref({pathname:c,search:u,hash:o})}function D(){return null!=(0,t.useContext)(v)}function Z(){return D()||y(!1),(0,t.useContext)(v).location}function O(){D()||y(!1);var e=(0,t.useContext)(m),n=e.basename,r=e.navigator,a=(0,t.useContext)(g).matches,i=Z().pathname,o=JSON.stringify(a.map((function(e){return e.pathnameBase}))),s=(0,t.useRef)(!1);return(0,t.useEffect)((function(){s.current=!0})),(0,t.useCallback)((function(e,t){if(void 0===t&&(t={}),s.current)if("number"!==typeof e){var a=T(e,JSON.parse(o),i);"/"!==n&&(a.pathname=E([n,a.pathname])),(t.replace?r.replace:r.push)(a,t.state)}else r.go(e)}),[n,r,o,i])}function M(e){var n=(0,t.useContext)(g).matches,r=Z().pathname,a=JSON.stringify(n.map((function(e){return e.pathnameBase})));return(0,t.useMemo)((function(){return T(e,JSON.parse(a),r)}),[e,a,r])}function z(e,n){return void 0===n&&(n=[]),null==e?null:e.reduceRight((function(r,a,i){return(0,t.createElement)(g.Provider,{children:void 0!==a.route.element?a.route.element:r,value:{outlet:r,matches:n.concat(e.slice(0,i+1))}})}),null)}function L(e){y(!1)}function P(n){var r=n.basename,a=void 0===r?"/":r,i=n.children,o=void 0===i?null:i,s=n.location,u=n.navigationType,c=void 0===u?e.Pop:u,l=n.navigator,p=n.static,d=void 0!==p&&p;D()&&y(!1);var f=_(a),g=(0,t.useMemo)((function(){return{basename:f,navigator:l,static:d}}),[f,l,d]);"string"===typeof s&&(s=h(s));var b=s,x=b.pathname,k=void 0===x?"/":x,w=b.search,S=void 0===w?"":w,I=b.hash,N=void 0===I?"":I,T=b.state,E=void 0===T?null:T,A=b.key,R=void 0===A?"default":A,F=(0,t.useMemo)((function(){var e=C(k,f);return null==e?null:{pathname:e,search:S,hash:N,state:E,key:R}}),[f,k,S,N,E,R]);return null==F?null:(0,t.createElement)(m.Provider,{value:g},(0,t.createElement)(v.Provider,{children:o,value:{location:F,navigationType:c}}))}function B(e){var n=e.children,r=e.location;return function(e,n){D()||y(!1);var r,a=(0,t.useContext)(g).matches,i=a[a.length-1],o=i?i.params:{},s=(i&&i.pathname,i?i.pathnameBase:"/"),u=(i&&i.route,Z());if(n){var c,l="string"===typeof n?h(n):n;"/"===s||(null==(c=l.pathname)?void 0:c.startsWith(s))||y(!1),r=l}else r=u;var p=r.pathname||"/",d=b(e,{pathname:"/"===s?p:p.slice(s.length)||"/"});return z(d&&d.map((function(e){return Object.assign({},e,{params:Object.assign({},o,e.params),pathname:E([s,e.pathname]),pathnameBase:"/"===e.pathnameBase?s:E([s,e.pathnameBase])})})),a)}(W(n),r)}function W(e){var n=[];return t.Children.forEach(e,(function(e){if((0,t.isValidElement)(e))if(e.type!==t.Fragment){e.type!==L&&y(!1);var r={caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path};e.props.children&&(r.children=W(e.props.children)),n.push(r)}else n.push.apply(n,W(e.props.children))})),n}function V(){return V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},V.apply(this,arguments)}function U(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}var G=["onClick","reloadDocument","replace","state","target","to"];function j(n){var r=n.basename,a=n.children,m=n.window,v=(0,t.useRef)();null==v.current&&(v.current=function(t){void 0===t&&(t={});var n=t.window,r=void 0===n?document.defaultView:n,a=r.history;function i(){var e=r.location,t=e.pathname,n=e.search,i=e.hash,o=a.state||{};return[o.idx,s({pathname:t,search:n,hash:i,state:o.usr||null,key:o.key||"default"})]}var m=null;r.addEventListener(c,(function(){if(m)k.call(m),m=null;else{var t=e.Pop,n=i(),r=n[0],a=n[1];if(k.length){if(null!=r){var o=y-r;o&&(m={action:t,location:a,retry:function(){C(-1*o)}},C(o))}}else T(t)}}));var v=e.Pop,g=i(),y=g[0],b=g[1],x=p(),k=p();function w(e){return"string"===typeof e?e:f(e)}function S(e,t){return void 0===t&&(t=null),s(o({pathname:b.pathname,hash:"",search:""},"string"===typeof e?h(e):e,{state:t,key:d()}))}function I(e,t){return[{usr:e.state,key:e.key,idx:t},w(e)]}function N(e,t,n){return!k.length||(k.call({action:e,location:t,retry:n}),!1)}function T(e){v=e;var t=i();y=t[0],b=t[1],x.call({action:v,location:b})}function C(e){a.go(e)}null==y&&(y=0,a.replaceState(o({},a.state,{idx:y}),""));var E={get action(){return v},get location(){return b},createHref:w,push:function t(n,i){var o=e.Push,s=S(n,i);if(N(o,s,(function(){t(n,i)}))){var u=I(s,y+1),c=u[0],l=u[1];try{a.pushState(c,"",l)}catch(p){r.location.assign(l)}T(o)}},replace:function t(n,r){var i=e.Replace,o=S(n,r);if(N(i,o,(function(){t(n,r)}))){var s=I(o,y),u=s[0],c=s[1];a.replaceState(u,"",c),T(i)}},go:C,back:function(){C(-1)},forward:function(){C(1)},listen:function(e){return x.push(e)},block:function(e){var t=k.push(e);return 1===k.length&&r.addEventListener(u,l),function(){t(),k.length||r.removeEventListener(u,l)}}};return E}({window:m}));var g=v.current,y=(0,t.useState)({action:g.action,location:g.location}),b=(0,i.Z)(y,2),x=b[0],k=b[1];return(0,t.useLayoutEffect)((function(){return g.listen(k)}),[g]),(0,t.createElement)(P,{basename:r,children:a,location:x.location,navigationType:x.action,navigator:g})}var H=(0,t.forwardRef)((function(e,n){var r=e.onClick,a=e.reloadDocument,i=e.replace,o=void 0!==i&&i,s=e.state,u=e.target,c=e.to,l=U(e,G),p=F(c),d=function(e,n){var r=void 0===n?{}:n,a=r.target,i=r.replace,o=r.state,s=O(),u=Z(),c=M(e);return(0,t.useCallback)((function(t){if(0===t.button&&(!a||"_self"===a)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(t)){t.preventDefault();var n=!!i||f(u)===f(c);s(e,{replace:n,state:o})}}),[u,s,c,i,o,a,e])}(c,{replace:o,state:s,target:u});return(0,t.createElement)("a",V({},l,{href:p,onClick:function(e){r&&r(e),e.defaultPrevented||a||d(e)},ref:n,target:u}))}));var q=n(4942);function K(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}function X(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=X(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}var Y=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=X(e))&&(r&&(r+=" "),r+=t);return r};function Q(e,t){var n=o({},t);return Object.keys(e).forEach((function(t){void 0===n[t]&&(n[t]=e[t])})),n}function J(e,t,n){var r={};return Object.keys(e).forEach((function(a){r[a]=e[a].reduce((function(e,r){return r&&(e.push(t(r)),n&&n[r]&&e.push(n[r])),e}),[]).join(" ")})),r}function $(e){for(var t="https://mui.com/production-error/?code="+e,n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}function ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)}function te(e){if(e.type)return e;if("#"===e.charAt(0))return te(function(e){e=e.slice(1);var t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g"),n=e.match(t);return n&&1===n[0].length&&(n=n.map((function(e){return e+e}))),n?"rgb".concat(4===n.length?"a":"","(").concat(n.map((function(e,t){return t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3})).join(", "),")"):""}(e));var t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error($(9,e));var r,a=e.substring(t+1,e.length-1);if("color"===n){if(r=(a=a.split(" ")).shift(),4===a.length&&"/"===a[3].charAt(0)&&(a[3]=a[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(r))throw new Error($(10,r))}else a=a.split(",");return{type:n,values:a=a.map((function(e){return parseFloat(e)})),colorSpace:r}}function ne(e){var t=e.type,n=e.colorSpace,r=e.values;return-1!==t.indexOf("rgb")?r=r.map((function(e,t){return t<3?parseInt(e,10):e})):-1!==t.indexOf("hsl")&&(r[1]="".concat(r[1],"%"),r[2]="".concat(r[2],"%")),r=-1!==t.indexOf("color")?"".concat(n," ").concat(r.join(" ")):"".concat(r.join(", ")),"".concat(t,"(").concat(r,")")}function re(e){var t="hsl"===(e=te(e)).type?te(function(e){var t=(e=te(e)).values,n=t[0],r=t[1]/100,a=t[2]/100,i=r*Math.min(a,1-a),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return a-i*Math.max(Math.min(t-3,9-t,1),-1)},s="rgb",u=[Math.round(255*o(0)),Math.round(255*o(8)),Math.round(255*o(4))];return"hsla"===e.type&&(s+="a",u.push(t[3])),ne({type:s,values:u})}(e)).values:e.values;return t=t.map((function(t){return"color"!==e.type&&(t/=255),t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)})),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function ae(e,t){return e=te(e),t=ee(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]="/".concat(t):e.values[3]=t,ne(e)}function ie(e,t){if(e=te(e),t=ee(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(var n=0;n<3;n+=1)e.values[n]*=1-t;return ne(e)}function oe(e,t){if(e=te(e),t=ee(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(var n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(var r=0;r<3;r+=1)e.values[r]+=(1-e.values[r])*t;return ne(e)}var se=n(3433);var ue=function(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}},ce=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,le=ue((function(e){return ce.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91}));var pe=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(r){0}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0},e}(),de=Math.abs,fe=String.fromCharCode,he=Object.assign;function me(e){return e.trim()}function ve(e,t,n){return e.replace(t,n)}function ge(e,t){return e.indexOf(t)}function ye(e,t){return 0|e.charCodeAt(t)}function be(e,t,n){return e.slice(t,n)}function xe(e){return e.length}function ke(e){return e.length}function we(e,t){return t.push(e),e}var Se=1,Ie=1,Ne=0,Te=0,Ce=0,Ee="";function _e(e,t,n,r,a,i,o){return{value:e,root:t,parent:n,type:r,props:a,children:i,line:Se,column:Ie,length:o,return:""}}function Ae(e,t){return he(_e("",null,null,"",null,null,0),e,{length:-e.length},t)}function Re(){return Ce=Te>0?ye(Ee,--Te):0,Ie--,10===Ce&&(Ie=1,Se--),Ce}function Fe(){return Ce=Te<Ne?ye(Ee,Te++):0,Ie++,10===Ce&&(Ie=1,Se++),Ce}function De(){return ye(Ee,Te)}function Ze(){return Te}function Oe(e,t){return be(Ee,e,t)}function Me(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function ze(e){return Se=Ie=1,Ne=xe(Ee=e),Te=0,[]}function Le(e){return Ee="",e}function Pe(e){return me(Oe(Te-1,Ve(91===e?e+2:40===e?e+1:e)))}function Be(e){for(;(Ce=De())&&Ce<33;)Fe();return Me(e)>2||Me(Ce)>3?"":" "}function We(e,t){for(;--t&&Fe()&&!(Ce<48||Ce>102||Ce>57&&Ce<65||Ce>70&&Ce<97););return Oe(e,Ze()+(t<6&&32==De()&&32==Fe()))}function Ve(e){for(;Fe();)switch(Ce){case e:return Te;case 34:case 39:34!==e&&39!==e&&Ve(Ce);break;case 40:41===e&&Ve(e);break;case 92:Fe()}return Te}function Ue(e,t){for(;Fe()&&e+Ce!==57&&(e+Ce!==84||47!==De()););return"/*"+Oe(t,Te-1)+"*"+fe(47===e?e:Fe())}function Ge(e){for(;!Me(De());)Fe();return Oe(e,Te)}var je="-ms-",He="-moz-",qe="-webkit-",Ke="comm",Xe="rule",Ye="decl",Qe="@keyframes";function Je(e,t){for(var n="",r=ke(e),a=0;a<r;a++)n+=t(e[a],a,e,t)||"";return n}function $e(e,t,n,r){switch(e.type){case"@import":case Ye:return e.return=e.return||e.value;case Ke:return"";case Qe:return e.return=e.value+"{"+Je(e.children,r)+"}";case Xe:e.value=e.props.join(",")}return xe(n=Je(e.children,r))?e.return=e.value+"{"+n+"}":""}function et(e,t){switch(function(e,t){return(((t<<2^ye(e,0))<<2^ye(e,1))<<2^ye(e,2))<<2^ye(e,3)}(e,t)){case 5103:return qe+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return qe+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return qe+e+He+e+je+e+e;case 6828:case 4268:return qe+e+je+e+e;case 6165:return qe+e+je+"flex-"+e+e;case 5187:return qe+e+ve(e,/(\w+).+(:[^]+)/,"-webkit-box-$1$2-ms-flex-$1$2")+e;case 5443:return qe+e+je+"flex-item-"+ve(e,/flex-|-self/,"")+e;case 4675:return qe+e+je+"flex-line-pack"+ve(e,/align-content|flex-|-self/,"")+e;case 5548:return qe+e+je+ve(e,"shrink","negative")+e;case 5292:return qe+e+je+ve(e,"basis","preferred-size")+e;case 6060:return qe+"box-"+ve(e,"-grow","")+qe+e+je+ve(e,"grow","positive")+e;case 4554:return qe+ve(e,/([^-])(transform)/g,"$1-webkit-$2")+e;case 6187:return ve(ve(ve(e,/(zoom-|grab)/,qe+"$1"),/(image-set)/,qe+"$1"),e,"")+e;case 5495:case 3959:return ve(e,/(image-set\([^]*)/,qe+"$1$`$1");case 4968:return ve(ve(e,/(.+:)(flex-)?(.*)/,"-webkit-box-pack:$3-ms-flex-pack:$3"),/s.+-b[^;]+/,"justify")+qe+e+e;case 4095:case 3583:case 4068:case 2532:return ve(e,/(.+)-inline(.+)/,qe+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(xe(e)-1-t>6)switch(ye(e,t+1)){case 109:if(45!==ye(e,t+4))break;case 102:return ve(e,/(.+:)(.+)-([^]+)/,"$1-webkit-$2-$3$1"+He+(108==ye(e,t+3)?"$3":"$2-$3"))+e;case 115:return~ge(e,"stretch")?et(ve(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==ye(e,t+1))break;case 6444:switch(ye(e,xe(e)-3-(~ge(e,"!important")&&10))){case 107:return ve(e,":",":"+qe)+e;case 101:return ve(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+qe+(45===ye(e,14)?"inline-":"")+"box$3$1"+qe+"$2$3$1"+je+"$2box$3")+e}break;case 5936:switch(ye(e,t+11)){case 114:return qe+e+je+ve(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return qe+e+je+ve(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return qe+e+je+ve(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return qe+e+je+e+e}return e}function tt(e){return Le(nt("",null,null,null,[""],e=ze(e),0,[0],e))}function nt(e,t,n,r,a,i,o,s,u){for(var c=0,l=0,p=o,d=0,f=0,h=0,m=1,v=1,g=1,y=0,b="",x=a,k=i,w=r,S=b;v;)switch(h=y,y=Fe()){case 40:if(108!=h&&58==S.charCodeAt(p-1)){-1!=ge(S+=ve(Pe(y),"&","&\f"),"&\f")&&(g=-1);break}case 34:case 39:case 91:S+=Pe(y);break;case 9:case 10:case 13:case 32:S+=Be(h);break;case 92:S+=We(Ze()-1,7);continue;case 47:switch(De()){case 42:case 47:we(at(Ue(Fe(),Ze()),t,n),u);break;default:S+="/"}break;case 123*m:s[c++]=xe(S)*g;case 125*m:case 59:case 0:switch(y){case 0:case 125:v=0;case 59+l:f>0&&xe(S)-p&&we(f>32?it(S+";",r,n,p-1):it(ve(S," ","")+";",r,n,p-2),u);break;case 59:S+=";";default:if(we(w=rt(S,t,n,c,l,a,s,b,x=[],k=[],p),i),123===y)if(0===l)nt(S,t,w,w,x,i,p,s,k);else switch(d){case 100:case 109:case 115:nt(e,w,w,r&&we(rt(e,w,w,0,0,a,s,b,a,x=[],p),k),a,k,p,s,r?x:k);break;default:nt(S,w,w,w,[""],k,0,s,k)}}c=l=f=0,m=g=1,b=S="",p=o;break;case 58:p=1+xe(S),f=h;default:if(m<1)if(123==y)--m;else if(125==y&&0==m++&&125==Re())continue;switch(S+=fe(y),y*m){case 38:g=l>0?1:(S+="\f",-1);break;case 44:s[c++]=(xe(S)-1)*g,g=1;break;case 64:45===De()&&(S+=Pe(Fe())),d=De(),l=p=xe(b=S+=Ge(Ze())),y++;break;case 45:45===h&&2==xe(S)&&(m=0)}}return i}function rt(e,t,n,r,a,i,o,s,u,c,l){for(var p=a-1,d=0===a?i:[""],f=ke(d),h=0,m=0,v=0;h<r;++h)for(var g=0,y=be(e,p+1,p=de(m=o[h])),b=e;g<f;++g)(b=me(m>0?d[g]+" "+y:ve(y,/&\f/g,d[g])))&&(u[v++]=b);return _e(e,t,n,0===a?Xe:s,u,c,l)}function at(e,t,n){return _e(e,t,n,Ke,fe(Ce),be(e,2,-2),0)}function it(e,t,n,r){return _e(e,t,n,Ye,be(e,0,r),be(e,r+1,-1),r)}var ot=function(e,t,n){for(var r=0,a=0;r=a,a=De(),38===r&&12===a&&(t[n]=1),!Me(a);)Fe();return Oe(e,Te)},st=function(e,t){return Le(function(e,t){var n=-1,r=44;do{switch(Me(r)){case 0:38===r&&12===De()&&(t[n]=1),e[n]+=ot(Te-1,t,n);break;case 2:e[n]+=Pe(r);break;case 4:if(44===r){e[++n]=58===De()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=fe(r)}}while(r=Fe());return e}(ze(e),t))},ut=new WeakMap,ct=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||ut.get(n))&&!r){ut.set(e,!0);for(var a=[],i=st(t,a),o=n.props,s=0,u=0;s<i.length;s++)for(var c=0;c<o.length;c++,u++)e.props[u]=a[s]?i[s].replace(/&\f/g,o[c]):o[c]+" "+i[s]}}},lt=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}},pt=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case Ye:e.return=et(e.value,e.length);break;case Qe:return Je([Ae(e,{value:ve(e.value,"@","@"+qe)})],r);case Xe:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Je([Ae(e,{props:[ve(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return Je([Ae(e,{props:[ve(t,/:(plac\w+)/,":-webkit-input-$1")]}),Ae(e,{props:[ve(t,/:(plac\w+)/,":-moz-$1")]}),Ae(e,{props:[ve(t,/:(plac\w+)/,je+"input-$1")]})],r)}return""}))}}],dt=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var r=e.stylisPlugins||pt;var a,i,o={},s=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)o[t[n]]=!0;s.push(e)}));var u,c,l=[$e,(c=function(e){u.insert(e)},function(e){e.root||(e=e.return)&&c(e)})],p=function(e){var t=ke(e);return function(n,r,a,i){for(var o="",s=0;s<t;s++)o+=e[s](n,r,a,i)||"";return o}}([ct,lt].concat(r,l));i=function(e,t,n,r){u=n,function(e){Je(tt(e),p)}(e?e+"{"+t.styles+"}":t.styles),r&&(d.inserted[t.name]=!0)};var d={key:t,sheet:new pe({key:t,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:o,registered:{},insert:i};return d.sheet.hydrate(s),d};var ft=function(e){for(var t,n=0,r=0,a=e.length;a>=4;++r,a-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(a){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)},ht={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},mt=/[A-Z]|^ms/g,vt=/_EMO_([^_]+?)_([^]*?)_EMO_/g,gt=function(e){return 45===e.charCodeAt(1)},yt=function(e){return null!=e&&"boolean"!==typeof e},bt=ue((function(e){return gt(e)?e:e.replace(mt,"-$&").toLowerCase()})),xt=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(vt,(function(e,t,n){return wt={name:t,styles:n,next:wt},t}))}return 1===ht[e]||gt(e)||"number"!==typeof t||0===t?t:t+"px"};function kt(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return wt={name:n.name,styles:n.styles,next:wt},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)wt={name:r.name,styles:r.styles,next:wt},r=r.next;return n.styles+";"}return function(e,t,n){var r="";if(Array.isArray(n))for(var a=0;a<n.length;a++)r+=kt(e,t,n[a])+";";else for(var i in n){var o=n[i];if("object"!==typeof o)null!=t&&void 0!==t[o]?r+=i+"{"+t[o]+"}":yt(o)&&(r+=bt(i)+":"+xt(i,o)+";");else if(!Array.isArray(o)||"string"!==typeof o[0]||null!=t&&void 0!==t[o[0]]){var s=kt(e,t,o);switch(i){case"animation":case"animationName":r+=bt(i)+":"+s+";";break;default:r+=i+"{"+s+"}"}}else for(var u=0;u<o.length;u++)yt(o[u])&&(r+=bt(i)+":"+xt(i,o[u])+";")}return r}(e,t,n);case"function":if(void 0!==e){var a=wt,i=n(e);return wt=a,kt(e,t,i)}}if(null==t)return n;var o=t[n];return void 0!==o?o:n}var wt,St=/label:\s*([^\s;\n{]+)\s*(;|$)/g;var It=function(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,a="";wt=void 0;var i=e[0];null==i||void 0===i.raw?(r=!1,a+=kt(n,t,i)):a+=i[0];for(var o=1;o<e.length;o++)a+=kt(n,t,e[o]),r&&(a+=i[o]);St.lastIndex=0;for(var s,u="";null!==(s=St.exec(a));)u+="-"+s[1];return{name:ft(a)+u,styles:a,next:wt}},Nt=(0,t.createContext)("undefined"!==typeof HTMLElement?dt({key:"css"}):null);Nt.Provider;var Tt=function(e){return(0,t.forwardRef)((function(n,r){var a=(0,t.useContext)(Nt);return e(n,a,r)}))},Ct=(0,t.createContext)({});r.useInsertionEffect&&r.useInsertionEffect;function Et(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}var _t=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},At=le,Rt=function(e){return"theme"!==e},Ft=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?At:Rt},Dt=function(e,t,n){var r;if(t){var a=t.shouldForwardProp;r=e.__emotion_forwardProp&&a?function(t){return e.__emotion_forwardProp(t)&&a(t)}:a}return"function"!==typeof r&&n&&(r=e.__emotion_forwardProp),r},Zt=r.useInsertionEffect?r.useInsertionEffect:function(e){e()};var Ot=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;_t(t,n,r);var a;a=function(){return function(e,t,n){_t(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var a=t;do{e.insert(t===a?"."+r:"",a,e.sheet,!0),a=a.next}while(void 0!==a)}}(t,n,r)},Zt(a);return null},Mt=function e(n,r){var a,i,s=n.__emotion_real===n,u=s&&n.__emotion_base||n;void 0!==r&&(a=r.label,i=r.target);var c=Dt(n,r,s),l=c||Ft(u),p=!l("as");return function(){var d=arguments,f=s&&void 0!==n.__emotion_styles?n.__emotion_styles.slice(0):[];if(void 0!==a&&f.push("label:"+a+";"),null==d[0]||void 0===d[0].raw)f.push.apply(f,d);else{0,f.push(d[0][0]);for(var h=d.length,m=1;m<h;m++)f.push(d[m],d[0][m])}var v=Tt((function(e,n,r){var a=p&&e.as||u,o="",s=[],d=e;if(null==e.theme){for(var h in d={},e)d[h]=e[h];d.theme=(0,t.useContext)(Ct)}"string"===typeof e.className?o=Et(n.registered,s,e.className):null!=e.className&&(o=e.className+" ");var m=It(f.concat(s),n.registered,d);o+=n.key+"-"+m.name,void 0!==i&&(o+=" "+i);var v=p&&void 0===c?Ft(a):l,g={};for(var y in e)p&&"as"===y||v(y)&&(g[y]=e[y]);return g.className=o,g.ref=r,(0,t.createElement)(t.Fragment,null,(0,t.createElement)(Ot,{cache:n,serialized:m,isStringTag:"string"===typeof a}),(0,t.createElement)(a,g))}));return v.displayName=void 0!==a?a:"Styled("+("string"===typeof u?u:u.displayName||u.name||"Component")+")",v.defaultProps=n.defaultProps,v.__emotion_real=v,v.__emotion_base=u,v.__emotion_styles=f,v.__emotion_forwardProp=c,Object.defineProperty(v,"toString",{value:function(){return"."+i}}),v.withComponent=function(t,n){return e(t,o({},r,n,{shouldForwardProp:Dt(v,n,!0)})).apply(void 0,f)},v}},zt=Mt.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){zt[e]=zt(e)}));var Lt=zt;function Pt(e,t){return Lt(e,t)}var Bt=function(e,t){Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))};function Wt(e){return null!==e&&"object"===typeof e&&e.constructor===Object}function Vt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0},r=n.clone?o({},e):e;return Wt(e)&&Wt(t)&&Object.keys(t).forEach((function(a){"__proto__"!==a&&(Wt(t[a])&&a in e&&Wt(e[a])?r[a]=Vt(e[a],t[a],n):r[a]=t[a])})),r}var Ut=["values","unit","step"];function Gt(e){var t=e.values,n=void 0===t?{xs:0,sm:600,md:900,lg:1200,xl:1536}:t,r=e.unit,a=void 0===r?"px":r,i=e.step,s=void 0===i?5:i,u=K(e,Ut),c=function(e){var t=Object.keys(e).map((function(t){return{key:t,val:e[t]}}))||[];return t.sort((function(e,t){return e.val-t.val})),t.reduce((function(e,t){return o({},e,(0,q.Z)({},t.key,t.val))}),{})}(n),l=Object.keys(c);function p(e){var t="number"===typeof n[e]?n[e]:e;return"@media (min-width:".concat(t).concat(a,")")}function d(e){var t="number"===typeof n[e]?n[e]:e;return"@media (max-width:".concat(t-s/100).concat(a,")")}function f(e,t){var r=l.indexOf(t);return"@media (min-width:".concat("number"===typeof n[e]?n[e]:e).concat(a,") and ")+"(max-width:".concat((-1!==r&&"number"===typeof n[l[r]]?n[l[r]]:t)-s/100).concat(a,")")}return o({keys:l,values:c,up:p,down:d,between:f,only:function(e){return l.indexOf(e)+1<l.length?f(e,l[l.indexOf(e)+1]):p(e)},not:function(e){var t=l.indexOf(e);return 0===t?p(l[1]):t===l.length-1?d(l[t]):f(e,l[l.indexOf(e)+1]).replace("@media","@media not all and")},unit:a},u)}var jt={borderRadius:4},Ht={xs:0,sm:600,md:900,lg:1200,xl:1536},qt={keys:["xs","sm","md","lg","xl"],up:function(e){return"@media (min-width:".concat(Ht[e],"px)")}};function Kt(e,t,n){var r=e.theme||{};if(Array.isArray(t)){var a=r.breakpoints||qt;return t.reduce((function(e,r,i){return e[a.up(a.keys[i])]=n(t[i]),e}),{})}if("object"===typeof t){var i=r.breakpoints||qt;return Object.keys(t).reduce((function(e,r){if(-1!==Object.keys(i.values||Ht).indexOf(r)){e[i.up(r)]=n(t[r],r)}else{var a=r;e[a]=t[a]}return e}),{})}return n(t)}function Xt(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=null==(e=t.keys)?void 0:e.reduce((function(e,n){return e[t.up(n)]={},e}),{});return n||{}}function Yt(e,t){return e.reduce((function(e,t){var n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}function Qt(e){if("string"!==typeof e)throw new Error($(7));return e.charAt(0).toUpperCase()+e.slice(1)}function Jt(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){var r="vars.".concat(t).split(".").reduce((function(e,t){return e&&e[t]?e[t]:null}),e);if(null!=r)return r}return t.split(".").reduce((function(e,t){return e&&null!=e[t]?e[t]:null}),e)}function $t(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return r="function"===typeof e?e(n):Array.isArray(e)?e[n]||a:Jt(e,n)||a,t&&(r=t(r)),r}var en=function(e){var t=e.prop,n=e.cssProperty,r=void 0===n?e.prop:n,a=e.themeKey,i=e.transform,o=function(e){if(null==e[t])return null;var n=e[t],o=Jt(e.theme,a)||{};return Kt(e,n,(function(e){var n=$t(o,i,e);return e===n&&"string"===typeof e&&(n=$t(o,i,"".concat(t).concat("default"===e?"":Qt(e)),e)),!1===r?n:(0,q.Z)({},r,n)}))};return o.propTypes={},o.filterProps=[t],o};var tn=function(e,t){return t?Vt(e,t,{clone:!1}):e};var nn={m:"margin",p:"padding"},rn={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},an={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},on=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}((function(e){if(e.length>2){if(!an[e])return[e];e=an[e]}var t=e.split(""),n=(0,i.Z)(t,2),r=n[0],a=n[1],o=nn[r],s=rn[a]||"";return Array.isArray(s)?s.map((function(e){return o+e})):[o+s]})),sn=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],un=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],cn=[].concat(sn,un);function ln(e,t,n,r){var a,i=null!=(a=Jt(e,t,!1))?a:n;return"number"===typeof i?function(e){return"string"===typeof e?e:i*e}:Array.isArray(i)?function(e){return"string"===typeof e?e:i[e]}:"function"===typeof i?i:function(){}}function pn(e){return ln(e,"spacing",8)}function dn(e,t){if("string"===typeof t||null==t)return t;var n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:"-".concat(n)}function fn(e,t,n,r){if(-1===t.indexOf(n))return null;var a=function(e,t){return function(n){return e.reduce((function(e,r){return e[r]=dn(t,n),e}),{})}}(on(n),r);return Kt(e,e[n],a)}function hn(e,t){var n=pn(e.theme);return Object.keys(e).map((function(r){return fn(e,t,r,n)})).reduce(tn,{})}function mn(e){return hn(e,sn)}function vn(e){return hn(e,un)}function gn(e){return hn(e,cn)}mn.propTypes={},mn.filterProps=sn,vn.propTypes={},vn.filterProps=un,gn.propTypes={},gn.filterProps=cn;var yn=gn;function bn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;var t=pn({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=0===n.length?[1]:n;return a.map((function(e){var n=t(e);return"number"===typeof n?"".concat(n,"px"):n})).join(" ")};return n.mui=!0,n}var xn=["breakpoints","palette","spacing","shape"];var kn=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.breakpoints,n=void 0===t?{}:t,r=e.palette,a=void 0===r?{}:r,i=e.spacing,s=e.shape,u=void 0===s?{}:s,c=K(e,xn),l=Gt(n),p=bn(i),d=Vt({breakpoints:l,direction:"ltr",components:{},palette:o({mode:"light"},a),spacing:p,shape:o({},jt,u)},c),f=arguments.length,h=new Array(f>1?f-1:0),m=1;m<f;m++)h[m-1]=arguments[m];return d=h.reduce((function(e,t){return Vt(e,t)}),d)},wn=["variant"];function Sn(e){return 0===e.length}function In(e){var t=e.variant,n=K(e,wn),r=t||"";return Object.keys(n).sort().forEach((function(t){r+="color"===t?Sn(r)?e[t]:Qt(e[t]):"".concat(Sn(r)?t:Qt(t)).concat(Qt(e[t].toString()))})),r}var Nn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce((function(e,t){return t.filterProps.forEach((function(n){e[n]=t})),e}),{}),a=function(e){return Object.keys(e).reduce((function(t,n){return r[n]?tn(t,r[n](e)):t}),{})};return a.propTypes={},a.filterProps=t.reduce((function(e,t){return e.concat(t.filterProps)}),[]),a};function Tn(e){return"number"!==typeof e?e:"".concat(e,"px solid")}var Cn=en({prop:"border",themeKey:"borders",transform:Tn}),En=en({prop:"borderTop",themeKey:"borders",transform:Tn}),_n=en({prop:"borderRight",themeKey:"borders",transform:Tn}),An=en({prop:"borderBottom",themeKey:"borders",transform:Tn}),Rn=en({prop:"borderLeft",themeKey:"borders",transform:Tn}),Fn=en({prop:"borderColor",themeKey:"palette"}),Dn=en({prop:"borderTopColor",themeKey:"palette"}),Zn=en({prop:"borderRightColor",themeKey:"palette"}),On=en({prop:"borderBottomColor",themeKey:"palette"}),Mn=en({prop:"borderLeftColor",themeKey:"palette"}),zn=function(e){if(void 0!==e.borderRadius&&null!==e.borderRadius){var t=ln(e.theme,"shape.borderRadius",4);return Kt(e,e.borderRadius,(function(e){return{borderRadius:dn(t,e)}}))}return null};zn.propTypes={},zn.filterProps=["borderRadius"];var Ln=Nn(Cn,En,_n,An,Rn,Fn,Dn,Zn,On,Mn,zn),Pn=Nn(en({prop:"displayPrint",cssProperty:!1,transform:function(e){return{"@media print":{display:e}}}}),en({prop:"display"}),en({prop:"overflow"}),en({prop:"textOverflow"}),en({prop:"visibility"}),en({prop:"whiteSpace"})),Bn=Nn(en({prop:"flexBasis"}),en({prop:"flexDirection"}),en({prop:"flexWrap"}),en({prop:"justifyContent"}),en({prop:"alignItems"}),en({prop:"alignContent"}),en({prop:"order"}),en({prop:"flex"}),en({prop:"flexGrow"}),en({prop:"flexShrink"}),en({prop:"alignSelf"}),en({prop:"justifyItems"}),en({prop:"justifySelf"})),Wn=function(e){if(void 0!==e.gap&&null!==e.gap){var t=ln(e.theme,"spacing",8);return Kt(e,e.gap,(function(e){return{gap:dn(t,e)}}))}return null};Wn.propTypes={},Wn.filterProps=["gap"];var Vn=function(e){if(void 0!==e.columnGap&&null!==e.columnGap){var t=ln(e.theme,"spacing",8);return Kt(e,e.columnGap,(function(e){return{columnGap:dn(t,e)}}))}return null};Vn.propTypes={},Vn.filterProps=["columnGap"];var Un=function(e){if(void 0!==e.rowGap&&null!==e.rowGap){var t=ln(e.theme,"spacing",8);return Kt(e,e.rowGap,(function(e){return{rowGap:dn(t,e)}}))}return null};Un.propTypes={},Un.filterProps=["rowGap"];var Gn=Nn(Wn,Vn,Un,en({prop:"gridColumn"}),en({prop:"gridRow"}),en({prop:"gridAutoFlow"}),en({prop:"gridAutoColumns"}),en({prop:"gridAutoRows"}),en({prop:"gridTemplateColumns"}),en({prop:"gridTemplateRows"}),en({prop:"gridTemplateAreas"}),en({prop:"gridArea"})),jn=Nn(en({prop:"position"}),en({prop:"zIndex",themeKey:"zIndex"}),en({prop:"top"}),en({prop:"right"}),en({prop:"bottom"}),en({prop:"left"})),Hn=Nn(en({prop:"color",themeKey:"palette"}),en({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette"}),en({prop:"backgroundColor",themeKey:"palette"})),qn=en({prop:"boxShadow",themeKey:"shadows"});function Kn(e){return e<=1&&0!==e?"".concat(100*e,"%"):e}var Xn=en({prop:"width",transform:Kn}),Yn=function(e){if(void 0!==e.maxWidth&&null!==e.maxWidth){return Kt(e,e.maxWidth,(function(t){var n,r,a;return{maxWidth:(null==(n=e.theme)||null==(r=n.breakpoints)||null==(a=r.values)?void 0:a[t])||Ht[t]||Kn(t)}}))}return null};Yn.filterProps=["maxWidth"];var Qn=en({prop:"minWidth",transform:Kn}),Jn=en({prop:"height",transform:Kn}),$n=en({prop:"maxHeight",transform:Kn}),er=en({prop:"minHeight",transform:Kn}),tr=(en({prop:"size",cssProperty:"width",transform:Kn}),en({prop:"size",cssProperty:"height",transform:Kn}),Nn(Xn,Yn,Qn,Jn,$n,er,en({prop:"boxSizing"}))),nr=en({prop:"fontFamily",themeKey:"typography"}),rr=en({prop:"fontSize",themeKey:"typography"}),ar=en({prop:"fontStyle",themeKey:"typography"}),ir=en({prop:"fontWeight",themeKey:"typography"}),or=en({prop:"letterSpacing"}),sr=en({prop:"textTransform"}),ur=en({prop:"lineHeight"}),cr=en({prop:"textAlign"}),lr=Nn(en({prop:"typography",cssProperty:!1,themeKey:"typography"}),nr,rr,ar,ir,or,ur,cr,sr),pr={borders:Ln.filterProps,display:Pn.filterProps,flexbox:Bn.filterProps,grid:Gn.filterProps,positions:jn.filterProps,palette:Hn.filterProps,shadows:qn.filterProps,sizing:tr.filterProps,spacing:yn.filterProps,typography:lr.filterProps},dr={borders:Ln,display:Pn,flexbox:Bn,grid:Gn,positions:jn,palette:Hn,shadows:qn,sizing:tr,spacing:yn,typography:lr},fr=Object.keys(pr).reduce((function(e,t){return pr[t].forEach((function(n){e[n]=dr[t]})),e}),{});function hr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce((function(e,t){return e.concat(Object.keys(t))}),[]),a=new Set(r);return t.every((function(e){return a.size===Object.keys(e).length}))}function mr(e,t){return"function"===typeof e?e(t):e}var vr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dr,t=Object.keys(e).reduce((function(t,n){return e[n].filterProps.forEach((function(r){t[r]=e[n]})),t}),{});function n(e,n,r){var a,i=(a={},(0,q.Z)(a,e,n),(0,q.Z)(a,"theme",r),a),o=t[e];return o?o(i):(0,q.Z)({},e,n)}function r(e){var a=e||{},i=a.sx,o=a.theme,s=void 0===o?{}:o;if(!i)return null;function u(e){var a=e;if("function"===typeof e)a=e(s);else if("object"!==typeof e)return e;if(!a)return null;var i=Xt(s.breakpoints),o=Object.keys(i),u=i;return Object.keys(a).forEach((function(e){var i=mr(a[e],s);if(null!==i&&void 0!==i)if("object"===typeof i)if(t[e])u=tn(u,n(e,i,s));else{var o=Kt({theme:s},i,(function(t){return(0,q.Z)({},e,t)}));hr(o,i)?u[e]=r({sx:i,theme:s}):u=tn(u,o)}else u=tn(u,n(e,i,s))})),Yt(o,u)}return Array.isArray(i)?i.map(u):u(i)}return r}();vr.filterProps=["sx"];var gr=vr,yr=["name","slot","skipVariantsResolver","skipSx","overridesResolver"],br=["theme"],xr=["theme"];function kr(e){return 0===Object.keys(e).length}function wr(e){return"string"===typeof e&&e.charCodeAt(0)>96}var Sr=function(e,t){return t.components&&t.components[e]&&t.components[e].styleOverrides?t.components[e].styleOverrides:null},Ir=function(e,t){var n=[];t&&t.components&&t.components[e]&&t.components[e].variants&&(n=t.components[e].variants);var r={};return n.forEach((function(e){var t=In(e.props);r[t]=e.style})),r},Nr=function(e,t,n,r){var a,i,o=e.ownerState,s=void 0===o?{}:o,u=[],c=null==n||null==(a=n.components)||null==(i=a[r])?void 0:i.variants;return c&&c.forEach((function(n){var r=!0;Object.keys(n.props).forEach((function(t){s[t]!==n.props[t]&&e[t]!==n.props[t]&&(r=!1)})),r&&u.push(t[In(n.props)])})),u};function Tr(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}var Cr=kn();function Er(e,t){var n;return o({toolbar:(n={minHeight:56},(0,q.Z)(n,e.up("xs"),{"@media (orientation: landscape)":{minHeight:48}}),(0,q.Z)(n,e.up("sm"),{minHeight:64}),n)},t)}var _r={black:"#000",white:"#fff"},Ar={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},Rr={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},Fr={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},Dr={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Zr={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},Or={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},Mr={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},zr=["mode","contrastThreshold","tonalOffset"],Lr={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:_r.white,default:_r.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},Pr={text:{primary:_r.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:_r.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function Br(e,t,n,r){var a=r.light||r,i=r.dark||1.5*r;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=oe(e.main,a):"dark"===t&&(e.dark=ie(e.main,i)))}function Wr(e){var t=e.mode,n=void 0===t?"light":t,r=e.contrastThreshold,a=void 0===r?3:r,i=e.tonalOffset,s=void 0===i?.2:i,u=K(e,zr),c=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Zr[200],light:Zr[50],dark:Zr[400]}:{main:Zr[700],light:Zr[400],dark:Zr[800]}}(n),l=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Rr[200],light:Rr[50],dark:Rr[400]}:{main:Rr[500],light:Rr[300],dark:Rr[700]}}(n),p=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Fr[500],light:Fr[300],dark:Fr[700]}:{main:Fr[700],light:Fr[400],dark:Fr[800]}}(n),d=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Or[400],light:Or[300],dark:Or[700]}:{main:Or[700],light:Or[500],dark:Or[900]}}(n),f=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Mr[400],light:Mr[300],dark:Mr[700]}:{main:Mr[800],light:Mr[500],dark:Mr[900]}}(n),h=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Dr[400],light:Dr[300],dark:Dr[700]}:{main:"#ed6c02",light:Dr[500],dark:Dr[900]}}(n);function m(e){var t=function(e,t){var n=re(e),r=re(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}(e,Pr.text.primary)>=a?Pr.text.primary:Lr.text.primary;return t}var v=function(e){var t=e.color,n=e.name,r=e.mainShade,a=void 0===r?500:r,i=e.lightShade,u=void 0===i?300:i,c=e.darkShade,l=void 0===c?700:c;if(!(t=o({},t)).main&&t[a]&&(t.main=t[a]),!t.hasOwnProperty("main"))throw new Error($(11,n?" (".concat(n,")"):"",a));if("string"!==typeof t.main)throw new Error($(12,n?" (".concat(n,")"):"",JSON.stringify(t.main)));return Br(t,"light",u,s),Br(t,"dark",l,s),t.contrastText||(t.contrastText=m(t.main)),t},g={dark:Pr,light:Lr};return Vt(o({common:o({},_r),mode:n,primary:v({color:c,name:"primary"}),secondary:v({color:l,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:v({color:p,name:"error"}),warning:v({color:h,name:"warning"}),info:v({color:d,name:"info"}),success:v({color:f,name:"success"}),grey:Ar,contrastThreshold:a,getContrastText:m,augmentColor:v,tonalOffset:s},g[n]),u)}var Vr=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];var Ur={textTransform:"uppercase"},Gr='"Roboto", "Helvetica", "Arial", sans-serif';function jr(e,t){var n="function"===typeof t?t(e):t,r=n.fontFamily,a=void 0===r?Gr:r,i=n.fontSize,s=void 0===i?14:i,u=n.fontWeightLight,c=void 0===u?300:u,l=n.fontWeightRegular,p=void 0===l?400:l,d=n.fontWeightMedium,f=void 0===d?500:d,h=n.fontWeightBold,m=void 0===h?700:h,v=n.htmlFontSize,g=void 0===v?16:v,y=n.allVariants,b=n.pxToRem,x=K(n,Vr);var k=s/14,w=b||function(e){return"".concat(e/g*k,"rem")},S=function(e,t,n,r,i){return o({fontFamily:a,fontWeight:e,fontSize:w(t),lineHeight:n},a===Gr?{letterSpacing:"".concat((s=r/t,Math.round(1e5*s)/1e5),"em")}:{},i,y);var s},I={h1:S(c,96,1.167,-1.5),h2:S(c,60,1.2,-.5),h3:S(p,48,1.167,0),h4:S(p,34,1.235,.25),h5:S(p,24,1.334,0),h6:S(f,20,1.6,.15),subtitle1:S(p,16,1.75,.15),subtitle2:S(f,14,1.57,.1),body1:S(p,16,1.5,.15),body2:S(p,14,1.43,.15),button:S(f,14,1.75,.4,Ur),caption:S(p,12,1.66,.4),overline:S(p,12,2.66,1,Ur)};return Vt(o({htmlFontSize:g,pxToRem:w,fontFamily:a,fontSize:s,fontWeightLight:c,fontWeightRegular:p,fontWeightMedium:f,fontWeightBold:m},I),x,{clone:!1})}function Hr(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}var qr=["none",Hr(0,2,1,-1,0,1,1,0,0,1,3,0),Hr(0,3,1,-2,0,2,2,0,0,1,5,0),Hr(0,3,3,-2,0,3,4,0,0,1,8,0),Hr(0,2,4,-1,0,4,5,0,0,1,10,0),Hr(0,3,5,-1,0,5,8,0,0,1,14,0),Hr(0,3,5,-1,0,6,10,0,0,1,18,0),Hr(0,4,5,-2,0,7,10,1,0,2,16,1),Hr(0,5,5,-3,0,8,10,1,0,3,14,2),Hr(0,5,6,-3,0,9,12,1,0,3,16,2),Hr(0,6,6,-3,0,10,14,1,0,4,18,3),Hr(0,6,7,-4,0,11,15,1,0,4,20,3),Hr(0,7,8,-4,0,12,17,2,0,5,22,4),Hr(0,7,8,-4,0,13,19,2,0,5,24,4),Hr(0,7,9,-4,0,14,21,2,0,5,26,4),Hr(0,8,9,-5,0,15,22,2,0,6,28,5),Hr(0,8,10,-5,0,16,24,2,0,6,30,5),Hr(0,8,11,-5,0,17,26,2,0,6,32,5),Hr(0,9,11,-5,0,18,28,2,0,7,34,6),Hr(0,9,12,-6,0,19,29,2,0,7,36,6),Hr(0,10,13,-6,0,20,31,3,0,8,38,7),Hr(0,10,13,-6,0,21,33,3,0,8,40,7),Hr(0,10,14,-6,0,22,35,3,0,8,42,7),Hr(0,11,14,-7,0,23,36,3,0,9,44,8),Hr(0,11,15,-7,0,24,38,3,0,9,46,8)],Kr=["duration","easing","delay"],Xr={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},Yr={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function Qr(e){return"".concat(Math.round(e),"ms")}function Jr(e){if(!e)return 0;var t=e/36;return Math.round(10*(4+15*Math.pow(t,.25)+t/5))}function $r(e){var t=o({},Xr,e.easing),n=o({},Yr,e.duration);return o({getAutoHeightDuration:Jr,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.duration,i=void 0===a?n.standard:a,o=r.easing,s=void 0===o?t.easeInOut:o,u=r.delay,c=void 0===u?0:u;K(r,Kr);return(Array.isArray(e)?e:[e]).map((function(e){return"".concat(e," ").concat("string"===typeof i?i:Qr(i)," ").concat(s," ").concat("string"===typeof c?c:Qr(c))})).join(",")}},e,{easing:t,duration:n})}var ea={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},ta=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function na(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mixins,n=void 0===t?{}:t,r=e.palette,a=void 0===r?{}:r,i=e.transitions,s=void 0===i?{}:i,u=e.typography,c=void 0===u?{}:u,l=K(e,ta);if(e.vars)throw new Error($(18));var p=Wr(a),d=kn(e),f=Vt(d,{mixins:Er(d.breakpoints,n),palette:p,shadows:qr.slice(),typography:jr(p,c),transitions:$r(s),zIndex:o({},ea)});f=Vt(f,l);for(var h=arguments.length,m=new Array(h>1?h-1:0),v=1;v<h;v++)m[v-1]=arguments[v];return f=m.reduce((function(e,t){return Vt(e,t)}),f)}var ra=na,aa=ra(),ia=function(e){return Tr(e)&&"classes"!==e},oa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.defaultTheme,n=void 0===t?Cr:t,r=e.rootShouldForwardProp,a=void 0===r?Tr:r,s=e.slotShouldForwardProp,u=void 0===s?Tr:s,c=e.styleFunctionSx,l=void 0===c?gr:c,p=function(e){var t=kr(e.theme)?n:e.theme;return l(o({},e,{theme:t}))};return p.__mui_systemSx=!0,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Bt(e,(function(e){return e.filter((function(e){return!(null!=e&&e.__mui_systemSx)}))}));var r,s=t.name,c=t.slot,l=t.skipVariantsResolver,d=t.skipSx,f=t.overridesResolver,h=K(t,yr),m=void 0!==l?l:c&&"Root"!==c||!1,v=d||!1;var g=Tr;"Root"===c?g=a:c?g=u:wr(e)&&(g=void 0);var y=Pt(e,o({shouldForwardProp:g,label:r},h)),b=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];var u=r?r.map((function(e){return"function"===typeof e&&e.__emotion_real!==e?function(t){var r=t.theme,a=K(t,br);return e(o({theme:kr(r)?n:r},a))}:e})):[],c=e;s&&f&&u.push((function(e){var t=kr(e.theme)?n:e.theme,r=Sr(s,t);if(r){var a={};return Object.entries(r).forEach((function(n){var r=(0,i.Z)(n,2),s=r[0],u=r[1];a[s]="function"===typeof u?u(o({},e,{theme:t})):u})),f(e,a)}return null})),s&&!m&&u.push((function(e){var t=kr(e.theme)?n:e.theme;return Nr(e,Ir(s,t),t,s)})),v||u.push(p);var l=u.length-r.length;if(Array.isArray(e)&&l>0){var d=new Array(l).fill("");(c=[].concat((0,se.Z)(e),(0,se.Z)(d))).raw=[].concat((0,se.Z)(e.raw),(0,se.Z)(d))}else"function"===typeof e&&e.__emotion_real!==e&&(c=function(t){var r=t.theme,a=K(t,xr);return e(o({theme:kr(r)?n:r},a))});var h=y.apply(void 0,[c].concat((0,se.Z)(u)));return h};return y.withConfig&&(b.withConfig=y.withConfig),b}}({defaultTheme:aa,rootShouldForwardProp:ia}),sa=oa;var ua=t.createContext(null);function ca(){return t.useContext(ua)}function la(e){return 0===Object.keys(e).length}var pa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=ca();return!t||la(t)?e:t},da=kn();var fa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:da;return pa(e)};function ha(e){var t=e.props,n=e.name,r=e.defaultTheme,a=function(e){var t=e.theme,n=e.name,r=e.props;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?Q(t.components[n].defaultProps,r):r}({theme:fa(r),name:n,props:t});return a}function ma(e){return ha({props:e.props,name:e.name,defaultTheme:aa})}function va(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function ga(e,n){return t.useMemo((function(){return null==e&&null==n?null:function(t){va(e,t),va(n,t)}}),[e,n])}var ya=ga,ba="undefined"!==typeof window?t.useLayoutEffect:t.useEffect;function xa(e){var n=t.useRef(e);return ba((function(){n.current=e})),t.useCallback((function(){return n.current.apply(void 0,arguments)}),[])}var ka,wa=xa,Sa=!0,Ia=!1,Na={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function Ta(e){e.metaKey||e.altKey||e.ctrlKey||(Sa=!0)}function Ca(){Sa=!1}function Ea(){"hidden"===this.visibilityState&&Ia&&(Sa=!0)}function _a(e){var t=e.target;try{return t.matches(":focus-visible")}catch(n){}return Sa||function(e){var t=e.type,n=e.tagName;return!("INPUT"!==n||!Na[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}var Aa=function(){var e=t.useCallback((function(e){var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",Ta,!0),t.addEventListener("mousedown",Ca,!0),t.addEventListener("pointerdown",Ca,!0),t.addEventListener("touchstart",Ca,!0),t.addEventListener("visibilitychange",Ea,!0))}),[]),n=t.useRef(!1);return{isFocusVisibleRef:n,onFocus:function(e){return!!_a(e)&&(n.current=!0,!0)},onBlur:function(){return!!n.current&&(Ia=!0,window.clearTimeout(ka),ka=window.setTimeout((function(){Ia=!1}),100),n.current=!1,!0)},ref:e}};function Ra(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Fa=n(7326),Da=n(9611);function Za(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,Da.Z)(e,t)}var Oa=t.createContext(null);function Ma(e,n){var r=Object.create(null);return e&&t.Children.map(e,(function(e){return e})).forEach((function(e){r[e.key]=function(e){return n&&(0,t.isValidElement)(e)?n(e):e}(e)})),r}function za(e,t,n){return null!=n[t]?n[t]:e.props[t]}function La(e,n,r){var a=Ma(e.children),i=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var r,a=Object.create(null),i=[];for(var o in e)o in t?i.length&&(a[o]=i,i=[]):i.push(o);var s={};for(var u in t){if(a[u])for(r=0;r<a[u].length;r++){var c=a[u][r];s[a[u][r]]=n(c)}s[u]=n(u)}for(r=0;r<i.length;r++)s[i[r]]=n(i[r]);return s}(n,a);return Object.keys(i).forEach((function(o){var s=i[o];if((0,t.isValidElement)(s)){var u=o in n,c=o in a,l=n[o],p=(0,t.isValidElement)(l)&&!l.props.in;!c||u&&!p?c||!u||p?c&&u&&(0,t.isValidElement)(l)&&(i[o]=(0,t.cloneElement)(s,{onExited:r.bind(null,s),in:l.props.in,exit:za(s,"exit",e),enter:za(s,"enter",e)})):i[o]=(0,t.cloneElement)(s,{in:!1}):i[o]=(0,t.cloneElement)(s,{onExited:r.bind(null,s),in:!0,exit:za(s,"exit",e),enter:za(s,"enter",e)})}})),i}var Pa=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},Ba=function(e){function n(t,n){var r,a=(r=e.call(this,t,n)||this).handleExited.bind((0,Fa.Z)(r));return r.state={contextValue:{isMounting:!0},handleExited:a,firstRender:!0},r}Za(n,e);var r=n.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},n.getDerivedStateFromProps=function(e,n){var r,a,i=n.children,o=n.handleExited;return{children:n.firstRender?(r=e,a=o,Ma(r.children,(function(e){return(0,t.cloneElement)(e,{onExited:a.bind(null,e),in:!0,appear:za(e,"appear",r),enter:za(e,"enter",r),exit:za(e,"exit",r)})}))):La(e,i,o),firstRender:!1}},r.handleExited=function(e,t){var n=Ma(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=o({},t.children);return delete n[e.key],{children:n}})))},r.render=function(){var e=this.props,n=e.component,r=e.childFactory,a=K(e,["component","childFactory"]),i=this.state.contextValue,o=Pa(this.state.children).map(r);return delete a.appear,delete a.enter,delete a.exit,null===n?t.createElement(Oa.Provider,{value:i},o):t.createElement(Oa.Provider,{value:i},t.createElement(n,a,o))},n}(t.Component);Ba.propTypes={},Ba.defaultProps={component:"div",childFactory:function(e){return e}};var Wa=Ba;n(2110),r.useInsertionEffect?r.useInsertionEffect:t.useLayoutEffect;function Va(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return It(t)}var Ua=function(){var e=Va.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};var Ga=n(184);var ja=function(e){var n=e.className,r=e.classes,a=e.pulsate,o=void 0!==a&&a,s=e.rippleX,u=e.rippleY,c=e.rippleSize,l=e.in,p=e.onExited,d=e.timeout,f=t.useState(!1),h=(0,i.Z)(f,2),m=h[0],v=h[1],g=Y(n,r.ripple,r.rippleVisible,o&&r.ripplePulsate),y={width:c,height:c,top:-c/2+u,left:-c/2+s},b=Y(r.child,m&&r.childLeaving,o&&r.childPulsate);return l||m||v(!0),t.useEffect((function(){if(!l&&null!=p){var e=setTimeout(p,d);return function(){clearTimeout(e)}}}),[p,l,d]),(0,Ga.jsx)("span",{className:g,style:y,children:(0,Ga.jsx)("span",{className:b})})},Ha=function(e){return e},qa=function(){var e=Ha;return{configure:function(t){e=t},generate:function(t){return e(t)},reset:function(){e=Ha}}}(),Ka={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",required:"required",selected:"selected"};function Xa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",r=Ka[t];return r?"".concat(n,"-").concat(r):"".concat(qa.generate(e),"-").concat(t)}function Ya(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",r={};return t.forEach((function(t){r[t]=Xa(e,t,n)})),r}var Qa,Ja,$a,ei,ti,ni,ri,ai,ii=Ya("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),oi=["center","classes","className"],si=Ua(ti||(ti=Qa||(Qa=Ra(["\n  0% {\n    transform: scale(0);\n    opacity: 0.1;\n  }\n\n  100% {\n    transform: scale(1);\n    opacity: 0.3;\n  }\n"])))),ui=Ua(ni||(ni=Ja||(Ja=Ra(["\n  0% {\n    opacity: 1;\n  }\n\n  100% {\n    opacity: 0;\n  }\n"])))),ci=Ua(ri||(ri=$a||($a=Ra(["\n  0% {\n    transform: scale(1);\n  }\n\n  50% {\n    transform: scale(0.92);\n  }\n\n  100% {\n    transform: scale(1);\n  }\n"])))),li=sa("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),pi=sa(ja,{name:"MuiTouchRipple",slot:"Ripple"})(ai||(ai=ei||(ei=Ra(["\n  opacity: 0;\n  position: absolute;\n\n  &."," {\n    opacity: 0.3;\n    transform: scale(1);\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  &."," {\n    animation-duration: ","ms;\n  }\n\n  & ."," {\n    opacity: 1;\n    display: block;\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    background-color: currentColor;\n  }\n\n  & ."," {\n    opacity: 0;\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  & ."," {\n    position: absolute;\n    /* @noflip */\n    left: 0px;\n    top: 0;\n    animation-name: ",";\n    animation-duration: 2500ms;\n    animation-timing-function: ",";\n    animation-iteration-count: infinite;\n    animation-delay: 200ms;\n  }\n"]))),ii.rippleVisible,si,550,(function(e){return e.theme.transitions.easing.easeInOut}),ii.ripplePulsate,(function(e){return e.theme.transitions.duration.shorter}),ii.child,ii.childLeaving,ui,550,(function(e){return e.theme.transitions.easing.easeInOut}),ii.childPulsate,ci,(function(e){return e.theme.transitions.easing.easeInOut})),di=t.forwardRef((function(e,n){var r=ma({props:e,name:"MuiTouchRipple"}),a=r.center,s=void 0!==a&&a,u=r.classes,c=void 0===u?{}:u,l=r.className,p=K(r,oi),d=t.useState([]),f=(0,i.Z)(d,2),h=f[0],m=f[1],v=t.useRef(0),g=t.useRef(null);t.useEffect((function(){g.current&&(g.current(),g.current=null)}),[h]);var y=t.useRef(!1),b=t.useRef(null),x=t.useRef(null),k=t.useRef(null);t.useEffect((function(){return function(){clearTimeout(b.current)}}),[]);var w=t.useCallback((function(e){var t=e.pulsate,n=e.rippleX,r=e.rippleY,a=e.rippleSize,i=e.cb;m((function(e){return[].concat((0,se.Z)(e),[(0,Ga.jsx)(pi,{classes:{ripple:Y(c.ripple,ii.ripple),rippleVisible:Y(c.rippleVisible,ii.rippleVisible),ripplePulsate:Y(c.ripplePulsate,ii.ripplePulsate),child:Y(c.child,ii.child),childLeaving:Y(c.childLeaving,ii.childLeaving),childPulsate:Y(c.childPulsate,ii.childPulsate)},timeout:550,pulsate:t,rippleX:n,rippleY:r,rippleSize:a},v.current)])})),v.current+=1,g.current=i}),[c]),S=t.useCallback((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=t.pulsate,a=void 0!==r&&r,i=t.center,o=void 0===i?s||t.pulsate:i,u=t.fakeElement,c=void 0!==u&&u;if("mousedown"===(null==e?void 0:e.type)&&y.current)y.current=!1;else{"touchstart"===(null==e?void 0:e.type)&&(y.current=!0);var l,p,d,f=c?null:k.current,h=f?f.getBoundingClientRect():{width:0,height:0,left:0,top:0};if(o||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)l=Math.round(h.width/2),p=Math.round(h.height/2);else{var m=e.touches&&e.touches.length>0?e.touches[0]:e,v=m.clientX,g=m.clientY;l=Math.round(v-h.left),p=Math.round(g-h.top)}if(o)(d=Math.sqrt((2*Math.pow(h.width,2)+Math.pow(h.height,2))/3))%2===0&&(d+=1);else{var S=2*Math.max(Math.abs((f?f.clientWidth:0)-l),l)+2,I=2*Math.max(Math.abs((f?f.clientHeight:0)-p),p)+2;d=Math.sqrt(Math.pow(S,2)+Math.pow(I,2))}null!=e&&e.touches?null===x.current&&(x.current=function(){w({pulsate:a,rippleX:l,rippleY:p,rippleSize:d,cb:n})},b.current=setTimeout((function(){x.current&&(x.current(),x.current=null)}),80)):w({pulsate:a,rippleX:l,rippleY:p,rippleSize:d,cb:n})}}),[s,w]),I=t.useCallback((function(){S({},{pulsate:!0})}),[S]),N=t.useCallback((function(e,t){if(clearTimeout(b.current),"touchend"===(null==e?void 0:e.type)&&x.current)return x.current(),x.current=null,void(b.current=setTimeout((function(){N(e,t)})));x.current=null,m((function(e){return e.length>0?e.slice(1):e})),g.current=t}),[]);return t.useImperativeHandle(n,(function(){return{pulsate:I,start:S,stop:N}}),[I,S,N]),(0,Ga.jsx)(li,o({className:Y(ii.root,c.root,l),ref:k},p,{children:(0,Ga.jsx)(Wa,{component:null,exit:!0,children:h})}))})),fi=di;function hi(e){return Xa("MuiButtonBase",e)}var mi,vi=Ya("MuiButtonBase",["root","disabled","focusVisible"]),gi=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],yi=sa("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:function(e,t){return t.root}})((mi={display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"}},(0,q.Z)(mi,"&.".concat(vi.disabled),{pointerEvents:"none",cursor:"default"}),(0,q.Z)(mi,"@media print",{colorAdjust:"exact"}),mi)),bi=t.forwardRef((function(e,n){var r=ma({props:e,name:"MuiButtonBase"}),a=r.action,s=r.centerRipple,u=void 0!==s&&s,c=r.children,l=r.className,p=r.component,d=void 0===p?"button":p,f=r.disabled,h=void 0!==f&&f,m=r.disableRipple,v=void 0!==m&&m,g=r.disableTouchRipple,y=void 0!==g&&g,b=r.focusRipple,x=void 0!==b&&b,k=r.LinkComponent,w=void 0===k?"a":k,S=r.onBlur,I=r.onClick,N=r.onContextMenu,T=r.onDragLeave,C=r.onFocus,E=r.onFocusVisible,_=r.onKeyDown,A=r.onKeyUp,R=r.onMouseDown,F=r.onMouseLeave,D=r.onMouseUp,Z=r.onTouchEnd,O=r.onTouchMove,M=r.onTouchStart,z=r.tabIndex,L=void 0===z?0:z,P=r.TouchRippleProps,B=r.touchRippleRef,W=r.type,V=K(r,gi),U=t.useRef(null),G=t.useRef(null),j=ya(G,B),H=Aa(),q=H.isFocusVisibleRef,X=H.onFocus,Q=H.onBlur,$=H.ref,ee=t.useState(!1),te=(0,i.Z)(ee,2),ne=te[0],re=te[1];h&&ne&&re(!1),t.useImperativeHandle(a,(function(){return{focusVisible:function(){re(!0),U.current.focus()}}}),[]);var ae=t.useState(!1),ie=(0,i.Z)(ae,2),oe=ie[0],se=ie[1];t.useEffect((function(){se(!0)}),[]);var ue=oe&&!v&&!h;function ce(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y;return wa((function(r){return t&&t(r),!n&&G.current&&G.current[e](r),!0}))}t.useEffect((function(){ne&&x&&!v&&oe&&G.current.pulsate()}),[v,x,ne,oe]);var le=ce("start",R),pe=ce("stop",N),de=ce("stop",T),fe=ce("stop",D),he=ce("stop",(function(e){ne&&e.preventDefault(),F&&F(e)})),me=ce("start",M),ve=ce("stop",Z),ge=ce("stop",O),ye=ce("stop",(function(e){Q(e),!1===q.current&&re(!1),S&&S(e)}),!1),be=wa((function(e){U.current||(U.current=e.currentTarget),X(e),!0===q.current&&(re(!0),E&&E(e)),C&&C(e)})),xe=function(){var e=U.current;return d&&"button"!==d&&!("A"===e.tagName&&e.href)},ke=t.useRef(!1),we=wa((function(e){x&&!ke.current&&ne&&G.current&&" "===e.key&&(ke.current=!0,G.current.stop(e,(function(){G.current.start(e)}))),e.target===e.currentTarget&&xe()&&" "===e.key&&e.preventDefault(),_&&_(e),e.target===e.currentTarget&&xe()&&"Enter"===e.key&&!h&&(e.preventDefault(),I&&I(e))})),Se=wa((function(e){x&&" "===e.key&&G.current&&ne&&!e.defaultPrevented&&(ke.current=!1,G.current.stop(e,(function(){G.current.pulsate(e)}))),A&&A(e),I&&e.target===e.currentTarget&&xe()&&" "===e.key&&!e.defaultPrevented&&I(e)})),Ie=d;"button"===Ie&&(V.href||V.to)&&(Ie=w);var Ne={};"button"===Ie?(Ne.type=void 0===W?"button":W,Ne.disabled=h):(V.href||V.to||(Ne.role="button"),h&&(Ne["aria-disabled"]=h));var Te=ya($,U),Ce=ya(n,Te);var Ee=o({},r,{centerRipple:u,component:d,disabled:h,disableRipple:v,disableTouchRipple:y,focusRipple:x,tabIndex:L,focusVisible:ne}),_e=function(e){var t=e.disabled,n=e.focusVisible,r=e.focusVisibleClassName,a=J({root:["root",t&&"disabled",n&&"focusVisible"]},hi,e.classes);return n&&r&&(a.root+=" ".concat(r)),a}(Ee);return(0,Ga.jsxs)(yi,o({as:Ie,className:Y(_e.root,l),ownerState:Ee,onBlur:ye,onClick:I,onContextMenu:pe,onFocus:be,onKeyDown:we,onKeyUp:Se,onMouseDown:le,onMouseLeave:he,onMouseUp:fe,onDragLeave:de,onTouchEnd:ve,onTouchMove:ge,onTouchStart:me,ref:Ce,tabIndex:h?-1:L,type:W},Ne,V,{children:[c,ue?(0,Ga.jsx)(fi,o({ref:j,center:u},P)):null]}))})),xi=bi,ki=Qt;function wi(e){return Xa("MuiButton",e)}var Si=Ya("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]);var Ii=t.createContext({}),Ni=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],Ti=["root"],Ci=function(e){return o({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}})},Ei=sa(xi,{shouldForwardProp:function(e){return ia(e)||"classes"===e},name:"MuiButton",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,t[n.variant],t["".concat(n.variant).concat(ki(n.color))],t["size".concat(ki(n.size))],t["".concat(n.variant,"Size").concat(ki(n.size))],"inherit"===n.color&&t.colorInherit,n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth]}})((function(e){var t,n,r,a=e.theme,i=e.ownerState;return o({},a.typography.button,(t={minWidth:64,padding:"6px 16px",borderRadius:(a.vars||a).shape.borderRadius,transition:a.transitions.create(["background-color","box-shadow","border-color","color"],{duration:a.transitions.duration.short}),"&:hover":o({textDecoration:"none",backgroundColor:a.vars?"rgba(".concat(a.vars.palette.text.primaryChannel," / ").concat(a.vars.palette.action.hoverOpacity,")"):ae(a.palette.text.primary,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===i.variant&&"inherit"!==i.color&&{backgroundColor:a.vars?"rgba(".concat(a.vars.palette[i.color].mainChannel," / ").concat(a.vars.palette.action.hoverOpacity,")"):ae(a.palette[i.color].main,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===i.variant&&"inherit"!==i.color&&{border:"1px solid ".concat((a.vars||a).palette[i.color].main),backgroundColor:a.vars?"rgba(".concat(a.vars.palette[i.color].mainChannel," / ").concat(a.vars.palette.action.hoverOpacity,")"):ae(a.palette[i.color].main,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===i.variant&&{backgroundColor:(a.vars||a).palette.grey.A100,boxShadow:(a.vars||a).shadows[4],"@media (hover: none)":{boxShadow:(a.vars||a).shadows[2],backgroundColor:(a.vars||a).palette.grey[300]}},"contained"===i.variant&&"inherit"!==i.color&&{backgroundColor:(a.vars||a).palette[i.color].dark,"@media (hover: none)":{backgroundColor:(a.vars||a).palette[i.color].main}}),"&:active":o({},"contained"===i.variant&&{boxShadow:(a.vars||a).shadows[8]})},(0,q.Z)(t,"&.".concat(Si.focusVisible),o({},"contained"===i.variant&&{boxShadow:(a.vars||a).shadows[6]})),(0,q.Z)(t,"&.".concat(Si.disabled),o({color:(a.vars||a).palette.action.disabled},"outlined"===i.variant&&{border:"1px solid ".concat((a.vars||a).palette.action.disabledBackground)},"outlined"===i.variant&&"secondary"===i.color&&{border:"1px solid ".concat((a.vars||a).palette.action.disabled)},"contained"===i.variant&&{color:(a.vars||a).palette.action.disabled,boxShadow:(a.vars||a).shadows[0],backgroundColor:(a.vars||a).palette.action.disabledBackground})),t),"text"===i.variant&&{padding:"6px 8px"},"text"===i.variant&&"inherit"!==i.color&&{color:(a.vars||a).palette[i.color].main},"outlined"===i.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===i.variant&&"inherit"!==i.color&&{color:(a.vars||a).palette[i.color].main,border:a.vars?"1px solid rgba(".concat(a.vars.palette[i.color].mainChannel," / 0.5)"):"1px solid ".concat(ae(a.palette[i.color].main,.5))},"contained"===i.variant&&{color:a.vars?a.vars.palette.text.primary:null==(n=(r=a.palette).getContrastText)?void 0:n.call(r,a.palette.grey[300]),backgroundColor:(a.vars||a).palette.grey[300],boxShadow:(a.vars||a).shadows[2]},"contained"===i.variant&&"inherit"!==i.color&&{color:(a.vars||a).palette[i.color].contrastText,backgroundColor:(a.vars||a).palette[i.color].main},"inherit"===i.color&&{color:"inherit",borderColor:"currentColor"},"small"===i.size&&"text"===i.variant&&{padding:"4px 5px",fontSize:a.typography.pxToRem(13)},"large"===i.size&&"text"===i.variant&&{padding:"8px 11px",fontSize:a.typography.pxToRem(15)},"small"===i.size&&"outlined"===i.variant&&{padding:"3px 9px",fontSize:a.typography.pxToRem(13)},"large"===i.size&&"outlined"===i.variant&&{padding:"7px 21px",fontSize:a.typography.pxToRem(15)},"small"===i.size&&"contained"===i.variant&&{padding:"4px 10px",fontSize:a.typography.pxToRem(13)},"large"===i.size&&"contained"===i.variant&&{padding:"8px 22px",fontSize:a.typography.pxToRem(15)},i.fullWidth&&{width:"100%"})}),(function(e){var t;return e.ownerState.disableElevation&&(t={boxShadow:"none","&:hover":{boxShadow:"none"}},(0,q.Z)(t,"&.".concat(Si.focusVisible),{boxShadow:"none"}),(0,q.Z)(t,"&:active",{boxShadow:"none"}),(0,q.Z)(t,"&.".concat(Si.disabled),{boxShadow:"none"}),t)})),_i=sa("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:function(e,t){var n=e.ownerState;return[t.startIcon,t["iconSize".concat(ki(n.size))]]}})((function(e){var t=e.ownerState;return o({display:"inherit",marginRight:8,marginLeft:-4},"small"===t.size&&{marginLeft:-2},Ci(t))})),Ai=sa("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:function(e,t){var n=e.ownerState;return[t.endIcon,t["iconSize".concat(ki(n.size))]]}})((function(e){var t=e.ownerState;return o({display:"inherit",marginRight:-4,marginLeft:8},"small"===t.size&&{marginRight:-2},Ci(t))})),Ri=t.forwardRef((function(e,n){var r=t.useContext(Ii),a=ma({props:Q(r,e),name:"MuiButton"}),i=a.children,s=a.color,u=void 0===s?"primary":s,c=a.component,l=void 0===c?"button":c,p=a.className,d=a.disabled,f=void 0!==d&&d,h=a.disableElevation,m=void 0!==h&&h,v=a.disableFocusRipple,g=void 0!==v&&v,y=a.endIcon,b=a.focusVisibleClassName,x=a.fullWidth,k=void 0!==x&&x,w=a.size,S=void 0===w?"medium":w,I=a.startIcon,N=a.type,T=a.variant,C=void 0===T?"text":T,E=K(a,Ni),_=o({},a,{color:u,component:l,disabled:f,disableElevation:m,disableFocusRipple:g,fullWidth:k,size:S,type:N,variant:C}),A=function(e){var t=e.color,n=e.disableElevation,r=e.fullWidth,a=e.size,i=e.variant,s=e.classes;return o({},s,J({root:["root",i,"".concat(i).concat(ki(t)),"size".concat(ki(a)),"".concat(i,"Size").concat(ki(a)),"inherit"===t&&"colorInherit",n&&"disableElevation",r&&"fullWidth"],label:["label"],startIcon:["startIcon","iconSize".concat(ki(a))],endIcon:["endIcon","iconSize".concat(ki(a))]},wi,s))}(_),R=A.root,F=K(A,Ti),D=I&&(0,Ga.jsx)(_i,{className:F.startIcon,ownerState:_,children:I}),Z=y&&(0,Ga.jsx)(Ai,{className:F.endIcon,ownerState:_,children:y});return(0,Ga.jsxs)(Ei,o({ownerState:_,className:Y(r.className,R,p),component:l,disabled:f,focusRipple:!g,focusVisibleClassName:Y(F.focusVisible,b),ref:n,type:N},E,{classes:F,children:[D,i,Z]}))})),Fi=Ri;var Di=function(){return(0,Ga.jsxs)("div",{className:"Dagi",children:[(0,Ga.jsx)(H,{to:"./default",children:(0,Ga.jsx)(Fi,{children:"\ud3c9\ubc94\ud55c ui\ub85c \uc774\ub3d9\ud558\uae30"})}),(0,Ga.jsx)(H,{to:"./low",children:(0,Ga.jsx)(Fi,{children:"\uc791\uc740 ui\ub85c \uc774\ub3d9\ud558\uae30"})})]})};var Zi=function(e){return(0,Ga.jsx)("div",{className:"Header",children:(0,Ga.jsx)("h1",{children:e.dir})})};var Oi=function(){return(0,Ga.jsx)("div",{className:"Footer",children:(0,Ga.jsx)("h1",{children:"\ud478\ud130\ub2e4"})})},Mi=n(7762);function zi(e){return Xa("MuiPaper",e)}Ya("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);var Li=["className","component","elevation","square","variant"],Pi=function(e){return((e<1?5.11916*Math.pow(e,2):4.5*Math.log(e+1)+2)/100).toFixed(2)},Bi=sa("div",{name:"MuiPaper",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,t[n.variant],!n.square&&t.rounded,"elevation"===n.variant&&t["elevation".concat(n.elevation)]]}})((function(e){var t,n=e.theme,r=e.ownerState;return o({backgroundColor:(n.vars||n).palette.background.paper,color:(n.vars||n).palette.text.primary,transition:n.transitions.create("box-shadow")},!r.square&&{borderRadius:n.shape.borderRadius},"outlined"===r.variant&&{border:"1px solid ".concat((n.vars||n).palette.divider)},"elevation"===r.variant&&o({boxShadow:(n.vars||n).shadows[r.elevation]},!n.vars&&"dark"===n.palette.mode&&{backgroundImage:"linear-gradient(".concat(ae("#fff",Pi(r.elevation)),", ").concat(ae("#fff",Pi(r.elevation)),")")},n.vars&&{backgroundImage:null==(t=n.vars.overlays)?void 0:t[r.elevation]}))})),Wi=t.forwardRef((function(e,t){var n=ma({props:e,name:"MuiPaper"}),r=n.className,a=n.component,i=void 0===a?"div":a,s=n.elevation,u=void 0===s?1:s,c=n.square,l=void 0!==c&&c,p=n.variant,d=void 0===p?"elevation":p,f=K(n,Li),h=o({},n,{component:i,elevation:u,square:l,variant:d}),m=function(e){var t=e.square,n=e.elevation,r=e.variant,a=e.classes;return J({root:["root",r,!t&&"rounded","elevation"===r&&"elevation".concat(n)]},zi,a)}(h);return(0,Ga.jsx)(Bi,o({as:i,ownerState:h,className:Y(m.root,r),ref:t},f))}));function Vi(e){return Xa("MuiCard",e)}Ya("MuiCard",["root"]);var Ui=["className","raised"],Gi=sa(Wi,{name:"MuiCard",slot:"Root",overridesResolver:function(e,t){return t.root}})((function(){return{overflow:"hidden"}})),ji=t.forwardRef((function(e,t){var n=ma({props:e,name:"MuiCard"}),r=n.className,a=n.raised,i=void 0!==a&&a,s=K(n,Ui),u=o({},n,{raised:i}),c=function(e){return J({root:["root"]},Vi,e.classes)}(u);return(0,Ga.jsx)(Gi,o({className:Y(c.root,r),elevation:i?8:void 0,ref:t,ownerState:u},s))}));function Hi(e){return Xa("MuiCardMedia",e)}Ya("MuiCardMedia",["root","media","img"]);var qi=["children","className","component","image","src","style"],Ki=sa("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState,r=n.isMediaComponent,a=n.isImageComponent;return[t.root,r&&t.media,a&&t.img]}})((function(e){var t=e.ownerState;return o({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},t.isMediaComponent&&{width:"100%"},t.isImageComponent&&{objectFit:"cover"})})),Xi=["video","audio","picture","iframe","img"],Yi=["picture","img"],Qi=t.forwardRef((function(e,t){var n=ma({props:e,name:"MuiCardMedia"}),r=n.children,a=n.className,i=n.component,s=void 0===i?"div":i,u=n.image,c=n.src,l=n.style,p=K(n,qi),d=-1!==Xi.indexOf(s),f=!d&&u?o({backgroundImage:'url("'.concat(u,'")')},l):l,h=o({},n,{component:s,isMediaComponent:d,isImageComponent:-1!==Yi.indexOf(s)}),m=function(e){var t=e.classes;return J({root:["root",e.isMediaComponent&&"media",e.isImageComponent&&"img"]},Hi,t)}(h);return(0,Ga.jsx)(Ki,o({className:Y(m.root,a),as:s,role:!d&&u?"img":void 0,ref:t,style:f,ownerState:h,src:d?u||c:void 0},p,{children:r}))})),Ji=Qi,$i=n(1457),eo=n(4569).default,to=[],no=[];eo.get("https://i7d207.p.ssafy.io/api/movies").catch((function(e){})).then((function(e){var t,n=e.data,r=(0,Mi.Z)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;to.push((0,Ga.jsx)(ji,{sx:{maxWidth:345},children:(0,Ga.jsx)(Ji,{component:"img",height:"140",image:a.img,alt:"\uc774\ubbf8\uc9c0 \uc5c6\uc5b4\uc6a9 \u3160"})})),no.push(a)}}catch(i){r.e(i)}finally{r.f()}}));var ro=function(){var e=(0,t.useState)("0"),n=(0,i.Z)(e,2),r=n[0],a=n[1],o=(0,t.useState)("0"),s=(0,i.Z)(o,2),u=s[0],c=s[1],l=(0,t.useState)("0"),p=(0,i.Z)(l,2),d=p[0],f=p[1],h=(0,t.useState)("0"),m=(0,i.Z)(h,2),v=m[0],g=m[1],y=(0,t.useState)("0"),b=(0,i.Z)(y,2),x=b[0],k=b[1],w=(0,t.useState)("0"),S=(0,i.Z)(w,2),I=S[0],N=S[1],T=function(e){a(e)},C=function(e){c(e)},E=function(e){f(e)},_=function(e){g(e)},A=function(e){k(e)},R=function(e){N(e)};return(0,Ga.jsxs)("div",{className:"MovieSelect",children:[(0,Ga.jsx)("h1",{children:"now playing"}),(0,Ga.jsxs)("div",{className:"container rows",children:[(0,Ga.jsxs)("div",{className:"row",children:[(0,Ga.jsx)("div",{className:"colrum-2"}),(0,Ga.jsx)("div",{className:"colrum-8",children:(0,Ga.jsx)($i.Carousel,{slides:to,arrows:!1,autoplay:!1,interval:1e3,onSlideChange:function(e){console.log(e),T(no[e].movieCode),C(no[e].title),E(no[e].rating),_(no[e].totalCustomer),A(no[e].ageLimit),R(no[e])}})}),(0,Ga.jsx)("div",{className:"colrum-2"})]}),(0,Ga.jsx)("div",{className:"row",children:(0,Ga.jsx)("h1",{children:u})}),(0,Ga.jsxs)("div",{className:"row",children:[(0,Ga.jsxs)("span",{children:[" ",x]}),(0,Ga.jsx)("span",{children:d}),(0,Ga.jsxs)("span",{children:[" ",v,"\uba85"]})]}),(0,Ga.jsx)("br",{}),(0,Ga.jsx)("div",{className:"row",children:(0,Ga.jsx)(H,{to:"./"+r,state:I,children:(0,Ga.jsx)(Fi,{children:"\uc601\ud654 \uc120\ud0dd"})})})]})]})};function ao(e){return e&&e.ownerDocument||document}function io(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return null==t?e:function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];e.apply(this,r),t.apply(this,r)}}),(function(){}))}var oo=n(4164);var so=t.forwardRef((function(e,n){var r=e.children,a=e.container,o=e.disablePortal,s=void 0!==o&&o,u=t.useState(null),c=(0,i.Z)(u,2),l=c[0],p=c[1],d=ga(t.isValidElement(r)?r.ref:null,n);return ba((function(){s||p(function(e){return"function"===typeof e?e():e}(a)||document.body)}),[a,s]),ba((function(){if(l&&!s)return va(n,l),function(){va(n,null)}}),[n,l,s]),s?t.isValidElement(r)?t.cloneElement(r,{ref:d}):r:l?oo.createPortal(r,l):l})),uo=n(5671),co=n(3144);function lo(e){return ao(e).defaultView||window}function po(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function fo(e){return parseInt(lo(e).getComputedStyle(e).paddingRight,10)||0}function ho(e){var t=-1!==["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName),n="INPUT"===e.tagName&&"hidden"===e.getAttribute("type");return t||n}function mo(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4?arguments[4]:void 0,i=[t,n].concat((0,se.Z)(r));[].forEach.call(e.children,(function(e){var t=-1===i.indexOf(e),n=!ho(e);t&&n&&po(e,a)}))}function vo(e,t){var n=-1;return e.some((function(e,r){return!!t(e)&&(n=r,!0)})),n}function go(e,t){var n=[],r=e.container;if(!t.disableScrollLock){if(function(e){var t=ao(e);return t.body===e?lo(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(r)){var a=function(e){var t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}(ao(r));n.push({value:r.style.paddingRight,property:"padding-right",el:r}),r.style.paddingRight="".concat(fo(r)+a,"px");var i=ao(r).querySelectorAll(".mui-fixed");[].forEach.call(i,(function(e){n.push({value:e.style.paddingRight,property:"padding-right",el:e}),e.style.paddingRight="".concat(fo(e)+a,"px")}))}var o;if(r.parentNode instanceof DocumentFragment)o=ao(r).body;else{var s=r.parentElement,u=lo(r);o="HTML"===(null==s?void 0:s.nodeName)&&"scroll"===u.getComputedStyle(s).overflowY?s:r}n.push({value:o.style.overflow,property:"overflow",el:o},{value:o.style.overflowX,property:"overflow-x",el:o},{value:o.style.overflowY,property:"overflow-y",el:o}),o.style.overflow="hidden"}return function(){n.forEach((function(e){var t=e.value,n=e.el,r=e.property;t?n.style.setProperty(r,t):n.style.removeProperty(r)}))}}var yo=function(){function e(){(0,uo.Z)(this,e),this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}return(0,co.Z)(e,[{key:"add",value:function(e,t){var n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&po(e.modalRef,!1);var r=function(e){var t=[];return[].forEach.call(e.children,(function(e){"true"===e.getAttribute("aria-hidden")&&t.push(e)})),t}(t);mo(t,e.mount,e.modalRef,r,!0);var a=vo(this.containers,(function(e){return e.container===t}));return-1!==a?(this.containers[a].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:r}),n)}},{key:"mount",value:function(e,t){var n=vo(this.containers,(function(t){return-1!==t.modals.indexOf(e)})),r=this.containers[n];r.restore||(r.restore=go(r,t))}},{key:"remove",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.modals.indexOf(e);if(-1===n)return n;var r=vo(this.containers,(function(t){return-1!==t.modals.indexOf(e)})),a=this.containers[r];if(a.modals.splice(a.modals.indexOf(e),1),this.modals.splice(n,1),0===a.modals.length)a.restore&&a.restore(),e.modalRef&&po(e.modalRef,t),mo(a.container,e.mount,e.modalRef,a.hiddenSiblings,!1),this.containers.splice(r,1);else{var i=a.modals[a.modals.length-1];i.modalRef&&po(i.modalRef,!1)}return n}},{key:"isTopModal",value:function(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}]),e}(),bo=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function xo(e){var t=[],n=[];return Array.from(e.querySelectorAll(bo)).forEach((function(e,r){var a=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==a&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;var t=function(t){return e.ownerDocument.querySelector('input[type="radio"]'.concat(t))},n=t('[name="'.concat(e.name,'"]:checked'));return n||(n=t('[name="'.concat(e.name,'"]'))),n!==e}(e))}(e)&&(0===a?t.push(e):n.push({documentOrder:r,tabIndex:a,node:e}))})),n.sort((function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex})).map((function(e){return e.node})).concat(t)}function ko(){return!0}var wo=function(e){var n=e.children,r=e.disableAutoFocus,a=void 0!==r&&r,i=e.disableEnforceFocus,o=void 0!==i&&i,s=e.disableRestoreFocus,u=void 0!==s&&s,c=e.getTabbable,l=void 0===c?xo:c,p=e.isEnabled,d=void 0===p?ko:p,f=e.open,h=t.useRef(),m=t.useRef(null),v=t.useRef(null),g=t.useRef(null),y=t.useRef(null),b=t.useRef(!1),x=t.useRef(null),k=ga(n.ref,x),w=t.useRef(null);t.useEffect((function(){f&&x.current&&(b.current=!a)}),[a,f]),t.useEffect((function(){if(f&&x.current){var e=ao(x.current);return x.current.contains(e.activeElement)||(x.current.hasAttribute("tabIndex")||x.current.setAttribute("tabIndex",-1),b.current&&x.current.focus()),function(){u||(g.current&&g.current.focus&&(h.current=!0,g.current.focus()),g.current=null)}}}),[f]),t.useEffect((function(){if(f&&x.current){var e=ao(x.current),t=function(t){var n=x.current;if(null!==n)if(e.hasFocus()&&!o&&d()&&!h.current){if(!n.contains(e.activeElement)){if(t&&y.current!==t.target||e.activeElement!==y.current)y.current=null;else if(null!==y.current)return;if(!b.current)return;var r=[];if(e.activeElement!==m.current&&e.activeElement!==v.current||(r=l(x.current)),r.length>0){var a,i,s=Boolean((null==(a=w.current)?void 0:a.shiftKey)&&"Tab"===(null==(i=w.current)?void 0:i.key)),u=r[0],c=r[r.length-1];s?c.focus():u.focus()}else n.focus()}}else h.current=!1},n=function(t){w.current=t,!o&&d()&&"Tab"===t.key&&e.activeElement===x.current&&t.shiftKey&&(h.current=!0,v.current.focus())};e.addEventListener("focusin",t),e.addEventListener("keydown",n,!0);var r=setInterval((function(){"BODY"===e.activeElement.tagName&&t()}),50);return function(){clearInterval(r),e.removeEventListener("focusin",t),e.removeEventListener("keydown",n,!0)}}}),[a,o,u,d,f,l]);var S=function(e){null===g.current&&(g.current=e.relatedTarget),b.current=!0};return(0,Ga.jsxs)(t.Fragment,{children:[(0,Ga.jsx)("div",{tabIndex:0,onFocus:S,ref:m,"data-test":"sentinelStart"}),t.cloneElement(n,{ref:k,onFocus:function(e){null===g.current&&(g.current=e.relatedTarget),b.current=!0,y.current=e.target;var t=n.props.onFocus;t&&t(e)}}),(0,Ga.jsx)("div",{tabIndex:0,onFocus:S,ref:v,"data-test":"sentinelEnd"})]})};function So(e){return Xa("MuiModal",e)}Ya("MuiModal",["root","hidden"]);var Io=function(e){return"string"===typeof e};function No(e){if(void 0===e)return{};var t={};return Object.keys(e).filter((function(t){return!(t.match(/^on[A-Z]/)&&"function"===typeof e[t])})).forEach((function(n){t[n]=e[n]})),t}function To(e){var t=e.getSlotProps,n=e.additionalProps,r=e.externalSlotProps,a=e.externalForwardedProps,i=e.className;if(!t){var s=Y(null==a?void 0:a.className,null==r?void 0:r.className,i,null==n?void 0:n.className),u=o({},null==n?void 0:n.style,null==a?void 0:a.style,null==r?void 0:r.style),c=o({},n,a,r);return s.length>0&&(c.className=s),Object.keys(u).length>0&&(c.style=u),{props:c,internalRef:void 0}}var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};var n={};return Object.keys(e).filter((function(n){return n.match(/^on[A-Z]/)&&"function"===typeof e[n]&&!t.includes(n)})).forEach((function(t){n[t]=e[t]})),n}(o({},a,r)),p=No(r),d=No(a),f=t(l),h=Y(null==f?void 0:f.className,null==n?void 0:n.className,i,null==a?void 0:a.className,null==r?void 0:r.className),m=o({},null==f?void 0:f.style,null==n?void 0:n.style,null==a?void 0:a.style,null==r?void 0:r.style),v=o({},f,n,d,p);return h.length>0&&(v.className=h),Object.keys(m).length>0&&(v.style=m),{props:v,internalRef:f.ref}}function Co(e,t){return"function"===typeof e?e(t):e}var Eo=["elementType","externalSlotProps","ownerState"];function _o(e){var t,n=e.elementType,r=e.externalSlotProps,a=e.ownerState,i=K(e,Eo),s=Co(r,a),u=To(o({},i,{externalSlotProps:s})),c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return Io(e)?t:o({},t,{ownerState:o({},t.ownerState,n)})}(n,o({},u.props,{ref:ga(u.internalRef,ga(null==s?void 0:s.ref,null==(t=e.additionalProps)?void 0:t.ref))}),a);return c}var Ao=["children","classes","closeAfterTransition","component","components","componentsProps","container","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onKeyDown","open","onTransitionEnter","onTransitionExited"];var Ro=new yo,Fo=t.forwardRef((function(e,n){var r,a=e.children,s=e.classes,u=e.closeAfterTransition,c=void 0!==u&&u,l=e.component,p=void 0===l?"div":l,d=e.components,f=void 0===d?{}:d,h=e.componentsProps,m=void 0===h?{}:h,v=e.container,g=e.disableAutoFocus,y=void 0!==g&&g,b=e.disableEnforceFocus,x=void 0!==b&&b,k=e.disableEscapeKeyDown,w=void 0!==k&&k,S=e.disablePortal,I=void 0!==S&&S,N=e.disableRestoreFocus,T=void 0!==N&&N,C=e.disableScrollLock,E=void 0!==C&&C,_=e.hideBackdrop,A=void 0!==_&&_,R=e.keepMounted,F=void 0!==R&&R,D=e.manager,Z=void 0===D?Ro:D,O=e.onBackdropClick,M=e.onClose,z=e.onKeyDown,L=e.open,P=e.onTransitionEnter,B=e.onTransitionExited,W=K(e,Ao),V=t.useState(!0),U=(0,i.Z)(V,2),G=U[0],j=U[1],H=t.useRef({}),q=t.useRef(null),X=t.useRef(null),Y=ga(X,n),Q=function(e){return!!e.children&&e.children.props.hasOwnProperty("in")}(e),$=null==(r=e["aria-hidden"])||r,ee=function(){return H.current.modalRef=X.current,H.current.mountNode=q.current,H.current},te=function(){Z.mount(ee(),{disableScrollLock:E}),X.current.scrollTop=0},ne=xa((function(){var e=function(e){return"function"===typeof e?e():e}(v)||ao(q.current).body;Z.add(ee(),e),X.current&&te()})),re=t.useCallback((function(){return Z.isTopModal(ee())}),[Z]),ae=xa((function(e){q.current=e,e&&(L&&re()?te():po(X.current,$))})),ie=t.useCallback((function(){Z.remove(ee(),$)}),[Z,$]);t.useEffect((function(){return function(){ie()}}),[ie]),t.useEffect((function(){L?ne():Q&&c||ie()}),[L,ie,Q,c,ne]);var oe=o({},e,{classes:s,closeAfterTransition:c,disableAutoFocus:y,disableEnforceFocus:x,disableEscapeKeyDown:w,disablePortal:I,disableRestoreFocus:T,disableScrollLock:E,exited:G,hideBackdrop:A,keepMounted:F}),se=function(e){var t=e.open,n=e.exited;return J({root:["root",!t&&n&&"hidden"]},So,e.classes)}(oe),ue={};void 0===a.props.tabIndex&&(ue.tabIndex="-1"),Q&&(ue.onEnter=io((function(){j(!1),P&&P()}),a.props.onEnter),ue.onExited=io((function(){j(!0),B&&B(),c&&ie()}),a.props.onExited));var ce=f.Root||p,le=_o({elementType:ce,externalSlotProps:m.root,externalForwardedProps:W,additionalProps:{ref:Y,role:"presentation",onKeyDown:function(e){z&&z(e),"Escape"===e.key&&re()&&(w||(e.stopPropagation(),M&&M(e,"escapeKeyDown")))}},className:se.root,ownerState:oe}),pe=f.Backdrop,de=_o({elementType:pe,externalSlotProps:m.backdrop,additionalProps:{"aria-hidden":!0,onClick:function(e){e.target===e.currentTarget&&(O&&O(e),M&&M(e,"backdropClick"))},open:L},ownerState:oe});return F||L||Q&&!G?(0,Ga.jsx)(so,{ref:ae,container:v,disablePortal:I,children:(0,Ga.jsxs)(ce,o({},le,{children:[!A&&pe?(0,Ga.jsx)(pe,o({},de)):null,(0,Ga.jsx)(wo,{disableEnforceFocus:x,disableAutoFocus:y,disableRestoreFocus:T,isEnabled:re,open:L,children:t.cloneElement(a,ue)})]}))}):null})),Do=Fo,Zo=!1,Oo="unmounted",Mo="exited",zo="entering",Lo="entered",Po="exiting",Bo=function(e){function n(t,n){var r;r=e.call(this,t,n)||this;var a,i=n&&!n.isMounting?t.enter:t.appear;return r.appearStatus=null,t.in?i?(a=Mo,r.appearStatus=zo):a=Lo:a=t.unmountOnExit||t.mountOnEnter?Oo:Mo,r.state={status:a},r.nextCallback=null,r}Za(n,e),n.getDerivedStateFromProps=function(e,t){return e.in&&t.status===Oo?{status:Mo}:null};var r=n.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==zo&&n!==Lo&&(t=zo):n!==zo&&n!==Lo||(t=Po)}this.updateStatus(!1,t)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var e,t,n,r=this.props.timeout;return e=t=n=r,null!=r&&"number"!==typeof r&&(e=r.exit,t=r.enter,n=void 0!==r.appear?r.appear:t),{exit:e,enter:t,appear:n}},r.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===zo){if(this.props.unmountOnExit||this.props.mountOnEnter){var n=this.props.nodeRef?this.props.nodeRef.current:oo.findDOMNode(this);n&&function(e){e.scrollTop}(n)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Mo&&this.setState({status:Oo})},r.performEnter=function(e){var t=this,n=this.props.enter,r=this.context?this.context.isMounting:e,a=this.props.nodeRef?[r]:[oo.findDOMNode(this),r],i=a[0],o=a[1],s=this.getTimeouts(),u=r?s.appear:s.enter;!e&&!n||Zo?this.safeSetState({status:Lo},(function(){t.props.onEntered(i)})):(this.props.onEnter(i,o),this.safeSetState({status:zo},(function(){t.props.onEntering(i,o),t.onTransitionEnd(u,(function(){t.safeSetState({status:Lo},(function(){t.props.onEntered(i,o)}))}))})))},r.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),r=this.props.nodeRef?void 0:oo.findDOMNode(this);t&&!Zo?(this.props.onExit(r),this.safeSetState({status:Po},(function(){e.props.onExiting(r),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:Mo},(function(){e.props.onExited(r)}))}))}))):this.safeSetState({status:Mo},(function(){e.props.onExited(r)}))},r.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},r.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(r){n&&(n=!1,t.nextCallback=null,e(r))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},r.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:oo.findDOMNode(this),r=null==e&&!this.props.addEndListener;if(n&&!r){if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],i=a[0],o=a[1];this.props.addEndListener(i,o)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},r.render=function(){var e=this.state.status;if(e===Oo)return null;var n=this.props,r=n.children,a=(n.in,n.mountOnEnter,n.unmountOnExit,n.appear,n.enter,n.exit,n.timeout,n.addEndListener,n.onEnter,n.onEntering,n.onEntered,n.onExit,n.onExiting,n.onExited,n.nodeRef,K(n,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return t.createElement(Oa.Provider,{value:null},"function"===typeof r?r(e,a):t.cloneElement(t.Children.only(r),a))},n}(t.Component);function Wo(){}Bo.contextType=Oa,Bo.propTypes={},Bo.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Wo,onEntering:Wo,onEntered:Wo,onExit:Wo,onExiting:Wo,onExited:Wo},Bo.UNMOUNTED=Oo,Bo.EXITED=Mo,Bo.ENTERING=zo,Bo.ENTERED=Lo,Bo.EXITING=Po;var Vo=Bo;function Uo(e,t){var n,r,a=e.timeout,i=e.easing,o=e.style,s=void 0===o?{}:o;return{duration:null!=(n=s.transitionDuration)?n:"number"===typeof a?a:a[t.mode]||0,easing:null!=(r=s.transitionTimingFunction)?r:"object"===typeof i?i[t.mode]:i,delay:s.transitionDelay}}var Go=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],jo={entering:{opacity:1},entered:{opacity:1}},Ho=t.forwardRef((function(e,n){var r=fa(aa),a={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},i=e.addEndListener,s=e.appear,u=void 0===s||s,c=e.children,l=e.easing,p=e.in,d=e.onEnter,f=e.onEntered,h=e.onEntering,m=e.onExit,v=e.onExited,g=e.onExiting,y=e.style,b=e.timeout,x=void 0===b?a:b,k=e.TransitionComponent,w=void 0===k?Vo:k,S=K(e,Go),I=t.useRef(null),N=ya(c.ref,n),T=ya(I,N),C=function(e){return function(t){if(e){var n=I.current;void 0===t?e(n):e(n,t)}}},E=C(h),_=C((function(e,t){!function(e){e.scrollTop}(e);var n=Uo({style:y,timeout:x,easing:l},{mode:"enter"});e.style.webkitTransition=r.transitions.create("opacity",n),e.style.transition=r.transitions.create("opacity",n),d&&d(e,t)})),A=C(f),R=C(g),F=C((function(e){var t=Uo({style:y,timeout:x,easing:l},{mode:"exit"});e.style.webkitTransition=r.transitions.create("opacity",t),e.style.transition=r.transitions.create("opacity",t),m&&m(e)})),D=C(v);return(0,Ga.jsx)(w,o({appear:u,in:p,nodeRef:I,onEnter:_,onEntered:A,onEntering:E,onExit:F,onExited:D,onExiting:R,addEndListener:function(e){i&&i(I.current,e)},timeout:x},S,{children:function(e,n){return t.cloneElement(c,o({style:o({opacity:0,visibility:"exited"!==e||p?void 0:"hidden"},jo[e],y,c.props.style),ref:T},n))}}))})),qo=Ho;function Ko(e){return Xa("MuiBackdrop",e)}Ya("MuiBackdrop",["root","invisible"]);var Xo=["children","component","components","componentsProps","className","invisible","open","transitionDuration","TransitionComponent"],Yo=sa("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,n.invisible&&t.invisible]}})((function(e){return o({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},e.ownerState.invisible&&{backgroundColor:"transparent"})})),Qo=t.forwardRef((function(e,t){var n,r,a=ma({props:e,name:"MuiBackdrop"}),i=a.children,s=a.component,u=void 0===s?"div":s,c=a.components,l=void 0===c?{}:c,p=a.componentsProps,d=void 0===p?{}:p,f=a.className,h=a.invisible,m=void 0!==h&&h,v=a.open,g=a.transitionDuration,y=a.TransitionComponent,b=void 0===y?qo:y,x=K(a,Xo),k=o({},a,{component:u,invisible:m}),w=function(e){var t=e.classes;return J({root:["root",e.invisible&&"invisible"]},Ko,t)}(k);return(0,Ga.jsx)(b,o({in:v,timeout:g},x,{children:(0,Ga.jsx)(Yo,{"aria-hidden":!0,as:null!=(n=l.Root)?n:u,className:Y(w.root,f),ownerState:o({},k,null==(r=d.root)?void 0:r.ownerState),classes:w,ref:t,children:i})}))})),Jo=["BackdropComponent","BackdropProps","closeAfterTransition","children","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","theme"],$o=sa("div",{name:"MuiModal",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,!n.open&&n.exited&&t.hidden]}})((function(e){var t=e.theme,n=e.ownerState;return o({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0},!n.open&&n.exited&&{visibility:"hidden"})})),es=sa(Qo,{name:"MuiModal",slot:"Backdrop",overridesResolver:function(e,t){return t.backdrop}})({zIndex:-1}),ts=t.forwardRef((function(e,n){var r,a,s=ma({name:"MuiModal",props:e}),u=s.BackdropComponent,c=void 0===u?es:u,l=s.BackdropProps,p=s.closeAfterTransition,d=void 0!==p&&p,f=s.children,h=s.component,m=s.components,v=void 0===m?{}:m,g=s.componentsProps,y=void 0===g?{}:g,b=s.disableAutoFocus,x=void 0!==b&&b,k=s.disableEnforceFocus,w=void 0!==k&&k,S=s.disableEscapeKeyDown,I=void 0!==S&&S,N=s.disablePortal,T=void 0!==N&&N,C=s.disableRestoreFocus,E=void 0!==C&&C,_=s.disableScrollLock,A=void 0!==_&&_,R=s.hideBackdrop,F=void 0!==R&&R,D=s.keepMounted,Z=void 0!==D&&D,O=s.theme,M=K(s,Jo),z=t.useState(!0),L=(0,i.Z)(z,2),P=L[0],B=L[1],W={closeAfterTransition:d,disableAutoFocus:x,disableEnforceFocus:w,disableEscapeKeyDown:I,disablePortal:T,disableRestoreFocus:E,disableScrollLock:A,hideBackdrop:F,keepMounted:Z},V=o({},s,W,{exited:P}),U=function(e){return e.classes}(V),G=null!=(r=null!=(a=v.Root)?a:h)?r:$o;return(0,Ga.jsx)(Do,o({components:o({Root:G,Backdrop:c},v),componentsProps:{root:function(){return o({},Co(y.root,V),!Io(G)&&{as:h,theme:O})},backdrop:function(){return o({},l,Co(y.backdrop,V))}},onTransitionEnter:function(){return B(!1)},onTransitionExited:function(){return B(!0)},ref:n},M,{classes:U},W,{children:f}))})),ns=["sx"];function rs(e){var t,n=e.sx,r=function(e){var t={systemProps:{},otherProps:{}};return Object.keys(e).forEach((function(n){fr[n]?t.systemProps[n]=e[n]:t.otherProps[n]=e[n]})),t}(K(e,ns)),a=r.systemProps,i=r.otherProps;return t=Array.isArray(n)?[a].concat((0,se.Z)(n)):"function"===typeof n?function(){var e=n.apply(void 0,arguments);return Wt(e)?o({},a,e):a}:o({},a,n),o({},i,{sx:t})}var as=["className","component"];var is=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.defaultTheme,r=e.defaultClassName,a=void 0===r?"MuiBox-root":r,i=e.generateClassName,s=e.styleFunctionSx,u=void 0===s?gr:s,c=Pt("div",{shouldForwardProp:function(e){return"theme"!==e&&"sx"!==e&&"as"!==e}})(u),l=t.forwardRef((function(e,t){var r=fa(n),s=rs(e),u=s.className,l=s.component,p=void 0===l?"div":l,d=K(s,as);return(0,Ga.jsx)(c,o({as:p,ref:t,className:Y(u,i?i(a):a),theme:r},d))}));return l}({defaultTheme:ra(),defaultClassName:"MuiBox-root",generateClassName:qa.generate}),os=is;var ss=function(e){var n,r=[{name:"\uc2a4\ud06c\ub9b0",seats:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],occupied:[]}],a=e.data.split(","),o=(0,Mi.Z)(a);try{for(o.s();!(n=o.n()).done;){var s=n.value,u=0;switch(s[0]){case"A":default:break;case"B":u=5;break;case"C":u=10;break;case"D":u=15}u+=Number(s.slice(1)),r[0].occupied.push(u)}}catch(h){o.e(h)}finally{o.f()}var c=(0,t.useState)([]),l=(0,i.Z)(c,2),p=l[0],d=(l[1],(0,t.useState)(null)),f=(0,i.Z)(d,2);return f[0],f[1],(0,Ga.jsxs)("div",{className:"SeatsData",children:[(0,Ga.jsx)("div",{}),(0,Ga.jsx)("div",{className:"screen",children:r.map((function(e){for(var t=Math.ceil(e.seats.length/5),n=[],r=0;r<t;r++)n[r]=e.seats.slice(5*r+0,5*r+5);return(0,Ga.jsxs)("div",{className:"seats-section",children:[(0,Ga.jsx)("h5",{children:e.name}),(0,Ga.jsx)("div",{id:"seatBox",children:n.map((function(t,n){return(0,Ga.jsx)("div",{className:"seats",children:t.map((function(t,n){var r=p.indexOf(t)>-1,a=e.occupied.indexOf(t)>-1;return(0,Ga.jsx)("div",{className:"seat ".concat(r?"selected":""," ").concat(a?"occupied":"")},"seat-".concat(t+n))}))},n)}))})]})}))})]})};var us=function(e){var n,r=[{name:"\uc2a4\ud06c\ub9b0",seats:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],occupied:[]}],a=e.data.split(","),o=(0,Mi.Z)(a);try{for(o.s();!(n=o.n()).done;){var s=n.value,u=0;switch(s[0]){case"A":default:break;case"B":u=5;break;case"C":u=10;break;case"D":u=15}u+=Number(s.slice(1)),r[0].occupied.push(u)}}catch(f){o.e(f)}finally{o.f()}var c=(0,t.useState)(null),l=(0,i.Z)(c,2),p=l[0],d=l[1];return(0,Ga.jsxs)("div",{className:"Seats",children:[(0,Ga.jsx)("h3",{children:"\uc88c\uc11d\uc744 \uc120\ud0dd\ud558\uc138\uc694"}),(0,Ga.jsx)("div",{className:"screen",children:r.map((function(t){for(var n=Math.ceil(t.seats.length/5),r=[],a=0;a<n;a++)r[a]=t.seats.slice(5*a+0,5*a+5);return(0,Ga.jsxs)("div",{className:"seats-section",children:[(0,Ga.jsx)("h5",{children:t.name}),r.map((function(n,r){return(0,Ga.jsx)("div",{className:"seats",children:n.map((function(n,r){var a=e.selectedSeats.indexOf(n)>-1,i=t.occupied.indexOf(n)>-1;return(0,Ga.jsx)("div",{className:"seat ".concat(a?"selected":""," ").concat(i?"occupied":""),onClick:function(){i||function(t,n){if(e.selectedSeats.indexOf(t)>-1){var r=e.selectedSeats.filter((function(e){return e!==t}));e.setSelectedSeats(r)}else 0!==e.selectedSeats.length&&p&&p.name!==n.name?alert("Select seats from same catogory"):e.selectedSeats.length>=e.person?alert("\uc778\uc6d0 \ubcf4\ub2e4 \ub9ce\uc740 \uc88c\uc11d\uc744 \uc120\ud0dd\ud588\uc5b4\uc694!"):(e.setSelectedSeats([].concat((0,se.Z)(e.selectedSeats),[t])),d(n));console.log(e.selectedSeats)}(n,t)}},"seat-".concat(n+r))}))},r)}))]})}))})]})};function cs(e){return Xa("MuiButtonGroup",e)}var ls=Ya("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","fullWidth","vertical","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary"]),ps=["children","className","color","component","disabled","disableElevation","disableFocusRipple","disableRipple","fullWidth","orientation","size","variant"],ds=sa("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[(0,q.Z)({},"& .".concat(ls.grouped),t.grouped),(0,q.Z)({},"& .".concat(ls.grouped),t["grouped".concat(ki(n.orientation))]),(0,q.Z)({},"& .".concat(ls.grouped),t["grouped".concat(ki(n.variant))]),(0,q.Z)({},"& .".concat(ls.grouped),t["grouped".concat(ki(n.variant)).concat(ki(n.orientation))]),(0,q.Z)({},"& .".concat(ls.grouped),t["grouped".concat(ki(n.variant)).concat(ki(n.color))]),t.root,t[n.variant],!0===n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth,"vertical"===n.orientation&&t.vertical]}})((function(e){var t=e.theme,n=e.ownerState;return o({display:"inline-flex",borderRadius:(t.vars||t).shape.borderRadius},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[2]},n.disableElevation&&{boxShadow:"none"},n.fullWidth&&{width:"100%"},"vertical"===n.orientation&&{flexDirection:"column"},(0,q.Z)({},"& .".concat(ls.grouped),o({minWidth:40,"&:not(:first-of-type)":o({},"horizontal"===n.orientation&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},"vertical"===n.orientation&&{borderTopRightRadius:0,borderTopLeftRadius:0},"outlined"===n.variant&&"horizontal"===n.orientation&&{marginLeft:-1},"outlined"===n.variant&&"vertical"===n.orientation&&{marginTop:-1}),"&:not(:last-of-type)":o({},"horizontal"===n.orientation&&{borderTopRightRadius:0,borderBottomRightRadius:0},"vertical"===n.orientation&&{borderBottomRightRadius:0,borderBottomLeftRadius:0},"text"===n.variant&&"horizontal"===n.orientation&&{borderRight:t.vars?"1px solid rgba(".concat(t.vars.palette.common.onBackgroundChannel," / 0.23)"):"1px solid ".concat("light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)")},"text"===n.variant&&"vertical"===n.orientation&&{borderBottom:t.vars?"1px solid rgba(".concat(t.vars.palette.common.onBackgroundChannel," / 0.23)"):"1px solid ".concat("light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)")},"text"===n.variant&&"inherit"!==n.color&&{borderColor:t.vars?"rgba(".concat(t.vars.palette[n.color].mainChannel," / 0.5)"):ae(t.palette[n.color].main,.5)},"outlined"===n.variant&&"horizontal"===n.orientation&&{borderRightColor:"transparent"},"outlined"===n.variant&&"vertical"===n.orientation&&{borderBottomColor:"transparent"},"contained"===n.variant&&"horizontal"===n.orientation&&(0,q.Z)({borderRight:"1px solid ".concat((t.vars||t).palette.grey[400])},"&.".concat(ls.disabled),{borderRight:"1px solid ".concat((t.vars||t).palette.action.disabled)}),"contained"===n.variant&&"vertical"===n.orientation&&(0,q.Z)({borderBottom:"1px solid ".concat((t.vars||t).palette.grey[400])},"&.".concat(ls.disabled),{borderBottom:"1px solid ".concat((t.vars||t).palette.action.disabled)}),"contained"===n.variant&&"inherit"!==n.color&&{borderColor:(t.vars||t).palette[n.color].dark},{"&:hover":o({},"outlined"===n.variant&&"horizontal"===n.orientation&&{borderRightColor:"currentColor"},"outlined"===n.variant&&"vertical"===n.orientation&&{borderBottomColor:"currentColor"})}),"&:hover":o({},"contained"===n.variant&&{boxShadow:"none"})},"contained"===n.variant&&{boxShadow:"none"})))})),fs=t.forwardRef((function(e,n){var r=ma({props:e,name:"MuiButtonGroup"}),a=r.children,i=r.className,s=r.color,u=void 0===s?"primary":s,c=r.component,l=void 0===c?"div":c,p=r.disabled,d=void 0!==p&&p,f=r.disableElevation,h=void 0!==f&&f,m=r.disableFocusRipple,v=void 0!==m&&m,g=r.disableRipple,y=void 0!==g&&g,b=r.fullWidth,x=void 0!==b&&b,k=r.orientation,w=void 0===k?"horizontal":k,S=r.size,I=void 0===S?"medium":S,N=r.variant,T=void 0===N?"outlined":N,C=K(r,ps),E=o({},r,{color:u,component:l,disabled:d,disableElevation:h,disableFocusRipple:v,disableRipple:y,fullWidth:x,orientation:w,size:I,variant:T}),_=function(e){var t=e.classes,n=e.color,r=e.disabled,a=e.disableElevation,i=e.fullWidth,o=e.orientation,s=e.variant;return J({root:["root",s,"vertical"===o&&"vertical",i&&"fullWidth",a&&"disableElevation"],grouped:["grouped","grouped".concat(ki(o)),"grouped".concat(ki(s)),"grouped".concat(ki(s)).concat(ki(o)),"grouped".concat(ki(s)).concat(ki(n)),r&&"disabled"]},cs,t)}(E),A=t.useMemo((function(){return{className:_.grouped,color:u,disabled:d,disableElevation:h,disableFocusRipple:v,disableRipple:y,fullWidth:x,size:I,variant:T}}),[u,d,h,v,y,x,I,T,_.grouped]);return(0,Ga.jsx)(ds,o({as:l,role:"group",className:Y(_.root,i),ref:n,ownerState:E},C,{children:(0,Ga.jsx)(Ii.Provider,{value:A,children:a})}))})),hs=fs;var ms=function(e){var n=(0,t.useState)("outlined"),r=(0,i.Z)(n,2),a=r[0],o=r[1],s=(0,t.useState)("outlined"),u=(0,i.Z)(s,2),c=u[0],l=u[1],p=(0,t.useState)("outlined"),d=(0,i.Z)(p,2),f=d[0],h=d[1],m=(0,t.useState)("outlined"),v=(0,i.Z)(m,2),g=v[0],y=v[1],b=(0,t.useState)("outlined"),x=(0,i.Z)(b,2),k=x[0],w=x[1];function S(t){switch(e.setPerson(t),t){case 0:o("contained"),l("outlined"),h("outlined"),y("outlined"),w("outlined");break;case 1:o("outlined"),l("contained"),h("outlined"),y("outlined"),w("outlined");break;case 2:o("outlined"),l("outlined"),h("contained"),y("outlined"),w("outlined");break;case 3:o("outlined"),l("outlined"),h("outlined"),y("contained"),w("outlined");break;case 4:o("outlined"),l("outlined"),h("outlined"),y("outlined"),w("contained")}}return(0,Ga.jsxs)("div",{children:[(0,Ga.jsxs)("h4",{style:{marginBottom:"10px"},children:[e.text,"\xa0\xa0",e.chosePerson]}),(0,Ga.jsxs)(hs,{color:"error",children:[(0,Ga.jsx)(Fi,{onClick:function(){return S(0)},variant:a,children:"0"}),(0,Ga.jsx)(Fi,{onClick:function(){return S(1)},variant:c,children:"1"}),(0,Ga.jsx)(Fi,{onClick:function(){return S(2)},variant:f,children:"2"}),(0,Ga.jsx)(Fi,{onClick:function(){return S(3)},variant:g,children:"3"}),(0,Ga.jsx)(Fi,{onClick:function(){return S(4)},variant:k,children:"4"})]})]})},vs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};var gs=function(){var e,n=O(),r=(window.location.href.split("/").slice(-1),(0,t.useState)(!1)),a=(0,i.Z)(r,2),o=a[0],s=a[1],u=(0,t.useState)("11"),c=(0,i.Z)(u,2),l=c[0],p=c[1],d=function(){return s(!1)},f=(0,t.useState)(0),h=(0,i.Z)(f,2),m=h[0],v=h[1],g=(0,t.useState)(0),y=(0,i.Z)(g,2),b=y[0],x=y[1],k=(0,t.useState)(),w=(0,i.Z)(k,2),S=(w[0],w[1],(0,t.useState)([])),I=(0,i.Z)(S,2),N=I[0],T=I[1],C=(0,t.useState)(),E=(0,i.Z)(C,2),_=E[0],A=E[1],R=Z().state,F=R.moviePlayingInfoList,D=[],M=(0,Mi.Z)(F);try{var z=function(){var t,n=e.value,r=[],a=n.moviePlayingInfoId,i=(0,Mi.Z)(n.tickets);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=(0,Mi.Z)(s.seat.split(","));try{for(u.s();!(o=u.n()).done;){var c=o.value;r.push(c)}}catch(m){u.e(m)}finally{u.f()}}}catch(m){i.e(m)}finally{i.f()}r.sort();for(var l="",d=0,f=r;d<f.length;d++){var h=f[d];l=l+h+","}D.push((0,Ga.jsx)(Fi,{variant:"outlined",onClick:function(e){var t,n;t=a,n=l,console.log({sData:n}),v(0),x(0),T([]),p(n),A(t),console.log(t)},children:n.startTime})),D.push((0,Ga.jsx)("span",{children:"\xa0"}))};for(M.s();!(e=M.n()).done;)z()}catch(B){M.e(B)}finally{M.f()}var L=(0,t.useState)({movie:R.title,adult:1,child:2,seats:{selectedSeats:N}}),P=(0,i.Z)(L,2);return P[0],P[1],(0,Ga.jsxs)("div",{className:"MovieDetail",children:[(0,Ga.jsx)("h1",{id:"timeSelect",children:"\uc2dc\uac04 \uc120\ud0dd"}),(0,Ga.jsxs)("div",{id:"container",children:[(0,Ga.jsx)("div",{id:"box1",children:(0,Ga.jsx)("img",{id:"poster",src:R.img,alt:"\uc0ac\uc9c4\uc774 \uc5c6\uc5b4\uc6a9 \u3160"})}),(0,Ga.jsxs)("div",{id:"box2",children:[(0,Ga.jsx)("h2",{children:R.title}),(0,Ga.jsxs)("p",{children:["\ud3c9\uc810 : ",R.rating]}),(0,Ga.jsxs)("p",{children:[" \ucd1d \uad00\uac1d\uc218 : ",Number(R.totalCustomer)," \uba85"]}),(0,Ga.jsxs)("p",{children:[" \uc5f0\ub839 : ",R.ageLimit.slice(0,3)]}),(0,Ga.jsx)("p",{children:R.summary})]})]}),(0,Ga.jsx)("br",{}),(0,Ga.jsx)("hr",{}),(0,Ga.jsx)("br",{}),(0,Ga.jsxs)("div",{id:"container",className:"reservation",children:[(0,Ga.jsx)("div",{id:"timeBox",children:D}),(0,Ga.jsx)("div",{id:"seat_section",children:(0,Ga.jsx)(ss,{data:l})})]}),(0,Ga.jsxs)("div",{children:[(0,Ga.jsx)("button",{id:"before",onClick:function(){n(-1)},children:"\ub4a4\ub85c\uac00\uae30"}),(0,Ga.jsx)("button",{id:"next",onClick:function(){return s(!0)},children:"\uc88c\uc11d \uc120\ud0dd"})]}),(0,Ga.jsx)(ts,{open:o,onClose:d,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,Ga.jsxs)(os,{sx:vs,children:[(0,Ga.jsx)("h3",{children:"\uc778\uc6d0\uc744 \uc120\ud0dd\ud558\uc138\uc694"}),(0,Ga.jsxs)("div",{className:"modal_box",children:[(0,Ga.jsx)(ms,{text:"\uc131\uc778",chosePerson:m,default:m,kid:b,setPerson:v}),(0,Ga.jsx)(ms,{text:"\uccad\uc18c\ub144",chosePerson:b,default:m,kid:b,setPerson:x})]}),(0,Ga.jsx)(us,{data:l,person:m+b,setSelectedSeats:T,selectedSeats:N}),(0,Ga.jsxs)("div",{className:"button_section",children:[(0,Ga.jsx)(Fi,{variant:"outlined",onClick:d,children:"\ucde8\uc18c"}),(0,Ga.jsx)("span",{children:"\xa0\xa0\xa0"}),(0,Ga.jsx)(H,{to:"./pay",style:{textDecoration:"none"},state:{movie:R.title,adult:{defaultPerson:m},child:{kisPerson:b},seats:{selectedSeats:N},PlayingInfoID:{moviePlayingId:_}},children:(0,Ga.jsx)(Fi,{variant:"contained",children:"\uacb0\uc81c"})})]})]})})]})};var ys=function(){var e,t=O(),r=Z(),a=n(4569).default,i=r.state,o=[],s="",u=(0,Mi.Z)(i.seats.selectedSeats);try{for(u.s();!(e=u.n()).done;){var c=e.value,l=parseInt(c/5),p=c%5,d="";switch(l){case 0:d+="A";break;case 1:d+="B";break;case 2:d+="C";break;case 3:d+="D"}d+="0".concat(p),o.push(d)}}catch(b){u.e(b)}finally{u.f()}o.sort();for(var f="",h=0,m=o;h<m.length;h++){var v=m[h];f+=v+","}for(var g=0;g<i.adult.defaultPerson;g++)s+="ADULT,";for(var y=0;y<i.child.kisPerson;y++)s+="KIDS,";return console.log(i.PlayingInfoID.moviePlayingId),(0,Ga.jsxs)("div",{className:"Pay",children:[(0,Ga.jsx)("h1",{children:"\uc5ec\uae30\ub294 \ub514\ud3f4\ud2b8 \uacb0\uc81c\ucc3d \uc785\ub2c8\ub2e4"}),(0,Ga.jsx)("h1",{children:i.movie}),(0,Ga.jsxs)("h2",{children:["\uc131\uc778: ",i.adult.defaultPerson," \uba85"]}),(0,Ga.jsxs)("h2",{children:["\uccad\uc18c\ub144: ",i.child.kisPerson," \uba85"]}),(0,Ga.jsxs)("h4",{children:["\uc88c\uc11d : ",f.slice(0,-1)]}),(0,Ga.jsx)("hr",{}),(0,Ga.jsxs)("h3",{children:["\ucd1d\uacc4 :",12e3*i.adult.defaultPerson+1e4*i.child.kisPerson]}),(0,Ga.jsx)(Fi,{onClick:function(){t(-1)},children:"\uacb0\uc81c \ucde8\uc18c\ud558\uae30"}),(0,Ga.jsx)(H,{onClick:function(){var e={classification:s.slice(0,-1),moviePlayingInfoId:i.PlayingInfoID.moviePlayingId,phoneNumber:"",seat:f.slice(0,-1),totalCost:"".concat(12e3*i.adult.defaultPerson+1e4*i.child.kisPerson)};a.post("https://i7d207.p.ssafy.io/api/tickets/",e).then((function(t){return console.log(e)}))},to:"./payend",children:"\uacb0\uc81c \uc644\ub8cc"})]})};var bs=function(){return(0,Ga.jsxs)("div",{className:"Payend",children:[(0,Ga.jsx)("h1",{children:"\uacb0\uc81c\uac00 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4"}),(0,Ga.jsx)("a",{href:"/",children:(0,Ga.jsx)(Fi,{children:"\uccab \ud654\uba74\uc73c\ub85c"})})]})},xs=function(){return(0,Ga.jsxs)(B,{children:[(0,Ga.jsx)(L,{path:"",element:(0,Ga.jsx)(ro,{})}),(0,Ga.jsx)(L,{path:":movieCode",element:(0,Ga.jsx)(gs,{})}),(0,Ga.jsx)(L,{path:":movieCode/pay",element:(0,Ga.jsx)(ys,{})}),(0,Ga.jsx)(L,{path:":movieCode/pay/payend",element:(0,Ga.jsx)(bs,{})})]})};var ks=function(e){return(0,Ga.jsxs)("div",{className:"DefaultPage",children:[(0,Ga.jsx)(Zi,{dir:e.data.dirction}),(0,Ga.jsx)("h1",{children:"\uc5ec\uae30\ub294 \ub514\ud3f4\ud2b8 \ud398\uc774\uc9c0"}),(0,Ga.jsx)(xs,{}),(0,Ga.jsx)(Oi,{})]})},ws=n(4165),Ss=n(5861),Is=n(6342);var Ns=function(e){var t,n,r,a,i,o="https://teachablemachine.withgoogle.com/models/wJJWYzoqd/";function s(){return(s=(0,Ss.Z)((0,ws.Z)().mark((function e(){var i,s;return(0,ws.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o+"model.json",o+"metadata.json",e.next=4,Is.zD("https://teachablemachine.withgoogle.com/models/wJJWYzoqd/model.json","https://teachablemachine.withgoogle.com/models/wJJWYzoqd/metadata.json");case 4:return t=e.sent,a=t.getTotalClasses(),i=200,!0,n=new Is.bb(i,i,true),e.next=11,n.setup();case 11:return e.next=13,n.play();case 13:setInterval(u,1e3),(s=document.getElementById("canvas")).width=i,s.height=i,r=s.getContext("2d");case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(){return c.apply(this,arguments)}function c(){return(c=(0,Ss.Z)((0,ws.Z)().mark((function e(){return(0,ws.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.update(),e.next=3,l();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(){return p.apply(this,arguments)}function p(){return(p=(0,Ss.Z)((0,ws.Z)().mark((function r(){var o,s,u,c,l,p;return(0,ws.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=function(t){e.setDirction(t)},r.next=3,t.estimatePose(n.canvas);case 3:return s=r.sent,u=s.pose,c=s.posenetOutput,r.next=8,t.predict(c);case 8:for(l=r.sent,p=0;p<a;p++)l[p].probability.toFixed(2)>.5&&(i=l[p].className);d(u),o(i);case 12:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function d(e){if(n.canvas&&(r.drawImage(n.canvas,0,0),e)){Is.kp(e.keypoints,.5,r),Is.iZ(e.keypoints,.5,r)}}return setTimeout((function(){return s.apply(this,arguments)}),3e3),(0,Ga.jsx)("div",{className:"Pose",children:(0,Ga.jsx)("div",{children:(0,Ga.jsx)("canvas",{hidden:!0,id:"canvas"})})})};var Ts=function(){return(0,Ga.jsxs)("div",{className:"MovieSelectLow",children:[(0,Ga.jsx)("h1",{children:"\uc5ec\uae30\ub294 \uc140\ub809\ud2b8\ub85c\uc6b0"}),(0,Ga.jsx)(H,{to:"./1",children:(0,Ga.jsx)(Fi,{children:"\uc601\ud654 \uc120\ud0dd"})}),(0,Ga.jsx)(Ns,{})]})},Cs={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};var Es=function(){var e=O(),n=window.location.href.split("/").slice(-1);console.log(n);var r=t.useState(!1),a=(0,i.Z)(r,2),o=a[0],s=a[1],u=function(){return s(!1)};return(0,Ga.jsxs)("div",{className:"MovieDetailLow",children:[(0,Ga.jsx)("h1",{children:"\uc5ec\uae30\ub294 \ub514\ud14c\uc77c"}),(0,Ga.jsx)(Fi,{onClick:function(){e(-1)},children:"\ub4a4\ub85c\uac00\uae30"}),(0,Ga.jsxs)("div",{children:[(0,Ga.jsx)(Fi,{onClick:function(){return s(!0)},children:"\uc88c\uc11d \uc120\ud0dd"}),(0,Ga.jsx)(ts,{open:o,onClose:u,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",children:(0,Ga.jsxs)(os,{sx:Cs,children:[(0,Ga.jsx)("h1",{children:"\uc5ec\uae30\ub294 \ubaa8\ub2ec\uc774\uc57c!"}),(0,Ga.jsx)(H,{to:"./pay",children:(0,Ga.jsx)(Fi,{children:"\uacb0\uc81c"})}),(0,Ga.jsx)(Fi,{onClick:u,children:"\ucde8\uc18c"})]})})]})]})};var _s=function(){var e=O();return(0,Ga.jsxs)("div",{className:"PayLow",children:[(0,Ga.jsx)("h1",{children:"\uc5ec\uae30\ub294 \uacb0\uc81c\ucc3d \uc785\ub2c8\ub2e4"}),(0,Ga.jsx)(Fi,{onClick:function(){e(-1)},children:"\uacb0\uc81c \ucde8\uc18c\ud558\uae30"}),(0,Ga.jsx)(H,{to:"./payend",children:"\uacb0\uc81c \uc644\ub8cc"})]})};var As=function(){return(0,Ga.jsx)("div",{className:"PayendLow",children:(0,Ga.jsx)("h1",{children:"\uacb0\uc81c\uac00 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4"})})},Rs=function(){return(0,Ga.jsxs)(B,{children:[(0,Ga.jsx)(L,{path:"",element:(0,Ga.jsx)(Ts,{})}),(0,Ga.jsx)(L,{path:":movieCode",element:(0,Ga.jsx)(Es,{})}),(0,Ga.jsx)(L,{path:":movieCode/pay",element:(0,Ga.jsx)(_s,{})}),(0,Ga.jsx)(L,{path:":movieCode/pay/payend",element:(0,Ga.jsx)(As,{})})]})};var Fs=function(e){return(0,Ga.jsxs)("div",{className:"LowPage",children:[(0,Ga.jsx)(Zi,{}),(0,Ga.jsx)(Oi,{}),(0,Ga.jsx)("h1",{children:"\uc5ec\uae30\ub294 \ub85c\uc6b0 \ud398\uc774\uc9c0"}),(0,Ga.jsx)(Rs,{})]})},Ds=function(e){return(0,Ga.jsx)(j,{children:(0,Ga.jsxs)(B,{children:[(0,Ga.jsx)(L,{path:"/",element:(0,Ga.jsx)(Di,{})}),(0,Ga.jsx)(L,{path:"/low/*",element:(0,Ga.jsx)(Fs,{}),data:e}),(0,Ga.jsx)(L,{path:"/default/*",element:(0,Ga.jsx)(ks,{data:e})})]})})},Zs=n(2193);var Os=function(e){var n,r,a,o=t.useState(!1),s=(0,i.Z)(o,2),u=s[0],c=s[1],l=t.useState(!1),p=(0,i.Z)(l,2),d=p[0],f=p[1],h=t.useRef(),m=t.useRef();t.useEffect((function(){!function(){var e="/models";Promise.all([Zs.nets.tinyFaceDetector.loadFromUri(e),Zs.nets.faceLandmark68Net.loadFromUri(e),Zs.nets.faceRecognitionNet.loadFromUri(e),Zs.nets.faceExpressionNet.loadFromUri(e),Zs.nets.ssdMobilenetv1.loadFromUri(e),Zs.nets.ageGenderNet.loadFromUri(e)]).then(c(!0)),setTimeout(v,5e3)}()}),[]);var v=function(){f(!0),navigator.mediaDevices.getUserMedia({video:{width:300}}).then((function(e){var t=h.current;t.srcObject=e,t.play()})).catch((function(e){console.error("error:",e)}))},g=function(){h.current.pause(),h.current.srcObject.getTracks()[0].stop(),f(!1)};return(0,Ga.jsx)("div",{children:d?u?(0,Ga.jsx)("div",{children:(0,Ga.jsxs)("div",{style:{display:"flex",justifyContent:"center",padding:"10px"},children:[(0,Ga.jsx)("video",{ref:h,height:480,width:640,onPlay:function(){var t=setInterval((0,Ss.Z)((0,ws.Z)().mark((function i(){var o,s,u;return(0,ws.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(n&&(clearInterval(t),g()),!m||!m.current){i.next=19;break}return m.current.innerHTML=Zs.createCanvasFromMedia(h.current),o={width:640,height:480},Zs.matchDimensions(m.current,o),i.next=7,Zs.detectSingleFace(h.current,new Zs.TinyFaceDetectorOptions).withFaceLandmarks().withFaceExpressions().withAgeAndGender().withFaceDescriptor();case 7:s=i.sent,n=s,u=Zs.resizeResults(s,o),r=u.age,console.log(r+"\ub098\uc774"),a=u.gender,console.log(a+"\uc131\ubcc4"),c=r,l=a,e.setAge(parseInt(c/1)),e.setGender(l),m&&m.current&&m.current.getContext("2d").clearRect(0,0,640,480),m&&m.current&&Zs.draw.drawDetections(m.current,u),m&&m.current&&Zs.draw.drawFaceLandmarks(m.current,u),m&&m.current&&Zs.draw.drawFaceExpressions(m.current,u);case 19:case"end":return i.stop()}var c,l}),i)}))),100)},style:{borderRadius:"10px"}}),(0,Ga.jsx)("canvas",{ref:m,style:{position:"absolute"}})]})}):(0,Ga.jsx)("div",{children:"loading..."}):(0,Ga.jsx)(Ga.Fragment,{})})};var Ms=function(){var e=(0,t.useState)("0"),r=(0,i.Z)(e,2),a=(r[0],r[1]),o=(0,t.useState)("1"),s=(0,i.Z)(o,2),u=(s[0],s[1]),c=(0,t.useState)("1"),l=(0,i.Z)(c,2),p=l[0],d=l[1],f=(n(4569).default,new WebSocket("wss://i7d207.p.ssafy.io/ws/socket"));function h(e){if(m(f)){var t;return t=e.data,console.log(t),"/"==window.location.pathname&&(Number(t)>=150?window.location.assign(window.location.href+"default"):Number(t)<150&&100<Number(t)&&window.location.assign(window.location.href+"low")),t}}function m(e){return e.readyState===e.OPEN}return f.onmessage=h,f.onopen=function(e){if(!m(f))return},f.onclose=function(e){if(!m(f))return},(0,Ga.jsxs)("div",{className:"App",children:[(0,Ga.jsx)(Ds,{dirction:p}),(0,Ga.jsx)(Os,{setAge:a,setGender:u}),(0,Ga.jsx)(Ns,{setDirction:d}),(0,Ga.jsx)("div",{class:"container",children:(0,Ga.jsxs)("div",{children:[(0,Ga.jsx)("div",{id:"msgArea",class:"col"}),(0,Ga.jsx)("div",{class:"col-6",children:(0,Ga.jsxs)("div",{class:"input-group mb-3",children:[(0,Ga.jsx)("input",{type:"text",id:"msg",class:"form-control","aria-label":"Recipient's username","aria-describedby":"button-addon2"}),(0,Ga.jsxs)("div",{class:"input-group-append",children:[(0,Ga.jsx)("button",{class:"btn btn-outline-secondary",type:"button",id:"button-send",onClick:function(){var e=document.getElementById("msg");console.log(e.value),f.send(e.value),e.value=""},children:"\uc804\uc1a1"}),(0,Ga.jsx)("button",{class:"btn btn-outline-secondary",type:"button",id:"button-send",onClick:h,children:"\ubc1b\uae30"})]})]})})]})})]})},zs=function(e){e&&e instanceof Function&&n.e(787).then(n.bind(n,787)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};a.createRoot(document.getElementById("root")).render((0,Ga.jsx)(t.StrictMode,{children:(0,Ga.jsx)(Ms,{})})),zs()}()}();
//# sourceMappingURL=main.54c63660.js.map